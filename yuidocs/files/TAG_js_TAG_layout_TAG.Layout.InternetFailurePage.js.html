<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>TAG/js/TAG/layout/TAG.Layout.InternetFailurePage.js - Touch Art Gallery web application</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../../TAG/images/WideLogo.scale-100.png" title="Touch Art Gallery web application"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Autolinker.html">Autolinker</a></li>
            
                <li><a href="../classes/TAG.AnnotatedImage.html">TAG.AnnotatedImage</a></li>
            
                <li><a href="../classes/TAG.IdleTimer.html">TAG.IdleTimer</a></li>
            
                <li><a href="../classes/TAG.Layout.Artmode.html">TAG.Layout.Artmode</a></li>
            
                <li><a href="../classes/TAG.Layout.InternetFailurePage.js.html">TAG.Layout.InternetFailurePage.js</a></li>
            
                <li><a href="../classes/TAG.Layout.NewCatalog.html">TAG.Layout.NewCatalog</a></li>
            
                <li><a href="../classes/TAG.Layout.StartPage.html">TAG.Layout.StartPage</a></li>
            
                <li><a href="../classes/TAG.Layout.VideoPlayer.html">TAG.Layout.VideoPlayer</a></li>
            
                <li><a href="../classes/TAG.Util.Artwork.html">TAG.Util.Artwork</a></li>
            
                <li><a href="../classes/TAG_embed.html">TAG_embed</a></li>
            
                <li><a href="../classes/Telemetry.html">Telemetry</a></li>
            
                <li><a href="../classes/TwoStageTimer.html">TwoStageTimer</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: TAG/js/TAG/layout/TAG.Layout.InternetFailurePage.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
ï»¿TAG.Util.makeNamespace(&quot;TAG.Layout.InternetFailurePage&quot;);
TAG.Util.makeNamespace(&quot;TAG.Layout.InternetFailure&quot;);

TAG.Layout.InternetFailure.lastOverlay = {};

/*
    BM - Using this for more than internet failure, should
    be renamed/refactored in the future.
*/

/**
 * Internet failure page, which appears when TAG detects a loss of internet.
 * @class TAG.Layout.InternetFailurePage.js
 * @constructor
 * @param errorType   
 */
TAG.Layout.InternetFailurePage = function (errorType, detach) {
    &quot;use strict&quot;;

    this.getRoot = function () {
        return root;
    };

    var root,
        mainPanel,
        needPassword = false, // used to determine whether password input box appears
        DATA_LIMIT = &quot;Data Limit&quot;,
        SERVER_DOWN = &quot;Server Down&quot;,
        NO_INTERNET = &quot;No Internet&quot;,
        INTERNET_LOST = &quot;Internet Lost&quot;;

    init();

    /**
     * Sets up internet failure page (handlers, etc) using the input errorType
     * @method init
     */

    function init() {
        root = TAG.Util.getHtmlAjax(&#x27;InternetFailurePage.html&#x27;);
        root.css(&quot;width&quot;, $(&quot;#tagRoot&quot;).width());
        root.css(&quot;height&quot;, $(&quot;#tagRoot&quot;).height());
	mainPanel=root.find(&quot;#mainPanel&quot;);
	mainPanel.css(&quot;width&quot;, $(&quot;#tagRoot&quot;).width());
        mainPanel.css(&quot;height&quot;, $(&quot;#tagRoot&quot;).height());

        var sadface = root.find(&#x27;#sadFace&#x27;);
        var noticeBox = root.find(&#x27;#noticeBox&#x27;);

        var noticeLabel = root.find(&#x27;#noticeLabel&#x27;);//$(document.createElement(&#x27;label&#x27;));
        // noticeLabel.css({ &#x27;color&#x27;: &#x27;white&#x27;, &#x27;font-size&#x27;: &#x27;30px&#x27;, &#x27;left-margin&#x27;: &#x27;4%&#x27;, &#x27;width&#x27;: &#x27;96%&#x27; });

        var noticeText = getNoticeText(errorType);

        noticeLabel.text(noticeText);
        noticeBox.append(noticeLabel).append(&quot;&lt;br&gt;&quot;);

        var reconnectButton = root.find(&#x27;#reconnectButton&#x27;);
        var changeServerButton = root.find(&#x27;#changeServerButton&#x27;);

	    changeServerButton.text(&#x27;Change Server&#x27;);
        //changeServerButton.css({ &#x27;font-size&#x27;: &#x27;150%&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;left&#x27;: &#x27;50%&#x27;, &#x27;top&#x27;: &#x27;5%&#x27; });

        changeServerButton.on(&#x27;click&#x27;, TAG.Util.UI.ChangeServerDialog);

        if (errorType === DATA_LIMIT) {
            reconnectButton.text(&#x27;I Agree&#x27;);

            var disagreeButton = $(document.createElement(&#x27;button&#x27;));
            disagreeButton.text(&#x27;I Disagree&#x27;);
            disagreeButton.css({ &#x27;font-size&#x27;: &#x27;150%&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;left&#x27;: &#x27;45%&#x27;, &#x27;top&#x27;: &#x27;5%&#x27; });
            noticeBox.append(disagreeButton);
            disagreeButton.click(function () {
                window.close();
            });
            reconnectButton.click(function () {
                localStorage.acceptDataUsage = &quot;true&quot;;
                if (!detach) {
                    TAG.Layout.StartPage(null, function (root) {
                        TAG.Util.Splitscreen.setOn(false);
                        TAG.Util.UI.slidePageRight(root);
                    }, true);
                } else {
                    root.remove();
                }
            });

        }
        else if (errorType === SERVER_DOWN) {
            reconnectButton.text(&#x27;Reconnect&#x27;);
            //reconnectButton.css({ &#x27;font-size&#x27;: &#x27;150%&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;left&#x27;: &#x27;30%&#x27;, &#x27;top&#x27;: &#x27;5%&#x27; });
        } else {
            reconnectButton.text(&#x27;Reconnect&#x27;);
            //reconnectButton.css({ &#x27;font-size&#x27;: &#x27;150%&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;left&#x27;: &#x27;53%&#x27;, &#x27;top&#x27;: &#x27;5%&#x27; });
        }


        if (errorType !== DATA_LIMIT) {
            reconnectButton.click(function () {

                noticeLabel.text(&quot;Reconnecting...&quot;);
                reconnectButton.hide();
                sadface.hide();

                setTimeout(function () { // this timeout is here because the label didn&#x27;t have time to reset itself otherwise
                    $.ajax({
                        url: &#x27;http://&#x27; + localStorage.ip + &#x27;:8080&#x27;,
                        dataType: &quot;text&quot;,
                        async: false,
                        cache: false,
                        success: function () {
                            if (!detach) {
                                TAG.Layout.StartPage(null, function (root) {
                                    TAG.Util.Splitscreen.setOn(false);
                                    TAG.Util.UI.slidePageRight(root);
                                }, true);
                            
                            } else {
                                root.remove();
                            }
                        },
                        error: function (err) {
                            $.ajax({
                                url: &quot;http://google.com&quot;,
                                dataType: &quot;text&quot;,
                                async: true,
                                cache: false,
                                success: function () {
                                    noticeLabel.text(getNoticeText(&quot;Server Down&quot;));
                                    reconnectButton.show();
                                },
                                error: function (err) {
                                    noticeLabel.text(getNoticeText((errorType === &quot;Internet Lost&quot; ? &quot;Internet Lost&quot; : &quot;No Internet&quot;)));
                                    reconnectButton.show();
                                }
                            });
                        }
                    });
                }, 100);
            });
        }

        /**
         * Returns a notice message given a certain connectivity error.
         * @method getNoticeText
         * @param {String} error       the error type
         * @return {String}            an error message to be displayed
         */
        function getNoticeText(error) {
            if (error == SERVER_DOWN)
                return &quot;The server is currently unavailable. Please contact the museum administrator for further information.&quot;;
            else if (error == NO_INTERNET)
                return &#x27;No internet connection was detected. The TAG application requires internet connectivity. Please ensure that you are connected to the internet and try again.&#x27;;
            else if (error === INTERNET_LOST)
                return &#x27;Internet connection lost. The TAG application requires internet connectivity. Please ensure that you are connected to the internet and try again.&#x27;;
            else if (error === DATA_LIMIT)
                return &#x27;We have detected that you are on a limited data connection. TAG downloads large images, audio, and videos that can significantly increase your data usage.  By clicking &quot;I Agree&quot; you agree to allow TAG to download images, audio, and videos.  Clicking &quot;I Disagree&quot; will exit TAG.&#x27;;
            return &quot;&quot;;
        }

        var quitButton = $(document.createElement(&#x27;button&#x27;));
        quitButton.text(&#x27;Exit&#x27;);

        quitButton.click(function () {

        });
	
	    noticeBox.append(changeServerButton);
        noticeBox.append(reconnectButton);

        mainPanel.append(sadface);
        mainPanel.append(noticeBox);
 	
        root.append(mainPanel);

        TAG.Layout.InternetFailure.lastOverlay.root = root;
        TAG.Layout.InternetFailure.lastOverlay.type = errorType;
    }
};

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
