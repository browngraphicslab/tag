<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>TAG/js/TAG/layout/TAG.Layout.TourAuthoringNew.js - Touch Art Gallery web application</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../../TAG/images/WideLogo.scale-100.png" title="Touch Art Gallery web application"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Autolinker.html">Autolinker</a></li>
            
                <li><a href="../classes/TAG.AnnotatedImage.html">TAG.AnnotatedImage</a></li>
            
                <li><a href="../classes/TAG.Layout.ArtworkViewer.html">TAG.Layout.ArtworkViewer</a></li>
            
                <li><a href="../classes/TAG.Layout.CollectionsPage.html">TAG.Layout.CollectionsPage</a></li>
            
                <li><a href="../classes/TAG.Layout.InternetFailurePage.js.html">TAG.Layout.InternetFailurePage.js</a></li>
            
                <li><a href="../classes/TAG.Layout.StartPage.html">TAG.Layout.StartPage</a></li>
            
                <li><a href="../classes/TAG.Layout.VideoPlayer.html">TAG.Layout.VideoPlayer</a></li>
            
                <li><a href="../classes/TAG.Util.Artwork.html">TAG.Util.Artwork</a></li>
            
                <li><a href="../classes/TAG.Util.IdleTimer.html">TAG.Util.IdleTimer</a></li>
            
                <li><a href="../classes/TAG_embed.html">TAG_embed</a></li>
            
                <li><a href="../classes/Telemetry.html">Telemetry</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: TAG/js/TAG/layout/TAG.Layout.TourAuthoringNew.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
ï»¿TAG.Util.makeNamespace(&#x27;TAG.Layout.TourAuthoringNew&#x27;);

/**
 * Final layout for Tour Authoring
 * All parts of layout are container in separate files/classes
 * Layout file also contains testing instructions / notes / functions
 * @param tourobj           Doq containing tour info
 * @param onLoadCallback    Callback to run once tour has loaded (loadRin runs async)
 */
TAG.Layout.TourAuthoringNew = function (tourobj, onLoadCallback) {
    &quot;use strict&quot;;

    var root = $(document.createElement(&#x27;div&#x27;)),
        resizableArea = $(document.createElement(&#x27;div&#x27;)),
        originalHeightSize = window.innerHeight * 0.3,
        timeManager,
        undoManager,
        viewer,
        timeline,
        componentControls,
        playbackControls,
        $mainScrollHider,
        $trackBody,
        $trackVeil,
        $inkTextControls,
        $inkDrawControls,
        $inkTransControls,
        $inkEditText,
        $inkEditDraw,
        $inkEditTransparency,
        topbar,
        dataHolder = new DataHolder();

    // Background css
    root.css({
        &quot;background-color&quot;: &quot;rgb(219,218,199)&quot;,
        &quot;height&quot;: &quot;100%&quot;,
        &quot;width&quot;: &quot;100%&quot; 
    });

    /**
    *Second row on screen, contains ComponentControls and Viewer
    **/
    (function setupResizableArea() {

        resizableArea.css({
            &quot;background-color&quot;: &quot;rgb(219,218,199)&quot;,
            &quot;height&quot;: originalHeightSize + &quot;px&quot;,
            &quot;width&quot;: &quot;100%&quot;,
            &quot;box-shadow&quot;: &quot;0px 30px 30px -25px #888&quot;
        });
        resizableArea.attr(&quot;id&quot;, &quot;resizableArea&quot;);
        //mouse down and drag this button, aka three dots...to resize the viewer and component control
        var resizeButtonDocfrag = document.createDocumentFragment();
        var resizeButtonArea = $(document.createElement(&#x27;div&#x27;));
        resizeButtonDocfrag.appendChild(resizeButtonArea[0]);
        resizeButtonArea.addClass(&#x27;resizeButtonArea&#x27;);
        resizeButtonArea.css({
            &#x27;height&#x27;: &#x27;3%&#x27;, &#x27;width&#x27;: &#x27;10%&#x27;, &#x27;position&#x27;: &#x27;absolute&#x27;, &#x27;top&#x27;: (originalHeightSize + window.innerHeight * 0.09) + &#x27;px&#x27;,
            &#x27;left&#x27;: &#x27;45%&#x27;, &#x27;margin-left&#x27;: &#x27;-1.5%&#x27;, &#x27;z-index&#x27;: 0, &#x27;float&#x27;: &#x27;left&#x27;
        });

        var resizeButton = $(document.createElement(&#x27;img&#x27;));
        resizeButton.addClass(&quot;resizeButton&quot;);
        resizeButton.attr(&#x27;src&#x27;, &#x27;images/icons/Ellipsis_brown.svg&#x27;);
        resizeButton.attr(&#x27;id&#x27;, &#x27;resizeButton&#x27;);
        resizeButton.css({
            &#x27;height&#x27;: &#x27;auto&#x27;, &#x27;width&#x27;: &#x27;30%&#x27;, &#x27;position&#x27;: &#x27;absolute&#x27;, &#x27;top&#x27;: &#x27;33%&#x27;, &#x27;left&#x27;: &#x27;40%&#x27;
        });

        var prevLocationY;
        var currentMouseLocation;
        var dragOverlay;

        resizeButtonArea.draggable({
            axis: &quot;y&quot;, containment: [0, window.innerHeight / 5 + window.innerHeight * 0.1, 0, window.innerHeight / 1.5 + window.innerHeight * 0.1],
            scroll: false,
            start: function (evt, ui) {
                if (timeline.getEditInkOn() === true) {
                    return false;
                }

                // bring up the buffering overlay, since artwork doesn&#x27;t resize as you drag anyway
                $(&quot;#bufferingDiv&quot;).css({
                    &quot;background&quot;: &quot;rgba(0,0,0,.9)&quot;
                });
                $($(&quot;#bufferingDiv&quot;).parent()).css({
                    &quot;opacity&quot;: 0.9,
                    &quot;display&quot;: &quot;block&quot;
                });
                prevLocationY = ui.position.top;
                timeManager.stop();
            }, //commented out because broke with svg
            stop: function (evt, ui) {
                // the css of bufferingDiv and its parentbeing reset in timeline.onUpdate
                // if we ever eliminate timeline.onUpdate, reset css here
                timeline.onUpdate();
            },
            drag: function (event, ui) {
                if (timeline.getEditInkOn() === true) {
                    return false;
                }
                ui.position.top = Math.constrain(ui.position.top, window.innerHeight / 5 + window.innerHeight * 0.1, window.innerHeight / 1.5 + window.innerHeight * 0.1);
                //if (event.originalEvent.pageY &lt; window.innerHeight / 5 + window.innerHeight * 0.1) {//minimum size
                //    currentMouseLocation = window.innerHeight / 5 + window.innerHeight * 0.1;
                //}
                //else if (event.originalEvent.pageY &gt; window.innerHeight / 1.5 + window.innerHeight * 0.1) {//maximum size
                //    currentMouseLocation = window.innerHeight / 1.5 + window.innerHeight * 0.1;
                //}
                //else {
                //    currentMouseLocation = event.originalEvent.pageY;
                //}

                if (prevLocationY === null) {
                    prevLocationY = ui.position.top;
                    return;
                }
                var distance = (ui.position.top - prevLocationY);
                resizableArea.css({
                    &quot;height&quot;: originalHeightSize + distance + &#x27;px&#x27;
                });
                if (!$mainScrollHider) $mainScrollHider = $(&#x27;.mainScrollHider&#x27;);
                $mainScrollHider.css({
                    &#x27;height&#x27;: $mainScrollHider.height() - distance + &#x27;px&#x27;,
                });
                if (!$trackBody) $trackBody = $(&#x27;#trackBody&#x27;);
                $trackBody.css({
                    &#x27;height&#x27;: $trackBody.height() - distance + &#x27;px&#x27;,
                });
                if (!$trackVeil) $trackVeil = $(&#x27;#trackScrollVeil&#x27;);
                $trackVeil.css({
                    &#x27;height&#x27;: $trackVeil.height() - distance + &#x27;px&#x27;,
                });

                //update the height
                originalHeightSize = originalHeightSize + distance;

                var raTop = resizableArea.offset().top;
                var raHeight = resizableArea.height();
                //resize the component control stuff
                if (!$inkTextControls) $inkTextControls = $(&#x27;#inkTextControls&#x27;);
                if (!$inkDrawControls) $inkDrawControls = $(&#x27;#inkDrawControls&#x27;);
                if (!$inkTransControls) $inkTransControls = $(&#x27;#inkTransControls&#x27;);
                if (!$inkEditText) $inkEditText = $(&#x27;#inkEditText&#x27;);
                if (!$inkEditDraw) $inkEditDraw = $(&#x27;#inkEditDraw&#x27;);
                if (!$inkEditTransparency) $inkEditTransparency = $(&#x27;#inkEditTransparency&#x27;);
                $(&quot;#inkTextControls&quot;).css(&quot;height&quot;, raTop + raHeight - $(&quot;#inkTextControls&quot;).offset().top - 10);
                $(&quot;#inkDrawControls&quot;).css(&quot;height&quot;, raTop + raHeight - $(&quot;#inkDrawControls&quot;).offset().top - 10);
                $(&quot;#inkTransControls&quot;).css(&quot;height&quot;, raTop + raHeight - $(&quot;#inkTransControls&quot;).offset().top - 10);
                $(&quot;#inkEditText&quot;).css(&quot;height&quot;, raTop + raHeight - $(&quot;#inkEditText&quot;).offset().top - 10);
                $(&quot;#inkEditDraw&quot;).css(&quot;height&quot;, raTop + raHeight - $(&quot;#inkEditDraw&quot;).offset().top - 10);
                $(&quot;#inkEditTransparency&quot;).css(&quot;height&quot;, raTop + raHeight - $(&quot;#inkEditTransparency&quot;).offset().top - 10);
                viewer.resize();//resize the viewer.

                prevLocationY = ui.position.top;
            },
            appendTo: &#x27;body&#x27;
        });
        resizeButtonArea.append(resizeButton);

        root.append(resizeButtonDocfrag);
    })();
 
    /**
    *Creates components and sets up UI
    */
    (function initBackend() {
        // Start by initializing all the parts
        timeManager = TAG.TourAuthoring.TimeManager();
        undoManager = TAG.TourAuthoring.UndoManager();
        viewer = TAG.TourAuthoring.Viewer({
            timeManager: timeManager
        });
        timeline = TAG.TourAuthoring.Timeline({
            timeManager: timeManager,
            undoManager: undoManager,
            dataHolder: dataHolder,
            viewer: viewer,
            root: root
        });
        viewer.setTimeline(timeline);
        playbackControls = TAG.TourAuthoring.PlaybackControl({
            timeManager: timeManager,
            undoManager: undoManager,
            viewer: viewer,
            timeline: timeline,
            root : root
        });
        componentControls = TAG.TourAuthoring.ComponentControls({
            root: root,
            undoManager: undoManager,
            playbackControls: playbackControls,
            timeline: timeline,
            dataHolder: dataHolder,
            viewer: viewer,
            timeManager: timeManager
        });
        topbar = TAG.TourAuthoring.TopMenu({
            viewer: viewer,
            timeline: timeline,
            tourobj: tourobj,
            componentControls: componentControls,
            timeManager: timeManager,
            undoManager: undoManager,
            playbackControls: playbackControls,
            root: root
        });
       
        // Assemble the UI using docfrag
        var uiDocfrag = document.createDocumentFragment();
        uiDocfrag.appendChild(resizableArea[0]);

        topbar.addToDOM(root);
        componentControls.addToDOM(resizableArea);
        viewer.addToDOM(resizableArea);
        root.append(uiDocfrag);
        componentControls.addCatalogToDOM(uiDocfrag);
        timeline.addToDOM(uiDocfrag);
        playbackControls.addToDOM(uiDocfrag);
        root.append(uiDocfrag);

        // Load tour from the rin object
        var rin = JSON.parse(unescape(tourobj.Metadata.Content));   
        if (jQuery.isEmptyObject(rin)) {
            rin = timeline.toRIN();
        }

        viewer.initializeTour(rin);
        timeline.loadRIN(rin, onLoadCallback);
        timeline.updateVerticalScroller();
        //timeline.setLoaded();
    })();

    this.getRoot = function() {
        return root;
    };
};
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
