<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>LADS/js/LADS/authoring/LADS.Authoring.SettingsView.js - Touch Art Gallery web application</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../../LADS/images/WideLogo.scale-100.png" title="Touch Art Gallery web application"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/LADS.Layout.Artmode.html">LADS.Layout.Artmode</a></li>
            
                <li><a href="../classes/LADS.Layout.InternetFailurePage.js.html">LADS.Layout.InternetFailurePage.js</a></li>
            
                <li><a href="../classes/LADS.Layout.StartPage.html">LADS.Layout.StartPage</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: LADS/js/LADS/authoring/LADS.Authoring.SettingsView.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
ï»¿LADS.Util.makeNamespace(&quot;LADS.Authoring.SettingsView&quot;);

// This class lays out the general settings page and the exhibition settings page.
LADS.Authoring.SettingsView = function (layoutType, settingsViewCallback, backButtonType, showLoading) {
    var currentSetting = null;
    var prevSelectedSetting = null;
    var prevSelectedName = null;
    var middlePrevSelectedSetting = null;
    var middlePrevSelectedSettingText = null;
    var exhibitionfilter = null;
    var currentUploadedArtworkGuid = null;

    var root = $(document.createElement(&#x27;div&#x27;));
    var topbar = $(document.createElement(&#x27;div&#x27;));
    var mainPanel = $(document.createElement(&#x27;div&#x27;));
    var leftSection = document.createElement(&#x27;div&#x27;);
    var middeLabel = document.createElement(&#x27;div&#x27;);
    var middleSection = document.createElement(&#x27;div&#x27;);
    var middleSettings = document.createElement(&#x27;div&#x27;);
    var rightSection = document.createElement(&#x27;div&#x27;);
    var rightSettings = document.createElement(&#x27;div&#x27;);
    var rightSettingsLabels = document.createElement(&#x27;div&#x27;);
    var rightSettingsFields = document.createElement(&#x27;div&#x27;);
    var rightSettingsEntries = document.createElement(&#x27;div&#x27;);
    var overlayOnRoot = $(document.createElement(&#x27;div&#x27;));
    var editExhibitionCurrentSelected;
    var searchbar = document.createElement(&#x27;textarea&#x27;);
    var searchbarcontainer = document.createElement(&#x27;div&#x27;);
    var mainSettings = {};
    var mainDoq;
    var exhibitions, exhibitionNames, exhibitionCount = 0, exhibitionGuids;
    var currentExhibitionXML;
    var artworkByGuid = {};
    var currentArtwork = null;
    var currentTour = null;
    var artworkExhibition = {}; // mapping from artwork -&gt; exhibitions it belongs to
    var exhibitionByGuid = {}; // mapping from ExhibitionGuid -&gt; exhibition JSON object
    var artworkNames = [];
    var currentExhibitionNumber;
    var splashFrame;
    var filePicker = new Windows.Storage.Pickers.FileOpenPicker();
    var currentUpload;
    var changesSavedLabel;
    var prevSelectedExhibition;
    var topMiddleLabelContainer;
    var artworksList; /////////////////////////////////////////////
    var uploadingOverlay;
    var exhibitionCBArray = [];
    var artworkFolderId;
    var innerProgressBar;
    var searchIndices = [];
    var characterLimitLabel;
    var tourObjects;
    var passwordcontent;

    var that = {
        getRoot: getRoot,
        setView: setView,
        clickElementById: clickElementById,
        selectItemByName: selectItemByName,
        selectArtworkByGuid: selectArtworkByGuid
    };
    init();
    getMainDoq();
    return that;

    function getRoot() {
        return root;
    }

    function clickElementById(id) {
        var elem = $(&#x27;#&#x27; + id);
        if (elem.length) {
            elem.click();
        } else {
            setTimeout(function () {
                clickElementById(id);
            }, 50);
        }
    }

    function setView(view) {
        $(leftSection).children(&#x27;.labelContainer&#x27;).each(function (i, e) {
            if (view === $(e).children(&#x27;.label&#x27;).text()) {
                $(e).click();
                return false;
            }
        });
    }

    function selectItemByName(name) {
        $(middleSettings).children(&#x27;.labelContainer&#x27;).each(function (i, e) {
            if (name === $(e).text()) {
                $(e).click();
                return false;
            }
        });
    }


    function selectArtworkByGuid(guid) {
        // bmost: hack to select artwork, retry every 50ms if it isn&#x27;t in the DOM yet
        if ($(&#x27;#artwork-&#x27; + guid).length == 0) {
            setTimeout(function () {
                selectArtworkByGuid(guid);
            }, 50);
            return;
        }
        $(&#x27;#artwork-&#x27; + guid).click();
    }

    function selectTourByGuid(guid) {
        var tourNumber = 0;
        for (var tourNumber = 0; tourNumber &lt; tourObjects.length; tourNumber++) {
            if (guid == tourObjects[tourNumber].Identifier) {
                currentTour = tourObjects[tourNumber];
                break;
            }
        }

        $(middleSettings).children(&#x27;.labelContainer&#x27;).each(function (i, e) {
            if (i == tourNumber) {
                $(e).click();
                return false;
            }
        });
    }

    this.selectArtworkByGuid = selectArtworkByGuid;


    function init() {
        root.css(&quot;background-color&quot;, &quot;rgb(219,217,204)&quot;);
        root.css(&quot;color&quot;, &quot;black&quot;);
        root.css(&quot;width&quot;, &quot;100%&quot;);
        root.css(&quot;height&quot;, &quot;100%&quot;);


        $(overlayOnRoot).addClass(&#x27;overlayOnRoot&#x27;);
        $(overlayOnRoot).css({
            &#x27;position&#x27;: &#x27;fixed&#x27;,
            &#x27;width&#x27;: &#x27;100%&#x27;,
            &#x27;height&#x27;: &#x27;100%&#x27;,
            &#x27;top&#x27;: &#x27;0&#x27;,
            &#x27;left&#x27;: &#x27;0&#x27;,
            &#x27;background-color&#x27;: &#x27;rgba(0,0,0,0.5)&#x27;,
            &#x27;z-index&#x27;: &#x27;1000&#x27;,
            &#x27;display&#x27;: &#x27;block&#x27;
        });

        var progressIcon = $(document.createElement(&#x27;img&#x27;));
        progressIcon.css({
            &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;top&#x27;: &#x27;45%&#x27;, &#x27;left&#x27;: &#x27;43%&#x27;, &#x27;width&#x27;: &#x27;15%&#x27;, &#x27;height&#x27;: &#x27;auto&#x27;,
        });
        progressIcon.attr(&#x27;src&#x27;, &#x27;images/icons/progress-circle.gif&#x27;);

        overlayOnRoot.append(progressIcon);

        //    LADS.Util.showLoading($(overlayOnRoot));
        $(root).append(overlayOnRoot);

        $(searchbar).css({ &#x27;border-color&#x27;: &#x27;rgb(167,180,174)&#x27;, &#x27;left&#x27;: &#x27;10%&#x27;, &#x27;min-width&#x27;: &#x27;50%&#x27;, &#x27;max-width&#x27;: &#x27;50%&#x27;, &#x27;min-height&#x27;: &#x27;1.4em&#x27;, &#x27;max-height&#x27;: &#x27;1.4em&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;font-size&#x27;: &#x27;170%&#x27;, &#x27;color&#x27;: &#x27;gray&#x27;, &#x27;height&#x27;: &#x27;1em&#x27;, &#x27;border-width&#x27;: &#x27;0.15em&#x27;, });
        $(searchbar).text(&#x27;Search&#x27;);


        currentSetting = &quot;General Settings&quot;;


        exhibitionByGuid = {};

        //LADS.Util.showLoading($(root));
        LADS.Worktop.Database.getExhibitions(getExhibitionsHelper);

        function getExhibitionsHelper(_exhibitions) {
            $(&#x27;.overlayOnRoot&#x27;).show();
            exhibitions = _exhibitions;
            _exhibitions.sort(function (a, b) {
                if (a.Name &lt; b.Name) {
                    return -1;
                } else if (a.Name &gt; b.Name) {
                    return 1;
                } else {
                    return 0;
                }
            });
            exhibitionNames = [];
            exhibitionGuids = [];
            for (var i = 0; i &lt; _exhibitions.length; i++) {
                exhibitionByGuid[_exhibitions[i].Identifier] = _exhibitions[i];
                exhibitionNames.push(_exhibitions[i].Name);
                exhibitionGuids.push(_exhibitions[i].Identifier);
            }

            var topbarHeight = 8;
            createTopBar(topbarHeight);


            mainPanel.css({ width: &#x27;100%&#x27;, height: (100 - topbarHeight) + &#x27;%&#x27; });
            makeLeftSection();
            makeFeedbackSection();
            makeMiddleSection();
            makeRightSection();
            root.append(topbar);
            root.append(mainPanel);

            // RYAN - moved to FileUploader
            uploadingOverlay = $(document.createElement(&#x27;div&#x27;));
            uploadingOverlay.css({ &#x27;position&#x27;: &#x27;absolute&#x27;, &#x27;left&#x27;: &#x27;0%&#x27;, &#x27;top&#x27;: &#x27;0%&#x27;, &#x27;background-color&#x27;: &#x27;rgba(0, 0, 0, .5)&#x27;, &#x27;width&#x27;: &#x27;100%&#x27;, &#x27;height&#x27;: &#x27;100%&#x27;, &#x27;z-index&#x27;: &#x27;100&#x27; });

            var uploadOverlayText = $(document.createElement(&#x27;label&#x27;));
            uploadOverlayText.css({ &#x27;color&#x27;: &#x27;white&#x27;, &#x27;width&#x27;: &#x27;10%&#x27;, &#x27;height&#x27;: &#x27;5%&#x27;, &#x27;top&#x27;: &#x27;38%&#x27;, &#x27;left&#x27;: &#x27;40%&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;font-size&#x27;: &#x27;250%&#x27; });
            uploadOverlayText.text(&#x27;Uploading File. Please wait.&#x27;);

            var progressIcon = $(document.createElement(&#x27;img&#x27;));
            progressIcon.css({
                &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;top&#x27;: &#x27;50%&#x27;, &#x27;left&#x27;: &#x27;14%&#x27;
            });
            progressIcon.attr(&#x27;src&#x27;, &#x27;images/icons/progress-circle.gif&#x27;);

            var progressBar = $(document.createElement(&#x27;div&#x27;));
            progressBar.css({
                &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;top&#x27;: &#x27;42%&#x27;, &#x27;left&#x27;: &#x27;45%&#x27;, &#x27;border-style&#x27;: &#x27;solid&#x27;, &#x27;border-color&#x27;: &#x27;white&#x27;, &#x27;width&#x27;: &#x27;10%&#x27;, &#x27;height&#x27;: &#x27;2%&#x27;
            });

            innerProgressBar = $(document.createElement(&#x27;div&#x27;));
            innerProgressBar.css({
                &#x27;background-color&#x27;: &#x27;white&#x27;,
                &#x27;width&#x27;: &#x27;0%&#x27;, &#x27;height&#x27;: &#x27;100%&#x27;
            });

            progressBar.append(innerProgressBar);

            uploadingOverlay.append(uploadOverlayText);
            uploadingOverlay.append(progressBar);
            // RYAN - end of FileUploader section

            root.append(uploadingOverlay);
            uploadingOverlay.hide();
            if (settingsViewCallback &amp;&amp; backButtonType == null) {
                settingsViewCallback(that);
            }

        }
    }
    var feedbackSelected = false;

    //Left panel to choose between different settings pages
    function makeLeftSection() {

        $(leftSection).css({ &#x27;width&#x27;: &#x27;25%&#x27;, &#x27;height&#x27;: &#x27;100%&#x27;, &#x27;z-index&#x27;: &#x27;100&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;left&#x27;: &#x27;0%&#x27;, &#x27;background-color&#x27;: &quot;rgb(219,217,204)&quot;, &#x27;float&#x27;: &#x27;left&#x27; });
        createMainLabel(&#x27;General Settings&#x27;, &#x27;Customize appearance&#x27;);
        createMainLabel(&#x27;Exhibitions&#x27;, &#x27;Edit exhibition settings&#x27;);
        createMainLabel(&#x27;Artworks&#x27;, &#x27;Edit list of artworks&#x27;);
        createMainLabel(&#x27;Tour Authoring&#x27;, &#x27;Build interactive tours&#x27;);
        createMainLabel(&#x27;Feedback&#x27;, &#x27;Comments and Reports&#x27;);

        mainPanel.append(leftSection);
    }

    function makeFeedbackSection() {
        var feedbackComments = document.createElement(&#x27;div&#x27;);
        $(feedbackComments).addClass(&#x27;feedbackComments&#x27;);
        $(feedbackComments).css({
            &#x27;background-color&#x27;: &#x27;rgb(219, 217, 204)&#x27;,
            &#x27;position&#x27;: &#x27;absolute&#x27;,
            &#x27;z-index&#x27;: &#x27;999&#x27;, //too big?
            &#x27;left&#x27;: &#x27;50%&#x27;,
            &#x27;width&#x27;: &#x27;50%&#x27;,
            &#x27;height&#x27;: &#x27;100%&#x27;,
            &#x27;display&#x27;: &#x27;none&#x27;
        });
        var leveldiv = document.createElement(&#x27;div&#x27;);
        $(leveldiv).addClass(&#x27;level&#x27;);
        $(leveldiv).css({
            &#x27;position&#x27;: &#x27;relative&#x27;,
            &#x27;top&#x27;: &#x27;10%&#x27;,
            &#x27;left&#x27;: &#x27;5%&#x27;,
            &#x27;height&#x27;: &#x27;50%&#x27;
        });
        $(feedbackComments).append(leveldiv);
        var prioritylevel = document.createElement(&#x27;label&#x27;);
        $(prioritylevel).addClass(&#x27;prioritylevel&#x27;);
        $(prioritylevel).text(&#x27;Priority Level&#x27;);
        $(prioritylevel).css({
            &#x27;font-size&#x27;: &#x27;1em&#x27;,
            &#x27;position&#x27;: &#x27;absolute&#x27;,
            &#x27;font-weight&#x27;: &#x27;777&#x27;,
            &#x27;top&#x27;: &#x27;0.7%&#x27;
        });
        //var slider = document.createElement(&#x27;div&#x27;);
        //$(slider).addClass(&#x27;slider&#x27;);
        //$(slider).css({
        //    &#x27;left&#x27;: &#x27;23%&#x27;,
        //    &#x27;top&#x27;: &#x27;0%&#x27;,
        //    &#x27;width&#x27;: &#x27;40%&#x27;
        //});
        //$(slider).slider();
        //$(&#x27;ui-slider-handle ui-state-default ui-corner-all&#x27;)
        //var handle = document.getElementsByClassName(&#x27;ui-slider-handle ui-state-default ui-corner-all&#x27;);
        //change the color of the handle to white

        //radio buttons
        var lowButton = document.createElement(&quot;input&quot;);
        $(lowButton).addClass(&#x27;lowButton&#x27;);
        lowButton.id = &quot;lowButton&quot;;
        lowButton.setAttribute(&#x27;Name&#x27;, &#x27;buttonRow&#x27;);
        lowButton.setAttribute(&#x27;type&#x27;, &#x27;Radio&#x27;);
        $(lowButton).css({
            &#x27;position&#x27;: &#x27;absolute&#x27;,
            &#x27;left&#x27;: &#x27;18%&#x27;
        });
        var mediumButton = document.createElement(&quot;input&quot;);
        $(mediumButton).addClass(&#x27;mediumButton&#x27;);
        mediumButton.id = &quot;mediumButton&quot;;
        mediumButton.setAttribute(&#x27;Name&#x27;, &#x27;buttonRow&#x27;);
        mediumButton.setAttribute(&#x27;type&#x27;, &#x27;Radio&#x27;);
        mediumButton.setAttribute(&#x27;checked&#x27;, &#x27;true&#x27;);
        $(mediumButton).css({
            &#x27;position&#x27;: &#x27;absolute&#x27;,
            &#x27;left&#x27;: &#x27;30%&#x27;
        });
        var highButton = document.createElement(&quot;input&quot;);
        $(highButton).addClass(&#x27;highButton&#x27;);
        highButton.id = &quot;highButton&quot;;
        highButton.setAttribute(&#x27;Name&#x27;, &#x27;buttonRow&#x27;);
        highButton.setAttribute(&#x27;type&#x27;, &#x27;Radio&#x27;);
        $(highButton).css({
            &#x27;position&#x27;: &#x27;absolute&#x27;,
            &#x27;left&#x27;: &#x27;47%&#x27;
        });

        var low = document.createElement(&#x27;label&#x27;);
        $(low).addClass(&#x27;low&#x27;);
        $(low).text(&#x27;Low&#x27;);
        $(low).css({
            &#x27;font-size&#x27;: &#x27;1em&#x27;,
            &#x27;position&#x27;: &#x27;absolute&#x27;,
            &#x27;font-weight&#x27;: &#x27;777&#x27;,
            &#x27;left&#x27;: &#x27;24%&#x27;,
            &#x27;top&#x27;: &#x27;.7%&#x27;
        });
        var medium = document.createElement(&#x27;label&#x27;);
        $(medium).addClass(&#x27;medium&#x27;);
        $(medium).text(&#x27;Medium&#x27;);
        $(medium).css({
            &#x27;font-size&#x27;: &#x27;1em&#x27;,
            &#x27;position&#x27;: &#x27;absolute&#x27;,
            &#x27;font-weight&#x27;: &#x27;777&#x27;,
            &#x27;left&#x27;: &#x27;36%&#x27;,
            &#x27;top&#x27;: &#x27;.7%&#x27;
        });
        var high = document.createElement(&#x27;label&#x27;);
        $(high).addClass(&#x27;high&#x27;);
        $(high).text(&#x27;High&#x27;);
        $(high).css({
            &#x27;font-size&#x27;: &#x27;1em&#x27;,
            &#x27;position&#x27;: &#x27;absolute&#x27;,
            &#x27;font-weight&#x27;: &#x27;777&#x27;,
            &#x27;left&#x27;: &#x27;53%&#x27;,
            &#x27;top&#x27;: &#x27;.7%&#x27;
        });


        var checkbox = document.createElement(&#x27;input&#x27;);
        $(checkbox).addClass(&#x27;checkbox&#x27;);
        checkbox.id = &quot;feedbackCheckBox&quot;;
        checkbox.setAttribute(&#x27;type&#x27;, &#x27;checkbox&#x27;);
        checkbox.setAttribute(&#x27;checked&#x27;, &#x27;true&#x27;);
        $(checkbox).css({
            &#x27;position&#x27;: &#x27;absolute&#x27;,
            &#x27;top&#x27;: &#x27;10%&#x27;,
            &#x27;border&#x27;: &#x27;solid 2px gray&#x27;
        });

        var wantemail = document.createElement(&#x27;label&#x27;);
        $(wantemail).addClass(&#x27;wantemail&#x27;);
        $(wantemail).text(&#x27;Email me questions and updates on this feature.&#x27;);
        $(wantemail).css({
            &#x27;position&#x27;: &#x27;absolute&#x27;,
            &#x27;left&#x27;: &#x27;7%&#x27;,
            &#x27;font-size&#x27;: &#x27;1em&#x27;,
            &#x27;top&#x27;: &#x27;11%&#x27;
        });
        var address = document.createElement(&#x27;label&#x27;);
        $(address).addClass(&#x27;address&#x27;);
        $(address).text(&#x27;Your email address&#x27;);
        $(address).css({
            &#x27;position&#x27;: &#x27;absolute&#x27;,
            &#x27;left&#x27;: &#x27;7%&#x27;,
            &#x27;font-size&#x27;: &#x27;1em&#x27;,
            &#x27;top&#x27;: &#x27;20%&#x27;
        });
        var emailinput = document.createElement(&#x27;input&#x27;);
        $(emailinput).addClass(&#x27;emailinput&#x27;);
        $(emailinput).css({
            &#x27;position&#x27;: &#x27;absolute&#x27;,
            &#x27;left&#x27;: &#x27;35%&#x27;,
            &#x27;top&#x27;: &#x27;19%&#x27;,
            &#x27;height&#x27;: &#x27;7%&#x27;,
            &#x27;width&#x27;: &#x27;40%&#x27;,
            &#x27;border&#x27;: &#x27;solid 2px gray&#x27;
        });

        var send = document.createElement(&#x27;button&#x27;);
        $(send).addClass(&#x27;send&#x27;);
        $(send).text(&#x27;Send&#x27;);
        $(send).css({
            &#x27;position&#x27;: &#x27;absolute&#x27;,
            &#x27;left&#x27;: &#x27;56.5%&#x27;,
            &#x27;top&#x27;: &#x27;40%&#x27;,
            &#x27;border&#x27;: &#x27;2px solid black&#x27;,
            &#x27;color&#x27;: &#x27;black&#x27;,
            &#x27;font-size&#x27;: &#x27;1 em&#x27;
        });

        var sendingMsg = document.createElement(&#x27;label&#x27;);
        $(sendingMsg).addClass(&#x27;sendingMsg&#x27;);
        $(sendingMsg).text(&#x27;Sending feedback...&#x27;);
        $(sendingMsg).css({
            &#x27;position&#x27;: &#x27;absolute&#x27;,
            &#x27;left&#x27;: &#x27;56.5%&#x27;,
            &#x27;top&#x27;: &#x27;50%&#x27;
        });
        $(sendingMsg).hide();

        send.onclick = function () {
            $(sendingMsg).show();
            setTimeout(function () {
                $(sendingMsg).hide();
                //also clear textboxes and reset buttons after sending
                $(emailinput).val(&quot;&quot;);
                $(checkbox).prop(&#x27;checked&#x27;, &#x27;true&#x27;);
                $(mediumButton).prop(&#x27;checked&#x27;, &#x27;true&#x27;);
                var feedbackBox = document.getElementById(&#x27;feedbackBox&#x27;);
                $(feedbackBox).text(&quot;&quot;);
            }, 3000);
            feedbackSelected = false;
        }

        $(leveldiv).append(send);
        $(leveldiv).append(sendingMsg);
        $(leveldiv).append(emailinput);
        $(leveldiv).append(address);
        $(leveldiv).append(wantemail);
        $(leveldiv).append(checkbox);
        $(leveldiv).append(low);
        $(leveldiv).append(medium);
        $(leveldiv).append(high);
        $(leveldiv).append(lowButton);
        $(leveldiv).append(mediumButton);
        $(leveldiv).append(highButton);
        //$(leveldiv).append(slider);
        $(leveldiv).append(prioritylevel);
        //figure out the best place to append this!
        $(mainPanel).append(feedbackComments);
    }


    //helper function to generate settings page selector buttons
    function createMainLabel(name, subText) {
        var labelContainer = document.createElement(&#x27;div&#x27;);
        $(labelContainer).addClass(&#x27;labelContainer&#x27;);
        $(labelContainer).css({ &#x27;top&#x27;: &#x27;5%&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;width&#x27;: &#x27;100%&#x27;, &#x27;margin-bottom&#x27;: &#x27;10%&#x27;, &#x27;padding-bottom&#x27;: &#x27;2.5%&#x27; });

        var label = document.createElement(&#x27;div&#x27;);
        $(label).addClass(&#x27;label&#x27;);
        $(label).css({ &#x27;top&#x27;: &#x27;5%&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;left&#x27;: &#x27;10%&#x27;, &#x27;font-size&#x27;: &#x27;350%&#x27;, &#x27;color&#x27;: &#x27;black&#x27;, &#x27;font-weight&#x27;: &#x27;500&#x27; });
        $(label).text(name);
        LADS.Util.fitText(label, 0.9);

        var labelInfo = document.createElement(&#x27;div&#x27;);
        $(labelInfo).css({ &#x27;top&#x27;: &#x27;5%&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;left&#x27;: &#x27;10%&#x27;, &#x27;font-size&#x27;: &#x27;200%&#x27;, &#x27;color&#x27;: &#x27;black&#x27; });
        $(labelInfo).text(subText);
        LADS.Util.fitText(labelInfo, 1.4);
        $(labelContainer).append(label);
        $(labelContainer).append(labelInfo);

        /*if (name == &#x27;Tour Authoring&#x27;) { //until tour authoring is available
            labelContainer.onclick = function () {
                //display message 
                var dialogOverlay = document.createElement(&#x27;div&#x27;);
                dialogOverlay.onclick = function () {
                    $(dialogOverlay).fadeOut(500);
                };
                dialogOverlay = $(dialogOverlay);
                dialogOverlay.attr(&#x27;id&#x27;, &#x27;dialogOverlay&#x27;);
                dialogOverlay.css({
                    display: &#x27;none&#x27;,
                    position: &#x27;absolute&#x27;,
                    top: 0,
                    left: 0,
                    width: &#x27;100%&#x27;,
                    height: &#x27;100%&#x27;,
                    &#x27;background-color&#x27;: &#x27;rgba(0,0,0,0.6)&#x27;,
                    &#x27;z-index&#x27;: &#x27;1000&#x27;,
                });

                var tourAuthBox = document.createElement(&#x27;div&#x27;);
                $(tourAuthBox).addClass(&#x27;tourAuthBox&#x27;);
                $(tourAuthBox).css({
                    &#x27;width&#x27;: &#x27;45%&#x27;,
      
                    &#x27;position&#x27;: &#x27;fixed&#x27;,
                    &#x27;top&#x27;: &#x27;40%&#x27;,
                    &#x27;left&#x27;: &#x27;25%&#x27;,
                    &#x27;padding&#x27;: &#x27;2% 2%&#x27;,
                    &#x27;background-color&#x27;: &#x27;black&#x27;,
                    &#x27;border&#x27;: &#x27;3px double white&#x27;,
                    &#x27;z-index&#x27;: &#x27;100&#x27;,
                    &#x27;id&#x27;: &#x27;deleteOptionBox&#x27;
                });
                var tourAuthLabel = document.createElement(&#x27;p&#x27;);
                $(tourAuthLabel).css({
                    &#x27;font-size&#x27;: &#x27;150%&#x27;,
                    &#x27;text-align&#x27;:&#x27;center&#x27;,
                    &#x27;color&#x27;:&#x27;white&#x27;
                });
                $(tourAuthLabel).text(&#x27;Tour Authoring under development. Coming Soon.&#x27;);
                dialogOverlay.append($(tourAuthBox));
                $(tourAuthBox).append($(tourAuthLabel));
                root.append(dialogOverlay);
                dialogOverlay.fadeIn(500);
                
            };
        }
        else {*/

        $(labelContainer).attr(&#x27;flagClicked&#x27;, &#x27;false&#x27;);
        labelContainer.onmousedown = function () {
            if (name == &quot;Feedback&quot;) {
                return;
            }
            $(labelContainer).css({ &#x27;background-color&#x27;: &#x27;white&#x27; });
            //if (name != &quot;Feedback&quot;)
                //$(document.getElementsByClassName(&#x27;overlayOnRoot&#x27;)).fadeIn();
            //labelContainer.click();
        };
        labelContainer.onmouseup = function () {
            if ($(this).attr(&#x27;flagClicked&#x27;) == &#x27;false&#x27;)
                $(this).css({ &#x27;background-color&#x27;: &#x27;transparent&#x27; });
        }
        labelContainer.onmouseleave = function () {
            if ($(this).attr(&#x27;flagClicked&#x27;) == &#x27;false&#x27;)
                $(this).css({ &#x27;background-color&#x27;: &#x27;transparent&#x27; });
        }

        if (name == &quot;Feedback&quot;) {
            $(label).css(&#x27;color&#x27;, &#x27;gray&#x27;);
            $(labelInfo).css(&#x27;color&#x27;, &#x27;gray&#x27;);
        }
        labelContainer.onclick = function () {
            if (name == &quot;Feedback&quot;) {
                return;
            }
            if (prevSelectedName &amp;&amp; prevSelectedName === name) {
                $(&#x27;.overlayOnRoot&#x27;).hide();
                return;
            }

            /************************/
            //pop up a window to confirm if the user is going to leave the current editing feedback page
            var feedbackWarning = document.createElement(&#x27;div&#x27;);
            $(feedbackWarning).addClass(&#x27;feedbackWarning&#x27;);
            $(feedbackWarning).css({
                &#x27;position&#x27;: &#x27;absolute&#x27;,
                &#x27;top&#x27;: &#x27;40%&#x27;,
                &#x27;left&#x27;: &#x27;35%&#x27;,
                &#x27;height&#x27;: &#x27;20%&#x27;,
                &#x27;width&#x27;: &#x27;30%&#x27;,
                &#x27;background-color&#x27;: &#x27;black&#x27;,
                &#x27;border&#x27;: &#x27;double white 1px&#x27;
            });
            var leavingmsg = document.createElement(&#x27;label&#x27;);
            $(leavingmsg).addClass(&#x27;leavingmsg&#x27;);
            $(leavingmsg).text(&#x27;Are you sure you want to leave this page? \n   You have started writing feedback.&#x27;);
            $(leavingmsg).css({ &#x27;position&#x27;: &#x27;absolute&#x27;, &#x27;font-size&#x27;: &#x27;1.2em&#x27;, &#x27;color&#x27;: &#x27;white&#x27;, &#x27;top&#x27;: &#x27;20%&#x27;, &#x27;text-align&#x27;: &#x27;center&#x27; });
            $(feedbackWarning).append(leavingmsg);
            //confirm button for the warning msg, continue going to the other page when clicked
            var confirm = document.createElement(&#x27;button&#x27;);
            $(confirm).addClass(&#x27;confirm&#x27;);
            $(confirm).text(&#x27;Leave Page&#x27;);
            $(confirm).css({
                &#x27;position&#x27;: &#x27;absolute&#x27;,
                &#x27;left&#x27;: &#x27;15%&#x27;,
                &#x27;bottom&#x27;: &#x27;10%&#x27;,
                &#x27;border&#x27;: &#x27;2px solid white&#x27;,
                &#x27;color&#x27;: &#x27;white&#x27;,
                &#x27;font-size&#x27;: &#x27;1 em&#x27;,
                &#x27;text-color&#x27;: &#x27;2%&#x27;
            });
            confirm.onclick = function () {
                feedbackSelected = false;
                //overlay disappear
                $(feedbackWarningOverlay).css({ &#x27;display&#x27;: &#x27;none&#x27; });
                loadSetting();

            };
            $(feedbackWarning).append(confirm);
            //cancel button for the warning msg, stay in the feedback page when clicked
            var cancel = document.createElement(&#x27;button&#x27;);
            $(cancel).addClass(&#x27;cancel&#x27;);
            $(cancel).text(&#x27;Cancel&#x27;);
            $(cancel).css({
                &#x27;position&#x27;: &#x27;absolute&#x27;,
                &#x27;left&#x27;: &#x27;60%&#x27;,
                &#x27;bottom&#x27;: &#x27;10%&#x27;,
                &#x27;border&#x27;: &#x27;2px solid white&#x27;,
                &#x27;color&#x27;: &#x27;white&#x27;,
                &#x27;font-size&#x27;: &#x27;1 em&#x27;
            });
            cancel.onclick = function () {
                $(feedbackWarningOverlay).css({
                    &#x27;display&#x27;: &#x27;none&#x27;
                })
                if (name !== &quot;Feedback&quot;) {
                    $(&#x27;.overlayOnRoot&#x27;).fadeOut();
                    $(labelContainer).css({ &#x27;background-color&#x27;: &quot;rgb(219,217,204)&quot; });
                }
                feedbackSelected = true;
            }
            $(feedbackWarning).append(cancel);
            var feedbackWarningOverlay = LADS.Util.UI.blockInteractionOverlay();
            $(feedbackWarningOverlay).css({
                &#x27;display&#x27;: &#x27;none&#x27;
            })
            root.append(feedbackWarningOverlay);
            $(feedbackWarningOverlay).append(feedbackWarning);

            /************************/


            if (feedbackSelected === true) {
                if (feedbackSelected &amp;&amp; name != &quot;Feedback&quot;) {
                    $(feedbackWarningOverlay).css({
                        &#x27;display&#x27;: &#x27;block&#x27;
                    })
                    feedbackSelected = false;
                }

            } else {
                loadSetting();
            };
        }



        //set default selection as General sittings
        if (name == &quot;General Settings&quot;) {
            $(labelContainer).click();
        }

        if (name != &#x27;Exhibitions&#x27;) {
            $(searchbar).text(&#x27;Search&#x27;);
        }


        $(leftSection).append(labelContainer);

        function loadSetting() {
            console.log(&quot;LOADING: &quot; + name);
            currentSetting = name;

            if (name != &quot;Exhibitions&quot;) {
                $(searchbar).hide();
            } else {
                $(searchbar).show();
            }

            if (prevSelectedSetting != null) {
                $(prevSelectedSetting).css({ &#x27;background-color&#x27;: &quot;rgb(219,217,204)&quot; });
                $(prevSelectedSetting).attr(&#x27;flagClicked&#x27;, &#x27;false&#x27;);
            }

            if (name == &quot;Artworks&quot;) {

                //   $(document.getElementsByClassName(&#x27;overlayOnRoot&#x27;)).fadeIn();

                $(&#x27;.overlayOnRoot&#x27;).show();
                LADS.Worktop.Database.getAllArtworks(getAllArtworksHelper);

                $(rightSettingsEntries).css({ &#x27;height&#x27;: &#x27;44.36%&#x27; });

                function getAllArtworksHelper(artworks) {

                    artworksList = artworks;

                    if (artworksList[0]) {
                        artworksList.sort(function (a, b) {
                            if (a.Name &lt; b.Name) {
                                return -1;
                            } else if (a.Name &gt; b.Name) {
                                return 1;
                            } else {
                                return 0;
                            }
                        });
                    }

                    console.log(&quot;EMPTY SETTINGS A&quot;);
                    $(middleSettings).empty();
                    $(middeLabel).text(name);

                    // bmost: hackish fix for overlays not showing up when button is clicked
                    setTimeout(function () {
                        updateMiddlePanel(name);
                        if (!showLoading) {
                            $(&#x27;.overlayOnRoot&#x27;).hide();
                            showLoading = false;
                        }
                    }, 1);
                    $(labelContainer).css({ &#x27;background-color&#x27;: &#x27;white&#x27; });
                    $(labelContainer).attr(&#x27;flagClicked&#x27;, &#x27;true&#x27;);
                    prevSelectedSetting = labelContainer;
                    prevSelectedName = name;
                }
            }
            else if (name == &quot;Feedback&quot;) {
                //this works BUT need to have it only appear when on feedback
                //think about how to work with clicking off of elements

                //$(feedbackComments).css({ &quot;display&quot;: &quot;block&quot; });
                var feedbackDiv = document.getElementsByClassName(&#x27;feedbackComments&#x27;);
                $(feedbackDiv).css({ &quot;display&quot;: &quot;block&quot; });
            }


            else {
                $(rightSettingsEntries).css({ &#x27;height&#x27;: &#x27;55%&#x27; });
            }


            if (name != &quot;Feedback&quot;) {
                var feedbackDiv = document.getElementsByClassName(&#x27;feedbackComments&#x27;);
                $(feedbackDiv).css({
                    &quot;display&quot;: &quot;none&quot;
                });

                var emailInput = document.getElementsByClassName(&#x27;emailinput&#x27;);
                $(emailInput).val(&quot;&quot;);

                var checkBox = document.getElementById(&#x27;feedbackCheckBox&#x27;);
                $(checkBox).prop(&#x27;checked&#x27;, &#x27;true&#x27;);
                var mediumButton = document.getElementById(&#x27;mediumButton&#x27;);
                $(mediumButton).prop(&#x27;checked&#x27;, &#x27;true&#x27;);

            }

            if (name == &quot;Artworks&quot;)
                return;

            if (name == &quot;Exhibitions&quot; || name == &quot;Tour Authoring&quot;) {
                $(&#x27;.overlayOnRoot&#x27;).show();
            }

            //if (name != &quot;Artworks&quot;) {
                $(rightSettingsEntries).css({ &#x27;height&#x27;: &#x27;55%&#x27; });
                console.log(&quot;EMPTY SETTINGS B&quot;);
                $(middleSettings).empty();
                $(middeLabel).text(name);
                // bmost: hackish fix for overlays not showing up when button is clicked
                setTimeout(function () {
                    updateMiddlePanel(name);
                    if (name == &quot;Exhibitions&quot;) {
                        $(&#x27;.overlayOnRoot&#x27;).hide();
                    }
                }, 1);
            //}

            $(labelContainer).css({ &#x27;background-color&#x27;: &#x27;white&#x27; });
            $(labelContainer).attr(&#x27;flagClicked&#x27;, &#x27;true&#x27;);
            prevSelectedSetting = labelContainer;
            prevSelectedName = name;
            //if (name == &quot;Exhibitions&quot;) {
            //    $(&#x27;.overlayOnRoot&#x27;).hide();
            //}

        };
    }




    //on selecting a settings page, this function updates the information displayed regarding that settings mode
    function updateMiddlePanel(name, flag) {
        var entries = [];
        var type = [];
        var icons = [];
        var artworkGuids = [];
        var isFirst = true;
        switch (name) {

            case &quot;General Settings&quot;:
                entries = getGeneralSettingsOptions();
                break;
            case &quot;Exhibitions&quot;:
                exhibitionCount = 0;
                entries = getExhibitions();
                type = &quot;exhibition&quot;;
                break;
            case &quot;Artworks&quot;:

                currentUploadedArtworkGuid = (!artworksList[0]) ? null : artworksList[0].Identifier;

                for (var i = 0; i &lt; artworksList.length; i++) {
                    entries.push(artworksList[i].Name);
                    //icons.push(artworksList[i].URL);
                    icons.push(artworksList[i].Metadata.Thumbnail);
                    artworkGuids.push(artworksList[i].Identifier);
                }
                type = &quot;Artworks&quot;;
                break;
            case &quot;Feedback&quot;:

                var feedbackBox = document.createElement(&#x27;textarea&#x27;);
                $(feedbackBox).addClass(&#x27;feedbackBox&#x27;);
                feedbackBox.id = &quot;feedbackBox&quot;;
                $(feedbackBox).text(&quot;Questions or comments&quot;);
                $(feedbackBox).css({
                    &#x27;position&#x27;: &#x27;absolute&#x27;,
                    &#x27;left&#x27;: &#x27;5%&#x27;,
                    &#x27;width&#x27;: &#x27;70%&#x27;,
                    &#x27;height&#x27;: &#x27;80%&#x27;,
                    &#x27;color&#x27;: &#x27;gray&#x27;,
                    &#x27;border&#x27;: &#x27;3px solid gray&#x27;
                });

                //used for having text reset only once from default to inputable
                var feedbackOn = false;
                $(middleSettings).append(feedbackBox);

                feedbackBox.onclick = function () {
                    if (feedbackOn === false) {
                        feedbackOn = true;
                        $(feedbackBox).text(&quot;&quot;);
                        $(feedbackBox).css({ &#x27;color&#x27;: &#x27;black&#x27; });
                    }
                    feedbackSelected = true;
                }
                type = &quot;Feedback&quot;;
                break;
        }
        var i = 0;

        // if name == &quot;Tour Authoring&quot;
        if (name == &quot;Tour Authoring&quot;) {
            console.log(&quot;in tour authoring, get tour&quot;);
            getTours(function (localTours) {
                type = &quot;Tours&quot;;
                $.each(localTours, function () {
                    var label = createMiddleLabel(this + &quot;&quot;, &quot;Tours&quot;, &quot;&quot;, &quot;&quot;, tourObjects[i]);
                    // Give labels unique ids based on the tour id
                    $(label).attr(&#x27;id&#x27;, &#x27;tour-&#x27; + tourObjects[i].Identifier);
                    i++;
                });
                if (tourObjects[0])
                    selectTourByGuid(tourObjects[0].Identifier);
                //edit here
                //$(&#x27;#newButton&#x27;).css({ &#x27;margin-top&#x27;: &#x27;-8%&#x27;, &#x27;margin-right&#x27;: &#x27;-8%&#x27;, &#x27;font-size&#x27;: &#x27;80%&#x27;, &#x27;height&#x27;: &#x27;60%&#x27; });
                $(&#x27;#newButton&#x27;).show();
                $(&#x27;#newButton&#x27;).unbind(&#x27;click&#x27;).click(function () {
                    // Create new document
                    $(&#x27;.overlayOnRoot&#x27;).fadeIn();
                    LADS.Worktop.Database.createTour(function (newtour) {
                        getTours(function (tours) {
                            console.log(&quot;EMPTY SETTINGS C&quot;);
                            $(middleSettings).empty();
                            var i = 0;
                            $.each(tours, function () {
                                var label = createMiddleLabel(this + &quot;&quot;, &quot;Tours&quot;, &quot;&quot;, &quot;&quot;, tourObjects[i]);
                                // Give labels unique ids based on the tour id
                                $(label).attr(&#x27;id&#x27;, &#x27;tour-&#x27; + tourObjects[i].Identifier);
                                i++;
                            });
                            if (newtour)
                                selectTourByGuid(newtour.Identifier);
                            $(&#x27;.overlayOnRoot&#x27;).fadeOut();
                        });
                    });
                });

            });
        }


        if (type != &quot;Tours&quot;) {
            $.each(entries, function () {
                if (type == &#x27;Artworks&#x27;) {
                   // if (i &lt; 5)
                    var label = createMiddleLabel(this + &quot;&quot;, type, icons[i], artworkExhibition[artworkGuids[i]], artworksList[i], isFirst);
                    $(label).attr(&#x27;id&#x27;, &#x27;artwork-&#x27; + artworkGuids[i]);
                    isFirst = false;
                }

                else
                    createMiddleLabel(this + &quot;&quot;, type, flag);
                i++;
            });
        }

        if (name == &quot;Exhibitions&quot;) {
            console.log(&quot;in exhibition get list&quot;);
            $(&#x27;#newButton&#x27;).show();
            $(newButton).css({ &#x27;margin-top&#x27;: &#x27;3.7%&#x27; });
            $(&#x27;#newButton&#x27;).unbind(&#x27;click&#x27;).click(function () {
                // Create new document
                var newButtonLoading = $(document.getElementsByClassName(&quot;previewContainer&quot;));
                LADS.Util.showLoading(newButtonLoading);
                
                $(&#x27;.overlayOnRoot&#x27;).show();
                LADS.Worktop.Database.createNewExhibition(function () {
                    console.log(&quot;create new exhibition?&quot;);
                    reloadExhibitions(null, function () {
                        LADS.Util.hideLoading(newButtonLoading);
                        newButtonLoading.css({ &#x27;opacity&#x27;: &#x27;1&#x27; });
                        $(&#x27;.overlayOnRoot&#x27;).hide();
                    });
                });

                //createExhibitionContent();
            });
        }
        else if (name != &quot;Tour Authoring&quot;) {
            console.log(&quot;HIDING NEW BUTTON&quot;);
            $(&#x27;#newButton&#x27;).hide();
        }

        if (name == &quot;Artworks&quot;)
            $(&#x27;#importNew&#x27;).show();
        else
            $(&#x27;#importNew&#x27;).hide();


        // bmost: what is this?
        var hello = $(searchbar).text();
        var papa = searchbar.innerText;

        //search filtering screws up the exhibition index, disable for release
        //if (name == &#x27;Exhibitions&#x27; &amp;&amp; $(searchbar).text() == &#x27;Search&#x27;) {
        if (name == &#x27;Exhibitions&#x27; &amp;&amp; $(searchbar).text() == &#x27;Search&#x27;) {
            $(topMiddleLabelContainer).append(searchbar);
        }
        else if (name != &#x27;Exhibitions&#x27;) {
            $(searchbar).remove();
            $(searchbar).text(&#x27;&#x27;)
            //search();
            $(searchbar).text(&#x27;Search&#x27;)
            searchIndices = [];

        }
        //$(&#x27;.overlayOnRoot&#x27;).fadeOut();
    }


    //add div elements to contain the information in the middle panel
    function createMiddleLabel(name, type, icon, exhibition, artworkObj, isFirst) {

        var labelContainer = document.createElement(&#x27;div&#x27;);
        $(labelContainer).addClass(&#x27;labelContainer&#x27;);
        $(labelContainer).css({
            &#x27;top&#x27;: &#x27;1%&#x27;,
            &#x27;position&#x27;: &#x27;relative&#x27;,
            &#x27;width&#x27;: &#x27;96%&#x27;,
            &#x27;margin-bottom&#x27;: &#x27;2%&#x27;,
            &#x27;height&#x27;: &#x27;7%&#x27;,
            &#x27;left&#x27;: &#x27;2%&#x27;
        });
        $(labelContainer).attr(&#x27;flagClicked&#x27;, &#x27;true&#x27;);
        $(middleSettings).append(labelContainer);

        var imgWidth = 0;
        if (type === &#x27;Artworks&#x27;) {
            var containerHeight = $(labelContainer).height();
            var containerWidth = $(labelContainer).width();
            var ratio = 1.564;
            var imgHeight = containerHeight * .80;
            imgWidth = imgHeight * ratio

            $(labelContainer).css({ &#x27;height&#x27;: &#x27;11%&#x27; });
            var imageThumbnail = document.createElement(&#x27;img&#x27;);
            $(imageThumbnail).attr(&#x27;src&#x27;, icon);
            $(imageThumbnail).css({
                &#x27;height&#x27;: imgHeight + &#x27;px&#x27;,
                &#x27;width&#x27;: imgWidth + &#x27;px&#x27;,
                &#x27;top&#x27;: &#x27;20%&#x27;, // 7
                &#x27;position&#x27;: &#x27;relative&#x27;,
                &#x27;overflow&#x27;: &#x27;hidden&#x27;,
                &#x27;float&#x27;: &#x27;left&#x27;,
                &#x27;left&#x27;: &#x27;5%&#x27;
            });

            if (isFirst)
                $(&#x27;.overlayOnRoot&#x27;).fadeOut();
            // add spinning circle for each image thumbnail
            var progressCircCSS = { &quot;position&quot;: &#x27;absolute&#x27;, &#x27;z-index&#x27;: &#x27;50&#x27;, &#x27;height&#x27;: &#x27;auto&#x27;, &#x27;width&#x27;: &#x27;10%&#x27;, &#x27;left&#x27;: &#x27;5%&#x27;, &#x27;top&#x27;: &#x27;20%&#x27; };
            var centerHor = &#x27;0px&#x27;;
            var centerVert = &#x27;0px&#x27;;
            var circle = LADS.Util.showProgressCircle($(labelContainer), progressCircCSS, centerHor, centerVert, false);
            $(imageThumbnail).load(function () {

                LADS.Util.removeProgressCircle(circle);
            });

            $(labelContainer).append(imageThumbnail);

            var numExhibitionLabel = document.createElement(&#x27;div&#x27;);
            //  if (exhibition.length == 1)
            //      $(numExhibitionLabel).text(exhibition.length + &quot; Exhibition&quot;);
            //  else
            //      $(numExhibitionLabel).text(exhibition.length + &quot; Exhibitions&quot;);

            $(numExhibitionLabel).css({ &#x27;position&#x27;: &#x27;absolute&#x27;, &#x27;float&#x27;: &#x27;right&#x27;, &#x27;font-size&#x27;: &#x27;130%&#x27;, &#x27;top&#x27;: &#x27;52%&#x27;, &#x27;right&#x27;: &#x27;37%&#x27; });
        }

        var label = document.createElement(&#x27;div&#x27;);
        $(label).addClass(&#x27;label&#x27;);

        var labelleft = (type === &#x27;Artworks&#x27;) ? 10 : 5;
        var labelTop = (type === &#x27;Artworks&#x27;) ? 20 : 5;

        var textWidth = $(&#x27;.labelContainer&#x27;).width() - $(&#x27;.labelContainer&#x27;).width() * 0.14 - imgWidth;
        if (textWidth === 0) { // Hack to keep things working before loading
            textWidth = 350;
        }
        $(label).css({
            &#x27;top&#x27;: labelTop + &quot;%&quot;,
            &#x27;position&#x27;: &#x27;relative&#x27;,
            &#x27;left&#x27;: labelleft + &#x27;%&#x27;,
            &#x27;font-size&#x27;: &#x27;185%&#x27;,
            &#x27;color&#x27;: &#x27;black&#x27;,
            &#x27;height&#x27;: &#x27;100%&#x27;, //100
            &#x27;width&#x27;: textWidth + &#x27;px&#x27;,
            &#x27;float&#x27;: &#x27;left&#x27;,
            //&#x27;white-space&#x27;: &#x27;no-wrap&#x27;,
            &#x27;overflow&#x27;: &#x27;hidden&#x27;,
            &#x27;text-overflow&#x27;: &#x27;ellipsis&#x27;,
            &#x27;white-space&#x27;: &#x27;nowrap&#x27;,
        });

        $(label).text(name);
        $(label).attr(&#x27;text&#x27;, name);

        $(labelContainer).append(label);

        var exhibitionNumber = exhibitionCount;

        $(labelContainer).attr(&#x27;flagClicked&#x27;, &#x27;false&#x27;);
        labelContainer.onmousedown = function () {
            if (name == &quot;Password Settings&quot;) {
                return;
            }
            $(labelContainer).css({ &#x27;background-color&#x27;: &#x27;white&#x27; });
        };
        labelContainer.onmouseleave = function () {
            if ($(this).attr(&#x27;flagClicked&#x27;) == &#x27;false&#x27;)
                $(this).css({ &#x27;background-color&#x27;: &#x27;transparent&#x27; });

        }
        if (name == &quot;Password Settings&quot;) {
            $(label).css(&#x27;color&#x27;, &#x27;gray&#x27;);
        }
        labelContainer.onclick = function () {
            if (name == &quot;Password Settings&quot;) {
                return;
            }
            if (middlePrevSelectedSetting == labelContainer) {
                return;
            }

            if (middlePrevSelectedSetting != null) {
                $(middlePrevSelectedSetting).css({ &#x27;background-color&#x27;: &quot;rgb(219,217,204)&quot; });

            }

            middlePrevSelectedSetting = labelContainer;
            $(middlePrevSelectedSetting).attr(&#x27;flagClicked&#x27;, &#x27;true&#x27;);
            middlePrevSelectedSettingText = label;

            $(rightSection).empty();
            $(rightSettings).empty();
            $(rightSettingsEntries).empty();
            $(rightSettingsFields).empty();
            $(rightSettingsLabels).empty();

            if (name == &quot;Splash Screen&quot;) {
                createSplashScreenContent();
                $(&#x27;.overlayOnRoot&#x27;).fadeOut();
            }

            if (name == &quot;Password Settings&quot;) {
                createPasswordSettingsContent();
            }

            else if (type == &quot;exhibition&quot;) {
                //$(&#x27;.overlayOnRoot&#x27;).fadeIn();

                exhibitionCount = exhibitionNumber;

                //setTimeout(function () {
                    createExhibitionContent(name);
                //}, 1);

                LADS.Worktop.Database.getDoqXML(exhibitionGuids[currentExhibitionNumber], function (xml) {
                    var parser = new DOMParser();
                    currentExhibitionXML = parser.parseFromString(xml, &#x27;text/xml&#x27;);
                });
                //$(&#x27;.overlayOnRoot&#x27;).fadeOut();
                
            }
            else if (type == &quot;Artworks&quot;) {
                createArtworkContent(artworkObj);
                currentArtwork = artworkObj;
                changeArtworkPreview();
            }
            else if (type === &quot;Tours&quot;) {
                // temp name hack
                for (var i = 0; i &lt; tourObjects.length; i++) {
                    if (tourObjects[i].Identifier == artworkObj.Identifier) {
                        currentTour = tourObjects[i]
                        break;
                    }
                }
                createTourContent();
                $(&#x27;.overlayOnRoot&#x27;).fadeOut();
            }
            //TODO: add other generators for content
            $(labelContainer).css({ &#x27;background-color&#x27;: &#x27;white&#x27; });
        };

        if (type == &#x27;Artworks&#x27;) {
            $(labelContainer).append(numExhibitionLabel);

            if (currentUploadedArtworkGuid == artworkObj.Identifier)
                $(labelContainer).click();

        }

        if (name == &quot;Splash Screen&quot; || (name == getExhibitions()[0] &amp;&amp; icon != &quot;search&quot;)) {
            //|| name == getArtworks()[0]
            $(labelContainer).click();
        }

        //increment the total number of exhibitions if we created a new exhibition
        if (type == &quot;exhibition&quot;) {
            exhibitionCount++;
        }

        // Return the labelContainer so it can be modified
        return labelContainer;
    }


    function createExhibitionContent() {
        createPreviewScreen(&#x27;Exhibitions&#x27;);
        createModifyContent();
        insertNameOfSetting();

        if (exhibitionCount == null)
            exhibitionCount = 0;

        var currentExhibit = exhibitions[exhibitionCount];
        insertSetting(&#x27;Exhibition Name&#x27;, &#x27;textarea&#x27;, null, currentExhibit.Name);
        insertSetting(&#x27;Subheading 1&#x27;, &#x27;textarea&#x27;, null, currentExhibit.Metadata.Subheading1);
        insertSetting(&#x27;Subheading 2&#x27;, &#x27;textarea&#x27;, null, currentExhibit.Metadata.Subheading2);
        insertSetting(&#x27;Exhibition Description&#x27;, &#x27;textarea&#x27;, null, currentExhibit.Metadata.Description);
        insertSetting(&#x27;Exhibition Background Image&#x27;, &#x27;file&#x27;, null, &#x27;Change Background Image&#x27;, &#x27;bgimage&#x27;);
        //insertSetting(&#x27;Exhibition Background Size&#x27;, &#x27;dropdown&#x27;, null, null, &#x27;bgimage&#x27;); // not hooked up to the server, disable for release
        insertSetting(&#x27;Exhibition Preview Image&#x27;, &#x27;file&#x27;, null, &#x27;Change Image&#x27;, &#x27;descriptionimg1&#x27;);
       // insertSetting(&#x27;Exhibition Description Image 2&#x27;, &#x27;file&#x27;, null, &#x27;Change Image&#x27;, &#x27;descriptionimg2&#x27;);


        //This section has only the real modifiers. It has not headers nor the save button. 
        $(rightSettingsEntries).attr(&#x27;id&#x27;, &#x27;pureSettings&#x27;);

        $(rightSettings).append(rightSettingsEntries);
        $(rightSection).append(rightSettings);

        $(rightSection).attr(&#x27;id&#x27;, &#x27;parentSetting&#x27;);


    }


    function createArtworkContent(artworkObj) {
        createPreviewScreen(&#x27;Artworks&#x27;);
        createModifyContent();
        insertNameOfSetting();
        insertSetting(&#x27;Title&#x27;, &#x27;blank&#x27;, null, artworkObj.Name);
        insertSetting(&#x27;Artist&#x27;, &#x27;blank&#x27;, null, artworkObj.Metadata.Artist);
        insertSetting(&#x27;Year&#x27;, &#x27;blank&#x27;, null, artworkObj.Metadata.Year);
        //insertSetting(&#x27;Medium&#x27;, &#x27;blank&#x27;, null, artworkObj.Metadata.Medium);
        //removing location because it now contains the json text for image locations and should not be displayed
        //insertSetting(&#x27;Location&#x27;, &#x27;blank&#x27;, null, artworkObj.Metadata.Location);
        //insertSetting(&#x27;Accession Number&#x27;, &#x27;blank&#x27;);

        var editExhibitionsLabel = document.createElement(&#x27;label&#x27;);
        $(editExhibitionsLabel).css({ &#x27;font-size&#x27;: &#x27;200%&#x27;, &#x27;color&#x27;: &#x27;black&#x27; });
        $(editExhibitionsLabel).text(&#x27;Exhibitions&#x27;);


        var editExhibitionsButton = document.createElement(&#x27;button&#x27;);
        $(editExhibitionsButton).css({ &#x27;border-color&#x27;: &#x27;black&#x27;, &#x27;color&#x27;: &#x27;black&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;left&#x27;: &#x27;5%&#x27; });
        $(editExhibitionsButton).text(&#x27;Add to Exhibition&#x27;);

        var editExhibitionsOverlay = LADS.Util.UI.blockInteractionOverlay();
        root.append(editExhibitionsOverlay);

        var editExhibitionsBox = document.createElement(&#x27;div&#x27;);

        $(editExhibitionsBox).addClass(&quot;editExhibitionsBox&quot;);
        $(editExhibitionsBox).css({
            &#x27;height&#x27;: &#x27;70%&#x27;,
            &#x27;width&#x27;: &#x27;30%&#x27;,
            &#x27;position&#x27;: &#x27;absolute&#x27;,
            &#x27;top&#x27;: &#x27;15%&#x27;,
            &#x27;left&#x27;: &#x27;34%&#x27;,
            &#x27;background-color&#x27;: &#x27;black&#x27;,
            &#x27;z-index&#x27;: &#x27;10000&#x27;,
            &#x27;border&#x27;: &#x27;3px double white&#x27;,
            &#x27;padding&#x27;: &#x27;1.5%&#x27;,
        });

        //sets minimum width of editexhibitionsbox
        if ($(root).width() * .3 &lt; 450) {
            $(editExhibitionsBox).css({ width: &#x27;450px&#x27;, });
        }

        var infoLabel = document.createElement(&#x27;div&#x27;);
        $(infoLabel).addClass(&quot;infoLabel&quot;);
        $(infoLabel).css({
            &#x27;width&#x27;: &#x27;100%&#x27;,
            &#x27;color&#x27;: &#x27;white&#x27;,
            &#x27;font-size&#x27;: &#x27;200%&#x27;,
            &#x27;margin-bottom&#x27;: &#x27;2%&#x27;
        });
        $(infoLabel).text(&#x27;Choose the exhibitions you wish to link this artwork to.&#x27;);

        var exhibitionsList = document.createElement(&#x27;div&#x27;);
        $(exhibitionsList).addClass(&quot;exhibitionsList&quot;);
        $(exhibitionsList).css({
            &#x27;width&#x27;: &#x27;100%&#x27;,
            &#x27;height&#x27; : &#x27;75%&#x27;,
            &#x27;overflow&#x27;: &#x27;auto&#x27;
        });

        function exhibitionPicker(artworkObj) {
            exhibitionByGuid;
            artworkObj;
            var xml = LADS.Worktop.Database.getDoqXML(currentArtwork.Identifier);
            var parser = new DOMParser();
            var artworkXML = parser.parseFromString(xml, &#x27;text/xml&#x27;);
            exhibitionCBArray = [];
            var currentExhibitions = [];
            var exhibitionLabelArray = [];

            for (var i = 0; i &lt; artworkXML.getElementsByTagName(&#x27;FolderId&#x27;).length; i++) {
                var exhib_id = artworkXML.getElementsByTagName(&#x27;FolderId&#x27;)[i].textContent;
                if (exhibitionByGuid[exhib_id] == undefined) {
                    artworkFolderId = exhib_id;
                } else {
                    currentExhibitions.push(exhib_id);
                }
            }

            for (var i = 0; i &lt; exhibitions.length; i++) {
                var exhibitionLabelWrapper = document.createElement(&#x27;div&#x27;);
                var exhibitionCB = document.createElement(&#x27;input&#x27;);
                exhibitionCB.type = &quot;checkbox&quot;;
                $(exhibitionCB).addClass(&quot;exhibitionCB&quot;);
                $(exhibitionCB).css({
                    float: &#x27;right&#x27;,
                    &#x27;margin-right&#x27;: &#x27;20px&#x27;,
                });
                exhibitionCB.name = &quot;exhibitions&quot;;
                exhibitionCB.value = exhibitions[i].Identifier;
                if (currentExhibitions.indexOf(exhibitionCB.value) &gt; -1) {
                    exhibitionCB.checked = true;
                };
                var exhibitionLabel = document.createElement(&#x27;div&#x27;);
                $(exhibitionLabel).css({
                    width: &#x27;80%&#x27;,
                    color: &#x27;white&#x27;,
                    &#x27;font-size&#x27;: &#x27;180%&#x27;,
                });
                $(exhibitionLabel).text(exhibitions[i].Name);
                var exhibitionObject = exhibitions[i];

                $(exhibitionLabelWrapper).append(exhibitionCB);
                $(exhibitionLabelWrapper).append(exhibitionLabel);
                exhibitionLabelArray.push(exhibitionLabelWrapper);
                exhibitionCBArray.push(exhibitionCB);
            }
            $(exhibitionsList).empty();
            for (var i = 0; i &lt; exhibitionLabelArray.length; i++) {
                $(exhibitionsList).append(exhibitionLabelArray[i]);
                $(exhibitionsList).append(&quot;&lt;hr&gt;&quot;);
            }
        }

        function readExhibitionCB() {
            var selectedExhibitions = [];
            for (var i = 0; i &lt; exhibitionCBArray.length; i++) {
                if (exhibitionCBArray[i].checked === true) {
                    selectedExhibitions.push(exhibitionCBArray[i].value);
                }
            }
            selectedExhibitions.push(artworkFolderId);
            return selectedExhibitions;
        }


        var confirmationButtonDiv = document.createElement(&#x27;div&#x27;);
        $(confirmationButtonDiv).addClass(&quot;confirmationButtonDiv&quot;);
        $(confirmationButtonDiv).css({
            &#x27;width&#x27;: &#x27;100%&#x27;,
            &#x27;height&#x27;: &#x27;10%&#x27;,
        });
        var saveConfirmationButton = document.createElement(&#x27;button&#x27;);
        $(saveConfirmationButton).addClass(&#x27;cancelConfirmationButton&#x27;);
        $(saveConfirmationButton).css({ &#x27;font-size&#x27;: &#x27;140%&#x27;, &#x27;margin-left&#x27;: &#x27;4%&#x27;, &#x27;float&#x27;: &#x27;right&#x27; });
        $(saveConfirmationButton).text(&#x27;Save&#x27;);
        var cancelConfirmationButton = document.createElement(&#x27;button&#x27;);
        $(cancelConfirmationButton).addClass(&#x27;cancelConfirmationButton&#x27;);
        $(cancelConfirmationButton).css({ &#x27;font-size&#x27;: &#x27;140%&#x27;, &#x27;margin-left&#x27;: &#x27;2%&#x27;, &#x27;float&#x27;: &#x27;right&#x27; });
        $(cancelConfirmationButton).text(&#x27;Cancel&#x27;);


        cancelConfirmationButton.onclick = function () {
            $(editExhibitionsOverlay).fadeOut();
            editExhibitionCurrentSelected = null;
            if (prevSelectedExhibition != null)
                $(prevSelectedExhibition).css({ &#x27;background-color&#x27;: &#x27;black&#x27;, &#x27;color&#x27;: &#x27;white&#x27; });

        }

        saveConfirmationButton.onclick = function () {

            $(editExhibitionsOverlay).fadeOut();
            // actually link the exhibitions
            var selectedExhibitions = readExhibitionCB();
            var creatorId = currentArtwork.CreatorID;

            var xml = LADS.Worktop.Database.getDoqXML(currentArtwork.Identifier);
            var parser = new DOMParser();
            var artworkXML = parser.parseFromString(xml, &#x27;text/xml&#x27;);
            //add artwork folder
            artworkXML.getElementsByTagName(&quot;_Folders&quot;)[0].childNodes[0].childNodes[0].textContent = creatorId;
            artworkXML.getElementsByTagName(&quot;_Folders&quot;)[0].childNodes[0].childNodes[1].textContent = selectedExhibitions[0];

            //delete old folders
            for (var i = 1; i &lt; artworkXML.getElementsByTagName(&quot;FolderData&quot;).length; i++) {
                var y = artworkXML.getElementsByTagName(&quot;FolderData&quot;)[i];
                artworkXML.getElementsByTagName(&quot;_Folders&quot;)[0].removeChild(y);
            }

            //add remaining exhibitions
            for (var i = 1; i &lt; selectedExhibitions.length; i++) {
                var node = artworkXML.getElementsByTagName(&quot;FolderData&quot;)[0];
                var newNode = node.cloneNode(true);
                //clones first node
                artworkXML.getElementsByTagName(&quot;_Folders&quot;)[0].appendChild(newNode);
                //edits info
                artworkXML.getElementsByTagName(&quot;_Folders&quot;)[0].childNodes[i].childNodes[0].textContent = creatorId;
                artworkXML.getElementsByTagName(&quot;_Folders&quot;)[0].childNodes[i].childNodes[1].textContent = selectedExhibitions[i];

            }

            //printExhibitions(artworkXML);

            LADS.Worktop.Database.pushXML(artworkXML, currentArtwork.Identifier, &quot;Artwork&quot;);
        }

        function printExhibitions(artxml) {
            for (var i = 0; i &lt; artxml.getElementsByTagName(&#x27;FolderId&#x27;).length; i++) {
                console.log(artxml.getElementsByTagName(&#x27;FolderId&#x27;)[i].textContent);
            }
        }

        $(confirmationButtonDiv).append(cancelConfirmationButton);
        $(confirmationButtonDiv).append(saveConfirmationButton);



        $(editExhibitionsBox).append(infoLabel);
        $(editExhibitionsBox).append(exhibitionsList);
        $(editExhibitionsBox).append(confirmationButtonDiv);


        $(editExhibitionsOverlay).append(editExhibitionsBox);

        editExhibitionsButton.onclick = function () {
            exhibitionPicker(currentArtwork);
            $(editExhibitionsOverlay).fadeToggle();
        };

        //This section has only the real modifiers. It has not headers nor the save button. 
        $(rightSettingsEntries).attr(&#x27;id&#x27;, &#x27;pureSettings&#x27;);
        $(rightSettingsEntries).css({
            &#x27;height&#x27;: &#x27;44.36%&#x27;,
            &#x27;margin-bottom&#x27;: &#x27;3%&#x27;
        });

        $(rightSettings).append(rightSettingsEntries);
        $(rightSettings).append(editExhibitionsLabel);
        $(rightSettings).append(editExhibitionsButton);

        $(rightSection).append(rightSettings);

    }

    function makeMiddleSection(type) {

        $(middleSection).css({ &#x27;width&#x27;: &#x27;25%&#x27;, &#x27;height&#x27;: &#x27;100%&#x27;, &#x27;z-index&#x27;: &#x27;100&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;left&#x27;: &#x27;0%&#x27;, &#x27;background-color&#x27;: &quot;rgb(219,217,204)&quot;, &#x27;float&#x27;: &#x27;left&#x27; });

        topMiddleLabelContainer = document.createElement(&#x27;div&#x27;);
        $(topMiddleLabelContainer).css({ &#x27;top&#x27;: &#x27;5%&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;width&#x27;: &#x27;100%&#x27;, &#x27;margin-bottom&#x27;: &#x27;0&#x27; });


        $(middeLabel).css({ &#x27;top&#x27;: &#x27;5%&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;float&#x27;: &#x27;left&#x27;, &#x27;left&#x27;: &#x27;10%&#x27;, &#x27;font-size&#x27;: &#x27;300%&#x27;, &#x27;color&#x27;: &#x27;black&#x27;, &#x27;width&#x27;: &#x27;100%&#x27;, &#x27;font-weight&#x27;: &#x27;500&#x27; });


        $(middeLabel).text(currentSetting);

        LADS.Util.fitText(middeLabel, 1.1);

        var newButton = $(document.createElement(&#x27;button&#x27;));
        newButton.css({ &#x27;float&#x27;: &#x27;left&#x27;, &#x27;color&#x27;: &#x27;black&#x27;, &#x27;border-color&#x27;: &#x27;black&#x27;, &#x27;min-width&#x27;: &#x27;15%&#x27;, &#x27;position&#x27;: &#x27;absolute&#x27;, &#x27;left&#x27;: &#x27;75%&#x27;, &#x27;margin-top&#x27;: &#x27;3.7%&#x27; });
        newButton.text(&#x27;New&#x27;);
        newButton.attr(&#x27;id&#x27;, &#x27;newButton&#x27;);

        newButton.click(function () {
            // Create new document
            //LADS.Worktop.Database.createNewExhibition(function () { reloadExhibitions(); });
            console.log(&quot;new button created&quot;);
            //createExhibitionContent();
        });

        var importNewButton = $(document.createElement(&#x27;button&#x27;));
        importNewButton.css({ &#x27;float&#x27;: &#x27;right&#x27;, &#x27;color&#x27;: &#x27;black&#x27;, &#x27;border-color&#x27;: &#x27;black&#x27;, &#x27;min-width&#x27;: &#x27;27%&#x27;, &#x27;position&#x27;: &#x27;absolute&#x27;, &#x27;left&#x27;: &#x27;65%&#x27;, &#x27;margin-top&#x27;: &#x27;3.7%&#x27; }); //left 67
        importNewButton.text(&#x27;Import New&#x27;);
        importNewButton.attr(&#x27;id&#x27;, &#x27;importNew&#x27;);

        // ARTWORK UPLOAD
        importNewButton.click(function () {
            var newName;
            LADS.Authoring.FileUploader(
                root,
                LADS.Authoring.FileUploadTypes.DeepZoom,
                // local callback - get filename
                function (file, localURL) {
                    newName = file.displayName;
                },
                // remote callback - save correct name
                function (url) {
                    $(&#x27;.overlayOnRoot&#x27;).show();
                    LADS.Worktop.Database.setArtworkDirty();
                    var check=0;
                    while (!check) {
                        console.log(&quot;checking for valid xml in file uploader response&quot;);
                        try {
                            newDoq = new Worktop.Doq(url);
                            check = 1;
                        }
                        catch (err) {
                            console.log(&quot;error in uploading, trying again: &quot; + err.message);
                        }
                    }
                    LADS.Worktop.Database.getDoqXML(newDoq.Identifier, function (xml) {
                        var parser = new DOMParser(),
                            artXML = $(parser.parseFromString(xml, &#x27;text/xml&#x27;));
                        artXML.find(&#x27;Name&#x27;).text(LADS.Util.encodeText(newName));
                        LADS.Worktop.Database.pushXML(artXML[0], newDoq.Identifier, &quot;Artwork&quot;,
                            function () {
                                reloadArtworks(function () {
                                    $(&#x27;.overlayOnRoot&#x27;).hide();
                                });
                            });
                    });
                },
                [&#x27;*&#x27;], // TODO: what image types does this take?
                false, // show thumbnails, this is artwork!
                null, // error callback
                true // multiple file upload enabled
                );
        });



        $(middleSettings).css({ &#x27;height&#x27;: &#x27;80.5%&#x27;, &#x27;width&#x27;: &#x27;100%&#x27;, &#x27;overflow-y&#x27;: &#x27;auto&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;top&#x27;: &#x27;6.5%&#x27; }); //top 4
        $(middleSettings).attr(&#x27;id&#x27;, &#x27;middleSettingsLabelContainer&#x27;);

        $(topMiddleLabelContainer).append(middeLabel);

        $(topMiddleLabelContainer).append(newButton);
        newButton.hide();
        $(topMiddleLabelContainer).append(importNewButton);

        LADS.Util.fitText(importNewButton, .6);

        importNewButton.hide();


        searchbar.onclick = function () {
            if ($(searchbar).text() == &#x27;Search&#x27;)
                $(searchbar).text(&#x27;&#x27;);
        };

        searchbar.onblur = function () {
            if ($(searchbar).text() == &#x27;&#x27;)
                $(searchbar).text(&#x27;Search&#x27;);
        };

        searchbar.onkeyup = function () {

            search();
            console.log(&quot;EMPTY SETTINGS D&quot;);
            $(middleSettings).empty();
            updateMiddlePanel(&#x27;Exhibitions&#x27;, &#x27;search&#x27;);
        };

        $(topMiddleLabelContainer).addClass(&#x27;topMiddleLabelContainer&#x27;);
        $(middleSettings).addClass(&#x27;middleSettings&#x27;);
        $(middleSection).addClass(&#x27;middleSettings&#x27;);
        $(middleSection).append(topMiddleLabelContainer);
        $(middleSection).append(middleSettings);
        mainPanel.append(middleSection);
    }


    //function that filters results based on the search bar content
    function search() {
        var itemsToSearch = exhibitionNames;
        exhibitionfilter = [];
        searchIndices = [];
        $.each(itemsToSearch, function (i) {
            if ((this.toLowerCase()).indexOf($(searchbar).text().toLowerCase()) != -1) {
                exhibitionfilter.push(this);
                searchIndices.push(i);
            }
        });

        //TODO: add artworks search
    }

    function createTourContent() {
        createPreviewScreen(&#x27;Tour&#x27;);
        createModifyContent();
        insertNameOfSetting();

        insertSetting(&#x27;Tour Name&#x27;, &#x27;textarea&#x27;, null, currentTour.Name);
        insertSetting(&#x27;Tour Description&#x27;, &#x27;textarea&#x27;, null, currentTour.Metadata.Description);

        $(rightSettings).append(rightSettingsEntries);
        $(rightSection).append(rightSettings);

        $(rightSection).attr(&#x27;id&#x27;, &#x27;parentSetting&#x27;);
    }

    function makeRightSection() {
        $(rightSection).css({ &#x27;width&#x27;: &#x27;50%&#x27;, &#x27;height&#x27;: &#x27;100%&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;left&#x27;: &#x27;0%&#x27;, &#x27;float&#x27;: &#x27;left&#x27; });
        $(rightSettings).css({ &#x27;height&#x27;: &#x27;50%&#x27;, &#x27;width&#x27;: &#x27;100%&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &quot;background-color&quot;: &quot;rgb(219,217,204)&quot;, &quot;left&quot;: &quot;5.5%&quot; });
        $(rightSettingsEntries).css({ &#x27;width&#x27;: &#x27;90%&#x27;, &#x27;height&#x27;: &#x27;61%&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;overflow&#x27;: &#x27;auto&#x27;, &#x27;top&#x27;: &#x27;4%&#x27; });
        mainPanel.append(rightSection);
    }

    //generates splash screen settings
    function createSplashScreenContent() {



        createPreviewScreen(null, function () {
            createModifyContent();
            insertNameOfSetting();
            insertSetting(&#x27;Background Image&#x27;, &#x27;file&#x27;, null, &#x27;Change Image&#x27;, &#x27;background&#x27;);
            //insertSetting(&#x27;Background Size&#x27;, &#x27;dropdown&#x27;, null, null, &#x27;background&#x27;); //not hooked up to the server, disable for release
            insertSetting(&#x27;Overlay Color&#x27;, &#x27;colorpicker&#x27;, null);
            insertSetting(&#x27;Overlay Transparency&#x27;, &#x27;number&#x27;, null, LADS.Worktop.Database.getOverlayTransparency(), &#x27;overlayTrans&#x27;);
            insertSetting(&#x27;Museum Name&#x27;, &#x27;textarea&#x27;, null, LADS.Worktop.Database.getMuseumName());
            insertSetting(&#x27;Museum Location&#x27;, &#x27;textarea&#x27;, null, LADS.Worktop.Database.getMuseumLoc());
            insertSetting(&#x27;Museum Info&#x27;, &#x27;textarea&#x27;, null, LADS.Worktop.Database.getMuseumInfo());
            insertSetting(&#x27;Museum Logo&#x27;, &#x27;file&#x27;, null, &#x27;Change Logo&#x27;, &#x27;logo&#x27;);
            insertSetting(&#x27;Museum Logo Background color&#x27;, &#x27;colorpicker&#x27;, null);

            //This section has only the real modifiers. It has not headers nor the save button. 
            $(rightSettingsEntries).attr(&#x27;id&#x27;, &#x27;pureSettings&#x27;);

            $(rightSettings).append(rightSettingsEntries);
            $(rightSection).append(rightSettings);
            if (backButtonType == &#x27;Artworks&#x27; || backButtonType == &#x27;Tours&#x27;) {
                backButtonType = null;
                settingsViewCallback(that);
            }
        });
    }

    function createPasswordSettingsContent() {
        
        passwordcontent = true;
        insertSetting(&#x27;&#x27;, &#x27;blank&#x27;, null);
        insertSetting(&#x27;&#x27;, &#x27;blank&#x27;, null);
        insertSetting(&#x27;&#x27;, &#x27;blank&#x27;, null);
        insertSetting(&#x27;&#x27;, &#x27;blank&#x27;, null);
        insertSetting(&#x27;Current password&#x27;, &#x27;password&#x27;, null);
        insertSetting(&#x27;New password&#x27;, &#x27;password&#x27;, null);
        insertSetting(&#x27;Confirm password&#x27;, &#x27;password&#x27;, null);
        $(rightSettingsEntries).css(&#x27;height&#x27;, &#x27;80%&#x27;);
        $(rightSettings).append(rightSettingsEntries);
        createModifyContent();
        $(rightSection).append(rightSettings);
        passwordcontent = false;
    }


    // RYAN - Moved into FileUploader
    function uploadFile(id, type) {
        //  var filePicker = new Windows.Storage.Pickers.FileOpenPicker();
        filePicker.fileTypeFilter.replaceAll([&quot;*&quot;]);

        filePicker.pickSingleFileAsync().then(function (file) {
            if (!file) {
                //printLog(&quot;No file selected&quot;);
                return;
            }

            var upload = new UploadOp();
            //  var uriString = document.getElementById(&quot;serverAddressField&quot;).value;
            //deep zoom creation

            if (type === &quot;Standard&quot;)
                var uriString = LADS.Worktop.Database.getURL() + &quot;/?Type=FileUpload&amp;Client=Windows&quot;;
            else if (type === &quot;Deepzoom&quot;)
                var uriString = LADS.Worktop.Database.getURL() + &quot;/?Type=FileUploadDeepzoom&amp;Client=Windows&amp;Guid=&quot; + LADS.Worktop.Database.getCreatorID();


            //var uriString = Worktop.Database.getURL() + &quot;/?Type=FileUpload&amp;Client=Windows&quot;;
            upload.start(uriString, file);

            // Store the upload operation in the uploadOps array.
            //    uploadOperations.push(upload);

            var objectUrl = window.URL.createObjectURL(file, { oneTimeOnly: true });

            if (id === &#x27;background&#x27; || id === &#x27;bgimage&#x27;) {
                //set background image and dropdown menu that selects background size
                $(&#x27;#&#x27; + id).css({
                    &#x27;background-image&#x27;: &#x27;url(&quot;&#x27; + objectUrl + &#x27;&quot;)&#x27;,
                    &#x27;background-size&#x27;: &#x27;cover&#x27;,
                });
                //related to background-size, disabled for release
                //$(&#x27;#select&#x27;)[0].selectedIndex = 0;
                //$(&#x27;#select&#x27;).change();
                if (id == &#x27;background&#x27;)
                    mainSettings[&quot;Background Image&quot;] = file.path;

            } else if (id == &#x27;logo&#x27;) {
                //set image source
                $(&#x27;#&#x27; + id)[0].src = objectUrl;
            }
        });

    }
    // RYAN - end of move




    /* 
    Generator for settings content.

    labelName: Name of the setting
    type: Chooses the type of setting
    clickFunction: function that activates onclick
    text: text that goes into buttons
    id: id of the element that will be manipulated (used for type == &#x27;file&#x27; or &#x27;dropdown&#x27;)

    */
    function insertSetting(labelName, type, clickFunction, text, id) {
        //This new variable give the settings section a new structure containing on the left side the lable and on the right the fields.
        var rightSettingsSection = document.createElement(&#x27;div&#x27;);
        $(rightSettingsSection).css({
            &#x27;width&#x27;: &#x27;100%&#x27;,
            &#x27;clear&#x27;: &#x27;both&#x27;,
            &#x27;margin-bottom&#x27;: &#x27;3%&#x27;,
            &#x27;float&#x27;: &#x27;left&#x27;
        });

        var label = document.createElement(&#x27;div&#x27;);
        $(rightSettingsSection).append(label);
        $(label).attr(&#x27;class&#x27;, &#x27;setting_name&#x27;);
        $(label).css({ &#x27;font-size&#x27;: &#x27;150%&#x27;, &#x27;float&#x27;: &#x27;left&#x27; });
        if (!passwordcontent) {
            $(label).css({ &#x27;font-style&#x27;: &#x27;italic&#x27;, &#x27;width&#x27;: &#x27;50%&#x27; });
        }
        else {
            $(label).css({ &#x27;width&#x27;: &#x27;35%&#x27; });
        }
        $(label).text(labelName);
        var itemContainer = document.createElement(&#x27;div&#x27;);

        $(itemContainer).css({&#x27;float&#x27;: &#x27;left&#x27; });
        if (!passwordcontent) {
            $(itemContainer).css({ &#x27;width&#x27;: &#x27;50%&#x27; });
        }
        else {
            $(itemContainer).css({ &#x27;width&#x27;: &#x27;65%&#x27; });
        }
        switch (type) {

            case &quot;file&quot;:

                var item = document.createElement(&#x27;div&#x27;);
                var selectButton = document.createElement(&#x27;button&#x27;);
                $(selectButton).text(text);
                $(selectButton).css({ &#x27;color&#x27;: &#x27;black&#x27;, &#x27;border-color&#x27;: &#x27;black&#x27;, &#x27;margin-left&#x27;: &#x27;4.5%&#x27; });

                $(item).append(selectButton);

                //add event listener for file event
                //file.onchange = handleFileSelect(id);
                selectButton.onclick = function () {
                    currentUpload = labelName;
                    uploadFile(id, &quot;Standard&quot;);
                };

                break;
            case &quot;dropdown&quot;:
                var item = document.createElement(&#x27;form&#x27;);
                $(item).css({ &#x27;width&#x27;: &#x27;60%&#x27; });
                var select = document.createElement(&#x27;select&#x27;);
                $(select).css({ &#x27;border-color&#x27;: &#x27;gray&#x27;, &#x27;color&#x27;: &#x27;gray&#x27; });
                $(select).attr(&#x27;id&#x27;, &#x27;select&#x27;);
                var optionArr = [&#x27;cover&#x27;, &#x27;100% 100%&#x27;, &#x27;contain&#x27;, &#x27;auto&#x27;];
                for (var i = 0, option; option = optionArr[i]; i++) {
                    opt = document.createElement(&#x27;option&#x27;);
                    $(opt).attr(&#x27;value&#x27;, option);
                    $(opt).html(option);
                    $(select).append(opt);
                }

                //add event listener for dropdown menu
                select.onchange = function () {
                    $(&#x27;#&#x27; + id).css(&#x27;background-size&#x27;, select.options[select.selectedIndex].text + &#x27;&#x27;);
                };
                $(item).append(select);
                break;
            case &quot;password&quot;:
                var item = document.createElement(&#x27;input&#x27;);
                $(item).attr(&#x27;type&#x27;, &quot;password&quot;);
                $(item).attr(&#x27;id&#x27;, labelName);
                $(item).css({ &#x27;border-color&#x27;: &#x27;gray&#x27;, &#x27;color&#x27;: &#x27;black&#x27;, &#x27;min-width&#x27;: &#x27;95%&#x27; });
                $(item).css({ &#x27;height&#x27;: &#x27;2px&#x27;});
                break;

            case &quot;textarea&quot;:
                var item = document.createElement(&#x27;textarea&#x27;);
                ////$(item).autoGrow();
                $(item).attr(&#x27;class&#x27;, &#x27;text_displayed&#x27;);
                $(item).css({ &#x27;border-color&#x27;: &#x27;gray&#x27;, &#x27;color&#x27;: &#x27;gray&#x27;, &#x27;min-width&#x27;: &#x27;80%&#x27;, &#x27;margin-left&#x27;:&#x27;4.5%&#x27; });
                $(item).text(text);

                if (labelName === &#x27;Museum Name&#x27;) {
                    //update museum name when typing
                    item.onkeyup = changeText(&#x27;museumName&#x27;, item);
                    $(item).attr(&#x27;maxlength&#x27;, 40);
                } else if (labelName === &#x27;Museum Location&#x27;) {
                    //update museum subtitle when typing
                    item.onkeyup = changeText(&#x27;subheading&#x27;, item);
                    $(item).attr(&#x27;maxlength&#x27;, 45);
                } else if (labelName === &#x27;Museum Info&#x27;) {
                    //update museum info when typing                    
                    item.onkeyup = changeText(&#x27;museumInfo&#x27;, item);
                    $(item).attr(&#x27;maxlength&#x27;, 1174, item);
                } else if (labelName === &#x27;Exhibition Name&#x27;) {
                    item.onkeyup = changeText(&#x27;exhibition-title&#x27;, item);
                    $(item).attr(&#x27;id&#x27;, &quot;exhibition-title-settings-editor&quot;);
                    $(item).attr(&#x27;maxlength&#x27;, 24);
                    var default_value = item.value;
                    $(item).focus(function () {
                        if (this.value == &quot;Exhibition&quot;) {
                            this.value = &#x27;&#x27;;
                        }
                    });
                    $(this).blur(function () {
                        if (this.value == &#x27;&#x27;) {
                            this.value = default_value;
                        }
                    });
                }
                else if (labelName === &#x27;Subheading 1&#x27;) {
                    item.onkeyup = changeText(&#x27;exhibition-subtitle-1&#x27;, item);
                    $(item).attr(&#x27;id&#x27;, &quot;exhibition-subtitle-1-settings-editor&quot;);
                    $(item).attr(&#x27;maxlength&#x27;, 53);
                    var default_value = item.value;
                    $(item).focus(function () {
                        if (this.value == &quot;First Subheading&quot;) {
                            this.value = &#x27;&#x27;;
                        }
                    });
                    $(this).blur(function () {
                        if (this.value == &#x27;&#x27;) {
                            this.value = default_value;
                        }
                    });
                }
                else if (labelName === &#x27;Subheading 2&#x27;) {
                    item.onkeyup = changeText(&#x27;exhibition-subtitle-2&#x27;, item);
                    $(item).attr(&#x27;id&#x27;, &quot;exhibition-subtitle-2-settings-editor&quot;);
                    $(item).attr(&#x27;maxlength&#x27;, 70);
                    var default_value = item.value;
                    $(item).focus(function () {
                        if (this.value == &quot;Second Subheading&quot;) {
                            this.value = &#x27;&#x27;;
                        }
                    });
                    $(this).blur(function () {
                        if (this.value == &#x27;&#x27;) {
                            this.value = default_value;
                        }
                    });
                }
                else if (labelName === &#x27;Exhibition Description&#x27;) {
                    item.onkeyup = changeText(&#x27;description-text&#x27;, item);
                    $(item).attr(&#x27;id&#x27;, &quot;description-text-settings-editor&quot;);
                    $(item).attr(&#x27;maxlength&#x27;, 1790);
                    $(item).focus(function () {
                        if (this.value == &quot;Description&quot;) {
                            this.value = &#x27;&#x27;;
                        }
                    });
                    $(this).blur(function () {
                        if (this.value == &#x27;&#x27;) {
                            this.value = default_value;
                        }
                    });
                } else if (labelName === &quot;Tour Name&quot;) {
                    $(item).attr(&#x27;maxlength&#x27;, 120);
                }
                // change text to default when no edition happened
                $(item).each(function () {
                    var default_value = this.value;
                    $(this).focus(function () {
                        if (this.value == &quot;Untitled Tour&quot;||this.value==&quot;Tour Description&quot;) {
                            this.value = &#x27;&#x27;;
                        }
                    });
                    $(this).blur(function () {
                        if (this.value == &#x27;&#x27;) {
                            this.value = default_value;
                        }
                    });
                });

                //This next part makes the size adapt to the size of the text inserted
                item.addEventListener(&#x27;DOMNodeInserted&#x27;, function () {
                        var realHeight = item.scrollHeight;
                        $(item).css(&#x27;height&#x27;, realHeight + &#x27;px&#x27;);
                        $(item).autoSize();
                     });
    
                break;
            case &quot;colorpicker&quot;:
                var item = document.createElement(&#x27;input&#x27;);
                $(item).attr(&#x27;class&#x27;, &#x27;color&#x27;);

                if (item.addEventListener) {
                    item.addEventListener(&#x27;DOMNodeInserted&#x27;, function () {

                        //initialize colorpicker object on current element
                        var myPicker = new jscolor.color(item, {});
                        if (labelName == &#x27;Overlay Color&#x27;) {
                            var infoDiv = $(&#x27;.infoDiv&#x27;);
                            if (infoDiv.length &gt; 0) {
                                //initialize colorpicker value to be the current background color of the overlay
                                var color = infoDiv.css(&#x27;background-color&#x27;);
                                var hex = LADS.Util.UI.colorToHex(color);
                                $(item).val(hex);
                                $(item).css(&#x27;margin-left&#x27;, &#x27;4.5%&#x27;);
                                myPicker.fromString(hex);

                                //set event handler to change overlay color as user manipulates the colorpicker
                                myPicker.onImmediateChange = function () { infoDiv.css(&#x27;background-color&#x27;, LADS.Util.UI.hexToRGB(item.value) + $(&#x27;#overlayTrans&#x27;).val() / 100.0 + &#x27;)&#x27;) };
                            } else {
                                console.log(&quot;$(&#x27;.infoDiv&#x27;) length = 0&quot;);
                            }

                            //change text to default value when no edition
                            $(&#x27;#overlayTrans&#x27;).each(function () {
                                var default_value = this.value;
                                $(this).focus(function () {
                                    if (this.value == default_value) {
                                        this.value = &#x27;&#x27;;
                                    }
                                });
                                $(this).blur(function () {
                                    if (this.value == &#x27;&#x27;) {
                                        this.value = default_value;
                                    }
                                });
                            });

                        } else if (labelName == &#x27;Museum Logo Background Color&#x27;) {
                            var logoContainer = $(&#x27;.logoContainer&#x27;);
                            if (logoContainer.length &gt; 0) {
                                //initialize colorpicker value to be the current background color of the museum logo
                                var color = $(&#x27;.logoContainer&#x27;).css(&#x27;background-color&#x27;);
                                var hex = LADS.Util.UI.colorToHex(color);
                                $(item).val(hex);
                                myPicker.fromString(hex);

                                //set event handler to change museum logo background color as user manipulates the colorpicker
                                myPicker.onImmediateChange = function () {
                                    $(&#x27;#logoContainer&#x27;).css(&#x27;background-color&#x27;, &#x27;#&#x27; + item.value);
                                };
                            } else {
                                console.log(&quot;$(&#x27;.logoContainer&#x27;) length = 0&quot;);
                            }
                        }
                    }, false);
                }

                break;
            case &quot;blank&quot;:
                var item = document.createElement(&#x27;p&#x27;);
                $(item).text(text);
                // $(item).attr(&#x27;id&#x27;, &#x27;slider&#x27;);
                $(item).css({
                    &#x27;font-size&#x27;: &#x27;135%&#x27;,
                    &#x27;word-wrap&#x27;: &#x27;break-word&#x27;,
                    &#x27;padding-right&#x27;: &#x27;4%&#x27;,
                    &#x27;margin&#x27;: &#x27;0%&#x27;
                });
                //if (item.addEventListener) {
                //     item.addEventListener(&#x27;DOMNodeInserted&#x27;, setSlider, false);
                // }

                break;
            case &quot;number&quot;:
                var item = document.createElement(&#x27;textarea&#x27;);
                //$(item).attr(&#x27;class&#x27;, &#x27;text_displayed&#x27;);
                $(item).attr(&#x27;id&#x27;, id);
                $(item).css({ &#x27;border-color&#x27;: &#x27;gray&#x27;, &#x27;margin-left&#x27;: &#x27;4.3%&#x27;, &#x27;color&#x27;: &#x27;gray&#x27;, &#x27;min-width&#x27;: &#x27;20%&#x27; });
                $(item).text(parseFloat(text) * 100);//(text)
                $(item).numeric();
                $(item).autoSize();
                item.onkeyup = function () {
                    var num = parseInt($(&#x27;#&#x27; + id).val());
                    num = (num &gt; 100) ? 100 : num;
                    num = (num &lt; 0) ? 0 : num;
                    if (!isNaN(num))
                        $(item).text(num);

                    var color = $(&#x27;.infoDiv&#x27;).css(&#x27;background-color&#x27;);
                    var idx = color.lastIndexOf(&#x27;,&#x27;) + 1;
                    alpha = color.substring(idx, color.lastIndexOf(&#x27;)&#x27;));

                    color = $(&#x27;.infoDiv&#x27;).css(&#x27;background-color&#x27;);
                    idx = color.lastIndexOf(&#x27;,&#x27;) + 1;
                    alpha = color.substring(idx, color.lastIndexOf(&#x27;)&#x27;));
                    $(&#x27;.infoDiv&#x27;).css(&#x27;background-color&#x27;, color.substring(0, idx) + num / 100.0 + &#x27;)&#x27;);
                }
                break;
                //doesn&#x27;t handle touch, useless
            case &quot;slider&quot;: //jquery UI slider
                var item = document.createElement(&#x27;div&#x27;);
                $(item).attr(&#x27;id&#x27;, &#x27;slider&#x27;);
                $(item).css({ &#x27;border-botton&#x27;: &#x27;5em&#x27;, &#x27;width&#x27;: &#x27;60%&#x27;, &#x27;float&#x27;: &#x27;left&#x27;, &#x27;top&#x27;: &#x27;30%&#x27; });
                if (item.addEventListener) {
                    item.addEventListener(&#x27;DOMNodeInserted&#x27;, setSlider, false);
                }

                //slider value display
                var display = document.createElement(&#x27;div&#x27;);
                $(display).css({ &#x27;width&#x27;: &#x27;10%&#x27;, &#x27;float&#x27;: &#x27;left&#x27;, &#x27;height&#x27;: &#x27;100%&#x27;, &#x27;margin-left&#x27;: &#x27;6%&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;top&#x27;: &#x27;17%&#x27;, &#x27;font-weight&#x27;: &#x27;bold&#x27; });

        }
        mainSettings[labelName] = item;

        $(itemContainer).append(item);
        $(rightSettingsSection).append(itemContainer);

        if (display != null) {
            $(itemContainer).append(display);
        }
        //At this point the larger div appends each new section.
        $(rightSettingsEntries).append(rightSettingsSection);

        //function that sets images
        function handleFileSelect(target) {

            //closure to get the event while keeping the parameters of this function
            return function (evt) {
                var files = evt.target.files; // FileList object

                // Loop through the FileList and render image files as thumbnails.
                for (var i = 0, f; f = files[i]; i++) {

                    // Only process image files.
                    if (!f.type.match(&#x27;image.*&#x27;)) {
                        continue;
                    }

                    var reader = new FileReader();
                    // Read in the image file as a data URL.
                    reader.readAsDataURL(f);

                    // Closure to capture the file information.
                    reader.onload = (function (theFile) {
                        return function (e) {
                            if (id == &#x27;background&#x27;) {
                                $(&#x27;#&#x27; + id).css({
                                    &#x27;background&#x27;: &#x27;url(&#x27; + e.target.result + &#x27;)&#x27;,
                                    width: &#x27;100%&#x27;,
                                });
                                //related to background-size, disabled for release
                                //$(&#x27;#select&#x27;)[0].selectedIndex = 0;
                                //$(&#x27;#select&#x27;).change();
                                mainSettings[&quot;Background Image&quot;] = e.target.result;
                            } else if (id == &#x27;logo&#x27;) {
                                $(&#x27;#&#x27; + id).attr(&#x27;src&#x27;, e.target.result);
                            }
                        };
                    })(f);
                }
            }
        }

        // function to initialize jquery ui slider within the settings page
        function setSlider() {
            $(item).ready(function () {
                var color = $(&#x27;.overlay&#x27;).css(&#x27;background-color&#x27;);
                var idx = color.lastIndexOf(&#x27;,&#x27;) + 1;
                alpha = color.substring(idx, color.lastIndexOf(&#x27;)&#x27;));
                $(item).slider({
                    min: 0,
                    max: 1,
                    step: 0.01,
                    value: alpha,
                    slide: function (event, ui) {
                        color = $(&#x27;.overlay&#x27;).css(&#x27;background-color&#x27;);
                        idx = color.lastIndexOf(&#x27;,&#x27;) + 1;
                        alpha = color.substring(idx, color.lastIndexOf(&#x27;)&#x27;));
                        $(&#x27;.overlay&#x27;).css(&#x27;background-color&#x27;, color.substring(0, idx) + ui.value + &#x27;)&#x27;);
                        $(display).html(Math.round(ui.value * 100) + &#x27;%&#x27;);
                    },
                    create: function (event, ui) {
                        $(display).html(Math.round(alpha * 100) + &#x27;%&#x27;);
                    }
                });
            });

        }

        //function that when bind to an event, changes the element with the specified id to have the same text as the element the event originated from
        var nameDivSize;
        var nameSpanSize;
        var fontSizeSpan;
        var fontSizeArray;
        var fontSize;
        var divHeight;
        var spanHeight;
        var spanScrollHeight;
        function changeText(id, item) {
            return function (evt) {

                $(&#x27;#&#x27; + id).html(evt.target.textContent.replace(/\n\r?/g, &#x27;&lt;br /&gt;&#x27;));
                if ($(item).attr(&#x27;maxlength&#x27;) == item.value.length) {
                    $(characterLimitLabel).show();
                    setTimeout(function () {
                        $(characterLimitLabel).hide();
                    }, 3000);
                }
                //write fittext constraints below for the individual elements

                switch (id) {
                    case &#x27;museumInfo&#x27;:
                        var subheadingFont = parseInt($(&#x27;#subheading&#x27;).css(&#x27;font-size&#x27;));
                        LADS.Util.UI.fitTextInDiv($(&#x27;#&#x27; + id), Math.round(subheadingFont * 2 / 3), Math.round(subheadingFont * 1 / 3));
                        break;



                    case &#x27;museumName&#x27;:

                        /*
                        fontSizeDiv = $(&#x27;#museumName&#x27;).css(&#x27;font-size&#x27;);
                        fontSizeDiv = fontSizeDiv[0].splice(2, 2);
                        fontSizeSpan = $(&#x27;#nameSpan&#x27;).css(&#x27;font-size&#x27;);*/
                        //$(museumNameSpan).css(&#x27;font-size&#x27;, nameDivSize + &#x27;px&#x27;);
                        fontSizeSpan = $(&#x27;#museumName&#x27;).css(&#x27;font-size&#x27;);
                        fontSizeArray = fontSizeSpan.split(&quot;px&quot;);
                        fontSize = fontSizeArray[0];
                        spanHeight = $(&#x27;#museumName&#x27;).height();
                        divHeight = $(&#x27;#divName&#x27;).height();
                        while (spanHeight &gt; divHeight) {
                            fontSize--;
                            $(&#x27;#museumName&#x27;).css(&#x27;font-size&#x27;, fontSize);
                            spanHeight = $(&#x27;#museumName&#x27;)[0].scrollHeight;
                        }

                        var subheadingFont = parseInt($(&#x27;#subheading&#x27;).css(&#x27;font-size&#x27;));
                        LADS.Util.UI.fitTextInDiv($(&#x27;#&#x27; + id), Math.round(subheadingFont * 5 / 3), Math.round(subheadingFont * 4 / 3));
                        break;
                }
            };
        }
    }

    // Changes the text of some element with id &#x27;id&#x27; to the value
    // of an input &#x27;item&#x27;.  Does no length checking (Used to update
    // the preview when the mode is changed).
    function changeTextSimple(id, item) {
        $(&#x27;#&#x27; + id).html(item.val().replace(/\n\r?/g, &#x27;&lt;br /&gt;&#x27;));
    }

    function logData(hex, rgb) {
        // $(&quot;#console&quot;).prepend(&#x27;HEX: &#x27; + hex + &#x27; (RGB: &#x27; + rgb.r + &#x27;, &#x27; + rgb.g + &#x27;, &#x27; + rgb.b + &#x27;)&lt;br /&gt;&#x27;);
    }


    //preview screen for the current settings mode
    function createPreviewScreen(type, callback) {
      /*  var previewLoading = $(document.createElement(&#x27;div&#x27;));
        $(previewLoading).addClass(&#x27;previewLoading&#x27;);
        $(previewLoading).css({
            &#x27;position&#x27;: &#x27;absolute&#x27;,
            &#x27;width&#x27;: &#x27;100%&#x27;,
            &#x27;height&#x27;: &#x27;54.36%&#x27;,
            &#x27;top&#x27;: &#x27;0px&#x27;,
            &#x27;left&#x27;: &#x27;0px&#x27;,
            &#x27;background-color&#x27;: &#x27;rgba(0,0,0,0.5)&#x27;,
            &#x27;display&#x27;: &#x27;none&#x27;
        });


        LADS.Util.showLoading($(previewLoading));
        $(rightSection).append(previewLoading);
        */
        var previewContainer = document.createElement(&#x27;div&#x27;);
        $(previewContainer).addClass(&#x27;previewContainer&#x27;);
        $(previewContainer).css({
            &#x27;position&#x27;: &#x27;relative&#x27;,
            &#x27;width&#x27;: &#x27;100%&#x27;,
            &#x27;height&#x27;: &#x27;54.36%&#x27;,
            &#x27;top&#x27;: &#x27;0%&#x27;,
            &#x27;background&#x27;: &#x27;no-repeat center / contain black&#x27;,

        });
        $(rightSection).append(previewContainer);



        //Splash screen preview
        if ($(middlePrevSelectedSetting).text() == &#x27;Splash Screen&#x27; || type == &quot;Exhibitions&quot;) {
            //get screen resolution
            var w = window, d = document, e = d.documentElement, g = d.getElementsByTagName(&#x27;body&#x27;)[0], x = w.innerWidth || e.clientWidth || g.clientWidth, y = w.innerHeight || e.clientHeight || g.clientHeight;
            var ratio = x / y;

            //create div to display the entire splash screen
            splashFrame = document.createElement(&#x27;div&#x27;);
            $(splashFrame).addClass(&#x27;splashFrame&#x27;);
            $(splashFrame).css({
                &#x27;height&#x27;: &#x27;100%&#x27;,
                &#x27;width&#x27;: &#x27;100%&#x27;,
                &#x27;position&#x27;: &#x27;absolute&#x27;,
                &#x27;color&#x27;: &#x27;white&#x27;, // This is hardcoded since the page does not inherent the color settings
                &#x27;font-size&#x27;: &#x27;6.5pt&#x27; // This is also hardcoded to make the font fit the screen
            });
            //$(splashFrame).attr(&#x27;disabled&#x27;, &#x27;true&#x27;);



            if ($(middlePrevSelectedSetting).text() == &#x27;Splash Screen&#x27;)
                // $(splashFrame).append((new LADS.Layout.StartPage()).getRoot());
                new LADS.Layout.StartPage(null, function (startPage) {

                    $(splashFrame).append(startPage.getRoot());
                    callback();
                });
            else if (type == &quot;Exhibitions&quot;) {

                if (searchIndices.length != 0) {
                    exhibitionCount = searchIndices[exhibitionCount];
                }
                currentExhibitionNumber = exhibitionCount;
                new LADS.Layout.Exhibitions(null, exhibitionsHelper);

                function exhibitionsHelper(exhibition) {
                    exhibition.clickExhibition(exhibitionCount);

                    $(splashFrame).append(exhibition.getRoot());

                    $(&#x27;.overlayOnRoot&#x27;).fadeOut();

                }


            }

            $(previewContainer).append(splashFrame);
            $(&#x27;.tour&#x27;).outerWidth(($(&#x27;.toursBar&#x27;).outerWidth() / 60 * 100) / 3);
            $(&#x27;.tourContent&#x27;).outerWidth($(&#x27;.tour&#x27;).outerWidth() * 5);

            //create transparent div over preview div to disable clicking
            var cover = document.createElement(&#x27;div&#x27;);
            $(cover).attr(&#x27;id&#x27;, &#x27;cover&#x27;);
            $(cover).css({
                &#x27;height&#x27;: &#x27;100%&#x27;,
                &#x27;width&#x27;: &#x27;100%&#x27;,
                &#x27;float&#x27;: &#x27;left&#x27;,
                &#x27;position&#x27;: &#x27;absolute&#x27;,
                &#x27;background-color&#x27;: &#x27;white&#x27;,
                &#x27;opacity&#x27;: &#x27;0&#x27;
            });
            $(cover).bind(&#x27;click&#x27;, function () { return false; });
            $(previewContainer).append(cover);
            /*$(previewContainer).ready(function () {
                $(splashFrame).css({ &#x27;height&#x27;: $(previewContainer).width() / ratio + &#x27;px&#x27; });
                console.log($(splashFrame).width());
            });*/
        }
        else if (type == &#x27;Tour&#x27;) {
            $(previewContainer).css({ &#x27;background-image&#x27;: &#x27;url(&#x27; + currentTour.Metadata.Thumbnail + &#x27;)&#x27; });
        }
    }


    // changes the preview scren 
    function changeArtworkPreview() {

        $(&#x27;.previewContainer&#x27;).empty();


        var imgLoading = $(document.createElement(&#x27;div&#x27;));
        $(imgLoading).addClass(&#x27;imgLoading&#x27;);
        $(imgLoading).css({
            &#x27;position&#x27;: &#x27;absolute&#x27;,
            &#x27;width&#x27;: &#x27;100%&#x27;,
            &#x27;height&#x27;: &#x27;54.36%&#x27;,
            &#x27;top&#x27;: &#x27;0px&#x27;,
            &#x27;left&#x27;: &#x27;0px&#x27;,
            &#x27;background-color&#x27;: &#x27;rgba(0,0,0,0.5)&#x27;,
        });


        LADS.Util.showLoading($(imgLoading));
        $(rightSection).append(imgLoading);
        var previewBackground = $(&#x27;&lt;img&gt;&#x27;).attr(&#x27;src&#x27;, currentArtwork.URL);
        previewBackground.load(function () {
            imgLoading.fadeOut();
            $(&#x27;.previewContainer&#x27;).css({ &#x27;background-image&#x27;: &#x27;url(&#x27; + currentArtwork.URL + &#x27;)&#x27; });
        });


        $(&#x27;.previewContainer&#x27;).show();

    }

    function passwordsettingChanges() {
        console.log(&quot;am saving the passwordddd&quot;);
    }

    function createModifyContent() {
        // save &amp; delete stuff including listeners

        var modifyButtonContainer = document.createElement(&#x27;div&#x27;);
        $(modifyButtonContainer).css({ &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;width&#x27;: &#x27;90%&#x27;, &#x27;height&#x27;: &#x27;10%&#x27;, &#x27;top&#x27;: &#x27;2%&#x27; });
        var saveDraftButton = document.createElement(&#x27;button&#x27;);
        $(saveDraftButton).text(&#x27;Save&#x27;);
        $(saveDraftButton).css({ &#x27;margin-right&#x27;: &#x27;2.5%&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;color&#x27;: &#x27;black&#x27;, &#x27;border-color&#x27;: &#x27;black&#x27;, &#x27;float&#x27;: &#x27;right&#x27; });

        var deleteButton = document.createElement(&#x27;button&#x27;);
        $(deleteButton).css({ &#x27;margin-right&#x27;: &#x27;3%&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;color&#x27;: &#x27;black&#x27;, &#x27;border-color&#x27;: &#x27;black&#x27;, &#x27;float&#x27;: &#x27;left&#x27; });
        $(deleteButton).text(&#x27;Delete&#x27;);

        var catalogModeViewButton = document.createElement(&#x27;button&#x27;);
        $(catalogModeViewButton).text(&#x27;View Catalog Mode&#x27;);
        $(catalogModeViewButton).css({ &#x27;margin-right&#x27;: &#x27;3%&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;color&#x27;: &#x27;black&#x27;, &#x27;border-color&#x27;: &#x27;black&#x27;, &#x27;float&#x27;: &#x27;left&#x27; });


        catalogModeViewButton.onclick = function () {


            if ($(catalogModeViewButton).text() == &#x27;View Exhibition Mode&#x27;) {
                $(splashFrame).empty();

                new LADS.Layout.Exhibitions(null, exhibitionsHelper);

                function exhibitionsHelper(exhibition) {
                    $(splashFrame).append(exhibition.getRoot());
                    exhibition.clickExhibition(exhibitionCount);


                    // Adjust the preview to match the entered text
                    changeTextSimple(&#x27;exhibition-title&#x27;, $(&#x27;#exhibition-title-settings-editor&#x27;));
                    changeTextSimple(&#x27;exhibition-subtitle-1&#x27;, $(&#x27;#exhibition-subtitle-1-settings-editor&#x27;));
                    changeTextSimple(&#x27;exhibition-subtitle-2&#x27;, $(&#x27;#exhibition-subtitle-2-settings-editor&#x27;));
                    changeTextSimple(&#x27;description-text&#x27;, $(&#x27;#description-text-settings-editor&#x27;));
                }

                $(catalogModeViewButton).text(&#x27;View Catalog Mode&#x27;);
            }
            else {
                var artworks = LADS.Worktop.Database.getArtworks(exhibitions[currentExhibitionNumber]);
                // if there is no artwork in the selected exhibition, alert user
                if (!artworks || !artworks[0]) {
                    var noArtworksOptionBox = LADS.Util.UI.makeNoArtworksOptionBox();
                    root.append(noArtworksOptionBox);
                    $(noArtworksOptionBox).fadeIn(500);
                    return;
                }
                $(splashFrame).empty();
                var catalogMode = new LADS.Layout.Catalog(exhibitions[currentExhibitionNumber]);
                $(splashFrame).append(catalogMode.getRoot());
                $(catalogModeViewButton).text(&#x27;View Exhibition Mode&#x27;);
            }
        }

        saveDraftButton.onclick = function () {
            //add action performed
            if (currentSetting == &quot;General Settings&quot;) {
                if ($(middlePrevSelectedSetting).text() == &#x27;Splash Screen&#x27;) {
                    pushMainChanges();
                }
                else {
                    passwordsettingChanges();
                }

            }
            else if (currentSetting == &quot;Exhibitions&quot;)
                pushExhibitionsSettings();
            else if (currentSetting == &quot;Tour Authoring&quot;) {
                $(&#x27;.overlayOnRoot&#x27;).fadeIn();
                pushTourSettings();
            }
        };

        deleteButton.onclick = function () {
            var currentExhibitionName = exhibitionNames[currentExhibitionNumber];
            var confirmationBox = LADS.Util.UI.PopUpConfirmation(function () {
                // actually delete the artwork
                $(&#x27;.overlayOnRoot&#x27;).show();
                LADS.Worktop.Database.deleteDoq(exhibitionGuids[exhibitionCount], &quot;Exhibition&quot;, function () {
                    reloadExhibitions(null, function () {
                        $(&#x27;.overlayOnRoot&#x27;).hide();
                    });
                });
            }, &quot;Are you sure you want to delete &quot; + currentExhibitionName + &quot;?&quot;, &quot;Delete&quot;);
            root.append(confirmationBox);
            $(confirmationBox).fadeIn(500);
        };

        if (currentSetting == &quot;Exhibitions&quot;) {
            $(modifyButtonContainer).append(saveDraftButton);
            $(modifyButtonContainer).append(deleteButton);
            $(modifyButtonContainer).append(catalogModeViewButton);

            $(rightSettings).append(modifyButtonContainer);
        }
        else if (currentSetting == &quot;General Settings&quot;) {
            if (passwordcontent) {
                $(rightSettingsEntries).append(saveDraftButton);
            } else {
                $(modifyButtonContainer).append(saveDraftButton);
                $(rightSettings).append(modifyButtonContainer);
            }
        }
        else if (currentSetting == &quot;Artworks&quot;) {

            var editArtworkInfoButton = document.createElement(&#x27;button&#x27;);
            $(editArtworkInfoButton).text(&#x27;Edit Artwork Info&#x27;);
            $(editArtworkInfoButton).css({ &#x27;border-color&#x27;: &#x27;black&#x27;, &#x27;top&#x27;: &#x27;2%&#x27;, &#x27;color&#x27;: &#x27;black&#x27;, &#x27;position&#x27;: &#x27;relative&#x27; });
            $(modifyButtonContainer).append(editArtworkInfoButton);

            var deleteArtworkButton = document.createElement(&#x27;button&#x27;);
            $(deleteArtworkButton).text(&#x27;Delete Artwork&#x27;);
            $(deleteArtworkButton).css({ &#x27;border-color&#x27;: &#x27;black&#x27;, &#x27;top&#x27;: &#x27;2%&#x27;, &#x27;color&#x27;: &#x27;black&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;left&#x27;: &#x27;3%&#x27; });
            $(modifyButtonContainer).append(deleteArtworkButton);


            $(rightSettings).append(modifyButtonContainer);

            editArtworkInfoButton.onclick = function () {
                LADS.Util.UI.slidePageLeft((new LADS.Layout.ArtworkEditor(currentArtwork)).getRoot());
            };

            deleteArtworkButton.onclick = function () {
                var confirmationBox = LADS.Util.UI.PopUpConfirmation(function () {
                    $(&#x27;.overlayOnRoot&#x27;).show();
                    LADS.Worktop.Database.deleteDoq(currentArtwork.Identifier, &quot;Artwork&quot;, function () {
                        reloadArtworks(function () {
                            $(&#x27;.overlayOnRoot&#x27;).hide();
                        });
                    });
                }, &quot;Are you sure you want to delete &quot;+currentArtwork.Name+&quot;?&quot;, &quot;Delete&quot;);

                root.append(confirmationBox);
                $(confirmationBox).fadeIn(500);
            };

        }
        else if (currentSetting == &quot;Tour Authoring&quot;) {
            $(modifyButtonContainer).append(saveDraftButton);

            var editTourButton = document.createElement(&#x27;button&#x27;);
            $(editTourButton).text(&#x27;Edit Tour&#x27;);
            $(editTourButton).css({ &#x27;border-color&#x27;: &#x27;black&#x27;, &#x27;top&#x27;: &#x27;2%&#x27;, &#x27;color&#x27;: &#x27;black&#x27;, &#x27;position&#x27;: &#x27;relative&#x27; });
            $(modifyButtonContainer).append(editTourButton);

            var deleteTourButton = document.createElement(&#x27;button&#x27;);
            $(deleteTourButton).text(&#x27;Delete Tour&#x27;);
            $(deleteTourButton).css({ &#x27;border-color&#x27;: &#x27;black&#x27;, &#x27;top&#x27;: &#x27;2%&#x27;, &#x27;color&#x27;: &#x27;black&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;left&#x27;: &#x27;3%&#x27; });
            $(modifyButtonContainer).append(deleteTourButton);


            $(rightSettings).append(modifyButtonContainer);

            $(rightSection).append(rightSettings);

            editTourButton.onclick = function () {
                LADS.Util.UI.slidePageLeft((new LADS.Layout.TourAuthoringNew(currentTour)).getRoot());
            };

            deleteTourButton.onclick = function () {
                var confirmationBox = LADS.Util.UI.PopUpConfirmation(function () {
                    $(&#x27;.overlayOnRoot&#x27;).fadeIn();
                    LADS.Worktop.Database.deleteDoq(currentTour.Identifier, &quot;Tour&quot;, function () {
                        refreshTours();
                    });
                }, &quot;Are you sure you want to delete &quot;+currentTour.Name+&quot;?&quot;, &quot;Delete&quot;);

                root.append(confirmationBox);
                $(confirmationBox).fadeIn(500);
            };


        }
    }

    function refreshTours(toselect) {
        getTours(function (tours) {
            console.log(&quot;EMPTY SETTINGS E&quot;);
            $(middleSettings).empty();
            var i = 0;
            $.each(tours, function () {
                createMiddleLabel(this + &quot;&quot;, &quot;Tours&quot;, &quot;&quot;, &quot;&quot;, tourObjects[i]);
                i++;
            });

            if (tourObjects[0])
                selectTourByGuid(tourObjects[0].Identifier);
            if (toselect)
                selectTourByGuid(toselect.Identifier);
            $(&#x27;.overlayOnRoot&#x27;).fadeOut();
        });
    }


    function insertNameOfSetting() {
        var settingsLabelDiv = document.createElement(&#x27;div&#x27;);
        $(settingsLabelDiv).css({ &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;width&#x27;: &#x27;90%&#x27;, &#x27;height&#x27;: &#x27;10%&#x27;, &#x27;top&#x27;: &#x27;4%&#x27;, &#x27;margin-bottom&#x27;: &#x27;4%&#x27; });

        characterLimitLabel = document.createElement(&#x27;label&#x27;);
        $(characterLimitLabel).text(&#x27; You have reached the limit of available characters&#x27;);
        $(characterLimitLabel).css({ &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;font-size&#x27;: getFontSize(150), &#x27;color&#x27;: &#x27;black&#x27;, &#x27;font-style&#x27;: &#x27;italic&#x27; });
        $(characterLimitLabel).hide();

        var settingsLabel = document.createElement(&#x27;label&#x27;);
        $(settingsLabel).css({ &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;font-size&#x27;: &#x27;130%&#x27;, &#x27;font-weight&#x27;: &#x27;bold&#x27;});
        $(settingsLabel).text($(middlePrevSelectedSettingText).text());
        $(settingsLabelDiv).append(settingsLabel);
        $(settingsLabelDiv).append(characterLimitLabel);
        $(rightSettings).append(settingsLabelDiv);
        //The following div modifis the background image, it continas all the setting options. Including labels and &quot;save&quot; button

        $(rightSettings).attr(&#x27;id&#x27;, &#x27;settingDiv&#x27;);
    }


    function createTopBar(topbarHeight) {
        // style the topbar
        topbar.css(&quot;background-color&quot;, &quot;rgb(63,55,53)&quot;);
        topbar.css(&quot;color&quot;, &quot;rgb(175,200,178)&quot;);
        topbar.css(&quot;width&quot;, &#x27;100%&#x27;);
        topbar.css(&#x27;height&#x27;, topbarHeight + &#x27;%&#x27;);

        // add the back button
        var backButtonArea = $(document.createElement(&#x27;div&#x27;));
        backButtonArea.css({ &quot;top&quot;: &quot;20%&quot;, &#x27;left&#x27;: &#x27;1%&#x27;, &quot;width&quot;: &quot;5%&quot;, &quot;position&quot;: &quot;relative&quot;, &quot;float&quot;: &quot;left&quot; });

        var backButton = document.createElement(&#x27;img&#x27;);
        $(backButton).attr(&#x27;src&#x27;, &#x27;images/icons/Back.svg&#x27;);
        //$(backButton).css({ &#x27;left&#x27;: &#x27;1%&#x27;, &#x27;top&#x27;: &#x27;10%&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;float&#x27;: &#x27;left&#x27; });
        $(backButton).css({ &#x27;width&#x27;: &#x27;58%&#x27;, &#x27;height&#x27;: &#x27;58%&#x27; });
        $(backButtonArea).append(backButton);
        $(topbar).append(backButtonArea);


        backButton.onmousedown = function () {
            LADS.Util.UI.cgBackColor(&quot;backButton&quot;, backButton, false);
        }

        backButton.onmouseleave = function () {
            LADS.Util.UI.cgBackColor(&quot;backButton&quot;, backButton, true);
        }

        backButton.onclick = function () {
            //$(&quot;.inkCanv&quot;).remove();
            //$(&quot;.rinInkContainer&quot;).remove();
            var startPage = new LADS.Layout.StartPage();
            LADS.Util.UI.slidePageRight(startPage.getRoot());
        };

        changesSavedLabel = document.createElement(&#x27;label&#x27;);
        $(changesSavedLabel).text(&#x27;All Changes Saved&#x27;);
        $(changesSavedLabel).css({ &#x27;left&#x27;: &#x27;70%&#x27;, &#x27;top&#x27;: &#x27;15%&#x27;, &#x27;position&#x27;: &#x27;relative&#x27;, &#x27;font-size&#x27;: getFontSize(120), &#x27;color&#x27;: &#x27;white&#x27;, &#x27;font-style&#x27;: &#x27;italic&#x27; });
        $(topbar).append(changesSavedLabel);
        $(changesSavedLabel).hide();

        var titleLabel = document.createElement(&#x27;label&#x27;);
        $(titleLabel).text(&#x27;Authoring Mode&#x27;);
        $(titleLabel).css({
            &#x27;right&#x27;: &#x27;2%&#x27;,
            &#x27;top&#x27;: &#x27;1.5%&#x27;,
            &#x27;position&#x27;: &#x27;absolute&#x27;,
            &#x27;font-size&#x27;: getFontSize(260),
            &#x27;color&#x27;: &#x27;white&#x27;
        });
        $(topbar).append(titleLabel);

    }



    function getFontSize(factor) {
        return factor * (screen.width / 1920) + &#x27;%&#x27;;
    }


    function getGeneralSettingsOptions() {
        //var generalSettings = [&quot;Splash Screen&quot;, &quot;Artwork Mode&quot;, &quot;Catalog Mode&quot;];
        var generalSettings = [&quot;Splash Screen&quot;, &quot;Password Settings&quot;];
        return generalSettings;
    }

    // returns the filtered list of exhbitions if the value of the filtered list is not null.
    // else, it returns the entire list of exhibitions
    function getExhibitions() {
        if (exhibitionfilter)
            return exhibitionfilter;
        else
            return exhibitionNames;
    }




    function getTours(callback) {
        // call server to get current tours
        //var tours = [&quot;Tour 1&quot;, &quot;Tour 2&quot;, &quot;Tour 3&quot;];
        //LADS.Worktop.Database.createTour();
        var tours = [];
        LADS.Worktop.Database.getAllTours(function (localTourObjects) {
            tourObjects = localTourObjects;
            for (var i = 0; i &lt; tourObjects.length; i++) {
                tours.push(tourObjects[i].Name);
            }
            callback(tours);
        });
    }

    /* This method is called to get the home page document in XML form */
    function getMainDoq() {
        var mainGuid = LADS.Worktop.Database.getMainGuid();
        var xml = LADS.Worktop.Database.getXML(mainGuid);
        var parser = new DOMParser();
        mainDoq = parser.parseFromString(xml, &#x27;text/xml&#x27;);
    }

    /* 
     * Gets all the values from the textfields/buttons, changes them in the local xml, 
     * and finally pushes them to the server using the pushes them to the server using 
     * pushXML(...) method in the LADS.Worktop.Database class
     */
    function pushMainChanges() {
        //setMainBackgroundImage(&#x27;http://www.kurzweilai.net/images/Google-logo.jpg&#x27;);
        setMuseumName(LADS.Util.encodeText(mainSettings[&quot;Museum Name&quot;].textContent));
        setMuseumLocation(LADS.Util.encodeText(mainSettings[&quot;Museum Location&quot;].textContent));
        setMuseumInfo(LADS.Util.encodeText(mainSettings[&quot;Museum Info&quot;].textContent));
        setOverlayColor(&#x27;#&#x27; + mainSettings[&quot;Overlay Color&quot;].value);
        setOverlayTransparency(mainSettings[&quot;Overlay Transparency&quot;].value / 100.0);
        setIconColor(&#x27;#&#x27; + mainSettings[&#x27;Museum Logo Background color&#x27;].value);

        //addMetadataToXML(mainDoq, &quot;this is the key&quot;, &quot;this is the value&quot;);

        LADS.Worktop.Database.pushXML(mainDoq, LADS.Worktop.Database.getMainGuid());

        $(changesSavedLabel).text(&#x27;Main Changes Saved&#x27;);
        $(changesSavedLabel).show();

        setTimeout(function () {
            $(changesSavedLabel).hide();
        }, 3000);
    }

    /* 
     * This method parses the Metadata fields and then checks whether the required metadata
     * field matches up with the one currently being looked at. Once it has found a match, it
     * returns the appropriate node corresponding to the field.
     */
    function getFieldValueFromMetadata(xml, field) {
        var metadata = getMetaData(xml);
        for (var i = 0; i &lt; metadata.length; i++) {
            if (metadata[i].childNodes[0].textContent == field) {
                return metadata[i].childNodes[1].childNodes[0];
            }
        }
    }

    // returns the GUID of a given XML
    function getDoqIdentifier(xml) {
        return xml.getElementsByTagName(&quot;Identifier&quot;)[0].childNodes[0].data;
    }

    // this collection of methods sets the named field in the local xml
    function setMainBackgroundImage(url) {
        if (url)
            getFieldValueFromMetadata(mainDoq, &quot;BackgroundImage&quot;).data = url;
    }




    function setIcon(url) {
        if (url)
            getFieldValueFromMetadata(mainDoq, &quot;Icon&quot;).data = url;
    }

    function setIconColor(color) {
        if (color)
            getFieldValueFromMetadata(mainDoq, &quot;IconColor&quot;).data = color;
    }

    function setMuseumName(name) {
        if (name &amp;&amp; name.length &gt; 0)
            getFieldValueFromMetadata(mainDoq, &quot;MuseumName&quot;).data = name;
    }

    function setMuseumLocation(loc) {
        if (loc &amp;&amp; loc.length &gt; 0)
            getFieldValueFromMetadata(mainDoq, &quot;MuseumLoc&quot;).data = loc;
    }

    function setMuseumInfo(info) {
        if (info &amp;&amp; info.length &gt; 0)
            getFieldValueFromMetadata(mainDoq, &quot;MuseumInfo&quot;).data = info;
    }

    function setOverlayColor(color) {
        if (color &amp;&amp; color.length &gt; 0)
            getFieldValueFromMetadata(mainDoq, &quot;OverlayColor&quot;).data = color;
    }

    function setOverlayTransparency(a) {
        getFieldValueFromMetadata(mainDoq, &quot;OverlayTransparency&quot;).data = a;
    }

    function getMetaData(doq) {
        return doq.getElementsByTagName(&quot;Metadata&quot;)[0].childNodes[0].childNodes[0].childNodes[1].childNodes[0].childNodes;
    }

    function addMetadataToXML(xml, key, value) {
        var dictsNode = xml.childNodes[0].childNodes[3].childNodes[0].childNodes[0].childNodes[1].childNodes[0];
        dictsNode.appendChild(xml.createElement(&quot;d3p1:KeyValueOfstringanyType&quot;));
        dictsNode.getElementsByTagName(&quot;d3p1:KeyValueOfstringanyType&quot;)[dictsNode.childElementCount - 1].appendChild(xml.createElement(&quot;d3p1:Key&quot;));
        dictsNode.getElementsByTagName(&quot;d3p1:KeyValueOfstringanyType&quot;)[dictsNode.childElementCount - 1].getElementsByTagName(&quot;d3p1:Key&quot;)[0].textContent = key;
        dictsNode.getElementsByTagName(&quot;d3p1:KeyValueOfstringanyType&quot;)[dictsNode.childElementCount - 1].appendChild(xml.createElement(&quot;d3p1:Value&quot;));

        dictsNode.getElementsByTagName(&quot;d3p1:KeyValueOfstringanyType&quot;)[dictsNode.childElementCount - 1].getElementsByTagName(&quot;d3p1:Value&quot;)[0].textContent = value;
        dictsNode.getElementsByTagName(&quot;d3p1:KeyValueOfstringanyType&quot;)[dictsNode.childElementCount - 1].getElementsByTagName(&quot;d3p1:Value&quot;)[0].setAttribute(&quot;xmlns:d8p1&quot;, &quot;http://www.w3.org/2001/XMLSchema&quot;);
        dictsNode.getElementsByTagName(&quot;d3p1:KeyValueOfstringanyType&quot;)[dictsNode.childElementCount - 1].getElementsByTagName(&quot;d3p1:Value&quot;)[0].setAttribute(&quot;i:type&quot;, &quot;d8p1:string&quot;);

    }

    function pushTourSettings() {
        //modify/update the tour
        LADS.Worktop.Database.getDoqXML(currentTour.Identifier, function (xml) {
            var parser = new DOMParser();
            var tourXML = $(parser.parseFromString(xml, &#x27;text/xml&#x27;));

            var name = mainSettings[&quot;Tour Name&quot;].textContent;
            if (name.lastIndexOf(&#x27; &#x27;, 0) === 0 || name.lastIndexOf(&#x27;\n&#x27;, 0) === 0) {
                mainSettings[&quot;Tour Name&quot;].textContent = tourXML.find(&#x27;Name&#x27;).text();
                $(&#x27;.overlayOnRoot&#x27;).hide();
                var messageBox = LADS.Util.UI.popUpMessage(null, &quot;Tour Name cannot start with a space or new line.&quot;, null);
                $(messageBox).css(&#x27;z-index&#x27;, LADS.TourAuthoring.Constants.aboveRinZIndex + 7);
                $(root).append(messageBox);
                $(messageBox).fadeIn(500);
                return;
            }

            //change name
            tourXML.find(&#x27;Name&#x27;).text(LADS.Util.encodeText(name));
            //change content, the json object
            tourXML.find(&quot;d3p1\\:Key:contains(&#x27;Description&#x27;) + d3p1\\:Value&quot;).text(LADS.Util.encodeText(mainSettings[&quot;Tour Description&quot;].textContent));
            LADS.Worktop.Database.pushXML(tourXML[0], currentTour.Identifier, &quot;Tour&quot;, function () {
                refreshTours(currentTour);
            });
        });
    }

    function pushExhibitionsSettings() {
        setExhibitionName(LADS.Util.encodeText(mainSettings[&quot;Exhibition Name&quot;].textContent));
        setExhibitionSubheading1(LADS.Util.encodeText(mainSettings[&quot;Subheading 1&quot;].textContent));
        setExhibitionSubheading2(LADS.Util.encodeText(mainSettings[&quot;Subheading 2&quot;].textContent));
        setExhibitionDescription(LADS.Util.encodeText(mainSettings[&quot;Exhibition Description&quot;].textContent));

        // addMetadataToXML(currentExhibitionXML, &quot;dasdasd&quot;, &quot;dasdasdas&quot;);
        $(&#x27;.overlayOnRoot&#x27;).show();
        LADS.Worktop.Database.pushXML(currentExhibitionXML, exhibitionGuids[currentExhibitionNumber], &quot;Exhibitions&quot;, function () {
            reloadExhibitions(mainSettings[&quot;Exhibition Name&quot;].textContent, function () {
                $(&#x27;.overlayOnRoot&#x27;).hide();
            });
        });



        $(changesSavedLabel).text(&#x27;Exhibition Changes Saved&#x27;);
        $(changesSavedLabel).show();

        setTimeout(function () {
            $(changesSavedLabel).hide();
        }, 3000);

    }


    function setExhibitionName(name) {
        if (name &amp;&amp; name.length &gt; 0)
            currentExhibitionXML.getElementsByTagName(&quot;Name&quot;)[0].childNodes[0].data = name;
    }

    function setExhibitionSubheading1(subheading) {
        if (subheading &amp;&amp; subheading.length &gt; 0)
            getFieldValueFromMetadata(currentExhibitionXML, &quot;Subheading1&quot;).data = subheading;
    }

    function setExhibitionSubheading2(subheading) {
        if (subheading &amp;&amp; subheading.length &gt; 0)
            getFieldValueFromMetadata(currentExhibitionXML, &quot;Subheading2&quot;).data = subheading;

    }

    function setExhibitionDescription(description) {
        if (description &amp;&amp; description.length &gt; 0)
            getFieldValueFromMetadata(currentExhibitionXML, &quot;Description&quot;).data = description;

    }

    function setExhibitionBackgroundImage(url) {
        if (url &amp;&amp; url.length &gt; 0)
            getFieldValueFromMetadata(currentExhibitionXML, &quot;BackgroundImage&quot;).data = url;

    }

    function getExhibitionMetaData(exhibition) {
        return exhibition.getElementsByTagName(&quot;Metadata&quot;)[0].childNodes[0].childNodes[0].childNodes[1].childNodes[0].childNodes;
    }

    function setExhibitionDescriptionImage1(url) {
        if (url)
            getFieldValueFromMetadata(currentExhibitionXML, &quot;DescriptionImage1&quot;).data = url;
    }

    function setExhibitionDescriptionImage2(url) {
        if (url)
            getFieldValueFromMetadata(currentExhibitionXML, &quot;DescriptionImage2&quot;).data = url;
    }

    function reloadExhibitions(toSelect, callback) {
        console.log(&quot;RELOAD EXHIBITIONS CALLED&quot;);
        if (callback) {
            LADS.Worktop.Database.getExhibitions(function (result) {
                console.log(result.length);
                exhibitions = result;
                exhibitions.sort(function (a, b) {
                    if (a.Name &lt; b.Name) {
                        return -1;
                    } else if (a.Name &gt; b.Name) {
                        return 1;
                    } else {
                        return 0;
                    }
                });
                console.log(&quot;EMPTY SETTINGS F&quot;);
                $(middleSettings).empty();
                exhibitionCount = 0;
                exhibitionNames = [];
                exhibitionGuids = [];

                for (var i = 0; i &lt; exhibitions.length; i++) {
                    exhibitionByGuid[exhibitions[i].Identifier] = exhibitions[i];
                    exhibitionNames.push(exhibitions[i].Name);
                    exhibitionGuids.push(exhibitions[i].Identifier);
                }

                $.each(exhibitionNames, function () {
                    createMiddleLabel(this + &quot;&quot;, &quot;exhibition&quot;);
                });

                if (toSelect) {
                    selectItemByName(toSelect);
                }
                callback();
            });
        } else {
            exhibitions = LADS.Worktop.Database.getExhibitions();
            exhibitions.sort(function (a, b) {
                if (a.Name &lt; b.Name) {
                    return -1;
                } else if (a.Name &gt; b.Name) {
                    return 1;
                } else {
                    return 0;
                }
            });
            console.log(&quot;EMPTY SETTINGS G&quot;);
            $(middleSettings).empty();
            exhibitionCount = 0;
            exhibitionNames = [];
            exhibitionGuids = [];

            for (var i = 0; i &lt; exhibitions.length; i++) {
                exhibitionByGuid[exhibitions[i].Identifier] = exhibitions[i];
                exhibitionNames.push(exhibitions[i].Name);
                exhibitionGuids.push(exhibitions[i].Identifier);
            }

            $.each(exhibitionNames, function () {
                createMiddleLabel(this + &quot;&quot;, &quot;exhibition&quot;);
            });

            if (toSelect) {
                selectItemByName(toSelect);
            }
        }
    }

    function reloadArtworks(callback) {

        LADS.Worktop.Database.getAllArtworks(function (artworks) {
            artworksList = artworks;
            if (artworksList[0]) {
                artworksList.sort(function (a, b) {
                    if (a.Name &lt; b.Name) {
                        return -1;
                    } else if (a.Name &gt; b.Name) {
                        return 1;
                    } else {
                        return 0;
                    }
                });
            }
            console.log(&quot;EMPTY SETTINGS H&quot;);
            $(middleSettings).empty();
            var entries = [];
            var type = [];
            var icons = [];
            var artworkGuids = [];
            var isFirst = false;
            for (var i = 0; i &lt; artworksList.length; i++) {
                // if (i == 0)
                //    currentUploadedArtworkGuid = artworksList[i].Identifier;
                //      isFirst = true;
                //  else
                //      isFirst = false;

                entries.push(artworksList[i].Name);
                icons.push(artworksList[i].Metadata.Thumbnail);
                artworkGuids.push(artworksList[i].Identifier);
            }

            var i = 0;
            $.each(entries, function () {
                var label = createMiddleLabel(this + &quot;&quot;, &quot;Artworks&quot;, icons[i], artworkExhibition[artworkGuids[i]], artworksList[i], isFirst);
                $(label).attr(&#x27;id&#x27;, &#x27;artworks-&#x27; + artworkGuids[i]);
                i++;
            });
            if (callback)
                callback();
        });


    }


    // RYAN - Moved into FileUploader, to use in settings view need to rewrite giant &quot;if&quot;-branch in terms of callbacks from individual sections!
    function UploadOp() {
        var upload = null;
        var promise = null;

        this.start = function (uriString, file) {
            try {
                uploadingOverlay.show();

                var uri = new Windows.Foundation.Uri(uriString);
                var uploader = new Windows.Networking.BackgroundTransfer.BackgroundUploader();

                // Set a header, so the server can save the file (this is specific to the sample server).
                uploader.setRequestHeader(&quot;Filename&quot;, file.name);
                uploader.setRequestHeader(&quot;Content-Type&quot;, &quot;multipart/form-data; boundary=----WebKitFormBoundaryqj1e7E6nvkEBR9N5&quot;);

                // Create a new upload operation.
                upload = uploader.createUpload(uri, file);

                // Start the upload and persist the promise to be able to cancel the upload.
                promise = upload.startAsync().then(complete, error, progress);
            } catch (err) {
                displayError(err);
            }
        };
        // On application activation, reassign callbacks for a upload
        // operation persisted from previous application state.
        this.load = function (loadedUpload) {
            try {
                upload = loadedUpload;
                promise = upload.attachAsync().then(complete, error, progress(upload));
            } catch (err) {
                displayError(err);
            }
        };
    }

    function complete(uploadOperation) {

        var response = uploadOperation.getResponseInformation();
        var iInputStream = uploadOperation.getResultStreamAt(0);
        var dataReader = new Windows.Storage.Streams.DataReader(iInputStream);
        var loadop = dataReader.loadAsync(10000000);
        //var status = loadop.status;
        loadop.operation.completed = function () {
            $(innerProgressBar).width(100 + &quot;%&quot;);

            var dataReaderLoad = dataReader.readString(dataReader.unconsumedBufferLength);

            dataReaderLoad = $.trim(dataReaderLoad);

            //who wrote this? it&#x27;s never used and breaks!! (only works with Deepzoom response)
            //var currentUploadedArtwork = new Worktop.Doq(dataReaderLoad);
            //var currentUploadedArtworkGuid = currentUploadedArtwork.Identifier;

            //resetting the progress bar
            if (currentUpload == &quot;Background Image&quot;) {
                setMainBackgroundImage(dataReaderLoad);
            }
            else if (currentUpload == &quot;Museum Logo&quot;) {
                setIcon(dataReaderLoad);
            }
            else if (currentUpload == &quot;Exhibition Background Image&quot;) {
                setExhibitionBackgroundImage(dataReaderLoad);
            }
            else if (currentUpload == &quot;Artwork&quot;) {
                LADS.Worktop.Database.setArtworkDirty();
                $(&#x27;.overlayOnRoot&#x27;).show();
                reloadArtworks(function () {
                    $(&#x27;.overlayOnRoot&#x27;).hide();
                });
            }
            else if (currentUpload == &quot;Exhibition Preview Image&quot;) {
                $(&#x27;#img1&#x27;).attr(&#x27;src&#x27;, dataReaderLoad);
                setExhibitionDescriptionImage1(dataReaderLoad);
            }
            else if (currentUpload == &quot;Exhibition Description Image 2&quot;) {
                $(&#x27;#img2&#x27;).attr(&#x27;src&#x27;, dataReaderLoad);
                setExhibitionDescriptionImage2(dataReaderLoad);
            }
            //else if (currentUpload
            uploadingOverlay.hide();
            $(innerProgressBar).width(&#x27;0%&#x27;);
        }
    }
    function error() {
        console.log(&#x27;error in settingsview&#x27;);
        $(uploadingOverlay).hide();
        var messageBox = LADS.Util.UI.popUpMessage(function () {
            $(&#x27;.overlayOnRoot&#x27;).show();
            reloadArtworks(function () {
                $(&#x27;.overlayOnRoot&#x27;).hide();
            });
        }, &quot;There was an error uploading the file.&quot;, null);
        $(messageBox).css(&#x27;z-index&#x27;, LADS.TourAuthoring.Constants.aboveRinZIndex + 7);
        $(root).append(messageBox);
        $(messageBox).fadeIn(500);
    }
    function progress(upload) {
        var percentComplete = upload.progress.bytesSent / upload.progress.totalBytesToSend;
        $(innerProgressBar).width(percentComplete * 90 + &quot;%&quot;);
    }
    // RYAN - end of moved



}
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
