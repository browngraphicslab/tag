<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>LADS/js/utils/BMv7.CustomInfobox/V7CustomInfobox.js - Touch Art Gallery web application</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../../LADS/images/WideLogo.scale-100.png" title="Touch Art Gallery web application"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/CryptoJS.html">CryptoJS</a></li>
            
                <li><a href="../classes/LADS.Layout.Artmode.html">LADS.Layout.Artmode</a></li>
            
                <li><a href="../classes/LADS.Layout.InternetFailurePage.js.html">LADS.Layout.InternetFailurePage.js</a></li>
            
                <li><a href="../classes/LADS.Layout.StartPage.html">LADS.Layout.StartPage</a></li>
            
                <li><a href="../classes/Telemetry.html">Telemetry</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: LADS/js/utils/BMv7.CustomInfobox/V7CustomInfobox.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
ï»¿/*******************************************************************************
* Author: Ricky Brundritt
* Website: http://rbrundritt.wordpress.com
* Date: May 21nd, 2011
* 
* Description: 
* This JavaScript file is meant to create a infobox control that is highly 
* customizable, reusable, and easy to extend. This method takes in a map 
* reference, and a set of options. 
* 
* Example Usage:
*
* var map, customInfobox;
*
* function GetMap()
* {
*	var map = new Microsoft.Maps.Map(document.getElementById(&quot;myMap&quot;),{ credentials: &quot;YOUR_BING_MAPS_KEY&quot; });
*	
*	Microsoft.Maps.registerModule(&quot;CustomInfoboxModule&quot;, &quot;scripts/V7CustomInfobox.min.js&quot;);
*	    Microsoft.Maps.loadModule(&quot;CustomInfoboxModule&quot;, { callback: function () {
*	        customInfobox = new CustomInfobox(map);
*	    }
*	});
* }
*
* //Have data be returned from data source and added to the cluster layer
* function ClusterLayer(results)
* {
* 	clusteredLayer.SetData(results);
* }
*
* function displayInfobox() {
*	customInfobox.show(map.getCenter(), &quot;Hello World&quot;);
*}
********************************************************************************/

var CustomInfobox = function (map, options) {
    var _map = map,
    _content,
    _anchor,
    _infoboxContainerId,
    _handlerId,
    _hidden = false,
    _visible = false; //visible records if the custom info box is currently visible

    var _options = {
        arrowColor: &#x27;#fff&#x27;,     //Color of the arrow
        arrowLength: 20,        //Length of the arrow
        arrowWidth: 30,         //Width of the arrow
        borderColor: &#x27;#000&#x27;,    //Color of the infobox border
        color: &#x27;#fff&#x27;,          //Background color of infobox
        minHeight: 50,          //Minium height of the content area of the infobox
        minWidth: 100,          //Minimium width of the content area of the infobox
        offset: { x: 0, y: 0 }, //Offset distance of the infobox
        orientation: 0,         //Orientation of the infobox: 0 - horizontal, 1 - vertical
        showArrow: true,
        showCloseButton: true,
        tether: true,
        textColor: &#x27;#000&#x27;,
        callback: null          //this is called after the custom info box is displayed
    };

    /*********************** Private Methods ****************************/

    //Inialization method
    function _init() {
        //Create an id for the infobox
        _infoboxContainerId = map.getRootElement().parentNode.id + &quot;_infobox&quot;;

        //Create infobox container
        $(&#x27;body&#x27;).append(&quot;&lt;div id=&#x27;&quot; + _infoboxContainerId + &quot;&#x27; style=&#x27;position:absolute;z-index:10000;display:none;&#x27;&gt;&lt;/div&gt;&quot;);

        //initialize default tethering 
        _enableTethering(_options.tether);

        //Set user options
        _setOptions(options);
    }

    //Method for generating the infobox arrow
    function _createArrow(direction) {
        //var html = [&quot;&lt;div id=&#x27;&quot;, _infoboxContainerId, &quot;_arrow&#x27; style=&#x27;position:relative;float:left;width:0;height:0;line-height:0;border-style:solid;&quot;];
        var div = $(document.createElement(&#x27;div&#x27;));
        div.attr(&#x27;id&#x27;, _infoboxContainerId + &#x27;_arrow&#x27;);
        div.css({
            position: &#x27;relative&#x27;,
            float: &#x27;left&#x27;,
            width: &#x27;0&#x27;,
            height: &#x27;0&#x27;,
            &#x27;line-height&#x27;: &#x27;0&#x27;,
            &#x27;border-style&#x27;: &#x27;solid&#x27;
        });
        var w = _options.arrowWidth * 0.5;
        switch (direction) {
            case 0: 	//Point up
                //html.push(&quot;border-width:0 &quot;, w, &quot;px &quot;, _options.arrowLength, &quot;px &quot;, w, &quot;px;&quot;);
                //html.push(&quot;border-color:transparent transparent &quot;, _options.arrowColor, &quot; transparent;&quot;);
                div.css({
                    &quot;border-width&quot;: &#x27;0 &#x27; + w + &quot;px &quot; + _options.arrowLength + &quot;px &quot; + w + &quot;px&quot;,
                    &quot;border-color&quot;: &#x27;transparent transparent &#x27; + _options.arrowColor + &quot; transparent&quot;
                });
                break;
            case 1: 	//Point Right
                //html.push(&quot;border-width:&quot;, w, &quot;px 0 &quot;, w, &quot;px &quot;, _options.arrowLength, &quot;px;&quot;);
                //html.push(&quot;border-color:transparent transparent transparent &quot;, _options.arrowColor, &quot;;&quot;);
                div.css({
                    &quot;border-width&quot;: w + &quot;px 0 &quot; + w + &quot;px &quot; + _options.arrowLength + &quot;px&quot;,
                    &quot;border-color&quot;: &#x27;transparent transparent transparent &#x27; + _options.arrowColor
                });
                break;
            case 2: 	//Point Down
                //html.push(&quot;border-width:&quot;, _options.arrowLength, &quot;px &quot;, w, &quot;px 0 &quot;, w, &quot;px;&quot;);
                //html.push(&quot;border-color:&quot;, _options.arrowColor, &quot; transparent transparent transparent;&quot;);
                div.css({
                    &quot;border-width&quot;: _options.arrowLength + &quot;px &quot; + w + &quot;px 0 &quot; + w + &quot;px &quot;,
                    &quot;border-color&quot;: _options.arrowColor + &#x27; transparent transparent transparent&#x27;
                });
                break;
            case 3: 	//Point Left
                //html.push(&quot;border-width:&quot;, w, &quot;px &quot;, _options.arrowLength, &quot;px &quot;, w, &quot;px 0;&quot;);
                //html.push(&quot;border-color:transparent &quot;, _options.arrowColor, &quot; transparent transparent;&quot;);
                div.css({
                    &quot;border-width&quot;:  w + &quot;px &quot; + _options.arrowLength + &quot;px &quot;+ w + &quot;px 0&quot;,
                    &quot;border-color&quot;:  &#x27;transparent &#x27; + _options.arrowColor + &#x27; transparent transparent&#x27;
                });
                break;
        }

        //html.push(&quot;&#x27;&gt;&lt;/div&gt;&quot;);

        //return html.join(&#x27;&#x27;);
        return div;
    }

    //method that controls is the 
    function _enableTethering(tether) {
        if (_handlerId != null) {   //Remove existing event handler
            Microsoft.Maps.Events.removeHandler(_handlerId);
        }

        if (tether) {   //update infobox when map is moving
            _handlerId = Microsoft.Maps.Events.addThrottledHandler(_map, &#x27;viewchange&#x27;, _render, 40);
        } else {        //hide infobox when map is moved
            _handlerId = Microsoft.Maps.Events.addHandler(_map, &#x27;viewchangestart&#x27;, _hide);
        }
    }

    //Hides the infobox from view
    function _hide() {
        //clear content and anchor information
        _anchor = null;
        _hidden = true;

        //Rerender infobox causes it to hide when there are no content or anchor
        _render();
        _visible = false;
    }

    //Generates the infobox UI
    function _render() {
        var container = $(&#x27;#&#x27; + _infoboxContainerId);

        if (container != null &amp;&amp; _anchor != null &amp;&amp; !_hidden) {
            if (!_map.getBounds().contains(_anchor)) {  //hide if anchor is anchor latlong on the map
                container.css(&#x27;display&#x27;, &#x27;none&#x27;);
            } else {
                container.css(&#x27;display&#x27;, &#x27;&#x27;);
                var pinPixel = _map.tryLocationToPixel(_anchor, Microsoft.Maps.PixelReference.control),
                screenX = _map.getPageX() + pinPixel.x,
                screenY = _map.getPageY() + pinPixel.y;

                var key = (_map.getHeight() * 0.5 &lt; pinPixel.y) ? 2 : 0; //Determine the quadrant that the pushpin is in. 
                key += (_map.getWidth() * 0.5 &lt; pinPixel.x) ? 1 : 0;

                //Wrap contents
                //var contents = [&quot;&lt;div id=&#x27;&quot;, _infoboxContainerId, &quot;_content&#x27; style=&#x27;padding:5%;position:relative;float:left;border:1px solid &quot;, _options.borderColor, &quot;;background-color:&quot;, _options.color, &quot;;min-width:&quot;, _options.minWidth, &quot;px;min-height:&quot;, _options.minHeight, &quot;px; color:&quot;, _options.textColor, &quot;&#x27;&gt;&quot;, _content, &quot;&lt;/div&gt;&quot;];
                var contents = $(document.createElement(&#x27;div&#x27;));
                contents.attr(&#x27;id&#x27;, _infoboxContainerId + &#x27;_content&#x27;);
                contents.css({
                    padding: &#x27;5%&#x27;,
                    position: &#x27;relative&#x27;,
                    float: &#x27;left&#x27;,
                    border: &#x27;1px solid &#x27; + _options.borderColor,
                    &#x27;background-color&#x27;:_options.color,
                    &#x27;min-width&#x27;: _options.minWidth +&#x27;px&#x27;,
                    &#x27;min-height&#x27;:_options.minHeight +&#x27;px&#x27;,
                     color: _options.textColor
                });
                contents.append(_content);

                var arrowX = 0, arrowY = 0, html;

                //html = contents.join(&#x27;&#x27;);
                var DOMcontents = $(document.createElement(&#x27;div&#x27;));
                DOMcontents.append(contents);
                //DOMcontents.css({&#x27;color&#x27;: _options.textColor});

                if (_options.showArrow) {
                    if (_options.orientation) { //vertical arrow
                        arrowX = _options.arrowWidth;
                        arrowY = _options.arrowLength;

                        if (key &gt; 1) {  //down
                            //html = contents.join(&#x27;&#x27;) + _createArrow(2);
                            DOMcontents.append(_createArrow(2));
                        } else {        //up
                            //html = _createArrow(0) + contents.join(&#x27;&#x27;);
                            DOMcontents.prepend(_createArrow(0));
                        }
                    } else {
                        arrowX = _options.arrowLength;
                        arrowY = _options.arrowWidth;

                        if (key % 2) {  //right arrow
                            //html = contents.join(&#x27;&#x27;) + _createArrow(1);
                            DOMcontents.append(_createArrow(1));
                        } else {        //left
                            //html = _createArrow(3) + contents.join(&#x27;&#x27;);
                            DOMcontents.prepend(_createArrow(3));
                        }
                    }
                }/* else {
                    html = contents.join(&#x27;&#x27;);
                }*/

                var elements = DOMcontents.children();

                container.html(&#x27;&#x27;); //clear the container
                container.append(elements); //add new elements

                //Get Width and Height of Contents
                var contentContainer = $(&#x27;#&#x27; + _infoboxContainerId + &#x27;_content&#x27;);
                var closeButtonStyle;
                //Add close button if enabled
                if (_options.showCloseButton) {
                    closeButtonStyle = options.closeButtonStyle || &#x27;position:absolute;right:5px;top:2px;cursor:pointer;font:bold 18px Arial;line-height:12px;&#x27;;
                    contentContainer.append(window.toStaticHTML(&quot;&lt;span id=&#x27;&quot; + _infoboxContainerId + &quot;_closeBtn&#x27; href=&#x27;javascript:void()&#x27; style=&#x27;&quot;+closeButtonStyle+&quot;&#x27;&gt;x&lt;/span&gt;&quot;));
                    $(&#x27;#&#x27; + _infoboxContainerId + &#x27;_closeBtn&#x27;).click(function () {
                        _hide();
                    });
                }

                //Get dimensions of contents
                var contentX = contentContainer.outerWidth(),
                    contentY = contentContainer.outerHeight();

                var w = 0, h = 0, arrowOffsetTop = 0, arrowOffsetLeft = 0;

                //Calculate dimensions of infobox container
                if (_options.orientation) {
                    w = contentX;
                    h = contentY + arrowY;

                    if (key % 2) {  //content left
                        arrowOffsetLeft = w - _options.arrowWidth;
                        screenX += _options.offset.x - w + _options.arrowWidth * 0.5;
                    } else {
                        screenX += _options.offset.x - _options.arrowWidth * 0.5;
                    }

                    if (key &gt; 1) {  //bottom
                        screenY -= h + _options.offset.y;
                    } else {
                        screenY -= _options.offset.y;
                    }
                } else {
                    w = arrowX + contentX + 2;  //The 2 is to make up for the border on the contents
                    h = Math.max(contentY, arrowY);

                    if (key % 2) {  //right arrow
                        screenX += _options.offset.x - w;
                    } else {        //left
                        screenX += _options.offset.x;
                    }

                    if (key &gt; 1) {
                        arrowOffsetTop = h - _options.arrowWidth;
                        screenY -= h - _options.arrowWidth * 0.5 + _options.offset.y;
                    } else {
                        screenY -= (_options.arrowWidth * 0.5 + _options.offset.y);
                    }
                }

                if (_options.showArrow) {
                    var arrow = $(&#x27;#&#x27; + _infoboxContainerId + &#x27;_arrow&#x27;);
                    arrow.css({ &#x27;margin-left&#x27;: Math.ceil(arrowOffsetLeft) + &#x27;px&#x27;, &#x27;margin-top&#x27;: Math.ceil(arrowOffsetTop) + &#x27;px&#x27; });
                }

                container.css({ &#x27;width&#x27;: Math.ceil(w) + &#x27;px&#x27;, &#x27;height&#x27;: Math.ceil(h) + &#x27;px&#x27;, &#x27;top&#x27;: screenY, &#x27;left&#x27;: screenX });
            }
        } else if (container != null) {    //hide infobox
            container.html(&#x27;&#x27;);
            container.css(&#x27;display&#x27;, &#x27;none&#x27;);
        }
    }

    //Updates the default options with new options
    function _setOptions(options) {
        var tetherVal = _options.tether;

        for (attrname in options) {
            _options[attrname] = options[attrname];
        }

        if (tetherVal != _options.tether) {
            _enableTethering(_options.tether);
        }

        _render();
    }

    /*********************** Public Methods ****************************/

    this.visible = function () {
        return _visible;
    }

    //Hide the infobox
    this.hide = function () {
        _hide();
    };

    //show infobox
    this.show = function (latlong, content) {
        _anchor = latlong;
        _content = content;
        _hidden = false;
        _render();
        _visible = true;
        if(options.callback != null)
            options.callback();
    };

    /**
    * @returns The custom infobox options.
    */
    this.getOptions = function () {
        return _options;
    };

    /**
    * Sets the custom infobox options.
    * Example: customInfobox.SetOptions({ gridSize : 30});
    */
    this.setOptions = function (options) {
        _setOptions(options);
    };

    _init();
};

//Call the Module Loaded method
Microsoft.Maps.moduleLoaded(&#x27;CustomInfoboxModule&#x27;);
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
