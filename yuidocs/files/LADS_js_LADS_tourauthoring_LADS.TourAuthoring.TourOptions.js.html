<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>LADS/js/LADS/tourauthoring/LADS.TourAuthoring.TourOptions.js - Touch Art Gallery web application</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../../LADS/images/WideLogo.scale-100.png" title="Touch Art Gallery web application"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/LADS.Layout.Artmode.html">LADS.Layout.Artmode</a></li>
            
                <li><a href="../classes/LADS.Layout.InternetFailurePage.js.html">LADS.Layout.InternetFailurePage.js</a></li>
            
                <li><a href="../classes/LADS.Layout.StartPage.html">LADS.Layout.StartPage</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: LADS/js/LADS/tourauthoring/LADS.TourAuthoring.TourOptions.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
ï»¿LADS.Util.makeNamespace(&#x27;LADS.TourAuthoring.TourOptions&#x27;);

/**
 * Control for additional tour options
 *@param spec:    timeManager attr, url (url of tour if loading existing tour for editing)

 */
LADS.TourAuthoring.TourOptions = function (spec) {
    &quot;use strict&quot;;

    var functionsPanel = $(document.createElement(&#x27;div&#x27;)),
        addTourOptionsLabel,
        dropMain,
        dropdownIcon,
        that = {},
        tour = spec.tour,
        playbackControls = spec.playbackControls,
        timeManager = spec.timeManager,
        timeline = spec.timeline,
        root = spec.root,
        undoManager = spec.undoManager,
        //dialogOverlay = $(document.createElement(&#x27;div&#x27;)), // NOTE: TODO: figure out how to place dialogOverlay inside of topbar to maintain modularity?

        dialogOverlay = $(LADS.Util.UI.blockInteractionOverlay()),


        thumbnailcaptured = $(document.createElement(&#x27;div&#x27;)),
        optionsBuffer = {};

    (function _createHTML() {
        functionsPanel.attr(&#x27;id&#x27;, &#x27;tour-options&#x27;);
        // Had to do tops and heights as CSS to prevent overlap on small screens
        functionsPanel.css({
            &quot;height&quot;: &quot;48px&quot;,
            &quot;width&quot;: &quot;13%&quot;,
            &quot;left&quot;: &quot;25%&quot;,
            &quot;top&quot;: &quot;27%&quot;,
            &quot;position&quot;: &quot;relative&quot;,
            &quot;float&quot;: &quot;left&quot;
        });

        /**
         * Drop Down icon
         * Modified By: Hak
         */
        var addDropDownIconTourOptions = $(document.createElement(&#x27;img&#x27;));
        addDropDownIconTourOptions.addClass(&quot;tourOptionDropDownIcon&quot;);
        addDropDownIconTourOptions.attr(&#x27;src&#x27;, &#x27;images/icons/Down.png&#x27;);
        addDropDownIconTourOptions.css({
            &#x27;top&#x27;: &#x27;-5%&#x27;, &#x27;width&#x27;: &#x27;7.5%&#x27;, &#x27;height&#x27;: &#x27;auto&#x27;, &#x27;margin-left&#x27;: &#x27;5%&#x27;, &#x27;margin-bottom&#x27;: &#x27;3%&#x27;,
        });
        dropdownIcon = addDropDownIconTourOptions;

        // Additional options will go here once they exist
        addTourOptionsLabel = $(document.createElement(&#x27;label&#x27;));
        addTourOptionsLabel.attr(&#x27;id&#x27;, &#x27;addTourOptionsLabel&#x27;);
        addTourOptionsLabel.text(&quot;Options&quot;);
        addTourOptionsLabel.css({
            &quot;font-size&quot;: LADS.Util.getFontSize(190),
            &quot;color&quot;: &quot;rgb(256, 256, 256)&quot;
        });
        addTourOptionsLabel.append(addDropDownIconTourOptions);
        functionsPanel.append(addTourOptionsLabel);

        // Dropdown menus:
        // Main section
        dropMain = $(document.createElement(&#x27;div&#x27;));
        dropMain.css({
            &quot;position&quot;: &quot;absolute&quot;,
            &quot;color&quot;: &quot;rgb(256, 256, 256)&quot;,
            &#x27;background-color&#x27;: &#x27;rgba(0,0,0,0.85)&#x27;,
            &#x27;left&#x27;: &#x27;0&#x27;,
            &#x27;width&#x27;: &#x27;100%&#x27;,
            &#x27;z-index&#x27;: LADS.TourAuthoring.Constants.aboveRinZIndex
        });
        functionsPanel.append(dropMain);
        dropMain.hide();

        // create the buttons to add various components
        var thumbnailButton = _addMenuItem(&#x27;Capture Thumbnail&#x27;, dropMain, &#x27;thumbnailButton&#x27;);
        var lengthButton = _addMenuItem(&#x27;Change Tour Length&#x27;, dropMain, &#x27;tourLengthButton&#x27;);
        var exportButton = _addMenuItem(&#x27;Export Tour Data&#x27;, dropMain, &#x27;exportButton&#x27;);

        /**
         * Creates component menu buttons
         * @param title         Name of button
         * @param component     DOM element to add button to
         * @param id            id to the element
         */
        function _addMenuItem(title, component, id) {
            var item = $(document.createElement(&#x27;label&#x27;));
            item.addClass(&#x27;optionItem&#x27;);
            item.attr(&#x27;id&#x27;, id);
            item.text(title);
            item.css({
                &quot;left&quot;: &quot;0%&quot;,
                &quot;position&quot;: &quot;relative&quot;,
                &quot;font-size&quot;: LADS.Util.getFontSize(170),
                &quot;color&quot;: &quot;rgb(256, 256, 256)&quot;,
                &quot;display&quot;: &quot;block&quot;,
                &#x27;padding&#x27;: &#x27;4% 0 5% 0&#x27;,
                &#x27;text-indent&#x27;: &#x27;4%&#x27;,
                &#x27;z-index&#x27;: LADS.TourAuthoring.Constants.aboveRinZIndex + 5
            });
            item.on(&#x27;mousedown&#x27;, function (evt) {
                evt.stopImmediatePropagation();
            });
            component.append(item);
            return item;
        }

        var menuVisible = false;
        //have the dropMain menu show/hide when clicked
        addTourOptionsLabel.click(function (event) {
            var close = timeline.getCloseMenu();
            if (close &amp;&amp; close !== hideMenu) {
                close();
            }

            event.stopImmediatePropagation();

            menuVisible = !menuVisible;
            if (menuVisible) {
                timeline.setisMenuOpen(true);
                timeline.setCloseMenu(hideMenu);
                root.on(&#x27;mousedown.topMenu&#x27;, function (event) {
                    hideMenu();
                });

                $(dropdownIcon).css({
                    &#x27;transform&#x27;: &#x27;scaleY(-1)&#x27;,
                    &#x27;margin-bottom&#x27;: &#x27;3%&#x27;
                });
            }
            else {
                timeline.setisMenuOpen(false);
                timeline.setCloseMenu(hideMenu);
                root.off(&#x27;mousedown.topMenu&#x27;);

                $(dropdownIcon).css({
                    &#x27;transform&#x27;: &#x27;scaleY(1)&#x27;,
                    &#x27;margin-bottom&#x27;: &#x27;3%&#x27;
                });
            }
            dropMain.css(&#x27;top&#x27;, parseInt(addTourOptionsLabel.css(&#x27;top&#x27;),10) + addTourOptionsLabel.height());
            dropMain.toggle();
        });
        addTourOptionsLabel.on(&#x27;mousedown&#x27;, function (evt) {
            evt.stopImmediatePropagation();
        });

        //the capture thumbnail confirmation
        var capturedmsg = $(document.createElement(&#x27;label&#x27;));
        $(capturedmsg).text(&quot;Capturing Thumbnail...&quot;);
        capturedmsg.css({
            &#x27;text-align&#x27;: &#x27;center&#x27;,
            &#x27;width&#x27;: &#x27;100%&#x27;,
            &#x27;font-size&#x27;: &#x27;1.5em&#x27;,
            &#x27;color&#x27;: &#x27;white&#x27;
        });
        thumbnailcaptured.append(capturedmsg);
        thumbnailcaptured.addClass(&quot;thumbnailcaptured&quot;);
        thumbnailcaptured.css({
            &#x27;background-color&#x27;: &#x27;black&#x27;,
            &#x27;position&#x27;: &#x27;absolute&#x27;,
            &#x27;left&#x27;: &#x27;52%&#x27;,
            &#x27;z-index&#x27;: &#x27;1000&#x27;,
            &#x27;display&#x27;: &#x27;none&#x27;,
            &#x27;opacity&#x27;: &#x27;0.8&#x27;,
            &#x27;border&#x27;: &#x27;2.8px double white&#x27;
        });

        /*capture the current viewer&#x27;s thumbnail*/
        thumbnailButton.on(&#x27;click&#x27;, function () {
            var uiHeight = $(&#x27;#resizableArea&#x27;).height() + $(&#x27;#topbar&#x27;).height();
            thumbnailcaptured.css({ &#x27;top&#x27;: 0.53 * uiHeight + &#x27;px&#x27; });

            //hide menu
            hideMenu();
            thumbnailcaptured.fadeIn(&#x27;fast&#x27;);
            //capture the thumbnail and upload it.
            var rinplayer = $(&#x27;#rinplayer&#x27;);
            html2canvas([rinplayer[0]], {
                onrendered: function (canvas) {
                    // no need for cropping anymore, since the rinplayer is always 16:9
                    //gets dataurl from tmpcanvas, ready to send to server!
                    var dataurl = canvas.toDataURL();
                    LADS.Worktop.Database.uploadImage(dataurl, function (imageURL) {
                        LADS.Worktop.Database.changeTour(tour.Identifier, { Thumbnail: imageURL }, function () {
                            setTimeout(function () {
                                thumbnailcaptured.fadeOut();//alert msg disappear
                            }, 1000);
                        }, unauth, conflict, error);
                    }, unauth, error);
                    //optionsBuffer.thumbnail = imageURL;
                },
                allowTaint: true, // allow imageES images in thumbnails, etc
            });
        });

        function unauth() {
            dialogOverlay.hide();
            var popup = LADS.Util.UI.popUpMessage(null, &quot;Thumbnail not saved.  You must log in to save changes.&quot;);
            $(&#x27;body&#x27;).append(popup);
            $(popup).show();
            setTimeout(function () {
                thumbnailcaptured.fadeOut();//alert msg disappear
            }, 1000);
        }

        function conflict(jqXHR, ajaxCall) {
            ajaxCall.force();
        }

        function error() {
            dialogOverlay.hide();
            var popup = LADS.Util.UI.popUpMessage(null, &quot;Thumbnail not saved.  There was an error contacting the server.&quot;);
            $(&#x27;body&#x27;).append(popup);
            $(popup).show();
            setTimeout(function () {
                thumbnailcaptured.fadeOut();//alert msg disappear
            }, 1000);
        }

        /*click function for inputtin new tour length*/
        lengthButton.on(&#x27;click&#x27;, function () {
            //hide menu
            hideMenu();

            dialogOverlay.fadeIn(500);
            // Set timeInput to the current length
            timeInput.val(timeManager.formatTime(timeManager.getDuration().end));

            timeInput.select();
            messageRow.text(&#x27;&#x27;);
        });

        // Tour Length Dialog
        // Overlay to darken out main UI

        // Actual dialog container
        var lengthDialog = $(document.createElement(&#x27;div&#x27;));
        lengthDialog.attr(&#x27;id&#x27;, &#x27;lengthDialog&#x27;);

        ///
        dialogOverlay.css(&#x27;z-index&#x27;, &#x27;100000&#x27;);


        var lengthDialogSpecs = LADS.Util.constrainAndPosition($(window).width(), $(window).height(),
           {
               center_h: true,
               center_v: true,
               width: 0.5,
               height: 0.35,
               max_width: 560,
               max_height: 200,
           });

        lengthDialog.css({
            position: &#x27;absolute&#x27;,
            left: lengthDialogSpecs.x + &#x27;px&#x27;,
            top: lengthDialogSpecs.y + &#x27;px&#x27;,
            width: lengthDialogSpecs.width + &#x27;px&#x27;,
            height: lengthDialogSpecs.height + &#x27;px&#x27;,
            border: &#x27;3px double white&#x27;,
            &#x27;background-color&#x27;: &#x27;black&#x27;,
        });

        dialogOverlay.append(lengthDialog);

        // Create a form to capture enter keypress
        var dialogForm = $(document.createElement(&#x27;form&#x27;));
        dialogForm.attr(&#x27;id&#x27;, &#x27;dialogForm&#x27;);
        dialogForm.css({
            &#x27;margin-top&#x27;: &#x27;4.5%&#x27;,
        });
        lengthDialog.append(dialogForm);

        // updates the timeManager/timeinput related stats
        // when the length of tour is changed/submit button is clicked.
        dialogForm.on(&#x27;submit&#x27;, function () {
            var split = timeInput.val().split(&#x27;:&#x27;);
            var min = parseInt(split[0],10), sec = parseInt(split[1],10);
            var oldTime;
            var command;
            if (split.length == 1 &amp;&amp; (min || min === 0) &amp;&amp; min &gt;= 0) { // In this case &#x27;min&#x27; is actually seconds
                if (min &gt; LADS.TourAuthoring.Constants.maxTourLength) {
                    messageRow.text(&#x27;Tour length is too long. Maximum length of tour must be 15 minutes.&#x27;);
                    messageRow.css({
                        color: &#x27;white&#x27;,
                        &#x27;width&#x27;: &#x27;80%&#x27;,
                        &#x27;left&#x27;: &#x27;10%&#x27;,
                        &#x27;font-size&#x27;: &#x27;1.25em&#x27;,
                        &#x27;position&#x27;: &#x27;absolute&#x27;,
                        &#x27;text-align&#x27;: &#x27;center&#x27;,
                        &#x27;margin-top&#x27;: &#x27;3%&#x27;,
                    });
                    timeInput.select();
                }
                else {
                    if (min &lt; timeline.getLastDisplayTime()) { //check if new time is shorter than last display length, and limit it to that
                        min = timeline.getLastDisplayTime();
                    }
                    oldTime = timeManager.getDuration().end;
                    command = LADS.TourAuthoring.Command({
                        execute: function () {
                            timeManager.setEnd(min);

                        },
                        unexecute: function () {
                            timeManager.setEnd(oldTime);
                        }
                    });
                    command.execute();
                    undoManager.logCommand(command);
                    dialogOverlay.fadeOut(500);
                }
            } else if (split.length === 2 &amp;&amp; (min || min === 0) &amp;&amp; (sec || sec === 0) &amp;&amp; min &gt;= 0 &amp;&amp; (typeof sec === &quot;number&quot;) &amp;&amp; sec &gt;= 0 &amp;&amp; sec &lt;= 59) { // good format
                var newTime = min * 60 + sec;
                if (newTime &gt; LADS.TourAuthoring.Constants.maxTourLength) {
                    messageRow.text(&#x27;Tour length is too long. Maximum length of tour is 15 minutes.&#x27;);
                    timeInput.select();
                }
                else {
                    if (newTime &lt; timeline.getLastDisplayTime()) { //check if new time is shorter than last display length, and limit it to that
                        newTime = timeline.getLastDisplayTime();
                    }
                    oldTime = timeManager.getDuration().end;
                    command = LADS.TourAuthoring.Command({
                        execute: function () {
                            timeManager.setEnd(newTime);

                        },
                        unexecute: function () {
                            timeManager.setEnd(oldTime);
                        }
                    });
                    command.execute();
                    undoManager.logCommand(command);
                    dialogOverlay.fadeOut(500);
                }
            }
            else {
                messageRow.text(&#x27;Please enter a valid length (MM:SS or seconds).&#x27;);
                timeInput.select();
            }

            timeline.faderUpdate();// update the fader pposition in sliderBox
            return false;
        });

        var dialogTitle = $(document.createElement(&#x27;div&#x27;));
        dialogTitle.attr(&#x27;id&#x27;, &#x27;dialogTitle&#x27;);
        dialogTitle.css({
            color: &#x27;white&#x27;,
            &#x27;width&#x27;: &#x27;80%&#x27;,
            &#x27;height&#x27;: &#x27;15%&#x27;,
            &#x27;left&#x27;: &#x27;10%&#x27;,
            &#x27;font-size&#x27;: &#x27;1.25em&#x27;,
            &#x27;position&#x27;: &#x27;relative&#x27;,
            &#x27;text-align&#x27;: &#x27;center&#x27;,
            &#x27;word-wrap&#x27;: &#x27;break-word&#x27;,
        });
        dialogTitle.text(&#x27;Enter New Length (MM:SS): &#x27;);
        dialogForm.append(dialogTitle);

        var timeInput = $(document.createElement(&#x27;input&#x27;));
        timeInput.attr(&#x27;id&#x27;, &#x27;timeInput&#x27;);
        timeInput.css({
            &#x27;position&#x27;: &#x27;relative&#x27;,
        });
        dialogTitle.append(timeInput);
        dialogForm.append(document.createElement(&#x27;br&#x27;));

        timeInput.on(&#x27;keydown&#x27;, function (ev) {
            ev.stopImmediatePropagation();
        });
        timeInput.on(&#x27;keypress&#x27;, function (ev) {
            ev.stopImmediatePropagation();
        });
        timeInput.on(&#x27;keyup&#x27;, function (ev) {
            ev.stopImmediatePropagation();
        });

        // Div for bad format message
        var messageRow = $(document.createElement(&#x27;div&#x27;));
        messageRow.css({
            //color: &#x27;white&#x27;,
            //&#x27;font-size&#x27;: &#x27;1.25em&#x27;,
            //&#x27;margin-bottom&#x27;: &#x27;10px&#x27;,
            //&#x27;margin-left&#x27;:&#x27;5%&#x27;

            color: &#x27;white&#x27;,
            &#x27;width&#x27;: &#x27;80%&#x27;,
            //&#x27;height&#x27;: &#x27;15%&#x27;,
            &#x27;left&#x27;: &#x27;10%&#x27;,
            //&#x27;top&#x27;: &#x27;12.5%&#x27;,
            &#x27;font-size&#x27;: &#x27;1.25em&#x27;,
            &#x27;position&#x27;: &#x27;absolute&#x27;,
            &#x27;text-align&#x27;: &#x27;center&#x27;,
            //&#x27;overflow&#x27;: &#x27;hidden&#x27;,
            &#x27;margin-top&#x27;: &#x27;3%&#x27;,
        });
        dialogForm.append(messageRow);

        // Container for &quot;save / cancel&quot; buttons
        var buttonRow = $(document.createElement(&#x27;div&#x27;));
        buttonRow.css({
            //&#x27;margin-top&#x27;: &#x27;10px&#x27;,
            //&#x27;text-align&#x27;: &#x27;left&#x27;,

            &#x27;position&#x27;: &#x27;relative&#x27;,
            &#x27;display&#x27;: &#x27;block&#x27;,
            &#x27;width&#x27;: &#x27;80%&#x27;,
            &#x27;left&#x27;: &#x27;10%&#x27;,
            &#x27;top&#x27;: &#x27;50%&#x27;
        });
        dialogForm.append(buttonRow);


        //////////

        var buttonDiv = $(document.createElement(&quot;div&quot;));
        buttonDiv.css(&#x27;text-align&#x27;, &#x27;right&#x27;);
        var emptyDiv = $(document.createElement(&quot;div&quot;));
        emptyDiv.css(&#x27;clear&#x27;, &#x27;both&#x27;);
        var submitButton = $(document.createElement(&quot;button&quot;));
        submitButton.text(&quot;Apply&quot;);
        submitButton.css({
            //&#x27;left&#x27;: &#x27;4%&#x27;,
            //&#x27;bottom&#x27;: &#x27;10%&#x27;,
            //&#x27;font-size&#x27;: &#x27;140%&#x27;,
            //&#x27;position&#x27;: &#x27;absolute&#x27;,
            //&#x27;box-sizing&#x27;: &#x27;border-box&#x27;,

            &#x27;padding&#x27;: &#x27;1%&#x27;,
            &#x27;border&#x27;: &#x27;1px solid white&#x27;,
            &#x27;width&#x27;: &#x27;auto&#x27;,
            &#x27;position&#x27;: &#x27;relative&#x27;,
            //&#x27;margin-top&#x27;: &#x27;1%&#x27;,
            &#x27;float&#x27;: &quot;right&quot;,
            &#x27;margin-right&#x27;: &#x27;-3%&#x27;,
            &#x27;margin-top&#x27;: &#x27;15%&#x27;,


        });
        var cancelButton = $(document.createElement(&#x27;button&#x27;));
        cancelButton.attr(&#x27;type&#x27;, &#x27;button&#x27;);
        cancelButton.text(&quot;Cancel&quot;);
        cancelButton.css({
            //&#x27;right&#x27;: &#x27;4%&#x27;,
            //&#x27;bottom&#x27;: &#x27;10%&#x27;,
            //&#x27;font-size&#x27;: &#x27;140%&#x27;,
            //&#x27;position&#x27;: &#x27;absolute&#x27;,
            //&#x27;box-sizing&#x27;: &#x27;border-box&#x27;,

            &#x27;padding&#x27;: &#x27;1%&#x27;,
            &#x27;border&#x27;: &#x27;1px solid white&#x27;,
            &#x27;width&#x27;: &#x27;auto&#x27;,
            &#x27;position&#x27;: &#x27;absolute&#x27;,//&#x27;relative&#x27;,
            //&#x27;margin-top&#x27;: &#x27;1%&#x27;,
            //&#x27;margin-left&#x27;: &#x27;7%&#x27;,
            &#x27;margin-left&#x27;: &#x27;-3%&#x27;,
            &#x27;float&#x27;: &quot;left&quot;,
            &#x27;margin-top&#x27;: &#x27;15%&#x27;,
            &#x27;bottom&#x27;: &#x27;1%&#x27;

            //&#x27;margin-top&#x27;: &#x27;5%&#x27;
        });
        buttonRow.append(cancelButton);
        buttonRow.append(submitButton);
        buttonRow.append(emptyDiv);
        //renameDialog.append(buttonDiv);
        dialogForm.append(buttonRow);


        ////////////

        //creates all buttons and adds them to panel
        //var submitButton = $(document.createElement(&#x27;button&#x27;));
        //submitButton.css({
        //    width: &#x27;auto&#x27;,
        //    border: &#x27;1px solid white&#x27;,
        //    padding: &#x27;1%&#x27;,
        //    &#x27;float&#x27;:&#x27;right&#x27;
        //});
        //submitButton.text(&#x27;Apply&#x27;);
        //buttonRow.append(submitButton);

        //var cancelButton = $(document.createElement(&#x27;button&#x27;));
        //cancelButton.attr(&#x27;type&#x27;, &#x27;button&#x27;);
        //cancelButton.css({
        //    width: &#x27;auto&#x27;,
        //    border: &#x27;1px solid white&#x27;,
        //    padding: &#x27;1%&#x27;,
        //});
        //cancelButton.text(&#x27;Cancel&#x27;);
        cancelButton.click(function () { dialogOverlay.fadeOut(500); });
        buttonRow.append(cancelButton);

        // export tour json to file



        exportButton.on(&quot;click&quot;, exportJSON);

        function exportJSON() {
            var date = Date.now();
            var json = timeline.toRIN(true);
            var json_str = JSON.stringify(json);
            var url = &quot;http://553d4a03eb844efaaf7915517c979ef4.cloudapp.net/rinjsTag/&quot;;
            var html_content = &#x27;&lt;!doctype html&gt;&lt;html&gt;&lt;head&gt;&#x27;;
            html_content+=&#x27;&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;&#x27;;
            html_content+=&#x27;&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=10&quot; /&gt;&#x27;;
            html_content+=&#x27;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, minimum-scale=1, maximum-scale=1, user-scalable=no&quot;&gt;&#x27;;
            html_content+=&#x27;&lt;title&gt;Rich Interactive Narratives&lt;/title&gt;&#x27;;
            html_content+=&#x27;&lt;style type=&quot;text/css&quot;&gt;html, body, #rinPlayer{position:absolute;top:0;right:0;bottom:0;left:0;margin:0;padding:0;overflow:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-ms-touch-action:none;-webkit-touch-callout:none;-ms-content-zooming:none;}&lt;/style&gt;&#x27;;
            html_content+=&#x27;&lt;script src=&quot;&#x27;+url+&#x27;lib/rin-core-1.0.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;&#x27;;
            html_content+=&#x27;&lt;script src=&quot;&#x27;+url+&#x27;lib/tagInk.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;&#x27;;
            html_content+=&#x27;&lt;script src=&quot;&#x27;+url+&#x27;lib/raphael.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;&#x27;;
            html_content+=&#x27;&lt;script src=&quot;&#x27;+url+&#x27;lib/seadragon-0.8.9-rin.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;&#x27;;
            html_content+=&#x27;&lt;script&gt;function parseDeepState(){var playerElement=document.getElementById(&quot;rinPlayer&quot;);var playerControl=rin.getPlayerControl(playerElement);var deepstateUrl=playerControl.resolveDeepstateUrlFromAbsoluteUrl(window.location.href);if(deepstateUrl){playerControl.load(deepstateUrl);}}&lt;/script&gt;&#x27;;
            html_content+=&#x27;&lt;/head&gt;&#x27;;
            html_content += &#x27;&lt;body onload=&quot;rin.processAll(null, &#x27; + &quot;&#x27;&quot; + url + &quot;&#x27;&quot; + &#x27;).then(parseDeepState);&quot;&gt;&#x27;;
            html_content += &#x27;&lt;div id=&quot;rinPlayer&quot; class=&quot;rinPlayer&quot; style=&quot;width: 100%;height: 100%;margin: 0;padding: 0;overflow: hidden;&quot; data-src=&quot;./TourData&#x27; + date + &#x27;.txt&quot; data-options=&quot;autoplay=false&amp;loop=true&amp;systemRootUrl=&#x27; + url + &#x27;&quot;&gt;&lt;/div&gt;&#x27;;

            //html_content+=&#x27;&lt;div id=&quot;rinPlayer&quot; class=&quot;rinPlayer&quot; style=&quot;width: 100%;height: 100%;margin: 0;padding: 0;overflow: hidden;&quot; data-src=&quot;&#x27;+url+&#x27;narratives/AIDSQuilt/narrative.js&quot; data-options=&quot;autoplay=false&amp;loop=true&amp;systemRootUrl=&#x27;+url+&#x27;&quot;&gt;&lt;/div&gt;&#x27;;
            html_content+=&#x27;&lt;/body&gt;&lt;/html&gt;&#x27;;
            var messageBox;
            hideMenu();
            
            Windows.Storage.KnownFolders.picturesLibrary.createFileAsync(&quot;TourData&quot; + date + &quot;.txt&quot;).then(
                function (file) {
                    Windows.Storage.FileIO.writeTextAsync(file, json_str).done(function () {
                        messageBox = LADS.Util.UI.popUpMessage(null, &quot;Tour data file created in your Pictures Library.&quot;, null);
                        $(messageBox).css(&#x27;z-index&#x27;, LADS.TourAuthoring.Constants.aboveRinZIndex + 1000);
                        $(&#x27;body&#x27;).append(messageBox);
                        $(messageBox).fadeIn(500);
                    });
                }
            );
            //Windows.Storage.KnownFolders.picturesLibrary.createFileAsync(&quot;TourPlayer&quot; + date + &quot;.html&quot;).then(
            //    function (file) {
            //        Windows.Storage.FileIO.writeTextAsync(file, html_content).done(function () {
            //            messageBox = LADS.Util.UI.popUpMessage(null, &quot;Tour player file created in your Pictures Library.&quot;, null);
            //            $(messageBox).css(&#x27;z-index&#x27;, LADS.TourAuthoring.Constants.aboveRinZIndex + 1000);
            //            $(&#x27;body&#x27;).append(messageBox);
            //            $(messageBox).fadeIn(500);
            //        });
            //    }
            //);
        }

        /*the helper function to hide menus when an option is clicked*/
        function hideMenu() {
            $(&#x27;.tourOptionDropDownIcon&#x27;).css({ &#x27;transform&#x27;: &#x27;scaleY(1)&#x27;, &#x27;margin-bottom&#x27;: &#x27;0%&#x27; });
            menuVisible = false;
            dropMain.hide();
        }

    })();
    function applyCSS(css) {
        functionsPanel.css(css);
    }
    that.applyCSS = applyCSS;

    function applyLabelCSS(css) {
        addTourOptionsLabel.css(css);
    }
    that.applyLabelCSS = applyLabelCSS;

    function addToDOM(container) {
        container.append(functionsPanel).append(dialogOverlay);
        container.append(functionsPanel).append(thumbnailcaptured);
    }
    that.addToDOM = addToDOM;

    function getBufferedData() {
        var returndata = optionsBuffer;
        optionsBuffer = {};
        return returndata;
    }
    that.getBufferedData = getBufferedData;

    return that;
};

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
