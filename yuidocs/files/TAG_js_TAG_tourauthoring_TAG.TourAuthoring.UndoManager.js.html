<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>TAG/js/TAG/tourauthoring/TAG.TourAuthoring.UndoManager.js - Touch Art Gallery web application</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../../TAG/images/WideLogo.scale-100.png" title="Touch Art Gallery web application"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Autolinker.html">Autolinker</a></li>
            
                <li><a href="../classes/TAG.AnnotatedImage.html">TAG.AnnotatedImage</a></li>
            
                <li><a href="../classes/TAG.Util.IdleTimer.html">TAG.Util.IdleTimer</a></li>
            
                <li><a href="../classes/TAG.Layout.ArtworkViewer.html">TAG.Layout.ArtworkViewer</a></li>
            
                <li><a href="../classes/TAG.Layout.InternetFailurePage.js.html">TAG.Layout.InternetFailurePage.js</a></li>
            
                <li><a href="../classes/TAG.Layout.CollectionsPage.html">TAG.Layout.CollectionsPage</a></li>
            
                <li><a href="../classes/TAG.Layout.StartPage.html">TAG.Layout.StartPage</a></li>
            
                <li><a href="../classes/TAG.Layout.VideoPlayer.html">TAG.Layout.VideoPlayer</a></li>
            
                <li><a href="../classes/TAG.Util.Artwork.html">TAG.Util.Artwork</a></li>
            
                <li><a href="../classes/TAG_embed.html">TAG_embed</a></li>
            
                <li><a href="../classes/Telemetry.html">Telemetry</a></li>
            
                <li><a href="../classes/TwoStageTimer.html">TwoStageTimer</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: TAG/js/TAG/tourauthoring/TAG.TourAuthoring.UndoManager.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
ï»¿TAG.Util.makeNamespace(&#x27;TAG.TourAuthoring.UndoManager&#x27;);

/**
 * Keeps track of commands and changes issued by program and order of issuing
 * Can unexecute or execute (undo / redo) these commands
 * @param spec  not used
 * @param my    not used
 */
TAG.TourAuthoring.UndoManager = function (spec, my) {
    &quot;use strict&quot;;

    // Private
    var that = {},
        undoStack = [],
        redoStack = [],
        initialized = false, //used to prevent undoStack from updating when timeline is opening
        undoStackSizeOriginal = 0,
        stackSize = 75;

    // Public methods

    /**
     * Log a command that has just been executed, ie. add it to the undo stack
     * @param command       TAG.TourAuthoring.Command that was just run
     */
    function logCommand(command) {
        if (initialized === true) {
            if (command.savedState === undefined)
                command.savedState = false;
            if (redoStack.length &gt; 0) {
                redoStack = []; // when should do this?
                $(&#x27;.redoButton&#x27;).css({ &#x27;opacity&#x27;: &#x27;0.4&#x27; });
                console.log(&quot;clear redoStack?&quot;);
            }
            undoStack.push(command);
            $(&#x27;.undoButton&#x27;).css({ &#x27;opacity&#x27;: &#x27;1.0&#x27; });
            if (undoStack.length &gt; stackSize) {
                var diff = undoStack.length - stackSize;
                undoStack.splice(0, diff);
            }

            //  console.log(&quot;SAVED STATE //TOP//FROM log command// ===&quot; + undoStack[undoStack.length - 1].savedState);
        }
    }
    that.logCommand = logCommand;

    /**
    * function returns the savedState of the element in the top of the stack, which determines if timeline is dirty or not
    */
    function dirtyStateGetter() {
        if (undoStack.length &gt; 0) {
            console.log(&quot;SAVED STATE //TOP//FROM DSG// ===&quot; + undoStack[undoStack.length - 1].savedState);
            return undoStack[undoStack.length - 1].savedState;
        }
        return true;
    }
    that.dirtyStateGetter = dirtyStateGetter;


    //returns undoStack size
    function undoStackSize() {
        return undoStack.length;
    }
    that.undoStackSize = undoStackSize;


    //sets the savedState of the top element in undoStack to true, and the rest to false 
    function setPrevFalse() {
        if (undoStack.length &gt; 0) {
            undoStack[undoStack.length - 1].savedState = true;

            for (var i = 0; i &lt; undoStack.length - 1; i++) {
                undoStack[i].savedState = false;
                // console.log(&quot;SAVED STATE===&quot; + undoStack[i].savedState);
            }
            // console.log(&quot;SAVED STATE //TOP// ===&quot; + undoStack[undoStack.length - 1].savedState);
        }
    }
    that.setPrevFalse = setPrevFalse;
    //called by loadRIN method in timeline class
    function setInitialized(boolVal) {
        initialized = boolVal;
    }
    that.setInitialized = setInitialized;


    function getInitialized() {
        return initialized;
    }
    that.getInitialized = getInitialized;

    /**
     * Undo
     */
    function undo() {
        if (undoStack.length &gt; 0) {
            var toUndo = undoStack.pop();
            toUndo.unexecute();
            redoStack.push(toUndo);
            $(&#x27;.redoButton&#x27;).css({ &#x27;opacity&#x27;: &#x27;1.0&#x27; });
            if (undoStack.length === 0)
                $(&#x27;.undoButton&#x27;).css({ &#x27;opacity&#x27;: &#x27;0.4&#x27; });
        }
        else $(&#x27;.undoButton&#x27;).css({ &#x27;opacity&#x27;: &#x27;0.4&#x27; });
    }
    that.undo = undo;

    /**
     * Redo
     */
    function redo() {
        if (redoStack.length &gt; 0) {
            var toRedo = redoStack.pop();
            toRedo.execute();
            undoStack.push(toRedo);
            $(&#x27;.undoButton&#x27;).css({ &#x27;opacity&#x27;: &#x27;1.0&#x27; });
            if (redoStack.length === 0)
                $(&#x27;.redoButton&#x27;).css({ &#x27;opacity&#x27;: &#x27;0.4&#x27; });
        }
        else $(&#x27;.redoButton&#x27;).css({ &#x27;opacity&#x27;: &#x27;0.4&#x27; });
    }
    that.redo = redo;

    /**
     * Clears undo / redo stack
     * Called on save or after loading
     */
    function clear() {
        undoStack = [];
        redoStack = [];
    }
    that.clear = clear;

    // greyed out the undo/redo buttons when there is no possible action
    function greyOutBtn() {
        $(&#x27;.undoButton&#x27;).css({ &#x27;opacity&#x27;: &#x27;1.0&#x27; });
        $(&#x27;.redoButton&#x27;).css({ &#x27;opacity&#x27;: &#x27;1.0&#x27; });
        if (undoStack.length &lt; 1) {
            $(&#x27;.undoButton&#x27;).css({ &#x27;opacity&#x27;: &#x27;0.4&#x27; });
        }
        if (redoStack.length &lt; 1) {
            $(&#x27;.redoButton&#x27;).css({ &#x27;opacity&#x27;: &#x27;0.4&#x27; });
        }
    }
    that.greyOutBtn = greyOutBtn;

    /**
     * Utility for combining together multiple commands
     * (Originally used for tying auto-creation of displays together with track creation)
     * @param n     Number of commands to tie together
     */
    function combineLast(n) {
        var command, i;
        n = n || 2;
        command = {
            execute: function () {
                for (i = 0; i &lt; n; i++) {
                    redo();
                }
            },
            unexecute: function () {
                for (i = 0; i &lt; n; i++) {
                    undo();
                }
            }
        };
        logCommand(command);
    }
    that.combineLast = combineLast;

    return that;
};
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
