<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>LADS/js/LADS/layout/LADS.Layout.NewCatalog.js - Touch Art Gallery web application</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../../LADS/images/WideLogo.scale-100.png" title="Touch Art Gallery web application"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/CryptoJS.html">CryptoJS</a></li>
            
                <li><a href="../classes/LADS.Layout.Artmode.html">LADS.Layout.Artmode</a></li>
            
                <li><a href="../classes/LADS.Layout.InternetFailurePage.js.html">LADS.Layout.InternetFailurePage.js</a></li>
            
                <li><a href="../classes/LADS.Layout.StartPage.html">LADS.Layout.StartPage</a></li>
            
                <li><a href="../classes/Telemetry.html">Telemetry</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: LADS/js/LADS/layout/LADS.Layout.NewCatalog.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
LADS.Util.makeNamespace(&quot;LADS.Layout.NewCatalog&quot;);
//catalog should only get artworks and exhibitions

// backInfo: {backArtwork: [artwork selected], backScroll: [int; position of scroll on timelineDiv] }

LADS.Layout.NewCatalog = function (backInfo, backExhibition, container, forSplitscreen) {
    &quot;use strict&quot;;

    /* nbowditch _editted 2/13/2014 */
    var backArtwork;
    var scrollPos = 0;
    if (backInfo) {
        backArtwork = backInfo.backArtwork;
        scrollPos = backInfo.backScroll || 0;
    }
    /* end nbowditch edit */

    //vars from exhibition
    var root = LADS.Util.getHtmlAjax(&#x27;NewCatalog.html&#x27;), // use AJAX to load html from .html file
        leftbar = root.find(&#x27;#leftbar&#x27;), // back-button, exhibit, tour selectors
        displayarea = root.find(&#x27;#displayarea&#x27;), 
        displayHelp, 
        exhibitarea = root.find(&#x27;#exhibitarea&#x27;), 
        currentExhElements, 
        img1,
        leftbarHeader = root.find(&#x27;#leftbar-header&#x27;), 
        exhibitionLabel = root.find(&#x27;#exhibition-label&#x27;), 
        exhibitionSpan = root.find(&#x27;#exhibitionSpan&#x27;), 
        contentdiv,
        imgDiv,
        descriptiontext,
        loadingArea,
        titlediv, 
        artworkSelected = false,
        switching = false, //boolean for switching the page
        exhibitelements = [], // this is shared between exhibitions and tours
        exhibTabSelected = true, //which tab is selected at the top (true for exhib, false for tour)
        firstLoad = true;

    var bgimage = root.find(&#x27;#bgimage&#x27;);

    var currExhibition = null,
        currentImage = null;

    // set values passed from previous page
    if (backExhibition) currExhibition = backExhibition;
    if (backArtwork) currentImage = backArtwork;
    var currExhibIndex = 0;
    var currTour = null;
    var numberOfTours, noTours, noArtworks;
    var toursGlobal;
    var loadQueue = LADS.Util.createQueue();
    var that = {
        getRoot: getRoot,
        loadExhibit: loadExhibit
    };
    container = container || window;

    var exLabels = [];
    that.exLabels = exLabels;

    // vars from Catalog
    var timelineDiv = root.find(&#x27;#timelineDiv&#x27;),
        artistButton = root.find(&#x27;#artistButton&#x27;),
        yearButton = root.find(&#x27;#yearButton&#x27;),
        titleButton = root.find(&#x27;#titleButton&#x27;),
        typeButton = root.find(&#x27;#typeButton&#x27;),
        row = root.find(&#x27;#row&#x27;),
        timelineDivContainer = root.find(&#x27;#timelineDivContainer&#x27;),
        search = root.find(&#x27;#searchInput&#x27;),
        searchTxt = root.find(&#x27;#searchTxt&#x27;),
        searchFilter = root.find(&#x27;#searchFilter&#x27;), // contains searchInput and searchTxt
        moreInfo,
        artistInfo,
        yearInfo,
        currentArtworks = [],
        infoSource = [],
        inSearch = false,
        defaultTag = &quot;Title&quot;,
        currentTag;

    init();

    return that;

    /**
    *initiates UI stuff
    */
    function init() {
        // create loading page
        loadingArea = $(document.createElement(&#x27;div&#x27;));
        loadingArea.attr(&#x27;id&#x27;, &#x27;loadingArea&#x27;);
        root.append(loadingArea);

        // set image paths
        root.find(&#x27;#catalogBackButton&#x27;).attr(&#x27;src&#x27;, tagPath+&#x27;images/icons/Back.svg&#x27;);
        root.find(&#x27;#feedback-icon&#x27;).attr(&#x27;src&#x27;, tagPath+&#x27;images/icons/FeedbackIcon.svg&#x27;);

        var progressCircCSS = { &quot;position&quot;: &#x27;absolute&#x27;, &#x27;z-index&#x27;: &#x27;50&#x27;, &#x27;height&#x27;: &#x27;auto&#x27;, &#x27;width&#x27;: &#x27;5%&#x27;, &#x27;left&#x27;: &#x27;47.5%&#x27;, &#x27;top&#x27;: &#x27;42.5%&#x27; };
        var centerhor = &#x27;0px&#x27;;
        var centerver = &#x27;0px&#x27;;
        var circle = LADS.Util.showProgressCircle(loadingArea, progressCircCSS, centerhor, centerver, false);

        // after loading finishes
        var overlay = root.find(&#x27;#overlay&#x27;);

        makeTimeline();

        artistButton
        .addClass(&#x27;rowButton&#x27;)
        .click(function () {
            changeDisplayTag(currentArtworks, &quot;Artist&quot;);
        });

        titleButton
        .addClass(&#x27;rowButton&#x27;)
        .click(function () {
            changeDisplayTag(currentArtworks, &quot;Title&quot;);
        });

        yearButton
        .addClass(&#x27;rowButton&#x27;)
        .click(function () {
            changeDisplayTag(currentArtworks, &quot;Year&quot;);
        });

        typeButton
        .addClass(&#x27;rowButton&#x27;)
        .click(function () {
            changeDisplayTag(currentArtworks, &quot;Type&quot;);
        });

        searchTxt.css({
            &#x27;font-size&#x27;: &#x27;80%&#x27;
        });

        //The search and filter begins here.
        search.attr(&quot;placeholder&quot;, &quot;Enter Keyword&quot;).blur();
        search.css({
            &#x27;max-height&#x27;: $(row).height()*0.75 + &#x27;%&#x27;,
            &#x27;font-size&#x27;: &#x27;80%&#x27;
        });
        
        // the following mousedown and mouseup handlers deal with clicking the &#x27;X&#x27; in the search box
        var oldSearchTerm;
        $(search).on(&#x27;mousedown&#x27;, function () {
            oldSearchTerm = $(search).val().toLowerCase();
        });

        $(search).mouseup(function () {
            setTimeout(function () {
                if ($(search).val().toLowerCase() !== oldSearchTerm) {
                    doSearch();
                }
            }, 1);
        });

        // search on keyup
        $(search).on(&#x27;keyup&#x27;, function (e) {
            doSearch();
        });

        var feedbackContainer = initFeedback();

        // Back button/overlay area
        var backbuttonArea = root.find(&#x27;#backbuttonArea&#x27;);

        var backbuttonIcon = root.find(&#x27;#catalogBackButton&#x27;);
        backbuttonIcon.css({
            &#x27;display&#x27;: (!forSplitscreen &amp;&amp; !LADS.Util.Splitscreen.on()) ? &#x27;block&#x27; : &#x27;none&#x27;
        });

        //handles changing the color when clicking/mousing over on the backButton
        backbuttonIcon.mouseleave(function () {
            LADS.Util.UI.cgBackColor(&quot;backButton&quot;, backbuttonIcon, true);
        });
        backbuttonIcon.mousedown(function () {
            LADS.Util.UI.cgBackColor(&quot;backButton&quot;, backbuttonIcon, false);
        });

        //opens the splash screen when the back button is clicked
        backbuttonIcon.click(function () {
            backbuttonIcon.off(&#x27;click&#x27;);
            LADS.Layout.StartPage(null, function (root) {
                LADS.Util.Splitscreen.setOn(false);
                LADS.Util.UI.slidePageRight(root);
            }, true);
        });

        // Labels (Exhibition)
        //var fontSize = LADS.Util.getMaxFontSizeEM(&#x27;Collections&#x27;, 2.5, $(container).width() * 0.085, 1000, 0.2);
        exhibitionLabel.css({
            //&#x27;font-size&#x27;: &#x27;2.1em&#x27;,
            &#x27;display&#x27;: (!forSplitscreen &amp;&amp; !LADS.Util.Splitscreen.on()) ? &#x27;display&#x27; : &#x27;none&#x27;
        });

        //have exhibition mode selected
        exhibitionSpan.mousedown(function () {
            $(this).css({ &#x27;color&#x27;: &#x27;white&#x27; });
        });

        // Main display area
        // Initial text displayed in display area
        displayHelp = $(document.createElement(&#x27;div&#x27;));
        displayHelp.attr(&#x27;id&#x27;, &#x27;displayHelp&#x27;);
        displayarea.append(displayHelp);

        var displayHelpTitle = $(document.createElement(&#x27;div&#x27;));
        displayHelpTitle.attr(&#x27;id&#x27;, &#x27;displayHelpTitle&#x27;);
        displayHelpTitle.text(&quot;Welcome to the &quot; + LADS.Worktop.Database.getMuseumName());

        var displayHelpText = $(document.createElement(&#x27;div&#x27;));
        displayHelpText.attr(&#x27;id&#x27; ,&#x27;displayHelpText&#x27;);
        displayHelpText.text(&quot;Select an exhibition or tour from the left menu to begin exploring artworks&quot;);

        displayHelp.append(displayHelpTitle);
        displayHelp.append(displayHelpText);

        // gets a list of exhibitions from the server or the cache
        LADS.Worktop.Database.getExhibitions(getExhibitionsHelper, null, getExhibitionsHelper);

        /**helper function to exhibitions**/
        function getExhibitionsHelper(exhibitionsLocal) {
            currentExhElements = {};
            currentExhElements.displayareasub = displayHelp; //asign displayhelp to displayareasub to each exhibition

            // Add exhibitions to sidebar
            var gotFirst = false;
            $.each(exhibitionsLocal, function (_, e) {
                var privateState;
                if (e.Metadata.Private) {
                    privateState = (/^true$/i).test(e.Metadata.Private);
                } else {
                    privateState = false;
                }
                if (!privateState &amp;&amp; LADS.Util.localVisibility(e.Identifier)) {
                    if (!gotFirst) {
                        bgimage.css(&#x27;background-image&#x27;, &quot;url(&quot; + LADS.Worktop.Database.fixPath(e.Metadata.BackgroundImage) + &quot;)&quot;);
                    }
                    addExhibit(e);
                    gotFirst = true;
                }
            });

            if (currExhibition) {
                loadExhibit(currExhibition, currExhibition);
                showExhibition(currExhibition);
                // debugger;
                $(&quot;#exhib-&quot; + currExhibition.Identifier).css({ &#x27;background-color&#x27;: &#x27;rgb(255,255,255)&#x27;, &#x27;color&#x27;: &#x27;black&#x27; });
            } else {
                clickExhibition(0);//have the first exhibition selected
            }
            loadingArea.hide();
        }   // end getting exhibition

    }   //end init()

    function clickExhibition(i) {
        if (exhibitelements[i])
            exhibitelements[i].click();
    }

    /**
     * Adds exhibitions to page
     *@param: exhibition to add
     * Creates button in sidebar
     */
    function addExhibit(exhibition) {
        var title = LADS.Util.htmlEntityDecode(exhibition.Name),
            toAddImage = $(document.createElement(&#x27;img&#x27;)),
            toAdd = $(document.createElement(&#x27;div&#x27;)),
            subInfo = $(document.createElement(&#x27;div&#x27;)),
            text = exhibition.Metadata.Description || &quot;&quot;,
            shortenedText = text ? text.substr(0, 18) + &quot;...&quot; : &quot;&quot;;

        text = text.replace(/&lt;br&gt;/g, &#x27;&#x27;).replace(/&lt;br \/&gt;/g, &#x27;&#x27;);

        toAdd = $(document.createElement(&#x27;div&#x27;));
        toAdd.attr(&#x27;id&#x27; ,&#x27;exhibition-selection&#x27;);

        var titleBox = $(document.createElement(&#x27;div&#x27;));
        titleBox.attr(&#x27;id&#x27; ,&#x27;exhibition-title&#x27;);
        
        titleBox.html(title);

        toAdd.append(titleBox);
        var size = 0.096 * 0.45 * $(window).height();
        
        // var exhibTitleSize = LADS.Util.getMaxFontSizeEM(&#x27;W&#x27;, 0.25, 9999, size * 0.85, 0.1);

		/*
        titleBox.css({
            &quot;font-size&quot;: &#x27;1.4em&#x27; //exhibTitleSize,            
        });
		*/

        exLabels.push(toAdd);
        exhibitarea.append(toAdd);
        toAdd.attr(&#x27;flagClicked&#x27;, &#x27;false&#x27;);
        toAdd.addClass(&#x27;collectionClickable&#x27;);
        toAdd.attr(&#x27;id&#x27;, &#x27;exhib-&#x27; + exhibition.Identifier);
    
        toAdd.mousedown(function () {
            $(this).css({ &#x27;background-color&#x27;: &#x27;white&#x27;});
            titleBox.css({&#x27;color&#x27;: &#x27;black&#x27;});
        });
       
        toAdd.mouseleave(function () {
            if ($(this).attr(&#x27;flagClicked&#x27;) == &#x27;false&#x27;) {
                $(this).css({ &#x27;background-color&#x27;: &#x27;transparent&#x27;, &#x27;color&#x27;: &#x27;white&#x27; });
                titleBox.css({&#x27;color&#x27;: &#x27;white&#x27;});
            }             
        });
    
        toAdd.on(&#x27;click&#x27;, function () {
            //put this all in diff func and call in constructor 
            for (var i = 0; i &lt; exhibitelements.length; i++) {
                // prevents animation if exhibit is already selected
                if (exhibitelements[i] != toAdd) {
                    exhibitelements[i].css({ &#x27;background-color&#x27;: &#x27;transparent&#x27;, &#x27;color&#x27;: &#x27;white&#x27; });
                    exhibitelements[i].data(&quot;selected&quot;, false);
                    exhibitelements[i].attr(&#x27;flagClicked&#x27;, &#x27;false&#x27;);
                    exhibitelements[i].children().css({&#x27;color&#x27;: &#x27;white&#x27;});
                }
            }
            $(this).attr(&#x27;flagClicked&#x27;, &#x27;true&#x27;);
            titleBox.css({&#x27;color&#x27;: &#x27;black&#x27;});
            currExhibition = exhibition;
            currentImage = null;
            loadExhibit.call(toAdd, currExhibition);
            scrollPos = 0; // nbowditch _editted 2/13/2014 
            showExhibition(currExhibition);

        });

        exhibitelements.push(toAdd);
    }


    /**
     * When exhibition is selected in sidebar,
     * this function creates description to display in main display area
     * @param: selected exhibition
     */
    // BM - privateExhib is a little bit of a hack to get private exhibits
    // to show in settings view.  When set to true it just ignores anything
    // that relies on &#x27;this&#x27; since &#x27;this&#x27; doesn&#x27;t exist for a private exhibit
    // (it doesn&#x27;t have a label in the exhib list)
    
    function loadExhibit(exhibition, privateExhib) {
        searchTxt.text(&quot;&quot;);

        timelineDiv &amp;&amp; timelineDiv.empty();

        //this refers to toAdd- just particular one
        if (exhibition) {
            bgimage.css(&#x27;background-image&#x27;, &quot;url(&quot; + LADS.Worktop.Database.fixPath(exhibition.Metadata.BackgroundImage) + &quot;)&quot;);// RIA ADDED
        }
        if (!privateExhib &amp;&amp; this.data(&quot;selected&quot;)) { return; }//if the exhibition has already been selected, do nothing

        if (!privateExhib) {
            this.data(&quot;selected&quot;, true);
        }
        // Start loading artwork now in background

        // Remove current contents of display area
        var d;
        if (firstLoad) {
            d = currentExhElements.displayareasub;
            d.remove();
            firstLoad = false;
        }
        else if (currentExhElements) {
            currentExhElements.block.remove();
            d = currentExhElements.displayareasub;
            d.css(&#x27;z-index&#x27;, 1000);
            d.remove();
        }

        var displayareasub = $(document.createElement(&#x27;div&#x27;));
        displayareasub.attr(&#x27;id&#x27; ,&#x27;displayareasub&#x27;);
        displayarea.append(displayareasub);

        currentExhElements = {};
        currentExhElements.block = $(document.createElement(&#x27;div&#x27;));
        if (!privateExhib) {
            currentExhElements.block.css({
                &quot;top&quot;: $(this).position().top, &quot;left&quot;: &quot;100%&quot;, &quot;height&quot;: $(this).css(&#x27;height&#x27;),
                &quot;width&quot;: &quot;4%&quot;, &quot;font-size&quot;: &quot;1.5em&quot;, &#x27;position&#x27;: &#x27;absolute&#x27;,
                &#x27;border&#x27;: &#x27;solid transparent&#x27;, &#x27;border-width&#x27;: &#x27;5px 0px 5px 0px&#x27;,
                &#x27;background-color&#x27;: &#x27;rgba(255,255,255,0)&#x27;, &#x27;z-index&#x27;: &#x27;50&#x27;
            });
        }

        // Make titles
        titlediv = $(document.createElement(&#x27;div&#x27;));
        titlediv.attr(&#x27;id&#x27;, &#x27;exhibition-name-div&#x27;);
        titlediv.text(LADS.Util.htmlEntityDecode(exhibition.Name));

        var w = $(container).width() * 0.75 * 0.8;
        
        currentExhElements.title = titlediv;

        // Display contains description, thumbnails and view button
        // TODO Might need to push this down farther (make top larger), Looks fine for now, though
        var display = $(document.createElement(&#x27;div&#x27;));
        display.attr(&#x27;id&#x27;, &#x27;exhibition-info&#x27;);

        displayareasub.append(display);

        currentExhElements.display = display;
        var fontSize = LADS.Util.getMaxFontSizeEM(exhibition.Name, 1.5, w, 0.2 * display.height(),0.2);
        titlediv.css({ &#x27;font-size&#x27;: fontSize });
        display.append(titlediv);

        // Contains text
        contentdiv = $(document.createElement(&#x27;div&#x27;));
        contentdiv.attr(&#x27;id&#x27;, &#x27;contentdiv&#x27;);
        contentdiv.css({
            &#x27;width&#x27;: &#x27;94%&#x27;, 
            &#x27;height&#x27;: &#x27;80%&#x27;, //(display.height()-titlediv.height()-20)+&quot;px&quot;,
        });
        display.append(contentdiv);

        imgDiv = $(document.createElement(&#x27;div&#x27;));
        imgDiv.attr(&#x27;id&#x27;, &#x27;img-container&#x27;);
        imgDiv.css({       
            height: &#x27;91.5%&#x27;, 
            width: &#x27;40%&#x27;, 
            position: &#x27;absolute&#x27;,
            top: &#x27;0%&#x27;,
        });

        img1 = $(document.createElement(&#x27;img&#x27;));
        img1.attr(&#x27;id&#x27;, &#x27;image&#x27;);
        img1.attr(&#x27;src&#x27;, LADS.Worktop.Database.fixPath(exhibition.Metadata.DescriptionImage1));
        img1.attr(&#x27;thumbnail&#x27;, LADS.Worktop.Database.fixPath(exhibition.Metadata.DescriptionImage1));       
        
        var exploreTabText = $(document.createElement(&#x27;div&#x27;));
        exploreTabText.attr(&#x27;id&#x27;,&#x27;explore-text&#x27;);

        var exploreTab = $(document.createElement(&#x27;div&#x27;));
        exploreTab.addClass(&#x27;explore-tab&#x27;);

        exploreTabText.text(&quot;Explore&quot;);
        exploreTab.on(&#x27;click&#x27;, function () {
            if (artworkSelected) {
                switchPage();
            }
        });

        var exploreIcon = $(document.createElement(&#x27;img&#x27;));
        exploreIcon.attr(&#x27;id&#x27;, &#x27;exploreIcon&#x27;);
        exploreIcon.attr(&#x27;src&#x27;, tagPath+&#x27;images/icons/ExploreIcon.svg&#x27;);

        exploreTab.append(exploreIcon);
        exploreTab.append(exploreTabText);    

        contentdiv.append(imgDiv);
        imgDiv.append(img1);
        imgDiv.append(exploreTab);
        exploreTabText.css(&quot;font-size&quot;, LADS.Util.getMaxFontSizeEM(&quot;Explore&quot;, 0.5, 0.5 * exploreTab.width(), 0.7 * exploreTab.height(),0.1));

        img1.on(&#x27;click&#x27;, function () {//exploreTab
            if (artworkSelected) {
                switchPage();
            }
        });

        moreInfo = $(document.createElement(&#x27;div&#x27;));
        moreInfo.attr(&#x27;id&#x27;, &#x27;info-text&#x27;);

        artistInfo = $(document.createElement(&#x27;div&#x27;));
        artistInfo.attr(&#x27;id&#x27;, &#x27;artistInfo&#x27;);
        artistInfo.css({
            &#x27;font-size&#x27;: &#x27;0.65em&#x27; 
        });

        yearInfo = $(document.createElement(&#x27;div&#x27;));
        yearInfo.attr(&#x27;id&#x27;, &#x27;yearInfo&#x27;);
        yearInfo.css({
            &#x27;font-size&#x27;: &#x27;0.65em&#x27; 
        });

        moreInfo.append(artistInfo);
        moreInfo.append(yearInfo);
        imgDiv.append(moreInfo);

        var progressCircCSS = {
            &#x27;position&#x27;: &#x27;absolute&#x27;,
            &#x27;float&#x27;: &#x27;left&#x27;,
            &#x27;left&#x27;: &#x27;12%&#x27;,
            &#x27;z-index&#x27;: &#x27;50&#x27;,
            &#x27;height&#x27;: &#x27;20%&#x27;,
            &#x27;width&#x27;: &#x27;auto&#x27;,
            &#x27;top&#x27;: &#x27;22%&#x27;,
        };
        

        var h1 = $(display).height() * 0.9;

        descriptiontext = $(document.createElement(&#x27;div&#x27;));
        descriptiontext.attr(&#x27;id&#x27;, &#x27;description-text&#x27;);

        var str;
        if (exhibition.Metadata.Description) {
            str = exhibition.Metadata.Description.replace(/\n\r?/g, &#x27;&lt;br /&gt;&#x27;);
        } else {
            str = &quot;&quot;;
        }
        
        descriptiontext.css({
            &#x27;height&#x27;: &#x27;91.5%&#x27;,
            &#x27;width&#x27;: &#x27;55%&#x27;, 
            &#x27;font-size&#x27;: 0.2 * LADS.Util.getMaxFontSizeEM(exhibition.Metadata.Description, 1.5, 0.55 * $(contentdiv).width(), 0.915 * $(contentdiv).height(), 0.1), // h1*0.055 + &#x27;px&#x27;,
        });
           
        descriptiontext.html(str);
        contentdiv.append(descriptiontext);
        var circle = LADS.Util.showProgressCircle(descriptiontext, progressCircCSS, &#x27;0px&#x27;, &#x27;0px&#x27;, false);
        img1.load(function () {
            LADS.Util.removeProgressCircle(circle);
        });

        if (!privateExhib)
            $(this).css({ &#x27;background-color&#x27;: &#x27;rgb(255,255,255)&#x27;, &#x27;color&#x27;: &#x27;black&#x27; });

        currentExhElements.displayareasub = displayareasub;

        $(document).ready(function () {
            displayareasub.css({ &#x27;width&#x27;: &#x27;100%&#x27;, &#x27;height&#x27;: &#x27;100%&#x27;, &#x27;left&#x27;: &#x27;0%&#x27; });
        });

    }


    function getTours(exhib, callback) {//dont send in anything
        //LADS.Worktop.Database.getTours(tourHelper, null, tourHelper);///getartwrksin
        LADS.Worktop.Database.getArtworksIn(exhib.Identifier, tourHelper, null, tourHelper);///getartwrksin

        function tourHelper(tours) {
            numberOfTours = tours.length;
            var publicTours=[];
            var k=0;
            for (var i = 0; i &lt; tours.length; i++) {
                if (tours[i].Metadata.Private !== &quot;true&quot;) {
                    //publicTours[tours.length-numberOfTours]=tours[i];//filter tours
                    numberOfTours--;
                }
                else {
                    publicTours.push(tours[i]);
                    k++;
                }
            }

            if (numberOfTours === 0) {
                noTours = true;
            }
            else {
                noTours = false;
            }

            //return tours;
            toursGlobal = publicTours;
            callback &amp;&amp; callback();
        }
        //check in gettoursand artworks if both are empty using a flag
    }

    function getArtworks(exhibition, callback) {//get rid of this func
         LADS.Worktop.Database.getArtworksIn(exhibition.Identifier, getArtworksHelper, null, getArtworksHelper);

        function getArtworksHelper(artworks) {
            if (!artworks || !artworks[0]) {//pops up a box warning user there is no artwork in the selected exhibition
                var noArtworksOptionBox = LADS.Util.UI.makeNoArtworksOptionBox();
                root.append(noArtworksOptionBox);
                $(noArtworksOptionBox).fadeIn(500);
                noArtworks = true;
               // return;
            }
            else { noArtworks = false; }

            //create tiles for artworks here
            if (toursGlobal &amp;&amp; toursGlobal.length) {
                artworks = toursGlobal.concat(artworks || []);//$.merge(toursGlobal, artworks);//causes error
            }
            createArtTiles(artworks);
            initSearch(artworks);
            callback &amp;&amp; callback();
        }
    }

    // store sorting source
    function initSearch(artworks) {
        $(search)[0].value = &quot;&quot;;
        infoSource = [];
        for (var i = 0; i &lt; artworks.length; i++) {
            var infos;
            if (!artworks[i]) { continue; }
            infos = artworks[i].Name + &quot; &quot;
                + artworks[i].Metadata.Artist + &quot; &quot;
                + artworks[i].Metadata.Year + &quot; &quot;
                + artworks[i].Metadata.Type;
            infos = infos.toLowerCase();
            infoSource.push({ &quot;id&quot;: i, &quot;keys&quot;: infos });
        }
    }

    function doSearch() {
        var content = $(search).val().toLowerCase();
        if (content === &quot;&quot;) {
            searchTxt.text(&quot;&quot;);
            drawTimeline(currentArtworks, currentTag, 0, false);
            return;
        }
        inSearch = true;
        var matchedArts = [], unmatchedArts = [];

        for (var i = 0; i &lt; infoSource.length; i++) {
            if (infoSource[i].keys.indexOf(content) &gt; -1) {
                matchedArts.push(currentArtworks[i]);
            }
            else {
                unmatchedArts.push(currentArtworks[i]);
            }
        }

        if (matchedArts.length &gt; 0) searchTxt.text(&quot;Results Found&quot;);
        else searchTxt.text(&quot;No Matching Results&quot;);
        var numDrawn = drawTimeline(matchedArts, currentTag, 0, true);
        drawTimeline(unmatchedArts, currentTag, numDrawn, false);
        inSearch = false;
    }


    function makeTimeline() {
        timelineDiv.scrollLeft();
    }

    function createArtTiles(artworks) {
        currentArtworks = artworks;
        currentTag = defaultTag;
        handleSelectTags(currentTag);
        drawTimeline(currentArtworks, currentTag, 0);
    }

    // artworks: artworks to be sorted
    // tag: current tag to be sorted by
    // start: the index in the array to start sort from
    // onSearch: used only for matched results to make it highlighted
    function drawTimeline(artworks, tag, start, onSearch) {
        if (!currExhibition) return;
        if (start === 0) {
            // console.log(&#x27;currExhib = &#x27; + currExhibition.Name);
            loadQueue.clear();
            setTimeout(function () {
                timelineDiv.empty();
            });
        }
        if (artworks === null) return;
        var sortedArtworks = sortTimeline(artworks, tag);
        var each = sortedArtworks.min();
        var currentWork = (each) ? each.artwork : null;
        var i = start;
        var h = $(timelineDiv).height() * 0.48;
        var w = h * 1.4;

        var works = sortedArtworks.getContents();
        for (var j = 0; j &lt; works.length; j++) {
            var k = j;
            loadQueue.add(drawArtworkTile(works[k].artwork, tag, onSearch, k + i, w, h));
            loadQueue.add(function () { timelineDiv.animate({ scrollLeft: scrollPos }, 0); });
        }
        

        return works.length;
    }

    function drawArtworkTile(currentWork, tag, onSearch, i, w, h) {
        return function () {
            var main = $(document.createElement(&#x27;div&#x27;));
            main.addClass(&quot;tile&quot;);
            //if (i &gt;= 2) return;
            main.css({
                &#x27;height&#x27;: &#x27;48%&#x27;, 
                &#x27;width&#x27;: &#x27;16%&#x27;, 
                &#x27;position&#x27;: &#x27;absolute&#x27;,
                &#x27;margin-left&#x27;: parseInt(i / 2) * 16.5 + 1 + &#x27;%&#x27;, // (parseInt(i / 2) * $(timelineDiv).width() * 0.16 * 1.03) + 10 + &quot;px&quot;,
                &#x27;margin-top&#x27;: (i % 2) * 12.25 + &#x27;%&#x27;, // ((i % 2) * $(timelineDiv).height() * 0.48 * 1.05) + &quot;px&quot;,
                &#x27;border&#x27;: &#x27;1px solid rgba(0,0,0,0.85)&#x27;,
            });

            main.on(&#x27;click&#x27;, function () {
                if (img1.attr(&#x27;guid&#x27;) === currentWork.Identifier) {
                    switchPage();
                } else {
                    showArtwork(currentWork)();
                }
            });

            var tourLabel = $(document.createElement(&#x27;img&#x27;));
            tourLabel.attr(&#x27;id&#x27;, &#x27;tourLabel&#x27;);
            tourLabel.attr(&#x27;src&#x27;, tagPath+&#x27;images/icons/catalog_tour_icon.svg&#x27;);
            tourLabel.css({
                &#x27;height&#x27;: &#x27;30%&#x27;, 
                &#x27;width&#x27;: &#x27;30%&#x27;, 
                &#x27;margin-right&#x27;: &#x27;-7%&#x27;
            });

            var videoLabel = $(document.createElement(&#x27;img&#x27;));
            videoLabel.attr(&#x27;id&#x27;, &#x27;videoLabel&#x27;);
            videoLabel.attr(&#x27;src&#x27;, tagPath+&#x27;images/icons/catalog_video_icon.svg&#x27;);
            videoLabel.css({
                &#x27;height&#x27;: &#x27;35%&#x27;, 
                &#x27;width&#x27;: &#x27;20%&#x27;, 
            });

            var image = $(document.createElement(&#x27;img&#x27;));
            //debugger;
            if(currentWork.Metadata.Thumbnail != null) {
                image.attr(&quot;src&quot;, LADS.Worktop.Database.fixPath(currentWork.Metadata.Thumbnail));
            }
            
            //&lt;img style=&quot;width: 100%; height: 100%; position: absolute;&quot; src=&quot;http://browntagserver.com:8086/Images/20121002202624.jpg&quot;&gt;
            else {
                image.attr(&quot;src&quot;, tagPath+&#x27;images/no_thumbnail.svg&#x27;);
            }
            
            image.css({ width: &#x27;100%&#x27;, height: &quot;100%&quot;, position: &#x27;absolute&#x27; });

            var specs = LADS.Util.constrainAndPosition(w, h,
            {
                center_h: true,
                center_v: true,
                width: 1.0,
                height: 0.20,
                max_height: 35,
            });

            var artTitle = $(document.createElement(&#x27;div&#x27;));
            artTitle.attr(&#x27;id&#x27;, &#x27;artTitle&#x27;);
            artTitle.css({
                &#x27;width&#x27;: &#x27;100%&#x27;, 
                &#x27;height&#x27;: &#x27;20%&#x27;, 
            });

            // text div for artwork
            var artText = $(document.createElement(&#x27;div&#x27;));
            artText.attr(&#x27;id&#x27;, &#x27;artText&#x27;);
			
			/*
            artText.css({
                &#x27;font-size&#x27;: &#x27;0.6em&#x27;, // ($(artTitle).height() * 0.55) + &quot;px&quot;,
            });
			*/

            if (tag === &#x27;Title&#x27;) {
                artText.text(LADS.Util.htmlEntityDecode(currentWork.Name));
            }
            else if (tag === &#x27;Artist&#x27;) artText.text(currentWork.Type === &#x27;Empty&#x27; ? &#x27;(Interactive Tour)&#x27; : currentWork.Metadata.Artist);
            else if (tag === &#x27;Year&#x27;) artText.text(currentWork.Type === &#x27;Empty&#x27; ? &#x27;(Interactive Tour)&#x27; : currentWork.Metadata.Year);
            else if (tag === &#x27;Type&#x27;) artText.text(LADS.Util.htmlEntityDecode(currentWork.Name));
            artTitle.append(artText);

            if (!onSearch &amp;&amp; $(search).val() !== &#x27;&#x27;) {
                image.css({ &#x27;opacity&#x27;: &#x27;0.3&#x27; });
                main.css(&#x27;border&#x27;, &#x27;1px solid black&#x27;);
            } else if (inSearch) {
                image.css({ &#x27;opacity&#x27;: &#x27;0.3&#x27; });
                main.css(&#x27;border&#x27;, &#x27;1px solid black&#x27;);
            } else if (onSearch) {
                image.css({ &#x27;opacity&#x27;: &#x27;1.0&#x27;});
                main.css(&#x27;border&#x27;, &#x27;1px solid white&#x27;);
            }
            main.append(image);
            main.append(artTitle);

            if (currentWork.Type === &quot;Empty&quot;) {
                main.append(tourLabel);
            }
            else if (currentWork.Metadata.Medium === &quot;Video&quot;) {
                main.append(videoLabel);
            }
            timelineDiv.append(main);
        };
    }

    function showArtwork(artwork) {
        return function () {
            currentImage = artwork;
            artworkSelected = true;
            $(&#x27;.explore-tab&#x27;).css(&#x27;display&#x27;, &#x27;inline-block&#x27;);

            if (artwork.Type != &quot;Empty&quot;) {
                if (artwork.Metadata.Artist === undefined) {
                    artistInfo.text(&quot;Artist: Unknown&quot;);
                } else {
                    artistInfo.text(&quot;Artist: &quot; + artwork.Metadata.Artist);
                }
                
                if (artwork.Metadata.Year === undefined) {
                    yearInfo.text(&quot;&quot;);
                } else {
                    yearInfo.text(artwork.Metadata.Year);
                }
            }
            else {
                artistInfo.text(&quot;Interactive Tour&quot; );
                yearInfo.text(&quot; &quot; );
            }
                
            img1.attr(&quot;src&quot;, artwork.Metadata.Thumbnail ? LADS.Worktop.Database.fixPath(artwork.Metadata.Thumbnail) : (tagPath+&#x27;images/no_thumbnail.svg&#x27;))
                .css(&#x27;border&#x27;, &#x27;1px solid rgba(0,0,0,0.5)&#x27;)
                .attr(&#x27;guid&#x27;, artwork.Identifier);
            
            var titleSpan = $(document.createElement(&#x27;div&#x27;))
                            .text(LADS.Util.htmlEntityDecode(artwork.Name))
                            .attr(&#x27;id&#x27;, &#x27;titleSpan&#x27;)
            
            var descSpan = $(document.createElement(&#x27;div&#x27;))
                            .attr(&#x27;id&#x27;, &#x27;descSpan&#x27;)
                            .html(artwork.Metadata.Description ? artwork.Metadata.Description.replace(/\n/g, &#x27;&lt;br /&gt;&#x27;) : &#x27;&#x27;);

            descriptiontext.empty();
            descriptiontext.append(titleSpan).append(descSpan);            
        };
    }

    function sortTimeline(artworks, tag) {
        var identical = 0;
        var comparator;
        var valuation;
        var avlTree;
        var artNode;
        var i;
        if (tag === &#x27;Title&#x27;) {
            identical = 0;
            comparator = function (a, b) {
                if (a.nameKey &lt; b.nameKey) {
                    return -1;
                } else if (a.nameKey &gt; b.nameKey) {
                    return 1;
                } else {
                    if (a.artwork.Identifier &gt; b.artwork.Identifier) {
                        return 1;
                    }
                    else if (a.artwork.Identifier &lt; b.artwork.Identifier) {
                        return -1;
                    } else {
                        return 0;
                    }
                }
            };

            valuation = function (value, compareToNode) {
                if (!compareToNode) {
                    return null;
                } else if (value &lt; compareToNode.nameKey) {
                    return -1;
                } else if (value &gt; compareToNode.nameKey) {
                    return 1;
                } else {
                    return 0;
                }
            };

            avlTree = new AVLTree(comparator, valuation);
            avlTree.clear();
            for (i = 0; i &lt; artworks.length; i++) {
                artNode = {
                    artwork: artworks[i],
                    nameKey: artworks[i].Name,
                };
                avlTree.add(artNode);
            }
            return avlTree;
        } else if (tag === &#x27;Artist&#x27;) {
            identical = 0;
            comparator = function (a, b) {
                if (a.artistKey &lt; b.artistKey) {
                    return -1;
                } else if (a.artistKey &gt; b.artistKey) {
                    return 1;
                } else {
                    if (a.artwork.Identifier &gt; b.artwork.Identifier) {
                        return 1;
                    } 
                    else if (a.artwork.Identifier &lt; b.artwork.Identifier) {
                        return -1;
                    } else {
                        return 0;
                    }
                }
            };

            valuation = function (value, compareToNode) {
                if (!compareToNode) {
                    return null;
                } else if (value &lt; compareToNode.artistKey) {
                    return -1;
                } else if (value &gt; compareToNode.artistKey) {
                    return 1;
                } else {
                    return 0;
                }
            };

            avlTree = new AVLTree(comparator, valuation);
            for (i = 0; i &lt; artworks.length; i++) {
                artNode = {
                    artwork: artworks[i],
                    artistKey: artworks[i].Type === &#x27;Empty&#x27; ? &#x27;~~~~&#x27; : artworks[i].Metadata.Artist
                };
                avlTree.add(artNode);
            }
            return avlTree;
        } else if (tag === &#x27;Year&#x27;) {
            identical = 0;
            comparator = function (a, b) {
                if (a.yearKey &lt; b.yearKey) {
                    return -1;
                } else if (a.yearKey &gt; b.yearKey) {
                    return 1;
                } else {
                    if (a.artwork.Identifier &gt; b.artwork.Identifier) {
                        return 1;
                    }
                    else if (a.artwork.Identifier &lt; b.artwork.Identifier) {
                        return -1;
                    } else {
                        return 0;
                    }
                }
            };

            valuation = function (value, compareToNode) {
                if (!compareToNode) {
                    return null;
                } else if (value &lt; compareToNode.yearKey) {
                    return -1;
                } else if (value &gt; compareToNode.yearKey) {
                    return 1;
                } else {
                    return 0;
                }
            };

            avlTree = new AVLTree(comparator, valuation);
            for (i = 0; i &lt; artworks.length; i++) {
                artNode = {
                    artwork: artworks[i],
                    yearKey: artworks[i].Type === &#x27;Empty&#x27; ? &#x27;~~~~&#x27; : artworks[i].Metadata.Year
                };
                avlTree.add(artNode);
            }
            return avlTree;
        } else if (tag === &#x27;Type&#x27;) {
            identical = 0;
            comparator = function (a, b) {
                if (a.typeKey &lt; b.typeKey) {
                    return -1;
                } else if (a.typeKey &gt; b.typeKey) {
                    return 1;
                } else {
                    if (a.nameKey &gt; b.nameKey) {
                        return 1;
                    }
                    else if (a.nameKey &lt; b.nameKey) {
                        return -1;
                    } else {
                        return 0;
                    }
                }
            };

            valuation = function (value, compareToNode) {
                if (!compareToNode) {
                    return null;
                } else if (value &lt; compareToNode.nameKey) {
                    return -1;
                } else if (value &gt; compareToNode.nameKey) {
                    return 1;
                } else {
                    return 0;
                }
            };

            avlTree = new AVLTree(comparator, valuation);
            for (i = 0; i &lt; artworks.length; i++) {
                artNode = {
                    artwork: artworks[i],
                    nameKey: artworks[i].Name,
                    typeKey: artworks[i].Type === &#x27;Empty&#x27; ? 1 : (artworks[i].Metadata.Type === &#x27;Artwork&#x27; ? 2 : 3)
                };
                avlTree.add(artNode);
            }
            return avlTree;
        }
        else return null; // error case: should check &#x27;tag&#x27;
    }

    function handleSelectTags(tag) {
        //unselected tags are gray
        artistButton.css(&quot;color&quot;, &quot;gray&quot;);
        titleButton.css(&quot;color&quot;, &quot;gray&quot;);
        yearButton.css(&quot;color&quot;, &quot;gray&quot;);
        typeButton.css(&quot;color&quot;, &quot;gray&quot;);

        switch (tag) {
            case &quot;Artist&quot;:
                artistButton.css(&quot;color&quot;, &quot;white&quot;);
                break;
            case &quot;Title&quot;:
                titleButton.css(&quot;color&quot;, &quot;white&quot;);
                break;
            case &quot;Year&quot;:
                yearButton.css(&quot;color&quot;, &quot;white&quot;);
                break;
            case &quot;Type&quot;:
                typeButton.css(&quot;color&quot;, &quot;white&quot;);
                break;
        }
    }

    /*
    **Changes the tag to a different one, and re-sorts.
    **@para:tag, which indicates how to arrange the artworks
    */
    function changeDisplayTag(artworks, tag) {
        var guidsSeen = [];
        currentTag = tag;
        handleSelectTags(currentTag);
        if (tag !== &#x27;Type&#x27;) drawTimeline(artworks, currentTag, 0, false);
        else { // sort by Type
            var toursArray = [], artsArray = [], videosArray = [];
            for (var i = 0; i &lt; artworks.length; i++) {
                if (guidsSeen.indexOf(artworks[i].Identifier) &lt; 0) {
                    guidsSeen.push(artworks[i].Identifier);
                } else {
                    continue;
                }
                if (artworks[i].Type === &quot;Empty&quot;) {
                    toursArray.push(artworks[i]);
                }
                else if (artworks[i].Metadata.Type === &quot;Artwork&quot;) {
                    artsArray.push(artworks[i]);
                }
                else {
                    videosArray.push(artworks[i]);
                }
            } //  done sorting
            drawTimeline(toursArray, &quot;Title&quot;, 0, false);
            drawTimeline(artsArray, &quot;Title&quot;, toursArray.length, false);
            drawTimeline(videosArray, &quot;Title&quot;, toursArray.length + artsArray.length, false);
        }
        doSearch(); // should sort by new tag
    }

    function switchPageTour(tour) {
        var rinData, rinPlayer;
       
        rinData = JSON.parse(unescape(tour.Metadata.Content));
            if (!rinData || !rinData.data) {
                var messageBox = $(LADS.Util.UI.popUpMessage(null, &quot;Cannot play empty tour.&quot;, null));
                messageBox.css(&#x27;z-index&#x27;, LADS.TourAuthoring.Constants.aboveRinZIndex + 7);
                root.append(messageBox);
                messageBox.fadeIn(500);
                switching = false;
                return;
            }
            /* nbowditch _editted 2/13/2014 : added prevInfo */
            scrollPos = timelineDiv.scrollLeft();
            var prevInfo = { artworkPrev: null, prevScroll: scrollPos };
            rinPlayer = new LADS.Layout.TourPlayer(rinData, currExhibition, prevInfo, null, tour);//error here-in util, line 524
            /* end nbowditch edit */

            if (LADS.Util.Splitscreen.on()) {//if the splitscreen is on, exit it.
                var parentid = root.parent().attr(&#x27;id&#x27;);
                LADS.Util.Splitscreen.exit(parentid[parentid.length - 1]);
            }

            LADS.Util.UI.slidePageLeftSplit(root, rinPlayer.getRoot(), rinPlayer.startPlayback);
        
    }

    function switchPage() {
        if (!currentImage)
            return;//do nothing when there is no artwork in this catalog
        var curOpts, deepZoom, splitopts,
            opts = getState(), confirmationBox;
        //check the splitscreen states.
        if (root.parent().attr(&#x27;id&#x27;) === &#x27;metascreen-R&#x27;) {
            splitopts = &#x27;R&#x27;;
        } else {
            splitopts = &#x27;L&#x27;;
        }
        curOpts = { catalogState: opts, doq: currentImage, split: splitopts };

        if (currentImage.Type === &quot;Empty&quot;) {
            // put in a check for splitscreen here
            if (LADS.Util.Splitscreen.on()) {
                confirmationBox = LADS.Util.UI.PopUpConfirmation(function(){
                    switchPageTour(currentImage);
                }, &quot;By opening this tour, you will exit split screen mode. Would you like to continue?&quot;,
                &quot;Continue&quot;, false, function () {
                    $(confirmationBox).remove();
                }, root);
                $(confirmationBox).css(&#x27;z-index&#x27;, 10001);
                root.append($(confirmationBox));
                $(confirmationBox).show();
            } else {
                switchPageTour(currentImage);
            }
        }
        else if (currentImage.Metadata.Type === &quot;VideoArtwork&quot;) {
            /* nbowditch _editted 2/13/2013 : added prevInfo */
            scrollPos = timelineDiv.scrollLeft();
            var prevInfo = {artworkPrev: null, prevScroll: scrollPos};
            var video = new LADS.Layout.VideoPlayer(currentImage, currExhibition, prevInfo);
            /* end nbowditch edit */
            LADS.Util.UI.slidePageLeftSplit(root, video.getRoot());//have the page sliding to left and 
        }
        else {//if it&#x27;s an image
            
            /* nbowditch _editted 2/13/2014 : added prevInfo */
            scrollPos = timelineDiv.scrollLeft();
            var prevInfo = {prevPage: &quot;catalog&quot;, prevScroll: scrollPos};
            deepZoom = new LADS.Layout.Artmode(prevInfo, curOpts, currExhibition);
            /* end nbowditch edit */
            LADS.Util.UI.slidePageLeftSplit(root, deepZoom.getRoot());//have the page sliding to left and 
        }
        root.css({ &#x27;overflow-x&#x27;: &#x27;hidden&#x27; });
    }

    function initFeedback() {
        var feedbackContainer = root.find(&#x27;#feedbackContainer&#x27;); 

        var feedbackIcon = root.find(&#x27;#feedbackIcon&#x27;); 
        feedbackIcon.css({
            &#x27;display&#x27;: (!forSplitscreen &amp;&amp; !LADS.Util.Splitscreen.on()) ? &#x27;inline&#x27; : &#x27;none&#x27;,
        });

        var feedbackBox = LADS.Util.UI.FeedbackBox(&quot;Exhibition&quot;, getCurrentID);
        root.append(feedbackBox);

        feedbackContainer.click(makeFeedback);
        function makeFeedback() {
            $(feedbackBox).css({ 
                &#x27;display&#x27;: &#x27;block&#x27;
            });
        }

        return feedbackContainer;
    }

    function getCurrentID() {
        if (currExhibition) {
            return currExhibition.Identifier;
        } else {
            return &quot;&quot;;
        }
    }

    function showExhibition (e) {
        getTours(e, function () { // TODO make this better
            getArtworks(e, function () {
                if (currentImage)
                    showArtwork(currentImage)();
            });
        });
    }

    function getState() {
        return {
            exhibition: currExhibition,
            currentTag: defaultTag,
            currentImage: currentImage
        };
    }

    function getRoot() {
        return root;
    }

};

LADS.Layout.NewCatalog.default_options = {};
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
