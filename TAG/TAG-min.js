var TAG=function(t){!function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw Error("jQuery requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:this,function(t,e){function n(t){var e=t.length,n=ae.type(t);return"function"===n||ae.isWindow(t)?!1:1===t.nodeType&&e?!0:"array"===n||0===e||"number"==typeof e&&e>0&&e-1 in t}function i(t,e,n){if(ae.isFunction(e))return ae.grep(t,function(t,i){return!!e.call(t,i,t)!==n});if(e.nodeType)return ae.grep(t,function(t){return t===e!==n});if("string"==typeof e){if(pe.test(e))return ae.filter(e,t,n);e=ae.filter(e,t)}return ae.grep(t,function(t){return ae.inArray(t,e)>=0!==n})}function r(t,e){do t=t[e];while(t&&1!==t.nodeType);return t}function a(t){var e=Te[t]={};return ae.each(t.match(xe)||[],function(t,n){e[n]=!0}),e}function o(){ge.addEventListener?(ge.removeEventListener("DOMContentLoaded",s,!1),t.removeEventListener("load",s,!1)):(ge.detachEvent("onreadystatechange",s),t.detachEvent("onload",s))}function s(){(ge.addEventListener||"load"===event.type||"complete"===ge.readyState)&&(o(),ae.ready())}function l(t,e,n){if(void 0===n&&1===t.nodeType){var i="data-"+e.replace(Ce,"-$1").toLowerCase();if(n=t.getAttribute(i),"string"==typeof n){try{n="true"===n?!0:"false"===n?!1:"null"===n?null:+n+""===n?+n:_e.test(n)?ae.parseJSON(n):n}catch(r){}ae.data(t,e,n)}else n=void 0}return n}function c(t){var e;for(e in t)if(("data"!==e||!ae.isEmptyObject(t[e]))&&"toJSON"!==e)return!1;return!0}function u(t,e,n,i){if(ae.acceptData(t)){var r,a,o=ae.expando,s=t.nodeType,l=s?ae.cache:t,c=s?t[o]:t[o]&&o;if(c&&l[c]&&(i||l[c].data)||void 0!==n||"string"!=typeof e)return c||(c=s?t[o]=Y.pop()||ae.guid++:o),l[c]||(l[c]=s?{}:{toJSON:ae.noop}),("object"==typeof e||"function"==typeof e)&&(i?l[c]=ae.extend(l[c],e):l[c].data=ae.extend(l[c].data,e)),a=l[c],i||(a.data||(a.data={}),a=a.data),void 0!==n&&(a[ae.camelCase(e)]=n),"string"==typeof e?(r=a[e],null==r&&(r=a[ae.camelCase(e)])):r=a,r}}function d(t,e,n){if(ae.acceptData(t)){var i,r,a=t.nodeType,o=a?ae.cache:t,s=a?t[ae.expando]:ae.expando;if(o[s]){if(e&&(i=n?o[s]:o[s].data)){ae.isArray(e)?e=e.concat(ae.map(e,ae.camelCase)):e in i?e=[e]:(e=ae.camelCase(e),e=e in i?[e]:e.split(" ")),r=e.length;for(;r--;)delete i[e[r]];if(n?!c(i):!ae.isEmptyObject(i))return}(n||(delete o[s].data,c(o[s])))&&(a?ae.cleanData([t],!0):ie.deleteExpando||o!=o.window?delete o[s]:o[s]=null)}}}function h(){return!0}function p(){return!1}function f(){try{return ge.activeElement}catch(t){}}function g(t){var e=Le.split("|"),n=t.createDocumentFragment();if(n.createElement)for(;e.length;)n.createElement(e.pop());return n}function m(t,e){var n,i,r=0,a=typeof t.getElementsByTagName!==Ae?t.getElementsByTagName(e||"*"):typeof t.querySelectorAll!==Ae?t.querySelectorAll(e||"*"):void 0;if(!a)for(a=[],n=t.childNodes||t;null!=(i=n[r]);r++)!e||ae.nodeName(i,e)?a.push(i):ae.merge(a,m(i,e));return void 0===e||e&&ae.nodeName(t,e)?ae.merge([t],a):a}function v(t){De.test(t.type)&&(t.defaultChecked=t.checked)}function y(t,e){return ae.nodeName(t,"table")&&ae.nodeName(11!==e.nodeType?e:e.firstChild,"tr")?t.getElementsByTagName("tbody")[0]||t.appendChild(t.ownerDocument.createElement("tbody")):t}function b(t){return t.type=(null!==ae.find.attr(t,"type"))+"/"+t.type,t}function x(t){var e=Ye.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function T(t,e){for(var n,i=0;null!=(n=t[i]);i++)ae._data(n,"globalEval",!e||ae._data(e[i],"globalEval"))}function w(t,e){if(1===e.nodeType&&ae.hasData(t)){var n,i,r,a=ae._data(t),o=ae._data(e,a),s=a.events;if(s){delete o.handle,o.events={};for(n in s)for(i=0,r=s[n].length;r>i;i++)ae.event.add(e,n,s[n][i])}o.data&&(o.data=ae.extend({},o.data))}}function k(t,e){var n,i,r;if(1===e.nodeType){if(n=e.nodeName.toLowerCase(),!ie.noCloneEvent&&e[ae.expando]){r=ae._data(e);for(i in r.events)ae.removeEvent(e,i,r.handle);e.removeAttribute(ae.expando)}"script"===n&&e.text!==t.text?(b(e).text=t.text,x(e)):"object"===n?(e.parentNode&&(e.outerHTML=t.outerHTML),ie.html5Clone&&t.innerHTML&&!ae.trim(e.innerHTML)&&(e.innerHTML=t.innerHTML)):"input"===n&&De.test(t.type)?(e.defaultChecked=e.checked=t.checked,e.value!==t.value&&(e.value=t.value)):"option"===n?e.defaultSelected=e.selected=t.defaultSelected:("input"===n||"textarea"===n)&&(e.defaultValue=t.defaultValue)}}function A(e,n){var i=ae(n.createElement(e)).appendTo(n.body),r=t.getDefaultComputedStyle?t.getDefaultComputedStyle(i[0]).display:ae.css(i[0],"display");return i.detach(),r}function _(t){var e=ge,n=tn[t];return n||(n=A(t,e),"none"!==n&&n||(Je=(Je||ae("<iframe frameborder='0' width='0' height='0'/>")).appendTo(e.documentElement),e=(Je[0].contentWindow||Je[0].contentDocument).document,e.write(),e.close(),n=A(t,e),Je.detach()),tn[t]=n),n}function C(t,e){return{get:function(){var n=t();return null!=n?n?void delete this.get:(this.get=e).apply(this,arguments):void 0}}}function E(t,e){if(e in t)return e;for(var n=e.charAt(0).toUpperCase()+e.slice(1),i=e,r=fn.length;r--;)if(e=fn[r]+n,e in t)return e;return i}function S(t,e){for(var n,i,r,a=[],o=0,s=t.length;s>o;o++)i=t[o],i.style&&(a[o]=ae._data(i,"olddisplay"),n=i.style.display,e?(a[o]||"none"!==n||(i.style.display=""),""===i.style.display&&Me(i)&&(a[o]=ae._data(i,"olddisplay",_(i.nodeName)))):a[o]||(r=Me(i),(n&&"none"!==n||!r)&&ae._data(i,"olddisplay",r?n:ae.css(i,"display"))));for(o=0;s>o;o++)i=t[o],i.style&&(e&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=e?a[o]||"":"none"));return t}function M(t,e,n){var i=un.exec(e);return i?Math.max(0,i[1]-(n||0))+(i[2]||"px"):e}function I(t,e,n,i,r){for(var a=n===(i?"border":"content")?4:"width"===e?1:0,o=0;4>a;a+=2)"margin"===n&&(o+=ae.css(t,n+Se[a],!0,r)),i?("content"===n&&(o-=ae.css(t,"padding"+Se[a],!0,r)),"margin"!==n&&(o-=ae.css(t,"border"+Se[a]+"Width",!0,r))):(o+=ae.css(t,"padding"+Se[a],!0,r),"padding"!==n&&(o+=ae.css(t,"border"+Se[a]+"Width",!0,r)));return o}function D(t,e,n){var i=!0,r="width"===e?t.offsetWidth:t.offsetHeight,a=en(t),o=ie.boxSizing()&&"border-box"===ae.css(t,"boxSizing",!1,a);if(0>=r||null==r){if(r=nn(t,e,a),(0>r||null==r)&&(r=t.style[e]),an.test(r))return r;i=o&&(ie.boxSizingReliable()||r===t.style[e]),r=parseFloat(r)||0}return r+I(t,e,n||(o?"border":"content"),i,a)+"px"}function P(t,e,n,i,r){return new P.prototype.init(t,e,n,i,r)}function $(){return setTimeout(function(){gn=void 0}),gn=ae.now()}function N(t,e){var n,i={height:t},r=0;for(e=e?1:0;4>r;r+=2-e)n=Se[r],i["margin"+n]=i["padding"+n]=t;return e&&(i.opacity=i.width=t),i}function G(t,e,n){for(var i,r=(Tn[e]||[]).concat(Tn["*"]),a=0,o=r.length;o>a;a++)if(i=r[a].call(n,e,t))return i}function O(t,e,n){var i,r,a,o,s,l,c,u,d=this,h={},p=t.style,f=t.nodeType&&Me(t),g=ae._data(t,"fxshow");n.queue||(s=ae._queueHooks(t,"fx"),null==s.unqueued&&(s.unqueued=0,l=s.empty.fire,s.empty.fire=function(){s.unqueued||l()}),s.unqueued++,d.always(function(){d.always(function(){s.unqueued--,ae.queue(t,"fx").length||s.empty.fire()})})),1===t.nodeType&&("height"in e||"width"in e)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],c=ae.css(t,"display"),u=_(t.nodeName),"none"===c&&(c=u),"inline"===c&&"none"===ae.css(t,"float")&&(ie.inlineBlockNeedsLayout&&"inline"!==u?p.zoom=1:p.display="inline-block")),n.overflow&&(p.overflow="hidden",ie.shrinkWrapBlocks()||d.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(i in e)if(r=e[i],vn.exec(r)){if(delete e[i],a=a||"toggle"===r,r===(f?"hide":"show")){if("show"!==r||!g||void 0===g[i])continue;f=!0}h[i]=g&&g[i]||ae.style(t,i)}if(!ae.isEmptyObject(h)){g?"hidden"in g&&(f=g.hidden):g=ae._data(t,"fxshow",{}),a&&(g.hidden=!f),f?ae(t).show():d.done(function(){ae(t).hide()}),d.done(function(){var e;ae._removeData(t,"fxshow");for(e in h)ae.style(t,e,h[e])});for(i in h)o=G(f?g[i]:0,i,d),i in g||(g[i]=o.start,f&&(o.end=o.start,o.start="width"===i||"height"===i?1:0))}}function L(t,e){var n,i,r,a,o;for(n in t)if(i=ae.camelCase(n),r=e[i],a=t[n],ae.isArray(a)&&(r=a[1],a=t[n]=a[0]),n!==i&&(t[i]=a,delete t[n]),o=ae.cssHooks[i],o&&"expand"in o){a=o.expand(a),delete t[i];for(n in a)n in t||(t[n]=a[n],e[n]=r)}else e[i]=r}function F(t,e,n){var i,r,a=0,o=xn.length,s=ae.Deferred().always(function(){delete l.elem}),l=function(){if(r)return!1;for(var e=gn||$(),n=Math.max(0,c.startTime+c.duration-e),i=n/c.duration||0,a=1-i,o=0,l=c.tweens.length;l>o;o++)c.tweens[o].run(a);return s.notifyWith(t,[c,a,n]),1>a&&l?n:(s.resolveWith(t,[c]),!1)},c=s.promise({elem:t,props:ae.extend({},e),opts:ae.extend(!0,{specialEasing:{}},n),originalProperties:e,originalOptions:n,startTime:gn||$(),duration:n.duration,tweens:[],createTween:function(e,n){var i=ae.Tween(t,c.opts,e,n,c.opts.specialEasing[e]||c.opts.easing);return c.tweens.push(i),i},stop:function(e){var n=0,i=e?c.tweens.length:0;if(r)return this;for(r=!0;i>n;n++)c.tweens[n].run(1);return e?s.resolveWith(t,[c,e]):s.rejectWith(t,[c,e]),this}}),u=c.props;for(L(u,c.opts.specialEasing);o>a;a++)if(i=xn[a].call(c,t,u,c.opts))return i;return ae.map(u,G,c),ae.isFunction(c.opts.start)&&c.opts.start.call(t,c),ae.fx.timer(ae.extend(l,{elem:t,anim:c,queue:c.opts.queue})),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}function B(t){return function(e,n){"string"!=typeof e&&(n=e,e="*");var i,r=0,a=e.toLowerCase().match(xe)||[];if(ae.isFunction(n))for(;i=a[r++];)"+"===i.charAt(0)?(i=i.slice(1)||"*",(t[i]=t[i]||[]).unshift(n)):(t[i]=t[i]||[]).push(n)}}function R(t,e,n,i){function r(s){var l;return a[s]=!0,ae.each(t[s]||[],function(t,s){var c=s(e,n,i);return"string"!=typeof c||o||a[c]?o?!(l=c):void 0:(e.dataTypes.unshift(c),r(c),!1)}),l}var a={},o=t===Wn;return r(e.dataTypes[0])||!a["*"]&&r("*")}function H(t,e){var n,i,r=ae.ajaxSettings.flatOptions||{};for(i in e)void 0!==e[i]&&((r[i]?t:n||(n={}))[i]=e[i]);return n&&ae.extend(!0,t,n),t}function U(t,e,n){for(var i,r,a,o,s=t.contents,l=t.dataTypes;"*"===l[0];)l.shift(),void 0===r&&(r=t.mimeType||e.getResponseHeader("Content-Type"));if(r)for(o in s)if(s[o]&&s[o].test(r)){l.unshift(o);break}if(l[0]in n)a=l[0];else{for(o in n){if(!l[0]||t.converters[o+" "+l[0]]){a=o;break}i||(i=o)}a=a||i}return a?(a!==l[0]&&l.unshift(a),n[a]):void 0}function z(t,e,n,i){var r,a,o,s,l,c={},u=t.dataTypes.slice();if(u[1])for(o in t.converters)c[o.toLowerCase()]=t.converters[o];for(a=u.shift();a;)if(t.responseFields[a]&&(n[t.responseFields[a]]=e),!l&&i&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),l=a,a=u.shift())if("*"===a)a=l;else if("*"!==l&&l!==a){if(o=c[l+" "+a]||c["* "+a],!o)for(r in c)if(s=r.split(" "),s[1]===a&&(o=c[l+" "+s[0]]||c["* "+s[0]])){o===!0?o=c[r]:c[r]!==!0&&(a=s[0],u.unshift(s[1]));break}if(o!==!0)if(o&&t["throws"])e=o(e);else try{e=o(e)}catch(d){return{state:"parsererror",error:o?d:"No conversion from "+l+" to "+a}}}return{state:"success",data:e}}function j(t,e,n,i){var r;if(ae.isArray(e))ae.each(e,function(e,r){n||Xn.test(t)?i(t,r):j(t+"["+("object"==typeof r?e:"")+"]",r,n,i)});else if(n||"object"!==ae.type(e))i(t,e);else for(r in e)j(t+"["+r+"]",e[r],n,i)}function W(){try{return new t.XMLHttpRequest}catch(e){}}function q(){try{return new t.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}function V(t){return ae.isWindow(t)?t:9===t.nodeType?t.defaultView||t.parentWindow:!1}var Y=[],X=Y.slice,K=Y.concat,Z=Y.push,Q=Y.indexOf,J={},te=J.toString,ee=J.hasOwnProperty,ne="".trim,ie={},re="1.11.0",ae=function(t,e){return new ae.fn.init(t,e)},oe=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,se=/^-ms-/,le=/-([\da-z])/gi,ce=function(t,e){return e.toUpperCase()};ae.fn=ae.prototype={jquery:re,constructor:ae,selector:"",length:0,toArray:function(){return X.call(this)},get:function(t){return null!=t?0>t?this[t+this.length]:this[t]:X.call(this)},pushStack:function(t){var e=ae.merge(this.constructor(),t);return e.prevObject=this,e.context=this.context,e},each:function(t,e){return ae.each(this,t,e)},map:function(t){return this.pushStack(ae.map(this,function(e,n){return t.call(e,n,e)}))},slice:function(){return this.pushStack(X.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,n=+t+(0>t?e:0);return this.pushStack(n>=0&&e>n?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:Z,sort:Y.sort,splice:Y.splice},ae.extend=ae.fn.extend=function(){var t,e,n,i,r,a,o=arguments[0]||{},s=1,l=arguments.length,c=!1;for("boolean"==typeof o&&(c=o,o=arguments[s]||{},s++),"object"==typeof o||ae.isFunction(o)||(o={}),s===l&&(o=this,s--);l>s;s++)if(null!=(r=arguments[s]))for(i in r)t=o[i],n=r[i],o!==n&&(c&&n&&(ae.isPlainObject(n)||(e=ae.isArray(n)))?(e?(e=!1,a=t&&ae.isArray(t)?t:[]):a=t&&ae.isPlainObject(t)?t:{},o[i]=ae.extend(c,a,n)):void 0!==n&&(o[i]=n));return o},ae.extend({expando:"jQuery"+(re+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw Error(t)},noop:function(){},isFunction:function(t){return"function"===ae.type(t)},isArray:Array.isArray||function(t){return"array"===ae.type(t)},isWindow:function(t){return null!=t&&t==t.window},isNumeric:function(t){return t-parseFloat(t)>=0},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},isPlainObject:function(t){var e;if(!t||"object"!==ae.type(t)||t.nodeType||ae.isWindow(t))return!1;try{if(t.constructor&&!ee.call(t,"constructor")&&!ee.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}if(ie.ownLast)for(e in t)return ee.call(t,e);for(e in t);return void 0===e||ee.call(t,e)},type:function(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?J[te.call(t)]||"object":typeof t},globalEval:function(e){e&&ae.trim(e)&&(t.execScript||function(e){t.eval.call(t,e)})(e)},camelCase:function(t){return t.replace(se,"ms-").replace(le,ce)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()},each:function(t,e,i){var r,a=0,o=t.length,s=n(t);if(i){if(s)for(;o>a&&(r=e.apply(t[a],i),r!==!1);a++);else for(a in t)if(r=e.apply(t[a],i),r===!1)break}else if(s)for(;o>a&&(r=e.call(t[a],a,t[a]),r!==!1);a++);else for(a in t)if(r=e.call(t[a],a,t[a]),r===!1)break;return t},trim:ne&&!ne.call("﻿ ")?function(t){return null==t?"":ne.call(t)}:function(t){return null==t?"":(t+"").replace(oe,"")},makeArray:function(t,e){var i=e||[];return null!=t&&(n(Object(t))?ae.merge(i,"string"==typeof t?[t]:t):Z.call(i,t)),i},inArray:function(t,e,n){var i;if(e){if(Q)return Q.call(e,t,n);for(i=e.length,n=n?0>n?Math.max(0,i+n):n:0;i>n;n++)if(n in e&&e[n]===t)return n}return-1},merge:function(t,e){for(var n=+e.length,i=0,r=t.length;n>i;)t[r++]=e[i++];if(n!==n)for(;void 0!==e[i];)t[r++]=e[i++];return t.length=r,t},grep:function(t,e,n){for(var i,r=[],a=0,o=t.length,s=!n;o>a;a++)i=!e(t[a],a),i!==s&&r.push(t[a]);return r},map:function(t,e,i){var r,a=0,o=t.length,s=n(t),l=[];if(s)for(;o>a;a++)r=e(t[a],a,i),null!=r&&l.push(r);else for(a in t)r=e(t[a],a,i),null!=r&&l.push(r);return K.apply([],l)},guid:1,proxy:function(t,e){var n,i,r;return"string"==typeof e&&(r=t[e],e=t,t=r),ae.isFunction(t)?(n=X.call(arguments,2),i=function(){return t.apply(e||this,n.concat(X.call(arguments)))},i.guid=t.guid=t.guid||ae.guid++,i):void 0},now:function(){return+new Date},support:ie}),ae.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){J["[object "+e+"]"]=e.toLowerCase()});var ue=function(t){function e(t,e,n,i){var r,a,o,s,l,c,d,f,g,m;if((e?e.ownerDocument||e:R)!==P&&D(e),e=e||P,n=n||[],!t||"string"!=typeof t)return n;if(1!==(s=e.nodeType)&&9!==s)return[];if(N&&!i){if(r=ye.exec(t))if(o=r[1]){if(9===s){if(a=e.getElementById(o),!a||!a.parentNode)return n;if(a.id===o)return n.push(a),n}else if(e.ownerDocument&&(a=e.ownerDocument.getElementById(o))&&F(e,a)&&a.id===o)return n.push(a),n}else{if(r[2])return J.apply(n,e.getElementsByTagName(t)),n;if((o=r[3])&&k.getElementsByClassName&&e.getElementsByClassName)return J.apply(n,e.getElementsByClassName(o)),n}if(k.qsa&&(!G||!G.test(t))){if(f=d=B,g=e,m=9===s&&t,1===s&&"object"!==e.nodeName.toLowerCase()){for(c=h(t),(d=e.getAttribute("id"))?f=d.replace(xe,"\\$&"):e.setAttribute("id",f),f="[id='"+f+"'] ",l=c.length;l--;)c[l]=f+p(c[l]);g=be.test(t)&&u(e.parentNode)||e,m=c.join(",")}if(m)try{return J.apply(n,g.querySelectorAll(m)),n}catch(v){}finally{d||e.removeAttribute("id")}}}return T(t.replace(le,"$1"),e,n,i)}function n(){function t(n,i){return e.push(n+" ")>A.cacheLength&&delete t[e.shift()],t[n+" "]=i}var e=[];return t}function i(t){return t[B]=!0,t}function r(t){var e=P.createElement("div");try{return!!t(e)}catch(n){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function a(t,e){for(var n=t.split("|"),i=t.length;i--;)A.attrHandle[n[i]]=e}function o(t,e){var n=e&&t,i=n&&1===t.nodeType&&1===e.nodeType&&(~e.sourceIndex||Y)-(~t.sourceIndex||Y);if(i)return i;if(n)for(;n=n.nextSibling;)if(n===e)return-1;return t?1:-1}function s(t){return function(e){var n=e.nodeName.toLowerCase();return"input"===n&&e.type===t}}function l(t){return function(e){var n=e.nodeName.toLowerCase();return("input"===n||"button"===n)&&e.type===t}}function c(t){return i(function(e){return e=+e,i(function(n,i){for(var r,a=t([],n.length,e),o=a.length;o--;)n[r=a[o]]&&(n[r]=!(i[r]=n[r]))})})}function u(t){return t&&typeof t.getElementsByTagName!==V&&t}function d(){}function h(t,n){var i,r,a,o,s,l,c,u=j[t+" "];if(u)return n?0:u.slice(0);for(s=t,l=[],c=A.preFilter;s;){(!i||(r=ce.exec(s)))&&(r&&(s=s.slice(r[0].length)||s),l.push(a=[])),i=!1,(r=ue.exec(s))&&(i=r.shift(),a.push({value:i,type:r[0].replace(le," ")}),s=s.slice(i.length));for(o in A.filter)!(r=fe[o].exec(s))||c[o]&&!(r=c[o](r))||(i=r.shift(),a.push({value:i,type:o,matches:r}),s=s.slice(i.length));if(!i)break}return n?s.length:s?e.error(t):j(t,l).slice(0)}function p(t){for(var e=0,n=t.length,i="";n>e;e++)i+=t[e].value;return i}function f(t,e,n){var i=e.dir,r=n&&"parentNode"===i,a=U++;return e.first?function(e,n,a){for(;e=e[i];)if(1===e.nodeType||r)return t(e,n,a)}:function(e,n,o){var s,l,c=[H,a];if(o){for(;e=e[i];)if((1===e.nodeType||r)&&t(e,n,o))return!0}else for(;e=e[i];)if(1===e.nodeType||r){if(l=e[B]||(e[B]={}),(s=l[i])&&s[0]===H&&s[1]===a)return c[2]=s[2];if(l[i]=c,c[2]=t(e,n,o))return!0}}}function g(t){return t.length>1?function(e,n,i){for(var r=t.length;r--;)if(!t[r](e,n,i))return!1;return!0}:t[0]}function m(t,e,n,i,r){for(var a,o=[],s=0,l=t.length,c=null!=e;l>s;s++)(a=t[s])&&(!n||n(a,i,r))&&(o.push(a),c&&e.push(s));return o}function v(t,e,n,r,a,o){return r&&!r[B]&&(r=v(r)),a&&!a[B]&&(a=v(a,o)),i(function(i,o,s,l){var c,u,d,h=[],p=[],f=o.length,g=i||x(e||"*",s.nodeType?[s]:s,[]),v=!t||!i&&e?g:m(g,h,t,s,l),y=n?a||(i?t:f||r)?[]:o:v;if(n&&n(v,y,s,l),r)for(c=m(y,p),r(c,[],s,l),u=c.length;u--;)(d=c[u])&&(y[p[u]]=!(v[p[u]]=d));if(i){if(a||t){if(a){for(c=[],u=y.length;u--;)(d=y[u])&&c.push(v[u]=d);a(null,y=[],c,l)}for(u=y.length;u--;)(d=y[u])&&(c=a?ee.call(i,d):h[u])>-1&&(i[c]=!(o[c]=d))}}else y=m(y===o?y.splice(f,y.length):y),a?a(null,o,y,l):J.apply(o,y)})}function y(t){for(var e,n,i,r=t.length,a=A.relative[t[0].type],o=a||A.relative[" "],s=a?1:0,l=f(function(t){return t===e},o,!0),c=f(function(t){return ee.call(e,t)>-1},o,!0),u=[function(t,n,i){return!a&&(i||n!==S)||((e=n).nodeType?l(t,n,i):c(t,n,i))}];r>s;s++)if(n=A.relative[t[s].type])u=[f(g(u),n)];else{if(n=A.filter[t[s].type].apply(null,t[s].matches),n[B]){for(i=++s;r>i&&!A.relative[t[i].type];i++);return v(s>1&&g(u),s>1&&p(t.slice(0,s-1).concat({value:" "===t[s-2].type?"*":""})).replace(le,"$1"),n,i>s&&y(t.slice(s,i)),r>i&&y(t=t.slice(i)),r>i&&p(t))}u.push(n)}return g(u)}function b(t,n){var r=n.length>0,a=t.length>0,o=function(i,o,s,l,c){var u,d,h,p=0,f="0",g=i&&[],v=[],y=S,b=i||a&&A.find.TAG("*",c),x=H+=null==y?1:Math.random()||.1,T=b.length;for(c&&(S=o!==P&&o);f!==T&&null!=(u=b[f]);f++){if(a&&u){for(d=0;h=t[d++];)if(h(u,o,s)){l.push(u);break}c&&(H=x)}r&&((u=!h&&u)&&p--,i&&g.push(u))}if(p+=f,r&&f!==p){for(d=0;h=n[d++];)h(g,v,o,s);if(i){if(p>0)for(;f--;)g[f]||v[f]||(v[f]=Z.call(l));v=m(v)}J.apply(l,v),c&&!i&&v.length>0&&p+n.length>1&&e.uniqueSort(l)}return c&&(H=x,S=y),g};return r?i(o):o}function x(t,n,i){for(var r=0,a=n.length;a>r;r++)e(t,n[r],i);return i}function T(t,e,n,i){var r,a,o,s,l,c=h(t);if(!i&&1===c.length){if(a=c[0]=c[0].slice(0),a.length>2&&"ID"===(o=a[0]).type&&k.getById&&9===e.nodeType&&N&&A.relative[a[1].type]){if(e=(A.find.ID(o.matches[0].replace(Te,we),e)||[])[0],!e)return n;t=t.slice(a.shift().value.length)}for(r=fe.needsContext.test(t)?0:a.length;r--&&(o=a[r],!A.relative[s=o.type]);)if((l=A.find[s])&&(i=l(o.matches[0].replace(Te,we),be.test(a[0].type)&&u(e.parentNode)||e))){if(a.splice(r,1),t=i.length&&p(a),!t)return J.apply(n,i),n;break}}return E(t,c)(i,e,!N,n,be.test(t)&&u(e.parentNode)||e),n}var w,k,A,_,C,E,S,M,I,D,P,$,N,G,O,L,F,B="sizzle"+-new Date,R=t.document,H=0,U=0,z=n(),j=n(),W=n(),q=function(t,e){return t===e&&(I=!0),0},V="undefined",Y=1<<31,X={}.hasOwnProperty,K=[],Z=K.pop,Q=K.push,J=K.push,te=K.slice,ee=K.indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(this[e]===t)return e;return-1},ne="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ie="[\\x20\\t\\r\\n\\f]",re="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ae=re.replace("w","w#"),oe="\\["+ie+"*("+re+")"+ie+"*(?:([*^$|!~]?=)"+ie+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+ae+")|)|)"+ie+"*\\]",se=":("+re+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+oe.replace(3,8)+")*)|.*)\\)|)",le=RegExp("^"+ie+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ie+"+$","g"),ce=RegExp("^"+ie+"*,"+ie+"*"),ue=RegExp("^"+ie+"*([>+~]|"+ie+")"+ie+"*"),de=RegExp("="+ie+"*([^\\]'\"]*?)"+ie+"*\\]","g"),he=RegExp(se),pe=RegExp("^"+ae+"$"),fe={ID:RegExp("^#("+re+")"),CLASS:RegExp("^\\.("+re+")"),TAG:RegExp("^("+re.replace("w","w*")+")"),ATTR:RegExp("^"+oe),PSEUDO:RegExp("^"+se),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ie+"*(even|odd|(([+-]|)(\\d*)n|)"+ie+"*(?:([+-]|)"+ie+"*(\\d+)|))"+ie+"*\\)|)","i"),bool:RegExp("^(?:"+ne+")$","i"),needsContext:RegExp("^"+ie+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ie+"*((?:-\\d)?\\d*)"+ie+"*\\)|)(?=[^-]|$)","i")},ge=/^(?:input|select|textarea|button)$/i,me=/^h\d$/i,ve=/^[^{]+\{\s*\[native \w/,ye=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,be=/[+~]/,xe=/'|\\/g,Te=RegExp("\\\\([\\da-f]{1,6}"+ie+"?|("+ie+")|.)","ig"),we=function(t,e,n){var i="0x"+e-65536;return i!==i||n?e:0>i?String.fromCharCode(i+65536):String.fromCharCode(55296|i>>10,56320|1023&i)};try{J.apply(K=te.call(R.childNodes),R.childNodes),K[R.childNodes.length].nodeType}catch(ke){J={apply:K.length?function(t,e){Q.apply(t,te.call(e))}:function(t,e){for(var n=t.length,i=0;t[n++]=e[i++];);t.length=n-1}}}k=e.support={},C=e.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return e?"HTML"!==e.nodeName:!1},D=e.setDocument=function(t){var e,n=t?t.ownerDocument||t:R,i=n.defaultView;return n!==P&&9===n.nodeType&&n.documentElement?(P=n,$=n.documentElement,N=!C(n),i&&i!==i.top&&(i.addEventListener?i.addEventListener("unload",function(){D()},!1):i.attachEvent&&i.attachEvent("onunload",function(){D()})),k.attributes=r(function(t){return t.className="i",!t.getAttribute("className")}),k.getElementsByTagName=r(function(t){return t.appendChild(n.createComment("")),!t.getElementsByTagName("*").length}),k.getElementsByClassName=ve.test(n.getElementsByClassName)&&r(function(t){return t.innerHTML="<div class='a'></div><div class='a i'></div>",t.firstChild.className="i",2===t.getElementsByClassName("i").length}),k.getById=r(function(t){return $.appendChild(t).id=B,!n.getElementsByName||!n.getElementsByName(B).length}),k.getById?(A.find.ID=function(t,e){if(typeof e.getElementById!==V&&N){var n=e.getElementById(t);return n&&n.parentNode?[n]:[]}},A.filter.ID=function(t){var e=t.replace(Te,we);return function(t){return t.getAttribute("id")===e}}):(delete A.find.ID,A.filter.ID=function(t){var e=t.replace(Te,we);return function(t){var n=typeof t.getAttributeNode!==V&&t.getAttributeNode("id");return n&&n.value===e}}),A.find.TAG=k.getElementsByTagName?function(t,e){return typeof e.getElementsByTagName!==V?e.getElementsByTagName(t):void 0}:function(t,e){var n,i=[],r=0,a=e.getElementsByTagName(t);if("*"===t){for(;n=a[r++];)1===n.nodeType&&i.push(n);return i}return a},A.find.CLASS=k.getElementsByClassName&&function(t,e){return typeof e.getElementsByClassName!==V&&N?e.getElementsByClassName(t):void 0},O=[],G=[],(k.qsa=ve.test(n.querySelectorAll))&&(r(function(t){t.innerHTML="<select t=''><option selected=''></option></select>",t.querySelectorAll("[t^='']").length&&G.push("[*^$]="+ie+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||G.push("\\["+ie+"*(?:value|"+ne+")"),t.querySelectorAll(":checked").length||G.push(":checked")}),r(function(t){var e=n.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&G.push("name"+ie+"*[*^$|!~]?="),t.querySelectorAll(":enabled").length||G.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),G.push(",.*:")})),(k.matchesSelector=ve.test(L=$.webkitMatchesSelector||$.mozMatchesSelector||$.oMatchesSelector||$.msMatchesSelector))&&r(function(t){k.disconnectedMatch=L.call(t,"div"),L.call(t,"[s!='']:x"),O.push("!=",se)}),G=G.length&&RegExp(G.join("|")),O=O.length&&RegExp(O.join("|")),e=ve.test($.compareDocumentPosition),F=e||ve.test($.contains)?function(t,e){var n=9===t.nodeType?t.documentElement:t,i=e&&e.parentNode;return t===i||!(!i||1!==i.nodeType||!(n.contains?n.contains(i):t.compareDocumentPosition&&16&t.compareDocumentPosition(i)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},q=e?function(t,e){if(t===e)return I=!0,0;var i=!t.compareDocumentPosition-!e.compareDocumentPosition;return i?i:(i=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1,1&i||!k.sortDetached&&e.compareDocumentPosition(t)===i?t===n||t.ownerDocument===R&&F(R,t)?-1:e===n||e.ownerDocument===R&&F(R,e)?1:M?ee.call(M,t)-ee.call(M,e):0:4&i?-1:1)}:function(t,e){if(t===e)return I=!0,0;var i,r=0,a=t.parentNode,s=e.parentNode,l=[t],c=[e];if(!a||!s)return t===n?-1:e===n?1:a?-1:s?1:M?ee.call(M,t)-ee.call(M,e):0;if(a===s)return o(t,e);for(i=t;i=i.parentNode;)l.unshift(i);for(i=e;i=i.parentNode;)c.unshift(i);for(;l[r]===c[r];)r++;return r?o(l[r],c[r]):l[r]===R?-1:c[r]===R?1:0},n):P},e.matches=function(t,n){return e(t,null,null,n)},e.matchesSelector=function(t,n){if((t.ownerDocument||t)!==P&&D(t),n=n.replace(de,"='$1']"),!(!k.matchesSelector||!N||O&&O.test(n)||G&&G.test(n)))try{var i=L.call(t,n);if(i||k.disconnectedMatch||t.document&&11!==t.document.nodeType)return i}catch(r){}return e(n,P,null,[t]).length>0},e.contains=function(t,e){return(t.ownerDocument||t)!==P&&D(t),F(t,e)},e.attr=function(t,e){(t.ownerDocument||t)!==P&&D(t);var n=A.attrHandle[e.toLowerCase()],i=n&&X.call(A.attrHandle,e.toLowerCase())?n(t,e,!N):void 0;return void 0!==i?i:k.attributes||!N?t.getAttribute(e):(i=t.getAttributeNode(e))&&i.specified?i.value:null},e.error=function(t){throw Error("Syntax error, unrecognized expression: "+t)},e.uniqueSort=function(t){var e,n=[],i=0,r=0;if(I=!k.detectDuplicates,M=!k.sortStable&&t.slice(0),t.sort(q),I){for(;e=t[r++];)e===t[r]&&(i=n.push(r));for(;i--;)t.splice(n[i],1)}return M=null,t},_=e.getText=function(t){var e,n="",i=0,r=t.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)n+=_(t)}else if(3===r||4===r)return t.nodeValue}else for(;e=t[i++];)n+=_(e);return n},A=e.selectors={cacheLength:50,createPseudo:i,match:fe,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(Te,we),t[3]=(t[4]||t[5]||"").replace(Te,we),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||e.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&e.error(t[0]),t},PSEUDO:function(t){var e,n=!t[5]&&t[2];return fe.CHILD.test(t[0])?null:(t[3]&&void 0!==t[4]?t[2]=t[4]:n&&he.test(n)&&(e=h(n,!0))&&(e=n.indexOf(")",n.length-e)-n.length)&&(t[0]=t[0].slice(0,e),t[2]=n.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(Te,we).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=z[t+" "];return e||(e=RegExp("(^|"+ie+")"+t+"("+ie+"|$)"))&&z(t,function(t){return e.test("string"==typeof t.className&&t.className||typeof t.getAttribute!==V&&t.getAttribute("class")||"")})},ATTR:function(t,n,i){return function(r){var a=e.attr(r,t);return null==a?"!="===n:n?(a+="","="===n?a===i:"!="===n?a!==i:"^="===n?i&&0===a.indexOf(i):"*="===n?i&&a.indexOf(i)>-1:"$="===n?i&&a.slice(-i.length)===i:"~="===n?(" "+a+" ").indexOf(i)>-1:"|="===n?a===i||a.slice(0,i.length+1)===i+"-":!1):!0}},CHILD:function(t,e,n,i,r){var a="nth"!==t.slice(0,3),o="last"!==t.slice(-4),s="of-type"===e;return 1===i&&0===r?function(t){return!!t.parentNode}:function(e,n,l){var c,u,d,h,p,f,g=a!==o?"nextSibling":"previousSibling",m=e.parentNode,v=s&&e.nodeName.toLowerCase(),y=!l&&!s;if(m){if(a){for(;g;){for(d=e;d=d[g];)if(s?d.nodeName.toLowerCase()===v:1===d.nodeType)return!1;f=g="only"===t&&!f&&"nextSibling"}return!0}if(f=[o?m.firstChild:m.lastChild],o&&y){for(u=m[B]||(m[B]={}),c=u[t]||[],p=c[0]===H&&c[1],h=c[0]===H&&c[2],d=p&&m.childNodes[p];d=++p&&d&&d[g]||(h=p=0)||f.pop();)if(1===d.nodeType&&++h&&d===e){u[t]=[H,p,h];break}}else if(y&&(c=(e[B]||(e[B]={}))[t])&&c[0]===H)h=c[1];else for(;(d=++p&&d&&d[g]||(h=p=0)||f.pop())&&((s?d.nodeName.toLowerCase()!==v:1!==d.nodeType)||!++h||(y&&((d[B]||(d[B]={}))[t]=[H,h]),d!==e)););return h-=r,h===i||0===h%i&&h/i>=0}}},PSEUDO:function(t,n){var r,a=A.pseudos[t]||A.setFilters[t.toLowerCase()]||e.error("unsupported pseudo: "+t);return a[B]?a(n):a.length>1?(r=[t,t,"",n],A.setFilters.hasOwnProperty(t.toLowerCase())?i(function(t,e){for(var i,r=a(t,n),o=r.length;o--;)i=ee.call(t,r[o]),t[i]=!(e[i]=r[o])}):function(t){return a(t,0,r)}):a}},pseudos:{not:i(function(t){var e=[],n=[],r=E(t.replace(le,"$1"));return r[B]?i(function(t,e,n,i){for(var a,o=r(t,null,i,[]),s=t.length;s--;)(a=o[s])&&(t[s]=!(e[s]=a))}):function(t,i,a){return e[0]=t,r(e,null,a,n),!n.pop()}}),has:i(function(t){return function(n){return e(t,n).length>0}}),contains:i(function(t){return function(e){return(e.textContent||e.innerText||_(e)).indexOf(t)>-1}}),lang:i(function(t){return pe.test(t||"")||e.error("unsupported lang: "+t),t=t.replace(Te,we).toLowerCase(),function(e){var n;do if(n=N?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return n=n.toLowerCase(),n===t||0===n.indexOf(t+"-");while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var n=t.location&&t.location.hash;return n&&n.slice(1)===e.id},root:function(t){return t===$},focus:function(t){return t===P.activeElement&&(!P.hasFocus||P.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:function(t){return t.disabled===!1},disabled:function(t){return t.disabled===!0},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,t.selected===!0},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(6>t.nodeType)return!1;return!0},parent:function(t){return!A.pseudos.empty(t)},header:function(t){return me.test(t.nodeName)},input:function(t){return ge.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:c(function(){return[0]}),last:c(function(t,e){return[e-1]}),eq:c(function(t,e,n){return[0>n?n+e:n]}),even:c(function(t,e){for(var n=0;e>n;n+=2)t.push(n);
return t}),odd:c(function(t,e){for(var n=1;e>n;n+=2)t.push(n);return t}),lt:c(function(t,e,n){for(var i=0>n?n+e:n;--i>=0;)t.push(i);return t}),gt:c(function(t,e,n){for(var i=0>n?n+e:n;e>++i;)t.push(i);return t})}},A.pseudos.nth=A.pseudos.eq;for(w in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})A.pseudos[w]=s(w);for(w in{submit:!0,reset:!0})A.pseudos[w]=l(w);return d.prototype=A.filters=A.pseudos,A.setFilters=new d,E=e.compile=function(t,e){var n,i=[],r=[],a=W[t+" "];if(!a){for(e||(e=h(t)),n=e.length;n--;)a=y(e[n]),a[B]?i.push(a):r.push(a);a=W(t,b(r,i))}return a},k.sortStable=B.split("").sort(q).join("")===B,k.detectDuplicates=!!I,D(),k.sortDetached=r(function(t){return 1&t.compareDocumentPosition(P.createElement("div"))}),r(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||a("type|href|height|width",function(t,e,n){return n?void 0:t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),k.attributes&&r(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||a("value",function(t,e,n){return n||"input"!==t.nodeName.toLowerCase()?void 0:t.defaultValue}),r(function(t){return null==t.getAttribute("disabled")})||a(ne,function(t,e,n){var i;return n?void 0:t[e]===!0?e.toLowerCase():(i=t.getAttributeNode(e))&&i.specified?i.value:null}),e}(t);ae.find=ue,ae.expr=ue.selectors,ae.expr[":"]=ae.expr.pseudos,ae.unique=ue.uniqueSort,ae.text=ue.getText,ae.isXMLDoc=ue.isXML,ae.contains=ue.contains;var de=ae.expr.match.needsContext,he=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,pe=/^.[^:#\[\.,]*$/;ae.filter=function(t,e,n){var i=e[0];return n&&(t=":not("+t+")"),1===e.length&&1===i.nodeType?ae.find.matchesSelector(i,t)?[i]:[]:ae.find.matches(t,ae.grep(e,function(t){return 1===t.nodeType}))},ae.fn.extend({find:function(t){var e,n=[],i=this,r=i.length;if("string"!=typeof t)return this.pushStack(ae(t).filter(function(){for(e=0;r>e;e++)if(ae.contains(i[e],this))return!0}));for(e=0;r>e;e++)ae.find(t,i[e],n);return n=this.pushStack(r>1?ae.unique(n):n),n.selector=this.selector?this.selector+" "+t:t,n},filter:function(t){return this.pushStack(i(this,t||[],!1))},not:function(t){return this.pushStack(i(this,t||[],!0))},is:function(t){return!!i(this,"string"==typeof t&&de.test(t)?ae(t):t||[],!1).length}});var fe,ge=t.document,me=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ve=ae.fn.init=function(t,e){var n,i;if(!t)return this;if("string"==typeof t){if(n="<"===t.charAt(0)&&">"===t.charAt(t.length-1)&&t.length>=3?[null,t,null]:me.exec(t),!n||!n[1]&&e)return!e||e.jquery?(e||fe).find(t):this.constructor(e).find(t);if(n[1]){if(e=e instanceof ae?e[0]:e,ae.merge(this,ae.parseHTML(n[1],e&&e.nodeType?e.ownerDocument||e:ge,!0)),he.test(n[1])&&ae.isPlainObject(e))for(n in e)ae.isFunction(this[n])?this[n](e[n]):this.attr(n,e[n]);return this}if(i=ge.getElementById(n[2]),i&&i.parentNode){if(i.id!==n[2])return fe.find(t);this.length=1,this[0]=i}return this.context=ge,this.selector=t,this}return t.nodeType?(this.context=this[0]=t,this.length=1,this):ae.isFunction(t)?fe.ready!==void 0?fe.ready(t):t(ae):(void 0!==t.selector&&(this.selector=t.selector,this.context=t.context),ae.makeArray(t,this))};ve.prototype=ae.fn,fe=ae(ge);var ye=/^(?:parents|prev(?:Until|All))/,be={children:!0,contents:!0,next:!0,prev:!0};ae.extend({dir:function(t,e,n){for(var i=[],r=t[e];r&&9!==r.nodeType&&(void 0===n||1!==r.nodeType||!ae(r).is(n));)1===r.nodeType&&i.push(r),r=r[e];return i},sibling:function(t,e){for(var n=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&n.push(t);return n}}),ae.fn.extend({has:function(t){var e,n=ae(t,this),i=n.length;return this.filter(function(){for(e=0;i>e;e++)if(ae.contains(this,n[e]))return!0})},closest:function(t,e){for(var n,i=0,r=this.length,a=[],o=de.test(t)||"string"!=typeof t?ae(t,e||this.context):0;r>i;i++)for(n=this[i];n&&n!==e;n=n.parentNode)if(11>n.nodeType&&(o?o.index(n)>-1:1===n.nodeType&&ae.find.matchesSelector(n,t))){a.push(n);break}return this.pushStack(a.length>1?ae.unique(a):a)},index:function(t){return t?"string"==typeof t?ae.inArray(this[0],ae(t)):ae.inArray(t.jquery?t[0]:t,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(ae.unique(ae.merge(this.get(),ae(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),ae.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return ae.dir(t,"parentNode")},parentsUntil:function(t,e,n){return ae.dir(t,"parentNode",n)},next:function(t){return r(t,"nextSibling")},prev:function(t){return r(t,"previousSibling")},nextAll:function(t){return ae.dir(t,"nextSibling")},prevAll:function(t){return ae.dir(t,"previousSibling")},nextUntil:function(t,e,n){return ae.dir(t,"nextSibling",n)},prevUntil:function(t,e,n){return ae.dir(t,"previousSibling",n)},siblings:function(t){return ae.sibling((t.parentNode||{}).firstChild,t)},children:function(t){return ae.sibling(t.firstChild)},contents:function(t){return ae.nodeName(t,"iframe")?t.contentDocument||t.contentWindow.document:ae.merge([],t.childNodes)}},function(t,e){ae.fn[t]=function(n,i){var r=ae.map(this,e,n);return"Until"!==t.slice(-5)&&(i=n),i&&"string"==typeof i&&(r=ae.filter(i,r)),this.length>1&&(be[t]||(r=ae.unique(r)),ye.test(t)&&(r=r.reverse())),this.pushStack(r)}});var xe=/\S+/g,Te={};ae.Callbacks=function(t){t="string"==typeof t?Te[t]||a(t):ae.extend({},t);var e,n,i,r,o,s,l=[],c=!t.once&&[],u=function(a){for(n=t.memory&&a,i=!0,o=s||0,s=0,r=l.length,e=!0;l&&r>o;o++)if(l[o].apply(a[0],a[1])===!1&&t.stopOnFalse){n=!1;break}e=!1,l&&(c?c.length&&u(c.shift()):n?l=[]:d.disable())},d={add:function(){if(l){var i=l.length;!function a(e){ae.each(e,function(e,n){var i=ae.type(n);"function"===i?t.unique&&d.has(n)||l.push(n):n&&n.length&&"string"!==i&&a(n)})}(arguments),e?r=l.length:n&&(s=i,u(n))}return this},remove:function(){return l&&ae.each(arguments,function(t,n){for(var i;(i=ae.inArray(n,l,i))>-1;)l.splice(i,1),e&&(r>=i&&r--,o>=i&&o--)}),this},has:function(t){return t?ae.inArray(t,l)>-1:!(!l||!l.length)},empty:function(){return l=[],r=0,this},disable:function(){return l=c=n=void 0,this},disabled:function(){return!l},lock:function(){return c=void 0,n||d.disable(),this},locked:function(){return!c},fireWith:function(t,n){return!l||i&&!c||(n=n||[],n=[t,n.slice?n.slice():n],e?c.push(n):u(n)),this},fire:function(){return d.fireWith(this,arguments),this},fired:function(){return!!i}};return d},ae.extend({Deferred:function(t){var e=[["resolve","done",ae.Callbacks("once memory"),"resolved"],["reject","fail",ae.Callbacks("once memory"),"rejected"],["notify","progress",ae.Callbacks("memory")]],n="pending",i={state:function(){return n},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var t=arguments;return ae.Deferred(function(n){ae.each(e,function(e,a){var o=ae.isFunction(t[e])&&t[e];r[a[1]](function(){var t=o&&o.apply(this,arguments);t&&ae.isFunction(t.promise)?t.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[a[0]+"With"](this===i?n.promise():this,o?[t]:arguments)})}),t=null}).promise()},promise:function(t){return null!=t?ae.extend(t,i):i}},r={};return i.pipe=i.then,ae.each(e,function(t,a){var o=a[2],s=a[3];i[a[1]]=o.add,s&&o.add(function(){n=s},e[1^t][2].disable,e[2][2].lock),r[a[0]]=function(){return r[a[0]+"With"](this===r?i:this,arguments),this},r[a[0]+"With"]=o.fireWith}),i.promise(r),t&&t.call(r,r),r},when:function(t){var e,n,i,r=0,a=X.call(arguments),o=a.length,s=1!==o||t&&ae.isFunction(t.promise)?o:0,l=1===s?t:ae.Deferred(),c=function(t,n,i){return function(r){n[t]=this,i[t]=arguments.length>1?X.call(arguments):r,i===e?l.notifyWith(n,i):--s||l.resolveWith(n,i)}};if(o>1)for(e=Array(o),n=Array(o),i=Array(o);o>r;r++)a[r]&&ae.isFunction(a[r].promise)?a[r].promise().done(c(r,i,a)).fail(l.reject).progress(c(r,n,e)):--s;return s||l.resolveWith(i,a),l.promise()}});var we;ae.fn.ready=function(t){return ae.ready.promise().done(t),this},ae.extend({isReady:!1,readyWait:1,holdReady:function(t){t?ae.readyWait++:ae.ready(!0)},ready:function(t){if(t===!0?!--ae.readyWait:!ae.isReady){if(!ge.body)return setTimeout(ae.ready);ae.isReady=!0,t!==!0&&--ae.readyWait>0||(we.resolveWith(ge,[ae]),ae.fn.trigger&&ae(ge).trigger("ready").off("ready"))}}}),ae.ready.promise=function(e){if(!we)if(we=ae.Deferred(),"complete"===ge.readyState)setTimeout(ae.ready);else if(ge.addEventListener)ge.addEventListener("DOMContentLoaded",s,!1),t.addEventListener("load",s,!1);else{ge.attachEvent("onreadystatechange",s),t.attachEvent("onload",s);var n=!1;try{n=null==t.frameElement&&ge.documentElement}catch(i){}n&&n.doScroll&&!function r(){if(!ae.isReady){try{n.doScroll("left")}catch(t){return setTimeout(r,50)}o(),ae.ready()}}()}return we.promise(e)};var ke,Ae="undefined";for(ke in ae(ie))break;ie.ownLast="0"!==ke,ie.inlineBlockNeedsLayout=!1,ae(function(){var t,e,n=ge.getElementsByTagName("body")[0];n&&(t=ge.createElement("div"),t.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",e=ge.createElement("div"),n.appendChild(t).appendChild(e),typeof e.style.zoom!==Ae&&(e.style.cssText="border:0;margin:0;width:1px;padding:1px;display:inline;zoom:1",(ie.inlineBlockNeedsLayout=3===e.offsetWidth)&&(n.style.zoom=1)),n.removeChild(t),t=e=null)}),function(){var t=ge.createElement("div");if(null==ie.deleteExpando){ie.deleteExpando=!0;try{delete t.test}catch(e){ie.deleteExpando=!1}}t=null}(),ae.acceptData=function(t){var e=ae.noData[(t.nodeName+" ").toLowerCase()],n=+t.nodeType||1;return 1!==n&&9!==n?!1:!e||e!==!0&&t.getAttribute("classid")===e};var _e=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Ce=/([A-Z])/g;ae.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(t){return t=t.nodeType?ae.cache[t[ae.expando]]:t[ae.expando],!!t&&!c(t)},data:function(t,e,n){return u(t,e,n)},removeData:function(t,e){return d(t,e)},_data:function(t,e,n){return u(t,e,n,!0)},_removeData:function(t,e){return d(t,e,!0)}}),ae.fn.extend({data:function(t,e){var n,i,r,a=this[0],o=a&&a.attributes;if(void 0===t){if(this.length&&(r=ae.data(a),1===a.nodeType&&!ae._data(a,"parsedAttrs"))){for(n=o.length;n--;)i=o[n].name,0===i.indexOf("data-")&&(i=ae.camelCase(i.slice(5)),l(a,i,r[i]));ae._data(a,"parsedAttrs",!0)}return r}return"object"==typeof t?this.each(function(){ae.data(this,t)}):arguments.length>1?this.each(function(){ae.data(this,t,e)}):a?l(a,t,ae.data(a,t)):void 0},removeData:function(t){return this.each(function(){ae.removeData(this,t)})}}),ae.extend({queue:function(t,e,n){var i;return t?(e=(e||"fx")+"queue",i=ae._data(t,e),n&&(!i||ae.isArray(n)?i=ae._data(t,e,ae.makeArray(n)):i.push(n)),i||[]):void 0},dequeue:function(t,e){e=e||"fx";var n=ae.queue(t,e),i=n.length,r=n.shift(),a=ae._queueHooks(t,e),o=function(){ae.dequeue(t,e)};"inprogress"===r&&(r=n.shift(),i--),r&&("fx"===e&&n.unshift("inprogress"),delete a.stop,r.call(t,o,a)),!i&&a&&a.empty.fire()},_queueHooks:function(t,e){var n=e+"queueHooks";return ae._data(t,n)||ae._data(t,n,{empty:ae.Callbacks("once memory").add(function(){ae._removeData(t,e+"queue"),ae._removeData(t,n)})})}}),ae.fn.extend({queue:function(t,e){var n=2;return"string"!=typeof t&&(e=t,t="fx",n--),n>arguments.length?ae.queue(this[0],t):void 0===e?this:this.each(function(){var n=ae.queue(this,t,e);ae._queueHooks(this,t),"fx"===t&&"inprogress"!==n[0]&&ae.dequeue(this,t)})},dequeue:function(t){return this.each(function(){ae.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var n,i=1,r=ae.Deferred(),a=this,o=this.length,s=function(){--i||r.resolveWith(a,[a])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";o--;)n=ae._data(a[o],t+"queueHooks"),n&&n.empty&&(i++,n.empty.add(s));return s(),r.promise(e)}});var Ee=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Se=["Top","Right","Bottom","Left"],Me=function(t,e){return t=e||t,"none"===ae.css(t,"display")||!ae.contains(t.ownerDocument,t)},Ie=ae.access=function(t,e,n,i,r,a,o){var s=0,l=t.length,c=null==n;if("object"===ae.type(n)){r=!0;for(s in n)ae.access(t,e,s,n[s],!0,a,o)}else if(void 0!==i&&(r=!0,ae.isFunction(i)||(o=!0),c&&(o?(e.call(t,i),e=null):(c=e,e=function(t,e,n){return c.call(ae(t),n)})),e))for(;l>s;s++)e(t[s],n,o?i:i.call(t[s],s,e(t[s],n)));return r?t:c?e.call(t):l?e(t[0],n):a},De=/^(?:checkbox|radio)$/i;!function(){var t=ge.createDocumentFragment(),e=ge.createElement("div"),n=ge.createElement("input");if(e.setAttribute("className","t"),e.innerHTML="  <link/><table></table><a href='/a'>a</a>",ie.leadingWhitespace=3===e.firstChild.nodeType,ie.tbody=!e.getElementsByTagName("tbody").length,ie.htmlSerialize=!!e.getElementsByTagName("link").length,ie.html5Clone="<:nav></:nav>"!==ge.createElement("nav").cloneNode(!0).outerHTML,n.type="checkbox",n.checked=!0,t.appendChild(n),ie.appendChecked=n.checked,e.innerHTML="<textarea>x</textarea>",ie.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue,t.appendChild(e),e.innerHTML="<input type='radio' checked='checked' name='t'/>",ie.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,ie.noCloneEvent=!0,e.attachEvent&&(e.attachEvent("onclick",function(){ie.noCloneEvent=!1}),e.cloneNode(!0).click()),null==ie.deleteExpando){ie.deleteExpando=!0;try{delete e.test}catch(i){ie.deleteExpando=!1}}t=e=n=null}(),function(){var e,n,i=ge.createElement("div");for(e in{submit:!0,change:!0,focusin:!0})n="on"+e,(ie[e+"Bubbles"]=n in t)||(i.setAttribute(n,"t"),ie[e+"Bubbles"]=i.attributes[n].expando===!1);i=null}();var Pe=/^(?:input|select|textarea)$/i,$e=/^key/,Ne=/^(?:mouse|contextmenu)|click/,Ge=/^(?:focusinfocus|focusoutblur)$/,Oe=/^([^.]*)(?:\.(.+)|)$/;ae.event={global:{},add:function(t,e,n,i,r){var a,o,s,l,c,u,d,h,p,f,g,m=ae._data(t);if(m){for(n.handler&&(l=n,n=l.handler,r=l.selector),n.guid||(n.guid=ae.guid++),(o=m.events)||(o=m.events={}),(u=m.handle)||(u=m.handle=function(t){return typeof ae===Ae||t&&ae.event.triggered===t.type?void 0:ae.event.dispatch.apply(u.elem,arguments)},u.elem=t),e=(e||"").match(xe)||[""],s=e.length;s--;)a=Oe.exec(e[s])||[],p=g=a[1],f=(a[2]||"").split(".").sort(),p&&(c=ae.event.special[p]||{},p=(r?c.delegateType:c.bindType)||p,c=ae.event.special[p]||{},d=ae.extend({type:p,origType:g,data:i,handler:n,guid:n.guid,selector:r,needsContext:r&&ae.expr.match.needsContext.test(r),namespace:f.join(".")},l),(h=o[p])||(h=o[p]=[],h.delegateCount=0,c.setup&&c.setup.call(t,i,f,u)!==!1||(t.addEventListener?t.addEventListener(p,u,!1):t.attachEvent&&t.attachEvent("on"+p,u))),c.add&&(c.add.call(t,d),d.handler.guid||(d.handler.guid=n.guid)),r?h.splice(h.delegateCount++,0,d):h.push(d),ae.event.global[p]=!0);t=null}},remove:function(t,e,n,i,r){var a,o,s,l,c,u,d,h,p,f,g,m=ae.hasData(t)&&ae._data(t);if(m&&(u=m.events)){for(e=(e||"").match(xe)||[""],c=e.length;c--;)if(s=Oe.exec(e[c])||[],p=g=s[1],f=(s[2]||"").split(".").sort(),p){for(d=ae.event.special[p]||{},p=(i?d.delegateType:d.bindType)||p,h=u[p]||[],s=s[2]&&RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),l=a=h.length;a--;)o=h[a],!r&&g!==o.origType||n&&n.guid!==o.guid||s&&!s.test(o.namespace)||i&&i!==o.selector&&("**"!==i||!o.selector)||(h.splice(a,1),o.selector&&h.delegateCount--,d.remove&&d.remove.call(t,o));l&&!h.length&&(d.teardown&&d.teardown.call(t,f,m.handle)!==!1||ae.removeEvent(t,p,m.handle),delete u[p])}else for(p in u)ae.event.remove(t,p+e[c],n,i,!0);ae.isEmptyObject(u)&&(delete m.handle,ae._removeData(t,"events"))}},trigger:function(e,n,i,r){var a,o,s,l,c,u,d,h=[i||ge],p=ee.call(e,"type")?e.type:e,f=ee.call(e,"namespace")?e.namespace.split("."):[];if(s=u=i=i||ge,3!==i.nodeType&&8!==i.nodeType&&!Ge.test(p+ae.event.triggered)&&(p.indexOf(".")>=0&&(f=p.split("."),p=f.shift(),f.sort()),o=0>p.indexOf(":")&&"on"+p,e=e[ae.expando]?e:new ae.Event(p,"object"==typeof e&&e),e.isTrigger=r?2:3,e.namespace=f.join("."),e.namespace_re=e.namespace?RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=i),n=null==n?[e]:ae.makeArray(n,[e]),c=ae.event.special[p]||{},r||!c.trigger||c.trigger.apply(i,n)!==!1)){if(!r&&!c.noBubble&&!ae.isWindow(i)){for(l=c.delegateType||p,Ge.test(l+p)||(s=s.parentNode);s;s=s.parentNode)h.push(s),u=s;u===(i.ownerDocument||ge)&&h.push(u.defaultView||u.parentWindow||t)}for(d=0;(s=h[d++])&&!e.isPropagationStopped();)e.type=d>1?l:c.bindType||p,a=(ae._data(s,"events")||{})[e.type]&&ae._data(s,"handle"),a&&a.apply(s,n),a=o&&s[o],a&&a.apply&&ae.acceptData(s)&&(e.result=a.apply(s,n),e.result===!1&&e.preventDefault());if(e.type=p,!r&&!e.isDefaultPrevented()&&(!c._default||c._default.apply(h.pop(),n)===!1)&&ae.acceptData(i)&&o&&i[p]&&!ae.isWindow(i)){u=i[o],u&&(i[o]=null),ae.event.triggered=p;try{i[p]()}catch(g){}ae.event.triggered=void 0,u&&(i[o]=u)}return e.result}},dispatch:function(t){t=ae.event.fix(t);var e,n,i,r,a,o=[],s=X.call(arguments),l=(ae._data(this,"events")||{})[t.type]||[],c=ae.event.special[t.type]||{};if(s[0]=t,t.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,t)!==!1){for(o=ae.event.handlers.call(this,t,l),e=0;(r=o[e++])&&!t.isPropagationStopped();)for(t.currentTarget=r.elem,a=0;(i=r.handlers[a++])&&!t.isImmediatePropagationStopped();)(!t.namespace_re||t.namespace_re.test(i.namespace))&&(t.handleObj=i,t.data=i.data,n=((ae.event.special[i.origType]||{}).handle||i.handler).apply(r.elem,s),void 0!==n&&(t.result=n)===!1&&(t.preventDefault(),t.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,t),t.result}},handlers:function(t,e){var n,i,r,a,o=[],s=e.delegateCount,l=t.target;if(s&&l.nodeType&&(!t.button||"click"!==t.type))for(;l!=this;l=l.parentNode||this)if(1===l.nodeType&&(l.disabled!==!0||"click"!==t.type)){for(r=[],a=0;s>a;a++)i=e[a],n=i.selector+" ",void 0===r[n]&&(r[n]=i.needsContext?ae(n,this).index(l)>=0:ae.find(n,this,null,[l]).length),r[n]&&r.push(i);r.length&&o.push({elem:l,handlers:r})}return e.length>s&&o.push({elem:this,handlers:e.slice(s)}),o},fix:function(t){if(t[ae.expando])return t;var e,n,i,r=t.type,a=t,o=this.fixHooks[r];for(o||(this.fixHooks[r]=o=Ne.test(r)?this.mouseHooks:$e.test(r)?this.keyHooks:{}),i=o.props?this.props.concat(o.props):this.props,t=new ae.Event(a),e=i.length;e--;)n=i[e],t[n]=a[n];return t.target||(t.target=a.srcElement||ge),3===t.target.nodeType&&(t.target=t.target.parentNode),t.metaKey=!!t.metaKey,o.filter?o.filter(t,a):t},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,e){var n,i,r,a=e.button,o=e.fromElement;return null==t.pageX&&null!=e.clientX&&(i=t.target.ownerDocument||ge,r=i.documentElement,n=i.body,t.pageX=e.clientX+(r&&r.scrollLeft||n&&n.scrollLeft||0)-(r&&r.clientLeft||n&&n.clientLeft||0),t.pageY=e.clientY+(r&&r.scrollTop||n&&n.scrollTop||0)-(r&&r.clientTop||n&&n.clientTop||0)),!t.relatedTarget&&o&&(t.relatedTarget=o===t.target?e.toElement:o),t.which||void 0===a||(t.which=1&a?1:2&a?3:4&a?2:0),t}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==f()&&this.focus)try{return this.focus(),!1}catch(t){}},delegateType:"focusin"},blur:{trigger:function(){return this===f()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return ae.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(t){return ae.nodeName(t.target,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&(t.originalEvent.returnValue=t.result)}}},simulate:function(t,e,n,i){var r=ae.extend(new ae.Event,n,{type:t,isSimulated:!0,originalEvent:{}});i?ae.event.trigger(r,null,e):ae.event.dispatch.call(e,r),r.isDefaultPrevented()&&n.preventDefault()}},ae.removeEvent=ge.removeEventListener?function(t,e,n){t.removeEventListener&&t.removeEventListener(e,n,!1)}:function(t,e,n){var i="on"+e;t.detachEvent&&(typeof t[i]===Ae&&(t[i]=null),t.detachEvent(i,n))},ae.Event=function(t,e){return this instanceof ae.Event?(t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&(t.returnValue===!1||t.getPreventDefault&&t.getPreventDefault())?h:p):this.type=t,e&&ae.extend(this,e),this.timeStamp=t&&t.timeStamp||ae.now(),void(this[ae.expando]=!0)):new ae.Event(t,e)},ae.Event.prototype={isDefaultPrevented:p,isPropagationStopped:p,isImmediatePropagationStopped:p,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=h,t&&(t.preventDefault?t.preventDefault():t.returnValue=!1)},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=h,t&&(t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=h,this.stopPropagation()}},ae.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(t,e){ae.event.special[t]={delegateType:e,bindType:e,handle:function(t){var n,i=this,r=t.relatedTarget,a=t.handleObj;return(!r||r!==i&&!ae.contains(i,r))&&(t.type=a.origType,n=a.handler.apply(this,arguments),t.type=e),n}}}),ie.submitBubbles||(ae.event.special.submit={setup:function(){return ae.nodeName(this,"form")?!1:void ae.event.add(this,"click._submit keypress._submit",function(t){var e=t.target,n=ae.nodeName(e,"input")||ae.nodeName(e,"button")?e.form:void 0;n&&!ae._data(n,"submitBubbles")&&(ae.event.add(n,"submit._submit",function(t){t._submit_bubble=!0}),ae._data(n,"submitBubbles",!0))})},postDispatch:function(t){t._submit_bubble&&(delete t._submit_bubble,this.parentNode&&!t.isTrigger&&ae.event.simulate("submit",this.parentNode,t,!0))},teardown:function(){return ae.nodeName(this,"form")?!1:void ae.event.remove(this,"._submit")}}),ie.changeBubbles||(ae.event.special.change={setup:function(){return Pe.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(ae.event.add(this,"propertychange._change",function(t){"checked"===t.originalEvent.propertyName&&(this._just_changed=!0)}),ae.event.add(this,"click._change",function(t){this._just_changed&&!t.isTrigger&&(this._just_changed=!1),ae.event.simulate("change",this,t,!0)})),!1):void ae.event.add(this,"beforeactivate._change",function(t){var e=t.target;Pe.test(e.nodeName)&&!ae._data(e,"changeBubbles")&&(ae.event.add(e,"change._change",function(t){!this.parentNode||t.isSimulated||t.isTrigger||ae.event.simulate("change",this.parentNode,t,!0)}),ae._data(e,"changeBubbles",!0))})},handle:function(t){var e=t.target;return this!==e||t.isSimulated||t.isTrigger||"radio"!==e.type&&"checkbox"!==e.type?t.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return ae.event.remove(this,"._change"),!Pe.test(this.nodeName)}}),ie.focusinBubbles||ae.each({focus:"focusin",blur:"focusout"},function(t,e){var n=function(t){ae.event.simulate(e,t.target,ae.event.fix(t),!0)};ae.event.special[e]={setup:function(){var i=this.ownerDocument||this,r=ae._data(i,e);r||i.addEventListener(t,n,!0),ae._data(i,e,(r||0)+1)},teardown:function(){var i=this.ownerDocument||this,r=ae._data(i,e)-1;r?ae._data(i,e,r):(i.removeEventListener(t,n,!0),ae._removeData(i,e))}}}),ae.fn.extend({on:function(t,e,n,i,r){var a,o;if("object"==typeof t){"string"!=typeof e&&(n=n||e,e=void 0);for(a in t)this.on(a,e,n,t[a],r);return this}if(null==n&&null==i?(i=e,n=e=void 0):null==i&&("string"==typeof e?(i=n,n=void 0):(i=n,n=e,e=void 0)),i===!1)i=p;else if(!i)return this;return 1===r&&(o=i,i=function(t){return ae().off(t),o.apply(this,arguments)},i.guid=o.guid||(o.guid=ae.guid++)),this.each(function(){ae.event.add(this,t,i,n,e)})},one:function(t,e,n,i){return this.on(t,e,n,i,1)},off:function(t,e,n){var i,r;if(t&&t.preventDefault&&t.handleObj)return i=t.handleObj,ae(t.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof t){for(r in t)this.off(r,e,t[r]);return this}return(e===!1||"function"==typeof e)&&(n=e,e=void 0),n===!1&&(n=p),this.each(function(){ae.event.remove(this,t,n,e)})},trigger:function(t,e){return this.each(function(){ae.event.trigger(t,e,this)})},triggerHandler:function(t,e){var n=this[0];return n?ae.event.trigger(t,e,n,!0):void 0}});var Le="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Fe=/ jQuery\d+="(?:null|\d+)"/g,Be=RegExp("<(?:"+Le+")[\\s/>]","i"),Re=/^\s+/,He=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Ue=/<([\w:]+)/,ze=/<tbody/i,je=/<|&#?\w+;/,We=/<(?:script|style|link)/i,qe=/checked\s*(?:[^=]|=\s*.checked.)/i,Ve=/^$|\/(?:java|ecma)script/i,Ye=/^true\/(.*)/,Xe=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ke={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:ie.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},Ze=g(ge),Qe=Ze.appendChild(ge.createElement("div"));Ke.optgroup=Ke.option,Ke.tbody=Ke.tfoot=Ke.colgroup=Ke.caption=Ke.thead,Ke.th=Ke.td,ae.extend({clone:function(t,e,n){var i,r,a,o,s,l=ae.contains(t.ownerDocument,t);if(ie.html5Clone||ae.isXMLDoc(t)||!Be.test("<"+t.nodeName+">")?a=t.cloneNode(!0):(Qe.innerHTML=t.outerHTML,Qe.removeChild(a=Qe.firstChild)),!(ie.noCloneEvent&&ie.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||ae.isXMLDoc(t)))for(i=m(a),s=m(t),o=0;null!=(r=s[o]);++o)i[o]&&k(r,i[o]);if(e)if(n)for(s=s||m(t),i=i||m(a),o=0;null!=(r=s[o]);o++)w(r,i[o]);else w(t,a);return i=m(a,"script"),i.length>0&&T(i,!l&&m(t,"script")),i=s=r=null,a},buildFragment:function(t,e,n,i){for(var r,a,o,s,l,c,u,d=t.length,h=g(e),p=[],f=0;d>f;f++)if(a=t[f],a||0===a)if("object"===ae.type(a))ae.merge(p,a.nodeType?[a]:a);else if(je.test(a)){for(s=s||h.appendChild(e.createElement("div")),l=(Ue.exec(a)||["",""])[1].toLowerCase(),u=Ke[l]||Ke._default,s.innerHTML=u[1]+a.replace(He,"<$1></$2>")+u[2],r=u[0];r--;)s=s.lastChild;if(!ie.leadingWhitespace&&Re.test(a)&&p.push(e.createTextNode(Re.exec(a)[0])),!ie.tbody)for(a="table"!==l||ze.test(a)?"<table>"!==u[1]||ze.test(a)?0:s:s.firstChild,r=a&&a.childNodes.length;r--;)ae.nodeName(c=a.childNodes[r],"tbody")&&!c.childNodes.length&&a.removeChild(c);for(ae.merge(p,s.childNodes),s.textContent="";s.firstChild;)s.removeChild(s.firstChild);s=h.lastChild}else p.push(e.createTextNode(a));for(s&&h.removeChild(s),ie.appendChecked||ae.grep(m(p,"input"),v),f=0;a=p[f++];)if((!i||-1===ae.inArray(a,i))&&(o=ae.contains(a.ownerDocument,a),s=m(h.appendChild(a),"script"),o&&T(s),n))for(r=0;a=s[r++];)Ve.test(a.type||"")&&n.push(a);return s=null,h},cleanData:function(t,e){for(var n,i,r,a,o=0,s=ae.expando,l=ae.cache,c=ie.deleteExpando,u=ae.event.special;null!=(n=t[o]);o++)if((e||ae.acceptData(n))&&(r=n[s],a=r&&l[r])){if(a.events)for(i in a.events)u[i]?ae.event.remove(n,i):ae.removeEvent(n,i,a.handle);l[r]&&(delete l[r],c?delete n[s]:typeof n.removeAttribute!==Ae?n.removeAttribute(s):n[s]=null,Y.push(r))}}}),ae.fn.extend({text:function(t){return Ie(this,function(t){return void 0===t?ae.text(this):this.empty().append((this[0]&&this[0].ownerDocument||ge).createTextNode(t))},null,t,arguments.length)},append:function(){return this.domManip(arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=y(this,t);e.appendChild(t)}})},prepend:function(){return this.domManip(arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=y(this,t);e.insertBefore(t,e.firstChild)}})},before:function(){return this.domManip(arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return this.domManip(arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},remove:function(t,e){for(var n,i=t?ae.filter(t,this):this,r=0;null!=(n=i[r]);r++)e||1!==n.nodeType||ae.cleanData(m(n)),n.parentNode&&(e&&ae.contains(n.ownerDocument,n)&&T(m(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){for(var t,e=0;null!=(t=this[e]);e++){for(1===t.nodeType&&ae.cleanData(m(t,!1));t.firstChild;)t.removeChild(t.firstChild);t.options&&ae.nodeName(t,"select")&&(t.options.length=0)}return this},clone:function(t,e){return t=null==t?!1:t,e=null==e?t:e,this.map(function(){return ae.clone(this,t,e)})},html:function(t){return Ie(this,function(t){var e=this[0]||{},n=0,i=this.length;if(void 0===t)return 1===e.nodeType?e.innerHTML.replace(Fe,""):void 0;if(!("string"!=typeof t||We.test(t)||!ie.htmlSerialize&&Be.test(t)||!ie.leadingWhitespace&&Re.test(t)||Ke[(Ue.exec(t)||["",""])[1].toLowerCase()])){t=t.replace(He,"<$1></$2>");try{for(;i>n;n++)e=this[n]||{},1===e.nodeType&&(ae.cleanData(m(e,!1)),e.innerHTML=t);e=0}catch(r){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var t=arguments[0];return this.domManip(arguments,function(e){t=this.parentNode,ae.cleanData(m(this)),t&&t.replaceChild(e,this)}),t&&(t.length||t.nodeType)?this:this.remove()},detach:function(t){return this.remove(t,!0)},domManip:function(t,e){t=K.apply([],t);var n,i,r,a,o,s,l=0,c=this.length,u=this,d=c-1,h=t[0],p=ae.isFunction(h);if(p||c>1&&"string"==typeof h&&!ie.checkClone&&qe.test(h))return this.each(function(n){var i=u.eq(n);p&&(t[0]=h.call(this,n,i.html())),i.domManip(t,e)});if(c&&(s=ae.buildFragment(t,this[0].ownerDocument,!1,this),n=s.firstChild,1===s.childNodes.length&&(s=n),n)){for(a=ae.map(m(s,"script"),b),r=a.length;c>l;l++)i=s,l!==d&&(i=ae.clone(i,!0,!0),r&&ae.merge(a,m(i,"script"))),e.call(this[l],i,l);if(r)for(o=a[a.length-1].ownerDocument,ae.map(a,x),l=0;r>l;l++)i=a[l],Ve.test(i.type||"")&&!ae._data(i,"globalEval")&&ae.contains(o,i)&&(i.src?ae._evalUrl&&ae._evalUrl(i.src):ae.globalEval((i.text||i.textContent||i.innerHTML||"").replace(Xe,"")));s=n=null}return this}}),ae.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){ae.fn[t]=function(t){for(var n,i=0,r=[],a=ae(t),o=a.length-1;o>=i;i++)n=i===o?this:this.clone(!0),ae(a[i])[e](n),Z.apply(r,n.get());return this.pushStack(r)}});var Je,tn={};!function(){var t,e,n=ge.createElement("div"),i="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";n.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",t=n.getElementsByTagName("a")[0],t.style.cssText="float:left;opacity:.5",ie.opacity=/^0.5/.test(t.style.opacity),ie.cssFloat=!!t.style.cssFloat,n.style.backgroundClip="content-box",n.cloneNode(!0).style.backgroundClip="",ie.clearCloneStyle="content-box"===n.style.backgroundClip,t=n=null,ie.shrinkWrapBlocks=function(){var t,n,r,a;if(null==e){if(t=ge.getElementsByTagName("body")[0],!t)return;a="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",n=ge.createElement("div"),r=ge.createElement("div"),t.appendChild(n).appendChild(r),e=!1,typeof r.style.zoom!==Ae&&(r.style.cssText=i+";width:1px;padding:1px;zoom:1",r.innerHTML="<div></div>",r.firstChild.style.width="5px",e=3!==r.offsetWidth),t.removeChild(n),t=n=r=null}return e}}();var en,nn,rn=/^margin/,an=RegExp("^("+Ee+")(?!px)[a-z%]+$","i"),on=/^(top|right|bottom|left)$/;t.getComputedStyle?(en=function(t){return t.ownerDocument.defaultView.getComputedStyle(t,null)},nn=function(t,e,n){var i,r,a,o,s=t.style;return n=n||en(t),o=n?n.getPropertyValue(e)||n[e]:void 0,n&&(""!==o||ae.contains(t.ownerDocument,t)||(o=ae.style(t,e)),an.test(o)&&rn.test(e)&&(i=s.width,r=s.minWidth,a=s.maxWidth,s.minWidth=s.maxWidth=s.width=o,o=n.width,s.width=i,s.minWidth=r,s.maxWidth=a)),void 0===o?o:o+""}):ge.documentElement.currentStyle&&(en=function(t){return t.currentStyle
},nn=function(t,e,n){var i,r,a,o,s=t.style;return n=n||en(t),o=n?n[e]:void 0,null==o&&s&&s[e]&&(o=s[e]),an.test(o)&&!on.test(e)&&(i=s.left,r=t.runtimeStyle,a=r&&r.left,a&&(r.left=t.currentStyle.left),s.left="fontSize"===e?"1em":o,o=s.pixelLeft+"px",s.left=i,a&&(r.left=a)),void 0===o?o:o+""||"auto"}),!function(){function e(){var e,n,i=ge.getElementsByTagName("body")[0];i&&(e=ge.createElement("div"),n=ge.createElement("div"),e.style.cssText=c,i.appendChild(e).appendChild(n),n.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;display:block;padding:1px;border:1px;width:4px;margin-top:1%;top:1%",ae.swap(i,null!=i.style.zoom?{zoom:1}:{},function(){r=4===n.offsetWidth}),a=!0,o=!1,s=!0,t.getComputedStyle&&(o="1%"!==(t.getComputedStyle(n,null)||{}).top,a="4px"===(t.getComputedStyle(n,null)||{width:"4px"}).width),i.removeChild(e),n=i=null)}var n,i,r,a,o,s,l=ge.createElement("div"),c="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",u="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";l.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=l.getElementsByTagName("a")[0],n.style.cssText="float:left;opacity:.5",ie.opacity=/^0.5/.test(n.style.opacity),ie.cssFloat=!!n.style.cssFloat,l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",ie.clearCloneStyle="content-box"===l.style.backgroundClip,n=l=null,ae.extend(ie,{reliableHiddenOffsets:function(){if(null!=i)return i;var t,e,n,r=ge.createElement("div"),a=ge.getElementsByTagName("body")[0];return a?(r.setAttribute("className","t"),r.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",t=ge.createElement("div"),t.style.cssText=c,a.appendChild(t).appendChild(r),r.innerHTML="<table><tr><td></td><td>t</td></tr></table>",e=r.getElementsByTagName("td"),e[0].style.cssText="padding:0;margin:0;border:0;display:none",n=0===e[0].offsetHeight,e[0].style.display="",e[1].style.display="none",i=n&&0===e[0].offsetHeight,a.removeChild(t),r=a=null,i):void 0},boxSizing:function(){return null==r&&e(),r},boxSizingReliable:function(){return null==a&&e(),a},pixelPosition:function(){return null==o&&e(),o},reliableMarginRight:function(){var e,n,i,r;if(null==s&&t.getComputedStyle){if(e=ge.getElementsByTagName("body")[0],!e)return;n=ge.createElement("div"),i=ge.createElement("div"),n.style.cssText=c,e.appendChild(n).appendChild(i),r=i.appendChild(ge.createElement("div")),r.style.cssText=i.style.cssText=u,r.style.marginRight=r.style.width="0",i.style.width="1px",s=!parseFloat((t.getComputedStyle(r,null)||{}).marginRight),e.removeChild(n)}return s}})}(),ae.swap=function(t,e,n,i){var r,a,o={};for(a in e)o[a]=t.style[a],t.style[a]=e[a];r=n.apply(t,i||[]);for(a in e)t.style[a]=o[a];return r};var sn=/alpha\([^)]*\)/i,ln=/opacity\s*=\s*([^)]*)/,cn=/^(none|table(?!-c[ea]).+)/,un=RegExp("^("+Ee+")(.*)$","i"),dn=RegExp("^([+-])=("+Ee+")","i"),hn={position:"absolute",visibility:"hidden",display:"block"},pn={letterSpacing:0,fontWeight:400},fn=["Webkit","O","Moz","ms"];ae.extend({cssHooks:{opacity:{get:function(t,e){if(e){var n=nn(t,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":ie.cssFloat?"cssFloat":"styleFloat"},style:function(t,e,n,i){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var r,a,o,s=ae.camelCase(e),l=t.style;if(e=ae.cssProps[s]||(ae.cssProps[s]=E(l,s)),o=ae.cssHooks[e]||ae.cssHooks[s],void 0===n)return o&&"get"in o&&void 0!==(r=o.get(t,!1,i))?r:l[e];if(a=typeof n,"string"===a&&(r=dn.exec(n))&&(n=(r[1]+1)*r[2]+parseFloat(ae.css(t,e)),a="number"),null!=n&&n===n&&("number"!==a||ae.cssNumber[s]||(n+="px"),ie.clearCloneStyle||""!==n||0!==e.indexOf("background")||(l[e]="inherit"),!(o&&"set"in o&&void 0===(n=o.set(t,n,i)))))try{l[e]="",l[e]=n}catch(c){}}},css:function(t,e,n,i){var r,a,o,s=ae.camelCase(e);return e=ae.cssProps[s]||(ae.cssProps[s]=E(t.style,s)),o=ae.cssHooks[e]||ae.cssHooks[s],o&&"get"in o&&(a=o.get(t,!0,n)),void 0===a&&(a=nn(t,e,i)),"normal"===a&&e in pn&&(a=pn[e]),""===n||n?(r=parseFloat(a),n===!0||ae.isNumeric(r)?r||0:a):a}}),ae.each(["height","width"],function(t,e){ae.cssHooks[e]={get:function(t,n,i){return n?0===t.offsetWidth&&cn.test(ae.css(t,"display"))?ae.swap(t,hn,function(){return D(t,e,i)}):D(t,e,i):void 0},set:function(t,n,i){var r=i&&en(t);return M(t,n,i?I(t,e,i,ie.boxSizing()&&"border-box"===ae.css(t,"boxSizing",!1,r),r):0)}}}),ie.opacity||(ae.cssHooks.opacity={get:function(t,e){return ln.test((e&&t.currentStyle?t.currentStyle.filter:t.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":e?"1":""},set:function(t,e){var n=t.style,i=t.currentStyle,r=ae.isNumeric(e)?"alpha(opacity="+100*e+")":"",a=i&&i.filter||n.filter||"";n.zoom=1,(e>=1||""===e)&&""===ae.trim(a.replace(sn,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===e||i&&!i.filter)||(n.filter=sn.test(a)?a.replace(sn,r):a+" "+r)}}),ae.cssHooks.marginRight=C(ie.reliableMarginRight,function(t,e){return e?ae.swap(t,{display:"inline-block"},nn,[t,"marginRight"]):void 0}),ae.each({margin:"",padding:"",border:"Width"},function(t,e){ae.cssHooks[t+e]={expand:function(n){for(var i=0,r={},a="string"==typeof n?n.split(" "):[n];4>i;i++)r[t+Se[i]+e]=a[i]||a[i-2]||a[0];return r}},rn.test(t)||(ae.cssHooks[t+e].set=M)}),ae.fn.extend({css:function(t,e){return Ie(this,function(t,e,n){var i,r,a={},o=0;if(ae.isArray(e)){for(i=en(t),r=e.length;r>o;o++)a[e[o]]=ae.css(t,e[o],!1,i);return a}return void 0!==n?ae.style(t,e,n):ae.css(t,e)},t,e,arguments.length>1)},show:function(){return S(this,!0)},hide:function(){return S(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){Me(this)?ae(this).show():ae(this).hide()})}}),ae.Tween=P,P.prototype={constructor:P,init:function(t,e,n,i,r,a){this.elem=t,this.prop=n,this.easing=r||"swing",this.options=e,this.start=this.now=this.cur(),this.end=i,this.unit=a||(ae.cssNumber[n]?"":"px")},cur:function(){var t=P.propHooks[this.prop];return t&&t.get?t.get(this):P.propHooks._default.get(this)},run:function(t){var e,n=P.propHooks[this.prop];return this.pos=e=this.options.duration?ae.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):P.propHooks._default.set(this),this}},P.prototype.init.prototype=P.prototype,P.propHooks={_default:{get:function(t){var e;return null==t.elem[t.prop]||t.elem.style&&null!=t.elem.style[t.prop]?(e=ae.css(t.elem,t.prop,""),e&&"auto"!==e?e:0):t.elem[t.prop]},set:function(t){ae.fx.step[t.prop]?ae.fx.step[t.prop](t):t.elem.style&&(null!=t.elem.style[ae.cssProps[t.prop]]||ae.cssHooks[t.prop])?ae.style(t.elem,t.prop,t.now+t.unit):t.elem[t.prop]=t.now}}},P.propHooks.scrollTop=P.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},ae.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2}},ae.fx=P.prototype.init,ae.fx.step={};var gn,mn,vn=/^(?:toggle|show|hide)$/,yn=RegExp("^(?:([+-])=|)("+Ee+")([a-z%]*)$","i"),bn=/queueHooks$/,xn=[O],Tn={"*":[function(t,e){var n=this.createTween(t,e),i=n.cur(),r=yn.exec(e),a=r&&r[3]||(ae.cssNumber[t]?"":"px"),o=(ae.cssNumber[t]||"px"!==a&&+i)&&yn.exec(ae.css(n.elem,t)),s=1,l=20;if(o&&o[3]!==a){a=a||o[3],r=r||[],o=+i||1;do s=s||".5",o/=s,ae.style(n.elem,t,o+a);while(s!==(s=n.cur()/i)&&1!==s&&--l)}return r&&(o=n.start=+o||+i||0,n.unit=a,n.end=r[1]?o+(r[1]+1)*r[2]:+r[2]),n}]};ae.Animation=ae.extend(F,{tweener:function(t,e){ae.isFunction(t)?(e=t,t=["*"]):t=t.split(" ");for(var n,i=0,r=t.length;r>i;i++)n=t[i],Tn[n]=Tn[n]||[],Tn[n].unshift(e)},prefilter:function(t,e){e?xn.unshift(t):xn.push(t)}}),ae.speed=function(t,e,n){var i=t&&"object"==typeof t?ae.extend({},t):{complete:n||!n&&e||ae.isFunction(t)&&t,duration:t,easing:n&&e||e&&!ae.isFunction(e)&&e};return i.duration=ae.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in ae.fx.speeds?ae.fx.speeds[i.duration]:ae.fx.speeds._default,(null==i.queue||i.queue===!0)&&(i.queue="fx"),i.old=i.complete,i.complete=function(){ae.isFunction(i.old)&&i.old.call(this),i.queue&&ae.dequeue(this,i.queue)},i},ae.fn.extend({fadeTo:function(t,e,n,i){return this.filter(Me).css("opacity",0).show().end().animate({opacity:e},t,n,i)},animate:function(t,e,n,i){var r=ae.isEmptyObject(t),a=ae.speed(e,n,i),o=function(){var e=F(this,ae.extend({},t),a);(r||ae._data(this,"finish"))&&e.stop(!0)};return o.finish=o,r||a.queue===!1?this.each(o):this.queue(a.queue,o)},stop:function(t,e,n){var i=function(t){var e=t.stop;delete t.stop,e(n)};return"string"!=typeof t&&(n=e,e=t,t=void 0),e&&t!==!1&&this.queue(t||"fx",[]),this.each(function(){var e=!0,r=null!=t&&t+"queueHooks",a=ae.timers,o=ae._data(this);if(r)o[r]&&o[r].stop&&i(o[r]);else for(r in o)o[r]&&o[r].stop&&bn.test(r)&&i(o[r]);for(r=a.length;r--;)a[r].elem!==this||null!=t&&a[r].queue!==t||(a[r].anim.stop(n),e=!1,a.splice(r,1));(e||!n)&&ae.dequeue(this,t)})},finish:function(t){return t!==!1&&(t=t||"fx"),this.each(function(){var e,n=ae._data(this),i=n[t+"queue"],r=n[t+"queueHooks"],a=ae.timers,o=i?i.length:0;for(n.finish=!0,ae.queue(this,t,[]),r&&r.stop&&r.stop.call(this,!0),e=a.length;e--;)a[e].elem===this&&a[e].queue===t&&(a[e].anim.stop(!0),a.splice(e,1));for(e=0;o>e;e++)i[e]&&i[e].finish&&i[e].finish.call(this);delete n.finish})}}),ae.each(["toggle","show","hide"],function(t,e){var n=ae.fn[e];ae.fn[e]=function(t,i,r){return null==t||"boolean"==typeof t?n.apply(this,arguments):this.animate(N(e,!0),t,i,r)}}),ae.each({slideDown:N("show"),slideUp:N("hide"),slideToggle:N("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){ae.fn[t]=function(t,n,i){return this.animate(e,t,n,i)}}),ae.timers=[],ae.fx.tick=function(){var t,e=ae.timers,n=0;for(gn=ae.now();e.length>n;n++)t=e[n],t()||e[n]!==t||e.splice(n--,1);e.length||ae.fx.stop(),gn=void 0},ae.fx.timer=function(t){ae.timers.push(t),t()?ae.fx.start():ae.timers.pop()},ae.fx.interval=13,ae.fx.start=function(){mn||(mn=setInterval(ae.fx.tick,ae.fx.interval))},ae.fx.stop=function(){clearInterval(mn),mn=null},ae.fx.speeds={slow:600,fast:200,_default:400},ae.fn.delay=function(t,e){return t=ae.fx?ae.fx.speeds[t]||t:t,e=e||"fx",this.queue(e,function(e,n){var i=setTimeout(e,t);n.stop=function(){clearTimeout(i)}})},function(){var t,e,n,i,r=ge.createElement("div");r.setAttribute("className","t"),r.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",t=r.getElementsByTagName("a")[0],n=ge.createElement("select"),i=n.appendChild(ge.createElement("option")),e=r.getElementsByTagName("input")[0],t.style.cssText="top:1px",ie.getSetAttribute="t"!==r.className,ie.style=/top/.test(t.getAttribute("style")),ie.hrefNormalized="/a"===t.getAttribute("href"),ie.checkOn=!!e.value,ie.optSelected=i.selected,ie.enctype=!!ge.createElement("form").enctype,n.disabled=!0,ie.optDisabled=!i.disabled,e=ge.createElement("input"),e.setAttribute("value",""),ie.input=""===e.getAttribute("value"),e.value="t",e.setAttribute("type","radio"),ie.radioValue="t"===e.value,t=e=n=i=r=null}();var wn=/\r/g;ae.fn.extend({val:function(t){var e,n,i,r=this[0];return arguments.length?(i=ae.isFunction(t),this.each(function(n){var r;1===this.nodeType&&(r=i?t.call(this,n,ae(this).val()):t,null==r?r="":"number"==typeof r?r+="":ae.isArray(r)&&(r=ae.map(r,function(t){return null==t?"":t+""})),e=ae.valHooks[this.type]||ae.valHooks[this.nodeName.toLowerCase()],e&&"set"in e&&void 0!==e.set(this,r,"value")||(this.value=r))})):r?(e=ae.valHooks[r.type]||ae.valHooks[r.nodeName.toLowerCase()],e&&"get"in e&&void 0!==(n=e.get(r,"value"))?n:(n=r.value,"string"==typeof n?n.replace(wn,""):null==n?"":n)):void 0}}),ae.extend({valHooks:{option:{get:function(t){var e=ae.find.attr(t,"value");return null!=e?e:ae.text(t)}},select:{get:function(t){for(var e,n,i=t.options,r=t.selectedIndex,a="select-one"===t.type||0>r,o=a?null:[],s=a?r+1:i.length,l=0>r?s:a?r:0;s>l;l++)if(n=i[l],!(!n.selected&&l!==r||(ie.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&ae.nodeName(n.parentNode,"optgroup"))){if(e=ae(n).val(),a)return e;o.push(e)}return o},set:function(t,e){for(var n,i,r=t.options,a=ae.makeArray(e),o=r.length;o--;)if(i=r[o],ae.inArray(ae.valHooks.option.get(i),a)>=0)try{i.selected=n=!0}catch(s){i.scrollHeight}else i.selected=!1;return n||(t.selectedIndex=-1),r}}}}),ae.each(["radio","checkbox"],function(){ae.valHooks[this]={set:function(t,e){return ae.isArray(e)?t.checked=ae.inArray(ae(t).val(),e)>=0:void 0}},ie.checkOn||(ae.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})});var kn,An,_n=ae.expr.attrHandle,Cn=/^(?:checked|selected)$/i,En=ie.getSetAttribute,Sn=ie.input;ae.fn.extend({attr:function(t,e){return Ie(this,ae.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each(function(){ae.removeAttr(this,t)})}}),ae.extend({attr:function(t,e,n){var i,r,a=t.nodeType;return t&&3!==a&&8!==a&&2!==a?typeof t.getAttribute===Ae?ae.prop(t,e,n):(1===a&&ae.isXMLDoc(t)||(e=e.toLowerCase(),i=ae.attrHooks[e]||(ae.expr.match.bool.test(e)?An:kn)),void 0===n?i&&"get"in i&&null!==(r=i.get(t,e))?r:(r=ae.find.attr(t,e),null==r?void 0:r):null!==n?i&&"set"in i&&void 0!==(r=i.set(t,n,e))?r:(t.setAttribute(e,n+""),n):void ae.removeAttr(t,e)):void 0},removeAttr:function(t,e){var n,i,r=0,a=e&&e.match(xe);if(a&&1===t.nodeType)for(;n=a[r++];)i=ae.propFix[n]||n,ae.expr.match.bool.test(n)?Sn&&En||!Cn.test(n)?t[i]=!1:t[ae.camelCase("default-"+n)]=t[i]=!1:ae.attr(t,n,""),t.removeAttribute(En?n:i)},attrHooks:{type:{set:function(t,e){if(!ie.radioValue&&"radio"===e&&ae.nodeName(t,"input")){var n=t.value;return t.setAttribute("type",e),n&&(t.value=n),e}}}}}),An={set:function(t,e,n){return e===!1?ae.removeAttr(t,n):Sn&&En||!Cn.test(n)?t.setAttribute(!En&&ae.propFix[n]||n,n):t[ae.camelCase("default-"+n)]=t[n]=!0,n}},ae.each(ae.expr.match.bool.source.match(/\w+/g),function(t,e){var n=_n[e]||ae.find.attr;_n[e]=Sn&&En||!Cn.test(e)?function(t,e,i){var r,a;return i||(a=_n[e],_n[e]=r,r=null!=n(t,e,i)?e.toLowerCase():null,_n[e]=a),r}:function(t,e,n){return n?void 0:t[ae.camelCase("default-"+e)]?e.toLowerCase():null}}),Sn&&En||(ae.attrHooks.value={set:function(t,e,n){return ae.nodeName(t,"input")?void(t.defaultValue=e):kn&&kn.set(t,e,n)}}),En||(kn={set:function(t,e,n){var i=t.getAttributeNode(n);return i||t.setAttributeNode(i=t.ownerDocument.createAttribute(n)),i.value=e+="","value"===n||e===t.getAttribute(n)?e:void 0}},_n.id=_n.name=_n.coords=function(t,e,n){var i;return n?void 0:(i=t.getAttributeNode(e))&&""!==i.value?i.value:null},ae.valHooks.button={get:function(t,e){var n=t.getAttributeNode(e);return n&&n.specified?n.value:void 0},set:kn.set},ae.attrHooks.contenteditable={set:function(t,e,n){kn.set(t,""===e?!1:e,n)}},ae.each(["width","height"],function(t,e){ae.attrHooks[e]={set:function(t,n){return""===n?(t.setAttribute(e,"auto"),n):void 0}}})),ie.style||(ae.attrHooks.style={get:function(t){return t.style.cssText||void 0},set:function(t,e){return t.style.cssText=e+""}});var Mn=/^(?:input|select|textarea|button|object)$/i,In=/^(?:a|area)$/i;ae.fn.extend({prop:function(t,e){return Ie(this,ae.prop,t,e,arguments.length>1)},removeProp:function(t){return t=ae.propFix[t]||t,this.each(function(){try{this[t]=void 0,delete this[t]}catch(e){}})}}),ae.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(t,e,n){var i,r,a,o=t.nodeType;return t&&3!==o&&8!==o&&2!==o?(a=1!==o||!ae.isXMLDoc(t),a&&(e=ae.propFix[e]||e,r=ae.propHooks[e]),void 0!==n?r&&"set"in r&&void 0!==(i=r.set(t,n,e))?i:t[e]=n:r&&"get"in r&&null!==(i=r.get(t,e))?i:t[e]):void 0},propHooks:{tabIndex:{get:function(t){var e=ae.find.attr(t,"tabindex");return e?parseInt(e,10):Mn.test(t.nodeName)||In.test(t.nodeName)&&t.href?0:-1}}}}),ie.hrefNormalized||ae.each(["href","src"],function(t,e){ae.propHooks[e]={get:function(t){return t.getAttribute(e,4)}}}),ie.optSelected||(ae.propHooks.selected={get:function(t){var e=t.parentNode;return e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex),null}}),ae.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){ae.propFix[this.toLowerCase()]=this}),ie.enctype||(ae.propFix.enctype="encoding");var Dn=/[\t\r\n\f]/g;ae.fn.extend({addClass:function(t){var e,n,i,r,a,o,s=0,l=this.length,c="string"==typeof t&&t;if(ae.isFunction(t))return this.each(function(e){ae(this).addClass(t.call(this,e,this.className))});if(c)for(e=(t||"").match(xe)||[];l>s;s++)if(n=this[s],i=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(Dn," "):" ")){for(a=0;r=e[a++];)0>i.indexOf(" "+r+" ")&&(i+=r+" ");o=ae.trim(i),n.className!==o&&(n.className=o)}return this},removeClass:function(t){var e,n,i,r,a,o,s=0,l=this.length,c=0===arguments.length||"string"==typeof t&&t;if(ae.isFunction(t))return this.each(function(e){ae(this).removeClass(t.call(this,e,this.className))});if(c)for(e=(t||"").match(xe)||[];l>s;s++)if(n=this[s],i=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(Dn," "):"")){for(a=0;r=e[a++];)for(;i.indexOf(" "+r+" ")>=0;)i=i.replace(" "+r+" "," ");o=t?ae.trim(i):"",n.className!==o&&(n.className=o)}return this},toggleClass:function(t,e){var n=typeof t;return"boolean"==typeof e&&"string"===n?e?this.addClass(t):this.removeClass(t):this.each(ae.isFunction(t)?function(n){ae(this).toggleClass(t.call(this,n,this.className,e),e)}:function(){if("string"===n)for(var e,i=0,r=ae(this),a=t.match(xe)||[];e=a[i++];)r.hasClass(e)?r.removeClass(e):r.addClass(e);else(n===Ae||"boolean"===n)&&(this.className&&ae._data(this,"__className__",this.className),this.className=this.className||t===!1?"":ae._data(this,"__className__")||"")})},hasClass:function(t){for(var e=" "+t+" ",n=0,i=this.length;i>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(Dn," ").indexOf(e)>=0)return!0;return!1}}),ae.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(t,e){ae.fn[e]=function(t,n){return arguments.length>0?this.on(e,null,t,n):this.trigger(e)}}),ae.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)},bind:function(t,e,n){return this.on(t,null,e,n)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,n,i){return this.on(e,t,n,i)},undelegate:function(t,e,n){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",n)}});var Pn=ae.now(),$n=/\?/,Nn=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;ae.parseJSON=function(e){if(t.JSON&&t.JSON.parse)return t.JSON.parse(e+"");var n,i=null,r=ae.trim(e+"");return r&&!ae.trim(r.replace(Nn,function(t,e,r,a){return n&&e&&(i=0),0===i?t:(n=r||e,i+=!a-!r,"")}))?Function("return "+r)():ae.error("Invalid JSON: "+e)},ae.parseXML=function(e){var n,i;if(!e||"string"!=typeof e)return null;try{t.DOMParser?(i=new DOMParser,n=i.parseFromString(e,"text/xml")):(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(e))}catch(r){n=void 0}return n&&n.documentElement&&!n.getElementsByTagName("parsererror").length||ae.error("Invalid XML: "+e),n};var Gn,On,Ln=/#.*$/,Fn=/([?&])_=[^&]*/,Bn=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Rn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Hn=/^(?:GET|HEAD)$/,Un=/^\/\//,zn=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,jn={},Wn={},qn="*/".concat("*");try{On=location.href}catch(Vn){On=ge.createElement("a"),On.href="",On=On.href}Gn=zn.exec(On.toLowerCase())||[],ae.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:On,type:"GET",isLocal:Rn.test(Gn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":qn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":ae.parseJSON,"text xml":ae.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?H(H(t,ae.ajaxSettings),e):H(ae.ajaxSettings,t)},ajaxPrefilter:B(jn),ajaxTransport:B(Wn),ajax:function(t,e){function n(t,e,n,i){var r,u,v,y,x,w=e;2!==b&&(b=2,s&&clearTimeout(s),c=void 0,o=i||"",T.readyState=t>0?4:0,r=t>=200&&300>t||304===t,n&&(y=U(d,T,n)),y=z(d,y,T,r),r?(d.ifModified&&(x=T.getResponseHeader("Last-Modified"),x&&(ae.lastModified[a]=x),x=T.getResponseHeader("etag"),x&&(ae.etag[a]=x)),204===t||"HEAD"===d.type?w="nocontent":304===t?w="notmodified":(w=y.state,u=y.data,v=y.error,r=!v)):(v=w,(t||!w)&&(w="error",0>t&&(t=0))),T.status=t,T.statusText=(e||w)+"",r?f.resolveWith(h,[u,w,T]):f.rejectWith(h,[T,w,v]),T.statusCode(m),m=void 0,l&&p.trigger(r?"ajaxSuccess":"ajaxError",[T,d,r?u:v]),g.fireWith(h,[T,w]),l&&(p.trigger("ajaxComplete",[T,d]),--ae.active||ae.event.trigger("ajaxStop")))}"object"==typeof t&&(e=t,t=void 0),e=e||{};var i,r,a,o,s,l,c,u,d=ae.ajaxSetup({},e),h=d.context||d,p=d.context&&(h.nodeType||h.jquery)?ae(h):ae.event,f=ae.Deferred(),g=ae.Callbacks("once memory"),m=d.statusCode||{},v={},y={},b=0,x="canceled",T={readyState:0,getResponseHeader:function(t){var e;if(2===b){if(!u)for(u={};e=Bn.exec(o);)u[e[1].toLowerCase()]=e[2];e=u[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return 2===b?o:null},setRequestHeader:function(t,e){var n=t.toLowerCase();return b||(t=y[n]=y[n]||t,v[t]=e),this},overrideMimeType:function(t){return b||(d.mimeType=t),this},statusCode:function(t){var e;if(t)if(2>b)for(e in t)m[e]=[m[e],t[e]];else T.always(t[T.status]);return this},abort:function(t){var e=t||x;return c&&c.abort(e),n(0,e),this}};if(f.promise(T).complete=g.add,T.success=T.done,T.error=T.fail,d.url=((t||d.url||On)+"").replace(Ln,"").replace(Un,Gn[1]+"//"),d.type=e.method||e.type||d.method||d.type,d.dataTypes=ae.trim(d.dataType||"*").toLowerCase().match(xe)||[""],null==d.crossDomain&&(i=zn.exec(d.url.toLowerCase()),d.crossDomain=!(!i||i[1]===Gn[1]&&i[2]===Gn[2]&&(i[3]||("http:"===i[1]?"80":"443"))===(Gn[3]||("http:"===Gn[1]?"80":"443")))),d.data&&d.processData&&"string"!=typeof d.data&&(d.data=ae.param(d.data,d.traditional)),R(jn,d,e,T),2===b)return T;l=d.global,l&&0===ae.active++&&ae.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!Hn.test(d.type),a=d.url,d.hasContent||(d.data&&(a=d.url+=($n.test(a)?"&":"?")+d.data,delete d.data),d.cache===!1&&(d.url=Fn.test(a)?a.replace(Fn,"$1_="+Pn++):a+($n.test(a)?"&":"?")+"_="+Pn++)),d.ifModified&&(ae.lastModified[a]&&T.setRequestHeader("If-Modified-Since",ae.lastModified[a]),ae.etag[a]&&T.setRequestHeader("If-None-Match",ae.etag[a])),(d.data&&d.hasContent&&d.contentType!==!1||e.contentType)&&T.setRequestHeader("Content-Type",d.contentType),T.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+qn+"; q=0.01":""):d.accepts["*"]);for(r in d.headers)T.setRequestHeader(r,d.headers[r]);if(d.beforeSend&&(d.beforeSend.call(h,T,d)===!1||2===b))return T.abort();x="abort";for(r in{success:1,error:1,complete:1})T[r](d[r]);if(c=R(Wn,d,e,T)){T.readyState=1,l&&p.trigger("ajaxSend",[T,d]),d.async&&d.timeout>0&&(s=setTimeout(function(){T.abort("timeout")},d.timeout));try{b=1,c.send(v,n)}catch(w){if(!(2>b))throw w;n(-1,w)}}else n(-1,"No Transport");return T},getJSON:function(t,e,n){return ae.get(t,e,n,"json")},getScript:function(t,e){return ae.get(t,void 0,e,"script")}}),ae.each(["get","post"],function(t,e){ae[e]=function(t,n,i,r){return ae.isFunction(n)&&(r=r||i,i=n,n=void 0),ae.ajax({url:t,type:e,dataType:r,data:n,success:i})}}),ae.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){ae.fn[e]=function(t){return this.on(e,t)}}),ae._evalUrl=function(t){return ae.ajax({url:t,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},ae.fn.extend({wrapAll:function(t){if(ae.isFunction(t))return this.each(function(e){ae(this).wrapAll(t.call(this,e))});if(this[0]){var e=ae(t,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstChild&&1===t.firstChild.nodeType;)t=t.firstChild;return t}).append(this)}return this},wrapInner:function(t){return this.each(ae.isFunction(t)?function(e){ae(this).wrapInner(t.call(this,e))}:function(){var e=ae(this),n=e.contents();n.length?n.wrapAll(t):e.append(t)})},wrap:function(t){var e=ae.isFunction(t);return this.each(function(n){ae(this).wrapAll(e?t.call(this,n):t)})},unwrap:function(){return this.parent().each(function(){ae.nodeName(this,"body")||ae(this).replaceWith(this.childNodes)}).end()}}),ae.expr.filters.hidden=function(t){return 0>=t.offsetWidth&&0>=t.offsetHeight||!ie.reliableHiddenOffsets()&&"none"===(t.style&&t.style.display||ae.css(t,"display"))},ae.expr.filters.visible=function(t){return!ae.expr.filters.hidden(t)};var Yn=/%20/g,Xn=/\[\]$/,Kn=/\r?\n/g,Zn=/^(?:submit|button|image|reset|file)$/i,Qn=/^(?:input|select|textarea|keygen)/i;ae.param=function(t,e){var n,i=[],r=function(t,e){e=ae.isFunction(e)?e():null==e?"":e,i[i.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(void 0===e&&(e=ae.ajaxSettings&&ae.ajaxSettings.traditional),ae.isArray(t)||t.jquery&&!ae.isPlainObject(t))ae.each(t,function(){r(this.name,this.value)});else for(n in t)j(n,t[n],e,r);return i.join("&").replace(Yn,"+")},ae.fn.extend({serialize:function(){return ae.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=ae.prop(this,"elements");return t?ae.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!ae(this).is(":disabled")&&Qn.test(this.nodeName)&&!Zn.test(t)&&(this.checked||!De.test(t))}).map(function(t,e){var n=ae(this).val();return null==n?null:ae.isArray(n)?ae.map(n,function(t){return{name:e.name,value:t.replace(Kn,"\r\n")}}):{name:e.name,value:n.replace(Kn,"\r\n")}}).get()}}),ae.ajaxSettings.xhr=void 0!==t.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&W()||q()}:W;var Jn=0,ti={},ei=ae.ajaxSettings.xhr();t.ActiveXObject&&ae(t).on("unload",function(){for(var t in ti)ti[t](void 0,!0)}),ie.cors=!!ei&&"withCredentials"in ei,ei=ie.ajax=!!ei,ei&&ae.ajaxTransport(function(t){if(!t.crossDomain||ie.cors){var e;return{send:function(n,i){var r,a=t.xhr(),o=++Jn;if(a.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(r in t.xhrFields)a[r]=t.xhrFields[r];t.mimeType&&a.overrideMimeType&&a.overrideMimeType(t.mimeType),t.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(r in n)void 0!==n[r]&&a.setRequestHeader(r,n[r]+"");a.send(t.hasContent&&t.data||null),e=function(n,r){var s,l,c;if(e&&(r||4===a.readyState))if(delete ti[o],e=void 0,a.onreadystatechange=ae.noop,r)4!==a.readyState&&a.abort();else{c={},s=a.status,"string"==typeof a.responseText&&(c.text=a.responseText);try{l=a.statusText}catch(u){l=""}s||!t.isLocal||t.crossDomain?1223===s&&(s=204):s=c.text?200:404}c&&i(s,l,c,a.getAllResponseHeaders())},t.async?4===a.readyState?setTimeout(e):a.onreadystatechange=ti[o]=e:e()},abort:function(){e&&e(void 0,!0)}}}}),ae.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(t){return ae.globalEval(t),t}}}),ae.ajaxPrefilter("script",function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET",t.global=!1)}),ae.ajaxTransport("script",function(t){if(t.crossDomain){var e,n=ge.head||ae("head")[0]||ge.documentElement;return{send:function(i,r){e=ge.createElement("script"),e.async=!0,t.scriptCharset&&(e.charset=t.scriptCharset),e.src=t.url,e.onload=e.onreadystatechange=function(t,n){(n||!e.readyState||/loaded|complete/.test(e.readyState))&&(e.onload=e.onreadystatechange=null,e.parentNode&&e.parentNode.removeChild(e),e=null,n||r(200,"success"))},n.insertBefore(e,n.firstChild)},abort:function(){e&&e.onload(void 0,!0)}}}});var ni=[],ii=/(=)\?(?=&|$)|\?\?/;ae.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=ni.pop()||ae.expando+"_"+Pn++;return this[t]=!0,t}}),ae.ajaxPrefilter("json jsonp",function(e,n,i){var r,a,o,s=e.jsonp!==!1&&(ii.test(e.url)?"url":"string"==typeof e.data&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&ii.test(e.data)&&"data");return s||"jsonp"===e.dataTypes[0]?(r=e.jsonpCallback=ae.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,s?e[s]=e[s].replace(ii,"$1"+r):e.jsonp!==!1&&(e.url+=($n.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||ae.error(r+" was not called"),o[0]},e.dataTypes[0]="json",a=t[r],t[r]=function(){o=arguments},i.always(function(){t[r]=a,e[r]&&(e.jsonpCallback=n.jsonpCallback,ni.push(r)),o&&ae.isFunction(a)&&a(o[0]),o=a=void 0}),"script"):void 0}),ae.parseHTML=function(t,e,n){if(!t||"string"!=typeof t)return null;"boolean"==typeof e&&(n=e,e=!1),e=e||ge;var i=he.exec(t),r=!n&&[];return i?[e.createElement(i[1])]:(i=ae.buildFragment([t],e,r),r&&r.length&&ae(r).remove(),ae.merge([],i.childNodes))};var ri=ae.fn.load;ae.fn.load=function(t,e,n){if("string"!=typeof t&&ri)return ri.apply(this,arguments);var i,r,a,o=this,s=t.indexOf(" ");return s>=0&&(i=t.slice(s,t.length),t=t.slice(0,s)),ae.isFunction(e)?(n=e,e=void 0):e&&"object"==typeof e&&(a="POST"),o.length>0&&ae.ajax({url:t,type:a,dataType:"html",data:e}).done(function(t){r=arguments,o.html(i?ae("<div>").append(ae.parseHTML(t)).find(i):t)}).complete(n&&function(t,e){o.each(n,r||[t.responseText,e,t])}),this},ae.expr.filters.animated=function(t){return ae.grep(ae.timers,function(e){return t===e.elem}).length};var ai=t.document.documentElement;ae.offset={setOffset:function(t,e,n){var i,r,a,o,s,l,c,u=ae.css(t,"position"),d=ae(t),h={};"static"===u&&(t.style.position="relative"),s=d.offset(),a=ae.css(t,"top"),l=ae.css(t,"left"),c=("absolute"===u||"fixed"===u)&&ae.inArray("auto",[a,l])>-1,c?(i=d.position(),o=i.top,r=i.left):(o=parseFloat(a)||0,r=parseFloat(l)||0),ae.isFunction(e)&&(e=e.call(t,n,s)),null!=e.top&&(h.top=e.top-s.top+o),null!=e.left&&(h.left=e.left-s.left+r),"using"in e?e.using.call(t,h):d.css(h)}},ae.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){ae.offset.setOffset(this,t,e)});var e,n,i={top:0,left:0},r=this[0],a=r&&r.ownerDocument;return a?(e=a.documentElement,ae.contains(e,r)?(typeof r.getBoundingClientRect!==Ae&&(i=r.getBoundingClientRect()),n=V(a),{top:i.top+(n.pageYOffset||e.scrollTop)-(e.clientTop||0),left:i.left+(n.pageXOffset||e.scrollLeft)-(e.clientLeft||0)}):i):void 0},position:function(){if(this[0]){var t,e,n={top:0,left:0},i=this[0];return"fixed"===ae.css(i,"position")?e=i.getBoundingClientRect():(t=this.offsetParent(),e=this.offset(),ae.nodeName(t[0],"html")||(n=t.offset()),n.top+=ae.css(t[0],"borderTopWidth",!0),n.left+=ae.css(t[0],"borderLeftWidth",!0)),{top:e.top-n.top-ae.css(i,"marginTop",!0),left:e.left-n.left-ae.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||ai;t&&!ae.nodeName(t,"html")&&"static"===ae.css(t,"position");)t=t.offsetParent;return t||ai})}}),ae.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,e){var n=/Y/.test(e);ae.fn[t]=function(i){return Ie(this,function(t,i,r){var a=V(t);return void 0===r?a?e in a?a[e]:a.document.documentElement[i]:t[i]:void(a?a.scrollTo(n?ae(a).scrollLeft():r,n?r:ae(a).scrollTop()):t[i]=r)},t,i,arguments.length,null)}}),ae.each(["top","left"],function(t,e){ae.cssHooks[e]=C(ie.pixelPosition,function(t,n){return n?(n=nn(t,e),an.test(n)?ae(t).position()[e]+"px":n):void 0
})}),ae.each({Height:"height",Width:"width"},function(t,e){ae.each({padding:"inner"+t,content:e,"":"outer"+t},function(n,i){ae.fn[i]=function(i,r){var a=arguments.length&&(n||"boolean"!=typeof i),o=n||(i===!0||r===!0?"margin":"border");return Ie(this,function(e,n,i){var r;return ae.isWindow(e)?e.document.documentElement["client"+t]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+t],r["scroll"+t],e.body["offset"+t],r["offset"+t],r["client"+t])):void 0===i?ae.css(e,n,o):ae.style(e,n,i,o)},e,a?i:void 0,a,null)}})}),ae.fn.size=function(){return this.length},ae.fn.andSelf=ae.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return ae});var oi=t.jQuery,si=t.$;return ae.noConflict=function(e){return t.$===ae&&(t.$=si),e&&t.jQuery===ae&&(t.jQuery=oi),ae},typeof e===Ae&&(t.jQuery=t.$=ae),ae});var e,n,i,r,a,o,s=t.path||"",l=t.containerId,c=t.serverIp,u=(t.hiddenCollections||[],t.allowServerChange),d=t.allowAuthoringMode,h=t.width,p=t.height,f=t.idleDuration||0,g=t.tourId;if("string"!=typeof s)return console.log("specify a string path to the directory containing TAG"),void 0;if(!l||"string"!=typeof l)return console.log("tagContainerId must be a valid string"),void 0;if(e=document.getElementById(l),!l||!e)return console.log("no tagContainerId argument specified or no element with matching id"),void 0;localStorage.invisibleCollectionsTAG=JSON.stringify(t.hiddenCollections),s&&"/"!==s[s.length-1]&&(s+="/"),c=c||"browntagserver.com",h=parseFloat(h||e.style.width||"740"),p=parseFloat(p||e.style.height||"460"),a=document.createElement("div"),a.style.width=h+"px",a.style.height=p+"px",a.style.position="relative",a.id="frameContainer",e.appendChild(a),o=document.createElement("div"),o.id="frameInnerContainer",a.appendChild(o),n=document.createElement("iframe"),n.setAttribute("allowfullscreen","true"),n.style.width=h+"px",n.style.height=p+"px",n.style.position="relative",n.style.border="0px",o.appendChild(n),r='<!DOCTYPE html>                 <html>                 <head>                     <meta charset="utf-8" />                     <title>Touch Art Gallery</title>                     <script src="'+s+'TAG.js"></script>                     <script>                         window.onload = function() {                             TAG_GLOBAL({                                 path:"'+s+'",                                 containerId:"tagContainer",                                 serverIp:"'+c+'",                                 allowServerChange:'+u+",                                 allowAuthoringMode: "+d+",                                 idleDuration:"+f+",                                 tourId:"+(g?'"'+g+'"':"null")+'                             });                         };                     </script>                     <style>                         * {                             margin: 0px;                             padding: 0px;                         }                     </style>                 </head>                 <body>                     <div id="tagContainer" style="background:#222222;margin-left:16px; margin-top:0px; width:'+(h-32)+"px; height:"+(p-18)+'px;">                     </div>                 </body>                 </html>',i=n.contentWindow.document,i.open(),i.write(r),i.close();var m=o;$frameDiv=$(m);var v=0,y=0,b=0;$frameDiv.on("mouseenter",function(){var t,n;v=$(document).scrollTop(),y=$(document).scrollLeft(),b=parseFloat($("body").css("margin-left")),t=$(e).offset().left,$("body").css({position:"fixed","margin-top":-v+"px"}),n=$(e).offset().left,$("body").css({"margin-left":b+t-n-y+"px"})}),$frameDiv.on("mouseleave",function(){$("body").css({position:"static","margin-top":"0px","margin-left":b+"px"}),$(document).scrollTop(v),$(document).scrollLeft(y)})},TAG_GLOBAL=function(tagInput){function json2xml(t,e){var n=function(t,e,i){var r="";if(t instanceof Array)for(var a=0,o=t.length;o>a;a++)r+=i+n(t[a],e,i+"	")+"\n";else if("object"==typeof t){var s=!1;r+=i+"<"+e;for(var l in t)"@"==l.charAt(0)?r+=" "+l.substr(1)+'="'+(""+t[l])+'"':s=!0;if(r+=s?">":"/>",s){for(var l in t)"#text"==l?r+=t[l]:"#cdata"==l?r+="<![CDATA["+t[l]+"]]>":"@"!=l.charAt(0)&&(r+=n(t[l],l,i+"	"));r+=("\n"==r.charAt(r.length-1)?i:"")+"</"+e+">"}}else r+=i+"<"+e+">"+(""+t)+"</"+e+">";return r},i="";for(var r in t)i+=n(t[r],r,"");return e?i.replace(/\t/g,e):i.replace(/\t|\n/g,"")}function AVLTree(t,e){"use strict";this._comparator=t,this._root=null,this._intermediates=[],this._current=null,this._valuation=e}function AVLNode(t,e){"use strict";this._comparator=e,this._left=null,this._right=null,this._value=t,this._height=1}function binaryHeap(t){"use strict";this.content=[],this.scoreFunction=t||function(t){return t}}function DataHolder(){"use strict";this._trackArray=[],this._scoreFunctionMin=function(t){return t.bound},this._selectedTrack,this._leftExternal=new binaryHeap(this._scoreFunctionMin),this._leftInternal=new binaryHeap(this._scoreFunctionMin),this._rightExternal=new binaryHeap(this._scoreFunctionMin),this._rightInternal=new binaryHeap(this._scoreFunctionMin),this._dispComparator=function(t,e){return t.display.getStart()<e.display.getStart()?-1:t.display.getStart()>e.display.getStart()?1:0},this._kfComparator=function(t,e){return t.getTime()<e.getTime()?-1:t.getTime()>e.getTime()?1:0},this._dispValuation=function(t,e){return e?e.display.getStart()>t?-1:t>e.display.getStart()?1:0:!1},this._kfValuation=function(t,e){return e?e.getTime()>t?-1:t>e.getTime()?1:0:!1}}function DoublyLinkedList(){"use strict";this._head=null,this._tail=null,this._length=0}function HashTable(){this._length=0,this._items={}}var tagPath=tagInput.path,containerId=tagInput.containerId,ip=tagInput.serverIp,allowServerChange=tagInput.allowServerChange,allowAuthoringMode=tagInput.allowAuthoringMode,idleDuration=tagInput.idleDuration,currentPage={},INPUT_TOUR_ID=tagInput.tourId,idleTimer;(function(t,e){function n(t){var e,n,i=L[t]={};for(t=t.split(/\s+/),e=0,n=t.length;n>e;e++)i[t[e]]=!0;return i}function i(t,n,i){if(i===e&&1===t.nodeType){var r="data-"+n.replace(R,"-$1").toLowerCase();if(i=t.getAttribute(r),"string"==typeof i){try{i="true"===i?!0:"false"===i?!1:"null"===i?null:O.isNumeric(i)?parseFloat(i):B.test(i)?O.parseJSON(i):i}catch(a){}O.data(t,n,i)}else i=e}return i}function r(t){for(var e in t)if(("data"!==e||!O.isEmptyObject(t[e]))&&"toJSON"!==e)return!1;return!0}function a(t,e,n){var i=e+"defer",r=e+"queue",a=e+"mark",o=O._data(t,i);!o||"queue"!==n&&O._data(t,r)||"mark"!==n&&O._data(t,a)||setTimeout(function(){O._data(t,r)||O._data(t,a)||(O.removeData(t,i,!0),o.fire())},0)}function o(){return!1}function s(){return!0}function l(t){return!t||!t.parentNode||11===t.parentNode.nodeType}function c(t,e,n){if(e=e||0,O.isFunction(e))return O.grep(t,function(t,i){var r=!!e.call(t,i,t);return r===n});if(e.nodeType)return O.grep(t,function(t){return t===e===n});if("string"==typeof e){var i=O.grep(t,function(t){return 1===t.nodeType});if(de.test(e))return O.filter(e,i,!n);e=O.filter(e,i)}return O.grep(t,function(t){return O.inArray(t,e)>=0===n})}function u(t){var e=ge.split("|"),n=t.createDocumentFragment();if(n.createElement)for(;e.length;)n.createElement(e.pop());return n}function d(t){return O.nodeName(t,"table")?t.getElementsByTagName("tbody")[0]||t.appendChild(t.ownerDocument.createElement("tbody")):t}function h(t,e){if(1===e.nodeType&&O.hasData(t)){var n,i,r,a=O._data(t),o=O._data(e,a),s=a.events;if(s){delete o.handle,o.events={};for(n in s)for(i=0,r=s[n].length;r>i;i++)O.event.add(e,n+(s[n][i].namespace?".":"")+s[n][i].namespace,s[n][i],s[n][i].data)}o.data&&(o.data=O.extend({},o.data))}}function p(t,e){var n;1===e.nodeType&&(e.clearAttributes&&e.clearAttributes(),e.mergeAttributes&&e.mergeAttributes(t),n=e.nodeName.toLowerCase(),"object"===n?e.outerHTML=t.outerHTML:"input"!==n||"checkbox"!==t.type&&"radio"!==t.type?"option"===n?e.selected=t.defaultSelected:("input"===n||"textarea"===n)&&(e.defaultValue=t.defaultValue):(t.checked&&(e.defaultChecked=e.checked=t.checked),e.value!==t.value&&(e.value=t.value)),e.removeAttribute(O.expando))}function f(t){return t.getElementsByTagName!==e?t.getElementsByTagName("*"):t.querySelectorAll!==e?t.querySelectorAll("*"):[]}function g(t){("checkbox"===t.type||"radio"===t.type)&&(t.defaultChecked=t.checked)}function m(t){var n=(t.nodeName||"").toLowerCase();"input"===n?g(t):"script"!==n&&t.getElementsByTagName!==e&&O.grep(t.getElementsByTagName("input"),g)}function v(t){var e=$.createElement("div");return Me.appendChild(e),e.innerHTML=t.outerHTML,e.firstChild}function y(t,e){e.src?O.ajax({url:e.src,async:!1,dataType:"script"}):O.globalEval((e.text||e.textContent||e.innerHTML||"").replace(Ee,"/*$0*/")),e.parentNode&&e.parentNode.removeChild(e)}function b(t,e,n){var i="width"===e?t.offsetWidth:t.offsetHeight,r="width"===e?Re:He,a=0,o=r.length;if(i>0){if("border"!==n)for(;o>a;a++)n||(i-=parseFloat(O.css(t,"padding"+r[a]))||0),"margin"===n?i+=parseFloat(O.css(t,n+r[a]))||0:i-=parseFloat(O.css(t,"border"+r[a]+"Width"))||0;return i+"px"}if(i=Ie(t,e,e),(0>i||null==i)&&(i=t.style[e]||0),i=parseFloat(i)||0,n)for(;o>a;a++)i+=parseFloat(O.css(t,"padding"+r[a]))||0,"padding"!==n&&(i+=parseFloat(O.css(t,"border"+r[a]+"Width"))||0),"margin"===n&&(i+=parseFloat(O.css(t,n+r[a]))||0);return i+"px"}function x(t){return function(e,n){if("string"!=typeof e&&(n=e,e="*"),O.isFunction(n))for(var i,r,a,o=e.toLowerCase().split(nn),s=0,l=o.length;l>s;s++)i=o[s],a=/^\+/.test(i),a&&(i=i.substr(1)||"*"),r=t[i]=t[i]||[],r[a?"unshift":"push"](n)}}function T(t,n,i,r,a,o){a=a||n.dataTypes[0],o=o||{},o[a]=!0;for(var s,l=t[a],c=0,u=l?l.length:0,d=t===sn;u>c&&(d||!s);c++)s=l[c](n,i,r),"string"==typeof s&&(!d||o[s]?s=e:(n.dataTypes.unshift(s),s=T(t,n,i,r,s,o)));return!d&&s||o["*"]||(s=T(t,n,i,r,"*",o)),s}function w(t,n){var i,r,a=O.ajaxSettings.flatOptions||{};for(i in n)n[i]!==e&&((a[i]?t:r||(r={}))[i]=n[i]);r&&O.extend(!0,t,r)}function k(t,e,n,i){if(O.isArray(e))O.each(e,function(e,r){n||We.test(t)?i(t,r):k(t+"["+("object"==typeof r||O.isArray(r)?e:"")+"]",r,n,i)});else if(n||null==e||"object"!=typeof e)i(t,e);else for(var r in e)k(t+"["+r+"]",e[r],n,i)}function A(t,n,i){var r,a,o,s,l=t.contents,c=t.dataTypes,u=t.responseFields;for(a in u)a in i&&(n[u[a]]=i[a]);for(;"*"===c[0];)c.shift(),r===e&&(r=t.mimeType||n.getResponseHeader("content-type"));if(r)for(a in l)if(l[a]&&l[a].test(r)){c.unshift(a);break}if(c[0]in i)o=c[0];else{for(a in i){if(!c[0]||t.converters[a+" "+c[0]]){o=a;break}s||(s=a)}o=o||s}return o?(o!==c[0]&&c.unshift(o),i[o]):e}function _(t,n){t.dataFilter&&(n=t.dataFilter(n,t.dataType));var i,r,a,o,s,l,c,u,d=t.dataTypes,h={},p=d.length,f=d[0];for(i=1;p>i;i++){if(1===i)for(r in t.converters)"string"==typeof r&&(h[r.toLowerCase()]=t.converters[r]);if(o=f,f=d[i],"*"===f)f=o;else if("*"!==o&&o!==f){if(s=o+" "+f,l=h[s]||h["* "+f],!l){u=e;for(c in h)if(a=c.split(" "),(a[0]===o||"*"===a[0])&&(u=h[a[1]+" "+f])){c=h[c],c===!0?l=u:u===!0&&(l=c);break}}l||u||O.error("No conversion from "+s.replace(" "," to ")),l!==!0&&(n=l?l(n):u(c(n)))}}return n}function C(){try{return new t.XMLHttpRequest}catch(e){}}function E(){try{return new t.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}function S(){return setTimeout(M,0),bn=O.now()}function M(){bn=e}function I(t,e){var n={};return O.each(kn.concat.apply([],kn.slice(0,e)),function(){n[this]=t}),n}function D(t){if(!xn[t]){var e=$.body,n=O("<"+t+">").appendTo(e),i=n.css("display");n.remove(),("none"===i||""===i)&&(mn||(mn=$.createElement("iframe"),mn.frameBorder=mn.width=mn.height=0),e.appendChild(mn),vn&&mn.createElement||(vn=(mn.contentWindow||mn.contentDocument).document,vn.write(("CSS1Compat"===$.compatMode?"<!doctype html>":"")+"<html><body>"),vn.close()),n=vn.createElement(t),vn.body.appendChild(n),i=O.css(n,"display"),e.removeChild(mn)),xn[t]=i}return xn[t]}function P(t){return O.isWindow(t)?t:9===t.nodeType?t.defaultView||t.parentWindow:!1}var $=t.document,N=t.navigator,G=t.location,O=function(){function n(){if(!s.isReady){try{$.documentElement.doScroll("left")}catch(t){return setTimeout(n,1),e}s.ready()}}var i,r,a,o,s=function(t,e){return new s.fn.init(t,e,i)},l=t.jQuery,c=t.$,u=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,d=/\S/,h=/^\s+/,p=/\s+$/,f=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,g=/^[\],:{}\s]*$/,m=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,v=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,y=/(?:^|:|,)(?:\s*\[)+/g,b=/(webkit)[ \/]([\w.]+)/,x=/(opera)(?:.*version)?[ \/]([\w.]+)/,T=/(msie) ([\w.]+)/,w=/(mozilla)(?:.*? rv:([\w.]+))?/,k=/-([a-z]|[0-9])/gi,A=/^-ms-/,_=function(t,e){return(e+"").toUpperCase()},C=N.userAgent,E=Object.prototype.toString,S=Object.prototype.hasOwnProperty,M=Array.prototype.push,I=Array.prototype.slice,D=String.prototype.trim,P=Array.prototype.indexOf,G={};return s.fn=s.prototype={constructor:s,init:function(t,n,i){var r,a,o,l;if(!t)return this;if(t.nodeType)return this.context=this[0]=t,this.length=1,this;if("body"===t&&!n&&$.body)return this.context=$,this[0]=$.body,this.selector=t,this.length=1,this;if("string"==typeof t){if(r="<"===t.charAt(0)&&">"===t.charAt(t.length-1)&&t.length>=3?[null,t,null]:u.exec(t),!r||!r[1]&&n)return!n||n.jquery?(n||i).find(t):this.constructor(n).find(t);if(r[1])return n=n instanceof s?n[0]:n,l=n?n.ownerDocument||n:$,o=f.exec(t),o?s.isPlainObject(n)?(t=[$.createElement(o[1])],s.fn.attr.call(t,n,!0)):t=[l.createElement(o[1])]:(o=s.buildFragment([r[1]],[l]),t=(o.cacheable?s.clone(o.fragment):o.fragment).childNodes),s.merge(this,t);if(a=$.getElementById(r[2]),a&&a.parentNode){if(a.id!==r[2])return i.find(t);this.length=1,this[0]=a}return this.context=$,this.selector=t,this}return s.isFunction(t)?i.ready(t):(t.selector!==e&&(this.selector=t.selector,this.context=t.context),s.makeArray(t,this))},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length},toArray:function(){return I.call(this,0)},get:function(t){return null==t?this.toArray():0>t?this[this.length+t]:this[t]},pushStack:function(t,e,n){var i=this.constructor();return s.isArray(t)?M.apply(i,t):s.merge(i,t),i.prevObject=this,i.context=this.context,"find"===e?i.selector=this.selector+(this.selector?" ":"")+n:e&&(i.selector=this.selector+"."+e+"("+n+")"),i},each:function(t,e){return s.each(this,t,e)},ready:function(t){return s.bindReady(),a.add(t),this},eq:function(t){return t=+t,-1===t?this.slice(t):this.slice(t,t+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(I.apply(this,arguments),"slice",I.call(arguments).join(","))},map:function(t){return this.pushStack(s.map(this,function(e,n){return t.call(e,n,e)}))},end:function(){return this.prevObject||this.constructor(null)},push:M,sort:[].sort,splice:[].splice},s.fn.init.prototype=s.fn,s.extend=s.fn.extend=function(){var t,n,i,r,a,o,l=arguments[0]||{},c=1,u=arguments.length,d=!1;for("boolean"==typeof l&&(d=l,l=arguments[1]||{},c=2),"object"==typeof l||s.isFunction(l)||(l={}),u===c&&(l=this,--c);u>c;c++)if(null!=(t=arguments[c]))for(n in t)i=l[n],r=t[n],l!==r&&(d&&r&&(s.isPlainObject(r)||(a=s.isArray(r)))?(a?(a=!1,o=i&&s.isArray(i)?i:[]):o=i&&s.isPlainObject(i)?i:{},l[n]=s.extend(d,o,r)):r!==e&&(l[n]=r));return l},s.extend({noConflict:function(e){return t.$===s&&(t.$=c),e&&t.jQuery===s&&(t.jQuery=l),s},isReady:!1,readyWait:1,holdReady:function(t){t?s.readyWait++:s.ready(!0)},ready:function(t){if(t===!0&&!--s.readyWait||t!==!0&&!s.isReady){if(!$.body)return setTimeout(s.ready,1);if(s.isReady=!0,t!==!0&&--s.readyWait>0)return;a.fireWith($,[s]),s.fn.trigger&&s($).trigger("ready").off("ready")}},bindReady:function(){if(!a){if(a=s.Callbacks("once memory"),"complete"===$.readyState)return setTimeout(s.ready,1);if($.addEventListener)$.addEventListener("DOMContentLoaded",o,!1),t.addEventListener("load",s.ready,!1);else if($.attachEvent){$.attachEvent("onreadystatechange",o),t.attachEvent("onload",s.ready);var e=!1;try{e=null==t.frameElement}catch(i){}$.documentElement.doScroll&&e&&n()}}},isFunction:function(t){return"function"===s.type(t)},isArray:Array.isArray||function(t){return"array"===s.type(t)},isWindow:function(t){return t&&"object"==typeof t&&"setInterval"in t},isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},type:function(t){return null==t?t+"":G[E.call(t)]||"object"},isPlainObject:function(t){if(!t||"object"!==s.type(t)||t.nodeType||s.isWindow(t))return!1;try{if(t.constructor&&!S.call(t,"constructor")&&!S.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var i;for(i in t);return i===e||S.call(t,i)},isEmptyObject:function(t){for(var e in t)return!1;return!0},error:function(t){throw Error(t)},parseJSON:function(n){return"string"==typeof n&&n?(n=s.trim(n),t.JSON&&t.JSON.parse?t.JSON.parse(n):g.test(n.replace(m,"@").replace(v,"]").replace(y,""))?Function("return "+n)():(s.error("Invalid JSON: "+n),e)):null},parseXML:function(n){var i,r;try{t.DOMParser?(r=new DOMParser,i=r.parseFromString(n,"text/xml")):(i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(n))}catch(a){i=e}return i&&i.documentElement&&!i.getElementsByTagName("parsererror").length||s.error("Invalid XML: "+n),i},noop:function(){},globalEval:function(e){e&&d.test(e)&&(t.execScript||function(e){t.eval.call(t,e)})(e)},camelCase:function(t){return t.replace(A,"ms-").replace(k,_)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toUpperCase()===e.toUpperCase()},each:function(t,n,i){var r,a=0,o=t.length,l=o===e||s.isFunction(t);if(i)if(l){for(r in t)if(n.apply(t[r],i)===!1)break}else for(;o>a&&n.apply(t[a++],i)!==!1;);else if(l){for(r in t)if(n.call(t[r],r,t[r])===!1)break}else for(;o>a&&n.call(t[a],a,t[a++])!==!1;);return t},trim:D?function(t){return null==t?"":D.call(t)}:function(t){return null==t?"":(""+t).replace(h,"").replace(p,"")},makeArray:function(t,e){var n=e||[];if(null!=t){var i=s.type(t);null==t.length||"string"===i||"function"===i||"regexp"===i||s.isWindow(t)?M.call(n,t):s.merge(n,t)}return n},inArray:function(t,e,n){var i;if(e){if(P)return P.call(e,t,n);for(i=e.length,n=n?0>n?Math.max(0,i+n):n:0;i>n;n++)if(n in e&&e[n]===t)return n}return-1},merge:function(t,n){var i=t.length,r=0;if("number"==typeof n.length)for(var a=n.length;a>r;r++)t[i++]=n[r];else for(;n[r]!==e;)t[i++]=n[r++];return t.length=i,t},grep:function(t,e,n){var i,r=[];n=!!n;for(var a=0,o=t.length;o>a;a++)i=!!e(t[a],a),n!==i&&r.push(t[a]);return r},map:function(t,n,i){var r,a,o=[],l=0,c=t.length,u=t instanceof s||c!==e&&"number"==typeof c&&(c>0&&t[0]&&t[c-1]||0===c||s.isArray(t));if(u)for(;c>l;l++)r=n(t[l],l,i),null!=r&&(o[o.length]=r);else for(a in t)r=n(t[a],a,i),null!=r&&(o[o.length]=r);return o.concat.apply([],o)},guid:1,proxy:function(t,n){if("string"==typeof n){var i=t[n];n=t,t=i}if(!s.isFunction(t))return e;var r=I.call(arguments,2),a=function(){return t.apply(n,r.concat(I.call(arguments)))};return a.guid=t.guid=t.guid||a.guid||s.guid++,a},access:function(t,n,i,r,a,o){var l=t.length;if("object"==typeof n){for(var c in n)s.access(t,c,n[c],r,a,i);return t}if(i!==e){r=!o&&r&&s.isFunction(i);for(var u=0;l>u;u++)a(t[u],n,r?i.call(t[u],u,a(t[u],n)):i,o);return t}return l?a(t[0],n):e},now:function(){return(new Date).getTime()},uaMatch:function(t){t=t.toLowerCase();var e=b.exec(t)||x.exec(t)||T.exec(t)||0>t.indexOf("compatible")&&w.exec(t)||[];return{browser:e[1]||"",version:e[2]||"0"}},sub:function(){function t(e,n){return new t.fn.init(e,n)}s.extend(!0,t,this),t.superclass=this,t.fn=t.prototype=this(),t.fn.constructor=t,t.sub=this.sub,t.fn.init=function(n,i){return i&&i instanceof s&&!(i instanceof t)&&(i=t(i)),s.fn.init.call(this,n,i,e)},t.fn.init.prototype=t.fn;var e=t($);return t},browser:{}}),s.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(t,e){G["[object "+e+"]"]=e.toLowerCase()}),r=s.uaMatch(C),r.browser&&(s.browser[r.browser]=!0,s.browser.version=r.version),s.browser.webkit&&(s.browser.safari=!0),d.test(" ")&&(h=/^[\s\xA0]+/,p=/[\s\xA0]+$/),i=s($),$.addEventListener?o=function(){$.removeEventListener("DOMContentLoaded",o,!1),s.ready()}:$.attachEvent&&(o=function(){"complete"===$.readyState&&($.detachEvent("onreadystatechange",o),s.ready())}),s}(),L={};O.Callbacks=function(t){t=t?L[t]||n(t):{};var i,r,a,o,s,l=[],c=[],u=function(e){var n,i,r,a;for(n=0,i=e.length;i>n;n++)r=e[n],a=O.type(r),"array"===a?u(r):"function"===a&&(t.unique&&h.has(r)||l.push(r))},d=function(e,n){for(n=n||[],i=!t.memory||[e,n],r=!0,s=a||0,a=0,o=l.length;l&&o>s;s++)if(l[s].apply(e,n)===!1&&t.stopOnFalse){i=!0;break}r=!1,l&&(t.once?i===!0?h.disable():l=[]:c&&c.length&&(i=c.shift(),h.fireWith(i[0],i[1])))},h={add:function(){if(l){var t=l.length;u(arguments),r?o=l.length:i&&i!==!0&&(a=t,d(i[0],i[1]))}return this},remove:function(){if(l)for(var e=arguments,n=0,i=e.length;i>n;n++)for(var a=0;l.length>a&&(e[n]!==l[a]||(r&&o>=a&&(o--,s>=a&&s--),l.splice(a--,1),!t.unique));a++);return this},has:function(t){if(l)for(var e=0,n=l.length;n>e;e++)if(t===l[e])return!0;return!1},empty:function(){return l=[],this},disable:function(){return l=c=i=e,this},disabled:function(){return!l},lock:function(){return c=e,i&&i!==!0||h.disable(),this},locked:function(){return!c},fireWith:function(e,n){return c&&(r?t.once||c.push([e,n]):t.once&&i||d(e,n)),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!i}};return h};var F=[].slice;O.extend({Deferred:function(t){var e,n=O.Callbacks("once memory"),i=O.Callbacks("once memory"),r=O.Callbacks("memory"),a="pending",o={resolve:n,reject:i,notify:r},s={done:n.add,fail:i.add,progress:r.add,state:function(){return a},isResolved:n.fired,isRejected:i.fired,then:function(t,e,n){return l.done(t).fail(e).progress(n),this},always:function(){return l.done.apply(l,arguments).fail.apply(l,arguments),this},pipe:function(t,e,n){return O.Deferred(function(i){O.each({done:[t,"resolve"],fail:[e,"reject"],progress:[n,"notify"]},function(t,e){var n,r=e[0],a=e[1];O.isFunction(r)?l[t](function(){n=r.apply(this,arguments),n&&O.isFunction(n.promise)?n.promise().then(i.resolve,i.reject,i.notify):i[a+"With"](this===l?i:this,[n])}):l[t](i[a])})}).promise()},promise:function(t){if(null==t)t=s;else for(var e in s)t[e]=s[e];return t}},l=s.promise({});for(e in o)l[e]=o[e].fire,l[e+"With"]=o[e].fireWith;return l.done(function(){a="resolved"},i.disable,r.lock).fail(function(){a="rejected"},n.disable,r.lock),t&&t.call(l,l),l},when:function(t){function e(t){return function(e){i[t]=arguments.length>1?F.call(arguments,0):e,--s||l.resolveWith(l,i)}}function n(t){return function(e){o[t]=arguments.length>1?F.call(arguments,0):e,l.notifyWith(c,o)}}var i=F.call(arguments,0),r=0,a=i.length,o=Array(a),s=a,l=1>=a&&t&&O.isFunction(t.promise)?t:O.Deferred(),c=l.promise();if(a>1){for(;a>r;r++)i[r]&&i[r].promise&&O.isFunction(i[r].promise)?i[r].promise().then(e(r),l.reject,n(r)):--s;s||l.resolveWith(l,i)}else l!==t&&l.resolveWith(l,a?[t]:[]);return c}}),O.support=function(){var n,i,r,a,o,s,l,c,u,d,h,p,f=$.createElement("div");if($.documentElement,f.setAttribute("className","t"),f.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",i=f.getElementsByTagName("*"),r=f.getElementsByTagName("a")[0],!i||!i.length||!r)return{};a=$.createElement("select"),o=a.appendChild($.createElement("option")),s=f.getElementsByTagName("input")[0],n={leadingWhitespace:3===f.firstChild.nodeType,tbody:!f.getElementsByTagName("tbody").length,htmlSerialize:!!f.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:"/a"===r.getAttribute("href"),opacity:/^0.55/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:"on"===s.value,optSelected:o.selected,getSetAttribute:"t"!==f.className,enctype:!!$.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==$.createElement("nav").cloneNode(!0).outerHTML,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},s.checked=!0,n.noCloneChecked=s.cloneNode(!0).checked,a.disabled=!0,n.optDisabled=!o.disabled;try{delete f.test}catch(g){n.deleteExpando=!1}if(!f.addEventListener&&f.attachEvent&&f.fireEvent&&(f.attachEvent("onclick",function(){n.noCloneEvent=!1}),f.cloneNode(!0).fireEvent("onclick")),s=$.createElement("input"),s.value="t",s.setAttribute("type","radio"),n.radioValue="t"===s.value,s.setAttribute("checked","checked"),f.appendChild(s),c=$.createDocumentFragment(),c.appendChild(f.lastChild),n.checkClone=c.cloneNode(!0).cloneNode(!0).lastChild.checked,n.appendChecked=s.checked,c.removeChild(s),c.appendChild(f),f.innerHTML="",t.getComputedStyle&&(l=$.createElement("div"),l.style.width="0",l.style.marginRight="0",f.style.width="2px",f.appendChild(l),n.reliableMarginRight=0===(parseInt((t.getComputedStyle(l,null)||{marginRight:0}).marginRight,10)||0)),f.attachEvent)for(h in{submit:1,change:1,focusin:1})d="on"+h,p=d in f,p||(f.setAttribute(d,"return;"),p="function"==typeof f[d]),n[h+"Bubbles"]=p;return c.removeChild(f),c=a=o=l=f=s=null,O(function(){var t,i,r,a,o,s,l,c,d,h,g=$.getElementsByTagName("body")[0];g&&(s=1,l="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;",c="visibility:hidden;border:0;",d="style='"+l+"border:5px solid #000;padding:0;'",h="<div "+d+"><div></div></div>"+"<table "+d+" cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>",t=$.createElement("div"),t.style.cssText=c+"width:0;height:0;position:static;top:0;margin-top:"+s+"px",g.insertBefore(t,g.firstChild),f=$.createElement("div"),t.appendChild(f),f.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",u=f.getElementsByTagName("td"),p=0===u[0].offsetHeight,u[0].style.display="",u[1].style.display="none",n.reliableHiddenOffsets=p&&0===u[0].offsetHeight,f.innerHTML="",f.style.width=f.style.paddingLeft="1px",O.boxModel=n.boxModel=2===f.offsetWidth,f.style.zoom!==e&&(f.style.display="inline",f.style.zoom=1,n.inlineBlockNeedsLayout=2===f.offsetWidth,f.style.display="",f.innerHTML="<div style='width:4px;'></div>",n.shrinkWrapBlocks=2!==f.offsetWidth),f.style.cssText=l+c,f.innerHTML=h,i=f.firstChild,r=i.firstChild,a=i.nextSibling.firstChild.firstChild,o={doesNotAddBorder:5!==r.offsetTop,doesAddBorderForTableAndCells:5===a.offsetTop},r.style.position="fixed",r.style.top="20px",o.fixedPosition=20===r.offsetTop||15===r.offsetTop,r.style.position=r.style.top="",i.style.overflow="hidden",i.style.position="relative",o.subtractsBorderForOverflowNotVisible=-5===r.offsetTop,o.doesNotIncludeMarginInBodyOffset=g.offsetTop!==s,g.removeChild(t),f=t=null,O.extend(n,o))}),n}();var B=/^(?:\{.*\}|\[.*\])$/,R=/([A-Z])/g;O.extend({cache:{},uuid:0,expando:"jQuery"+(O.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(t){return t=t.nodeType?O.cache[t[O.expando]]:t[O.expando],!!t&&!r(t)},data:function(t,n,i,r){if(O.acceptData(t)){var a,o,s,l=O.expando,c="string"==typeof n,u=t.nodeType,d=u?O.cache:t,h=u?t[l]:t[l]&&l,p="events"===n;if(h&&d[h]&&(p||r||d[h].data)||!c||i!==e)return h||(u?t[l]=h=++O.uuid:h=l),d[h]||(d[h]={},u||(d[h].toJSON=O.noop)),("object"==typeof n||"function"==typeof n)&&(r?d[h]=O.extend(d[h],n):d[h].data=O.extend(d[h].data,n)),a=o=d[h],r||(o.data||(o.data={}),o=o.data),i!==e&&(o[O.camelCase(n)]=i),p&&!o[n]?a.events:(c?(s=o[n],null==s&&(s=o[O.camelCase(n)])):s=o,s)}},removeData:function(t,e,n){if(O.acceptData(t)){var i,a,o,s=O.expando,l=t.nodeType,c=l?O.cache:t,u=l?t[s]:s;if(c[u]){if(e&&(i=n?c[u]:c[u].data)){O.isArray(e)||(e in i?e=[e]:(e=O.camelCase(e),e=e in i?[e]:e.split(" ")));for(a=0,o=e.length;o>a;a++)delete i[e[a]];if(!(n?r:O.isEmptyObject)(i))return}(n||(delete c[u].data,r(c[u])))&&(O.support.deleteExpando||!c.setInterval?delete c[u]:c[u]=null,l&&(O.support.deleteExpando?delete t[s]:t.removeAttribute?t.removeAttribute(s):t[s]=null))}}},_data:function(t,e,n){return O.data(t,e,n,!0)},acceptData:function(t){if(t.nodeName){var e=O.noData[t.nodeName.toLowerCase()];if(e)return!(e===!0||t.getAttribute("classid")!==e)}return!0}}),O.fn.extend({data:function(t,n){var r,a,o,s=null;if(t===e){if(this.length&&(s=O.data(this[0]),1===this[0].nodeType&&!O._data(this[0],"parsedAttrs"))){a=this[0].attributes;for(var l=0,c=a.length;c>l;l++)o=a[l].name,0===o.indexOf("data-")&&(o=O.camelCase(o.substring(5)),i(this[0],o,s[o]));O._data(this[0],"parsedAttrs",!0)}return s}return"object"==typeof t?this.each(function(){O.data(this,t)}):(r=t.split("."),r[1]=r[1]?"."+r[1]:"",n===e?(s=this.triggerHandler("getData"+r[1]+"!",[r[0]]),s===e&&this.length&&(s=O.data(this[0],t),s=i(this[0],t,s)),s===e&&r[1]?this.data(r[0]):s):this.each(function(){var e=O(this),i=[r[0],n];e.triggerHandler("setData"+r[1]+"!",i),O.data(this,t,n),e.triggerHandler("changeData"+r[1]+"!",i)}))},removeData:function(t){return this.each(function(){O.removeData(this,t)})}}),O.extend({_mark:function(t,e){t&&(e=(e||"fx")+"mark",O._data(t,e,(O._data(t,e)||0)+1))},_unmark:function(t,e,n){if(t!==!0&&(n=e,e=t,t=!1),e){n=n||"fx";var i=n+"mark",r=t?0:(O._data(e,i)||1)-1;r?O._data(e,i,r):(O.removeData(e,i,!0),a(e,n,"mark"))}},queue:function(t,n,i){var r;return t?(n=(n||"fx")+"queue",r=O._data(t,n),i&&(!r||O.isArray(i)?r=O._data(t,n,O.makeArray(i)):r.push(i)),r||[]):e},dequeue:function(t,e){e=e||"fx";var n=O.queue(t,e),i=n.shift(),r={};"inprogress"===i&&(i=n.shift()),i&&("fx"===e&&n.unshift("inprogress"),O._data(t,e+".run",r),i.call(t,function(){O.dequeue(t,e)},r)),n.length||(O.removeData(t,e+"queue "+e+".run",!0),a(t,e,"queue"))}}),O.fn.extend({queue:function(t,n){return"string"!=typeof t&&(n=t,t="fx"),n===e?O.queue(this[0],t):this.each(function(){var e=O.queue(this,t,n);"fx"===t&&"inprogress"!==e[0]&&O.dequeue(this,t)})},dequeue:function(t){return this.each(function(){O.dequeue(this,t)})},delay:function(t,e){return t=O.fx?O.fx.speeds[t]||t:t,e=e||"fx",this.queue(e,function(e,n){var i=setTimeout(e,t);n.stop=function(){clearTimeout(i)}})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,n){function i(){--l||a.resolveWith(o,[o])}"string"!=typeof t&&(n=t,t=e),t=t||"fx";for(var r,a=O.Deferred(),o=this,s=o.length,l=1,c=t+"defer",u=t+"queue",d=t+"mark";s--;)(r=O.data(o[s],c,e,!0)||(O.data(o[s],u,e,!0)||O.data(o[s],d,e,!0))&&O.data(o[s],c,O.Callbacks("once memory"),!0))&&(l++,r.add(i));return i(),a.promise()}});var H,U,z,j=/[\n\t\r]/g,W=/\s+/,q=/\r/g,V=/^(?:button|input)$/i,Y=/^(?:button|input|object|select|textarea)$/i,X=/^a(?:rea)?$/i,K=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,Z=O.support.getSetAttribute;O.fn.extend({attr:function(t,e){return O.access(this,t,e,!0,O.attr)},removeAttr:function(t){return this.each(function(){O.removeAttr(this,t)})},prop:function(t,e){return O.access(this,t,e,!0,O.prop)},removeProp:function(t){return t=O.propFix[t]||t,this.each(function(){try{this[t]=e,delete this[t]}catch(n){}})},addClass:function(t){var e,n,i,r,a,o,s;if(O.isFunction(t))return this.each(function(e){O(this).addClass(t.call(this,e,this.className))});if(t&&"string"==typeof t)for(e=t.split(W),n=0,i=this.length;i>n;n++)if(r=this[n],1===r.nodeType)if(r.className||1!==e.length){for(a=" "+r.className+" ",o=0,s=e.length;s>o;o++)~a.indexOf(" "+e[o]+" ")||(a+=e[o]+" ");r.className=O.trim(a)}else r.className=t;return this},removeClass:function(t){var n,i,r,a,o,s,l;if(O.isFunction(t))return this.each(function(e){O(this).removeClass(t.call(this,e,this.className))});if(t&&"string"==typeof t||t===e)for(n=(t||"").split(W),i=0,r=this.length;r>i;i++)if(a=this[i],1===a.nodeType&&a.className)if(t){for(o=(" "+a.className+" ").replace(j," "),s=0,l=n.length;l>s;s++)o=o.replace(" "+n[s]+" "," ");a.className=O.trim(o)}else a.className="";return this},toggleClass:function(t,e){var n=typeof t,i="boolean"==typeof e;return O.isFunction(t)?this.each(function(n){O(this).toggleClass(t.call(this,n,this.className,e),e)}):this.each(function(){if("string"===n)for(var r,a=0,o=O(this),s=e,l=t.split(W);r=l[a++];)s=i?s:!o.hasClass(r),o[s?"addClass":"removeClass"](r);
else("undefined"===n||"boolean"===n)&&(this.className&&O._data(this,"__className__",this.className),this.className=this.className||t===!1?"":O._data(this,"__className__")||"")})},hasClass:function(t){for(var e=" "+t+" ",n=0,i=this.length;i>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(j," ").indexOf(e)>-1)return!0;return!1},val:function(t){var n,i,r,a=this[0];{if(arguments.length)return r=O.isFunction(t),this.each(function(i){var a,o=O(this);1===this.nodeType&&(a=r?t.call(this,i,o.val()):t,null==a?a="":"number"==typeof a?a+="":O.isArray(a)&&(a=O.map(a,function(t){return null==t?"":t+""})),n=O.valHooks[this.nodeName.toLowerCase()]||O.valHooks[this.type],n&&"set"in n&&n.set(this,a,"value")!==e||(this.value=a))});if(a)return n=O.valHooks[a.nodeName.toLowerCase()]||O.valHooks[a.type],n&&"get"in n&&(i=n.get(a,"value"))!==e?i:(i=a.value,"string"==typeof i?i.replace(q,""):null==i?"":i)}}}),O.extend({valHooks:{option:{get:function(t){var e=t.attributes.value;return!e||e.specified?t.value:t.text}},select:{get:function(t){var e,n,i,r,a=t.selectedIndex,o=[],s=t.options,l="select-one"===t.type;if(0>a)return null;for(n=l?a:0,i=l?a+1:s.length;i>n;n++)if(r=s[n],!(!r.selected||(O.support.optDisabled?r.disabled:null!==r.getAttribute("disabled"))||r.parentNode.disabled&&O.nodeName(r.parentNode,"optgroup"))){if(e=O(r).val(),l)return e;o.push(e)}return l&&!o.length&&s.length?O(s[a]).val():o},set:function(t,e){var n=O.makeArray(e);return O(t).find("option").each(function(){this.selected=O.inArray(O(this).val(),n)>=0}),n.length||(t.selectedIndex=-1),n}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(t,n,i,r){var a,o,s,l=t.nodeType;if(t&&3!==l&&8!==l&&2!==l)return r&&n in O.attrFn?O(t)[n](i):t.getAttribute===e?O.prop(t,n,i):(s=1!==l||!O.isXMLDoc(t),s&&(n=n.toLowerCase(),o=O.attrHooks[n]||(K.test(n)?U:H)),i!==e?null===i?(O.removeAttr(t,n),e):o&&"set"in o&&s&&(a=o.set(t,i,n))!==e?a:(t.setAttribute(n,""+i),i):o&&"get"in o&&s&&null!==(a=o.get(t,n))?a:(a=t.getAttribute(n),null===a?e:a))},removeAttr:function(t,e){var n,i,r,a,o=0;if(e&&1===t.nodeType)for(i=e.toLowerCase().split(W),a=i.length;a>o;o++)r=i[o],r&&(n=O.propFix[r]||r,O.attr(t,r,""),t.removeAttribute(Z?r:n),K.test(r)&&n in t&&(t[n]=!1))},attrHooks:{type:{set:function(t,e){if(V.test(t.nodeName)&&t.parentNode)O.error("type property can't be changed");else if(!O.support.radioValue&&"radio"===e&&O.nodeName(t,"input")){var n=t.value;return t.setAttribute("type",e),n&&(t.value=n),e}}},value:{get:function(t,e){return H&&O.nodeName(t,"button")?H.get(t,e):e in t?t.value:null},set:function(t,n,i){return H&&O.nodeName(t,"button")?H.set(t,n,i):(t.value=n,e)}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(t,n,i){var r,a,o,s=t.nodeType;if(t&&3!==s&&8!==s&&2!==s)return o=1!==s||!O.isXMLDoc(t),o&&(n=O.propFix[n]||n,a=O.propHooks[n]),i!==e?a&&"set"in a&&(r=a.set(t,i,n))!==e?r:t[n]=i:a&&"get"in a&&null!==(r=a.get(t,n))?r:t[n]},propHooks:{tabIndex:{get:function(t){var n=t.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):Y.test(t.nodeName)||X.test(t.nodeName)&&t.href?0:e}}}}),O.attrHooks.tabindex=O.propHooks.tabIndex,U={get:function(t,n){var i,r=O.prop(t,n);return r===!0||"boolean"!=typeof r&&(i=t.getAttributeNode(n))&&i.nodeValue!==!1?n.toLowerCase():e},set:function(t,e,n){var i;return e===!1?O.removeAttr(t,n):(i=O.propFix[n]||n,i in t&&(t[i]=!0),t.setAttribute(n,n.toLowerCase())),n}},Z||(z={name:!0,id:!0},H=O.valHooks.button={get:function(t,n){var i;return i=t.getAttributeNode(n),i&&(z[n]?""!==i.nodeValue:i.specified)?i.nodeValue:e},set:function(t,e,n){var i=t.getAttributeNode(n);return i||(i=$.createAttribute(n),t.setAttributeNode(i)),i.nodeValue=e+""}},O.attrHooks.tabindex.set=H.set,O.each(["width","height"],function(t,n){O.attrHooks[n]=O.extend(O.attrHooks[n],{set:function(t,i){return""===i?(t.setAttribute(n,"auto"),i):e}})}),O.attrHooks.contenteditable={get:H.get,set:function(t,e,n){""===e&&(e="false"),H.set(t,e,n)}}),O.support.hrefNormalized||O.each(["href","src","width","height"],function(t,n){O.attrHooks[n]=O.extend(O.attrHooks[n],{get:function(t){var i=t.getAttribute(n,2);return null===i?e:i}})}),O.support.style||(O.attrHooks.style={get:function(t){return t.style.cssText.toLowerCase()||e},set:function(t,e){return t.style.cssText=""+e}}),O.support.optSelected||(O.propHooks.selected=O.extend(O.propHooks.selected,{get:function(t){var e=t.parentNode;return e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex),null}})),O.support.enctype||(O.propFix.enctype="encoding"),O.support.checkOn||O.each(["radio","checkbox"],function(){O.valHooks[this]={get:function(t){return null===t.getAttribute("value")?"on":t.value}}}),O.each(["radio","checkbox"],function(){O.valHooks[this]=O.extend(O.valHooks[this],{set:function(t,n){return O.isArray(n)?t.checked=O.inArray(O(t).val(),n)>=0:e}})});var Q=/^(?:textarea|input|select)$/i,J=/^([^\.]*)?(?:\.(.+))?$/,te=/\bhover(\.\S+)?\b/,ee=/^key/,ne=/^(?:mouse|contextmenu)|click/,ie=/^(?:focusinfocus|focusoutblur)$/,re=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,ae=function(t){var e=re.exec(t);return e&&(e[1]=(e[1]||"").toLowerCase(),e[3]=e[3]&&RegExp("(?:^|\\s)"+e[3]+"(?:\\s|$)")),e},oe=function(t,e){var n=t.attributes||{};return!(e[1]&&t.nodeName.toLowerCase()!==e[1]||e[2]&&(n.id||{}).value!==e[2]||e[3]&&!e[3].test((n["class"]||{}).value))},se=function(t){return O.event.special.hover?t:t.replace(te,"mouseenter$1 mouseleave$1")};O.event={add:function(t,n,i,r,a){var o,s,l,c,u,d,h,p,f,g,m;if(3!==t.nodeType&&8!==t.nodeType&&n&&i&&(o=O._data(t))){for(i.handler&&(f=i,i=f.handler),i.guid||(i.guid=O.guid++),l=o.events,l||(o.events=l={}),s=o.handle,s||(o.handle=s=function(t){return O===e||t&&O.event.triggered===t.type?e:O.event.dispatch.apply(s.elem,arguments)},s.elem=t),n=O.trim(se(n)).split(" "),c=0;n.length>c;c++)u=J.exec(n[c])||[],d=u[1],h=(u[2]||"").split(".").sort(),m=O.event.special[d]||{},d=(a?m.delegateType:m.bindType)||d,m=O.event.special[d]||{},p=O.extend({type:d,origType:u[1],data:r,handler:i,guid:i.guid,selector:a,quick:ae(a),namespace:h.join(".")},f),g=l[d],g||(g=l[d]=[],g.delegateCount=0,m.setup&&m.setup.call(t,r,h,s)!==!1||(t.addEventListener?t.addEventListener(d,s,!1):t.attachEvent&&t.attachEvent("on"+d,s))),m.add&&(m.add.call(t,p),p.handler.guid||(p.handler.guid=i.guid)),a?g.splice(g.delegateCount++,0,p):g.push(p),O.event.global[d]=!0;t=null}},global:{},remove:function(t,e,n,i,r){var a,o,s,l,c,u,d,h,p,f,g,m,v=O.hasData(t)&&O._data(t);if(v&&(h=v.events)){for(e=O.trim(se(e||"")).split(" "),a=0;e.length>a;a++)if(o=J.exec(e[a])||[],s=l=o[1],c=o[2],s){for(p=O.event.special[s]||{},s=(i?p.delegateType:p.bindType)||s,g=h[s]||[],u=g.length,c=c?RegExp("(^|\\.)"+c.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null,d=0;g.length>d;d++)m=g[d],!r&&l!==m.origType||n&&n.guid!==m.guid||c&&!c.test(m.namespace)||i&&i!==m.selector&&("**"!==i||!m.selector)||(g.splice(d--,1),m.selector&&g.delegateCount--,p.remove&&p.remove.call(t,m));0===g.length&&u!==g.length&&(p.teardown&&p.teardown.call(t,c)!==!1||O.removeEvent(t,s,v.handle),delete h[s])}else for(s in h)O.event.remove(t,s+e[a],n,i,!0);O.isEmptyObject(h)&&(f=v.handle,f&&(f.elem=null),O.removeData(t,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(n,i,r,a){if(!r||3!==r.nodeType&&8!==r.nodeType){var o,s,l,c,u,d,h,p,f,g,m=n.type||n,v=[];if(!ie.test(m+O.event.triggered)&&(m.indexOf("!")>=0&&(m=m.slice(0,-1),s=!0),m.indexOf(".")>=0&&(v=m.split("."),m=v.shift(),v.sort()),r&&!O.event.customEvent[m]||O.event.global[m]))if(n="object"==typeof n?n[O.expando]?n:new O.Event(m,n):new O.Event(m),n.type=m,n.isTrigger=!0,n.exclusive=s,n.namespace=v.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+v.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,d=0>m.indexOf(":")?"on"+m:"",r){if(n.result=e,n.target||(n.target=r),i=null!=i?O.makeArray(i):[],i.unshift(n),h=O.event.special[m]||{},!h.trigger||h.trigger.apply(r,i)!==!1){if(f=[[r,h.bindType||m]],!a&&!h.noBubble&&!O.isWindow(r)){for(g=h.delegateType||m,c=ie.test(g+m)?r:r.parentNode,u=null;c;c=c.parentNode)f.push([c,g]),u=c;u&&u===r.ownerDocument&&f.push([u.defaultView||u.parentWindow||t,g])}for(l=0;f.length>l&&!n.isPropagationStopped();l++)c=f[l][0],n.type=f[l][1],p=(O._data(c,"events")||{})[n.type]&&O._data(c,"handle"),p&&p.apply(c,i),p=d&&c[d],p&&O.acceptData(c)&&p.apply(c,i)===!1&&n.preventDefault();return n.type=m,a||n.isDefaultPrevented()||h._default&&h._default.apply(r.ownerDocument,i)!==!1||"click"===m&&O.nodeName(r,"a")||!O.acceptData(r)||d&&r[m]&&("focus"!==m&&"blur"!==m||0!==n.target.offsetWidth)&&!O.isWindow(r)&&(u=r[d],u&&(r[d]=null),O.event.triggered=m,r[m](),O.event.triggered=e,u&&(r[d]=u)),n.result}}else{o=O.cache;for(l in o)o[l].events&&o[l].events[m]&&O.event.trigger(n,i,o[l].handle.elem,!0)}}},dispatch:function(n){n=O.event.fix(n||t.event);var i,r,a,o,s,l,c,u,d,h,p=(O._data(this,"events")||{})[n.type]||[],f=p.delegateCount,g=[].slice.call(arguments,0),m=!n.exclusive&&!n.namespace,v=[];if(g[0]=n,n.delegateTarget=this,f&&!n.target.disabled&&(!n.button||"click"!==n.type))for(o=O(this),o.context=this.ownerDocument||this,a=n.target;a!=this;a=a.parentNode||this){for(l={},u=[],o[0]=a,i=0;f>i;i++)d=p[i],h=d.selector,l[h]===e&&(l[h]=d.quick?oe(a,d.quick):o.is(h)),l[h]&&u.push(d);u.length&&v.push({elem:a,matches:u})}for(p.length>f&&v.push({elem:this,matches:p.slice(f)}),i=0;v.length>i&&!n.isPropagationStopped();i++)for(c=v[i],n.currentTarget=c.elem,r=0;c.matches.length>r&&!n.isImmediatePropagationStopped();r++)d=c.matches[r],(m||!n.namespace&&!d.namespace||n.namespace_re&&n.namespace_re.test(d.namespace))&&(n.data=d.data,n.handleObj=d,s=((O.event.special[d.origType]||{}).handle||d.handler).apply(c.elem,g),s!==e&&(n.result=s,s===!1&&(n.preventDefault(),n.stopPropagation())));return n.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,n){var i,r,a,o=n.button,s=n.fromElement;return null==t.pageX&&null!=n.clientX&&(i=t.target.ownerDocument||$,r=i.documentElement,a=i.body,t.pageX=n.clientX+(r&&r.scrollLeft||a&&a.scrollLeft||0)-(r&&r.clientLeft||a&&a.clientLeft||0),t.pageY=n.clientY+(r&&r.scrollTop||a&&a.scrollTop||0)-(r&&r.clientTop||a&&a.clientTop||0)),!t.relatedTarget&&s&&(t.relatedTarget=s===t.target?n.toElement:s),t.which||o===e||(t.which=1&o?1:2&o?3:4&o?2:0),t}},fix:function(t){if(t[O.expando])return t;var n,i,r=t,a=O.event.fixHooks[t.type]||{},o=a.props?this.props.concat(a.props):this.props;for(t=O.Event(r),n=o.length;n;)i=o[--n],t[i]=r[i];return t.target||(t.target=r.srcElement||$),3===t.target.nodeType&&(t.target=t.target.parentNode),t.metaKey===e&&(t.metaKey=t.ctrlKey),a.filter?a.filter(t,r):t},special:{ready:{setup:O.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(t,e,n){O.isWindow(this)&&(this.onbeforeunload=n)},teardown:function(t,e){this.onbeforeunload===e&&(this.onbeforeunload=null)}}},simulate:function(t,e,n,i){var r=O.extend(new O.Event,n,{type:t,isSimulated:!0,originalEvent:{}});i?O.event.trigger(r,null,e):O.event.dispatch.call(e,r),r.isDefaultPrevented()&&n.preventDefault()}},O.event.handle=O.event.dispatch,O.removeEvent=$.removeEventListener?function(t,e,n){t.removeEventListener&&t.removeEventListener(e,n,!1)}:function(t,e,n){t.detachEvent&&t.detachEvent("on"+e,n)},O.Event=function(t,n){return this instanceof O.Event?(t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||t.returnValue===!1||t.getPreventDefault&&t.getPreventDefault()?s:o):this.type=t,n&&O.extend(this,n),this.timeStamp=t&&t.timeStamp||O.now(),this[O.expando]=!0,e):new O.Event(t,n)},O.Event.prototype={preventDefault:function(){this.isDefaultPrevented=s;var t=this.originalEvent;t&&(t.preventDefault?t.preventDefault():t.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=s;var t=this.originalEvent;t&&(t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=s,this.stopPropagation()},isDefaultPrevented:o,isPropagationStopped:o,isImmediatePropagationStopped:o},O.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(t,e){O.event.special[t]={delegateType:e,bindType:e,handle:function(t){var n,i=this,r=t.relatedTarget,a=t.handleObj;return a.selector,(!r||r!==i&&!O.contains(i,r))&&(t.type=a.origType,n=a.handler.apply(this,arguments),t.type=e),n}}}),O.support.submitBubbles||(O.event.special.submit={setup:function(){return O.nodeName(this,"form")?!1:(O.event.add(this,"click._submit keypress._submit",function(t){var n=t.target,i=O.nodeName(n,"input")||O.nodeName(n,"button")?n.form:e;i&&!i._submit_attached&&(O.event.add(i,"submit._submit",function(t){this.parentNode&&!t.isTrigger&&O.event.simulate("submit",this.parentNode,t,!0)}),i._submit_attached=!0)}),e)},teardown:function(){return O.nodeName(this,"form")?!1:(O.event.remove(this,"._submit"),e)}}),O.support.changeBubbles||(O.event.special.change={setup:function(){return Q.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(O.event.add(this,"propertychange._change",function(t){"checked"===t.originalEvent.propertyName&&(this._just_changed=!0)}),O.event.add(this,"click._change",function(t){this._just_changed&&!t.isTrigger&&(this._just_changed=!1,O.event.simulate("change",this,t,!0))})),!1):(O.event.add(this,"beforeactivate._change",function(t){var e=t.target;Q.test(e.nodeName)&&!e._change_attached&&(O.event.add(e,"change._change",function(t){!this.parentNode||t.isSimulated||t.isTrigger||O.event.simulate("change",this.parentNode,t,!0)}),e._change_attached=!0)}),e)},handle:function(t){var n=t.target;return this!==n||t.isSimulated||t.isTrigger||"radio"!==n.type&&"checkbox"!==n.type?t.handleObj.handler.apply(this,arguments):e},teardown:function(){return O.event.remove(this,"._change"),Q.test(this.nodeName)}}),O.support.focusinBubbles||O.each({focus:"focusin",blur:"focusout"},function(t,e){var n=0,i=function(t){O.event.simulate(e,t.target,O.event.fix(t),!0)};O.event.special[e]={setup:function(){0===n++&&$.addEventListener(t,i,!0)},teardown:function(){0===--n&&$.removeEventListener(t,i,!0)}}}),O.fn.extend({on:function(t,n,i,r,a){var s,l;if("object"==typeof t){"string"!=typeof n&&(i=n,n=e);for(l in t)this.on(l,n,i,t[l],a);return this}if(null==i&&null==r?(r=n,i=n=e):null==r&&("string"==typeof n?(r=i,i=e):(r=i,i=n,n=e)),r===!1)r=o;else if(!r)return this;return 1===a&&(s=r,r=function(t){return O().off(t),s.apply(this,arguments)},r.guid=s.guid||(s.guid=O.guid++)),this.each(function(){O.event.add(this,t,r,i,n)})},one:function(t,e,n,i){return this.on.call(this,t,e,n,i,1)},off:function(t,n,i){if(t&&t.preventDefault&&t.handleObj){var r=t.handleObj;return O(t.delegateTarget).off(r.namespace?r.type+"."+r.namespace:r.type,r.selector,r.handler),this}if("object"==typeof t){for(var a in t)this.off(a,n,t[a]);return this}return(n===!1||"function"==typeof n)&&(i=n,n=e),i===!1&&(i=o),this.each(function(){O.event.remove(this,t,i,n)})},bind:function(t,e,n){return this.on(t,null,e,n)},unbind:function(t,e){return this.off(t,null,e)},live:function(t,e,n){return O(this.context).on(t,this.selector,e,n),this},die:function(t,e){return O(this.context).off(t,this.selector||"**",e),this},delegate:function(t,e,n,i){return this.on(e,t,n,i)},undelegate:function(t,e,n){return 1==arguments.length?this.off(t,"**"):this.off(e,t,n)},trigger:function(t,e){return this.each(function(){O.event.trigger(t,e,this)})},triggerHandler:function(t,n){return this[0]?O.event.trigger(t,n,this[0],!0):e},toggle:function(t){var e=arguments,n=t.guid||O.guid++,i=0,r=function(n){var r=(O._data(this,"lastToggle"+t.guid)||0)%i;return O._data(this,"lastToggle"+t.guid,r+1),n.preventDefault(),e[r].apply(this,arguments)||!1};for(r.guid=n;e.length>i;)e[i++].guid=n;return this.click(r)},hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),O.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(t,e){O.fn[e]=function(t,n){return null==n&&(n=t,t=null),arguments.length>0?this.on(e,null,t,n):this.trigger(e)},O.attrFn&&(O.attrFn[e]=!0),ee.test(e)&&(O.event.fixHooks[e]=O.event.keyHooks),ne.test(e)&&(O.event.fixHooks[e]=O.event.mouseHooks)}),function(){function t(t,e,n,i,a,o){for(var s=0,l=i.length;l>s;s++){var c=i[s];if(c){var u=!1;for(c=c[t];c;){if(c[r]===n){u=i[c.sizset];break}if(1!==c.nodeType||o||(c[r]=n,c.sizset=s),c.nodeName.toLowerCase()===e){u=c;break}c=c[t]}i[s]=u}}}function n(t,e,n,i,a,o){for(var s=0,l=i.length;l>s;s++){var c=i[s];if(c){var u=!1;for(c=c[t];c;){if(c[r]===n){u=i[c.sizset];break}if(1===c.nodeType)if(o||(c[r]=n,c.sizset=s),"string"!=typeof e){if(c===e){u=!0;break}}else if(h.filter(e,[c]).length>0){u=c;break}c=c[t]}i[s]=u}}}var i=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,r="sizcache"+(Math.random()+"").replace(".",""),a=0,o=Object.prototype.toString,s=!1,l=!0,c=/\\/g,u=/\r\n/g,d=/\W/;[0,0].sort(function(){return l=!1,0});var h=function(t,e,n,r){n=n||[],e=e||$;var a=e;if(1!==e.nodeType&&9!==e.nodeType)return[];if(!t||"string"!=typeof t)return n;var s,l,c,u,d,p,m,v,b=!0,x=h.isXML(e),T=[],k=t;do if(i.exec(""),s=i.exec(k),s&&(k=s[3],T.push(s[1]),s[2])){u=s[3];break}while(s);if(T.length>1&&g.exec(t))if(2===T.length&&f.relative[T[0]])l=w(T[0]+T[1],e,r);else for(l=f.relative[T[0]]?[e]:h(T.shift(),e);T.length;)t=T.shift(),f.relative[t]&&(t+=T.shift()),l=w(t,l,r);else if(!r&&T.length>1&&9===e.nodeType&&!x&&f.match.ID.test(T[0])&&!f.match.ID.test(T[T.length-1])&&(d=h.find(T.shift(),e,x),e=d.expr?h.filter(d.expr,d.set)[0]:d.set[0]),e)for(d=r?{expr:T.pop(),set:y(r)}:h.find(T.pop(),1!==T.length||"~"!==T[0]&&"+"!==T[0]||!e.parentNode?e:e.parentNode,x),l=d.expr?h.filter(d.expr,d.set):d.set,T.length>0?c=y(l):b=!1;T.length;)p=T.pop(),m=p,f.relative[p]?m=T.pop():p="",null==m&&(m=e),f.relative[p](c,m,x);else c=T=[];if(c||(c=l),c||h.error(p||t),"[object Array]"===o.call(c))if(b)if(e&&1===e.nodeType)for(v=0;null!=c[v];v++)c[v]&&(c[v]===!0||1===c[v].nodeType&&h.contains(e,c[v]))&&n.push(l[v]);else for(v=0;null!=c[v];v++)c[v]&&1===c[v].nodeType&&n.push(l[v]);else n.push.apply(n,c);else y(c,n);return u&&(h(u,a,n,r),h.uniqueSort(n)),n};h.uniqueSort=function(t){if(x&&(s=l,t.sort(x),s))for(var e=1;t.length>e;e++)t[e]===t[e-1]&&t.splice(e--,1);return t},h.matches=function(t,e){return h(t,null,null,e)},h.matchesSelector=function(t,e){return h(e,null,null,[t]).length>0},h.find=function(t,n,i){var r,a,o,s,l,u;if(!t)return[];for(a=0,o=f.order.length;o>a;a++)if(l=f.order[a],(s=f.leftMatch[l].exec(t))&&(u=s[1],s.splice(1,1),"\\"!==u.substr(u.length-1)&&(s[1]=(s[1]||"").replace(c,""),r=f.find[l](s,n,i),null!=r))){t=t.replace(f.match[l],"");break}return r||(r=n.getElementsByTagName!==e?n.getElementsByTagName("*"):[]),{set:r,expr:t}},h.filter=function(t,n,i,r){for(var a,o,s,l,c,u,d,p,g,m=t,v=[],y=n,b=n&&n[0]&&h.isXML(n[0]);t&&n.length;){for(s in f.filter)if(null!=(a=f.leftMatch[s].exec(t))&&a[2]){if(u=f.filter[s],d=a[1],o=!1,a.splice(1,1),"\\"===d.substr(d.length-1))continue;if(y===v&&(v=[]),f.preFilter[s])if(a=f.preFilter[s](a,y,i,v,r,b)){if(a===!0)continue}else o=l=!0;if(a)for(p=0;null!=(c=y[p]);p++)c&&(l=u(c,a,p,y),g=r^l,i&&null!=l?g?o=!0:y[p]=!1:g&&(v.push(c),o=!0));if(l!==e){if(i||(y=v),t=t.replace(f.match[s],""),!o)return[];break}}if(t===m){if(null!=o)break;h.error(t)}m=t}return y},h.error=function(t){throw Error("Syntax error, unrecognized expression: "+t)};var p=h.getText=function(t){var e,n,i=t.nodeType,r="";if(i){if(1===i||9===i){if("string"==typeof t.textContent)return t.textContent;if("string"==typeof t.innerText)return t.innerText.replace(u,"");for(t=t.firstChild;t;t=t.nextSibling)r+=p(t)}else if(3===i||4===i)return t.nodeValue}else for(e=0;n=t[e];e++)8!==n.nodeType&&(r+=p(n));return r},f=h.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(t){return t.getAttribute("href")},type:function(t){return t.getAttribute("type")}},relative:{"+":function(t,e){var n="string"==typeof e,i=n&&!d.test(e),r=n&&!i;i&&(e=e.toLowerCase());for(var a,o=0,s=t.length;s>o;o++)if(a=t[o]){for(;(a=a.previousSibling)&&1!==a.nodeType;);t[o]=r||a&&a.nodeName.toLowerCase()===e?a||!1:a===e}r&&h.filter(e,t,!0)},">":function(t,e){var n,i="string"==typeof e,r=0,a=t.length;if(i&&!d.test(e)){for(e=e.toLowerCase();a>r;r++)if(n=t[r]){var o=n.parentNode;t[r]=o.nodeName.toLowerCase()===e?o:!1}}else{for(;a>r;r++)n=t[r],n&&(t[r]=i?n.parentNode:n.parentNode===e);i&&h.filter(e,t,!0)}},"":function(e,i,r){var o,s=a++,l=n;"string"!=typeof i||d.test(i)||(i=i.toLowerCase(),o=i,l=t),l("parentNode",i,s,e,o,r)},"~":function(e,i,r){var o,s=a++,l=n;"string"!=typeof i||d.test(i)||(i=i.toLowerCase(),o=i,l=t),l("previousSibling",i,s,e,o,r)}},find:{ID:function(t,n,i){if(n.getElementById!==e&&!i){var r=n.getElementById(t[1]);return r&&r.parentNode?[r]:[]}},NAME:function(t,n){if(n.getElementsByName!==e){for(var i=[],r=n.getElementsByName(t[1]),a=0,o=r.length;o>a;a++)r[a].getAttribute("name")===t[1]&&i.push(r[a]);return 0===i.length?null:i}},TAG:function(t,n){return n.Methods,n.getElementsByTagName,"function"==typeof n.getElementsByTagName?n.getElementsByTagName(t[1]):e}},preFilter:{CLASS:function(t,e,n,i,r,a){if(t=" "+t[1].replace(c,"")+" ",a)return t;for(var o,s=0;null!=(o=e[s]);s++)o&&(r^(o.className&&(" "+o.className+" ").replace(/[\t\n\r]/g," ").indexOf(t)>=0)?n||i.push(o):n&&(e[s]=!1));return!1},ID:function(t){return t[1].replace(c,"")},TAG:function(t){return t[1].replace(c,"").toLowerCase()},CHILD:function(t){if("nth"===t[1]){t[2]||h.error(t[0]),t[2]=t[2].replace(/^\+|\s*/g,"");var e=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec("even"===t[2]&&"2n"||"odd"===t[2]&&"2n+1"||!/\D/.test(t[2])&&"0n+"+t[2]||t[2]);t[2]=e[1]+(e[2]||1)-0,t[3]=e[3]-0}else t[2]&&h.error(t[0]);return t[0]=a++,t},ATTR:function(t,e,n,i,r,a){var o=t[1]=t[1].replace(c,"");return!a&&f.attrMap[o]&&(t[1]=f.attrMap[o]),t[4]=(t[4]||t[5]||"").replace(c,""),"~="===t[2]&&(t[4]=" "+t[4]+" "),t},PSEUDO:function(t,e,n,r,a){if("not"===t[1]){if(!((i.exec(t[3])||"").length>1||/^\w/.test(t[3]))){var o=h.filter(t[3],e,n,!0^a);return n||r.push.apply(r,o),!1}t[3]=h(t[3],null,null,e)}else if(f.match.POS.test(t[0])||f.match.CHILD.test(t[0]))return!0;return t},POS:function(t){return t.unshift(!0),t}},filters:{enabled:function(t){return t.disabled===!1&&"hidden"!==t.type},disabled:function(t){return t.disabled===!0},checked:function(t){return t.checked===!0},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,t.selected===!0},parent:function(t){return!!t.firstChild},empty:function(t){return!t.firstChild},has:function(t,e,n){return!!h(n[3],t).length},header:function(t){return/h\d/i.test(t.nodeName)},text:function(t){var e=t.getAttribute("type"),n=t.type;return"input"===t.nodeName.toLowerCase()&&"text"===n&&(e===n||null===e)},radio:function(t){return"input"===t.nodeName.toLowerCase()&&"radio"===t.type},checkbox:function(t){return"input"===t.nodeName.toLowerCase()&&"checkbox"===t.type},file:function(t){return"input"===t.nodeName.toLowerCase()&&"file"===t.type},password:function(t){return"input"===t.nodeName.toLowerCase()&&"password"===t.type},submit:function(t){var e=t.nodeName.toLowerCase();return("input"===e||"button"===e)&&"submit"===t.type},image:function(t){return"input"===t.nodeName.toLowerCase()&&"image"===t.type},reset:function(t){var e=t.nodeName.toLowerCase();return("input"===e||"button"===e)&&"reset"===t.type},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},input:function(t){return/input|select|textarea|button/i.test(t.nodeName)},focus:function(t){return t===t.ownerDocument.activeElement}},setFilters:{first:function(t,e){return 0===e},last:function(t,e,n,i){return e===i.length-1},even:function(t,e){return 0===e%2},odd:function(t,e){return 1===e%2},lt:function(t,e,n){return n[3]-0>e},gt:function(t,e,n){return e>n[3]-0},nth:function(t,e,n){return n[3]-0===e},eq:function(t,e,n){return n[3]-0===e}},filter:{PSEUDO:function(t,e,n,i){var r=e[1],a=f.filters[r];if(a)return a(t,n,e,i);if("contains"===r)return(t.textContent||t.innerText||p([t])||"").indexOf(e[3])>=0;if("not"===r){for(var o=e[3],s=0,l=o.length;l>s;s++)if(o[s]===t)return!1;return!0}h.error(r)},CHILD:function(t,e){var n,i,a,o,s,l,c=e[1],u=t;switch(c){case"only":case"first":for(;u=u.previousSibling;)if(1===u.nodeType)return!1;if("first"===c)return!0;u=t;case"last":for(;u=u.nextSibling;)if(1===u.nodeType)return!1;return!0;case"nth":if(n=e[2],i=e[3],1===n&&0===i)return!0;if(a=e[0],o=t.parentNode,o&&(o[r]!==a||!t.nodeIndex)){for(s=0,u=o.firstChild;u;u=u.nextSibling)1===u.nodeType&&(u.nodeIndex=++s);o[r]=a}return l=t.nodeIndex-i,0===n?0===l:0===l%n&&l/n>=0}},ID:function(t,e){return 1===t.nodeType&&t.getAttribute("id")===e},TAG:function(t,e){return"*"===e&&1===t.nodeType||!!t.nodeName&&t.nodeName.toLowerCase()===e},CLASS:function(t,e){return(" "+(t.className||t.getAttribute("class"))+" ").indexOf(e)>-1},ATTR:function(t,e){var n=e[1],i=h.attr?h.attr(t,n):f.attrHandle[n]?f.attrHandle[n](t):null!=t[n]?t[n]:t.getAttribute(n),r=i+"",a=e[2],o=e[4];return null==i?"!="===a:!a&&h.attr?null!=i:"="===a?r===o:"*="===a?r.indexOf(o)>=0:"~="===a?(" "+r+" ").indexOf(o)>=0:o?"!="===a?r!==o:"^="===a?0===r.indexOf(o):"$="===a?r.substr(r.length-o.length)===o:"|="===a?r===o||r.substr(0,o.length+1)===o+"-":!1:r&&i!==!1},POS:function(t,n,i,r){var a=n[2],o=f.setFilters[a];return o?o(t,i,n,r):e}}},g=f.match.POS,m=function(t,e){return"\\"+(e-0+1)};for(var v in f.match)f.match[v]=RegExp(f.match[v].source+/(?![^\[]*\])(?![^\(]*\))/.source),f.leftMatch[v]=RegExp(/(^(?:.|\r|\n)*?)/.source+f.match[v].source.replace(/\\(\d+)/g,m));var y=function(t,e){return t=Array.prototype.slice.call(t,0),e?(e.push.apply(e,t),e):t};try{Array.prototype.slice.call($.documentElement.childNodes,0)[0].nodeType}catch(b){y=function(t,e){var n=0,i=e||[];if("[object Array]"===o.call(t))Array.prototype.push.apply(i,t);else if("number"==typeof t.length)for(var r=t.length;r>n;n++)i.push(t[n]);else for(;t[n];n++)i.push(t[n]);return i}}var x,T;$.documentElement.compareDocumentPosition?x=function(t,e){return t===e?(s=!0,0):t.compareDocumentPosition&&e.compareDocumentPosition?4&t.compareDocumentPosition(e)?-1:1:t.compareDocumentPosition?-1:1}:(x=function(t,e){if(t===e)return s=!0,0;if(t.sourceIndex&&e.sourceIndex)return t.sourceIndex-e.sourceIndex;var n,i,r=[],a=[],o=t.parentNode,l=e.parentNode,c=o;if(o===l)return T(t,e);if(!o)return-1;if(!l)return 1;for(;c;)r.unshift(c),c=c.parentNode;for(c=l;c;)a.unshift(c),c=c.parentNode;n=r.length,i=a.length;for(var u=0;n>u&&i>u;u++)if(r[u]!==a[u])return T(r[u],a[u]);return u===n?T(t,a[u],-1):T(r[u],e,1)},T=function(t,e,n){if(t===e)return n;for(var i=t.nextSibling;i;){if(i===e)return-1;i=i.nextSibling}return 1}),function(){var t=$.createElement("div"),n="script"+(new Date).getTime(),i=$.documentElement;t.innerHTML="<a name='"+n+"'/>",i.insertBefore(t,i.firstChild),$.getElementById(n)&&(f.find.ID=function(t,n,i){if(n.getElementById!==e&&!i){var r=n.getElementById(t[1]);return r?r.id===t[1]||r.getAttributeNode!==e&&r.getAttributeNode("id").nodeValue===t[1]?[r]:e:[]}},f.filter.ID=function(t,n){var i=t.getAttributeNode!==e&&t.getAttributeNode("id");return 1===t.nodeType&&i&&i.nodeValue===n}),i.removeChild(t),i=t=null}(),function(){var t=$.createElement("div");t.appendChild($.createComment("")),t.getElementsByTagName("*").length>0&&(f.find.TAG=function(t,e){var n=e.getElementsByTagName(t[1]);if("*"===t[1]){for(var i=[],r=0;n[r];r++)1===n[r].nodeType&&i.push(n[r]);n=i}return n}),t.innerHTML="<a href='#'></a>",t.firstChild&&t.firstChild.getAttribute!==e&&"#"!==t.firstChild.getAttribute("href")&&(f.attrHandle.href=function(t){return t.getAttribute("href",2)}),t=null}(),$.querySelectorAll&&function(){var t=h,e=$.createElement("div"),n="__sizzle__";if(e.innerHTML="<p class='TEST'></p>",!e.querySelectorAll||0!==e.querySelectorAll(".TEST").length){h=function(e,i,r,a){if(i=i||$,!a&&!h.isXML(i)){var o=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(e);if(o&&(1===i.nodeType||9===i.nodeType)){if(o[1])return y(i.getElementsByTagName(e),r);if(o[2]&&f.find.CLASS&&i.getElementsByClassName)return y(i.getElementsByClassName(o[2]),r)}if(9===i.nodeType){if("body"===e&&i.body)return y([i.body],r);if(o&&o[3]){var s=i.getElementById(o[3]);if(!s||!s.parentNode)return y([],r);if(s.id===o[3])return y([s],r)}try{return y(i.querySelectorAll(e),r)}catch(l){}}else if(1===i.nodeType&&"object"!==i.nodeName.toLowerCase()){var c=i,u=i.getAttribute("id"),d=u||n,p=i.parentNode,g=/^\s*[+~]/.test(e);u?d=d.replace(/'/g,"\\$&"):i.setAttribute("id",d),g&&p&&(i=i.parentNode);try{if(!g||p)return y(i.querySelectorAll("[id='"+d+"'] "+e),r)}catch(m){}finally{u||c.removeAttribute("id")}}}return t(e,i,r,a)};for(var i in t)h[i]=t[i];e=null}}(),function(){var t=$.documentElement,e=t.matchesSelector||t.mozMatchesSelector||t.webkitMatchesSelector||t.msMatchesSelector;if(e){var n=!e.call($.createElement("div"),"div"),i=!1;try{e.call($.documentElement,"[test!='']:sizzle")}catch(r){i=!0}h.matchesSelector=function(t,r){if(r=r.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']"),!h.isXML(t))try{if(i||!f.match.PSEUDO.test(r)&&!/!=/.test(r)){var a=e.call(t,r);if(a||!n||t.document&&11!==t.document.nodeType)return a}}catch(o){}return h(r,null,null,[t]).length>0}}}(),function(){var t=$.createElement("div");t.innerHTML="<div class='test e'></div><div class='test'></div>",t.getElementsByClassName&&0!==t.getElementsByClassName("e").length&&(t.lastChild.className="e",1!==t.getElementsByClassName("e").length&&(f.order.splice(1,0,"CLASS"),f.find.CLASS=function(t,n,i){return n.getElementsByClassName===e||i?e:n.getElementsByClassName(t[1])},t=null))}(),h.contains=$.documentElement.contains?function(t,e){return t!==e&&(t.contains?t.contains(e):!0)}:$.documentElement.compareDocumentPosition?function(t,e){return!!(16&t.compareDocumentPosition(e))}:function(){return!1},h.isXML=function(t){var e=(t?t.ownerDocument||t:0).documentElement;return e?"HTML"!==e.nodeName:!1};var w=function(t,e,n){for(var i,r=[],a="",o=e.nodeType?[e]:e;i=f.match.PSEUDO.exec(t);)a+=i[0],t=t.replace(f.match.PSEUDO,"");t=f.relative[t]?t+"*":t;for(var s=0,l=o.length;l>s;s++)h(t,o[s],r,n);return h.filter(a,r)};h.attr=O.attr,h.selectors.attrMap={},O.find=h,O.expr=h.selectors,O.expr[":"]=O.expr.filters,O.unique=h.uniqueSort,O.text=h.getText,O.isXMLDoc=h.isXML,O.contains=h.contains}();var le=/Until$/,ce=/^(?:parents|prevUntil|prevAll)/,ue=/,/,de=/^.[^:#\[\.,]*$/,he=Array.prototype.slice,pe=O.expr.match.POS,fe={children:!0,contents:!0,next:!0,prev:!0};O.fn.extend({find:function(t){var e,n,i=this;
if("string"!=typeof t)return O(t).filter(function(){for(e=0,n=i.length;n>e;e++)if(O.contains(i[e],this))return!0});var r,a,o,s=this.pushStack("","find",t);for(e=0,n=this.length;n>e;e++)if(r=s.length,O.find(t,this[e],s),e>0)for(a=r;s.length>a;a++)for(o=0;r>o;o++)if(s[o]===s[a]){s.splice(a--,1);break}return s},has:function(t){var e=O(t);return this.filter(function(){for(var t=0,n=e.length;n>t;t++)if(O.contains(this,e[t]))return!0})},not:function(t){return this.pushStack(c(this,t,!1),"not",t)},filter:function(t){return this.pushStack(c(this,t,!0),"filter",t)},is:function(t){return!!t&&("string"==typeof t?pe.test(t)?O(t,this.context).index(this[0])>=0:O.filter(t,this).length>0:this.filter(t).length>0)},closest:function(t,e){var n,i,r=[],a=this[0];if(O.isArray(t)){for(var o=1;a&&a.ownerDocument&&a!==e;){for(n=0;t.length>n;n++)O(a).is(t[n])&&r.push({selector:t[n],elem:a,level:o});a=a.parentNode,o++}return r}var s=pe.test(t)||"string"!=typeof t?O(t,e||this.context):0;for(n=0,i=this.length;i>n;n++)for(a=this[n];a;){if(s?s.index(a)>-1:O.find.matchesSelector(a,t)){r.push(a);break}if(a=a.parentNode,!a||!a.ownerDocument||a===e||11===a.nodeType)break}return r=r.length>1?O.unique(r):r,this.pushStack(r,"closest",t)},index:function(t){return t?"string"==typeof t?O.inArray(this[0],O(t)):O.inArray(t.jquery?t[0]:t,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(t,e){var n="string"==typeof t?O(t,e):O.makeArray(t&&t.nodeType?[t]:t),i=O.merge(this.get(),n);return this.pushStack(l(n[0])||l(i[0])?i:O.unique(i))},andSelf:function(){return this.add(this.prevObject)}}),O.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return O.dir(t,"parentNode")},parentsUntil:function(t,e,n){return O.dir(t,"parentNode",n)},next:function(t){return O.nth(t,2,"nextSibling")},prev:function(t){return O.nth(t,2,"previousSibling")},nextAll:function(t){return O.dir(t,"nextSibling")},prevAll:function(t){return O.dir(t,"previousSibling")},nextUntil:function(t,e,n){return O.dir(t,"nextSibling",n)},prevUntil:function(t,e,n){return O.dir(t,"previousSibling",n)},siblings:function(t){return O.sibling(t.parentNode.firstChild,t)},children:function(t){return O.sibling(t.firstChild)},contents:function(t){return O.nodeName(t,"iframe")?t.contentDocument||t.contentWindow.document:O.makeArray(t.childNodes)}},function(t,e){O.fn[t]=function(n,i){var r=O.map(this,e,n);return le.test(t)||(i=n),i&&"string"==typeof i&&(r=O.filter(i,r)),r=this.length>1&&!fe[t]?O.unique(r):r,(this.length>1||ue.test(i))&&ce.test(t)&&(r=r.reverse()),this.pushStack(r,t,he.call(arguments).join(","))}}),O.extend({filter:function(t,e,n){return n&&(t=":not("+t+")"),1===e.length?O.find.matchesSelector(e[0],t)?[e[0]]:[]:O.find.matches(t,e)},dir:function(t,n,i){for(var r=[],a=t[n];a&&9!==a.nodeType&&(i===e||1!==a.nodeType||!O(a).is(i));)1===a.nodeType&&r.push(a),a=a[n];return r},nth:function(t,e,n){e=e||1;for(var i=0;t&&(1!==t.nodeType||++i!==e);t=t[n]);return t},sibling:function(t,e){for(var n=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&n.push(t);return n}});var ge="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",me=/ jQuery\d+="(?:\d+|null)"/g,ve=/^\s+/,ye=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,be=/<([\w:]+)/,xe=/<tbody/i,Te=/<|&#?\w+;/,we=/<(?:script|style)/i,ke=/<(?:script|object|embed|option|style)/i,Ae=RegExp("<(?:"+ge+")","i"),_e=/checked\s*(?:[^=]|=\s*.checked.)/i,Ce=/\/(java|ecma)script/i,Ee=/^\s*<!(?:\[CDATA\[|\-\-)/,Se={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},Me=u($);Se.optgroup=Se.option,Se.tbody=Se.tfoot=Se.colgroup=Se.caption=Se.thead,Se.th=Se.td,O.support.htmlSerialize||(Se._default=[1,"div<div>","</div>"]),O.fn.extend({text:function(t){return O.isFunction(t)?this.each(function(e){var n=O(this);n.text(t.call(this,e,n.text()))}):"object"!=typeof t&&t!==e?this.empty().append((this[0]&&this[0].ownerDocument||$).createTextNode(t)):O.text(this)},wrapAll:function(t){if(O.isFunction(t))return this.each(function(e){O(this).wrapAll(t.call(this,e))});if(this[0]){var e=O(t,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstChild&&1===t.firstChild.nodeType;)t=t.firstChild;return t}).append(this)}return this},wrapInner:function(t){return O.isFunction(t)?this.each(function(e){O(this).wrapInner(t.call(this,e))}):this.each(function(){var e=O(this),n=e.contents();n.length?n.wrapAll(t):e.append(t)})},wrap:function(t){var e=O.isFunction(t);return this.each(function(n){O(this).wrapAll(e?t.call(this,n):t)})},unwrap:function(){return this.parent().each(function(){O.nodeName(this,"body")||O(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(t){1===this.nodeType&&this.appendChild(t)})},prepend:function(){return this.domManip(arguments,!0,function(t){1===this.nodeType&&this.insertBefore(t,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(t){this.parentNode.insertBefore(t,this)});if(arguments.length){var t=O.clean(arguments);return t.push.apply(t,this.toArray()),this.pushStack(t,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(t){this.parentNode.insertBefore(t,this.nextSibling)});if(arguments.length){var t=this.pushStack(this,"after",arguments);return t.push.apply(t,O.clean(arguments)),t}},remove:function(t,e){for(var n,i=0;null!=(n=this[i]);i++)(!t||O.filter(t,[n]).length)&&(e||1!==n.nodeType||(O.cleanData(n.getElementsByTagName("*")),O.cleanData([n])),n.parentNode&&n.parentNode.removeChild(n));return this},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)for(1===t.nodeType&&O.cleanData(t.getElementsByTagName("*"));t.firstChild;)t.removeChild(t.firstChild);return this},clone:function(t,e){return t=null==t?!1:t,e=null==e?t:e,this.map(function(){return O.clone(this,t,e)})},html:function(t){if(t===e)return this[0]&&1===this[0].nodeType?this[0].innerHTML.replace(me,""):null;if("string"!=typeof t||we.test(t)||!O.support.leadingWhitespace&&ve.test(t)||Se[(be.exec(t)||["",""])[1].toLowerCase()])O.isFunction(t)?this.each(function(e){var n=O(this);n.html(t.call(this,e,n.html()))}):this.empty().append(t);else{t=t.replace(ye,"<$1></$2>");try{for(var n=0,i=this.length;i>n;n++)1===this[n].nodeType&&(O.cleanData(this[n].getElementsByTagName("*")),this[n].innerHTML=t)}catch(r){this.empty().append(t)}}return this},replaceWith:function(t){return this[0]&&this[0].parentNode?O.isFunction(t)?this.each(function(e){var n=O(this),i=n.html();n.replaceWith(t.call(this,e,i))}):("string"!=typeof t&&(t=O(t).detach()),this.each(function(){var e=this.nextSibling,n=this.parentNode;O(this).remove(),e?O(e).before(t):O(n).append(t)})):this.length?this.pushStack(O(O.isFunction(t)?t():t),"replaceWith",t):this},detach:function(t){return this.remove(t,!0)},domManip:function(t,n,i){var r,a,o,s,l=t[0],c=[];if(!O.support.checkClone&&3===arguments.length&&"string"==typeof l&&_e.test(l))return this.each(function(){O(this).domManip(t,n,i,!0)});if(O.isFunction(l))return this.each(function(r){var a=O(this);t[0]=l.call(this,r,n?a.html():e),a.domManip(t,n,i)});if(this[0]){if(s=l&&l.parentNode,r=O.support.parentNode&&s&&11===s.nodeType&&s.childNodes.length===this.length?{fragment:s}:O.buildFragment(t,this,c),o=r.fragment,a=1===o.childNodes.length?o=o.firstChild:o.firstChild){n=n&&O.nodeName(a,"tr");for(var u=0,h=this.length,p=h-1;h>u;u++)i.call(n?d(this[u],a):this[u],r.cacheable||h>1&&p>u?O.clone(o,!0,!0):o)}c.length&&O.each(c,y)}return this}}),O.buildFragment=function(t,e,n){var i,r,a,o,s=t[0];return e&&e[0]&&(o=e[0].ownerDocument||e[0]),o.createDocumentFragment||(o=$),!(1===t.length&&"string"==typeof s&&512>s.length&&o===$&&"<"===s.charAt(0))||ke.test(s)||!O.support.checkClone&&_e.test(s)||!O.support.html5Clone&&Ae.test(s)||(r=!0,a=O.fragments[s],a&&1!==a&&(i=a)),i||(i=o.createDocumentFragment(),O.clean(t,o,i,n)),r&&(O.fragments[s]=a?i:1),{fragment:i,cacheable:r}},O.fragments={},O.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){O.fn[t]=function(n){var i=[],r=O(n),a=1===this.length&&this[0].parentNode;if(a&&11===a.nodeType&&1===a.childNodes.length&&1===r.length)return r[e](this[0]),this;for(var o=0,s=r.length;s>o;o++){var l=(o>0?this.clone(!0):this).get();O(r[o])[e](l),i=i.concat(l)}return this.pushStack(i,t,r.selector)}}),O.extend({clone:function(t,e,n){var i,r,a,o=O.support.html5Clone||!Ae.test("<"+t.nodeName)?t.cloneNode(!0):v(t);if(!(O.support.noCloneEvent&&O.support.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||O.isXMLDoc(t)))for(p(t,o),i=f(t),r=f(o),a=0;i[a];++a)r[a]&&p(i[a],r[a]);if(e&&(h(t,o),n))for(i=f(t),r=f(o),a=0;i[a];++a)h(i[a],r[a]);return i=r=null,o},clean:function(t,n,i,r){var a;n=n||$,n.createElement===e&&(n=n.ownerDocument||n[0]&&n[0].ownerDocument||$);for(var o,s,l=[],c=0;null!=(s=t[c]);c++)if("number"==typeof s&&(s+=""),s){if("string"==typeof s)if(Te.test(s)){s=s.replace(ye,"<$1></$2>");var d=(be.exec(s)||["",""])[1].toLowerCase(),h=Se[d]||Se._default,p=h[0],f=n.createElement("div");for(n===$?Me.appendChild(f):u(n).appendChild(f),f.innerHTML=h[1]+s+h[2];p--;)f=f.lastChild;if(!O.support.tbody){var g=xe.test(s),v="table"!==d||g?"<table>"!==h[1]||g?[]:f.childNodes:f.firstChild&&f.firstChild.childNodes;for(o=v.length-1;o>=0;--o)O.nodeName(v[o],"tbody")&&!v[o].childNodes.length&&v[o].parentNode.removeChild(v[o])}!O.support.leadingWhitespace&&ve.test(s)&&f.insertBefore(n.createTextNode(ve.exec(s)[0]),f.firstChild),s=f.childNodes}else s=n.createTextNode(s);var y;if(!O.support.appendChecked)if(s[0]&&"number"==typeof(y=s.length))for(o=0;y>o;o++)m(s[o]);else m(s);s.nodeType?l.push(s):l=O.merge(l,s)}if(i)for(a=function(t){return!t.type||Ce.test(t.type)},c=0;l[c];c++)if(!r||!O.nodeName(l[c],"script")||l[c].type&&"text/javascript"!==l[c].type.toLowerCase()){if(1===l[c].nodeType){var b=O.grep(l[c].getElementsByTagName("script"),a);l.splice.apply(l,[c+1,0].concat(b))}i.appendChild(l[c])}else r.push(l[c].parentNode?l[c].parentNode.removeChild(l[c]):l[c]);return l},cleanData:function(t){for(var e,n,i,r=O.cache,a=O.event.special,o=O.support.deleteExpando,s=0;null!=(i=t[s]);s++)if((!i.nodeName||!O.noData[i.nodeName.toLowerCase()])&&(n=i[O.expando])){if(e=r[n],e&&e.events){for(var l in e.events)a[l]?O.event.remove(i,l):O.removeEvent(i,l,e.handle);e.handle&&(e.handle.elem=null)}o?delete i[O.expando]:i.removeAttribute&&i.removeAttribute(O.expando),delete r[n]}}});var Ie,De,Pe,$e=/alpha\([^)]*\)/i,Ne=/opacity=([^)]*)/,Ge=/([A-Z]|^ms)/g,Oe=/^-?\d+(?:px)?$/i,Le=/^-?\d/,Fe=/^([\-+])=([\-+.\de]+)/,Be={position:"absolute",visibility:"hidden",display:"block"},Re=["Left","Right"],He=["Top","Bottom"];O.fn.css=function(t,n){return 2===arguments.length&&n===e?this:O.access(this,t,n,!0,function(t,n,i){return i!==e?O.style(t,n,i):O.css(t,n)})},O.extend({cssHooks:{opacity:{get:function(t,e){if(e){var n=Ie(t,"opacity","opacity");return""===n?"1":n}return t.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":O.support.cssFloat?"cssFloat":"styleFloat"},style:function(t,n,i,r){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var a,o,s=O.camelCase(n),l=t.style,c=O.cssHooks[s];if(n=O.cssProps[s]||s,i===e)return c&&"get"in c&&(a=c.get(t,!1,r))!==e?a:l[n];if(o=typeof i,"string"===o&&(a=Fe.exec(i))&&(i=+(a[1]+1)*+a[2]+parseFloat(O.css(t,n)),o="number"),!(null==i||"number"===o&&isNaN(i)||("number"!==o||O.cssNumber[s]||(i+="px"),c&&"set"in c&&(i=c.set(t,i))===e)))try{l[n]=i}catch(u){}}},css:function(t,n,i){var r,a;return n=O.camelCase(n),a=O.cssHooks[n],n=O.cssProps[n]||n,"cssFloat"===n&&(n="float"),a&&"get"in a&&(r=a.get(t,!0,i))!==e?r:Ie?Ie(t,n):e},swap:function(t,e,n){var i={};for(var r in e)i[r]=t.style[r],t.style[r]=e[r];n.call(t);for(r in e)t.style[r]=i[r]}}),O.curCSS=O.css,O.each(["height","width"],function(t,n){O.cssHooks[n]={get:function(t,i,r){var a;return i?0!==t.offsetWidth?b(t,n,r):(O.swap(t,Be,function(){a=b(t,n,r)}),a):e},set:function(t,n){return Oe.test(n)?(n=parseFloat(n),n>=0?n+"px":e):n}}}),O.support.opacity||(O.cssHooks.opacity={get:function(t,e){return Ne.test((e&&t.currentStyle?t.currentStyle.filter:t.style.filter)||"")?parseFloat(RegExp.$1)/100+"":e?"1":""},set:function(t,e){var n=t.style,i=t.currentStyle,r=O.isNumeric(e)?"alpha(opacity="+100*e+")":"",a=i&&i.filter||n.filter||"";n.zoom=1,e>=1&&""===O.trim(a.replace($e,""))&&(n.removeAttribute("filter"),i&&!i.filter)||(n.filter=$e.test(a)?a.replace($e,r):a+" "+r)}}),O(function(){O.support.reliableMarginRight||(O.cssHooks.marginRight={get:function(t,e){var n;return O.swap(t,{display:"inline-block"},function(){n=e?Ie(t,"margin-right","marginRight"):t.style.marginRight}),n}})}),$.defaultView&&$.defaultView.getComputedStyle&&(De=function(t,e){var n,i,r;return e=e.replace(Ge,"-$1").toLowerCase(),(i=t.ownerDocument.defaultView)&&(r=i.getComputedStyle(t,null))&&(n=r.getPropertyValue(e),""!==n||O.contains(t.ownerDocument.documentElement,t)||(n=O.style(t,e))),n}),$.documentElement.currentStyle&&(Pe=function(t,e){var n,i,r,a=t.currentStyle&&t.currentStyle[e],o=t.style;return null===a&&o&&(r=o[e])&&(a=r),!Oe.test(a)&&Le.test(a)&&(n=o.left,i=t.runtimeStyle&&t.runtimeStyle.left,i&&(t.runtimeStyle.left=t.currentStyle.left),o.left="fontSize"===e?"1em":a||0,a=o.pixelLeft+"px",o.left=n,i&&(t.runtimeStyle.left=i)),""===a?"auto":a}),Ie=De||Pe,O.expr&&O.expr.filters&&(O.expr.filters.hidden=function(t){var e=t.offsetWidth,n=t.offsetHeight;return 0===e&&0===n||!O.support.reliableHiddenOffsets&&"none"===(t.style&&t.style.display||O.css(t,"display"))},O.expr.filters.visible=function(t){return!O.expr.filters.hidden(t)});var Ue,ze,je=/%20/g,We=/\[\]$/,qe=/\r?\n/g,Ve=/#.*$/,Ye=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Xe=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,Ke=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,Ze=/^(?:GET|HEAD)$/,Qe=/^\/\//,Je=/\?/,tn=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,en=/^(?:select|textarea)/i,nn=/\s+/,rn=/([?&])_=[^&]*/,an=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,on=O.fn.load,sn={},ln={},cn=["*/"]+["*"];try{Ue=G.href}catch(un){Ue=$.createElement("a"),Ue.href="",Ue=Ue.href}ze=an.exec(Ue.toLowerCase())||[],O.fn.extend({load:function(t,n,i){if("string"!=typeof t&&on)return on.apply(this,arguments);if(!this.length)return this;var r=t.indexOf(" ");if(r>=0){var a=t.slice(r,t.length);t=t.slice(0,r)}var o="GET";n&&(O.isFunction(n)?(i=n,n=e):"object"==typeof n&&(n=O.param(n,O.ajaxSettings.traditional),o="POST"));var s=this;return O.ajax({url:t,type:o,dataType:"html",data:n,complete:function(t,e,n){n=t.responseText,t.isResolved()&&(t.done(function(t){n=t}),s.html(a?O("<div>").append(n.replace(tn,"")).find(a):n)),i&&s.each(i,[n,e,t])}}),this},serialize:function(){return O.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?O.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||en.test(this.nodeName)||Xe.test(this.type))}).map(function(t,e){var n=O(this).val();return null==n?null:O.isArray(n)?O.map(n,function(t){return{name:e.name,value:t.replace(qe,"\r\n")}}):{name:e.name,value:n.replace(qe,"\r\n")}}).get()}}),O.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(t,e){O.fn[e]=function(t){return this.on(e,t)}}),O.each(["get","post"],function(t,n){O[n]=function(t,i,r,a){return O.isFunction(i)&&(a=a||r,r=i,i=e),O.ajax({type:n,url:t,data:i,success:r,dataType:a})}}),O.extend({getScript:function(t,n){return O.get(t,e,n,"script")},getJSON:function(t,e,n){return O.get(t,e,n,"json")},ajaxSetup:function(t,e){return e?w(t,O.ajaxSettings):(e=t,t=O.ajaxSettings),w(t,e),t},ajaxSettings:{url:Ue,isLocal:Ke.test(ze[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":cn},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":t.String,"text html":!0,"text json":O.parseJSON,"text xml":O.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:x(sn),ajaxTransport:x(ln),ajax:function(t,n){function i(t,n,i,o){if(2!==x){x=2,l&&clearTimeout(l),s=e,a=o||"",w.readyState=t>0?4:0;var c,d,y,b,T,k=n,C=i?A(h,w,i):e;if(t>=200&&300>t||304===t)if(h.ifModified&&((b=w.getResponseHeader("Last-Modified"))&&(O.lastModified[r]=b),(T=w.getResponseHeader("Etag"))&&(O.etag[r]=T)),304===t)k="notmodified",c=!0;else try{d=_(h,C),k="success",c=!0}catch(E){k="parsererror",y=E}else y=k,(!k||t)&&(k="error",0>t&&(t=0));w.status=t,w.statusText=""+(n||k),c?g.resolveWith(p,[d,k,w]):g.rejectWith(p,[w,k,y]),w.statusCode(v),v=e,u&&f.trigger("ajax"+(c?"Success":"Error"),[w,h,c?d:y]),m.fireWith(p,[w,k]),u&&(f.trigger("ajaxComplete",[w,h]),--O.active||O.event.trigger("ajaxStop"))}}"object"==typeof t&&(n=t,t=e),n=n||{};var r,a,o,s,l,c,u,d,h=O.ajaxSetup({},n),p=h.context||h,f=p!==h&&(p.nodeType||p instanceof O)?O(p):O.event,g=O.Deferred(),m=O.Callbacks("once memory"),v=h.statusCode||{},y={},b={},x=0,w={readyState:0,setRequestHeader:function(t,e){if(!x){var n=t.toLowerCase();t=b[n]=b[n]||t,y[t]=e}return this},getAllResponseHeaders:function(){return 2===x?a:null},getResponseHeader:function(t){var n;if(2===x){if(!o)for(o={};n=Ye.exec(a);)o[n[1].toLowerCase()]=n[2];n=o[t.toLowerCase()]}return n===e?null:n},overrideMimeType:function(t){return x||(h.mimeType=t),this},abort:function(t){return t=t||"abort",s&&s.abort(t),i(0,t),this}};if(g.promise(w),w.success=w.done,w.error=w.fail,w.complete=m.add,w.statusCode=function(t){if(t){var e;if(2>x)for(e in t)v[e]=[v[e],t[e]];else e=t[w.status],w.then(e,e)}return this},h.url=((t||h.url)+"").replace(Ve,"").replace(Qe,ze[1]+"//"),h.dataTypes=O.trim(h.dataType||"*").toLowerCase().split(nn),null==h.crossDomain&&(c=an.exec(h.url.toLowerCase()),h.crossDomain=!(!c||c[1]==ze[1]&&c[2]==ze[2]&&(c[3]||("http:"===c[1]?80:443))==(ze[3]||("http:"===ze[1]?80:443)))),h.data&&h.processData&&"string"!=typeof h.data&&(h.data=O.param(h.data,h.traditional)),T(sn,h,n,w),2===x)return!1;if(u=h.global,h.type=h.type.toUpperCase(),h.hasContent=!Ze.test(h.type),u&&0===O.active++&&O.event.trigger("ajaxStart"),!h.hasContent&&(h.data&&(h.url+=(Je.test(h.url)?"&":"?")+h.data,delete h.data),r=h.url,h.cache===!1)){var k=O.now(),C=h.url.replace(rn,"$1_="+k);h.url=C+(C===h.url?(Je.test(h.url)?"&":"?")+"_="+k:"")}(h.data&&h.hasContent&&h.contentType!==!1||n.contentType)&&w.setRequestHeader("Content-Type",h.contentType),h.ifModified&&(r=r||h.url,O.lastModified[r]&&w.setRequestHeader("If-Modified-Since",O.lastModified[r]),O.etag[r]&&w.setRequestHeader("If-None-Match",O.etag[r])),w.setRequestHeader("Accept",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+("*"!==h.dataTypes[0]?", "+cn+"; q=0.01":""):h.accepts["*"]);for(d in h.headers)w.setRequestHeader(d,h.headers[d]);if(h.beforeSend&&(h.beforeSend.call(p,w,h)===!1||2===x))return w.abort(),!1;for(d in{success:1,error:1,complete:1})w[d](h[d]);if(s=T(ln,h,n,w)){w.readyState=1,u&&f.trigger("ajaxSend",[w,h]),h.async&&h.timeout>0&&(l=setTimeout(function(){w.abort("timeout")},h.timeout));try{x=1,s.send(y,i)}catch(E){if(!(2>x))throw E;i(-1,E)}}else i(-1,"No Transport");return w},param:function(t,n){var i=[],r=function(t,e){e=O.isFunction(e)?e():e,i[i.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(n===e&&(n=O.ajaxSettings.traditional),O.isArray(t)||t.jquery&&!O.isPlainObject(t))O.each(t,function(){r(this.name,this.value)});else for(var a in t)k(a,t[a],n,r);return i.join("&").replace(je,"+")}}),O.extend({active:0,lastModified:{},etag:{}});var dn=O.now(),hn=/(\=)\?(&|$)|\?\?/i;O.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return O.expando+"_"+dn++}}),O.ajaxPrefilter("json jsonp",function(e,n,i){var r="application/x-www-form-urlencoded"===e.contentType&&"string"==typeof e.data;if("jsonp"===e.dataTypes[0]||e.jsonp!==!1&&(hn.test(e.url)||r&&hn.test(e.data))){var a,o=e.jsonpCallback=O.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,s=t[o],l=e.url,c=e.data,u="$1"+o+"$2";return e.jsonp!==!1&&(l=l.replace(hn,u),e.url===l&&(r&&(c=c.replace(hn,u)),e.data===c&&(l+=(/\?/.test(l)?"&":"?")+e.jsonp+"="+o))),e.url=l,e.data=c,t[o]=function(t){a=[t]},i.always(function(){t[o]=s,a&&O.isFunction(s)&&t[o](a[0])}),e.converters["script json"]=function(){return a||O.error(o+" was not called"),a[0]},e.dataTypes[0]="json","script"}}),O.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(t){return O.globalEval(t),t}}}),O.ajaxPrefilter("script",function(t){t.cache===e&&(t.cache=!1),t.crossDomain&&(t.type="GET",t.global=!1)}),O.ajaxTransport("script",function(t){if(t.crossDomain){var n,i=$.head||$.getElementsByTagName("head")[0]||$.documentElement;return{send:function(r,a){n=$.createElement("script"),n.async="async",t.scriptCharset&&(n.charset=t.scriptCharset),n.src=t.url,n.onload=n.onreadystatechange=function(t,r){(r||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,i&&n.parentNode&&i.removeChild(n),n=e,r||a(200,"success"))},i.insertBefore(n,i.firstChild)},abort:function(){n&&n.onload(0,1)}}}});var pn,fn=t.ActiveXObject?function(){for(var t in pn)pn[t](0,1)}:!1,gn=0;O.ajaxSettings.xhr=t.ActiveXObject?function(){return!this.isLocal&&C()||E()}:C,function(t){O.extend(O.support,{ajax:!!t,cors:!!t&&"withCredentials"in t})}(O.ajaxSettings.xhr()),O.support.ajax&&O.ajaxTransport(function(n){if(!n.crossDomain||O.support.cors){var i;return{send:function(r,a){var o,s,l=n.xhr();if(n.username?l.open(n.type,n.url,n.async,n.username,n.password):l.open(n.type,n.url,n.async),n.xhrFields)for(s in n.xhrFields)l[s]=n.xhrFields[s];n.mimeType&&l.overrideMimeType&&l.overrideMimeType(n.mimeType),n.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest");try{for(s in r)l.setRequestHeader(s,r[s])}catch(c){}l.send(n.hasContent&&n.data||null),i=function(t,r){var s,c,u,d,h;try{if(i&&(r||4===l.readyState))if(i=e,o&&(l.onreadystatechange=O.noop,fn&&delete pn[o]),r)4!==l.readyState&&l.abort();else{s=l.status,u=l.getAllResponseHeaders(),d={},h=l.responseXML,h&&h.documentElement&&(d.xml=h),d.text=l.responseText;try{c=l.statusText}catch(p){c=""}s||!n.isLocal||n.crossDomain?1223===s&&(s=204):s=d.text?200:404}}catch(f){r||a(-1,f)}d&&a(s,c,d,u)},n.async&&4!==l.readyState?(o=++gn,fn&&(pn||(pn={},O(t).unload(fn)),pn[o]=i),l.onreadystatechange=i):i()},abort:function(){i&&i(0,1)}}}});var mn,vn,yn,bn,xn={},Tn=/^(?:toggle|show|hide)$/,wn=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,kn=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];O.fn.extend({show:function(t,e,n){var i,r;if(t||0===t)return this.animate(I("show",3),t,e,n);for(var a=0,o=this.length;o>a;a++)i=this[a],i.style&&(r=i.style.display,O._data(i,"olddisplay")||"none"!==r||(r=i.style.display=""),""===r&&"none"===O.css(i,"display")&&O._data(i,"olddisplay",D(i.nodeName)));for(a=0;o>a;a++)i=this[a],i.style&&(r=i.style.display,(""===r||"none"===r)&&(i.style.display=O._data(i,"olddisplay")||""));return this},hide:function(t,e,n){if(t||0===t)return this.animate(I("hide",3),t,e,n);for(var i,r,a=0,o=this.length;o>a;a++)i=this[a],i.style&&(r=O.css(i,"display"),"none"===r||O._data(i,"olddisplay")||O._data(i,"olddisplay",r));for(a=0;o>a;a++)this[a].style&&(this[a].style.display="none");return this},_toggle:O.fn.toggle,toggle:function(t,e,n){var i="boolean"==typeof t;return O.isFunction(t)&&O.isFunction(e)?this._toggle.apply(this,arguments):null==t||i?this.each(function(){var e=i?t:O(this).is(":hidden");O(this)[e?"show":"hide"]()}):this.animate(I("toggle",3),t,e,n),this},fadeTo:function(t,e,n,i){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:e},t,n,i)},animate:function(t,e,n,i){function r(){a.queue===!1&&O._mark(this);var e,n,i,r,o,s,l,c,u,d=O.extend({},a),h=1===this.nodeType,p=h&&O(this).is(":hidden");d.animatedProperties={};for(i in t){if(e=O.camelCase(i),i!==e&&(t[e]=t[i],delete t[i]),n=t[e],O.isArray(n)?(d.animatedProperties[e]=n[1],n=t[e]=n[0]):d.animatedProperties[e]=d.specialEasing&&d.specialEasing[e]||d.easing||"swing","hide"===n&&p||"show"===n&&!p)return d.complete.call(this);!h||"height"!==e&&"width"!==e||(d.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],"inline"===O.css(this,"display")&&"none"===O.css(this,"float")&&(O.support.inlineBlockNeedsLayout&&"inline"!==D(this.nodeName)?this.style.zoom=1:this.style.display="inline-block"))}null!=d.overflow&&(this.style.overflow="hidden");for(i in t)r=new O.fx(this,d,i),n=t[i],Tn.test(n)?(u=O._data(this,"toggle"+i)||("toggle"===n?p?"show":"hide":0),u?(O._data(this,"toggle"+i,"show"===u?"hide":"show"),r[u]()):r[n]()):(o=wn.exec(n),s=r.cur(),o?(l=parseFloat(o[2]),c=o[3]||(O.cssNumber[i]?"":"px"),"px"!==c&&(O.style(this,i,(l||1)+c),s=(l||1)/r.cur()*s,O.style(this,i,s+c)),o[1]&&(l=("-="===o[1]?-1:1)*l+s),r.custom(s,l,c)):r.custom(s,n,""));return!0}var a=O.speed(e,n,i);return O.isEmptyObject(t)?this.each(a.complete,[!1]):(t=O.extend({},t),a.queue===!1?this.each(r):this.queue(a.queue,r))},stop:function(t,n,i){return"string"!=typeof t&&(i=n,n=t,t=e),n&&t!==!1&&this.queue(t||"fx",[]),this.each(function(){function e(t,e,n){var r=e[n];O.removeData(t,n,!0),r.stop(i)}var n,r=!1,a=O.timers,o=O._data(this);if(i||O._unmark(!0,this),null==t)for(n in o)o[n]&&o[n].stop&&n.indexOf(".run")===n.length-4&&e(this,o,n);else o[n=t+".run"]&&o[n].stop&&e(this,o,n);for(n=a.length;n--;)a[n].elem!==this||null!=t&&a[n].queue!==t||(i?a[n](!0):a[n].saveState(),r=!0,a.splice(n,1));i&&r||O.dequeue(this,t)})}}),O.each({slideDown:I("show",1),slideUp:I("hide",1),slideToggle:I("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){O.fn[t]=function(t,n,i){return this.animate(e,t,n,i)}}),O.extend({speed:function(t,e,n){var i=t&&"object"==typeof t?O.extend({},t):{complete:n||!n&&e||O.isFunction(t)&&t,duration:t,easing:n&&e||e&&!O.isFunction(e)&&e};return i.duration=O.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in O.fx.speeds?O.fx.speeds[i.duration]:O.fx.speeds._default,(null==i.queue||i.queue===!0)&&(i.queue="fx"),i.old=i.complete,i.complete=function(t){O.isFunction(i.old)&&i.old.call(this),i.queue?O.dequeue(this,i.queue):t!==!1&&O._unmark(this)},i},easing:{linear:function(t,e,n,i){return n+i*t},swing:function(t,e,n,i){return(-Math.cos(t*Math.PI)/2+.5)*i+n}},timers:[],fx:function(t,e,n){this.options=e,this.elem=t,this.prop=n,e.orig=e.orig||{}}}),O.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(O.fx.step[this.prop]||O.fx.step._default)(this)},cur:function(){if(null!=this.elem[this.prop]&&(!this.elem.style||null==this.elem.style[this.prop]))return this.elem[this.prop];var t,e=O.css(this.elem,this.prop);return isNaN(t=parseFloat(e))?e&&"auto"!==e?e:0:t},custom:function(t,n,i){function r(t){return a.step(t)}var a=this,o=O.fx;this.startTime=bn||S(),this.end=n,this.now=this.start=t,this.pos=this.state=0,this.unit=i||this.unit||(O.cssNumber[this.prop]?"":"px"),r.queue=this.options.queue,r.elem=this.elem,r.saveState=function(){a.options.hide&&O._data(a.elem,"fxshow"+a.prop)===e&&O._data(a.elem,"fxshow"+a.prop,a.start)},r()&&O.timers.push(r)&&!yn&&(yn=setInterval(o.tick,o.interval))},show:function(){var t=O._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=t||O.style(this.elem,this.prop),this.options.show=!0,t!==e?this.custom(this.cur(),t):this.custom("width"===this.prop||"height"===this.prop?1:0,this.cur()),O(this.elem).show()},hide:function(){this.options.orig[this.prop]=O._data(this.elem,"fxshow"+this.prop)||O.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(t){var e,n,i,r=bn||S(),a=!0,o=this.elem,s=this.options;if(t||r>=s.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),s.animatedProperties[this.prop]=!0;for(e in s.animatedProperties)s.animatedProperties[e]!==!0&&(a=!1);if(a){if(null==s.overflow||O.support.shrinkWrapBlocks||O.each(["","X","Y"],function(t,e){o.style["overflow"+e]=s.overflow[t]}),s.hide&&O(o).hide(),s.hide||s.show)for(e in s.animatedProperties)O.style(o,e,s.orig[e]),O.removeData(o,"fxshow"+e,!0),O.removeData(o,"toggle"+e,!0);i=s.complete,i&&(s.complete=!1,i.call(o))}return!1}return 1/0==s.duration?this.now=r:(n=r-this.startTime,this.state=n/s.duration,this.pos=O.easing[s.animatedProperties[this.prop]](this.state,n,0,1,s.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update(),!0}},O.extend(O.fx,{tick:function(){for(var t,e=O.timers,n=0;e.length>n;n++)t=e[n],t()||e[n]!==t||e.splice(n--,1);e.length||O.fx.stop()},interval:13,stop:function(){clearInterval(yn),yn=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(t){O.style(t.elem,"opacity",t.now)},_default:function(t){t.elem.style&&null!=t.elem.style[t.prop]?t.elem.style[t.prop]=t.now+t.unit:t.elem[t.prop]=t.now}}}),O.each(["width","height"],function(t,e){O.fx.step[e]=function(t){O.style(t.elem,e,Math.max(0,t.now)+t.unit)}}),O.expr&&O.expr.filters&&(O.expr.filters.animated=function(t){return O.grep(O.timers,function(e){return t===e.elem}).length});var An=/^t(?:able|d|h)$/i,_n=/^(?:body|html)$/i;O.fn.offset="getBoundingClientRect"in $.documentElement?function(t){var e,n=this[0];if(t)return this.each(function(e){O.offset.setOffset(this,t,e)});if(!n||!n.ownerDocument)return null;if(n===n.ownerDocument.body)return O.offset.bodyOffset(n);try{e=n.getBoundingClientRect()}catch(i){}var r=n.ownerDocument,a=r.documentElement;if(!e||!O.contains(a,n))return e?{top:e.top,left:e.left}:{top:0,left:0};var o=r.body,s=P(r),l=a.clientTop||o.clientTop||0,c=a.clientLeft||o.clientLeft||0,u=s.pageYOffset||O.support.boxModel&&a.scrollTop||o.scrollTop,d=s.pageXOffset||O.support.boxModel&&a.scrollLeft||o.scrollLeft,h=e.top+u-l,p=e.left+d-c;return{top:h,left:p}}:function(t){var e=this[0];if(t)return this.each(function(e){O.offset.setOffset(this,t,e)});if(!e||!e.ownerDocument)return null;if(e===e.ownerDocument.body)return O.offset.bodyOffset(e);for(var n,i=e.offsetParent,r=e,a=e.ownerDocument,o=a.documentElement,s=a.body,l=a.defaultView,c=l?l.getComputedStyle(e,null):e.currentStyle,u=e.offsetTop,d=e.offsetLeft;(e=e.parentNode)&&e!==s&&e!==o&&(!O.support.fixedPosition||"fixed"!==c.position);)n=l?l.getComputedStyle(e,null):e.currentStyle,u-=e.scrollTop,d-=e.scrollLeft,e===i&&(u+=e.offsetTop,d+=e.offsetLeft,!O.support.doesNotAddBorder||O.support.doesAddBorderForTableAndCells&&An.test(e.nodeName)||(u+=parseFloat(n.borderTopWidth)||0,d+=parseFloat(n.borderLeftWidth)||0),r=i,i=e.offsetParent),O.support.subtractsBorderForOverflowNotVisible&&"visible"!==n.overflow&&(u+=parseFloat(n.borderTopWidth)||0,d+=parseFloat(n.borderLeftWidth)||0),c=n;return("relative"===c.position||"static"===c.position)&&(u+=s.offsetTop,d+=s.offsetLeft),O.support.fixedPosition&&"fixed"===c.position&&(u+=Math.max(o.scrollTop,s.scrollTop),d+=Math.max(o.scrollLeft,s.scrollLeft)),{top:u,left:d}},O.offset={bodyOffset:function(t){var e=t.offsetTop,n=t.offsetLeft;return O.support.doesNotIncludeMarginInBodyOffset&&(e+=parseFloat(O.css(t,"marginTop"))||0,n+=parseFloat(O.css(t,"marginLeft"))||0),{top:e,left:n}
},setOffset:function(t,e,n){var i=O.css(t,"position");"static"===i&&(t.style.position="relative");var r,a,o=O(t),s=o.offset(),l=O.css(t,"top"),c=O.css(t,"left"),u=("absolute"===i||"fixed"===i)&&O.inArray("auto",[l,c])>-1,d={},h={};u?(h=o.position(),r=h.top,a=h.left):(r=parseFloat(l)||0,a=parseFloat(c)||0),O.isFunction(e)&&(e=e.call(t,n,s)),null!=e.top&&(d.top=e.top-s.top+r),null!=e.left&&(d.left=e.left-s.left+a),"using"in e?e.using.call(t,d):o.css(d)}},O.fn.extend({position:function(){if(!this[0])return null;var t=this[0],e=this.offsetParent(),n=this.offset(),i=_n.test(e[0].nodeName)?{top:0,left:0}:e.offset();return n.top-=parseFloat(O.css(t,"marginTop"))||0,n.left-=parseFloat(O.css(t,"marginLeft"))||0,i.top+=parseFloat(O.css(e[0],"borderTopWidth"))||0,i.left+=parseFloat(O.css(e[0],"borderLeftWidth"))||0,{top:n.top-i.top,left:n.left-i.left}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||$.body;t&&!_n.test(t.nodeName)&&"static"===O.css(t,"position");)t=t.offsetParent;return t})}}),O.each(["Left","Top"],function(t,n){var i="scroll"+n;O.fn[i]=function(n){var r,a;return n===e?(r=this[0])?(a=P(r),a?"pageXOffset"in a?a[t?"pageYOffset":"pageXOffset"]:O.support.boxModel&&a.document.documentElement[i]||a.document.body[i]:r[i]):null:this.each(function(){a=P(this),a?a.scrollTo(t?O(a).scrollLeft():n,t?n:O(a).scrollTop()):this[i]=n})}}),O.each(["Height","Width"],function(t,n){var i=n.toLowerCase();O.fn["inner"+n]=function(){var t=this[0];return t?t.style?parseFloat(O.css(t,i,"padding")):this[i]():null},O.fn["outer"+n]=function(t){var e=this[0];return e?e.style?parseFloat(O.css(e,i,t?"margin":"border")):this[i]():null},O.fn[i]=function(t){var r=this[0];if(!r)return null==t?null:this;if(O.isFunction(t))return this.each(function(e){var n=O(this);n[i](t.call(this,e,n[i]()))});if(O.isWindow(r)){var a=r.document.documentElement["client"+n],o=r.document.body;return"CSS1Compat"===r.document.compatMode&&a||o&&o["client"+n]||a}if(9===r.nodeType)return Math.max(r.documentElement["client"+n],r.body["scroll"+n],r.documentElement["scroll"+n],r.body["offset"+n],r.documentElement["offset"+n]);if(t===e){var s=O.css(r,i),l=parseFloat(s);return O.isNumeric(l)?l:s}return this.css(i,"string"==typeof t?t:t+"px")}}),t.jQuery=t.$=O,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return O})})(window),function(t,e){function n(e,n){var r=e.nodeName.toLowerCase();return"area"===r?(n=e.parentNode,r=n.name,e.href&&r&&"map"===n.nodeName.toLowerCase()?(e=t("img[usemap=#"+r+"]")[0],!!e&&i(e)):!1):(/input|select|textarea|button|object/.test(r)?!e.disabled:"a"==r?e.href||n:n)&&i(e)}function i(e){return!t(e).parents().andSelf().filter(function(){return"hidden"===t.curCSS(this,"visibility")||t.expr.filters.hidden(this)}).length}t.ui=t.ui||{},t.ui.version||(t.extend(t.ui,{version:"1.8.16",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),t.fn.extend({propAttr:t.fn.prop||t.fn.attr,_focus:t.fn.focus,focus:function(e,n){return"number"==typeof e?this.each(function(){var i=this;setTimeout(function(){t(i).focus(),n&&n.call(i)},e)}):this._focus.apply(this,arguments)},scrollParent:function(){var e;return e=t.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(t.curCSS(this,"position",1))&&/(auto|scroll)/.test(t.curCSS(this,"overflow",1)+t.curCSS(this,"overflow-y",1)+t.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(t.curCSS(this,"overflow",1)+t.curCSS(this,"overflow-y",1)+t.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!e.length?t(document):e},zIndex:function(n){if(n!==e)return this.css("zIndex",n);if(this.length){n=t(this[0]);for(var i;n.length&&n[0]!==document;){if(i=n.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(i=parseInt(n.css("zIndex"),10),!isNaN(i)&&0!==i))return i;n=n.parent()}}return 0},disableSelection:function(){return this.bind((t.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(t){t.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),t.each(["Width","Height"],function(n,i){function r(e,n,i,r){return t.each(a,function(){n-=parseFloat(t.curCSS(e,"padding"+this,!0))||0,i&&(n-=parseFloat(t.curCSS(e,"border"+this+"Width",!0))||0),r&&(n-=parseFloat(t.curCSS(e,"margin"+this,!0))||0)}),n}var a="Width"===i?["Left","Right"]:["Top","Bottom"],o=i.toLowerCase(),s={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(n){return n===e?s["inner"+i].call(this):this.each(function(){t(this).css(o,r(this,n)+"px")})},t.fn["outer"+i]=function(e,n){return"number"!=typeof e?s["outer"+i].call(this,e):this.each(function(){t(this).css(o,r(this,e,!0,n)+"px")})}}),t.extend(t.expr[":"],{data:function(e,n,i){return!!t.data(e,i[3])},focusable:function(e){return n(e,!isNaN(t.attr(e,"tabindex")))},tabbable:function(e){var i=t.attr(e,"tabindex"),r=isNaN(i);return(r||i>=0)&&n(e,!r)}}),t(function(){var e=document.body,n=e.appendChild(n=document.createElement("div"));t.extend(n.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),t.support.minHeight=100===n.offsetHeight,t.support.selectstart="onselectstart"in n,e.removeChild(n).style.display="none"}),t.extend(t.ui,{plugin:{add:function(e,n,i){e=t.ui[e].prototype;for(var r in i)e.plugins[r]=e.plugins[r]||[],e.plugins[r].push([n,i[r]])},call:function(t,e,n){if((e=t.plugins[e])&&t.element[0].parentNode)for(var i=0;e.length>i;i++)t.options[e[i][0]]&&e[i][1].apply(t.element,n)}},contains:function(t,e){return document.compareDocumentPosition?16&t.compareDocumentPosition(e):t!==e&&t.contains(e)},hasScroll:function(e,n){if("hidden"===t(e).css("overflow"))return!1;n=n&&"left"===n?"scrollLeft":"scrollTop";var i=!1;return e[n]>0?!0:(e[n]=1,i=e[n]>0,e[n]=0,i)},isOverAxis:function(t,e,n){return t>e&&e+n>t},isOver:function(e,n,i,r,a,o){return t.ui.isOverAxis(e,i,a)&&t.ui.isOverAxis(n,r,o)}}))}(jQuery),function(t,e){if(t.cleanData){var n=t.cleanData;t.cleanData=function(e){for(var i,r=0;null!=(i=e[r]);r++)try{t(i).triggerHandler("remove")}catch(a){}n(e)}}else{var i=t.fn.remove;t.fn.remove=function(e,n){return this.each(function(){return n||(!e||t.filter(e,[this]).length)&&t("*",this).add([this]).each(function(){try{t(this).triggerHandler("remove")}catch(e){}}),i.call(t(this),e,n)})}}t.widget=function(e,n,i){var r,a=e.split(".")[0];e=e.split(".")[1],r=a+"-"+e,i||(i=n,n=t.Widget),t.expr[":"][r]=function(n){return!!t.data(n,e)},t[a]=t[a]||{},t[a][e]=function(t,e){arguments.length&&this._createWidget(t,e)},n=new n,n.options=t.extend(!0,{},n.options),t[a][e].prototype=t.extend(!0,n,{namespace:a,widgetName:e,widgetEventPrefix:t[a][e].prototype.widgetEventPrefix||e,widgetBaseClass:r},i),t.widget.bridge(e,t[a][e])},t.widget.bridge=function(n,i){t.fn[n]=function(r){var a="string"==typeof r,o=Array.prototype.slice.call(arguments,1),s=this;return r=!a&&o.length?t.extend.apply(null,[!0,r].concat(o)):r,a&&"_"===r.charAt(0)?s:(a?this.each(function(){var i=t.data(this,n),a=i&&t.isFunction(i[r])?i[r].apply(i,o):i;return a!==i&&a!==e?(s=a,!1):void 0}):this.each(function(){var e=t.data(this,n);e?e.option(r||{})._init():t.data(this,n,new i(r,this))}),s)}},t.Widget=function(t,e){arguments.length&&this._createWidget(t,e)},t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(e,n){t.data(n,this.widgetName,this),this.element=t(n),this.options=t.extend(!0,{},this.options,this._getCreateOptions(),e);var i=this;this.element.bind("remove."+this.widgetName,function(){i.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return t.metadata&&t.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(n,i){var r=n;if(0===arguments.length)return t.extend({},this.options);if("string"==typeof n){if(i===e)return this.options[n];r={},r[n]=i}return this._setOptions(r),this},_setOptions:function(e){var n=this;return t.each(e,function(t,e){n._setOption(t,e)}),this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&this.widget()[e?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",e),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(e,n,i){var r=this.options[e];if(n=t.Event(n),n.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i=i||{},n.originalEvent){e=t.event.props.length;for(var a;e;)a=t.event.props[--e],n[a]=n.originalEvent[a]}return this.element.trigger(n,i),!(t.isFunction(r)&&r.call(this.element[0],n,i)===!1||n.isDefaultPrevented())}}}(jQuery),function(t){var e=!1;t(document).mouseup(function(){e=!1}),t.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(n){return!0===t.data(n.target,e.widgetName+".preventClickEvent")?(t.removeData(n.target,e.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName)},_mouseDown:function(n){if(!e){this._mouseStarted&&this._mouseUp(n),this._mouseDownEvent=n;var i=this,r=1==n.which,a="string"==typeof this.options.cancel&&n.target.nodeName?t(n.target).closest(this.options.cancel).length:!1;return r&&!a&&this._mouseCapture(n)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(n)&&this._mouseDelayMet(n)&&(this._mouseStarted=this._mouseStart(n)!==!1,!this._mouseStarted)?(n.preventDefault(),!0):(!0===t.data(n.target,this.widgetName+".preventClickEvent")&&t.removeData(n.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},t(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),n.preventDefault(),e=!0)):!0}},_mouseMove:function(e){return!t.browser.msie||document.documentMode>=9||e.button?this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&((this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1)?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted):this._mouseUp(e)},_mouseUp:function(e){return t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target==this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(t){t.ui=t.ui||{};var e=/left|center|right/,n=/top|center|bottom/,i=t.fn.position,r=t.fn.offset;t.fn.position=function(r){if(!r||!r.of)return i.apply(this,arguments);r=t.extend({},r);var a,o,s,l=t(r.of),c=l[0],u=(r.collision||"flip").split(" "),d=r.offset?r.offset.split(" "):[0,0];return 9===c.nodeType?(a=l.width(),o=l.height(),s={top:0,left:0}):c.setTimeout?(a=l.width(),o=l.height(),s={top:l.scrollTop(),left:l.scrollLeft()}):c.preventDefault?(r.at="left top",a=o=0,s={top:r.of.pageY,left:r.of.pageX}):(a=l.outerWidth(),o=l.outerHeight(),s=l.offset()),t.each(["my","at"],function(){var t=(r[this]||"").split(" ");1===t.length&&(t=e.test(t[0])?t.concat(["center"]):n.test(t[0])?["center"].concat(t):["center","center"]),t[0]=e.test(t[0])?t[0]:"center",t[1]=n.test(t[1])?t[1]:"center",r[this]=t}),1===u.length&&(u[1]=u[0]),d[0]=parseInt(d[0],10)||0,1===d.length&&(d[1]=d[0]),d[1]=parseInt(d[1],10)||0,"right"===r.at[0]?s.left+=a:"center"===r.at[0]&&(s.left+=a/2),"bottom"===r.at[1]?s.top+=o:"center"===r.at[1]&&(s.top+=o/2),s.left+=d[0],s.top+=d[1],this.each(function(){var e,n=t(this),i=n.outerWidth(),l=n.outerHeight(),c=parseInt(t.curCSS(this,"marginLeft",!0))||0,h=parseInt(t.curCSS(this,"marginTop",!0))||0,p=i+c+(parseInt(t.curCSS(this,"marginRight",!0))||0),f=l+h+(parseInt(t.curCSS(this,"marginBottom",!0))||0),g=t.extend({},s);"right"===r.my[0]?g.left-=i:"center"===r.my[0]&&(g.left-=i/2),"bottom"===r.my[1]?g.top-=l:"center"===r.my[1]&&(g.top-=l/2),g.left=Math.round(g.left),g.top=Math.round(g.top),e={left:g.left-c,top:g.top-h},t.each(["left","top"],function(n,s){t.ui.position[u[n]]&&t.ui.position[u[n]][s](g,{targetWidth:a,targetHeight:o,elemWidth:i,elemHeight:l,collisionPosition:e,collisionWidth:p,collisionHeight:f,offset:d,my:r.my,at:r.at})}),t.fn.bgiframe&&n.bgiframe(),n.offset(t.extend(g,{using:r.using}))})},t.ui.position={fit:{left:function(e,n){var i=t(window);i=n.collisionPosition.left+n.collisionWidth-i.width()-i.scrollLeft(),e.left=i>0?e.left-i:Math.max(e.left-n.collisionPosition.left,e.left)},top:function(e,n){var i=t(window);i=n.collisionPosition.top+n.collisionHeight-i.height()-i.scrollTop(),e.top=i>0?e.top-i:Math.max(e.top-n.collisionPosition.top,e.top)}},flip:{left:function(e,n){if("center"!==n.at[0]){var i=t(window);i=n.collisionPosition.left+n.collisionWidth-i.width()-i.scrollLeft();var r="left"===n.my[0]?-n.elemWidth:"right"===n.my[0]?n.elemWidth:0,a="left"===n.at[0]?n.targetWidth:-n.targetWidth,o=-2*n.offset[0];e.left+=0>n.collisionPosition.left?r+a+o:i>0?r+a+o:0}},top:function(e,n){if("center"!==n.at[1]){var i=t(window);i=n.collisionPosition.top+n.collisionHeight-i.height()-i.scrollTop();var r="top"===n.my[1]?-n.elemHeight:"bottom"===n.my[1]?n.elemHeight:0,a="top"===n.at[1]?n.targetHeight:-n.targetHeight,o=-2*n.offset[1];e.top+=0>n.collisionPosition.top?r+a+o:i>0?r+a+o:0}}}},t.offset.setOffset||(t.offset.setOffset=function(e,n){/static/.test(t.curCSS(e,"position"))&&(e.style.position="relative");var i=t(e),r=i.offset(),a=parseInt(t.curCSS(e,"top",!0),10)||0,o=parseInt(t.curCSS(e,"left",!0),10)||0;r={top:n.top-r.top+a,left:n.left-r.left+o},"using"in n?n.using.call(e,r):i.css(r)},t.fn.offset=function(e){var n=this[0];return n&&n.ownerDocument?e?this.each(function(){t.offset.setOffset(this,e)}):r.call(this):null})}(jQuery),function(t){t.widget("ui.draggable",t.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){"original"!=this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},destroy:function(){return this.element.data("draggable")?(this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy(),this):void 0},_mouseCapture:function(e){var n=this.options;return this.helper||n.disabled||t(e.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(e),this.handle?(n.iframeFix&&t(n.iframeFix===!0?"iframe":n.iframeFix).each(function(){t('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(t(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(e){var n=this.options;return this.helper=this._createHelper(e),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),n.containment&&this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.helper.addClass("ui-draggable-dragging"),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_mouseDrag:function(e,n){if(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),!n){if(n=this._uiHash(),this._trigger("drag",e,n)===!1)return this._mouseUp({}),!1;this.position=n.position}return this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px"),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var n=!1;if(t.ui.ddmanager&&!this.options.dropBehaviour&&(n=t.ui.ddmanager.drop(this,e)),this.dropped&&(n=this.dropped,this.dropped=!1),!(this.element[0]&&this.element[0].parentNode||"original"!=this.options.helper))return!1;if("invalid"==this.options.revert&&!n||"valid"==this.options.revert&&n||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)){var i=this;t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",e)!==!1&&i._clear()})}else this._trigger("stop",e)!==!1&&this._clear();return!1},_mouseUp:function(e){return this.options.iframeFix===!0&&t("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(e){var n=this.options.handle&&t(this.options.handle,this.element).length?!1:!0;return t(this.options.handle,this.element).find("*").andSelf().each(function(){this==e.target&&(n=!0)}),n},_createHelper:function(e){var n=this.options;return e=t.isFunction(n.helper)?t(n.helper.apply(this.element[0],[e])):"clone"==n.helper?this.element.clone().removeAttr("id"):this.element,e.parents("body").length||e.appendTo("parent"==n.appendTo?this.element[0].parentNode:n.appendTo),e[0]!=this.element[0]&&!/(fixed|absolute)/.test(e.css("position"))&&e.css("position","absolute"),e},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&t.browser.msie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var t=this.element.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e=this.options;if("parent"==e.containment&&(e.containment=this.helper[0].parentNode),("document"==e.containment||"window"==e.containment)&&(this.containment=["document"==e.containment?0:t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,"document"==e.containment?0:t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,("document"==e.containment?0:t(window).scrollLeft())+t("document"==e.containment?document:window).width()-this.helperProportions.width-this.margins.left,("document"==e.containment?0:t(window).scrollTop())+(t("document"==e.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(e.containment)||e.containment.constructor==Array)e.containment.constructor==Array&&(this.containment=e.containment);else{e=t(e.containment);var n=e[0];if(n){e.offset();var i="hidden"!=t(n).css("overflow");this.containment=[(parseInt(t(n).css("borderLeftWidth"),10)||0)+(parseInt(t(n).css("paddingLeft"),10)||0),(parseInt(t(n).css("borderTopWidth"),10)||0)+(parseInt(t(n).css("paddingTop"),10)||0),(i?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(t(n).css("borderLeftWidth"),10)||0)-(parseInt(t(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(i?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(t(n).css("borderTopWidth"),10)||0)-(parseInt(t(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=e}}},_convertPositionTo:function(e,n){n||(n=this.position),e="absolute"==e?1:-1;var i="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,r=/(html|body)/i.test(i[0].tagName);return{top:n.top+this.offset.relative.top*e+this.offset.parent.top*e-(t.browser.safari&&526>t.browser.version&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollTop():r?0:i.scrollTop())*e),left:n.left+this.offset.relative.left*e+this.offset.parent.left*e-(t.browser.safari&&526>t.browser.version&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():r?0:i.scrollLeft())*e)}},_generatePosition:function(e){var n=this.options,i="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,r=/(html|body)/i.test(i[0].tagName),a=e.pageX,o=e.pageY;if(this.originalPosition){var s;this.containment&&(this.relative_container?(s=this.relative_container.offset(),s=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):s=this.containment,e.pageX-this.offset.click.left<s[0]&&(a=s[0]+this.offset.click.left),e.pageY-this.offset.click.top<s[1]&&(o=s[1]+this.offset.click.top),e.pageX-this.offset.click.left>s[2]&&(a=s[2]+this.offset.click.left),e.pageY-this.offset.click.top>s[3]&&(o=s[3]+this.offset.click.top)),n.grid&&(o=n.grid[1]?this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1]:this.originalPageY,o=s?o-this.offset.click.top<s[1]||o-this.offset.click.top>s[3]?o-this.offset.click.top<s[1]?o+n.grid[1]:o-n.grid[1]:o:o,a=n.grid[0]?this.originalPageX+Math.round((a-this.originalPageX)/n.grid[0])*n.grid[0]:this.originalPageX,a=s?a-this.offset.click.left<s[0]||a-this.offset.click.left>s[2]?a-this.offset.click.left<s[0]?a+n.grid[0]:a-n.grid[0]:a:a)}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(t.browser.safari&&526>t.browser.version&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollTop():r?0:i.scrollTop()),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(t.browser.safari&&526>t.browser.version&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollLeft():r?0:i.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(e,n,i){return i=i||this._uiHash(),t.ui.plugin.call(this,e,[n,i]),"drag"==e&&(this.positionAbs=this._convertPositionTo("absolute")),t.Widget.prototype._trigger.call(this,e,n,i)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.extend(t.ui.draggable,{version:"1.8.16"}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,n){var i=t(this).data("draggable"),r=i.options,a=t.extend({},n,{item:i.element});i.sortables=[],t(r.connectToSortable).each(function(){var n=t.data(this,"sortable");n&&!n.options.disabled&&(i.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",e,a))})},stop:function(e,n){var i=t(this).data("draggable"),r=t.extend({},n,{item:i.element});t.each(i.sortables,function(){this.instance.isOver?(this.instance.isOver=0,i.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(e),this.instance.options.helper=this.instance.options._helper,"original"==i.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",e,r))})},drag:function(e,n){var i=t(this).data("draggable"),r=this;t.each(i.sortables,function(){this.instance.positionAbs=i.positionAbs,this.instance.helperProportions=i.helperProportions,this.instance.offset.click=i.offset.click,this.instance._intersectsWith(this.instance.containerCache)?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=t(r).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0]},e.target=this.instance.currentItem[0],this.instance._mouseCapture(e,!0),this.instance._mouseStart(e,!0,!0),this.instance.offset.click.top=i.offset.click.top,this.instance.offset.click.left=i.offset.click.left,this.instance.offset.parent.left-=i.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=i.offset.parent.top-this.instance.offset.parent.top,i._trigger("toSortable",e),i.dropped=this.instance.element,i.currentItem=i.element,this.instance.fromOutside=i),this.instance.currentItem&&this.instance._mouseDrag(e)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",e,this.instance._uiHash(this.instance)),this.instance._mouseStop(e,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),i._trigger("fromSortable",e),i.dropped=!1)})}}),t.ui.plugin.add("draggable","cursor",{start:function(){var e=t("body"),n=t(this).data("draggable").options;e.css("cursor")&&(n._cursor=e.css("cursor")),e.css("cursor",n.cursor)},stop:function(){var e=t(this).data("draggable").options;e._cursor&&t("body").css("cursor",e._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,n){e=t(n.helper),n=t(this).data("draggable").options,e.css("opacity")&&(n._opacity=e.css("opacity")),e.css("opacity",n.opacity)},stop:function(e,n){e=t(this).data("draggable").options,e._opacity&&t(n.helper).css("opacity",e._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(){var e=t(this).data("draggable");e.scrollParent[0]!=document&&"HTML"!=e.scrollParent[0].tagName&&(e.overflowOffset=e.scrollParent.offset())},drag:function(e){var n=t(this).data("draggable"),i=n.options,r=!1;n.scrollParent[0]!=document&&"HTML"!=n.scrollParent[0].tagName?(i.axis&&"x"==i.axis||(n.overflowOffset.top+n.scrollParent[0].offsetHeight-e.pageY<i.scrollSensitivity?n.scrollParent[0].scrollTop=r=n.scrollParent[0].scrollTop+i.scrollSpeed:e.pageY-n.overflowOffset.top<i.scrollSensitivity&&(n.scrollParent[0].scrollTop=r=n.scrollParent[0].scrollTop-i.scrollSpeed)),i.axis&&"y"==i.axis||(n.overflowOffset.left+n.scrollParent[0].offsetWidth-e.pageX<i.scrollSensitivity?n.scrollParent[0].scrollLeft=r=n.scrollParent[0].scrollLeft+i.scrollSpeed:e.pageX-n.overflowOffset.left<i.scrollSensitivity&&(n.scrollParent[0].scrollLeft=r=n.scrollParent[0].scrollLeft-i.scrollSpeed))):(i.axis&&"x"==i.axis||(e.pageY-t(document).scrollTop()<i.scrollSensitivity?r=t(document).scrollTop(t(document).scrollTop()-i.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<i.scrollSensitivity&&(r=t(document).scrollTop(t(document).scrollTop()+i.scrollSpeed))),i.axis&&"y"==i.axis||(e.pageX-t(document).scrollLeft()<i.scrollSensitivity?r=t(document).scrollLeft(t(document).scrollLeft()-i.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<i.scrollSensitivity&&(r=t(document).scrollLeft(t(document).scrollLeft()+i.scrollSpeed)))),r!==!1&&t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(n,e)}}),t.ui.plugin.add("draggable","snap",{start:function(){var e=t(this).data("draggable"),n=e.options;e.snapElements=[],t(n.snap.constructor!=String?n.snap.items||":data(draggable)":n.snap).each(function(){var n=t(this),i=n.offset();this!=e.element[0]&&e.snapElements.push({item:this,width:n.outerWidth(),height:n.outerHeight(),top:i.top,left:i.left})})},drag:function(e,n){for(var i=t(this).data("draggable"),r=i.options,a=r.snapTolerance,o=n.offset.left,s=o+i.helperProportions.width,l=n.offset.top,c=l+i.helperProportions.height,u=i.snapElements.length-1;u>=0;u--){var d=i.snapElements[u].left,h=d+i.snapElements[u].width,p=i.snapElements[u].top,f=p+i.snapElements[u].height;if(o>d-a&&h+a>o&&l>p-a&&f+a>l||o>d-a&&h+a>o&&c>p-a&&f+a>c||s>d-a&&h+a>s&&l>p-a&&f+a>l||s>d-a&&h+a>s&&c>p-a&&f+a>c){if("inner"!=r.snapMode){var g=a>=Math.abs(p-c),m=a>=Math.abs(f-l),v=a>=Math.abs(d-s),y=a>=Math.abs(h-o);g&&(n.position.top=i._convertPositionTo("relative",{top:p-i.helperProportions.height,left:0}).top-i.margins.top),m&&(n.position.top=i._convertPositionTo("relative",{top:f,left:0}).top-i.margins.top),v&&(n.position.left=i._convertPositionTo("relative",{top:0,left:d-i.helperProportions.width}).left-i.margins.left),y&&(n.position.left=i._convertPositionTo("relative",{top:0,left:h}).left-i.margins.left)}var b=g||m||v||y;"outer"!=r.snapMode&&(g=a>=Math.abs(p-l),m=a>=Math.abs(f-c),v=a>=Math.abs(d-o),y=a>=Math.abs(h-s),g&&(n.position.top=i._convertPositionTo("relative",{top:p,left:0}).top-i.margins.top),m&&(n.position.top=i._convertPositionTo("relative",{top:f-i.helperProportions.height,left:0}).top-i.margins.top),v&&(n.position.left=i._convertPositionTo("relative",{top:0,left:d}).left-i.margins.left),y&&(n.position.left=i._convertPositionTo("relative",{top:0,left:h-i.helperProportions.width}).left-i.margins.left)),!i.snapElements[u].snapping&&(g||m||v||y||b)&&i.options.snap.snap&&i.options.snap.snap.call(i.element,e,t.extend(i._uiHash(),{snapItem:i.snapElements[u].item})),i.snapElements[u].snapping=g||m||v||y||b
}else i.snapElements[u].snapping&&i.options.snap.release&&i.options.snap.release.call(i.element,e,t.extend(i._uiHash(),{snapItem:i.snapElements[u].item})),i.snapElements[u].snapping=!1}}}),t.ui.plugin.add("draggable","stack",{start:function(){var e=t(this).data("draggable").options;if(e=t.makeArray(t(e.stack)).sort(function(e,n){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(n).css("zIndex"),10)||0)}),e.length){var n=parseInt(e[0].style.zIndex)||0;t(e).each(function(t){this.style.zIndex=n+t}),this[0].style.zIndex=n+e.length}}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,n){e=t(n.helper),n=t(this).data("draggable").options,e.css("zIndex")&&(n._zIndex=e.css("zIndex")),e.css("zIndex",n.zIndex)},stop:function(e,n){e=t(this).data("draggable").options,e._zIndex&&t(n.helper).css("zIndex",e._zIndex)}})}(jQuery),function(t){t.widget("ui.droppable",{widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var e=this.options,n=e.accept;this.isover=0,this.isout=1,this.accept=t.isFunction(n)?n:function(t){return t.is(n)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},t.ui.ddmanager.droppables[e.scope]=t.ui.ddmanager.droppables[e.scope]||[],t.ui.ddmanager.droppables[e.scope].push(this),e.addClasses&&this.element.addClass("ui-droppable")},destroy:function(){for(var e=t.ui.ddmanager.droppables[this.options.scope],n=0;e.length>n;n++)e[n]==this&&e.splice(n,1);return this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable"),this},_setOption:function(e,n){"accept"==e&&(this.accept=t.isFunction(n)?n:function(t){return t.is(n)}),t.Widget.prototype._setOption.apply(this,arguments)},_activate:function(e){var n=t.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),n&&this._trigger("activate",e,this.ui(n))},_deactivate:function(e){var n=t.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),n&&this._trigger("deactivate",e,this.ui(n))},_over:function(e){var n=t.ui.ddmanager.current;n&&(n.currentItem||n.element)[0]!=this.element[0]&&this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",e,this.ui(n)))},_out:function(e){var n=t.ui.ddmanager.current;n&&(n.currentItem||n.element)[0]!=this.element[0]&&this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",e,this.ui(n)))},_drop:function(e,n){var i=n||t.ui.ddmanager.current;if(!i||(i.currentItem||i.element)[0]==this.element[0])return!1;var r=!1;return this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var e=t.data(this,"droppable");return e.options.greedy&&!e.options.disabled&&e.options.scope==i.options.scope&&e.accept.call(e.element[0],i.currentItem||i.element)&&t.ui.intersect(i,t.extend(e,{offset:e.element.offset()}),e.options.tolerance)?(r=!0,!1):void 0}),r?!1:this.accept.call(this.element[0],i.currentItem||i.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",e,this.ui(i)),this.element):!1},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}}}),t.extend(t.ui.droppable,{version:"1.8.16"}),t.ui.intersect=function(e,n,i){if(!n.offset)return!1;var r=(e.positionAbs||e.position.absolute).left,a=r+e.helperProportions.width,o=(e.positionAbs||e.position.absolute).top,s=o+e.helperProportions.height,l=n.offset.left,c=l+n.proportions.width,u=n.offset.top,d=u+n.proportions.height;switch(i){case"fit":return r>=l&&c>=a&&o>=u&&d>=s;case"intersect":return r+e.helperProportions.width/2>l&&c>a-e.helperProportions.width/2&&o+e.helperProportions.height/2>u&&d>s-e.helperProportions.height/2;case"pointer":return t.ui.isOver((e.positionAbs||e.position.absolute).top+(e.clickOffset||e.offset.click).top,(e.positionAbs||e.position.absolute).left+(e.clickOffset||e.offset.click).left,u,l,n.proportions.height,n.proportions.width);case"touch":return(o>=u&&d>=o||s>=u&&d>=s||u>o&&s>d)&&(r>=l&&c>=r||a>=l&&c>=a||l>r&&a>c);default:return!1}},t.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(e,n){var i=t.ui.ddmanager.droppables[e.options.scope]||[],r=n?n.type:null,a=(e.currentItem||e.element).find(":data(droppable)").andSelf(),o=0;t:for(;i.length>o;o++)if(!(i[o].options.disabled||e&&!i[o].accept.call(i[o].element[0],e.currentItem||e.element))){for(var s=0;a.length>s;s++)if(a[s]==i[o].element[0]){i[o].proportions.height=0;continue t}i[o].visible="none"!=i[o].element.css("display"),i[o].visible&&("mousedown"==r&&i[o]._activate.call(i[o],n),i[o].offset=i[o].element.offset(),i[o].proportions={width:i[o].element[0].offsetWidth,height:i[o].element[0].offsetHeight})}},drop:function(e,n){var i=!1;return t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){this.options&&(!this.options.disabled&&this.visible&&t.ui.intersect(e,this,this.options.tolerance)&&(i=i||this._drop.call(this,n)),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,n)))}),i},dragStart:function(e,n){e.element.parents(":not(body,html)").bind("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,n)})},drag:function(e,n){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,n),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var i=t.ui.intersect(e,this,this.options.tolerance);if(i=i||1!=this.isover?i&&0==this.isover?"isover":null:"isout"){var r;if(this.options.greedy){var a=this.element.parents(":data(droppable):eq(0)");a.length&&(r=t.data(a[0],"droppable"),r.greedyChild="isover"==i?1:0)}r&&"isover"==i&&(r.isover=0,r.isout=1,r._out.call(r,n)),this[i]=1,this["isout"==i?"isover":"isout"]=0,this["isover"==i?"_over":"_out"].call(this,n),r&&"isout"==i&&(r.isout=0,r.isover=1,r._over.call(r,n))}}})},dragStop:function(e,n){e.element.parents(":not(body,html)").unbind("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,n)}}}(jQuery),function(t){t.widget("ui.resizable",t.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1e3},_create:function(){var e=this,n=this.options;if(this.element.addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!n.aspectRatio,aspectRatio:n.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:n.helper||n.ghost||n.animate?n.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(/relative/.test(this.element.css("position"))&&t.browser.opera&&this.element.css({position:"relative",top:"auto",left:"auto"}),this.element.wrap(t('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("resizable",this.element.data("resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=n.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor==String){"all"==this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw");var i=this.handles.split(",");this.handles={};for(var r=0;i.length>r;r++){var a=t.trim(i[r]),o=t('<div class="ui-resizable-handle '+("ui-resizable-"+a)+'"></div>');/sw|se|ne|nw/.test(a)&&o.css({zIndex:++n.zIndex}),"se"==a&&o.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[a]=".ui-resizable-"+a,this.element.append(o)}}this._renderAxis=function(e){e=e||this.element;for(var n in this.handles){if(this.handles[n].constructor==String&&(this.handles[n]=t(this.handles[n],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var i=t(this.handles[n],this.element),r=0;r=/sw|ne|nw|se|n|s/.test(n)?i.outerHeight():i.outerWidth(),i=["padding",/ne|nw|n/.test(n)?"Top":/se|sw|s/.test(n)?"Bottom":/^e$/.test(n)?"Right":"Left"].join(""),e.css(i,r),this._proportionallyResize()}t(this.handles[n])}},this._renderAxis(this.element),this._handles=t(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){if(!e.resizing){if(this.className)var t=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);e.axis=t&&t[1]?t[1]:"se"}}),n.autoHide&&(this._handles.hide(),t(this.element).addClass("ui-resizable-autohide").hover(function(){n.disabled||(t(this).removeClass("ui-resizable-autohide"),e._handles.show())},function(){n.disabled||e.resizing||(t(this).addClass("ui-resizable-autohide"),e._handles.hide())})),this._mouseInit()},destroy:function(){this._mouseDestroy();var e=function(e){t(e).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){e(this.element);var n=this.element;n.after(this.originalElement.css({position:n.css("position"),width:n.outerWidth(),height:n.outerHeight(),top:n.css("top"),left:n.css("left")})).remove()}return this.originalElement.css("resize",this.originalResizeStyle),e(this.originalElement),this},_mouseCapture:function(e){var n=!1;for(var i in this.handles)t(this.handles[i])[0]==e.target&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(n){var i=this.options,r=this.element.position(),a=this.element;this.resizing=!0,this.documentScroll={top:t(document).scrollTop(),left:t(document).scrollLeft()},(a.is(".ui-draggable")||/absolute/.test(a.css("position")))&&a.css({position:"absolute",top:r.top,left:r.left}),t.browser.opera&&/relative/.test(a.css("position"))&&a.css({position:"relative",top:"auto",left:"auto"}),this._renderProxy(),r=e(this.helper.css("left"));var o=e(this.helper.css("top"));return i.containment&&(r+=t(i.containment).scrollLeft()||0,o+=t(i.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:r,top:o},this.size=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.originalPosition={left:r,top:o},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalMousePosition={left:n.pageX,top:n.pageY},this.aspectRatio="number"==typeof i.aspectRatio?i.aspectRatio:this.originalSize.width/this.originalSize.height||1,i=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"==i?this.axis+"-resize":i),a.addClass("ui-resizable-resizing"),this._propagate("start",n),!0},_mouseDrag:function(t){var e=this.helper,n=this.originalMousePosition,i=this._change[this.axis];return i?(n=i.apply(this,[t,t.pageX-n.left||0,t.pageY-n.top||0]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(n=this._updateRatio(n,t)),n=this._respectSize(n,t),this._propagate("resize",t),e.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"}),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),this._updateCache(n),this._trigger("resize",t,this.ui()),!1):!1},_mouseStop:function(e){this.resizing=!1;var n=this.options,i=this;if(this._helper){var r=this._proportionallyResizeElements,a=r.length&&/textarea/i.test(r[0].nodeName);r=a&&t.ui.hasScroll(r[0],"left")?0:i.sizeDiff.height,a=a?0:i.sizeDiff.width,a={width:i.helper.width()-a,height:i.helper.height()-r},r=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null;var o=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;n.animate||this.element.css(t.extend(a,{top:o,left:r})),i.helper.height(i.size.height),i.helper.width(i.size.width),this._helper&&!n.animate&&this._proportionallyResize()}return t("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(t){var e,i,r,a=this.options;a={minWidth:n(a.minWidth)?a.minWidth:0,maxWidth:n(a.maxWidth)?a.maxWidth:1/0,minHeight:n(a.minHeight)?a.minHeight:0,maxHeight:n(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||t)&&(t=a.minHeight*this.aspectRatio,i=a.minWidth/this.aspectRatio,e=a.maxHeight*this.aspectRatio,r=a.maxWidth/this.aspectRatio,t>a.minWidth&&(a.minWidth=t),i>a.minHeight&&(a.minHeight=i),a.maxWidth>e&&(a.maxWidth=e),a.maxHeight>r&&(a.maxHeight=r)),this._vBoundaries=a},_updateCache:function(t){this.offset=this.helper.offset(),n(t.left)&&(this.position.left=t.left),n(t.top)&&(this.position.top=t.top),n(t.height)&&(this.size.height=t.height),n(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,i=this.size,r=this.axis;return n(t.height)?t.width=t.height*this.aspectRatio:n(t.width)&&(t.height=t.width/this.aspectRatio),"sw"==r&&(t.left=e.left+(i.width-t.width),t.top=null),"nw"==r&&(t.top=e.top+(i.height-t.height),t.left=e.left+(i.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,i=this.axis,r=n(t.width)&&e.maxWidth&&e.maxWidth<t.width,a=n(t.height)&&e.maxHeight&&e.maxHeight<t.height,o=n(t.width)&&e.minWidth&&e.minWidth>t.width,s=n(t.height)&&e.minHeight&&e.minHeight>t.height;o&&(t.width=e.minWidth),s&&(t.height=e.minHeight),r&&(t.width=e.maxWidth),a&&(t.height=e.maxHeight);var l=this.originalPosition.left+this.originalSize.width,c=this.position.top+this.size.height,u=/sw|nw|w/.test(i);return i=/nw|ne|n/.test(i),o&&u&&(t.left=l-e.minWidth),r&&u&&(t.left=l-e.maxWidth),s&&i&&(t.top=c-e.minHeight),a&&i&&(t.top=c-e.maxHeight),(e=!t.width&&!t.height)&&!t.left&&t.top?t.top=null:e&&!t.top&&t.left&&(t.left=null),t},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e=this.helper||this.element,n=0;this._proportionallyResizeElements.length>n;n++){var i=this._proportionallyResizeElements[n];if(!this.borderDif){var r=[i.css("borderTopWidth"),i.css("borderRightWidth"),i.css("borderBottomWidth"),i.css("borderLeftWidth")],a=[i.css("paddingTop"),i.css("paddingRight"),i.css("paddingBottom"),i.css("paddingLeft")];this.borderDif=t.map(r,function(t,e){return t=parseInt(t,10)||0,e=parseInt(a[e],10)||0,t+e})}t.browser.msie&&(t(e).is(":hidden")||t(e).parents(":hidden").length)||i.css({height:e.height()-this.borderDif[0]-this.borderDif[2]||0,width:e.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var e=this.options;if(this.elementOffset=this.element.offset(),this._helper){this.helper=this.helper||t('<div style="overflow:hidden;"></div>');var n=t.browser.msie&&7>t.browser.version,i=n?1:0;n=n?2:-1,this.helper.addClass(this._helper).css({width:this.element.outerWidth()+n,height:this.element.outerHeight()+n,position:"absolute",left:this.elementOffset.left-i+"px",top:this.elementOffset.top-i+"px",zIndex:++e.zIndex}),this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){return{left:this.originalPosition.left+e,width:this.originalSize.width-e}},n:function(t,e,n){return{top:this.originalPosition.top+n,height:this.originalSize.height-n}},s:function(t,e,n){return{height:this.originalSize.height+n}},se:function(e,n,i){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,n,i]))},sw:function(e,n,i){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,n,i]))},ne:function(e,n,i){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,n,i]))},nw:function(e,n,i){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,n,i]))}},_propagate:function(e,n){t.ui.plugin.call(this,e,[n,this.ui()]),"resize"!=e&&this._trigger(e,n,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.extend(t.ui.resizable,{version:"1.8.16"}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var e=t(this).data("resizable").options,n=function(e){t(e).each(function(){var e=t(this);e.data("resizable-alsoresize",{width:parseInt(e.width(),10),height:parseInt(e.height(),10),left:parseInt(e.css("left"),10),top:parseInt(e.css("top"),10),position:e.css("position")})})};"object"!=typeof e.alsoResize||e.alsoResize.parentNode?n(e.alsoResize):e.alsoResize.length?(e.alsoResize=e.alsoResize[0],n(e.alsoResize)):t.each(e.alsoResize,function(t){n(t)})},resize:function(e,n){var i=t(this).data("resizable");e=i.options;var r=i.originalSize,a=i.originalPosition,o={height:i.size.height-r.height||0,width:i.size.width-r.width||0,top:i.position.top-a.top||0,left:i.position.left-a.left||0},s=function(e,r){t(e).each(function(){var e=t(this),a=t(this).data("resizable-alsoresize"),s={},l=r&&r.length?r:e.parents(n.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(l,function(t,e){(t=(a[e]||0)+(o[e]||0))&&t>=0&&(s[e]=t||null)}),t.browser.opera&&/relative/.test(e.css("position"))&&(i._revertToRelativePosition=!0,e.css({position:"absolute",top:"auto",left:"auto"})),e.css(s)})};"object"!=typeof e.alsoResize||e.alsoResize.nodeType?s(e.alsoResize):t.each(e.alsoResize,function(t,e){s(t,e)})},stop:function(){var e=t(this).data("resizable"),n=e.options,i=function(e){t(e).each(function(){var e=t(this);e.css({position:e.data("resizable-alsoresize").position})})};e._revertToRelativePosition&&(e._revertToRelativePosition=!1,"object"!=typeof n.alsoResize||n.alsoResize.nodeType?i(n.alsoResize):t.each(n.alsoResize,function(t){i(t)})),t(this).removeData("resizable-alsoresize")}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var n=t(this).data("resizable"),i=n.options,r=n._proportionallyResizeElements,a=r.length&&/textarea/i.test(r[0].nodeName),o=a&&t.ui.hasScroll(r[0],"left")?0:n.sizeDiff.height;a={width:n.size.width-(a?0:n.sizeDiff.width),height:n.size.height-o},o=parseInt(n.element.css("left"),10)+(n.position.left-n.originalPosition.left)||null;var s=parseInt(n.element.css("top"),10)+(n.position.top-n.originalPosition.top)||null;n.element.animate(t.extend(a,s&&o?{top:s,left:o}:{}),{duration:i.animateDuration,easing:i.animateEasing,step:function(){var i={width:parseInt(n.element.css("width"),10),height:parseInt(n.element.css("height"),10),top:parseInt(n.element.css("top"),10),left:parseInt(n.element.css("left"),10)};r&&r.length&&t(r[0]).css({width:i.width,height:i.height}),n._updateCache(i),n._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var n=t(this).data("resizable"),i=n.element,r=n.options.containment;if(i=r instanceof t?r.get(0):/parent/.test(r)?i.parent().get(0):r)if(n.containerElement=t(i),/document/.test(r)||r==document)n.containerOffset={left:0,top:0},n.containerPosition={left:0,top:0},n.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight};else{var a=t(i),o=[];t(["Top","Right","Left","Bottom"]).each(function(t,n){o[t]=e(a.css("padding"+n))}),n.containerOffset=a.offset(),n.containerPosition=a.position(),n.containerSize={height:a.innerHeight()-o[3],width:a.innerWidth()-o[1]},r=n.containerOffset;var s=n.containerSize.height,l=n.containerSize.width;l=t.ui.hasScroll(i,"left")?i.scrollWidth:l,s=t.ui.hasScroll(i)?i.scrollHeight:s,n.parentData={element:i,left:r.left,top:r.top,width:l,height:s}}},resize:function(e){var n=t(this).data("resizable"),i=n.options,r=n.containerOffset,a=n.position;e=n._aspectRatio||e.shiftKey;var o={top:0,left:0},s=n.containerElement;s[0]!=document&&/static/.test(s.css("position"))&&(o=r),a.left<(n._helper?r.left:0)&&(n.size.width+=n._helper?n.position.left-r.left:n.position.left-o.left,e&&(n.size.height=n.size.width/i.aspectRatio),n.position.left=i.helper?r.left:0),a.top<(n._helper?r.top:0)&&(n.size.height+=n._helper?n.position.top-r.top:n.position.top,e&&(n.size.width=n.size.height*i.aspectRatio),n.position.top=n._helper?r.top:0),n.offset.left=n.parentData.left+n.position.left,n.offset.top=n.parentData.top+n.position.top,i=Math.abs((n._helper?n.offset.left-o.left:n.offset.left-o.left)+n.sizeDiff.width),r=Math.abs((n._helper?n.offset.top-o.top:n.offset.top-r.top)+n.sizeDiff.height),a=n.containerElement.get(0)==n.element.parent().get(0),o=/relative|absolute/.test(n.containerElement.css("position")),a&&o&&(i-=n.parentData.left),i+n.size.width>=n.parentData.width&&(n.size.width=n.parentData.width-i,e&&(n.size.height=n.size.width/n.aspectRatio)),r+n.size.height>=n.parentData.height&&(n.size.height=n.parentData.height-r,e&&(n.size.width=n.size.height*n.aspectRatio))},stop:function(){var e=t(this).data("resizable"),n=e.options,i=e.containerOffset,r=e.containerPosition,a=e.containerElement,o=t(e.helper),s=o.offset(),l=o.outerWidth()-e.sizeDiff.width;o=o.outerHeight()-e.sizeDiff.height,e._helper&&!n.animate&&/relative/.test(a.css("position"))&&t(this).css({left:s.left-r.left-i.left,width:l,height:o}),e._helper&&!n.animate&&/static/.test(a.css("position"))&&t(this).css({left:s.left-r.left-i.left,width:l,height:o})}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).data("resizable"),n=e.options,i=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof n.ghost?n.ghost:""),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).data("resizable");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).data("resizable");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e=t(this).data("resizable"),n=e.options,i=e.size,r=e.originalSize,a=e.originalPosition,o=e.axis;n.grid="number"==typeof n.grid?[n.grid,n.grid]:n.grid;var s=Math.round((i.width-r.width)/(n.grid[0]||1))*(n.grid[0]||1);n=Math.round((i.height-r.height)/(n.grid[1]||1))*(n.grid[1]||1),/^(se|s|e)$/.test(o)?(e.size.width=r.width+s,e.size.height=r.height+n):/^(ne)$/.test(o)?(e.size.width=r.width+s,e.size.height=r.height+n,e.position.top=a.top-n):(/^(sw)$/.test(o)?(e.size.width=r.width+s,e.size.height=r.height+n):(e.size.width=r.width+s,e.size.height=r.height+n,e.position.top=a.top-n),e.position.left=a.left-s)}});var e=function(t){return parseInt(t,10)||0},n=function(t){return!isNaN(parseInt(t,10))}}(jQuery),function(t){t.widget("ui.selectable",t.ui.mouse,{options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch"},_create:function(){var e=this;this.element.addClass("ui-selectable"),this.dragged=!1;var n;this.refresh=function(){n=t(e.options.filter,e.element[0]),n.each(function(){var e=t(this),n=e.offset();t.data(this,"selectable-item",{element:this,$element:e,left:n.left,top:n.top,right:n.left+e.outerWidth(),bottom:n.top+e.outerHeight(),startselected:!1,selected:e.hasClass("ui-selected"),selecting:e.hasClass("ui-selecting"),unselecting:e.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=n.addClass("ui-selectee"),this._mouseInit(),this.helper=t("<div class='ui-selectable-helper'></div>")},destroy:function(){return this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled").removeData("selectable").unbind(".selectable"),this._mouseDestroy(),this},_mouseStart:function(e){var n=this;if(this.opos=[e.pageX,e.pageY],!this.options.disabled){var i=this.options;this.selectees=t(i.filter,this.element[0]),this._trigger("start",e),t(i.appendTo).append(this.helper),this.helper.css({left:e.clientX,top:e.clientY,width:0,height:0}),i.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var i=t.data(this,"selectable-item");i.startselected=!0,e.metaKey||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,n._trigger("unselecting",e,{unselecting:i.element}))}),t(e.target).parents().andSelf().each(function(){var i=t.data(this,"selectable-item");if(i){var r=!e.metaKey||!i.$element.hasClass("ui-selected");return i.$element.removeClass(r?"ui-unselecting":"ui-selected").addClass(r?"ui-selecting":"ui-unselecting"),i.unselecting=!r,i.selecting=r,(i.selected=r)?n._trigger("selecting",e,{selecting:i.element}):n._trigger("unselecting",e,{unselecting:i.element}),!1}})}},_mouseDrag:function(e){var n=this;if(this.dragged=!0,!this.options.disabled){var i=this.options,r=this.opos[0],a=this.opos[1],o=e.pageX,s=e.pageY;if(r>o){var l=o;o=r,r=l}return a>s&&(l=s,s=a,a=l),this.helper.css({left:r,top:a,width:o-r,height:s-a}),this.selectees.each(function(){var l=t.data(this,"selectable-item");if(l&&l.element!=n.element[0]){var c=!1;"touch"==i.tolerance?c=!(l.left>o||r>l.right||l.top>s||a>l.bottom):"fit"==i.tolerance&&(c=l.left>r&&o>l.right&&l.top>a&&s>l.bottom),c?(l.selected&&(l.$element.removeClass("ui-selected"),l.selected=!1),l.unselecting&&(l.$element.removeClass("ui-unselecting"),l.unselecting=!1),l.selecting||(l.$element.addClass("ui-selecting"),l.selecting=!0,n._trigger("selecting",e,{selecting:l.element}))):(l.selecting&&(e.metaKey&&l.startselected?(l.$element.removeClass("ui-selecting"),l.selecting=!1,l.$element.addClass("ui-selected"),l.selected=!0):(l.$element.removeClass("ui-selecting"),l.selecting=!1,l.startselected&&(l.$element.addClass("ui-unselecting"),l.unselecting=!0),n._trigger("unselecting",e,{unselecting:l.element}))),l.selected&&(e.metaKey||l.startselected||(l.$element.removeClass("ui-selected"),l.selected=!1,l.$element.addClass("ui-unselecting"),l.unselecting=!0,n._trigger("unselecting",e,{unselecting:l.element}))))}}),!1}},_mouseStop:function(e){var n=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var i=t.data(this,"selectable-item");i.$element.removeClass("ui-unselecting"),i.unselecting=!1,i.startselected=!1,n._trigger("unselected",e,{unselected:i.element})}),t(".ui-selecting",this.element[0]).each(function(){var i=t.data(this,"selectable-item");i.$element.removeClass("ui-selecting").addClass("ui-selected"),i.selecting=!1,i.selected=!0,i.startselected=!0,n._trigger("selected",e,{selected:i.element})}),this._trigger("stop",e),this.helper.remove(),!1}}),t.extend(t.ui.selectable,{version:"1.8.16"})}(jQuery),function(t){t.widget("ui.sortable",t.ui.mouse,{widgetEventPrefix:"sort",options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var t=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===t.axis||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit()},destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").removeData("sortable").unbind(".sortable"),this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData("sortable-item");return this},_setOption:function(e,n){"disabled"===e?(this.options[e]=n,this.widget()[n?"addClass":"removeClass"]("ui-sortable-disabled")):t.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(e,n){if(this.reverting)return!1;if(this.options.disabled||"static"==this.options.type)return!1;this._refreshItems(e);var i=null,r=this;if(t(e.target).parents().each(function(){return t.data(this,"sortable-item")==r?(i=t(this),!1):void 0}),t.data(e.target,"sortable-item")==r&&(i=t(e.target)),!i)return!1;if(this.options.handle&&!n){var a=!1;if(t(this.options.handle,i).find("*").andSelf().each(function(){this==e.target&&(a=!0)}),!a)return!1}return this.currentItem=i,this._removeCurrentsFromItems(),!0},_mouseStart:function(e,n,i){n=this.options;var r=this;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),n.containment&&this._setContainment(),n.cursor&&(t("body").css("cursor")&&(this._storedCursor=t("body").css("cursor")),t("body").css("cursor",n.cursor)),n.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",n.opacity)),n.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",n.zIndex)),this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!i)for(i=this.containers.length-1;i>=0;i--)this.containers[i]._trigger("activate",e,r._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){if(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll){var n=this.options,i=!1;this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<n.scrollSensitivity?this.scrollParent[0].scrollTop=i=this.scrollParent[0].scrollTop+n.scrollSpeed:e.pageY-this.overflowOffset.top<n.scrollSensitivity&&(this.scrollParent[0].scrollTop=i=this.scrollParent[0].scrollTop-n.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<n.scrollSensitivity?this.scrollParent[0].scrollLeft=i=this.scrollParent[0].scrollLeft+n.scrollSpeed:e.pageX-this.overflowOffset.left<n.scrollSensitivity&&(this.scrollParent[0].scrollLeft=i=this.scrollParent[0].scrollLeft-n.scrollSpeed)):(e.pageY-t(document).scrollTop()<n.scrollSensitivity?i=t(document).scrollTop(t(document).scrollTop()-n.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<n.scrollSensitivity&&(i=t(document).scrollTop(t(document).scrollTop()+n.scrollSpeed)),e.pageX-t(document).scrollLeft()<n.scrollSensitivity?i=t(document).scrollLeft(t(document).scrollLeft()-n.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<n.scrollSensitivity&&(i=t(document).scrollLeft(t(document).scrollLeft()+n.scrollSpeed))),i!==!1&&t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)
}for(this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px"),n=this.items.length-1;n>=0;n--){i=this.items[n];var r=i.item[0],a=this._intersectsWithPointer(i);if(a&&r!=this.currentItem[0]&&this.placeholder[1==a?"next":"prev"]()[0]!=r&&!t.ui.contains(this.placeholder[0],r)&&("semi-dynamic"==this.options.type?!t.ui.contains(this.element[0],r):!0)){if(this.direction=1==a?"down":"up","pointer"!=this.options.tolerance&&!this._intersectsWithSides(i))break;this._rearrange(e,i),this._trigger("change",e,this._uiHash());break}}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,n){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var i=this;n=i.placeholder.offset(),i.reverting=!0,t(this.helper).animate({left:n.left-this.offset.parent.left-i.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:n.top-this.offset.parent.top-i.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){i._clear(e)})}else this._clear(e,n);return!1}},cancel:function(){var e=this;if(this.dragging){this._mouseUp({target:null}),"original"==this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("deactivate",null,e._uiHash(this)),this.containers[n].containerCache.over&&(this.containers[n]._trigger("out",null,e._uiHash(this)),this.containers[n].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!=this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var n=this._getItemsAsjQuery(e&&e.connected),i=[];return e=e||{},t(n).each(function(){var n=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[-=_](.+)/);n&&i.push((e.key||n[1]+"[]")+"="+(e.key&&e.expression?n[1]:n[2]))}),!i.length&&e.key&&i.push(e.key+"="),i.join("&")},toArray:function(e){var n=this._getItemsAsjQuery(e&&e.connected),i=[];return e=e||{},n.each(function(){i.push(t(e.item||this).attr(e.attribute||"id")||"")}),i},_intersectsWith:function(t){var e=this.positionAbs.left,n=e+this.helperProportions.width,i=this.positionAbs.top,r=i+this.helperProportions.height,a=t.left,o=a+t.width,s=t.top,l=s+t.height,c=this.offset.click.top,u=this.offset.click.left;return c=i+c>s&&l>i+c&&e+u>a&&o>e+u,"pointer"==this.options.tolerance||this.options.forcePointerForContainers||"pointer"!=this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?c:e+this.helperProportions.width/2>a&&o>n-this.helperProportions.width/2&&i+this.helperProportions.height/2>s&&l>r-this.helperProportions.height/2},_intersectsWithPointer:function(e){var n=t.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height);e=t.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),n=n&&e,e=this._getDragVerticalDirection();var i=this._getDragHorizontalDirection();return n?this.floating?i&&"right"==i||"down"==e?2:1:e&&("down"==e?2:1):!1},_intersectsWithSides:function(e){var n=t.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height);e=t.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width);var i=this._getDragVerticalDirection(),r=this._getDragHorizontalDirection();return this.floating&&r?"right"==r&&e||"left"==r&&!e:i&&("down"==i&&n||"up"==i&&!n)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!=t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!=t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor==String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){var n=[],i=[],r=this._connectWith();if(r&&e)for(e=r.length-1;e>=0;e--)for(var a=t(r[e]),o=a.length-1;o>=0;o--){var s=t.data(a[o],"sortable");s&&s!=this&&!s.options.disabled&&i.push([t.isFunction(s.options.items)?s.options.items.call(s.element):t(s.options.items,s.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),s])}for(i.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),e=i.length-1;e>=0;e--)i[e][0].each(function(){n.push(this)});return t(n)},_removeCurrentsFromItems:function(){for(var t=this.currentItem.find(":data(sortable-item)"),e=0;this.items.length>e;e++)for(var n=0;t.length>n;n++)t[n]==this.items[e].item[0]&&this.items.splice(e,1)},_refreshItems:function(e){this.items=[],this.containers=[this];var n=this.items,i=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],r=this._connectWith();if(r)for(var a=r.length-1;a>=0;a--)for(var o=t(r[a]),s=o.length-1;s>=0;s--){var l=t.data(o[s],"sortable");l&&l!=this&&!l.options.disabled&&(i.push([t.isFunction(l.options.items)?l.options.items.call(l.element[0],e,{item:this.currentItem}):t(l.options.items,l.element),l]),this.containers.push(l))}for(a=i.length-1;a>=0;a--)for(e=i[a][1],r=i[a][0],s=0,o=r.length;o>s;s++)l=t(r[s]),l.data("sortable-item",e),n.push({item:l,instance:e,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var n=this.items.length-1;n>=0;n--){var i=this.items[n];if(i.instance==this.currentContainer||!this.currentContainer||i.item[0]==this.currentItem[0]){var r=this.options.toleranceElement?t(this.options.toleranceElement,i.item):i.item;e||(i.width=r.outerWidth(),i.height=r.outerHeight()),r=r.offset(),i.left=r.left,i.top=r.top}}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(n=this.containers.length-1;n>=0;n--)r=this.containers[n].element.offset(),this.containers[n].containerCache.left=r.left,this.containers[n].containerCache.top=r.top,this.containers[n].containerCache.width=this.containers[n].element.outerWidth(),this.containers[n].containerCache.height=this.containers[n].element.outerHeight();return this},_createPlaceholder:function(e){var n=e||this,i=n.options;if(!i.placeholder||i.placeholder.constructor==String){var r=i.placeholder;i.placeholder={element:function(){var e=t(document.createElement(n.currentItem[0].nodeName)).addClass(r||n.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return r||(e.style.visibility="hidden"),e},update:function(t,e){(!r||i.forcePlaceholderSize)&&(e.height()||e.height(n.currentItem.innerHeight()-parseInt(n.currentItem.css("paddingTop")||0,10)-parseInt(n.currentItem.css("paddingBottom")||0,10)),e.width()||e.width(n.currentItem.innerWidth()-parseInt(n.currentItem.css("paddingLeft")||0,10)-parseInt(n.currentItem.css("paddingRight")||0,10)))}}}n.placeholder=t(i.placeholder.element.call(n.element,n.currentItem)),n.currentItem.after(n.placeholder),i.placeholder.update(n,n.placeholder)},_contactContainers:function(e){for(var n=null,i=null,r=this.containers.length-1;r>=0;r--)t.ui.contains(this.currentItem[0],this.containers[r].element[0])||(this._intersectsWith(this.containers[r].containerCache)?n&&t.ui.contains(this.containers[r].element[0],n.element[0])||(n=this.containers[r],i=r):this.containers[r].containerCache.over&&(this.containers[r]._trigger("out",e,this._uiHash(this)),this.containers[r].containerCache.over=0));if(n)if(1===this.containers.length)this.containers[i]._trigger("over",e,this._uiHash(this)),this.containers[i].containerCache.over=1;else if(this.currentContainer!=this.containers[i]){n=1e4,r=null;for(var a=this.positionAbs[this.containers[i].floating?"left":"top"],o=this.items.length-1;o>=0;o--)if(t.ui.contains(this.containers[i].element[0],this.items[o].item[0])){var s=this.items[o][this.containers[i].floating?"left":"top"];n>Math.abs(s-a)&&(n=Math.abs(s-a),r=this.items[o])}(r||this.options.dropOnEmpty)&&(this.currentContainer=this.containers[i],r?this._rearrange(e,r,null,!0):this._rearrange(e,null,this.containers[i].element,!0),this._trigger("change",e,this._uiHash()),this.containers[i]._trigger("change",e,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[i]._trigger("over",e,this._uiHash(this)),this.containers[i].containerCache.over=1)}},_createHelper:function(e){var n=this.options;return e=t.isFunction(n.helper)?t(n.helper.apply(this.element[0],[e,this.currentItem])):"clone"==n.helper?this.currentItem.clone():this.currentItem,e.parents("body").length||t("parent"!=n.appendTo?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(e[0]),e[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(""==e[0].style.width||n.forceHelperSize)&&e.width(this.currentItem.width()),(""==e[0].style.height||n.forceHelperSize)&&e.height(this.currentItem.height()),e},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&t.browser.msie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e=this.options;if("parent"==e.containment&&(e.containment=this.helper[0].parentNode),("document"==e.containment||"window"==e.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,t("document"==e.containment?document:window).width()-this.helperProportions.width-this.margins.left,(t("document"==e.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),!/^(document|window|parent)$/.test(e.containment)){var n=t(e.containment)[0];e=t(e.containment).offset();var i="hidden"!=t(n).css("overflow");this.containment=[e.left+(parseInt(t(n).css("borderLeftWidth"),10)||0)+(parseInt(t(n).css("paddingLeft"),10)||0)-this.margins.left,e.top+(parseInt(t(n).css("borderTopWidth"),10)||0)+(parseInt(t(n).css("paddingTop"),10)||0)-this.margins.top,e.left+(i?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(t(n).css("borderLeftWidth"),10)||0)-(parseInt(t(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,e.top+(i?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(t(n).css("borderTopWidth"),10)||0)-(parseInt(t(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(e,n){n||(n=this.position),e="absolute"==e?1:-1;var i="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,r=/(html|body)/i.test(i[0].tagName);return{top:n.top+this.offset.relative.top*e+this.offset.parent.top*e-(t.browser.safari&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollTop():r?0:i.scrollTop())*e),left:n.left+this.offset.relative.left*e+this.offset.parent.left*e-(t.browser.safari&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():r?0:i.scrollLeft())*e)}},_generatePosition:function(e){var n=this.options,i="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,r=/(html|body)/i.test(i[0].tagName);"relative"!=this.cssPosition||this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset());var a=e.pageX,o=e.pageY;return this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(a=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(a=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),n.grid&&(o=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1],o=this.containment?o-this.offset.click.top<this.containment[1]||o-this.offset.click.top>this.containment[3]?o-this.offset.click.top<this.containment[1]?o+n.grid[1]:o-n.grid[1]:o:o,a=this.originalPageX+Math.round((a-this.originalPageX)/n.grid[0])*n.grid[0],a=this.containment?a-this.offset.click.left<this.containment[0]||a-this.offset.click.left>this.containment[2]?a-this.offset.click.left<this.containment[0]?a+n.grid[0]:a-n.grid[0]:a:a)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(t.browser.safari&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollTop():r?0:i.scrollTop()),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(t.browser.safari&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollLeft():r?0:i.scrollLeft())}},_rearrange:function(t,e,n,i){n?n[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"==this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var r=this,a=this.counter;window.setTimeout(function(){a==r.counter&&r.refreshPositions(!i)},0)},_clear:function(e,n){this.reverting=!1;var i=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]==this.currentItem[0]){for(var r in this._storedCSS)("auto"==this._storedCSS[r]||"static"==this._storedCSS[r])&&(this._storedCSS[r]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();if(this.fromOutside&&!n&&i.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev==this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent==this.currentItem.parent()[0]||n||i.push(function(t){this._trigger("update",t,this._uiHash())}),!t.ui.contains(this.element[0],this.currentItem[0]))for(n||i.push(function(t){this._trigger("remove",t,this._uiHash())}),r=this.containers.length-1;r>=0;r--)t.ui.contains(this.containers[r].element[0],this.currentItem[0])&&!n&&(i.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.containers[r])),i.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.containers[r])));for(r=this.containers.length-1;r>=0;r--)n||i.push(function(t){return function(e){t._trigger("deactivate",e,this._uiHash(this))}}.call(this,this.containers[r])),this.containers[r].containerCache.over&&(i.push(function(t){return function(e){t._trigger("out",e,this._uiHash(this))}}.call(this,this.containers[r])),this.containers[r].containerCache.over=0);if(this._storedCursor&&t("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"==this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!n){for(this._trigger("beforeStop",e,this._uiHash()),r=0;i.length>r;r++)i[r].call(this,e);this._trigger("stop",e,this._uiHash())}return!1}if(n||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null,!n){for(r=0;i.length>r;r++)i[r].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var n=e||this;return{helper:n.helper,placeholder:n.placeholder||t([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:e?e.element:null}}}),t.extend(t.ui.sortable,{version:"1.8.16"})}(jQuery),function(t){t.widget("ui.accordion",{options:{active:0,animated:"slide",autoHeight:!0,clearStyle:!1,collapsible:!1,event:"click",fillSpace:!1,header:"> li > :first-child,> :not(li):even",icons:{header:"ui-icon-triangle-1-e",headerSelected:"ui-icon-triangle-1-s"},navigation:!1,navigationFilter:function(){return this.href.toLowerCase()===location.href.toLowerCase()}},_create:function(){var e=this,n=e.options;if(e.running=0,e.element.addClass("ui-accordion ui-widget ui-helper-reset").children("li").addClass("ui-accordion-li-fix"),e.headers=e.element.find(n.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all").bind("mouseenter.accordion",function(){n.disabled||t(this).addClass("ui-state-hover")}).bind("mouseleave.accordion",function(){n.disabled||t(this).removeClass("ui-state-hover")}).bind("focus.accordion",function(){n.disabled||t(this).addClass("ui-state-focus")}).bind("blur.accordion",function(){n.disabled||t(this).removeClass("ui-state-focus")}),e.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom"),n.navigation){var i=e.element.find("a").filter(n.navigationFilter).eq(0);if(i.length){var r=i.closest(".ui-accordion-header");e.active=r.length?r:i.closest(".ui-accordion-content").prev()}}e.active=e._findActive(e.active||n.active).addClass("ui-state-default ui-state-active").toggleClass("ui-corner-all").toggleClass("ui-corner-top"),e.active.next().addClass("ui-accordion-content-active"),e._createIcons(),e.resize(),e.element.attr("role","tablist"),e.headers.attr("role","tab").bind("keydown.accordion",function(t){return e._keydown(t)}).next().attr("role","tabpanel"),e.headers.not(e.active||"").attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).next().hide(),e.active.length?e.active.attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}):e.headers.eq(0).attr("tabIndex",0),t.browser.safari||e.headers.find("a").attr("tabIndex",-1),n.event&&e.headers.bind(n.event.split(" ").join(".accordion ")+".accordion",function(t){e._clickHandler.call(e,t,this),t.preventDefault()})},_createIcons:function(){var e=this.options;e.icons&&(t("<span></span>").addClass("ui-icon "+e.icons.header).prependTo(this.headers),this.active.children(".ui-icon").toggleClass(e.icons.header).toggleClass(e.icons.headerSelected),this.element.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.children(".ui-icon").remove(),this.element.removeClass("ui-accordion-icons")},destroy:function(){var e=this.options;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.unbind(".accordion").removeClass("ui-accordion-header ui-accordion-disabled ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("tabIndex"),this.headers.find("a").removeAttr("tabIndex"),this._destroyIcons();var n=this.headers.next().css("display","").removeAttr("role").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-accordion-disabled ui-state-disabled");return(e.autoHeight||e.fillHeight)&&n.css("height",""),t.Widget.prototype.destroy.call(this)},_setOption:function(e,n){t.Widget.prototype._setOption.apply(this,arguments),"active"==e&&this.activate(n),"icons"==e&&(this._destroyIcons(),n&&this._createIcons()),"disabled"==e&&this.headers.add(this.headers.next())[n?"addClass":"removeClass"]("ui-accordion-disabled ui-state-disabled")},_keydown:function(e){if(!(this.options.disabled||e.altKey||e.ctrlKey)){var n=t.ui.keyCode,i=this.headers.length,r=this.headers.index(e.target),a=!1;switch(e.keyCode){case n.RIGHT:case n.DOWN:a=this.headers[(r+1)%i];break;case n.LEFT:case n.UP:a=this.headers[(r-1+i)%i];break;case n.SPACE:case n.ENTER:this._clickHandler({target:e.target},e.target),e.preventDefault()}return a?(t(e.target).attr("tabIndex",-1),t(a).attr("tabIndex",0),a.focus(),!1):!0}},resize:function(){var e,n=this.options;if(n.fillSpace){if(t.browser.msie){var i=this.element.parent().css("overflow");this.element.parent().css("overflow","hidden")}e=this.element.parent().height(),t.browser.msie&&this.element.parent().css("overflow",i),this.headers.each(function(){e-=t(this).outerHeight(!0)}),this.headers.next().each(function(){t(this).height(Math.max(0,e-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")}else n.autoHeight&&(e=0,this.headers.next().each(function(){e=Math.max(e,t(this).height("").height())}).height(e));return this},activate:function(t){return this.options.active=t,t=this._findActive(t)[0],this._clickHandler({target:t},t),this},_findActive:function(e){return e?"number"==typeof e?this.headers.filter(":eq("+e+")"):this.headers.not(this.headers.not(e)):e===!1?t([]):this.headers.filter(":eq(0)")},_clickHandler:function(e,n){var i=this.options;if(!i.disabled)if(e.target){if(e=t(e.currentTarget||n),n=e[0]===this.active[0],i.active=i.collapsible&&n?!1:this.headers.index(e),!(this.running||!i.collapsible&&n)){var r=this.active;l=e.next(),o=this.active.next(),s={options:i,newHeader:n&&i.collapsible?t([]):e,oldHeader:this.active,newContent:n&&i.collapsible?t([]):l,oldContent:o};var a=this.headers.index(this.active[0])>this.headers.index(e[0]);this.active=n?t([]):e,this._toggle(l,o,s,n,a),r.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(i.icons.headerSelected).addClass(i.icons.header),n||(e.removeClass("ui-state-default ui-corner-all").addClass("ui-state-active ui-corner-top").children(".ui-icon").removeClass(i.icons.header).addClass(i.icons.headerSelected),e.next().addClass("ui-accordion-content-active"))}}else if(i.collapsible){this.active.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(i.icons.headerSelected).addClass(i.icons.header),this.active.next().addClass("ui-accordion-content-active");var o=this.active.next(),s={options:i,newHeader:t([]),oldHeader:i.active,newContent:t([]),oldContent:o},l=this.active=t([]);this._toggle(l,o,s)}},_toggle:function(e,n,i,r,a){var o=this,s=o.options;o.toShow=e,o.toHide=n,o.data=i;var l=function(){return o?o._completed.apply(o,arguments):void 0};if(o._trigger("changestart",null,o.data),o.running=0===n.size()?e.size():n.size(),s.animated){i={},i=s.collapsible&&r?{toShow:t([]),toHide:n,complete:l,down:a,autoHeight:s.autoHeight||s.fillSpace}:{toShow:e,toHide:n,complete:l,down:a,autoHeight:s.autoHeight||s.fillSpace},s.proxied||(s.proxied=s.animated),s.proxiedDuration||(s.proxiedDuration=s.duration),s.animated=t.isFunction(s.proxied)?s.proxied(i):s.proxied,s.duration=t.isFunction(s.proxiedDuration)?s.proxiedDuration(i):s.proxiedDuration,r=t.ui.accordion.animations;var c=s.duration,u=s.animated;!u||r[u]||t.easing[u]||(u="slide"),r[u]||(r[u]=function(t){this.slide(t,{easing:u,duration:c||700})}),r[u](i)}else s.collapsible&&r?e.toggle():(n.hide(),e.show()),l(!0);n.prev().attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).blur(),e.prev().attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}).focus()},_completed:function(t){this.running=t?0:--this.running,this.running||(this.options.clearStyle&&this.toShow.add(this.toHide).css({height:"",overflow:""}),this.toHide.removeClass("ui-accordion-content-active"),this.toHide.length&&(this.toHide.parent()[0].className=this.toHide.parent()[0].className),this._trigger("change",null,this.data))}}),t.extend(t.ui.accordion,{version:"1.8.16",animations:{slide:function(e,n){if(e=t.extend({easing:"swing",duration:300},e,n),e.toHide.size())if(e.toShow.size()){var i,r=e.toShow.css("overflow"),a=0,o={},s={};n=e.toShow,i=n[0].style.width,n.width(parseInt(n.parent().width(),10)-parseInt(n.css("paddingLeft"),10)-parseInt(n.css("paddingRight"),10)-(parseInt(n.css("borderLeftWidth"),10)||0)-(parseInt(n.css("borderRightWidth"),10)||0)),t.each(["height","paddingTop","paddingBottom"],function(n,i){s[i]="hide",n=(""+t.css(e.toShow[0],i)).match(/^([\d+-.]+)(.*)$/),o[i]={value:n[1],unit:n[2]||"px"}}),e.toShow.css({height:0,overflow:"hidden"}).show(),e.toHide.filter(":hidden").each(e.complete).end().filter(":visible").animate(s,{step:function(t,n){"height"==n.prop&&(a=0===n.end-n.start?0:(n.now-n.start)/(n.end-n.start)),e.toShow[0].style[n.prop]=a*o[n.prop].value+o[n.prop].unit},duration:e.duration,easing:e.easing,complete:function(){e.autoHeight||e.toShow.css("height",""),e.toShow.css({width:i,overflow:r}),e.complete()}})}else e.toHide.animate({height:"hide",paddingTop:"hide",paddingBottom:"hide"},e);else e.toShow.animate({height:"show",paddingTop:"show",paddingBottom:"show"},e)},bounceslide:function(t){this.slide(t,{easing:t.down?"easeOutBounce":"swing",duration:t.down?1e3:200})}}})}(jQuery),function(t){var e=0;t.widget("ui.autocomplete",{options:{appendTo:"body",autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null},pending:0,_create:function(){var e,n=this,i=this.element[0].ownerDocument;this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(i){if(!n.options.disabled&&!n.element.propAttr("readOnly")){e=!1;var r=t.ui.keyCode;switch(i.keyCode){case r.PAGE_UP:n._move("previousPage",i);break;case r.PAGE_DOWN:n._move("nextPage",i);break;case r.UP:n._move("previous",i),i.preventDefault();break;case r.DOWN:n._move("next",i),i.preventDefault();break;case r.ENTER:case r.NUMPAD_ENTER:n.menu.active&&(e=!0,i.preventDefault());case r.TAB:if(!n.menu.active)return;n.menu.select(i);break;case r.ESCAPE:n.element.val(n.term),n.close(i);break;default:clearTimeout(n.searching),n.searching=setTimeout(function(){n.term!=n.element.val()&&(n.selectedItem=null,n.search(null,i))},n.options.delay)}}}).bind("keypress.autocomplete",function(t){e&&(e=!1,t.preventDefault())}).bind("focus.autocomplete",function(){n.options.disabled||(n.selectedItem=null,n.previous=n.element.val())}).bind("blur.autocomplete",function(t){n.options.disabled||(clearTimeout(n.searching),n.closing=setTimeout(function(){n.close(t),n._change(t)},150))}),this._initSource(),this.response=function(){return n._response.apply(n,arguments)},this.menu=t("<ul></ul>").addClass("ui-autocomplete").appendTo(t(this.options.appendTo||"body",i)[0]).mousedown(function(e){var i=n.menu.element[0];t(e.target).closest(".ui-menu-item").length||setTimeout(function(){t(document).one("mousedown",function(e){e.target!==n.element[0]&&e.target!==i&&!t.ui.contains(i,e.target)&&n.close()})},1),setTimeout(function(){clearTimeout(n.closing)},13)}).menu({focus:function(t,e){e=e.item.data("item.autocomplete"),!1!==n._trigger("focus",t,{item:e})&&/^key/.test(t.originalEvent.type)&&n.element.val(e.value)},selected:function(t,e){var r=e.item.data("item.autocomplete"),a=n.previous;n.element[0]!==i.activeElement&&(n.element.focus(),n.previous=a,setTimeout(function(){n.previous=a,n.selectedItem=r},1)),!1!==n._trigger("select",t,{item:r})&&n.element.val(r.value),n.term=n.element.val(),n.close(t),n.selectedItem=r},blur:function(){n.menu.element.is(":visible")&&n.element.val()!==n.term&&n.element.val(n.term)}}).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("menu"),t.fn.bgiframe&&this.menu.element.bgiframe()},destroy:function(){this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup"),this.menu.element.remove(),t.Widget.prototype.destroy.call(this)},_setOption:function(e,n){t.Widget.prototype._setOption.apply(this,arguments),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(t(n||"body",this.element[0].ownerDocument)[0]),"disabled"===e&&n&&this.xhr&&this.xhr.abort()},_initSource:function(){var n,i,r=this;t.isArray(this.options.source)?(n=this.options.source,this.source=function(e,i){i(t.ui.autocomplete.filter(n,e.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(n,a){r.xhr&&r.xhr.abort(),r.xhr=t.ajax({url:i,data:n,dataType:"json",autocompleteRequest:++e,success:function(t){this.autocompleteRequest===e&&a(t)},error:function(){this.autocompleteRequest===e&&a([])}})}):this.source=this.options.source},search:function(t,e){return t=null!=t?t:this.element.val(),this.term=this.element.val(),t.length<this.options.minLength?this.close(e):(clearTimeout(this.closing),this._trigger("search",e)!==!1?this._search(t):void 0)},_search:function(t){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.source({term:t},this.response)},_response:function(t){!this.options.disabled&&t&&t.length?(t=this._normalize(t),this._suggest(t),this._trigger("open")):this.close(),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},close:function(t){clearTimeout(this.closing),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.deactivate(),this._trigger("close",t))},_change:function(t){this.previous!==this.element.val()&&this._trigger("change",t,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:t.map(e,function(e){return"string"==typeof e?{label:e,value:e}:t.extend({label:e.label||e.value,value:e.value||e.label},e)})},_suggest:function(e){var n=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(n,e),this.menu.deactivate(),this.menu.refresh(),n.show(),this._resizeMenu(),n.position(t.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(new t.Event("mouseover"))},_resizeMenu:function(){var t=this.menu.element;
t.outerWidth(Math.max(t.width("").outerWidth(),this.element.outerWidth()))},_renderMenu:function(e,n){var i=this;t.each(n,function(t,n){i._renderItem(e,n)})},_renderItem:function(e,n){return t("<li></li>").data("item.autocomplete",n).append(t("<a></a>").text(n.label)).appendTo(e)},_move:function(t,e){this.menu.element.is(":visible")?this.menu.first()&&/^previous/.test(t)||this.menu.last()&&/^next/.test(t)?(this.element.val(this.term),this.menu.deactivate()):this.menu[t](e):this.search(null,e)},widget:function(){return this.menu.element}}),t.extend(t.ui.autocomplete,{escapeRegex:function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},filter:function(e,n){var i=RegExp(t.ui.autocomplete.escapeRegex(n),"i");return t.grep(e,function(t){return i.test(t.label||t.value||t)})}})}(jQuery),function(t){t.widget("ui.menu",{_create:function(){var e=this;this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(n){t(n.target).closest(".ui-menu-item a").length&&(n.preventDefault(),e.select(n))}),this.refresh()},refresh:function(){var e=this;this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem").children("a").addClass("ui-corner-all").attr("tabindex",-1).mouseenter(function(n){e.activate(n,t(this).parent())}).mouseleave(function(){e.deactivate()})},activate:function(t,e){if(this.deactivate(),this.hasScroll()){var n=e.offset().top-this.element.offset().top,i=this.element.scrollTop(),r=this.element.height();0>n?this.element.scrollTop(i+n):n>=r&&this.element.scrollTop(i+n-r+e.height())}this.active=e.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end(),this._trigger("focus",t,{item:e})},deactivate:function(){this.active&&(this.active.children("a").removeClass("ui-state-hover").removeAttr("id"),this._trigger("blur"),this.active=null)},next:function(t){this.move("next",".ui-menu-item:first",t)},previous:function(t){this.move("prev",".ui-menu-item:last",t)},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},move:function(t,e,n){this.active?(t=this.active[t+"All"](".ui-menu-item").eq(0),t.length?this.activate(n,t):this.activate(n,this.element.children(e))):this.activate(n,this.element.children(e))},nextPage:function(e){if(this.hasScroll())if(!this.active||this.last())this.activate(e,this.element.children(".ui-menu-item:first"));else{var n=this.active.offset().top,i=this.element.height(),r=this.element.children(".ui-menu-item").filter(function(){var e=t(this).offset().top-n-i+t(this).height();return 10>e&&e>-10});r.length||(r=this.element.children(".ui-menu-item:last")),this.activate(e,r)}else this.activate(e,this.element.children(".ui-menu-item").filter(!this.active||this.last()?":first":":last"))},previousPage:function(e){if(this.hasScroll())if(!this.active||this.first())this.activate(e,this.element.children(".ui-menu-item:last"));else{var n=this.active.offset().top,i=this.element.height();result=this.element.children(".ui-menu-item").filter(function(){var e=t(this).offset().top-n+i-t(this).height();return 10>e&&e>-10}),result.length||(result=this.element.children(".ui-menu-item:first")),this.activate(e,result)}else this.activate(e,this.element.children(".ui-menu-item").filter(!this.active||this.first()?":last":":first"))},hasScroll:function(){return this.element.height()<this.element[t.fn.prop?"prop":"attr"]("scrollHeight")},select:function(t){this._trigger("selected",t,{item:this.active})}})}(jQuery),function(t){var e,n,i,r,a=function(){var e=t(this).find(":ui-button");setTimeout(function(){e.button("refresh")},1)},o=function(e){var n=e.name,i=e.form,r=t([]);return n&&(r=i?t(i).find("[name='"+n+"']"):t("[name='"+n+"']",e.ownerDocument).filter(function(){return!this.form})),r};t.widget("ui.button",{options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset.button").bind("reset.button",a),"boolean"!=typeof this.options.disabled&&(this.options.disabled=this.element.propAttr("disabled")),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var s=this,l=this.options,c="checkbox"===this.type||"radio"===this.type,u="ui-state-hover"+(c?"":" ui-state-active");null===l.label&&(l.label=this.buttonElement.html()),this.element.is(":disabled")&&(l.disabled=!0),this.buttonElement.addClass("ui-button ui-widget ui-state-default ui-corner-all").attr("role","button").bind("mouseenter.button",function(){l.disabled||(t(this).addClass("ui-state-hover"),this===e&&t(this).addClass("ui-state-active"))}).bind("mouseleave.button",function(){l.disabled||t(this).removeClass(u)}).bind("click.button",function(t){l.disabled&&(t.preventDefault(),t.stopImmediatePropagation())}),this.element.bind("focus.button",function(){s.buttonElement.addClass("ui-state-focus")}).bind("blur.button",function(){s.buttonElement.removeClass("ui-state-focus")}),c&&(this.element.bind("change.button",function(){r||s.refresh()}),this.buttonElement.bind("mousedown.button",function(t){l.disabled||(r=!1,n=t.pageX,i=t.pageY)}).bind("mouseup.button",function(t){l.disabled||(n!==t.pageX||i!==t.pageY)&&(r=!0)})),"checkbox"===this.type?this.buttonElement.bind("click.button",function(){return l.disabled||r?!1:(t(this).toggleClass("ui-state-active"),s.buttonElement.attr("aria-pressed",s.element[0].checked),void 0)}):"radio"===this.type?this.buttonElement.bind("click.button",function(){if(l.disabled||r)return!1;t(this).addClass("ui-state-active"),s.buttonElement.attr("aria-pressed","true");var e=s.element[0];o(e).not(e).map(function(){return t(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown.button",function(){return l.disabled?!1:(t(this).addClass("ui-state-active"),e=this,t(document).one("mouseup",function(){e=null}),void 0)}).bind("mouseup.button",function(){return l.disabled?!1:(t(this).removeClass("ui-state-active"),void 0)}).bind("keydown.button",function(e){return l.disabled?!1:((e.keyCode==t.ui.keyCode.SPACE||e.keyCode==t.ui.keyCode.ENTER)&&t(this).addClass("ui-state-active"),void 0)}).bind("keyup.button",function(){t(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(e){e.keyCode===t.ui.keyCode.SPACE&&t(this).click()})),this._setOption("disabled",l.disabled),this._resetButton()},_determineButtonType:function(){if(this.type=this.element.is(":checkbox")?"checkbox":this.element.is(":radio")?"radio":this.element.is("input")?"input":"button","checkbox"===this.type||"radio"===this.type){var t=this.element.parents().filter(":last"),e="label[for='"+this.element.attr("id")+"']";this.buttonElement=t.find(e),this.buttonElement.length||(t=t.length?t.siblings():this.element.siblings(),this.buttonElement=t.filter(e),this.buttonElement.length||(this.buttonElement=t.find(e))),this.element.addClass("ui-helper-hidden-accessible"),(t=this.element.is(":checked"))&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.attr("aria-pressed",t)}else this.buttonElement=this.element},widget:function(){return this.buttonElement},destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass("ui-button ui-widget ui-state-default ui-corner-all ui-state-hover ui-state-active  ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only").removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title"),t.Widget.prototype.destroy.call(this)},_setOption:function(e,n){t.Widget.prototype._setOption.apply(this,arguments),"disabled"===e?n?this.element.propAttr("disabled",!0):this.element.propAttr("disabled",!1):this._resetButton()},refresh:function(){var e=this.element.is(":disabled");e!==this.options.disabled&&this._setOption("disabled",e),"radio"===this.type?o(this.element[0]).each(function(){t(this).is(":checked")?t(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):t(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"===this.type)this.options.label&&this.element.val(this.options.label);else{var e=this.buttonElement.removeClass("ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only"),n=t("<span></span>").addClass("ui-button-text").html(this.options.label).appendTo(e.empty()).text(),i=this.options.icons,r=i.primary&&i.secondary,a=[];i.primary||i.secondary?(this.options.text&&a.push("ui-button-text-icon"+(r?"s":i.primary?"-primary":"-secondary")),i.primary&&e.prepend("<span class='ui-button-icon-primary ui-icon "+i.primary+"'></span>"),i.secondary&&e.append("<span class='ui-button-icon-secondary ui-icon "+i.secondary+"'></span>"),this.options.text||(a.push(r?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||e.attr("title",n))):a.push("ui-button-text-only"),e.addClass(a.join(" "))}}}),t.widget("ui.buttonset",{options:{items:":button, :submit, :reset, :checkbox, :radio, a, :data(button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(e,n){"disabled"===e&&this.buttons.button("option",e,n),t.Widget.prototype._setOption.apply(this,arguments)},refresh:function(){var e="ltr"===this.element.css("direction");this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return t(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(e?"ui-corner-left":"ui-corner-right").end().filter(":last").addClass(e?"ui-corner-right":"ui-corner-left").end().end()},destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return t(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy"),t.Widget.prototype.destroy.call(this)}})}(jQuery),function(t,e){var n={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},i={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},r=t.attrFn||{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0,click:!0};t.widget("ui.dialog",{options:{autoOpen:!0,buttons:{},closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:!1,maxWidth:!1,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",collision:"fit",using:function(e){var n=t(this).css(e).offset().top;0>n&&t(this).css("top",e.top-n)}},resizable:!0,show:null,stack:!0,title:"",width:300,zIndex:1e3},_create:function(){this.originalTitle=this.element.attr("title"),"string"!=typeof this.originalTitle&&(this.originalTitle=""),this.options.title=this.options.title||this.originalTitle;var e=this,n=e.options,i=n.title||"&#160;",r=t.ui.dialog.getTitleId(e.element),a=(e.uiDialog=t("<div></div>")).appendTo(document.body).hide().addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+n.dialogClass).css({zIndex:n.zIndex}).attr("tabIndex",-1).css("outline",0).keydown(function(i){n.closeOnEscape&&!i.isDefaultPrevented()&&i.keyCode&&i.keyCode===t.ui.keyCode.ESCAPE&&(e.close(i),i.preventDefault())}).attr({role:"dialog","aria-labelledby":r}).mousedown(function(t){e.moveToTop(!1,t)});e.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(a);var o=(e.uiDialogTitlebar=t("<div></div>")).addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(a),s=t('<a href="#"></a>').addClass("ui-dialog-titlebar-close ui-corner-all").attr("role","button").hover(function(){s.addClass("ui-state-hover")},function(){s.removeClass("ui-state-hover")}).focus(function(){s.addClass("ui-state-focus")}).blur(function(){s.removeClass("ui-state-focus")}).click(function(t){return e.close(t),!1}).appendTo(o);(e.uiDialogTitlebarCloseText=t("<span></span>")).addClass("ui-icon ui-icon-closethick").text(n.closeText).appendTo(s),t("<span></span>").addClass("ui-dialog-title").attr("id",r).html(i).prependTo(o),t.isFunction(n.beforeclose)&&!t.isFunction(n.beforeClose)&&(n.beforeClose=n.beforeclose),o.find("*").add(o).disableSelection(),n.draggable&&t.fn.draggable&&e._makeDraggable(),n.resizable&&t.fn.resizable&&e._makeResizable(),e._createButtons(n.buttons),e._isOpen=!1,t.fn.bgiframe&&a.bgiframe()},_init:function(){this.options.autoOpen&&this.open()},destroy:function(){var t=this;return t.overlay&&t.overlay.destroy(),t.uiDialog.hide(),t.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body"),t.uiDialog.remove(),t.originalTitle&&t.element.attr("title",t.originalTitle),t},widget:function(){return this.uiDialog},close:function(e){var n,i,r=this;return!1!==r._trigger("beforeClose",e)?(r.overlay&&r.overlay.destroy(),r.uiDialog.unbind("keypress.ui-dialog"),r._isOpen=!1,r.options.hide?r.uiDialog.hide(r.options.hide,function(){r._trigger("close",e)}):(r.uiDialog.hide(),r._trigger("close",e)),t.ui.dialog.overlay.resize(),r.options.modal&&(n=0,t(".ui-dialog").each(function(){this!==r.uiDialog[0]&&(i=t(this).css("z-index"),isNaN(i)||(n=Math.max(n,i)))}),t.ui.dialog.maxZ=n),r):void 0},isOpen:function(){return this._isOpen},moveToTop:function(e,n){var i=this,r=i.options;return r.modal&&!e||!r.stack&&!r.modal?i._trigger("focus",n):(r.zIndex>t.ui.dialog.maxZ&&(t.ui.dialog.maxZ=r.zIndex),i.overlay&&(t.ui.dialog.maxZ+=1,i.overlay.$el.css("z-index",t.ui.dialog.overlay.maxZ=t.ui.dialog.maxZ)),e={scrollTop:i.element.scrollTop(),scrollLeft:i.element.scrollLeft()},t.ui.dialog.maxZ+=1,i.uiDialog.css("z-index",t.ui.dialog.maxZ),i.element.attr(e),i._trigger("focus",n),i)},open:function(){if(!this._isOpen){var e=this,n=e.options,i=e.uiDialog;return e.overlay=n.modal?new t.ui.dialog.overlay(e):null,e._size(),e._position(n.position),i.show(n.show),e.moveToTop(!0),n.modal&&i.bind("keypress.ui-dialog",function(e){if(e.keyCode===t.ui.keyCode.TAB){var n=t(":tabbable",this),i=n.filter(":first");if(n=n.filter(":last"),e.target===n[0]&&!e.shiftKey)return i.focus(1),!1;if(e.target===i[0]&&e.shiftKey)return n.focus(1),!1}}),t(e.element.find(":tabbable").get().concat(i.find(".ui-dialog-buttonpane :tabbable").get().concat(i.get()))).eq(0).focus(),e._isOpen=!0,e._trigger("open"),e}},_createButtons:function(e){var n=this,i=!1,a=t("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),o=t("<div></div>").addClass("ui-dialog-buttonset").appendTo(a);n.uiDialog.find(".ui-dialog-buttonpane").remove(),"object"==typeof e&&null!==e&&t.each(e,function(){return!(i=!0)}),i&&(t.each(e,function(e,i){i=t.isFunction(i)?{click:i,text:e}:i;var a=t('<button type="button"></button>').click(function(){i.click.apply(n.element[0],arguments)}).appendTo(o);t.each(i,function(t,e){"click"!==t&&(t in r?a[t](e):a.attr(t,e))}),t.fn.button&&a.button()}),a.appendTo(n.uiDialog))},_makeDraggable:function(){function e(t){return{position:t.position,offset:t.offset}}var n,i=this,r=i.options,a=t(document);i.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(a,o){n="auto"===r.height?"auto":t(this).height(),t(this).height(t(this).height()).addClass("ui-dialog-dragging"),i._trigger("dragStart",a,e(o))},drag:function(t,n){i._trigger("drag",t,e(n))},stop:function(o,s){r.position=[s.position.left-a.scrollLeft(),s.position.top-a.scrollTop()],t(this).removeClass("ui-dialog-dragging").height(n),i._trigger("dragStop",o,e(s)),t.ui.dialog.overlay.resize()}})},_makeResizable:function(n){function i(t){return{originalPosition:t.originalPosition,originalSize:t.originalSize,position:t.position,size:t.size}}n=n===e?this.options.resizable:n;var r=this,a=r.options,o=r.uiDialog.css("position");n="string"==typeof n?n:"n,e,s,w,se,sw,ne,nw",r.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:r.element,maxWidth:a.maxWidth,maxHeight:a.maxHeight,minWidth:a.minWidth,minHeight:r._minHeight(),handles:n,start:function(e,n){t(this).addClass("ui-dialog-resizing"),r._trigger("resizeStart",e,i(n))},resize:function(t,e){r._trigger("resize",t,i(e))},stop:function(e,n){t(this).removeClass("ui-dialog-resizing"),a.height=t(this).height(),a.width=t(this).width(),r._trigger("resizeStop",e,i(n)),t.ui.dialog.overlay.resize()}}).css("position",o).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var t=this.options;return"auto"===t.height?t.minHeight:Math.min(t.minHeight,t.height)},_position:function(e){var n,i=[],r=[0,0];e?(("string"==typeof e||"object"==typeof e&&"0"in e)&&(i=e.split?e.split(" "):[e[0],e[1]],1===i.length&&(i[1]=i[0]),t.each(["left","top"],function(t,e){+i[t]===i[t]&&(r[t]=i[t],i[t]=e)}),e={my:i.join(" "),at:i.join(" "),offset:r.join(" ")}),e=t.extend({},t.ui.dialog.prototype.options.position,e)):e=t.ui.dialog.prototype.options.position,(n=this.uiDialog.is(":visible"))||this.uiDialog.show(),this.uiDialog.css({top:0,left:0}).position(t.extend({of:window},e)),n||this.uiDialog.hide()},_setOptions:function(e){var r=this,a={},o=!1;t.each(e,function(t,e){r._setOption(t,e),t in n&&(o=!0),t in i&&(a[t]=e)}),o&&this._size(),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",a)},_setOption:function(e,n){var i=this,r=i.uiDialog;switch(e){case"beforeclose":e="beforeClose";break;case"buttons":i._createButtons(n);break;case"closeText":i.uiDialogTitlebarCloseText.text(""+n);break;case"dialogClass":r.removeClass(i.options.dialogClass).addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+n);break;case"disabled":n?r.addClass("ui-dialog-disabled"):r.removeClass("ui-dialog-disabled");break;case"draggable":var a=r.is(":data(draggable)");a&&!n&&r.draggable("destroy"),!a&&n&&i._makeDraggable();break;case"position":i._position(n);break;case"resizable":(a=r.is(":data(resizable)"))&&!n&&r.resizable("destroy"),a&&"string"==typeof n&&r.resizable("option","handles",n),!a&&n!==!1&&i._makeResizable(n);break;case"title":t(".ui-dialog-title",i.uiDialogTitlebar).html(""+(n||"&#160;"))}t.Widget.prototype._setOption.apply(i,arguments)},_size:function(){var e,n,i=this.options,r=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0}),i.minWidth>i.width&&(i.width=i.minWidth),e=this.uiDialog.css({height:"auto",width:i.width}).height(),n=Math.max(0,i.minHeight-e),"auto"===i.height?t.support.minHeight?this.element.css({minHeight:n,height:"auto"}):(this.uiDialog.show(),i=this.element.css("height","auto").height(),r||this.uiDialog.hide(),this.element.height(Math.max(i,n))):this.element.height(Math.max(i.height-e,0)),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())}}),t.extend(t.ui.dialog,{version:"1.8.16",uuid:0,maxZ:0,getTitleId:function(t){return t=t.attr("id"),t||(this.uuid+=1,t=this.uuid),"ui-dialog-title-"+t},overlay:function(e){this.$el=t.ui.dialog.overlay.create(e)}}),t.extend(t.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:t.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(t){return t+".dialog-overlay"}).join(" "),create:function(e){0===this.instances.length&&(setTimeout(function(){t.ui.dialog.overlay.instances.length&&t(document).bind(t.ui.dialog.overlay.events,function(e){return t(e.target).zIndex()<t.ui.dialog.overlay.maxZ?!1:void 0})},1),t(document).bind("keydown.dialog-overlay",function(n){e.options.closeOnEscape&&!n.isDefaultPrevented()&&n.keyCode&&n.keyCode===t.ui.keyCode.ESCAPE&&(e.close(n),n.preventDefault())}),t(window).bind("resize.dialog-overlay",t.ui.dialog.overlay.resize));var n=(this.oldInstances.pop()||t("<div></div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),height:this.height()});return t.fn.bgiframe&&n.bgiframe(),this.instances.push(n),n},destroy:function(e){var n=t.inArray(e,this.instances);-1!=n&&this.oldInstances.push(this.instances.splice(n,1)[0]),0===this.instances.length&&t([document,window]).unbind(".dialog-overlay"),e.remove();var i=0;t.each(this.instances,function(){i=Math.max(i,this.css("z-index"))}),this.maxZ=i},height:function(){var e,n;return t.browser.msie&&7>t.browser.version?(e=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),n=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight),n>e?t(window).height()+"px":e+"px"):t(document).height()+"px"},width:function(){var e,n;return t.browser.msie?(e=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),n=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth),n>e?t(window).width()+"px":e+"px"):t(document).width()+"px"},resize:function(){var e=t([]);t.each(t.ui.dialog.overlay.instances,function(){e=e.add(this)}),e.css({width:0,height:0}).css({width:t.ui.dialog.overlay.width(),height:t.ui.dialog.overlay.height()})}}),t.extend(t.ui.dialog.overlay.prototype,{destroy:function(){t.ui.dialog.overlay.destroy(this.$el)}})}(jQuery),function(t){t.widget("ui.slider",t.ui.mouse,{widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var e=this,n=this.options,i=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),r=n.values&&n.values.length||1,a=[];this._mouseSliding=this._keySliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"+(n.disabled?" ui-slider-disabled ui-disabled":"")),this.range=t([]),n.range&&(n.range===!0&&(n.values||(n.values=[this._valueMin(),this._valueMin()]),n.values.length&&2!==n.values.length&&(n.values=[n.values[0],n.values[0]])),this.range=t("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+("min"===n.range||"max"===n.range?" ui-slider-range-"+n.range:"")));for(var o=i.length;r>o;o+=1)a.push("<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>");this.handles=i.add(t(a.join("")).appendTo(e.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(t){t.preventDefault()}).hover(function(){n.disabled||t(this).addClass("ui-state-hover")},function(){t(this).removeClass("ui-state-hover")}).focus(function(){n.disabled?t(this).blur():(t(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),t(this).addClass("ui-state-focus"))}).blur(function(){t(this).removeClass("ui-state-focus")}),this.handles.each(function(e){t(this).data("index.ui-slider-handle",e)}),this.handles.keydown(function(n){var i,r,a,o=!0,s=t(this).data("index.ui-slider-handle");if(!e.options.disabled){switch(n.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(o=!1,!e._keySliding&&(e._keySliding=!0,t(this).addClass("ui-state-active"),i=e._start(n,s),i===!1))return}switch(a=e.options.step,i=r=e.options.values&&e.options.values.length?e.values(s):e.value(),n.keyCode){case t.ui.keyCode.HOME:r=e._valueMin();break;case t.ui.keyCode.END:r=e._valueMax();break;case t.ui.keyCode.PAGE_UP:r=e._trimAlignValue(i+(e._valueMax()-e._valueMin())/5);break;case t.ui.keyCode.PAGE_DOWN:r=e._trimAlignValue(i-(e._valueMax()-e._valueMin())/5);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(i===e._valueMax())return;r=e._trimAlignValue(i+a);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(i===e._valueMin())return;r=e._trimAlignValue(i-a)}return e._slide(n,s,r),o}}).keyup(function(n){var i=t(this).data("index.ui-slider-handle");e._keySliding&&(e._keySliding=!1,e._stop(n,i),e._change(n,i),t(this).removeClass("ui-state-active"))}),this._refreshValue(),this._animateOff=!1},destroy:function(){return this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider"),this._mouseDestroy(),this},_mouseCapture:function(e){var n,i,r,a,o,s=this.options;return s.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),n=this._normValueFromMouse({x:e.pageX,y:e.pageY}),i=this._valueMax()-this._valueMin()+1,a=this,this.handles.each(function(e){var s=Math.abs(n-a.values(e));i>s&&(i=s,r=t(this),o=e)}),s.range===!0&&this.values(1)===s.min&&(o+=1,r=t(this.handles[o])),this._start(e,o)===!1?!1:(this._mouseSliding=!0,a._handleIndex=o,r.addClass("ui-state-active").focus(),s=r.offset(),this._clickOffset=t(e.target).parents().andSelf().is(".ui-slider-handle")?{left:e.pageX-s.left-r.width()/2,top:e.pageY-s.top-r.height()/2-(parseInt(r.css("borderTopWidth"),10)||0)-(parseInt(r.css("borderBottomWidth"),10)||0)+(parseInt(r.css("marginTop"),10)||0)}:{left:0,top:0},this.handles.hasClass("ui-state-hover")||this._slide(e,o,n),this._animateOff=!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e=this._normValueFromMouse({x:t.pageX,y:t.pageY});return this._slide(t,this._handleIndex,e),!1},_mouseStop:function(t){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._clickOffset=this._handleIndex=null,this._animateOff=!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e;return"horizontal"===this.orientation?(e=this.elementSize.width,t=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,t=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),e=t/e,e>1&&(e=1),0>e&&(e=0),"vertical"===this.orientation&&(e=1-e),t=this._valueMax()-this._valueMin(),this._trimAlignValue(this._valueMin()+e*t)},_start:function(t,e){var n={handle:this.handles[e],value:this.value()};return this.options.values&&this.options.values.length&&(n.value=this.values(e),n.values=this.values()),this._trigger("start",t,n)},_slide:function(t,e,n){var i;this.options.values&&this.options.values.length?(i=this.values(e?0:1),2===this.options.values.length&&this.options.range===!0&&(0===e&&n>i||1===e&&i>n)&&(n=i),n!==this.values(e)&&(i=this.values(),i[e]=n,t=this._trigger("slide",t,{handle:this.handles[e],value:n,values:i}),this.values(e?0:1),t!==!1&&this.values(e,n,!0))):n!==this.value()&&(t=this._trigger("slide",t,{handle:this.handles[e],value:n}),t!==!1&&this.value(n))},_stop:function(t,e){var n={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(e),n.values=this.values()),this._trigger("stop",t,n)},_change:function(t,e){if(!this._keySliding&&!this._mouseSliding){var n={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(e),n.values=this.values()),this._trigger("change",t,n)}},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(e,n){var i,r,a;if(arguments.length>1)this.options.values[e]=this._trimAlignValue(n),this._refreshValue(),this._change(null,e);else{if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(e):this.value();for(i=this.options.values,r=arguments[0],a=0;i.length>a;a+=1)i[a]=this._trimAlignValue(r[a]),this._change(null,a);this._refreshValue()}},_setOption:function(e,n){var i,r=0;switch(t.isArray(this.options.values)&&(r=this.options.values.length),t.Widget.prototype._setOption.apply(this,arguments),e){case"disabled":n?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.propAttr("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.propAttr("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),i=0;r>i;i+=1)this._change(null,i);this._animateOff=!1}},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,n;if(arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);for(e=this.options.values.slice(),n=0;e.length>n;n+=1)e[n]=this._trimAlignValue(e[n]);return e},_trimAlignValue:function(t){if(this._valueMin()>=t)return this._valueMin();if(t>=this._valueMax())return this._valueMax();var e=this.options.step>0?this.options.step:1,n=(t-this._valueMin())%e;return t-=n,2*Math.abs(n)>=e&&(t+=n>0?e:-e),parseFloat(t.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var e,n,i,r,a,o=this.options.range,s=this.options,l=this,c=this._animateOff?!1:s.animate,u={};this.options.values&&this.options.values.length?this.handles.each(function(i){e=100*((l.values(i)-l._valueMin())/(l._valueMax()-l._valueMin())),u["horizontal"===l.orientation?"left":"bottom"]=e+"%",t(this).stop(1,1)[c?"animate":"css"](u,s.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===i&&l.range.stop(1,1)[c?"animate":"css"]({left:e+"%"},s.animate),1===i&&l.range[c?"animate":"css"]({width:e-n+"%"},{queue:!1,duration:s.animate})):(0===i&&l.range.stop(1,1)[c?"animate":"css"]({bottom:e+"%"},s.animate),1===i&&l.range[c?"animate":"css"]({height:e-n+"%"},{queue:!1,duration:s.animate}))),n=e}):(i=this.value(),r=this._valueMin(),a=this._valueMax(),e=a!==r?100*((i-r)/(a-r)):0,u["horizontal"===l.orientation?"left":"bottom"]=e+"%",this.handle.stop(1,1)[c?"animate":"css"](u,s.animate),"min"===o&&"horizontal"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({width:e+"%"},s.animate),"max"===o&&"horizontal"===this.orientation&&this.range[c?"animate":"css"]({width:100-e+"%"},{queue:!1,duration:s.animate}),"min"===o&&"vertical"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({height:e+"%"},s.animate),"max"===o&&"vertical"===this.orientation&&this.range[c?"animate":"css"]({height:100-e+"%"},{queue:!1,duration:s.animate}))}}),t.extend(t.ui.slider,{version:"1.8.16"})}(jQuery),function(e,n){function i(){return++a}function r(){return++o}var a=0,o=0;e.widget("ui.tabs",{options:{add:null,ajaxOptions:null,cache:!1,cookie:null,collapsible:!1,disable:null,disabled:[],enable:null,event:"click",fx:null,idPrefix:"ui-tabs-",load:null,panelTemplate:"<div></div>",remove:null,select:null,show:null,spinner:"<em>Loading&#8230;</em>",tabTemplate:"<li><a href='#{href}'><span>#{label}</span></a></li>"},_create:function(){this._tabify(!0)},_setOption:function(t,e){"selected"==t?this.options.collapsible&&e==this.options.selected||this.select(e):(this.options[t]=e,this._tabify())},_tabId:function(t){return t.title&&t.title.replace(/\s/g,"_").replace(/[^\w\u00c0-\uFFFF-]/g,"")||this.options.idPrefix+i()},_sanitizeSelector:function(t){return t.replace(/:/g,"\\:")},_cookie:function(){var t=this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+r());
return e.cookie.apply(null,[t].concat(e.makeArray(arguments)))},_ui:function(t,e){return{tab:t,panel:e,index:this.anchors.index(t)}},_cleanup:function(){this.lis.filter(".ui-state-processing").removeClass("ui-state-processing").find("span:data(label.tabs)").each(function(){var t=e(this);t.html(t.data("label.tabs")).removeData("label.tabs")})},_tabify:function(t){function i(t,n){t.css("display",""),!e.support.opacity&&n.opacity&&t[0].style.removeAttribute("filter")}var r=this,a=this.options,o=/^#.+/;this.list=this.element.find("ol,ul").eq(0),this.lis=e(" > li:has(a[href])",this.list),this.anchors=this.lis.map(function(){return e("a",this)[0]}),this.panels=e([]),this.anchors.each(function(t,n){var i,s=e(n).attr("href"),l=s.split("#")[0];l&&(l===(""+location).split("#")[0]||(i=e("base")[0])&&l===i.href)&&(s=n.hash,n.href=s),o.test(s)?r.panels=r.panels.add(r.element.find(r._sanitizeSelector(s))):s&&"#"!==s?(e.data(n,"href.tabs",s),e.data(n,"load.tabs",s.replace(/#.*$/,"")),s=r._tabId(n),n.href="#"+s,n=r.element.find("#"+s),n.length||(n=e(a.panelTemplate).attr("id",s).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").insertAfter(r.panels[t-1]||r.list),n.data("destroy.tabs",!0)),r.panels=r.panels.add(n)):a.disabled.push(t)}),t?(this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all"),this.list.addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"),this.lis.addClass("ui-state-default ui-corner-top"),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom"),a.selected===n?(location.hash&&this.anchors.each(function(t,e){return e.hash==location.hash?(a.selected=t,!1):void 0}),"number"!=typeof a.selected&&a.cookie&&(a.selected=parseInt(r._cookie(),10)),"number"!=typeof a.selected&&this.lis.filter(".ui-tabs-selected").length&&(a.selected=this.lis.index(this.lis.filter(".ui-tabs-selected"))),a.selected=a.selected||(this.lis.length?0:-1)):null===a.selected&&(a.selected=-1),a.selected=a.selected>=0&&this.anchors[a.selected]||0>a.selected?a.selected:0,a.disabled=e.unique(a.disabled.concat(e.map(this.lis.filter(".ui-state-disabled"),function(t){return r.lis.index(t)}))).sort(),-1!=e.inArray(a.selected,a.disabled)&&a.disabled.splice(e.inArray(a.selected,a.disabled),1),this.panels.addClass("ui-tabs-hide"),this.lis.removeClass("ui-tabs-selected ui-state-active"),a.selected>=0&&this.anchors.length&&(r.element.find(r._sanitizeSelector(r.anchors[a.selected].hash)).removeClass("ui-tabs-hide"),this.lis.eq(a.selected).addClass("ui-tabs-selected ui-state-active"),r.element.queue("tabs",function(){r._trigger("show",null,r._ui(r.anchors[a.selected],r.element.find(r._sanitizeSelector(r.anchors[a.selected].hash))[0]))}),this.load(a.selected)),e(window).bind("unload",function(){r.lis.add(r.anchors).unbind(".tabs"),r.lis=r.anchors=r.panels=null})):a.selected=this.lis.index(this.lis.filter(".ui-tabs-selected")),this.element[a.collapsible?"addClass":"removeClass"]("ui-tabs-collapsible"),a.cookie&&this._cookie(a.selected,a.cookie),t=0;for(var s;s=this.lis[t];t++)e(s)[-1==e.inArray(t,a.disabled)||e(s).hasClass("ui-tabs-selected")?"removeClass":"addClass"]("ui-state-disabled");if(a.cache===!1&&this.anchors.removeData("cache.tabs"),this.lis.add(this.anchors).unbind(".tabs"),"mouseover"!==a.event){var l=function(t,e){e.is(":not(.ui-state-disabled)")&&e.addClass("ui-state-"+t)},c=function(t,e){e.removeClass("ui-state-"+t)};this.lis.bind("mouseover.tabs",function(){l("hover",e(this))}),this.lis.bind("mouseout.tabs",function(){c("hover",e(this))}),this.anchors.bind("focus.tabs",function(){l("focus",e(this).closest("li"))}),this.anchors.bind("blur.tabs",function(){c("focus",e(this).closest("li"))})}var u,d;a.fx&&(e.isArray(a.fx)?(u=a.fx[0],d=a.fx[1]):u=d=a.fx);var h=d?function(t,n){e(t).closest("li").addClass("ui-tabs-selected ui-state-active"),n.hide().removeClass("ui-tabs-hide").animate(d,d.duration||"normal",function(){i(n,d),r._trigger("show",null,r._ui(t,n[0]))})}:function(t,n){e(t).closest("li").addClass("ui-tabs-selected ui-state-active"),n.removeClass("ui-tabs-hide"),r._trigger("show",null,r._ui(t,n[0]))},p=u?function(t,e){e.animate(u,u.duration||"normal",function(){r.lis.removeClass("ui-tabs-selected ui-state-active"),e.addClass("ui-tabs-hide"),i(e,u),r.element.dequeue("tabs")})}:function(t,e){r.lis.removeClass("ui-tabs-selected ui-state-active"),e.addClass("ui-tabs-hide"),r.element.dequeue("tabs")};this.anchors.bind(a.event+".tabs",function(){var t=this,n=e(t).closest("li"),i=r.panels.filter(":not(.ui-tabs-hide)"),o=r.element.find(r._sanitizeSelector(t.hash));if(n.hasClass("ui-tabs-selected")&&!a.collapsible||n.hasClass("ui-state-disabled")||n.hasClass("ui-state-processing")||r.panels.filter(":animated").length||r._trigger("select",null,r._ui(this,o[0]))===!1)return this.blur(),!1;if(a.selected=r.anchors.index(this),r.abort(),a.collapsible){if(n.hasClass("ui-tabs-selected"))return a.selected=-1,a.cookie&&r._cookie(a.selected,a.cookie),r.element.queue("tabs",function(){p(t,i)}).dequeue("tabs"),this.blur(),!1;if(!i.length)return a.cookie&&r._cookie(a.selected,a.cookie),r.element.queue("tabs",function(){h(t,o)}),r.load(r.anchors.index(this)),this.blur(),!1}if(a.cookie&&r._cookie(a.selected,a.cookie),!o.length)throw"jQuery UI Tabs: Mismatching fragment identifier.";i.length&&r.element.queue("tabs",function(){p(t,i)}),r.element.queue("tabs",function(){h(t,o)}),r.load(r.anchors.index(this)),e.browser.msie&&this.blur()}),this.anchors.bind("click.tabs",function(){return!1})},_getIndex:function(t){return"string"==typeof t&&(t=this.anchors.index(this.anchors.filter("[href$="+t+"]"))),t},destroy:function(){var t=this.options;return this.abort(),this.element.unbind(".tabs").removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible").removeData("tabs"),this.list.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"),this.anchors.each(function(){var t=e.data(this,"href.tabs");t&&(this.href=t);var n=e(this).unbind(".tabs");e.each(["href","load","cache"],function(t,e){n.removeData(e+".tabs")})}),this.lis.unbind(".tabs").add(this.panels).each(function(){e.data(this,"destroy.tabs")?e(this).remove():e(this).removeClass("ui-state-default ui-corner-top ui-tabs-selected ui-state-active ui-state-hover ui-state-focus ui-state-disabled ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide")}),t.cookie&&this._cookie(null,t.cookie),this},add:function(t,i,r){r===n&&(r=this.anchors.length);var a=this,o=this.options;i=e(o.tabTemplate.replace(/#\{href\}/g,t).replace(/#\{label\}/g,i)),t=t.indexOf("#")?this._tabId(e("a",i)[0]):t.replace("#",""),i.addClass("ui-state-default ui-corner-top").data("destroy.tabs",!0);var s=a.element.find("#"+t);return s.length||(s=e(o.panelTemplate).attr("id",t).data("destroy.tabs",!0)),s.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"),r>=this.lis.length?(i.appendTo(this.list),s.appendTo(this.list[0].parentNode)):(i.insertBefore(this.lis[r]),s.insertBefore(this.panels[r])),o.disabled=e.map(o.disabled,function(t){return t>=r?++t:t}),this._tabify(),1==this.anchors.length&&(o.selected=0,i.addClass("ui-tabs-selected ui-state-active"),s.removeClass("ui-tabs-hide"),this.element.queue("tabs",function(){a._trigger("show",null,a._ui(a.anchors[0],a.panels[0]))}),this.load(0)),this._trigger("add",null,this._ui(this.anchors[r],this.panels[r])),this},remove:function(t){t=this._getIndex(t);var n=this.options,i=this.lis.eq(t).remove(),r=this.panels.eq(t).remove();return i.hasClass("ui-tabs-selected")&&this.anchors.length>1&&this.select(t+(this.anchors.length>t+1?1:-1)),n.disabled=e.map(e.grep(n.disabled,function(e){return e!=t}),function(e){return e>=t?--e:e}),this._tabify(),this._trigger("remove",null,this._ui(i.find("a")[0],r[0])),this},enable:function(t){t=this._getIndex(t);var n=this.options;return-1!=e.inArray(t,n.disabled)?(this.lis.eq(t).removeClass("ui-state-disabled"),n.disabled=e.grep(n.disabled,function(e){return e!=t}),this._trigger("enable",null,this._ui(this.anchors[t],this.panels[t])),this):void 0},disable:function(t){t=this._getIndex(t);var e=this.options;return t!=e.selected&&(this.lis.eq(t).addClass("ui-state-disabled"),e.disabled.push(t),e.disabled.sort(),this._trigger("disable",null,this._ui(this.anchors[t],this.panels[t]))),this},select:function(t){if(t=this._getIndex(t),-1==t){if(!this.options.collapsible||-1==this.options.selected)return this;t=this.options.selected}return this.anchors.eq(t).trigger(this.options.event+".tabs"),this},load:function(t){t=this._getIndex(t);var n=this,i=this.options,r=this.anchors.eq(t)[0],a=e.data(r,"load.tabs");if(this.abort(),a&&(0===this.element.queue("tabs").length||!e.data(r,"cache.tabs"))){if(this.lis.eq(t).addClass("ui-state-processing"),i.spinner){var o=e("span",r);o.data("label.tabs",o.html()).html(i.spinner)}return this.xhr=e.ajax(e.extend({},i.ajaxOptions,{url:a,success:function(a,o){n.element.find(n._sanitizeSelector(r.hash)).html(a),n._cleanup(),i.cache&&e.data(r,"cache.tabs",!0),n._trigger("load",null,n._ui(n.anchors[t],n.panels[t]));try{i.ajaxOptions.success(a,o)}catch(s){}},error:function(e,a){n._cleanup(),n._trigger("load",null,n._ui(n.anchors[t],n.panels[t]));try{i.ajaxOptions.error(e,a,t,r)}catch(o){}}})),n.element.dequeue("tabs"),this}this.element.dequeue("tabs")},abort:function(){return this.element.queue([]),this.panels.stop(!1,!0),this.element.queue("tabs",this.element.queue("tabs").splice(-2,2)),this.xhr&&(this.xhr.abort(),delete this.xhr),this._cleanup(),this},url:function(t,e){return this.anchors.eq(t).removeData("cache.tabs").data("load.tabs",e),this},length:function(){return this.anchors.length}}),e.extend(e.ui.tabs,{version:"1.8.16"}),e.extend(e.ui.tabs.prototype,{rotation:null,rotate:function(e,n){var i=this,r=this.options,a=i._rotate||(i._rotate=function(t){clearTimeout(i.rotation),i.rotation=setTimeout(function(){var t=r.selected;i.select(++t<i.anchors.length?t:0)},e),t&&t.stopPropagation()});return n=i._unrotate||(i._unrotate=n?function(){t=r.selected,a()}:function(t){t.clientX&&i.rotate(null)}),e?(this.element.bind("tabsshow",a),this.anchors.bind(r.event+".tabs",n),a()):(clearTimeout(i.rotation),this.element.unbind("tabsshow",a),this.anchors.unbind(r.event+".tabs",n),delete this._rotate,delete this._unrotate),this}})}(jQuery),function(d,C){function M(){this.debug=!1,this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._inDialog=this._datepickerShowing=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},d.extend(this._defaults,this.regional[""]),this.dpDiv=N(d('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}function N(t){return t.bind("mouseout",function(t){t=d(t.target).closest("button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a"),t.length&&t.removeClass("ui-state-hover ui-datepicker-prev-hover ui-datepicker-next-hover")}).bind("mouseover",function(e){e=d(e.target).closest("button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a"),!d.datepicker._isDisabledDatepicker(J.inline?t.parent()[0]:J.input[0])&&e.length&&(e.parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e.addClass("ui-state-hover"),e.hasClass("ui-datepicker-prev")&&e.addClass("ui-datepicker-prev-hover"),e.hasClass("ui-datepicker-next")&&e.addClass("ui-datepicker-next-hover"))})}function H(t,e){d.extend(t,e);for(var n in e)(null==e[n]||e[n]==C)&&(t[n]=e[n]);return t}d.extend(d.ui,{datepicker:{version:"1.8.16"}});var B=(new Date).getTime(),J;d.extend(M.prototype,{markerClassName:"hasDatepicker",maxRows:4,log:function(){this.debug&&console.log.apply("",arguments)},_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(t){return H(this._defaults,t||{}),this},_attachDatepicker:function(a,b){var c=null;for(var e in this._defaults){var f=a.getAttribute("date:"+e);if(f){c=c||{};try{c[e]=eval(f)}catch(h){c[e]=f}}}e=a.nodeName.toLowerCase(),f="div"==e||"span"==e,a.id||(this.uuid+=1,a.id="dp"+this.uuid);var i=this._newInst(d(a),f);i.settings=d.extend({},b||{},c||{}),"input"==e?this._connectDatepicker(a,i):f&&this._inlineDatepicker(a,i)},_newInst:function(t,e){return{id:t[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"),input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:e,dpDiv:e?N(d('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>')):this.dpDiv}},_connectDatepicker:function(t,e){var n=d(t);e.append=d([]),e.trigger=d([]),n.hasClass(this.markerClassName)||(this._attachments(n,e),n.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(t,n,i){e.settings[n]=i}).bind("getData.datepicker",function(t,n){return this._get(e,n)}),this._autoSize(e),d.data(t,"datepicker",e),e.settings.disabled&&this._disableDatepicker(t))},_attachments:function(t,e){var n=this._get(e,"appendText"),i=this._get(e,"isRTL");if(e.append&&e.append.remove(),n&&(e.append=d('<span class="'+this._appendClass+'">'+n+"</span>"),t[i?"before":"after"](e.append)),t.unbind("focus",this._showDatepicker),e.trigger&&e.trigger.remove(),n=this._get(e,"showOn"),("focus"==n||"both"==n)&&t.focus(this._showDatepicker),"button"==n||"both"==n){n=this._get(e,"buttonText");var r=this._get(e,"buttonImage");e.trigger=d(this._get(e,"buttonImageOnly")?d("<img/>").addClass(this._triggerClass).attr({src:r,alt:n,title:n}):d('<button type="button"></button>').addClass(this._triggerClass).html(""==r?n:d("<img/>").attr({src:r,alt:n,title:n}))),t[i?"before":"after"](e.trigger),e.trigger.click(function(){return d.datepicker._datepickerShowing&&d.datepicker._lastInput==t[0]?d.datepicker._hideDatepicker():d.datepicker._showDatepicker(t[0]),!1})}},_autoSize:function(t){if(this._get(t,"autoSize")&&!t.inline){var e=new Date(2009,11,20),n=this._get(t,"dateFormat");if(n.match(/[DM]/)){var i=function(t){for(var e=0,n=0,i=0;t.length>i;i++)t[i].length>e&&(e=t[i].length,n=i);return n};e.setMonth(i(this._get(t,n.match(/MM/)?"monthNames":"monthNamesShort"))),e.setDate(i(this._get(t,n.match(/DD/)?"dayNames":"dayNamesShort"))+20-e.getDay())}t.input.attr("size",this._formatDate(t,e).length)}},_inlineDatepicker:function(t,e){var n=d(t);n.hasClass(this.markerClassName)||(n.addClass(this.markerClassName).append(e.dpDiv).bind("setData.datepicker",function(t,n,i){e.settings[n]=i}).bind("getData.datepicker",function(t,n){return this._get(e,n)}),d.data(t,"datepicker",e),this._setDate(e,this._getDefaultDate(e),!0),this._updateDatepicker(e),this._updateAlternate(e),e.settings.disabled&&this._disableDatepicker(t),e.dpDiv.css("display","block"))},_dialogDatepicker:function(t,e,n,i,r){return t=this._dialogInst,t||(this.uuid+=1,this._dialogInput=d('<input type="text" id="'+("dp"+this.uuid)+'" style="position: absolute; top: -100px; width: 0px; z-index: -10;"/>'),this._dialogInput.keydown(this._doKeyDown),d("body").append(this._dialogInput),t=this._dialogInst=this._newInst(this._dialogInput,!1),t.settings={},d.data(this._dialogInput[0],"datepicker",t)),H(t.settings,i||{}),e=e&&e.constructor==Date?this._formatDate(t,e):e,this._dialogInput.val(e),this._pos=r?r.length?r:[r.pageX,r.pageY]:null,this._pos||(this._pos=[document.documentElement.clientWidth/2-100+(document.documentElement.scrollLeft||document.body.scrollLeft),document.documentElement.clientHeight/2-150+(document.documentElement.scrollTop||document.body.scrollTop)]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),t.settings.onSelect=n,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),d.blockUI&&d.blockUI(this.dpDiv),d.data(this._dialogInput[0],"datepicker",t),this},_destroyDatepicker:function(t){var e=d(t),n=d.data(t,"datepicker");if(e.hasClass(this.markerClassName)){var i=t.nodeName.toLowerCase();d.removeData(t,"datepicker"),"input"==i?(n.append.remove(),n.trigger.remove(),e.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"==i||"span"==i)&&e.removeClass(this.markerClassName).empty()}},_enableDatepicker:function(t){var e=d(t),n=d.data(t,"datepicker");if(e.hasClass(this.markerClassName)){var i=t.nodeName.toLowerCase();"input"==i?(t.disabled=!1,n.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"==i||"span"==i)&&(e=e.children("."+this._inlineClass),e.children().removeClass("ui-state-disabled"),e.find("select.ui-datepicker-month, select.ui-datepicker-year").removeAttr("disabled")),this._disabledInputs=d.map(this._disabledInputs,function(e){return e==t?null:e})}},_disableDatepicker:function(t){var e=d(t),n=d.data(t,"datepicker");if(e.hasClass(this.markerClassName)){var i=t.nodeName.toLowerCase();"input"==i?(t.disabled=!0,n.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"==i||"span"==i)&&(e=e.children("."+this._inlineClass),e.children().addClass("ui-state-disabled"),e.find("select.ui-datepicker-month, select.ui-datepicker-year").attr("disabled","disabled")),this._disabledInputs=d.map(this._disabledInputs,function(e){return e==t?null:e}),this._disabledInputs[this._disabledInputs.length]=t}},_isDisabledDatepicker:function(t){if(!t)return!1;for(var e=0;this._disabledInputs.length>e;e++)if(this._disabledInputs[e]==t)return!0;return!1},_getInst:function(t){try{return d.data(t,"datepicker")}catch(e){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(t,e,n){var i=this._getInst(t);if(2==arguments.length&&"string"==typeof e)return"defaults"==e?d.extend({},d.datepicker._defaults):i?"all"==e?d.extend({},i.settings):this._get(i,e):null;var r=e||{};if("string"==typeof e&&(r={},r[e]=n),i){this._curInst==i&&this._hideDatepicker();var a=this._getDateDatepicker(t,!0),o=this._getMinMaxDate(i,"min"),s=this._getMinMaxDate(i,"max");H(i.settings,r),null!==o&&r.dateFormat!==C&&r.minDate===C&&(i.settings.minDate=this._formatDate(i,o)),null!==s&&r.dateFormat!==C&&r.maxDate===C&&(i.settings.maxDate=this._formatDate(i,s)),this._attachments(d(t),i),this._autoSize(i),this._setDate(i,a),this._updateAlternate(i),this._updateDatepicker(i)}},_changeDatepicker:function(t,e,n){this._optionDatepicker(t,e,n)},_refreshDatepicker:function(t){(t=this._getInst(t))&&this._updateDatepicker(t)},_setDateDatepicker:function(t,e){(t=this._getInst(t))&&(this._setDate(t,e),this._updateDatepicker(t),this._updateAlternate(t))},_getDateDatepicker:function(t,e){return(t=this._getInst(t))&&!t.inline&&this._setDateFromField(t,e),t?this._getDate(t):null},_doKeyDown:function(t){var e=d.datepicker._getInst(t.target),n=!0,i=e.dpDiv.is(".ui-datepicker-rtl");if(e._keyEvent=!0,d.datepicker._datepickerShowing)switch(t.keyCode){case 9:d.datepicker._hideDatepicker(),n=!1;break;case 13:return n=d("td."+d.datepicker._dayOverClass+":not(."+d.datepicker._currentClass+")",e.dpDiv),n[0]&&d.datepicker._selectDay(t.target,e.selectedMonth,e.selectedYear,n[0]),(t=d.datepicker._get(e,"onSelect"))?(n=d.datepicker._formatDate(e),t.apply(e.input?e.input[0]:null,[n,e])):d.datepicker._hideDatepicker(),!1;case 27:d.datepicker._hideDatepicker();break;case 33:d.datepicker._adjustDate(t.target,t.ctrlKey?-d.datepicker._get(e,"stepBigMonths"):-d.datepicker._get(e,"stepMonths"),"M");break;case 34:d.datepicker._adjustDate(t.target,t.ctrlKey?+d.datepicker._get(e,"stepBigMonths"):+d.datepicker._get(e,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&d.datepicker._clearDate(t.target),n=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&d.datepicker._gotoToday(t.target),n=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&d.datepicker._adjustDate(t.target,i?1:-1,"D"),n=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&d.datepicker._adjustDate(t.target,t.ctrlKey?-d.datepicker._get(e,"stepBigMonths"):-d.datepicker._get(e,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&d.datepicker._adjustDate(t.target,-7,"D"),n=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&d.datepicker._adjustDate(t.target,i?-1:1,"D"),n=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&d.datepicker._adjustDate(t.target,t.ctrlKey?+d.datepicker._get(e,"stepBigMonths"):+d.datepicker._get(e,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&d.datepicker._adjustDate(t.target,7,"D"),n=t.ctrlKey||t.metaKey;break;default:n=!1}else 36==t.keyCode&&t.ctrlKey?d.datepicker._showDatepicker(this):n=!1;n&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var e=d.datepicker._getInst(t.target);if(d.datepicker._get(e,"constrainInput")){e=d.datepicker._possibleChars(d.datepicker._get(e,"dateFormat"));var n=String.fromCharCode(t.charCode==C?t.keyCode:t.charCode);return t.ctrlKey||t.metaKey||" ">n||!e||e.indexOf(n)>-1}},_doKeyUp:function(t){if(t=d.datepicker._getInst(t.target),t.input.val()!=t.lastVal)try{d.datepicker.parseDate(d.datepicker._get(t,"dateFormat"),t.input?t.input.val():null,d.datepicker._getFormatConfig(t))&&(d.datepicker._setDateFromField(t),d.datepicker._updateAlternate(t),d.datepicker._updateDatepicker(t))}catch(e){d.datepicker.log(e)}return!0},_showDatepicker:function(t){if(t=t.target||t,"input"!=t.nodeName.toLowerCase()&&(t=d("input",t.parentNode)[0]),!d.datepicker._isDisabledDatepicker(t)&&d.datepicker._lastInput!=t){var e=d.datepicker._getInst(t);d.datepicker._curInst&&d.datepicker._curInst!=e&&(d.datepicker._datepickerShowing&&d.datepicker._triggerOnClose(d.datepicker._curInst),d.datepicker._curInst.dpDiv.stop(!0,!0));var n=d.datepicker._get(e,"beforeShow");if(n=n?n.apply(t,[t,e]):{},n!==!1){H(e.settings,n),e.lastVal=null,d.datepicker._lastInput=t,d.datepicker._setDateFromField(e),d.datepicker._inDialog&&(t.value=""),d.datepicker._pos||(d.datepicker._pos=d.datepicker._findPos(t),d.datepicker._pos[1]+=t.offsetHeight);var i=!1;if(d(t).parents().each(function(){return i|="fixed"==d(this).css("position"),!i}),i&&d.browser.opera&&(d.datepicker._pos[0]-=document.documentElement.scrollLeft,d.datepicker._pos[1]-=document.documentElement.scrollTop),n={left:d.datepicker._pos[0],top:d.datepicker._pos[1]},d.datepicker._pos=null,e.dpDiv.empty(),e.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),d.datepicker._updateDatepicker(e),n=d.datepicker._checkOffset(e,n,i),e.dpDiv.css({position:d.datepicker._inDialog&&d.blockUI?"static":i?"fixed":"absolute",display:"none",left:n.left+"px",top:n.top+"px"}),!e.inline){n=d.datepicker._get(e,"showAnim");var r=d.datepicker._get(e,"duration"),a=function(){var t=e.dpDiv.find("iframe.ui-datepicker-cover");if(t.length){var n=d.datepicker._getBorders(e.dpDiv);t.css({left:-n[0],top:-n[1],width:e.dpDiv.outerWidth(),height:e.dpDiv.outerHeight()})}};e.dpDiv.zIndex(d(t).zIndex()+1),d.datepicker._datepickerShowing=!0,d.effects&&d.effects[n]?e.dpDiv.show(n,d.datepicker._get(e,"showOptions"),r,a):e.dpDiv[n||"show"](n?r:null,a),n&&r||a(),e.input.is(":visible")&&!e.input.is(":disabled")&&e.input.focus(),d.datepicker._curInst=e}}}},_updateDatepicker:function(t){this.maxRows=4;var e=d.datepicker._getBorders(t.dpDiv);J=t,t.dpDiv.empty().append(this._generateHTML(t));var n=t.dpDiv.find("iframe.ui-datepicker-cover");if(n.length&&n.css({left:-e[0],top:-e[1],width:t.dpDiv.outerWidth(),height:t.dpDiv.outerHeight()}),t.dpDiv.find("."+this._dayOverClass+" a").mouseover(),e=this._getNumberOfMonths(t),n=e[1],t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&t.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",17*n+"em"),t.dpDiv[(1!=e[0]||1!=e[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t==d.datepicker._curInst&&d.datepicker._datepickerShowing&&t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&t.input[0]!=document.activeElement&&t.input.focus(),t.yearshtml){var i=t.yearshtml;setTimeout(function(){i===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),i=t.yearshtml=null},0)}},_getBorders:function(t){var e=function(t){return{thin:1,medium:2,thick:3}[t]||t};return[parseFloat(e(t.css("border-left-width"))),parseFloat(e(t.css("border-top-width")))]},_checkOffset:function(t,e,n){var i=t.dpDiv.outerWidth(),r=t.dpDiv.outerHeight(),a=t.input?t.input.outerWidth():0,o=t.input?t.input.outerHeight():0,s=document.documentElement.clientWidth+d(document).scrollLeft(),l=document.documentElement.clientHeight+d(document).scrollTop();return e.left-=this._get(t,"isRTL")?i-a:0,e.left-=n&&e.left==t.input.offset().left?d(document).scrollLeft():0,e.top-=n&&e.top==t.input.offset().top+o?d(document).scrollTop():0,e.left-=Math.min(e.left,e.left+i>s&&s>i?Math.abs(e.left+i-s):0),e.top-=Math.min(e.top,e.top+r>l&&l>r?Math.abs(r+o):0),e},_findPos:function(t){for(var e=this._get(this._getInst(t),"isRTL");t&&("hidden"==t.type||1!=t.nodeType||d.expr.filters.hidden(t));)t=t[e?"previousSibling":"nextSibling"];return t=d(t).offset(),[t.left,t.top]},_triggerOnClose:function(t){var e=this._get(t,"onClose");e&&e.apply(t.input?t.input[0]:null,[t.input?t.input.val():"",t])},_hideDatepicker:function(t){var e=this._curInst;if(e&&(!t||e==d.data(t,"datepicker"))&&this._datepickerShowing){t=this._get(e,"showAnim");var n=this._get(e,"duration"),i=function(){d.datepicker._tidyDialog(e),this._curInst=null};d.effects&&d.effects[t]?e.dpDiv.hide(t,d.datepicker._get(e,"showOptions"),n,i):e.dpDiv["slideDown"==t?"slideUp":"fadeIn"==t?"fadeOut":"hide"](t?n:null,i),t||i(),d.datepicker._triggerOnClose(e),this._datepickerShowing=!1,this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),d.blockUI&&(d.unblockUI(),d("body").append(this.dpDiv))),this._inDialog=!1}},_tidyDialog:function(t){t.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(t){d.datepicker._curInst&&(t=d(t.target),t[0].id!=d.datepicker._mainDivId&&0==t.parents("#"+d.datepicker._mainDivId).length&&!t.hasClass(d.datepicker.markerClassName)&&!t.hasClass(d.datepicker._triggerClass)&&d.datepicker._datepickerShowing&&!(d.datepicker._inDialog&&d.blockUI)&&d.datepicker._hideDatepicker())},_adjustDate:function(t,e,n){t=d(t);var i=this._getInst(t[0]);this._isDisabledDatepicker(t[0])||(this._adjustInstDate(i,e+("M"==n?this._get(i,"showCurrentAtPos"):0),n),this._updateDatepicker(i))},_gotoToday:function(t){t=d(t);var e=this._getInst(t[0]);if(this._get(e,"gotoCurrent")&&e.currentDay)e.selectedDay=e.currentDay,e.drawMonth=e.selectedMonth=e.currentMonth,e.drawYear=e.selectedYear=e.currentYear;else{var n=new Date;e.selectedDay=n.getDate(),e.drawMonth=e.selectedMonth=n.getMonth(),e.drawYear=e.selectedYear=n.getFullYear()}this._notifyChange(e),this._adjustDate(t)},_selectMonthYear:function(t,e,n){t=d(t);var i=this._getInst(t[0]);i["selected"+("M"==n?"Month":"Year")]=i["draw"+("M"==n?"Month":"Year")]=parseInt(e.options[e.selectedIndex].value,10),this._notifyChange(i),this._adjustDate(t)},_selectDay:function(t,e,n,i){var r=d(t);d(i).hasClass(this._unselectableClass)||this._isDisabledDatepicker(r[0])||(r=this._getInst(r[0]),r.selectedDay=r.currentDay=d("a",i).html(),r.selectedMonth=r.currentMonth=e,r.selectedYear=r.currentYear=n,this._selectDate(t,this._formatDate(r,r.currentDay,r.currentMonth,r.currentYear)))},_clearDate:function(t){t=d(t),this._getInst(t[0]),this._selectDate(t,"")},_selectDate:function(t,e){t=this._getInst(d(t)[0]),e=null!=e?e:this._formatDate(t),t.input&&t.input.val(e),this._updateAlternate(t);var n=this._get(t,"onSelect");n?n.apply(t.input?t.input[0]:null,[e,t]):t.input&&t.input.trigger("change"),t.inline?this._updateDatepicker(t):(this._hideDatepicker(),this._lastInput=t.input[0],"object"!=typeof t.input[0]&&t.input.focus(),this._lastInput=null)},_updateAlternate:function(t){var e=this._get(t,"altField");if(e){var n=this._get(t,"altFormat")||this._get(t,"dateFormat"),i=this._getDate(t),r=this.formatDate(n,i,this._getFormatConfig(t));d(e).each(function(){d(this).val(r)})}},noWeekends:function(t){return t=t.getDay(),[t>0&&6>t,""]},iso8601Week:function(t){t=new Date(t.getTime()),t.setDate(t.getDate()+4-(t.getDay()||7));var e=t.getTime();return t.setMonth(0),t.setDate(1),Math.floor(Math.round((e-t)/864e5)/7)+1},parseDate:function(t,e,n){if(null==t||null==e)throw"Invalid arguments";if(e="object"==typeof e?""+e:e+"",""==e)return null;var i=(n?n.shortYearCutoff:null)||this._defaults.shortYearCutoff;i="string"!=typeof i?i:(new Date).getFullYear()%100+parseInt(i,10);for(var r=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,a=(n?n.dayNames:null)||this._defaults.dayNames,o=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,s=(n?n.monthNames:null)||this._defaults.monthNames,l=n=-1,c=-1,u=-1,h=!1,p=function(e){return(e=t.length>y+1&&t.charAt(y+1)==e)&&y++,e},f=function(t){var n=p(t);if(t=RegExp("^\\d{1,"+("@"==t?14:"!"==t?20:"y"==t&&n?4:"o"==t?3:2)+"}"),t=e.substring(v).match(t),!t)throw"Missing number at position "+v;return v+=t[0].length,parseInt(t[0],10)},g=function(t,n,i){t=d.map(p(t)?i:n,function(t,e){return[[e,t]]}).sort(function(t,e){return-(t[1].length-e[1].length)});var r=-1;if(d.each(t,function(t,n){return t=n[1],e.substr(v,t.length).toLowerCase()==t.toLowerCase()?(r=n[0],v+=t.length,!1):void 0}),-1!=r)return r+1;throw"Unknown name at position "+v},m=function(){if(e.charAt(v)!=t.charAt(y))throw"Unexpected literal at position "+v;v++},v=0,y=0;t.length>y;y++)if(h)"'"!=t.charAt(y)||p("'")?m():h=!1;else switch(t.charAt(y)){case"d":c=f("d");break;case"D":g("D",r,a);break;case"o":u=f("o");break;case"m":l=f("m");break;case"M":l=g("M",o,s);break;case"y":n=f("y");break;case"@":var b=new Date(f("@"));n=b.getFullYear(),l=b.getMonth()+1,c=b.getDate();break;case"!":b=new Date((f("!")-this._ticksTo1970)/1e4),n=b.getFullYear(),l=b.getMonth()+1,c=b.getDate();break;case"'":p("'")?m():h=!0;break;default:m()}if(e.length>v)throw"Extra/unparsed characters found in date: "+e.substring(v);if(-1==n?n=(new Date).getFullYear():100>n&&(n+=(new Date).getFullYear()-(new Date).getFullYear()%100+(i>=n?0:-100)),u>-1)for(l=1,c=u;;){if(i=this._getDaysInMonth(n,l-1),i>=c)break;l++,c-=i}if(b=this._daylightSavingAdjust(new Date(n,l-1,c)),b.getFullYear()!=n||b.getMonth()+1!=l||b.getDate()!=c)throw"Invalid date";
return b},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:1e7*60*60*24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(t,e,n){if(!e)return"";var i=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,r=(n?n.dayNames:null)||this._defaults.dayNames,a=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort;n=(n?n.monthNames:null)||this._defaults.monthNames;var o=function(e){return(e=t.length>d+1&&t.charAt(d+1)==e)&&d++,e},s=function(t,e,n){if(e=""+e,o(t))for(;n>e.length;)e="0"+e;return e},l=function(t,e,n,i){return o(t)?i[e]:n[e]},c="",u=!1;if(e)for(var d=0;t.length>d;d++)if(u)"'"!=t.charAt(d)||o("'")?c+=t.charAt(d):u=!1;else switch(t.charAt(d)){case"d":c+=s("d",e.getDate(),2);break;case"D":c+=l("D",e.getDay(),i,r);break;case"o":c+=s("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":c+=s("m",e.getMonth()+1,2);break;case"M":c+=l("M",e.getMonth(),a,n);break;case"y":c+=o("y")?e.getFullYear():(10>e.getYear()%100?"0":"")+e.getYear()%100;break;case"@":c+=e.getTime();break;case"!":c+=1e4*e.getTime()+this._ticksTo1970;break;case"'":o("'")?c+="'":u=!0;break;default:c+=t.charAt(d)}return c},_possibleChars:function(t){for(var e="",n=!1,i=function(e){return(e=t.length>r+1&&t.charAt(r+1)==e)&&r++,e},r=0;t.length>r;r++)if(n)"'"!=t.charAt(r)||i("'")?e+=t.charAt(r):n=!1;else switch(t.charAt(r)){case"d":case"m":case"y":case"@":e+="0123456789";break;case"D":case"M":return null;case"'":i("'")?e+="'":n=!0;break;default:e+=t.charAt(r)}return e},_get:function(t,e){return t.settings[e]!==C?t.settings[e]:this._defaults[e]},_setDateFromField:function(t,e){if(t.input.val()!=t.lastVal){var n,i,r=this._get(t,"dateFormat"),a=t.lastVal=t.input?t.input.val():null;n=i=this._getDefaultDate(t);var o=this._getFormatConfig(t);try{n=this.parseDate(r,a,o)||i}catch(s){this.log(s),a=e?"":a}t.selectedDay=n.getDate(),t.drawMonth=t.selectedMonth=n.getMonth(),t.drawYear=t.selectedYear=n.getFullYear(),t.currentDay=a?n.getDate():0,t.currentMonth=a?n.getMonth():0,t.currentYear=a?n.getFullYear():0,this._adjustInstDate(t)}},_getDefaultDate:function(t){return this._restrictMinMax(t,this._determineDate(t,this._get(t,"defaultDate"),new Date))},_determineDate:function(t,e,n){var i=function(t){var e=new Date;return e.setDate(e.getDate()+t),e},r=function(e){try{return d.datepicker.parseDate(d.datepicker._get(t,"dateFormat"),e,d.datepicker._getFormatConfig(t))}catch(n){}var i=(e.toLowerCase().match(/^c/)?d.datepicker._getDate(t):null)||new Date,r=i.getFullYear(),a=i.getMonth();i=i.getDate();for(var o=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,s=o.exec(e);s;){switch(s[2]||"d"){case"d":case"D":i+=parseInt(s[1],10);break;case"w":case"W":i+=7*parseInt(s[1],10);break;case"m":case"M":a+=parseInt(s[1],10),i=Math.min(i,d.datepicker._getDaysInMonth(r,a));break;case"y":case"Y":r+=parseInt(s[1],10),i=Math.min(i,d.datepicker._getDaysInMonth(r,a))}s=o.exec(e)}return new Date(r,a,i)};return(e=(e=null==e||""===e?n:"string"==typeof e?r(e):"number"==typeof e?isNaN(e)?n:i(e):new Date(e.getTime()))&&"Invalid Date"==""+e?n:e)&&(e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0)),this._daylightSavingAdjust(e)},_daylightSavingAdjust:function(t){return t?(t.setHours(t.getHours()>12?t.getHours()+2:0),t):null},_setDate:function(t,e,n){var i=!e,r=t.selectedMonth,a=t.selectedYear;e=this._restrictMinMax(t,this._determineDate(t,e,new Date)),t.selectedDay=t.currentDay=e.getDate(),t.drawMonth=t.selectedMonth=t.currentMonth=e.getMonth(),t.drawYear=t.selectedYear=t.currentYear=e.getFullYear(),r==t.selectedMonth&&a==t.selectedYear||n||this._notifyChange(t),this._adjustInstDate(t),t.input&&t.input.val(i?"":this._formatDate(t))},_getDate:function(t){return!t.currentYear||t.input&&""==t.input.val()?null:this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay))},_generateHTML:function(t){var e=new Date;e=this._daylightSavingAdjust(new Date(e.getFullYear(),e.getMonth(),e.getDate()));var n=this._get(t,"isRTL"),i=this._get(t,"showButtonPanel"),r=this._get(t,"hideIfNoPrevNext"),a=this._get(t,"navigationAsDateFormat"),o=this._getNumberOfMonths(t),s=this._get(t,"showCurrentAtPos"),l=this._get(t,"stepMonths"),c=1!=o[0]||1!=o[1],u=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),h=this._getMinMaxDate(t,"min"),p=this._getMinMaxDate(t,"max");s=t.drawMonth-s;var f=t.drawYear;if(0>s&&(s+=12,f--),p){var g=this._daylightSavingAdjust(new Date(p.getFullYear(),p.getMonth()-o[0]*o[1]+1,p.getDate()));for(g=h&&h>g?h:g;this._daylightSavingAdjust(new Date(f,s,1))>g;)s--,0>s&&(s=11,f--)}t.drawMonth=s,t.drawYear=f,g=this._get(t,"prevText"),g=a?this.formatDate(g,this._daylightSavingAdjust(new Date(f,s-l,1)),this._getFormatConfig(t)):g,g=this._canAdjustMonth(t,-1,f,s)?'<a class="ui-datepicker-prev ui-corner-all" onclick="DP_jQuery_'+B+".datepicker._adjustDate('#"+t.id+"', -"+l+", 'M');\" title=\""+g+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"e":"w")+'">'+g+"</span></a>":r?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+g+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"e":"w")+'">'+g+"</span></a>";var m=this._get(t,"nextText");m=a?this.formatDate(m,this._daylightSavingAdjust(new Date(f,s+l,1)),this._getFormatConfig(t)):m,r=this._canAdjustMonth(t,1,f,s)?'<a class="ui-datepicker-next ui-corner-all" onclick="DP_jQuery_'+B+".datepicker._adjustDate('#"+t.id+"', +"+l+", 'M');\" title=\""+m+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"w":"e")+'">'+m+"</span></a>":r?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+m+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"w":"e")+'">'+m+"</span></a>",l=this._get(t,"currentText"),m=this._get(t,"gotoCurrent")&&t.currentDay?u:e,l=a?this.formatDate(l,m,this._getFormatConfig(t)):l,a=t.inline?"":'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" onclick="DP_jQuery_'+B+'.datepicker._hideDatepicker();">'+this._get(t,"closeText")+"</button>",i=i?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(n?a:"")+(this._isInRange(t,m)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" onclick="DP_jQuery_'+B+".datepicker._gotoToday('#"+t.id+"');\">"+l+"</button>":"")+(n?"":a)+"</div>":"",a=parseInt(this._get(t,"firstDay"),10),a=isNaN(a)?0:a,l=this._get(t,"showWeek"),m=this._get(t,"dayNames"),this._get(t,"dayNamesShort");var v=this._get(t,"dayNamesMin"),y=this._get(t,"monthNames"),b=this._get(t,"monthNamesShort"),x=this._get(t,"beforeShowDay"),T=this._get(t,"showOtherMonths"),w=this._get(t,"selectOtherMonths");this._get(t,"calculateWeek");for(var k=this._getDefaultDate(t),A="",_=0;o[0]>_;_++){var C="";this.maxRows=4;for(var E=0;o[1]>E;E++){var S=this._daylightSavingAdjust(new Date(f,s,t.selectedDay)),M=" ui-corner-all",I="";if(c){if(I+='<div class="ui-datepicker-group',o[1]>1)switch(E){case 0:I+=" ui-datepicker-group-first",M=" ui-corner-"+(n?"right":"left");break;case o[1]-1:I+=" ui-datepicker-group-last",M=" ui-corner-"+(n?"left":"right");break;default:I+=" ui-datepicker-group-middle",M=""}I+='">'}I+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+M+'">'+(/all|left/.test(M)&&0==_?n?r:g:"")+(/all|right/.test(M)&&0==_?n?g:r:"")+this._generateMonthYearHeader(t,s,f,h,p,_>0||E>0,y,b)+'</div><table class="ui-datepicker-calendar"><thead><tr>';var D=l?'<th class="ui-datepicker-week-col">'+this._get(t,"weekHeader")+"</th>":"";for(M=0;7>M;M++){var P=(M+a)%7;D+="<th"+((M+a+6)%7>=5?' class="ui-datepicker-week-end"':"")+'><span title="'+m[P]+'">'+v[P]+"</span></th>"}I+=D+"</tr></thead><tbody>",D=this._getDaysInMonth(f,s),f==t.selectedYear&&s==t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,D)),M=(this._getFirstDayOfMonth(f,s)-a+7)%7,D=Math.ceil((M+D)/7),this.maxRows=D=c?this.maxRows>D?this.maxRows:D:D,P=this._daylightSavingAdjust(new Date(f,s,1-M));for(var $=0;D>$;$++){I+="<tr>";var N=l?'<td class="ui-datepicker-week-col">'+this._get(t,"calculateWeek")(P)+"</td>":"";for(M=0;7>M;M++){var G=x?x.apply(t.input?t.input[0]:null,[P]):[!0,""],O=P.getMonth()!=s,L=O&&!w||!G[0]||h&&h>P||p&&P>p;N+='<td class="'+((M+a+6)%7>=5?" ui-datepicker-week-end":"")+(O?" ui-datepicker-other-month":"")+(P.getTime()==S.getTime()&&s==t.selectedMonth&&t._keyEvent||k.getTime()==P.getTime()&&k.getTime()==S.getTime()?" "+this._dayOverClass:"")+(L?" "+this._unselectableClass+" ui-state-disabled":"")+(O&&!T?"":" "+G[1]+(P.getTime()==u.getTime()?" "+this._currentClass:"")+(P.getTime()==e.getTime()?" ui-datepicker-today":""))+'"'+(O&&!T||!G[2]?"":' title="'+G[2]+'"')+(L?"":' onclick="DP_jQuery_'+B+".datepicker._selectDay('#"+t.id+"',"+P.getMonth()+","+P.getFullYear()+', this);return false;"')+">"+(O&&!T?"&#xa0;":L?'<span class="ui-state-default">'+P.getDate()+"</span>":'<a class="ui-state-default'+(P.getTime()==e.getTime()?" ui-state-highlight":"")+(P.getTime()==u.getTime()?" ui-state-active":"")+(O?" ui-priority-secondary":"")+'" href="#">'+P.getDate()+"</a>")+"</td>",P.setDate(P.getDate()+1),P=this._daylightSavingAdjust(P)}I+=N+"</tr>"}s++,s>11&&(s=0,f++),I+="</tbody></table>"+(c?"</div>"+(o[0]>0&&E==o[1]-1?'<div class="ui-datepicker-row-break"></div>':""):""),C+=I}A+=C}return A+=i+(d.browser.msie&&7>parseInt(d.browser.version,10)&&!t.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':""),t._keyEvent=!1,A},_generateMonthYearHeader:function(t,e,n,i,r,a,o,s){var l=this._get(t,"changeMonth"),c=this._get(t,"changeYear"),u=this._get(t,"showMonthAfterYear"),d='<div class="ui-datepicker-title">',h="";if(a||!l)h+='<span class="ui-datepicker-month">'+o[e]+"</span>";else{o=i&&i.getFullYear()==n;var p=r&&r.getFullYear()==n;h+='<select class="ui-datepicker-month" onchange="DP_jQuery_'+B+".datepicker._selectMonthYear('#"+t.id+"', this, 'M');\" >";for(var f=0;12>f;f++)(!o||f>=i.getMonth())&&(!p||r.getMonth()>=f)&&(h+='<option value="'+f+'"'+(f==e?' selected="selected"':"")+">"+s[f]+"</option>");h+="</select>"}if(u||(d+=h+(!a&&l&&c?"":"&#xa0;")),!t.yearshtml)if(t.yearshtml="",a||!c)d+='<span class="ui-datepicker-year">'+n+"</span>";else{s=this._get(t,"yearRange").split(":");var g=(new Date).getFullYear();for(o=function(t){return t=t.match(/c[+-].*/)?n+parseInt(t.substring(1),10):t.match(/[+-].*/)?g+parseInt(t,10):parseInt(t,10),isNaN(t)?g:t},e=o(s[0]),s=Math.max(e,o(s[1]||"")),e=i?Math.max(e,i.getFullYear()):e,s=r?Math.min(s,r.getFullYear()):s,t.yearshtml+='<select class="ui-datepicker-year" onchange="DP_jQuery_'+B+".datepicker._selectMonthYear('#"+t.id+"', this, 'Y');\" >";s>=e;e++)t.yearshtml+='<option value="'+e+'"'+(e==n?' selected="selected"':"")+">"+e+"</option>";t.yearshtml+="</select>",d+=t.yearshtml,t.yearshtml=null}return d+=this._get(t,"yearSuffix"),u&&(d+=(!a&&l&&c?"":"&#xa0;")+h),d+="</div>"},_adjustInstDate:function(t,e,n){var i=t.drawYear+("Y"==n?e:0),r=t.drawMonth+("M"==n?e:0);e=Math.min(t.selectedDay,this._getDaysInMonth(i,r))+("D"==n?e:0),i=this._restrictMinMax(t,this._daylightSavingAdjust(new Date(i,r,e))),t.selectedDay=i.getDate(),t.drawMonth=t.selectedMonth=i.getMonth(),t.drawYear=t.selectedYear=i.getFullYear(),("M"==n||"Y"==n)&&this._notifyChange(t)},_restrictMinMax:function(t,e){var n=this._getMinMaxDate(t,"min");return t=this._getMinMaxDate(t,"max"),e=n&&n>e?n:e,e=t&&e>t?t:e},_notifyChange:function(t){var e=this._get(t,"onChangeMonthYear");e&&e.apply(t.input?t.input[0]:null,[t.selectedYear,t.selectedMonth+1,t])},_getNumberOfMonths:function(t){return t=this._get(t,"numberOfMonths"),null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(t,e){return this._determineDate(t,this._get(t,e+"Date"),null)},_getDaysInMonth:function(t,e){return 32-this._daylightSavingAdjust(new Date(t,e,32)).getDate()},_getFirstDayOfMonth:function(t,e){return new Date(t,e,1).getDay()},_canAdjustMonth:function(t,e,n,i){var r=this._getNumberOfMonths(t);return n=this._daylightSavingAdjust(new Date(n,i+(0>e?e:r[0]*r[1]),1)),0>e&&n.setDate(this._getDaysInMonth(n.getFullYear(),n.getMonth())),this._isInRange(t,n)},_isInRange:function(t,e){var n=this._getMinMaxDate(t,"min");return t=this._getMinMaxDate(t,"max"),(!n||e.getTime()>=n.getTime())&&(!t||e.getTime()<=t.getTime())},_getFormatConfig:function(t){var e=this._get(t,"shortYearCutoff");return e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),{shortYearCutoff:e,dayNamesShort:this._get(t,"dayNamesShort"),dayNames:this._get(t,"dayNames"),monthNamesShort:this._get(t,"monthNamesShort"),monthNames:this._get(t,"monthNames")}},_formatDate:function(t,e,n,i){return e||(t.currentDay=t.selectedDay,t.currentMonth=t.selectedMonth,t.currentYear=t.selectedYear),e=e?"object"==typeof e?e:this._daylightSavingAdjust(new Date(i,n,e)):this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay)),this.formatDate(this._get(t,"dateFormat"),e,this._getFormatConfig(t))}}),d.fn.datepicker=function(t){if(!this.length)return this;d.datepicker.initialized||(d(document).mousedown(d.datepicker._checkExternalClick).find("body").append(d.datepicker.dpDiv),d.datepicker.initialized=!0);var e=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!=t&&"getDate"!=t&&"widget"!=t?"option"==t&&2==arguments.length&&"string"==typeof arguments[1]?d.datepicker["_"+t+"Datepicker"].apply(d.datepicker,[this[0]].concat(e)):this.each(function(){"string"==typeof t?d.datepicker["_"+t+"Datepicker"].apply(d.datepicker,[this].concat(e)):d.datepicker._attachDatepicker(this,t)}):d.datepicker["_"+t+"Datepicker"].apply(d.datepicker,[this[0]].concat(e))},d.datepicker=new M,d.datepicker.initialized=!1,d.datepicker.uuid=(new Date).getTime(),d.datepicker.version="1.8.16",window["DP_jQuery_"+B]=d}(jQuery),function(t,e){t.widget("ui.progressbar",{options:{value:0,max:100},min:0,_create:function(){this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min,"aria-valuemax":this.options.max,"aria-valuenow":this._value()}),this.valueDiv=t("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this.oldValue=this._value(),this._refreshValue()},destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove(),t.Widget.prototype.destroy.apply(this,arguments)},value:function(t){return t===e?this._value():(this._setOption("value",t),this)},_setOption:function(e,n){"value"===e&&(this.options.value=n,this._refreshValue(),this._value()===this.options.max&&this._trigger("complete")),t.Widget.prototype._setOption.apply(this,arguments)},_value:function(){var t=this.options.value;return"number"!=typeof t&&(t=0),Math.min(this.options.max,Math.max(this.min,t))},_percentage:function(){return 100*this._value()/this.options.max},_refreshValue:function(){var t=this.value(),e=this._percentage();this.oldValue!==t&&(this.oldValue=t,this._trigger("change")),this.valueDiv.toggle(t>this.min).toggleClass("ui-corner-right",t===this.options.max).width(e.toFixed(0)+"%"),this.element.attr("aria-valuenow",t)}}),t.extend(t.ui.progressbar,{version:"1.8.16"})}(jQuery),jQuery.effects||function(t,e){function n(e){var n;return e&&e.constructor==Array&&3==e.length?e:(n=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(e))?[parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10)]:(n=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(e))?[2.55*parseFloat(n[1]),2.55*parseFloat(n[2]),2.55*parseFloat(n[3])]:(n=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(e))?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:(n=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(e))?[parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16),parseInt(n[3]+n[3],16)]:/rgba\(0, 0, 0, 0\)/.exec(e)?c.transparent:c[t.trim(e).toLowerCase()]}function i(e,i){var r;do{if(r=t.curCSS(e,i),""!=r&&"transparent"!=r||t.nodeName(e,"body"))break;i="backgroundColor"}while(e=e.parentNode);return n(r)}function r(){var t,e,n=document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle,i={};if(n&&n.length&&n[0]&&n[n[0]])for(var r=n.length;r--;)t=n[r],"string"==typeof n[t]&&(e=t.replace(/\-(\w)/g,function(t,e){return e.toUpperCase()}),i[e]=n[t]);else for(t in n)"string"==typeof n[t]&&(i[t]=n[t]);return i}function a(e){var n,i;for(n in e)i=e[n],(null==i||t.isFunction(i)||n in d||/scrollbar/.test(n)||!/color/i.test(n)&&isNaN(parseFloat(i)))&&delete e[n];return e}function o(t,e){var n,i={_:0};for(n in e)t[n]!=e[n]&&(i[n]=e[n]);return i}function s(e,n,i,r){return"object"==typeof e&&(r=n,i=null,n=e,e=n.effect),t.isFunction(n)&&(r=n,i=null,n={}),("number"==typeof n||t.fx.speeds[n])&&(r=i,i=n,n={}),t.isFunction(i)&&(r=i,i=null),n=n||{},i=i||n.duration,i=t.fx.off?0:"number"==typeof i?i:i in t.fx.speeds?t.fx.speeds[i]:t.fx.speeds._default,r=r||n.complete,[e,n,i,r]}function l(e){return!e||"number"==typeof e||t.fx.speeds[e]?!0:"string"!=typeof e||t.effects[e]?!1:!0}t.effects={},t.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","borderColor","color","outlineColor"],function(e,r){t.fx.step[r]=function(t){t.colorInit||(t.start=i(t.elem,r),t.end=n(t.end),t.colorInit=!0),t.elem.style[r]="rgb("+Math.max(Math.min(parseInt(t.pos*(t.end[0]-t.start[0])+t.start[0],10),255),0)+","+Math.max(Math.min(parseInt(t.pos*(t.end[1]-t.start[1])+t.start[1],10),255),0)+","+Math.max(Math.min(parseInt(t.pos*(t.end[2]-t.start[2])+t.start[2],10),255),0)+")"}});var c={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]},u=["add","remove","toggle"],d={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.effects.animateClass=function(e,n,i,s){return t.isFunction(i)&&(s=i,i=null),this.queue(function(){var l,c=t(this),d=c.attr("style")||" ",h=a(r.call(this)),p=c.attr("class");t.each(u,function(t,n){e[n]&&c[n+"Class"](e[n])}),l=a(r.call(this)),c.attr("class",p),c.animate(o(h,l),{queue:!1,duration:n,easing:i,complete:function(){t.each(u,function(t,n){e[n]&&c[n+"Class"](e[n])}),"object"==typeof c.attr("style")?(c.attr("style").cssText="",c.attr("style").cssText=d):c.attr("style",d),s&&s.apply(this,arguments),t.dequeue(this)}})})},t.fn.extend({_addClass:t.fn.addClass,addClass:function(e,n,i,r){return n?t.effects.animateClass.apply(this,[{add:e},n,i,r]):this._addClass(e)},_removeClass:t.fn.removeClass,removeClass:function(e,n,i,r){return n?t.effects.animateClass.apply(this,[{remove:e},n,i,r]):this._removeClass(e)},_toggleClass:t.fn.toggleClass,toggleClass:function(n,i,r,a,o){return"boolean"==typeof i||i===e?r?t.effects.animateClass.apply(this,[i?{add:n}:{remove:n},r,a,o]):this._toggleClass(n,i):t.effects.animateClass.apply(this,[{toggle:n},i,r,a])},switchClass:function(e,n,i,r,a){return t.effects.animateClass.apply(this,[{add:n,remove:e},i,r,a])}}),t.extend(t.effects,{version:"1.8.16",save:function(t,e){for(var n=0;e.length>n;n++)null!==e[n]&&t.data("ec.storage."+e[n],t[0].style[e[n]])},restore:function(t,e){for(var n=0;e.length>n;n++)null!==e[n]&&t.css(e[n],t.data("ec.storage."+e[n]))},setMode:function(t,e){return"toggle"==e&&(e=t.is(":hidden")?"show":"hide"),e},getBaseline:function(t,e){var n;switch(t[0]){case"top":n=0;break;case"middle":n=.5;break;case"bottom":n=1;break;default:n=t[0]/e.height}switch(t[1]){case"left":t=0;break;case"center":t=.5;break;case"right":t=1;break;default:t=t[1]/e.width}return{x:t,y:n}},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var n={width:e.outerWidth(!0),height:e.outerHeight(!0),"float":e.css("float")},i=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),r=document.activeElement;return e.wrap(i),(e[0]===r||t.contains(e[0],r))&&t(r).focus(),i=e.parent(),"static"==e.css("position")?(i.css({position:"relative"}),e.css({position:"relative"})):(t.extend(n,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,i){n[i]=e.css(i),isNaN(parseInt(n[i],10))&&(n[i]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),i.css(n).show()},removeWrapper:function(e){var n,i=document.activeElement;return e.parent().is(".ui-effects-wrapper")?(n=e.parent().replaceWith(e),(e[0]===i||t.contains(e[0],i))&&t(i).focus(),n):e},setTransition:function(e,n,i,r){return r=r||{},t.each(n,function(t,n){unit=e.cssUnit(n),unit[0]>0&&(r[n]=unit[0]*i+unit[1])}),r}}),t.fn.extend({effect:function(e){var n=s.apply(this,arguments),i={options:n[1],duration:n[2],callback:n[3]};n=i.options.mode;var r=t.effects[e];return t.fx.off||!r?n?this[n](i.duration,i.callback):this.each(function(){i.callback&&i.callback.call(this)}):r.call(this,i)},_show:t.fn.show,show:function(t){if(l(t))return this._show.apply(this,arguments);var e=s.apply(this,arguments);return e[1].mode="show",this.effect.apply(this,e)},_hide:t.fn.hide,hide:function(t){if(l(t))return this._hide.apply(this,arguments);var e=s.apply(this,arguments);return e[1].mode="hide",this.effect.apply(this,e)},__toggle:t.fn.toggle,toggle:function(e){if(l(e)||"boolean"==typeof e||t.isFunction(e))return this.__toggle.apply(this,arguments);var n=s.apply(this,arguments);return n[1].mode="toggle",this.effect.apply(this,n)},cssUnit:function(e){var n=this.css(e),i=[];return t.each(["em","px","%","pt"],function(t,e){n.indexOf(e)>0&&(i=[parseFloat(n),e])}),i}}),t.easing.jswing=t.easing.swing,t.extend(t.easing,{def:"easeOutQuad",swing:function(e,n,i,r,a){return t.easing[t.easing.def](e,n,i,r,a)},easeInQuad:function(t,e,n,i,r){return i*(e/=r)*e+n},easeOutQuad:function(t,e,n,i,r){return-i*(e/=r)*(e-2)+n},easeInOutQuad:function(t,e,n,i,r){return 1>(e/=r/2)?i/2*e*e+n:-i/2*(--e*(e-2)-1)+n},easeInCubic:function(t,e,n,i,r){return i*(e/=r)*e*e+n},easeOutCubic:function(t,e,n,i,r){return i*((e=e/r-1)*e*e+1)+n},easeInOutCubic:function(t,e,n,i,r){return 1>(e/=r/2)?i/2*e*e*e+n:i/2*((e-=2)*e*e+2)+n},easeInQuart:function(t,e,n,i,r){return i*(e/=r)*e*e*e+n},easeOutQuart:function(t,e,n,i,r){return-i*((e=e/r-1)*e*e*e-1)+n},easeInOutQuart:function(t,e,n,i,r){return 1>(e/=r/2)?i/2*e*e*e*e+n:-i/2*((e-=2)*e*e*e-2)+n},easeInQuint:function(t,e,n,i,r){return i*(e/=r)*e*e*e*e+n},easeOutQuint:function(t,e,n,i,r){return i*((e=e/r-1)*e*e*e*e+1)+n},easeInOutQuint:function(t,e,n,i,r){return 1>(e/=r/2)?i/2*e*e*e*e*e+n:i/2*((e-=2)*e*e*e*e+2)+n},easeInSine:function(t,e,n,i,r){return-i*Math.cos(e/r*(Math.PI/2))+i+n},easeOutSine:function(t,e,n,i,r){return i*Math.sin(e/r*(Math.PI/2))+n},easeInOutSine:function(t,e,n,i,r){return-i/2*(Math.cos(Math.PI*e/r)-1)+n},easeInExpo:function(t,e,n,i,r){return 0==e?n:i*Math.pow(2,10*(e/r-1))+n},easeOutExpo:function(t,e,n,i,r){return e==r?n+i:i*(-Math.pow(2,-10*e/r)+1)+n},easeInOutExpo:function(t,e,n,i,r){return 0==e?n:e==r?n+i:1>(e/=r/2)?i/2*Math.pow(2,10*(e-1))+n:i/2*(-Math.pow(2,-10*--e)+2)+n},easeInCirc:function(t,e,n,i,r){return-i*(Math.sqrt(1-(e/=r)*e)-1)+n},easeOutCirc:function(t,e,n,i,r){return i*Math.sqrt(1-(e=e/r-1)*e)+n},easeInOutCirc:function(t,e,n,i,r){return 1>(e/=r/2)?-i/2*(Math.sqrt(1-e*e)-1)+n:i/2*(Math.sqrt(1-(e-=2)*e)+1)+n},easeInElastic:function(t,e,n,i,r){t=1.70158;var a=0,o=i;return 0==e?n:1==(e/=r)?n+i:(a||(a=.3*r),Math.abs(i)>o?(o=i,t=a/4):t=a/(2*Math.PI)*Math.asin(i/o),-(o*Math.pow(2,10*(e-=1))*Math.sin(2*(e*r-t)*Math.PI/a))+n)},easeOutElastic:function(t,e,n,i,r){t=1.70158;var a=0,o=i;return 0==e?n:1==(e/=r)?n+i:(a||(a=.3*r),Math.abs(i)>o?(o=i,t=a/4):t=a/(2*Math.PI)*Math.asin(i/o),o*Math.pow(2,-10*e)*Math.sin(2*(e*r-t)*Math.PI/a)+i+n)},easeInOutElastic:function(t,e,n,i,r){t=1.70158;var a=0,o=i;return 0==e?n:2==(e/=r/2)?n+i:(a||(a=1.5*.3*r),Math.abs(i)>o?(o=i,t=a/4):t=a/(2*Math.PI)*Math.asin(i/o),1>e?-.5*o*Math.pow(2,10*(e-=1))*Math.sin(2*(e*r-t)*Math.PI/a)+n:.5*o*Math.pow(2,-10*(e-=1))*Math.sin(2*(e*r-t)*Math.PI/a)+i+n)},easeInBack:function(t,n,i,r,a,o){return o==e&&(o=1.70158),r*(n/=a)*n*((o+1)*n-o)+i},easeOutBack:function(t,n,i,r,a,o){return o==e&&(o=1.70158),r*((n=n/a-1)*n*((o+1)*n+o)+1)+i},easeInOutBack:function(t,n,i,r,a,o){return o==e&&(o=1.70158),1>(n/=a/2)?r/2*n*n*(((o*=1.525)+1)*n-o)+i:r/2*((n-=2)*n*(((o*=1.525)+1)*n+o)+2)+i},easeInBounce:function(e,n,i,r,a){return r-t.easing.easeOutBounce(e,a-n,0,r,a)+i},easeOutBounce:function(t,e,n,i,r){return 1/2.75>(e/=r)?7.5625*i*e*e+n:2/2.75>e?i*(7.5625*(e-=1.5/2.75)*e+.75)+n:2.5/2.75>e?i*(7.5625*(e-=2.25/2.75)*e+.9375)+n:i*(7.5625*(e-=2.625/2.75)*e+.984375)+n},easeInOutBounce:function(e,n,i,r,a){return a/2>n?.5*t.easing.easeInBounce(e,2*n,0,r,a)+i:.5*t.easing.easeOutBounce(e,2*n-a,0,r,a)+.5*r+i}})}(jQuery),function(t){t.effects.blind=function(e){return this.queue(function(){var n=t(this),i=["position","top","bottom","left","right"],r=t.effects.setMode(n,e.options.mode||"hide"),a=e.options.direction||"vertical";t.effects.save(n,i),n.show();var o=t.effects.createWrapper(n).css({overflow:"hidden"}),s="vertical"==a?"height":"width";a="vertical"==a?o.height():o.width(),"show"==r&&o.css(s,0);var l={};l[s]="show"==r?a:0,o.animate(l,e.duration,e.options.easing,function(){"hide"==r&&n.hide(),t.effects.restore(n,i),t.effects.removeWrapper(n),e.callback&&e.callback.apply(n[0],arguments),n.dequeue()})})}}(jQuery),function(t){t.effects.bounce=function(e){return this.queue(function(){var n=t(this),i=["position","top","bottom","left","right"],r=t.effects.setMode(n,e.options.mode||"effect"),a=e.options.direction||"up",o=e.options.distance||20,s=e.options.times||5,l=e.duration||250;/show|hide/.test(r)&&i.push("opacity"),t.effects.save(n,i),n.show(),t.effects.createWrapper(n);var c="up"==a||"down"==a?"top":"left";if(a="up"==a||"left"==a?"pos":"neg",o=e.options.distance||("top"==c?n.outerHeight({margin:!0})/3:n.outerWidth({margin:!0})/3),"show"==r&&n.css("opacity",0).css(c,"pos"==a?-o:o),"hide"==r&&(o/=2*s),"hide"!=r&&s--,"show"==r){var u={opacity:1};u[c]=("pos"==a?"+=":"-=")+o,n.animate(u,l/2,e.options.easing),o/=2,s--}for(u=0;s>u;u++){var d={},h={};d[c]=("pos"==a?"-=":"+=")+o,h[c]=("pos"==a?"+=":"-=")+o,n.animate(d,l/2,e.options.easing).animate(h,l/2,e.options.easing),o="hide"==r?2*o:o/2}"hide"==r?(u={opacity:0},u[c]=("pos"==a?"-=":"+=")+o,n.animate(u,l/2,e.options.easing,function(){n.hide(),t.effects.restore(n,i),t.effects.removeWrapper(n),e.callback&&e.callback.apply(this,arguments)})):(d={},h={},d[c]=("pos"==a?"-=":"+=")+o,h[c]=("pos"==a?"+=":"-=")+o,n.animate(d,l/2,e.options.easing).animate(h,l/2,e.options.easing,function(){t.effects.restore(n,i),t.effects.removeWrapper(n),e.callback&&e.callback.apply(this,arguments)})),n.queue("fx",function(){n.dequeue()}),n.dequeue()})}}(jQuery),function(t){t.effects.clip=function(e){return this.queue(function(){var n=t(this),i=["position","top","bottom","left","right","height","width"],r=t.effects.setMode(n,e.options.mode||"hide"),a=e.options.direction||"vertical";t.effects.save(n,i),n.show();var o=t.effects.createWrapper(n).css({overflow:"hidden"});o="IMG"==n[0].tagName?o:n;var s={size:"vertical"==a?"height":"width",position:"vertical"==a?"top":"left"};a="vertical"==a?o.height():o.width(),"show"==r&&(o.css(s.size,0),o.css(s.position,a/2));var l={};l[s.size]="show"==r?a:0,l[s.position]="show"==r?0:a/2,o.animate(l,{queue:!1,duration:e.duration,easing:e.options.easing,complete:function(){"hide"==r&&n.hide(),t.effects.restore(n,i),t.effects.removeWrapper(n),e.callback&&e.callback.apply(n[0],arguments),n.dequeue()}})})}}(jQuery),function(t){t.effects.drop=function(e){return this.queue(function(){var n=t(this),i=["position","top","bottom","left","right","opacity"],r=t.effects.setMode(n,e.options.mode||"hide"),a=e.options.direction||"left";t.effects.save(n,i),n.show(),t.effects.createWrapper(n);var o="up"==a||"down"==a?"top":"left";a="up"==a||"left"==a?"pos":"neg";var s=e.options.distance||("top"==o?n.outerHeight({margin:!0})/2:n.outerWidth({margin:!0})/2);"show"==r&&n.css("opacity",0).css(o,"pos"==a?-s:s);var l={opacity:"show"==r?1:0};l[o]=("show"==r?"pos"==a?"+=":"-=":"pos"==a?"-=":"+=")+s,n.animate(l,{queue:!1,duration:e.duration,easing:e.options.easing,complete:function(){"hide"==r&&n.hide(),t.effects.restore(n,i),t.effects.removeWrapper(n),e.callback&&e.callback.apply(this,arguments),n.dequeue()}})})}}(jQuery),function(t){t.effects.explode=function(e){return this.queue(function(){var n=e.options.pieces?Math.round(Math.sqrt(e.options.pieces)):3,i=e.options.pieces?Math.round(Math.sqrt(e.options.pieces)):3;e.options.mode="toggle"==e.options.mode?t(this).is(":visible")?"hide":"show":e.options.mode;var r=t(this).show().css("visibility","hidden"),a=r.offset();a.top-=parseInt(r.css("marginTop"),10)||0,a.left-=parseInt(r.css("marginLeft"),10)||0;for(var o=r.outerWidth(!0),s=r.outerHeight(!0),l=0;n>l;l++)for(var c=0;i>c;c++)r.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-c*(o/i),top:-l*(s/n)}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:o/i,height:s/n,left:a.left+c*(o/i)+("show"==e.options.mode?(c-Math.floor(i/2))*(o/i):0),top:a.top+l*(s/n)+("show"==e.options.mode?(l-Math.floor(n/2))*(s/n):0),opacity:"show"==e.options.mode?0:1}).animate({left:a.left+c*(o/i)+("show"==e.options.mode?0:(c-Math.floor(i/2))*(o/i)),top:a.top+l*(s/n)+("show"==e.options.mode?0:(l-Math.floor(n/2))*(s/n)),opacity:"show"==e.options.mode?1:0},e.duration||500);setTimeout(function(){"show"==e.options.mode?r.css({visibility:"visible"}):r.css({visibility:"visible"}).hide(),e.callback&&e.callback.apply(r[0]),r.dequeue(),t("div.ui-effects-explode").remove()},e.duration||500)})}}(jQuery),function(t){t.effects.fade=function(e){return this.queue(function(){var n=t(this),i=t.effects.setMode(n,e.options.mode||"hide");n.animate({opacity:i},{queue:!1,duration:e.duration,easing:e.options.easing,complete:function(){e.callback&&e.callback.apply(this,arguments),n.dequeue()}})})}}(jQuery),function(t){t.effects.fold=function(e){return this.queue(function(){var n=t(this),i=["position","top","bottom","left","right"],r=t.effects.setMode(n,e.options.mode||"hide"),a=e.options.size||15,o=!!e.options.horizFirst,s=e.duration?e.duration/2:t.fx.speeds._default/2;t.effects.save(n,i),n.show();var l=t.effects.createWrapper(n).css({overflow:"hidden"}),c="show"==r!=o,u=c?["width","height"]:["height","width"];c=c?[l.width(),l.height()]:[l.height(),l.width()];var d=/([0-9]+)%/.exec(a);d&&(a=parseInt(d[1],10)/100*c["hide"==r?0:1]),"show"==r&&l.css(o?{height:0,width:a}:{height:a,width:0}),o={},d={},o[u[0]]="show"==r?c[0]:a,d[u[1]]="show"==r?c[1]:0,l.animate(o,s,e.options.easing).animate(d,s,e.options.easing,function(){"hide"==r&&n.hide(),t.effects.restore(n,i),t.effects.removeWrapper(n),e.callback&&e.callback.apply(n[0],arguments),n.dequeue()})
})}}(jQuery),function(t){t.effects.highlight=function(e){return this.queue(function(){var n=t(this),i=["backgroundImage","backgroundColor","opacity"],r=t.effects.setMode(n,e.options.mode||"show"),a={backgroundColor:n.css("backgroundColor")};"hide"==r&&(a.opacity=0),t.effects.save(n,i),n.show().css({backgroundImage:"none",backgroundColor:e.options.color||"#ffff99"}).animate(a,{queue:!1,duration:e.duration,easing:e.options.easing,complete:function(){"hide"==r&&n.hide(),t.effects.restore(n,i),"show"==r&&!t.support.opacity&&this.style.removeAttribute("filter"),e.callback&&e.callback.apply(this,arguments),n.dequeue()}})})}}(jQuery),function(t){t.effects.pulsate=function(e){return this.queue(function(){var n=t(this),i=t.effects.setMode(n,e.options.mode||"show");for(times=2*(e.options.times||5)-1,duration=e.duration?e.duration/2:t.fx.speeds._default/2,isVisible=n.is(":visible"),animateTo=0,isVisible||(n.css("opacity",0).show(),animateTo=1),("hide"==i&&isVisible||"show"==i&&!isVisible)&&times--,i=0;times>i;i++)n.animate({opacity:animateTo},duration,e.options.easing),animateTo=(animateTo+1)%2;n.animate({opacity:animateTo},duration,e.options.easing,function(){0==animateTo&&n.hide(),e.callback&&e.callback.apply(this,arguments)}),n.queue("fx",function(){n.dequeue()}).dequeue()})}}(jQuery),function(t){t.effects.puff=function(e){return this.queue(function(){var n=t(this),i=t.effects.setMode(n,e.options.mode||"hide"),r=parseInt(e.options.percent,10)||150,a=r/100,o={height:n.height(),width:n.width()};t.extend(e.options,{fade:!0,mode:i,percent:"hide"==i?r:100,from:"hide"==i?o:{height:o.height*a,width:o.width*a}}),n.effect("scale",e.options,e.duration,e.callback),n.dequeue()})},t.effects.scale=function(e){return this.queue(function(){var n=t(this),i=t.extend(!0,{},e.options),r=t.effects.setMode(n,e.options.mode||"effect"),a=parseInt(e.options.percent,10)||(0==parseInt(e.options.percent,10)?0:"hide"==r?0:100),o=e.options.direction||"both",s=e.options.origin;"effect"!=r&&(i.origin=s||["middle","center"],i.restore=!0),s={height:n.height(),width:n.width()},n.from=e.options.from||("show"==r?{height:0,width:0}:s),a={y:"horizontal"!=o?a/100:1,x:"vertical"!=o?a/100:1},n.to={height:s.height*a.y,width:s.width*a.x},e.options.fade&&("show"==r&&(n.from.opacity=0,n.to.opacity=1),"hide"==r&&(n.from.opacity=1,n.to.opacity=0)),i.from=n.from,i.to=n.to,i.mode=r,n.effect("size",i,e.duration,e.callback),n.dequeue()})},t.effects.size=function(e){return this.queue(function(){var n=t(this),i=["position","top","bottom","left","right","width","height","overflow","opacity"],r=["position","top","bottom","left","right","overflow","opacity"],a=["width","height","overflow"],o=["fontSize"],s=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],l=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],c=t.effects.setMode(n,e.options.mode||"effect"),u=e.options.restore||!1,d=e.options.scale||"both",h=e.options.origin,p={height:n.height(),width:n.width()};n.from=e.options.from||p,n.to=e.options.to||p,h&&(h=t.effects.getBaseline(h,p),n.from.top=(p.height-n.from.height)*h.y,n.from.left=(p.width-n.from.width)*h.x,n.to.top=(p.height-n.to.height)*h.y,n.to.left=(p.width-n.to.width)*h.x);var f={from:{y:n.from.height/p.height,x:n.from.width/p.width},to:{y:n.to.height/p.height,x:n.to.width/p.width}};("box"==d||"both"==d)&&(f.from.y!=f.to.y&&(i=i.concat(s),n.from=t.effects.setTransition(n,s,f.from.y,n.from),n.to=t.effects.setTransition(n,s,f.to.y,n.to)),f.from.x!=f.to.x&&(i=i.concat(l),n.from=t.effects.setTransition(n,l,f.from.x,n.from),n.to=t.effects.setTransition(n,l,f.to.x,n.to))),("content"==d||"both"==d)&&f.from.y!=f.to.y&&(i=i.concat(o),n.from=t.effects.setTransition(n,o,f.from.y,n.from),n.to=t.effects.setTransition(n,o,f.to.y,n.to)),t.effects.save(n,u?i:r),n.show(),t.effects.createWrapper(n),n.css("overflow","hidden").css(n.from),("content"==d||"both"==d)&&(s=s.concat(["marginTop","marginBottom"]).concat(o),l=l.concat(["marginLeft","marginRight"]),a=i.concat(s).concat(l),n.find("*[width]").each(function(){child=t(this),u&&t.effects.save(child,a);var n={height:child.height(),width:child.width()};child.from={height:n.height*f.from.y,width:n.width*f.from.x},child.to={height:n.height*f.to.y,width:n.width*f.to.x},f.from.y!=f.to.y&&(child.from=t.effects.setTransition(child,s,f.from.y,child.from),child.to=t.effects.setTransition(child,s,f.to.y,child.to)),f.from.x!=f.to.x&&(child.from=t.effects.setTransition(child,l,f.from.x,child.from),child.to=t.effects.setTransition(child,l,f.to.x,child.to)),child.css(child.from),child.animate(child.to,e.duration,e.options.easing,function(){u&&t.effects.restore(child,a)})})),n.animate(n.to,{queue:!1,duration:e.duration,easing:e.options.easing,complete:function(){0===n.to.opacity&&n.css("opacity",n.from.opacity),"hide"==c&&n.hide(),t.effects.restore(n,u?i:r),t.effects.removeWrapper(n),e.callback&&e.callback.apply(this,arguments),n.dequeue()}})})}}(jQuery),function(t){t.effects.shake=function(e){return this.queue(function(){var n=t(this),i=["position","top","bottom","left","right"];t.effects.setMode(n,e.options.mode||"effect");var r=e.options.direction||"left",a=e.options.distance||20,o=e.options.times||3,s=e.duration||e.options.duration||140;t.effects.save(n,i),n.show(),t.effects.createWrapper(n);var l="up"==r||"down"==r?"top":"left",c="up"==r||"left"==r?"pos":"neg";r={};var u={},d={};for(r[l]=("pos"==c?"-=":"+=")+a,u[l]=("pos"==c?"+=":"-=")+2*a,d[l]=("pos"==c?"-=":"+=")+2*a,n.animate(r,s,e.options.easing),a=1;o>a;a++)n.animate(u,s,e.options.easing).animate(d,s,e.options.easing);n.animate(u,s,e.options.easing).animate(r,s/2,e.options.easing,function(){t.effects.restore(n,i),t.effects.removeWrapper(n),e.callback&&e.callback.apply(this,arguments)}),n.queue("fx",function(){n.dequeue()}),n.dequeue()})}}(jQuery),function(t){t.effects.slide=function(e){return this.queue(function(){var n=t(this),i=["position","top","bottom","left","right"],r=t.effects.setMode(n,e.options.mode||"show"),a=e.options.direction||"left";t.effects.save(n,i),n.show(),t.effects.createWrapper(n).css({overflow:"hidden"});var o="up"==a||"down"==a?"top":"left";a="up"==a||"left"==a?"pos":"neg";var s=e.options.distance||("top"==o?n.outerHeight({margin:!0}):n.outerWidth({margin:!0}));"show"==r&&n.css(o,"pos"==a?isNaN(s)?"-"+s:-s:s);var l={};l[o]=("show"==r?"pos"==a?"+=":"-=":"pos"==a?"-=":"+=")+s,n.animate(l,{queue:!1,duration:e.duration,easing:e.options.easing,complete:function(){"hide"==r&&n.hide(),t.effects.restore(n,i),t.effects.removeWrapper(n),e.callback&&e.callback.apply(this,arguments),n.dequeue()}})})}}(jQuery),function(t){t.effects.transfer=function(e){return this.queue(function(){var n=t(this),i=t(e.options.to),r=i.offset();i={top:r.top,left:r.left,height:i.innerHeight(),width:i.innerWidth()},r=n.offset();var a=t('<div class="ui-effects-transfer"></div>').appendTo(document.body).addClass(e.options.className).css({top:r.top,left:r.left,height:n.innerHeight(),width:n.innerWidth(),position:"absolute"}).animate(i,e.duration,e.options.easing,function(){a.remove(),e.callback&&e.callback.apply(n[0],arguments),n.dequeue()})})}}(jQuery),function(t){var e,n=[],i=function(){for(var i=0;n.length>i;i++)if(t(n[i][0])[0]&&(n[i][2]||t(n[i][0]).next()[0]||t.isReady)){try{n[i][1].apply(t(n[i][0]).eq(0))}catch(r){"undefined"!=typeof console&&console.log(r)}n.splice(i,1),i--}(!n.length||t.isReady)&&(e=clearInterval(e))};t.fn.available=function(t,r){return r=r||!1,n.push([this.selector,t,r]),e||(e=setInterval(i,1)),this}}(jQuery),function(t){t.fn.fitText=function(e,n){var i={minFontSize:Number.NEGATIVE_INFINITY,maxFontSize:Number.POSITIVE_INFINITY};return this.each(function(){var r=t(this),a=e||1;n&&t.extend(i,n);var o=function(){r.css("font-size",Math.max(Math.min(r.width()/(10*a),parseFloat(i.maxFontSize)),parseFloat(i.minFontSize)))};o(),t(window).resize(o)})}}(jQuery),jQuery.fn.autoSize=function(){return this.each(function(){var t=this.scrollHeight,e=function(){n(this)},n=function(e){var n=e.scrollHeight;n!==t&&(e.style.height=n+"px",t=n)};this.style.overflow="hidden",this.onkeydown=e,this.onfocus=e,this.onblur=e,this.onchange=e})},function(t){t.fn.numeric=function(e,n){"boolean"==typeof e&&(e={decimal:e}),e=e||{},e.negative===void 0&&(e.negative=!0);var i=e.decimal===!1?"":e.decimal||".",r=e.negative===!0?!0:!1,n="function"==typeof n?n:function(){};return this.data("numeric.decimal",i).data("numeric.negative",r).data("numeric.callback",n).keypress(t.fn.numeric.keypress).keyup(t.fn.numeric.keyup).blur(t.fn.numeric.blur)},t.fn.numeric.keypress=function(e){var n=t.data(this,"numeric.decimal"),i=t.data(this,"numeric.negative"),r=e.charCode?e.charCode:e.keyCode?e.keyCode:0;if(13==r&&"input"==this.nodeName.toLowerCase())return!0;if(13==r)return!1;var a=!1;if(e.ctrlKey&&97==r||e.ctrlKey&&65==r)return!0;if(e.ctrlKey&&120==r||e.ctrlKey&&88==r)return!0;if(e.ctrlKey&&99==r||e.ctrlKey&&67==r)return!0;if(e.ctrlKey&&122==r||e.ctrlKey&&90==r)return!0;if(e.ctrlKey&&118==r||e.ctrlKey&&86==r||e.shiftKey&&45==r)return!0;if(48>r||r>57){if(0!=this.value.indexOf("-")&&i&&45==r&&(0==this.value.length||0==t.fn.getSelectionStart(this)))return!0;n&&r==n.charCodeAt(0)&&-1!=this.value.indexOf(n)&&(a=!1),8!=r&&9!=r&&13!=r&&35!=r&&36!=r&&37!=r&&39!=r&&46!=r?a=!1:e.charCode!==void 0&&(e.keyCode==e.which&&0!=e.which?(a=!0,46==e.which&&(a=!1)):0!=e.keyCode&&0==e.charCode&&0==e.which&&(a=!0)),n&&r==n.charCodeAt(0)&&(a=-1==this.value.indexOf(n)?!0:!1)}else a=!0;return a},t.fn.numeric.keyup=function(){var e=this.value;if(e.length>0){var n=t.fn.getSelectionStart(this),i=t.data(this,"numeric.decimal"),r=t.data(this,"numeric.negative");if(""!=i){var a=e.indexOf(i);0==a&&(this.value="0"+e),1==a&&"-"==e.charAt(0)&&(this.value="-0"+e.substring(1)),e=this.value}for(var o=[0,1,2,3,4,5,6,7,8,9,"-",i],s=e.length,l=s-1;l>=0;l--){var c=e.charAt(l);0!=l&&"-"==c?e=e.substring(0,l)+e.substring(l+1):0!=l||r||"-"!=c||(e=e.substring(1));for(var u=!1,d=0;o.length>d;d++)if(c==o[d]){u=!0;break}u&&" "!=c||(e=e.substring(0,l)+e.substring(l+1))}var h=e.indexOf(i);if(h>0)for(var l=s-1;l>h;l--){var c=e.charAt(l);c==i&&(e=e.substring(0,l)+e.substring(l+1))}this.value=e,t.fn.setSelection(this,n)}},t.fn.numeric.blur=function(){var e=t.data(this,"numeric.decimal"),n=t.data(this,"numeric.callback"),i=this.value;if(""!=i){var r=RegExp("^\\d+$|\\d*"+e+"\\d+");r.exec(i)||n.apply(this)}},t.fn.removeNumeric=function(){return this.data("numeric.decimal",null).data("numeric.negative",null).data("numeric.callback",null).unbind("keypress",t.fn.numeric.keypress).unbind("blur",t.fn.numeric.blur)},t.fn.getSelectionStart=function(t){if(t.createTextRange){var e=document.selection.createRange().duplicate();return e.moveEnd("character",t.value.length),""==e.text?t.value.length:t.value.lastIndexOf(e.text)}return t.selectionStart},t.fn.setSelection=function(t,e){if("number"==typeof e&&(e=[e,e]),e&&e.constructor==Array&&2==e.length)if(t.createTextRange){var n=t.createTextRange();n.collapse(!0),n.moveStart("character",e[0]),n.moveEnd("character",e[1]),n.select()}else t.setSelectionRange&&(t.focus(),t.setSelectionRange(e[0],e[1]))}}(jQuery),window.Seadragon||(window.Seadragon={});var Seadragon=window.Seadragon,SeadragonConfig=Seadragon.Config;(function(){SeadragonConfig||(SeadragonConfig=Seadragon.Config={debugMode:!1,animationTime:1.5,blendTime:.5,alwaysBlend:!1,autoHideControls:!0,constrainDuringPan:!0,immediateRender:!1,logarithmicZoom:!0,wrapHorizontal:!1,wrapVertical:!1,wrapOverlays:!1,transformOverlays:!1,minZoomDimension:null,minZoomImageRatio:.8,maxZoomPixelRatio:2,visibilityRatio:.8,springStiffness:5,imageLoaderLimit:2,clickTimeThreshold:200,clickDistThreshold:25,zoomPerClick:2,zoomPerScroll:Math.pow(2,1/3),zoomPerSecond:2,proxyUrl:null,imagePath:"img/",fps:60})})();var SeadragonStrings=Seadragon.Strings;(function(){SeadragonStrings||(SeadragonStrings=Seadragon.Strings={Errors:{Failure:"Sorry, but Seadragon Ajax can't run on your browser!\nPlease try using IE 8 or Firefox 3.\n",Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Empty:"You asked us to open nothing, so we did just that.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",Unknown:"Whoops, something inexplicably went wrong. Sorry!"},Messages:{Loading:"Loading..."},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in (you can also use your mouse's scroll wheel)",ZoomOut:"Zoom out (you can also use your mouse's scroll wheel)"}},SeadragonStrings.getString=function(t){for(var e=t.split("."),n=SeadragonStrings,i=0;e.length>i;i++)n=n[e[i]]||{};"string"!=typeof n&&(n="");var r=arguments;return n.replace(/\{\d+\}/g,function(t){var e=parseInt(t.match(/\d+/))+1;return r.length>e?r[e]:""})},SeadragonStrings.setString=function(t,e){for(var n=t.split("."),i=SeadragonStrings,r=0;n.length-1>r;r++)i[n[r]]||(i[n[r]]={}),i=i[n[r]];i[n[r]]=e})})();var SeadragonDebug=function(){this.log=function(t,e){var n=window.console||{},i=SeadragonConfig.debugMode;i&&n.log?n.log(t):i&&e&&alert(t)},this.error=function(t,e){var n=window.console||{},i=SeadragonConfig.debugMode;if(i&&n.error?n.error(t):i&&alert(t),i)throw e||Error(t)},this.fail=function(t){throw alert(SeadragonStrings.getString("Errors.Failure")),Error(t)}};SeadragonDebug=Seadragon.Debug=new SeadragonDebug;var SeadragonProfiler=Seadragon.Profiler=function(){var t=this,e=!1,n=0,i=null,r=null,a=1/0,o=0,s=0,l=1/0,c=0,u=0;this.getAvgUpdateTime=function(){return o},this.getMinUpdateTime=function(){return a},this.getMaxUpdateTime=function(){return s},this.getAvgIdleTime=function(){return c},this.getMinIdleTime=function(){return l},this.getMaxIdleTime=function(){return u},this.isMidUpdate=function(){return e},this.getNumUpdates=function(){return n},this.beginUpdate=function(){if(e&&t.endUpdate(),e=!0,i=Date.now(),!(1>n)){var a=i-r;c=(c*(n-1)+a)/n,l>a&&(l=a),a>u&&(u=a)}},this.endUpdate=function(){if(e){r=Date.now(),e=!1;var t=r-i;n++,o=(o*(n-1)+t)/n,a>t&&(a=t),t>s&&(s=t)}},this.clearProfile=function(){e=!1,n=0,i=null,r=null,a=1/0,o=0,s=0,l=1/0,c=0,u=0}},SeadragonPoint=Seadragon.Point;(function(){if(!SeadragonPoint){SeadragonPoint=Seadragon.Point=function(t,e){this.x="number"==typeof t?t:0,this.y="number"==typeof e?e:0};var t=SeadragonPoint.prototype;t.plus=function(t){return new SeadragonPoint(this.x+t.x,this.y+t.y)},t.minus=function(t){return new SeadragonPoint(this.x-t.x,this.y-t.y)},t.times=function(t){return new SeadragonPoint(this.x*t,this.y*t)},t.divide=function(t){return new SeadragonPoint(this.x/t,this.y/t)},t.negate=function(){return new SeadragonPoint(-this.x,-this.y)},t.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},t.distance2To=function(t){return Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)},t.apply=function(t){return new SeadragonPoint(t(this.x),t(this.y))},t.equals=function(t){return t instanceof SeadragonPoint&&this.x===t.x&&this.y===t.y},t.toString=function(){return"("+this.x+","+this.y+")"}}})();var SeadragonRect=Seadragon.Rect;(function(){if(!SeadragonRect){SeadragonRect=Seadragon.Rect=function(t,e,n,i){this.x="number"==typeof t?t:0,this.y="number"==typeof e?e:0,this.width="number"==typeof n?n:0,this.height="number"==typeof i?i:0};var t=SeadragonRect.prototype;t.getAspectRatio=function(){return this.width/this.height},t.getTopLeft=function(){return new SeadragonPoint(this.x,this.y)},t.getBottomRight=function(){return new SeadragonPoint(this.x+this.width,this.y+this.height)},t.getCenter=function(){return new SeadragonPoint(this.x+this.width/2,this.y+this.height/2)},t.getSize=function(){return new SeadragonPoint(this.width,this.height)},t.equals=function(t){return t instanceof SeadragonRect&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},t.toString=function(){return"["+this.x+","+this.y+","+this.width+"x"+this.height+"]"}}})();var SeadragonSpring=Seadragon.Spring=function(t){function e(t){var e=SeadragonConfig.springStiffness;return(1-Math.exp(-t*e))/(1-Math.exp(-e))}var n="number"==typeof t?t:0,i=n,r=n,a=Date.now(),o=a,s=a;this.getCurrent=function(){return n},this.getTarget=function(){return r},this.resetTo=function(t){r=t,s=a,i=r,o=s},this.springTo=function(t){i=n,o=a,r=t,s=o+1e3*SeadragonConfig.animationTime},this.shiftBy=function(t){i+=t,r+=t},this.update=function(){a=Date.now(),n=a>=s?r:i+(r-i)*e((a-o)/(s-o))}},SeadragonBrowser=Seadragon.Browser={UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},SeadragonUtils=function(){function t(t,e){return e&&t!=document.body?document.body:t.offsetParent}var e=this,n={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},i=SeadragonBrowser.UNKNOWN,r=0,a=!1,o={};(function(){var t=navigator.appName,e=navigator.appVersion,n=navigator.userAgent;if("Microsoft Internet Explorer"==t&&window.attachEvent&&window.ActiveXObject){var s=n.indexOf("MSIE");i=SeadragonBrowser.IE,r=parseFloat(n.substring(s+5,n.indexOf(";",s)));var l=document.documentMode;l!==void 0&&(r=l)}else if("Netscape"==t&&window.addEventListener){var c=n.indexOf("Firefox"),u=n.indexOf("Safari"),d=n.indexOf("Chrome");if(c>=0)i=SeadragonBrowser.FIREFOX,r=parseFloat(n.substring(c+8));else if(u>=0){var h=n.substring(0,u).lastIndexOf("/");i=d>=0?SeadragonBrowser.CHROME:SeadragonBrowser.SAFARI,r=parseFloat(n.substring(h+1,u))}}else"Opera"==t&&window.opera&&window.attachEvent&&(i=SeadragonBrowser.OPERA,r=parseFloat(e));for(var p=window.location.search.substring(1),f=p.split("&"),g=0;f.length>g;g++){var m=f[g],v=m.indexOf("=");v>0&&(o[m.substring(0,v)]=decodeURIComponent(m.substring(v+1)))}a=i==SeadragonBrowser.IE&&9>r||i==SeadragonBrowser.CHROME&&2>r})(),this.getBrowser=function(){return i},this.getBrowserVersion=function(){return r},this.getElement=function(t){return"string"==typeof t&&(t=document.getElementById(t)),t},this.getElementPosition=function(n){for(var n=e.getElement(n),i=new SeadragonPoint,r="fixed"==e.getElementStyle(n).position,a=t(n,r);a;)i.x+=n.offsetLeft,i.y+=n.offsetTop,r&&(i=i.plus(e.getPageScroll())),n=a,r="fixed"==e.getElementStyle(n).position,a=t(n,r);return i},this.getElementSize=function(t){var t=e.getElement(t);return new SeadragonPoint(t.clientWidth,t.clientHeight)},this.getElementStyle=function(t){var t=e.getElement(t);return t.currentStyle?t.currentStyle:window.getComputedStyle?window.getComputedStyle(t,""):(SeadragonDebug.fail("Unknown element style, no known technique."),void 0)},this.getEvent=function(t){return t?t:window.event},this.getMousePosition=function(t){var t=e.getEvent(t),n=new SeadragonPoint;return"DOMMouseScroll"==t.type&&i==SeadragonBrowser.FIREFOX&&3>r?(n.x=t.screenX,n.y=t.screenY):"number"==typeof t.pageX?(n.x=t.pageX,n.y=t.pageY):"number"==typeof t.clientX?(n.x=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n.y=t.clientY+document.body.scrollTop+document.documentElement.scrollTop):SeadragonDebug.fail("Unknown event mouse position, no known technique."),n},this.getMouseScroll=function(t){var t=e.getEvent(t),n=0;return"number"==typeof t.wheelDelta?n=t.wheelDelta:"number"==typeof t.detail?n=-1*t.detail:SeadragonDebug.fail("Unknown event mouse scroll, no known technique."),n?n/Math.abs(n):0},this.getPageScroll=function(){var t=new SeadragonPoint,e=document.documentElement||{},n=document.body||{};return"number"==typeof window.pageXOffset?(t.x=window.pageXOffset,t.y=window.pageYOffset):n.scrollLeft||n.scrollTop?(t.x=n.scrollLeft,t.y=n.scrollTop):(e.scrollLeft||e.scrollTop)&&(t.x=e.scrollLeft,t.y=e.scrollTop),t},this.getWindowSize=function(){var t=new SeadragonPoint,e=document.documentElement||{},n=document.body||{};return"number"==typeof window.innerWidth?(t.x=window.innerWidth,t.y=window.innerHeight):e.clientWidth||e.clientHeight?(t.x=e.clientWidth,t.y=e.clientHeight):n.clientWidth||n.clientHeight?(t.x=n.clientWidth,t.y=n.clientHeight):SeadragonDebug.fail("Unknown window size, no known technique."),t},this.imageFormatSupported=function(t){var t=t?t:"";return!!n[t.toLowerCase()]},this.makeCenteredNode=function(t){var t=SeadragonUtils.getElement(t),n=e.makeNeutralElement("div"),i=[];i.push('<div style="display:table; height:100%; width:100%;'),i.push("border:none; margin:0px; padding:0px;"),i.push('#position:relative; overflow:hidden; text-align:left;">'),i.push('<div style="#position:absolute; #top:50%; width:100%; '),i.push("border:none; margin:0px; padding:0px;"),i.push('display:table-cell; vertical-align:middle;">'),i.push('<div style="#position:relative; #top:-50%; width:100%; '),i.push("border:none; margin:0px; padding:0px;"),i.push('text-align:center;"></div></div></div>'),n.innerHTML=i.join(""),n=n.firstChild;for(var r=n,a=n.getElementsByTagName("div");a.length>0;)r=a[0],a=r.getElementsByTagName("div");return r.appendChild(t),n},this.makeNeutralElement=function(t){var e=document.createElement(t),n=e.style;return n.background="transparent none",n.border="none",n.margin="0px",n.padding="0px",n.position="static",e},this.makeTransparentImage=function(t){var n=e.makeNeutralElement("img"),a=null;return i==SeadragonBrowser.IE&&7>r?(a=e.makeNeutralElement("span"),a.style.display="inline-block",n.onload=function(){a.style.width=a.style.width||n.width+"px",a.style.height=a.style.height||n.height+"px",n.onload=null,n=null},n.src=t,a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+t+"', sizingMethod='scale')"):(a=n,a.src=t),a},this.setElementOpacity=function(t,n,i){var t=e.getElement(t);i&&a&&(n=Math.round(n)),t.style.opacity=1>n?n:"";var r=t.style.filter||"";if(t.style.filter=r.replace(/[\s]*alpha\(.*?\)[\s]*/g,""),!(n>=1)){var o=Math.round(100*n),s=" alpha(opacity="+o+") ";t.style.filter+=s}},this.addEvent=function(t,n,i,r){var t=e.getElement(t);t.addEventListener?("mousewheel"==n&&t.addEventListener("DOMMouseScroll",i,r),t.addEventListener(n,i,r)):t.attachEvent?(t.attachEvent("on"+n,i),r&&t.setCapture&&t.setCapture()):SeadragonDebug.fail("Unable to attach event handler, no known technique.")},this.removeEvent=function(t,n,i,r){var t=e.getElement(t);t.removeEventListener?("mousewheel"==n&&t.removeEventListener("DOMMouseScroll",i,r),t.removeEventListener(n,i,r)):t.detachEvent?(t.detachEvent("on"+n,i),r&&t.releaseCapture&&t.releaseCapture()):SeadragonDebug.fail("Unable to detach event handler, no known technique.")},this.cancelEvent=function(t){var t=e.getEvent(t);t.preventDefault&&t.preventDefault(),t.cancel=!0,t.returnValue=!1},this.stopEvent=function(t){var t=e.getEvent(t);t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0},this.createCallback=function(t,e){for(var n=[],i=2;arguments.length>i;i++)n.push(arguments[i]);return function(){for(var i=n.concat([]),r=0;arguments.length>r;r++)i.push(arguments[r]);return e.apply(t,i)}},this.getUrlParameter=function(t){var e=o[t];return e?e:null},this.makeAjaxRequest=function(t,e){var n="function"==typeof e,i=null;if(n)var r=e,e=function(){window.setTimeout(SeadragonUtils.createCallback(null,r,i),1)};window.XMLHttpRequest&&(i=new XMLHttpRequest),i||SeadragonDebug.fail("Browser doesn't support XMLHttpRequest."),SeadragonConfig.proxyUrl&&(t=SeadragonConfig.proxyUrl+t),n&&(i.onreadystatechange=function(){4==i.readyState&&(i.onreadystatechange=Function(),e())});try{i.open("GET",t,n),i.send(null)}catch(a){SeadragonDebug.log(a.name+" while making AJAX request: "+a.message),i.onreadystatechange=null,i=null,n&&e()}return n?null:i},this.parseXml=function(t){var e=null;if(window.ActiveXObject)try{e=new ActiveXObject("Microsoft.XMLDOM"),e.async=!1,e.loadXML(t)}catch(n){SeadragonDebug.log(n.name+" while parsing XML (ActiveX): "+n.message),console.log("error creating ActiveXObject in Seadragon.Utils parseXml")}else if(window.DOMParser)try{var i=new DOMParser;e=i.parseFromString(t,"text/xml")}catch(n){SeadragonDebug.log(n.name+" while parsing XML (DOMParser): "+n.message)}else SeadragonDebug.fail("Browser doesn't support XML DOM.");return e}};SeadragonUtils=Seadragon.Utils=new SeadragonUtils;var SeadragonMouseTracker=Seadragon.MouseTracker;(function(){function t(t){return SeadragonUtils.getMousePosition(t)}function e(t,e){var n=SeadragonUtils.getMousePosition(t),i=SeadragonUtils.getElementPosition(e);return n.minus(i)}function n(t,e){for(var n=document.body;e&&t!=e&&n!=e;)try{e=e.parentNode}catch(i){return!1}return t==e}function i(){o=!0}function r(){o=!1}if(!SeadragonMouseTracker){var a=SeadragonUtils.getBrowser()==SeadragonBrowser.IE&&9>SeadragonUtils.getBrowserVersion(),o=!1,s=!1,l={},c=[];(function(){a?(SeadragonUtils.addEvent(document,"mousedown",i,!1),SeadragonUtils.addEvent(document,"mouseup",r,!1)):(SeadragonUtils.addEvent(window,"mousedown",i,!0),SeadragonUtils.addEvent(window,"mouseup",r,!0))})(),SeadragonMouseTracker=Seadragon.MouseTracker=function(i){function r(){M||(SeadragonUtils.addEvent(i,"mouseover",g,!1),SeadragonUtils.addEvent(i,"mouseout",m,!1),SeadragonUtils.addEvent(i,"mousedown",v,!1),SeadragonUtils.addEvent(i,"mouseup",y,!1),SeadragonUtils.addEvent(i,"mousewheel",_,!1),SeadragonUtils.addEvent(i,"click",T,!1),M=!0,l[S]=E)}function u(){M&&(SeadragonUtils.removeEvent(i,"mouseover",g,!1),SeadragonUtils.removeEvent(i,"mouseout",m,!1),SeadragonUtils.removeEvent(i,"mousedown",v,!1),SeadragonUtils.removeEvent(i,"mouseup",y,!1),SeadragonUtils.removeEvent(i,"mousewheel",_,!1),SeadragonUtils.removeEvent(i,"click",T,!1),h(),M=!1,delete l[S])}function d(){I||(a?(SeadragonUtils.removeEvent(i,"mouseup",y,!1),SeadragonUtils.addEvent(i,"mouseup",b,!0),SeadragonUtils.addEvent(i,"mousemove",A,!0)):(SeadragonUtils.addEvent(window,"mouseup",x,!0),SeadragonUtils.addEvent(window,"mousemove",k,!0)),I=!0)}function h(){I&&(a?(SeadragonUtils.removeEvent(i,"mousemove",A,!0),SeadragonUtils.removeEvent(i,"mouseup",b,!0),SeadragonUtils.addEvent(i,"mouseup",y,!1)):(SeadragonUtils.removeEvent(window,"mousemove",k,!0),SeadragonUtils.removeEvent(window,"mouseup",x,!0)),I=!1)}function p(t,e){var n=l;for(var i in n)n.hasOwnProperty(i)&&S!=i&&n[i][t](e)}function f(){return P}function g(t){var t=SeadragonUtils.getEvent(t);a&&I&&!n(t.srcElement,i)&&p("onMouseOver",t);var r=t.target?t.target:t.srcElement,s=t.relatedTarget?t.relatedTarget:t.fromElement;if(n(i,r)&&!n(i,s)&&(P=!0,"function"==typeof C.enterHandler))try{C.enterHandler(C,e(t,i),D,o)}catch(l){SeadragonDebug.error(l.name+" while executing enter handler: "+l.message,l)}}function m(t){var t=SeadragonUtils.getEvent(t);a&&I&&!n(t.srcElement,i)&&p("onMouseOut",t);var r=t.target?t.target:t.srcElement,s=t.relatedTarget?t.relatedTarget:t.toElement;if(n(i,r)&&!n(i,s)&&(P=!1,"function"==typeof C.exitHandler))try{C.exitHandler(C,e(t,i),D,o)}catch(l){SeadragonDebug.error(l.name+" while executing exit handler: "+l.message,l)}}function v(n){var n=SeadragonUtils.getEvent(n);if(2!=n.button){if(D=!0,$=t(n),G=$,N=Date.now(),"function"==typeof C.pressHandler)try{C.pressHandler(C,e(n,i))}catch(r){SeadragonDebug.error(r.name+" while executing press handler: "+r.message,r)}(C.pressHandler||C.dragHandler)&&SeadragonUtils.cancelEvent(n),a&&s?a&&c.push(E):(d(),s=!0,c=[E])}}function y(t){var t=SeadragonUtils.getEvent(t),n=D,r=P;if(2!=t.button){if(D=!1,"function"==typeof C.releaseHandler)try{C.releaseHandler(C,e(t,i),n,r)}catch(a){SeadragonDebug.error(a.name+" while executing release handler: "+a.message,a)}n&&r&&w(t)}}function b(t){var t=SeadragonUtils.getEvent(t);if(2!=t.button){for(var e=0;c.length>e;e++){var n=c[e];n.hasMouse()||n.onMouseUp(t)}h(),s=!1,t.srcElement.fireEvent("on"+t.type,document.createEventObject(t)),SeadragonUtils.stopEvent(t)}}function x(t){P||y(t),h()}function T(t){C.clickHandler&&SeadragonUtils.cancelEvent(t)}function w(n){var n=SeadragonUtils.getEvent(n);if(2!=n.button){var r=Date.now()-N,a=t(n),o=G.distance2To(a),s=SeadragonConfig.clickTimeThreshold>=r&&SeadragonConfig.clickDistThreshold>=o;if("function"==typeof C.clickHandler)try{C.clickHandler(C,e(n,i),s,n.shiftKey)}catch(l){SeadragonDebug.error(l.name+" while executing click handler: "+l.message,l)}}}function k(n){var n=SeadragonUtils.getEvent(n),r=t(n),a=r.minus($);if($=r,"function"==typeof C.dragHandler){try{C.dragHandler(C,e(n,i),a,n.shiftKey)}catch(o){SeadragonDebug.error(o.name+" while executing drag handler: "+o.message,o)}SeadragonUtils.cancelEvent(n)}}function A(t){for(var e=0;c.length>e;e++)c[e].onMouseMove(t);SeadragonUtils.stopEvent(t)}function _(t){var t=SeadragonUtils.getEvent(t),n=SeadragonUtils.getMouseScroll(t);if("function"==typeof C.scrollHandler){if(n)try{C.scrollHandler(C,e(t,i),n,t.shiftKey)}catch(r){SeadragonDebug.error(r.name+" while executing scroll handler: "+r.message,r)}SeadragonUtils.cancelEvent(t)}}var C=this,E=null,S=Math.random(),i=SeadragonUtils.getElement(i),M=!1,I=!1,D=!1,P=!1,$=null,N=null,G=null;this.target=i,this.enterHandler=null,this.exitHandler=null,this.pressHandler=null,this.releaseHandler=null,this.clickHandler=null,this.dragHandler=null,this.scrollHandler=null,function(){E={hasMouse:f,onMouseOver:g,onMouseOut:m,onMouseUp:y,onMouseMove:k}}(),this.isTracking=function(){return M},this.setTracking=function(t){t?r():u()}}}})();var SeadragonEventManager=Seadragon.EventManager=function(){var t={};this.addListener=function(e,n){"function"==typeof n&&(t[e]||(t[e]=[]),t[e].push(n))},this.removeListener=function(e,n){var i=t[e];if("function"==typeof n&&i)for(var r=0;i.length>r;r++)if(n==i[r])return i.splice(r,1),void 0},this.clearListeners=function(e){t[e]&&delete t[e]},this.trigger=function(e){var n=t[e],i=[];if(n){for(var r=1;arguments.length>r;r++)i.push(arguments[r]);for(var r=0;n.length>r;r++)try{n[r].apply(window,i)}catch(a){SeadragonDebug.error(a.name+" while executing "+e+" handler: "+a.message,a)}}}},SeadragonImageLoader;(function(){function t(t,e){this.src=t,this.callback=e,this.image=null,this.timeout=null,this.running=!1}var e=15e3;t.prototype.start=function(){var t=this;if(!t.running){t.running=!0,t.image=new Image;var n=function(){t.finish(!0)},i=function(){t.finish(!1)},r=function(){SeadragonDebug.log("Image timed out: "+t.src),t.finish(!1)};t.image.onload=n,t.image.onabort=i,t.image.onerror=i,t.timeout=window.setTimeout(r,e),t.image.src=t.src}},t.prototype.finish=function(t){this.image.onload=null,this.image.onabort=null,this.image.onerror=null,this.timeout&&window.clearTimeout(this.timeout),this.callback(this.src,t?this.image:null)},SeadragonImageLoader=Seadragon.ImageLoader=function(){function e(t,e,r){var a;for(n--,"function"==typeof t&&setTimeout(function(){try{t(r)}catch(n){SeadragonDebug.error(n.name+" while executing "+e+" callback: "+n.message,n)}},2);SeadragonConfig.imageLoaderLimit>n&&i.length>0;)a=i.shift(),a.tile.loaded||(setTimeout(a.job.start(),2),n++)}var n=0,i=[];this.loadImage=function(r,a){var o=SeadragonUtils.createCallback(null,e,a),s=new t(r.url,o);n>=SeadragonConfig.imageLoaderLimit?i.push({job:s,tile:r}):(n++,s.start()),r.loading=!0},this.clear=function(){i.map(function(t){t.tile.loading=!1}),i=[]}}})();var SeadragonButton,SeadragonButtonGroup;(function(){var t={REST:0,GROUP:1,HOVER:2,DOWN:3};SeadragonButton=Seadragon.Button=function(e,n,i,r,a,o,s,l,c,u){function d(){C=!1,SeadragonUtils.setElementOpacity(k,1,!0)}function h(e){e>=t.GROUP&&x==t.REST&&(d(),x=t.GROUP),e>=t.HOVER&&x==t.GROUP&&(A.style.visibility="",x=t.HOVER),e>=t.DOWN&&x==t.HOVER&&(_.style.visibility="",x=t.DOWN)}function p(e){t.HOVER>=e&&x==t.DOWN&&(_.style.visibility="hidden",x=t.HOVER),t.GROUP>=e&&x==t.HOVER&&(A.style.visibility="hidden",x=t.GROUP),t.REST>=e&&x==t.GROUP&&(x=t.REST)}function f(e,n,i,r){i?(h(t.DOWN),c&&c()):r||h(t.HOVER)}function g(e,n,i){p(t.GROUP),i&&u&&u()}function m(){h(t.DOWN),o&&o()}function v(e,n,i,r){i&&r?(p(t.HOVER),s&&s()):i?p(t.GROUP):h(t.HOVER)}function y(t,e,n){l&&n&&l()}var b=SeadragonUtils.makeNeutralElement("span"),x=t.GROUP,T=new SeadragonMouseTracker(b),w=SeadragonUtils.makeTransparentImage(n),k=SeadragonUtils.makeTransparentImage(i),A=SeadragonUtils.makeTransparentImage(r),_=SeadragonUtils.makeTransparentImage(a),o="function"==typeof o?o:null,s="function"==typeof s?s:null,l="function"==typeof l?l:null,c="function"==typeof c?c:null,u="function"==typeof u?u:null,C=!1;
this.elmt=b,this.notifyGroupEnter=function(){h(t.GROUP)},this.notifyGroupExit=function(){p(t.REST)},function(){b.style.display="inline-block",b.style.position="relative",b.title=e,b.appendChild(w),b.appendChild(k),b.appendChild(A),b.appendChild(_),w.style;var n=k.style,i=A.style,r=_.style;n.position=i.position=r.position="absolute",n.top=i.top=r.top="0px",n.left=i.left=r.left="0px",i.visibility=r.visibility="hidden",SeadragonUtils.getBrowser()==SeadragonBrowser.FIREFOX&&3>SeadragonUtils.getBrowserVersion()&&(n.top=i.top=r.top=""),T.enterHandler=f,T.exitHandler=g,T.pressHandler=m,T.releaseHandler=v,T.clickHandler=y,T.setTracking(!0),p(t.REST)}()},SeadragonButtonGroup=Seadragon.ButtonGroup=function(t){function e(){for(var e=0;t.length>e;e++)t[e].notifyGroupEnter()}function n(e,n,i){if(!i)for(var r=0;t.length>r;r++)t[r].notifyGroupExit()}function i(e,n,i,r){if(!r)for(var a=0;t.length>a;a++)t[a].notifyGroupExit()}var r=SeadragonUtils.makeNeutralElement("span"),t=t.concat([]),a=new SeadragonMouseTracker(r);this.elmt=r,this.emulateEnter=function(){e()},this.emulateExit=function(){n()},function(){r.style.display="inline-block";for(var o=0;t.length>o;o++)r.appendChild(t[o].elmt);a.enterHandler=e,a.exitHandler=n,a.releaseHandler=i,a.setTracking(!0)}()}})();var SeadragonTileSource=Seadragon.TileSource=function(t,e,n,i,r,a){var o=this,s=e/t;this.width=t,this.height=e,this.aspectRatio=t/e,this.dimensions=new SeadragonPoint(t,e),this.minLevel=r?r:0,this.maxLevel=a?a:Math.ceil(Math.log(Math.max(t,e))/Math.log(2)),this.tileSize=n?n:0,this.tileOverlap=i?i:0,this.getLevelScale=function(t){return 1/(1<<o.maxLevel-t)},this.getNumTiles=function(n){var i=o.getLevelScale(n),r=Math.ceil(i*t/o.tileSize),a=Math.ceil(i*e/o.tileSize);return new SeadragonPoint(r,a)},this.getPixelRatio=function(t){var e=o.dimensions.times(o.getLevelScale(t)),n=1/e.x,i=1/e.y;return new SeadragonPoint(n,i)},this.getTileAtPoint=function(t,e){var n,i,r=o.dimensions.times(o.getLevelScale(t)),a=e.times(r.x);return n=e.x>=0&&1>=e.x?Math.floor(a.x/o.tileSize):Math.ceil(r.x/o.tileSize)*Math.floor(a.x/r.x)+Math.floor((r.x+a.x%r.x)%r.x/o.tileSize),i=e.y>=0&&s>=e.y?Math.floor(a.y/o.tileSize):Math.ceil(r.y/o.tileSize)*Math.floor(a.y/r.y)+Math.floor((r.y+a.y%r.y)%r.y/o.tileSize),new SeadragonPoint(n,i)},this.getTileBounds=function(t,e,n){var i=o.dimensions.times(o.getLevelScale(t)),r=0===e?0:o.tileSize*e-o.tileOverlap,a=0===n?0:o.tileSize*n-o.tileOverlap,s=o.tileSize+(0===e?1:2)*o.tileOverlap,l=o.tileSize+(0===n?1:2)*o.tileOverlap;s=Math.min(s,i.x-r),l=Math.min(l,i.y-a);var c=1/i.x;return new SeadragonRect(r*c,a*c,s*c,l*c)},this.getTileUrl=function(){throw Error("Method not implemented.")},this.tileExists=function(t,e,n){var i=o.getNumTiles(t);return t>=o.minLevel&&o.maxLevel>=t&&e>=0&&n>=0&&i.x>e&&i.y>n}},SeadragonDisplayRect=Seadragon.DisplayRect=function(t,e,n,i,r,a){SeadragonRect.apply(this,arguments),this.minLevel=r,this.maxLevel=a};SeadragonDisplayRect.prototype=new SeadragonRect;var SeadragonDziTileSource=Seadragon.DziTileSource=function(t,e,n,i,r,a,o){SeadragonTileSource.apply(this,[t,e,n,i]);var s=this,l={};this.fileFormat=a,this.tileFormat=a,this.displayRects=o,function(){if(o)for(var t=o.length-1;t>=0;t--)for(var e=o[t],n=e.minLevel;e.maxLevel>=n;n++)l[n]||(l[n]=[]),l[n].push(e)}(),this.getTileUrl=function(t,e,n){return[r,t,"/",e,"_",n,".",a].join("")},this.tileExists=function(t,e,i){var r=l[t];if(!r||!r.length)return!0;for(var a=s.getLevelScale(t),o=r.length-1;o>=0;o--){var c=r[o];if(!(c.minLevel>t||t>c.maxLevel)){var u=c.x*a,d=c.y*a,h=u+c.width*a,p=d+c.height*a;if(u=Math.floor(u/n),d=Math.floor(d/n),h=Math.ceil(h/n),p=Math.ceil(p/n),e>=u&&h>e&&i>=d&&p>i)return!0}}return!1}};SeadragonDziTileSource.prototype=new SeadragonTileSource,function(){function t(t){Error.apply(this,arguments),this.message=t}function e(e){return e instanceof t||(SeadragonDebug.error(e.name+" while creating DZI from XML: "+e.message),e=new t(SeadragonStrings.getString("Errors.Unknown"))),e}function n(t){var e=t.split("/"),n=e[e.length-1],i=n.lastIndexOf(".");return i>-1&&(e[e.length-1]=n.slice(0,i)),e.join("/")+"_files/"}function i(e,n){if(!e)throw new t(SeadragonStrings.getString("Errors.Security"));var i=null;return e.responseXML&&e.responseXML.documentElement?i=e.responseXML:e.responseText&&(i=SeadragonUtils.parseXml(e.responseText)),r(i,n)}function r(e,n){if(!e||!e.documentElement)throw new t(SeadragonStrings.getString("Errors.Xml"));var i=e.documentElement,r=i.tagName;if("Image"==r)try{return a(i,n)}catch(s){var l=SeadragonStrings.getString("Errors.Dzi");throw s instanceof t?s:new t(l)}else{if("Collection"==r)throw new t(SeadragonStrings.getString("Errors.Dzc"));if("Error"==r)return o(i)}throw new t(SeadragonStrings.getString("Errors.Dzi"))}function a(e,n){var i=e.getAttribute("Format");if(!SeadragonUtils.imageFormatSupported(i))throw new t(SeadragonStrings.getString("Errors.ImageFormat",i.toUpperCase()));for(var r=e.getElementsByTagName("Size")[0],a=e.getElementsByTagName("DisplayRect"),o=parseInt(r.getAttribute("Width"),10),s=parseInt(r.getAttribute("Height"),10),l=parseInt(e.getAttribute("TileSize")),c=parseInt(e.getAttribute("Overlap")),u=[],d=0;a.length>d;d++){var h=a[d],p=h.getElementsByTagName("Rect")[0];u.push(new SeadragonDisplayRect(parseInt(p.getAttribute("X"),10),parseInt(p.getAttribute("Y"),10),parseInt(p.getAttribute("Width"),10),parseInt(p.getAttribute("Height"),10),parseInt(h.getAttribute("MinLevel"),10),parseInt(h.getAttribute("MaxLevel"),10)))}return new SeadragonDziTileSource(o,s,l,c,n,i,u)}function o(e){var n=e.getElementsByTagName("Message")[0],i=n.firstChild.nodeValue;throw new t(i)}t.prototype=Error(),SeadragonDziTileSource.getTilesUrl=n,SeadragonDziTileSource.createFromJson=function(i,r){var a,o,s="function"==typeof r,l=i;if(l&&(l.url||l.tilesUrl))try{var c=l.displayRects;if(c&&c.length)for(var u=0,d=c.length;d>u;u++){var h=c[u];c[u]=new SeadragonDisplayRect(h.x||h[0],h.y||h[1],h.width||h[2],h.height||h[3],h.minLevel||h[4],h.maxLevel||h[5])}a=new SeadragonDziTileSource(l.width,l.height,l.tileSize,l.tileOverlap,l.tilesUrl||n(l.url),l.tileFormat,l.displayRects),a.xmlUrl=l.url}catch(p){o=e(p)}else o=new t(SeadragonStrings.getString("Errors.Empty"));if(!s){if(o)throw o;return a}window.setTimeout(SeadragonUtils.createCallback(null,r,a,o&&o.message),1)},SeadragonDziTileSource.createFromXml=function(a,o,s){function l(t,n){try{var i=t(n,d);return i.xmlUrl=a,i}catch(r){if(c)return u=e(r).message,null;throw e(r)}}var c="function"==typeof s,u=null;if(!a){if(u=SeadragonStrings.getString("Errors.Empty"),c)return window.setTimeout(function(){s(null,u)},1),null;throw new t(u)}var d=n(a);return c?(o?window.setTimeout(function(){var t=l(r,SeadragonUtils.parseXml(o));s(t,u)},1):SeadragonUtils.makeAjaxRequest(a,function(t){var e=l(i,t);s(e,u)}),null):o?l(r,SeadragonUtils.parseXml(o)):l(i,SeadragonUtils.makeAjaxRequest(a))}}();var SeadragonViewport=Seadragon.Viewport=function(t,e,n){function i(){c.goHome(!0),c.update()}function r(t){return Math.log(t)/y}function a(t){return Math.pow(2,t)}function o(t,e,n){return Math.min(Math.max(t,e),n)}function s(t,e){var n=t.x,i=t.y,r=o(n,e.x,e.x+e.width),a=o(i,e.y,e.y+e.height);return n===r&&i===a?t:new SeadragonPoint(r,a)}function l(t){var e=c.getZoom(t),n=1/e,i=n/c.getAspectRatio(),r=SeadragonConfig.visibilityRatio,a=(r-.5)*n,o=(r-.5)*i,s=1-2*a,l=d-2*o;return 0>s&&(a+=.5*s,s=0),0>l&&(o+=.5*l,l=0),new Seadragon.Rect(a,o,s,l)}var c=this,t=new SeadragonPoint(t.x,t.y),u=e.x/e.y,d=e.y/e.x,h=new SeadragonSpring(0),p=new SeadragonSpring(0),f=new SeadragonSpring(SeadragonConfig.logarithmicZoom?0:1),g=null,m=new SeadragonRect(0,0,1,d),v=m.getCenter(),y=Math.LN2;this.getHomeBounds=function(){var t=c.getAspectRatio(),e=new SeadragonRect(m.x,m.y,m.width,m.height);return u>=t?(e.height=m.width/t,e.y=v.y-e.height/2):(e.width=m.height*t,e.x=v.x-e.width/2),e},this.getHomeCenter=function(){return v},this.getHomeZoom=function(){var t=u/c.getAspectRatio();return t>=1?1:t},this.getMinCenter=function(t){return l(t).getTopLeft()},this.getMaxCenter=function(t){return l(t).getBottomRight()},this.getMinZoom=function(){var n=c.getHomeZoom();if(SeadragonConfig.minZoomDimension)var i=e.x<=e.y?SeadragonConfig.minZoomDimension/t.x:SeadragonConfig.minZoomDimension/(t.x*d);else var i=SeadragonConfig.minZoomImageRatio*n;return Math.min(i,n)},this.getMaxZoom=function(){var n=e.x*SeadragonConfig.maxZoomPixelRatio/t.x;return Math.max(n,c.getHomeZoom())},this.getAspectRatio=function(){return t.x/t.y},this.getContainerSize=function(){return new SeadragonPoint(t.x,t.y)},this.getBounds=function(t){var e=c.getCenter(t),n=1/c.getZoom(t),i=n/c.getAspectRatio();return new SeadragonRect(e.x-n/2,e.y-i/2,n,i)},this.getCenter=function(e){var n=new SeadragonPoint(h.getCurrent(),p.getCurrent()),i=new SeadragonPoint(h.getTarget(),p.getTarget());if(e)return n;if(!g)return i;var r=c.getZoom(),a=1/r,o=a/c.getAspectRatio(),s=new SeadragonRect(n.x-a/2,n.y-o/2,a,o),l=c.pixelFromPoint(g,!0),u=g.minus(s.getTopLeft()).times(t.x/s.width),d=u.minus(l),f=d.divide(t.x*r);return i.plus(f)},this.getZoom=function(t){var e;return t?(e=f.getCurrent(),SeadragonConfig.logarithmicZoom?a(e):e):(e=f.getTarget(),SeadragonConfig.logarithmicZoom?a(e):e)},this.applyConstraints=function(t){var e=c.getZoom(),n=o(e,c.getMinZoom(),c.getMaxZoom());e!=n&&c.zoomTo(n,g,t);var i=c.getCenter(),r=s(i,l());if(SeadragonConfig.wrapHorizontal&&(r.x=i.x),SeadragonConfig.wrapVertical&&(r.y=i.y),i.equals(r))return!1;var a=1/n,u=a/c.getAspectRatio();return c.fitBounds(new SeadragonRect(r.x-.5*a,r.y-.5*u,a,u),t),!0},this.ensureVisible=function(t){c.applyConstraints(t)},this.fitBounds=function(e,n){var i=c.getAspectRatio(),r=e.getCenter(),a=new SeadragonRect(e.x,e.y,e.width,e.height);a.getAspectRatio()>=i?(a.height=e.width/i,a.y=r.y-a.height/2):(a.width=e.height*i,a.x=r.x-a.width/2),c.panTo(c.getCenter(!0),!0),c.zoomTo(c.getZoom(!0),null,!0);var o=c.getBounds(),s=c.getZoom(),l=1/a.width;if(l==s||1e-6>Math.abs(a.width-o.width))return c.panTo(r,n),void 0;var u=o.getTopLeft().times(t.x/o.width).minus(a.getTopLeft().times(t.x/a.width)).divide(t.x/o.width-t.x/a.width);c.zoomTo(l,u,n)},this.goHome=function(t){var e=c.getCenter();SeadragonConfig.wrapHorizontal&&(e.x=(1+e.x%1)%1,h.resetTo(e.x),h.update()),SeadragonConfig.wrapVertical&&(e.y=(d+e.y%d)%d,p.resetTo(e.y),p.update()),c.fitBounds(m,t)},this.panBy=function(t,e){c.panTo(c.getCenter().plus(t),e)},this.panTo=function(e,i){if(i)return h.resetTo(e.x),p.resetTo(e.y),void 0;g||(g=new Seadragon.Point(0,0));var r=c.getZoom(),a=1/r,o=a/c.getAspectRatio(),s=new SeadragonRect(h.getCurrent()-a/2,p.getCurrent()-o/2,a,o),l=c.pixelFromPoint(g,!0),u=g.minus(s.getTopLeft()).times(t.x/s.width),d=u.minus(l),f=d.divide(t.x*r),m=e.minus(f);h.springTo(m.x),p.springTo(m.y),n.scheduleUpdate()},this.zoomBy=function(t,e,n){c.zoomTo(c.getZoom()*t,e,n)},this.zoomTo=function(t,e,i){i?f.resetTo(SeadragonConfig.logarithmicZoom?r(t):t):f.springTo(SeadragonConfig.logarithmicZoom?r(t):t),g=e instanceof SeadragonPoint?e:null,n.scheduleUpdate()},this.resize=function(e,n){var i=c.getBounds(),r=i,a=e.x/t.x;t=new SeadragonPoint(e.x,e.y),n&&(r.width=i.width*a,r.height=r.width/c.getAspectRatio()),c.fitBounds(r,!0)},this.update=function(){var t=h.getCurrent(),e=p.getCurrent(),n=f.getCurrent();if(g)var i=c.pixelFromPoint(g,!0);if(f.update(),g&&f.getCurrent()!=n){var r=c.pixelFromPoint(g,!0),a=r.minus(i),o=c.deltaPointsFromPixels(a,!0);h.shiftBy(o.x),p.shiftBy(o.y)}else g=null;return h.update(),p.update(),h.getCurrent()!=t||p.getCurrent()!=e||f.getCurrent()!=n},this.deltaPixelsFromPoints=function(e,n){return e.times(t.x*c.getZoom(n))},this.deltaPointsFromPixels=function(e,n){return e.divide(t.x*c.getZoom(n))},this.pixelFromPoint=function(e,n){var i=c.getBounds(n);return e.minus(i.getTopLeft()).times(t.x/i.width)},this.pointFromPixel=function(e,n){var i=c.getBounds(n);return e.divide(t.x/i.width).plus(i.getTopLeft())},i()},SeadragonDrawer,SeadragonOverlayPlacement;(function(){function t(t,e,n,i,r,a){this.level=t,this.x=e,this.y=n,this.bounds=i,this.exists=r,this.url=a,this.elmt=null,this.image=null,this.loaded=!1,this.loading=!1,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.distance=null,this.visibility=null,this.beingDrawn=!1,this.covered=!1,this.lastDrawnTime=0,this.lastTouchTime=0}function e(t){switch(t){case SeadragonOverlayPlacement.TOP_LEFT:return function(){};case SeadragonOverlayPlacement.TOP:return function(t,e){t.x-=e.x/2};case SeadragonOverlayPlacement.TOP_RIGHT:return function(t,e){t.x-=e.x};case SeadragonOverlayPlacement.RIGHT:return function(t,e){t.x-=e.x,t.y-=e.y/2};case SeadragonOverlayPlacement.BOTTOM_RIGHT:return function(t,e){t.x-=e.x,t.y-=e.y};case SeadragonOverlayPlacement.BOTTOM:return function(t,e){t.x-=e.x/2,t.y-=e.y};case SeadragonOverlayPlacement.BOTTOM_LEFT:return function(t,e){t.y-=e.y};case SeadragonOverlayPlacement.LEFT:return function(t,e){t.y-=e.y/2};case SeadragonOverlayPlacement.CENTER:default:return function(t,e){t.x-=e.x/2,t.y-=e.y/2}}}function n(t,n,i){this.elmt=t,this.scales=n instanceof SeadragonRect,this.bounds=new SeadragonRect(n.x,n.y,n.width,n.height),this.adjust=e(n instanceof SeadragonPoint?i:SeadragonOverlayPlacement.TOP_LEFT),this.position=new SeadragonPoint(n.x,n.y),this.size=new SeadragonPoint(n.width,n.height),this.style=t.style,this.naturalSize=new SeadragonPoint(t.clientWidth,t.clientHeight)}var i=1500,r=.5,a=SeadragonUtils.getBrowser(),o=SeadragonUtils.getBrowserVersion();navigator.userAgent;for(var s,l,c=!!document.createElement("canvas").getContext,u=document.documentElement||{},d=u.style||{},h=!1,p=["msTransform","WebkitTransform","MozTransform"];s=p.shift();)if(d[s]!==void 0){h=!0,l=/webkit/i.test(s);break}var f="WebkitTransition";d[f]!==void 0;var g="progid:DXImageTransform.Microsoft.Matrix";RegExp(g+"\\(.*?\\)","g"),function(){try{return a===SeadragonBrowser.IE&&!!document.documentElement.filters}catch(t){return!1}}();var m=a===SeadragonBrowser.SAFARI&&4>o||a===SeadragonBrowser.CHROME,v=c&&!m,y=!v&&h,b=!1,x=document.documentMode!==void 0?"bicubic":"nearest-neighbor";t.prototype.toString=function(){return this.level+"/"+this.x+"_"+this.y},t.prototype.drawHTML=function(t){if(!this.loaded)return SeadragonDebug.error("Attempting to draw tile "+(""+this)+" when it's not yet loaded."),void 0;this.elmt||(this.elmt=SeadragonUtils.makeNeutralElement("img"),this.elmt.src=this.url,this.style=this.elmt.style,this.style.position="absolute",this.style.msInterpolationMode=x,y&&(this.style[s+"Origin"]="0px 0px"));var e=this.elmt,n=this.image,i=this.style,r=this.position,a=this.size;if(e.parentNode!==t&&t.appendChild(e),y)i[s]=["matrix(",(a.x/n.width).toFixed(8),",0,0,",(a.y/n.height).toFixed(8),",",r.x.toFixed(8),l?",":"px,",r.y.toFixed(8),l?")":"px)"].join("");else if(b){var o=t.clientWidth,c=t.clientHeight;i.width=o+"px",i.height=c+"px",i.filter=["progid:DXImageTransform.Microsoft.Matrix(","M11=",(a.x/o).toFixed(8),",M22=",(a.y/c).toFixed(8),",Dx=",r.x.toFixed(8),",Dy=",r.y.toFixed(8),")"].join("")}else r=r.apply(Math.floor),a=a.apply(Math.ceil),i.left=r.x+"px",i.top=r.y+"px",i.width=a.x+"px",i.height=a.y+"px";SeadragonUtils.setElementOpacity(e,this.opacity)},t.prototype.drawCanvas=function(t){if(!this.loaded)return SeadragonDebug.error("Attempting to draw tile "+(""+this)+" when it's not yet loaded."),void 0;var e=this.position,n=this.size;t.globalAlpha=this.opacity,t.drawImage(this.image,e.x,e.y,n.x,n.y)},t.prototype.unload=function(){this.elmt&&this.elmt.parentNode&&this.elmt.parentNode.removeChild(this.elmt),this.elmt=null,this.image=null,this.loaded=!1,this.loading=!1},SeadragonOverlayPlacement=Seadragon.OverlayPlacement={CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8},n.prototype.destroy=function(){var t=this.elmt,e=this.style;t.parentNode&&t.parentNode.removeChild(t),e.top="",e.left="",e.position="",this.scales&&(e.width="",e.height="")},n.prototype.drawHTML=function(t){var e=this.elmt,n=this.style,i=this.scales,r=this.naturalSize;e.parentNode!==t&&(t.appendChild(e),n.position="absolute",r.x=e.clientWidth,r.y=e.clientHeight);var a=this.position,o=this.size;if(i||(o.x=r.x=r.x||e.clientWidth,o.y=r.y=r.y||e.clientHeight),this.adjust(a,o),SeadragonConfig.transformOverlays&&h)n[s+"Origin"]="0px 0px",n[s]=["translate(",a.x.toFixed(8),"px,",a.y.toFixed(8),"px)"].join(""),i&&(e.clientWidth||(n.width="100%"),e.clientHeight||(n.height="100%"),n[s]+=[" scale(",(o.x/e.clientWidth).toFixed(8),",",(o.y/e.clientHeight).toFixed(8),")"].join(""));else if(SeadragonConfig.transformOverlays&&b){var l=t.clientWidth,c=t.clientHeight;n.width=l+"px",n.height=c+"px",n.filter=["progid:DXImageTransform.Microsoft.Matrix(","M11=",(o.x/l).toFixed(8),",M22=",(o.y/c).toFixed(8),",Dx=",a.x.toFixed(8),",Dy=",a.y.toFixed(8),")"].join("")}else a=a.apply(Math.floor),o=o.apply(Math.ceil),n.left=a.x+"px",n.top=a.y+"px",i&&(n.width=o.x+"px",n.height=o.y+"px")},n.prototype.update=function(t,n){this.scales=t instanceof SeadragonRect,this.bounds=new SeadragonRect(t.x,t.y,t.width,t.height),this.adjust=e(t instanceof SeadragonPoint?n:SeadragonOverlayPlacement.TOP_LEFT)},SeadragonDrawer=Seadragon.Drawer=function(e,o,s,l,c){function u(t){return N[t]||(N[t]=e.getNumTiles(t)),N[t]}function d(t){return G[t]||(G[t]=e.getPixelRatio(t)),G[t]}function h(n,i,r,a,o,s){if(O[n]||(O[n]={}),O[n][i]||(O[n][i]={}),!O[n][i][r]){var l=(o+i%o)%o,c=(s+r%s)%s,u=e.getTileBounds(n,l,c),d=e.tileExists(n,l,c),h=e.getTileUrl(n,l,c);u.x+=1*(i-l)/o,u.y+=$*(r-c)/s,O[n][i][r]=new t(n,i,r,u,d,h)}var p=O[n][i][r];return p.lastTouchTime=a,p}function p(t,e){E.loadImage(t,SeadragonUtils.createCallback(null,f,t,e))}function f(t,e,n){if(t.loading=!1,z)return SeadragonDebug.error("Tile load callback in middle of drawing routine."),void 0;if(!n)return SeadragonDebug.log("Tile "+t+" failed to load: "+t.url),t.exists=!1,void 0;t.image=n,t.loaded=!0;var r=L.length;if(L.length>=i){for(var a=Math.ceil(Math.log(D)/Math.log(2)),o=null,s=-1,l=L.length-1;l>=0;l--){var c=L[l];if(!(a>=c.level||c.beingDrawn))if(o){var u=c.lastTouchTime,d=o.lastTouchTime,h=c.level,p=o.level;(d>u||u===d&&h>p)&&(o=c,s=l)}else o=c,s=l}o&&s>=0&&(o.unload(),r=s)}L[r]=t,j=!0}function g(){O={},L=[]}function m(t,e,n){if(!F[t])return!1;if(void 0===e||void 0===n){var i=F[t];for(var r in i)if(i.hasOwnProperty(r)){var a=i[r];for(var o in a)if(a.hasOwnProperty(o)&&!a[o])return!1}return!0}return void 0===F[t][e]||void 0===F[t][e][n]||F[t][e][n]===!0}function y(t,e,n){return void 0===e||void 0===n?m(t+1):m(t+1,2*e,2*n)&&m(t+1,2*e,2*n+1)&&m(t+1,2*e+1,2*n)&&m(t+1,2*e+1,2*n+1)}function b(t,e,n,i){return F[t]?(F[t][e]||(F[t][e]={}),F[t][e][n]=i,void 0):(SeadragonDebug.error("Setting coverage for a tile before its level's coverage has been reset: "+t),void 0)}function x(t){F[t]={}}function T(t){for(var e=B.length-1;e>=0;e--)if(B[e].elmt===t)return e;return-1}function w(t){var n;for(n=0;R.length>n;n++)R[n].beingDrawn=!1,R[n].covered=!1;R=[];var i=R;E.clear();var s=o.getBounds(!0);isNaN(s.x)&&(o.goHome(!0),s=o.getBounds(!0));var l=s.getTopLeft(),c=s.getBottomRight(),f=SeadragonConfig.wrapHorizontal,g=SeadragonConfig.wrapVertical;if(!(!f&&(0>c.x||l.x>1)||!g&&(0>c.y||l.y>$))){var m=u,v=d,T=h,w=y,k=b,A=x,_=P;a===SeadragonBrowser.CHROME,Math.abs;var C=Math.floor,S=Math.log,D=Math.max,N=Math.min,G=o.deltaPixelsFromPoints,O=o.pixelFromPoint,L=e.getTileAtPoint;SeadragonConfig.immediateRender;var F=SeadragonConfig.minZoomDimension||64;f||(l.x=D(l.x,0),c.x=N(c.x,1)),g||(l.y=D(l.y,0),c.y=N(c.y,$));var B=Date.now(),H=o.getCenter();O(H),G(v(0),!1).x;var U=.8>o.getZoom(!0)?r:.5,z=G(v(0),!0).x,j=N(I,C(S(z/U)/S(2))),W=D(M,C(S(F)/S(2)));W=N(W,j);for(var q=[],V=!1,Y=j;Y>=W;Y--){var X=!1,K=G(v(Y),!0).x;if(!V&&K>=U||Y===W)X=!0,V=!0;else if(!V)continue;A(Y);var Z=L(Y,l),Q=L(Y,c),J=m(Y),te=J.x,ee=J.y;f||(Q.x=N(Q.x,te-1)),g||(Q.y=N(Q.y,ee-1));var ne,ie,re=1,ae=0,oe=1,se=Q.x-Z.x,le=Q.y-Z.y,ce=Z.x+Math.floor(se/2),ue=Z.y+Math.floor(le/2),de=0,J=(se+1)*(le+1),he=[],pe=1/0,fe=-1/0,ge=1/0,me=-1/0;for(ne=0;J>ne;ne++){pe=Math.min(ce,pe),fe=Math.max(ce,fe),ge=Math.min(ue,ge),me=Math.max(ue,me);var ve=T(Y,ce,ue,B,te,ee),ye=X;if(k(Y,ce,ue,!1),ve.exists&&(V&&!ye&&(w(Y,ce,ue)?k(Y,ce,ue,!0):ye=!0),ye)){var be=ve.bounds.getTopLeft(),xe=ve.bounds.getSize(),Te=O(be,!0),we=G(xe,!0);_||(we=we.plus(new SeadragonPoint(1,1))),ve.position=Te,ve.size=we,i.push(ve),ve.loaded||ve.loading||he.push(ve)}ce+=re,ue+=ae,de++;for(var ke=0;!(ce>=Z.x&&Q.x>=ce&&ue>=Z.y&&Q.y>=ue||(ke++,ke>=4));)de=0,Z.x>ce?(ce=Z.x,ue=ge-1,re=1,ae=0,oe=Math.max(1,fe-Z.x+1)):ue>Q.y?(ce=pe-1,ue=Q.y,re=0,ae=-1,oe=Math.max(1,Q.y-ge+1)):ce>Q.x?(ce=Q.x,ue=me+1,re=-1,ae=0,oe=Math.max(1,Q.x-pe+1)):Z.y>ue&&(ce=fe+1,ue=Z.y,re=0,ae=1,oe=Math.max(1,me-Z.y+1));de===oe&&(de=0,ie=re,re=-ae,ae=ie,0===ae&&oe++)}he.length>0&&q.push(he)}var Ae;if(t)for(n=q.length-1;n>=0;n--)Ae=q[n],Ae.map(p);else q.length>0&&(Ae=q[q.length-1],p(Ae[0],10))}}function k(){{var t,e,n,i,r=_,a=C,s=(SeadragonConfig.alwaysBlend,1e3*SeadragonConfig.blendTime),l=v,c=R,u=b,d=o.deltaPixelsFromPoints,h=o.pixelFromPoint,p=o.getContainerSize(),f=p.x,g=p.y,m=Math.min,x=Math.floor,T=Date.now(),w=SeadragonConfig.wrapOverlays,k=SeadragonConfig.wrapHorizontal;SeadragonConfig.wrapVertical}for(j=!1,l?(r.width=f,r.height=g):r.innerHTML="",t=c.length-1;t>=0;t--)e=c[t],e.covered||y(e.level,e.x,e.y)?e.covered=!0:e.loaded?(1>e.opacity&&(e.blendStart||(e.blendStart=T),n=T-e.blendStart,i=0===s?1:m(1,n/s),e.opacity=i),e.opacity>=1?u(e.level,e.x,e.y,!0):j=!0,l?e.drawCanvas(a):e.drawHTML(r),e.beingDrawn=!0):e.exists&&(j=!0);var E,S,M;for(t=0;B.length>t;t++)E=B[t],S=E.bounds,M=S.getTopLeft(),w&&k&&(M.x+=x(viewportCenterPoint.x)),E.position=h(M,!0),E.size=d(S.getSize(),!0),E.drawHTML(A);H=T}r=c?.1:.5;var A=SeadragonUtils.getElement(s),_=SeadragonUtils.makeNeutralElement(v?"canvas":"div"),C=v?_.getContext("2d"):null,E=new SeadragonImageLoader,S=new SeadragonProfiler,M=e.minLevel,I=e.maxLevel,D=e.tileSize,P=e.tileOverlap,$=e.height/e.width,N={},G={},O={},L=[],F={},B=[],R=[],H=0,U=0,z=!1,j=!0;this.elmt=A,this.profiler=S,function(){_.style.width="100%",_.style.height="100%",_.style.position="absolute",A.style.textAlign="left",A.appendChild(_)}(),this.addOverlay=function(t,e,i){t=SeadragonUtils.getElement(t),T(t)>=0||(B.push(new n(t,e,i)),j=!0,l.scheduleUpdate())},this.updateOverlay=function(t,e,n){t=SeadragonUtils.getElement(t);var i=T(t);i>=0&&(B[i].update(e,n),j=!0,l.scheduleUpdate())},this.removeOverlay=function(t){t=SeadragonUtils.getElement(t);var e=T(t);e>=0&&(B[e].destroy(),B.splice(e,1),j=!0,l.scheduleUpdate())},this.clearOverlays=function(){for(;B.length>0;)B.pop().destroy(),j=!0,l.scheduleUpdate()},this.needsUpdate=function(){return j},this.numTilesLoaded=function(){return L.length},this.reset=function(){g(),U=Date.now(),j=!0},this.update=function(t,e){z=!0,t&&w(e),k(),z=!1},this.idle=function(){}}})();var SeadragonViewer,SeadragonControlAnchor;(function(){function t(t,e,n){e===SeadragonControlAnchor.TOP_RIGHT||e===SeadragonControlAnchor.BOTTOM_RIGHT?n.insertBefore(t,n.firstChild):n.appendChild(t)}function e(e,n,i){var r=SeadragonUtils.makeNeutralElement("span");this.elmt=e,this.anchor=n,this.container=i,this.wrapper=r,r.style.display="inline-block",r.appendChild(e),n===SeadragonControlAnchor.NONE&&(r.style.width=r.style.height="100%"),t(r,n,i)}function n(t){function e(){t.viewport&&t.viewport.goHome()}function n(){t.setFullPage(!t.isFullPage()),T.emulateExit(),t.viewport&&t.viewport.applyConstraints()}function r(){A=Date.now(),k=SeadragonConfig.zoomPerSecond,w=!0,g()}function p(){A=Date.now(),k=1/SeadragonConfig.zoomPerSecond,w=!0,g()}function f(){w=!1}function g(){window.setTimeout(m,10)}function m(){if(w&&t.viewport){var e=Date.now(),n=e-A,i=Math.pow(k,n/1e3);t.viewport.zoomBy(i),t.viewport.applyConstraints(),A=e,g()}}function v(){t.viewport&&(w=!1,t.viewport.zoomBy(SeadragonConfig.zoomPerClick/1),t.viewport.applyConstraints())}function y(){t.viewport&&(w=!1,t.viewport.zoomBy(1/SeadragonConfig.zoomPerClick),t.viewport.applyConstraints())}function b(){T.emulateEnter(),T.emulateExit()}function x(t,e){return SeadragonConfig.imagePath+t+e}var T=null,w=!1,k=null,A=null,_=new SeadragonButton(SeadragonStrings.getString("Tooltips.ZoomIn"),x(s,c),x(s,u),x(s,d),x(s,h),r,f,v,r,f),C=new SeadragonButton(SeadragonStrings.getString("Tooltips.ZoomOut"),x(l,c),x(l,u),x(l,d),x(l,h),p,f,y,p,f),E=new SeadragonButton(SeadragonStrings.getString("Tooltips.Home"),x(o,c),x(o,u),x(o,d),x(o,h),null,e,null,null,null),S=new SeadragonButton(SeadragonStrings.getString("Tooltips.FullPage"),x(a,c),x(a,u),x(a,d),x(a,h),null,n,null,null,null);return T=new SeadragonButtonGroup([_,C,E,S]),T.elmt[i]=!0,t.addEventListener("open",b),T.elmt}var i="----seadragon----",r=SeadragonUtils.getBrowser();SeadragonControlAnchor=Seadragon.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4},e.prototype.destroy=function(){this.wrapper.removeChild(this.elmt),this.container.removeChild(this.wrapper)},e.prototype.isVisible=function(){return"none"!==this.wrapper.style.display},e.prototype.setVisible=function(t){this.wrapper.style.display=t?"inline-block":"none"},e.prototype.setOpacity=function(t){this.elmt[i]&&r===SeadragonBrowser.IE?SeadragonUtils.setElementOpacity(this.elmt,t,!0):SeadragonUtils.setElementOpacity(this.wrapper,t,!0)};var a="fullpage",o="home",s="zoomin",l="zoomout",c="_rest.png",u="_grouphover.png",d="_hover.png",h="_pressed.png";SeadragonViewer=Seadragon.Viewer=function(t,i){function r(){var e=E.style,i=t.style,r=S.style,a=M.style,o=I.style,s=D.style;i.width="100%",i.height="100%",i.position="relative",i.left="0px",i.top="0px",i.textAlign="left",e.width="100%",e.height="100%",e.overflow="hidden",e.position="absolute",e.top="0px",e.left="0px",r.position=a.position=o.position=s.position="absolute",r.top=a.top="0px",r.left=s.left="0px",a.right=o.right="0px",s.bottom=o.bottom="0px",L.clickHandler=b,L.pressHandler=x,L.dragHandler=T,L.releaseHandler=w,L.scrollHandler=k,L.setTracking(!0),R=n(_),R.style.marginRight="4px",R.style.marginBottom="4px",_.addControl(R,SeadragonControlAnchor.BOTTOM_RIGHT),F.enterHandler=m,F.exitHandler=v,F.releaseHandler=y,F.setTracking(!0),window.setTimeout(g,1),t.appendChild(E),t.appendChild(S),t.appendChild(M),t.appendChild(I),t.appendChild(D),C.innerHTML="",C.appendChild(t)}function a(t){document.createTextNode(t),E.innerHTML="",E.appendChild(document.createElement("div"))}function o(){return P&&l(),Z=Date.now(),window.setTimeout(function(){Z>Q&&a(SeadragonStrings.getString("Messages.Loading"))},2e3),Z}function s(e,n,r){return Q=Date.now(),Z>e?(SeadragonDebug.log("Ignoring out-of-date open."),O.trigger("ignore",_),void 0):n?(E.innerHTML="",K=SeadragonUtils.getElementSize(t),0===K.x||0===K.y?(window.setTimeout(function(){s(e,n,r)},10),void 0):(P=n,N=new SeadragonViewport(K,P.dimensions,_),$=new SeadragonDrawer(P,N,E,_,i),G=new SeadragonProfiler,_.source=P,_.viewport=N,_.drawer=$,_.profiler=G,ee=!1,ne=!0,O.trigger("open",_),_.loopId||(_.loopId=re(u)),void 0)):(a(r),O.trigger("error",_),void 0)}function l(){_.source=P=null,_.viewport=N=null,_.drawer=$=null,_.profiler=G=null,E.innerHTML=""}function c(){_.loopId||(_.loopId=re(u)),ne=!0}function u(){if(_.loopId=re(u),P){var e=SeadragonUtils.getElementSize(t);!e.equals(K)&&e.x>0&&e.y>0&&(N.resize(e,!0),K=e,O.trigger("resize",_));var n=N.update(),i=ee&&!n;if(!ee&&n&&(O.trigger("animationstart",_),f()),n)$.update(!0,!1),O.trigger("animation",_);else if(ne||$.needsUpdate()){var r=i||ne;$.update(r,r)}else ae(_.loopId),_.loopId=null;i&&O.trigger("animationfinish",_),ee=n,ne=!1}}function d(t){for(var e=B.length-1;e>=0;e--)if(B[e].elmt===t)return e;return-1}function h(){window.setTimeout(p,20)}function p(){if(j){var t=Date.now(),e=t-z,n=1-e/U;n=Math.min(1,n),n=Math.max(0,n);for(var i=B.length-1;i>=0;i--)B[i].setOpacity(n);n>0&&h()}}function f(){j=!1;for(var t=B.length-1;t>=0;t--)B[t].setOpacity(1)}function g(){SeadragonConfig.autoHideControls&&(j=!0,z=Date.now()+H,window.setTimeout(h,H))}function m(){ie=!0,f()}function v(t,e,n){n||(ie=!1)}function y(t,e,n,i){i||(ie=!1,ee||g())}function b(t,e,n,i){if(N&&n){var r=SeadragonConfig.zoomPerClick,a=i?1/r:r;N.zoomBy(a,N.pointFromPixel(e,!0)),N.applyConstraints()}}function x(t,e){N&&(J=e,te=N.getCenter())}function T(t,e,n){if(N)if(SeadragonConfig.constrainDuringPan){var i=e.minus(J),r=N.deltaPointsFromPixels(i.negate(),!0);N.panTo(te.plus(r)),N.applyConstraints()}else N.panBy(N.deltaPointsFromPixels(n.negate(),!0))}function w(t,e,n){n&&N&&!i&&N.applyConstraints()}function k(t,e,n){if(N){var i=Math.pow(SeadragonConfig.zoomPerScroll,n);N.zoomBy(i,N.pointFromPixel(e,!0)),N.applyConstraints()}}function A(t){t=SeadragonUtils.getEvent(t),27===t.keyCode&&_.setFullPage(!1)}Seadragon.Config.minZoomImageRatio=i?.1:.8;var _=this,C=SeadragonUtils.getElement(t);t=SeadragonUtils.makeNeutralElement("div"),_.container=t;var E=SeadragonUtils.makeNeutralElement("div");_.canvas=E;var S=SeadragonUtils.makeNeutralElement("div"),M=SeadragonUtils.makeNeutralElement("div"),I=SeadragonUtils.makeNeutralElement("div"),D=SeadragonUtils.makeNeutralElement("div"),P=null,$=null,N=null,G=null,O=new SeadragonEventManager,L=new SeadragonMouseTracker(E),F=new SeadragonMouseTracker(t),B=[],R=null,H=1e3,U=2e3,z=null,j=!1,W=document.body.style.width,q=document.body.style.height,V=document.body.style.overflow,Y=document.documentElement.style.overflow,X=new SeadragonPoint(1,1),K=null,Z=0,Q=0,J=null,te=null,ee=!1,ne=!1,ie=!1;this.container=C,this.elmt=t,this.source=null,this.drawer=null,this.viewport=null,this.profiler=null,this.tracker=L,_.loopId=null;var re=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){var e=Date.now(),n=Math.max(0,16-(e-lastTime)),i=window.setTimeout(function(){t(e+n)},n);return lastTime=e+n,i},ae=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCanelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(t){clearTimeout(t)};this.scheduleUpdate=c,this.isOpen=function(){return!!P},this.openDzi=function(t,e){var n=o(),i=SeadragonUtils.createCallback(null,s,n);"string"==typeof t?SeadragonDziTileSource.createFromXml(t,e,i):SeadragonDziTileSource.createFromJson(t,i)},this.openTileSource=function(t){var e=o();window.setTimeout(function(){s(e,t)},1)},this.close=function(){P&&l()},this.addControl=function(n,i){if(n=SeadragonUtils.getElement(n),!(d(n)>=0)){var r=null;switch(i){case SeadragonControlAnchor.TOP_RIGHT:r=M,n.style.position="relative";break;case SeadragonControlAnchor.BOTTOM_RIGHT:r=I,n.style.position="relative";break;case SeadragonControlAnchor.BOTTOM_LEFT:r=D,n.style.position="relative";break;case SeadragonControlAnchor.TOP_LEFT:r=S,n.style.position="relative";break;case SeadragonControlAnchor.NONE:default:r=t,n.style.position="absolute"}B.push(new e(n,i,r))}},this.removeControl=function(t){t=SeadragonUtils.getElement(t);var e=d(t);e>=0&&(B[e].destroy(),B.splice(e,1))},this.clearControls=function(){for(;B.length>0;)B.pop().destroy()},this.getNavControl=function(){return R},this.isDashboardEnabled=function(){for(var t=B.length-1;t>=0;t--)if(B[t].isVisible())return!0;return!1},this.isFullPage=function(){return t.parentNode===document.body},this.isMouseNavEnabled=function(){return L.isTracking()},this.isVisible=function(){return"hidden"!==t.style.visibility},this.setDashboardEnabled=function(t){for(var e=B.length-1;e>=0;e--)B[e].setVisible(t)},this.setFullPage=function(e){if(e!==_.isFullPage()){var n=document.body,i=n.style,r=document.documentElement.style,a=t.style,o=E.style;if(e?(V=i.overflow,Y=r.overflow,i.overflow="hidden",r.overflow="hidden",W=i.width,q=i.height,i.width="100%",i.height="100%",o.backgroundColor="black",o.color="white",a.position="fixed",a.zIndex="99999999",n.appendChild(t),K=SeadragonUtils.getWindowSize(),SeadragonUtils.addEvent(document,"keydown",A),m()):(i.overflow=V,r.overflow=Y,i.width=W,i.height=q,o.backgroundColor="",o.color="",a.position="relative",a.zIndex="",C.appendChild(t),K=SeadragonUtils.getElementSize(C),SeadragonUtils.removeEvent(document,"keydown",A),v()),N){var s=N.getBounds();
N.resize(K);var l=N.getBounds();e?X=new SeadragonPoint(l.width/s.width,l.height/s.height):(N.update(),N.zoomBy(Math.max(X.x,X.y),null,!0)),ne=!0,O.trigger("resize",_),u()}}},this.setMouseNavEnabled=function(t){L.setTracking(t)},this.setVisible=function(e){t.style.visibility=e?"":"hidden"},this.showMessage=function(t,e){return e?(window.setTimeout(function(){_.isOpen()||a(t)},e),void 0):(a(t),void 0)},this.addEventListener=function(t,e){O.addListener(t,e)},this.removeEventListener=function(t,e){O.removeListener(t,e)},this.unload=function(){_.loopId&&(ae(_.loopId),_.loopId=null)},r()}})(),function(){function t(t){throw t}function e(t){return function(){return t}}function n(n){function d(t,e,n,i,a){var o=[];return t=P.j(function(){var t=e(n,a)||[];o.length>0&&(P.a.Ya(h(o),t),i&&P.r.K(i,r,[n,t,a])),o.splice(0,o.length),P.a.P(o,t)},r,{W:t,Ka:function(){return 0==o.length||!P.a.X(o[0])}}),{M:o,j:t.pa()?t:u}}function h(t){for(;t.length&&!P.a.X(t[0]);)t.splice(0,1);if(t.length>1){for(var e=t[0],n=t[t.length-1],i=[e];e!==n;){if(e=e.nextSibling,!e)return;i.push(e)}Array.prototype.splice.apply(t,[0,t.length].concat(i))}return t}function p(t,e,n,i,r){var a,o,s,l,c,u=Math.min,d=Math.max,h=[],p=t.length,f=e.length,g=f-p||1,m=p+f+1;for(a=0;p>=a;a++)for(l=s,h.push(s=[]),c=u(f,a+g),o=d(0,a-1);c>=o;o++)s[o]=o?a?t[a-1]===e[o-1]?l[o-1]:u(l[o]||m,s[o-1]||m)+1:o+1:a+1;for(u=[],d=[],g=[],a=p,o=f;a||o;)f=h[a][o]-1,o&&f===h[a][o-1]?d.push(u[u.length]={status:n,value:e[--o],index:o}):a&&f===h[a-1][o]?g.push(u[u.length]={status:i,value:t[--a],index:a}):(u.push({status:"retained",value:e[--o]}),--a);if(d.length&&g.length){t=10*p;var v;for(e=n=0;(r||t>e)&&(v=d[n]);n++){for(i=0;h=g[i];i++)if(v.value===h.value){v.moved=h.index,h.moved=v.index,g.splice(i,1),e=i=0;break}e+=i}}return u.reverse()}function f(e,n,o,s,l){l=l||{};var c=e&&g(e),c=c&&c.ownerDocument,u=l.templateEngine||Y;switch(P.za.vb(o,u,c),o=u.renderTemplate(o,s,l,c),("number"!=typeof o.length||o.length>0&&"number"!=typeof o[0].nodeType)&&t(Error("Template engine must return an array of DOM nodes")),c=a,n){case"replaceChildren":P.e.N(e,o),c=i;break;case"replaceNode":P.a.Ya(e,o),c=i;break;case"ignoreTargetNode":break;default:t(Error("Unknown renderMode: "+n))}return c&&(m(o,s),l.afterRender&&P.r.K(l.afterRender,r,[o,s.$data])),o}function g(t){return t.nodeType?t:t.length>0?t[0]:r}function m(t,e){if(t.length){var n=t[0],i=t[t.length-1];v(n,i,function(t){P.Da(e,t)}),v(n,i,function(t){P.s.ib(t,[e])})}}function v(t,e,n){var i;for(e=P.e.nextSibling(e);t&&(i=t)!==e;)t=P.e.nextSibling(i),(1===i.nodeType||8===i.nodeType)&&n(i)}function y(e,n,i){e=P.g.aa(e);for(var r=P.g.Q,a=0;e.length>a;a++){var o=e[a].key;if(r.hasOwnProperty(o)){var s=r[o];"function"==typeof s?(o=s(e[a].value))&&t(Error(o)):s||t(Error("This template engine does not support the '"+o+"' binding within its templates"))}}return e="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+P.g.ba(e)+" } })()})",i.createJavaScriptEvaluatorBlock(e)+n}function b(e,n,i,a){function o(t){return function(){return l[t]}}function s(){return l}var l,c,d=0;return P.j(function(){var r=i&&i instanceof P.z?i:new P.z(P.a.d(i)),h=r.$data;if(a&&P.eb(e,r),l=("function"==typeof n?n(r,e):n)||P.J.instance.getBindings(e,r)){if(0===d){d=1;for(var p in l){var f=P.c[p];f&&8===e.nodeType&&!P.e.I[p]&&t(Error("The binding '"+p+"' cannot be used with virtual elements")),f&&"function"==typeof f.init&&(f=f.init(e,o(p),s,h,r))&&f.controlsDescendantBindings&&(c!==u&&t(Error("Multiple bindings ("+c+" and "+p+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.")),c=p)}d=2}if(2===d)for(p in l)(f=P.c[p])&&"function"==typeof f.update&&f.update(e,o(p),s,h,r)}},r,{W:e}),{Nb:c===u}}function x(t,e,n){var a=i,o=1===e.nodeType;o&&P.e.Ta(e),(o&&n||P.J.instance.nodeHasBindings(e))&&(a=b(e,r,t,n).Nb),a&&T(t,e,!o)}function T(t,e,n){for(var i=P.e.firstChild(e);e=i;)i=P.e.nextSibling(e),x(t,e,n)}function w(t,e){var n=k(t,e);return n?n.length>0?n[n.length-1].nextSibling:t.nextSibling:r}function k(e,n){for(var i=e,a=1,o=[];i=i.nextSibling;){if(A(i)&&(a--,0===a))return o;o.push(i),_(i)&&a++}return n||t(Error("Cannot find closing comment tag to match: "+e.nodeValue)),r}function A(t){return 8==t.nodeType&&(R?t.text:t.nodeValue).match(U)}function _(t){return 8==t.nodeType&&(R?t.text:t.nodeValue).match(H)}function C(t,e){for(var n=r;t!=n;)n=t,t=t.replace(L,function(t,n){return e[n]});return t}function E(){var t=[],e=[];this.save=function(n,i){var r=P.a.i(t,n);r>=0?e[r]=i:(t.push(n),e.push(i))},this.get=function(n){return n=P.a.i(t,n),n>=0?e[n]:u}}function S(t,e,n){function i(i){var r=e(t[i]);switch(typeof r){case"boolean":case"number":case"string":case"function":a[i]=r;break;case"object":case"undefined":var o=n.get(r);a[i]=o!==u?o:S(r,e,n)}}if(n=n||new E,t=e(t),"object"!=typeof t||t===r||t===u||t instanceof Date)return t;var a=t instanceof Array?[]:{};n.save(t,a);var o=t;if(o instanceof Array){for(var s=0;o.length>s;s++)i(s);"function"==typeof o.toJSON&&i("toJSON")}else for(s in o)i(s);return a}function M(t,e){if(t)if(8==t.nodeType){var n=P.s.Ua(t.nodeValue);n!=r&&e.push({sb:t,Fb:n})}else if(1==t.nodeType)for(var n=0,i=t.childNodes,a=i.length;a>n;n++)M(i[n],e)}function I(t,e,n,r){P.c[t]={init:function(t){return P.a.f.set(t,W,{}),{controlsDescendantBindings:i}},update:function(t,a,o,s,l){o=P.a.f.get(t,W),a=P.a.d(a()),s=!n!=!a;var c=!o.Za;(c||e||s!==o.qb)&&(c&&(o.Za=P.a.Ia(P.e.childNodes(t),i)),s?(c||P.e.N(t,P.a.Ia(o.Za)),P.Ea(r?r(l,a):l,t)):P.e.Y(t),o.qb=s)}},P.g.Q[t]=a,P.e.I[t]=i}function D(t,e,n){n&&e!==P.k.q(t)&&P.k.T(t,e),e!==P.k.q(t)&&P.r.K(P.a.Ba,r,[t,"change"])}var P=n!==void 0?n:{};P.b=function(t,e){for(var n=t.split("."),i=P,r=0;n.length-1>r;r++)i=i[n[r]];i[n[n.length-1]]=e},P.p=function(t,e,n){t[e]=n},P.version="2.2.1",P.b("version",P.version),P.a=new function(){function e(t,e){if("input"!==P.a.u(t)||!t.type||"click"!=e.toLowerCase())return a;var n=t.type;return"checkbox"==n||"radio"==n}var n=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,d={},h={};d[/Firefox\/2/i.test(l.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"],d.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" ");for(var p in d){var f=d[p];if(f.length)for(var g=0,m=f.length;m>g;g++)h[f[g]]=p}var v,y={propertychange:i},d=3;for(p=s.createElement("div"),f=p.getElementsByTagName("i");p.innerHTML="<!--[if gt IE "+ ++d+"]><i></i><![endif]-->",f[0];);return v=d>4?d:u,{Na:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],o:function(t,e){for(var n=0,i=t.length;i>n;n++)e(t[n])},i:function(t,e){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(t,e);for(var n=0,i=t.length;i>n;n++)if(t[n]===e)return n;return-1},lb:function(t,e,n){for(var i=0,a=t.length;a>i;i++)if(e.call(n,t[i]))return t[i];return r},ga:function(t,e){var n=P.a.i(t,e);n>=0&&t.splice(n,1)},Ga:function(t){t=t||[];for(var e=[],n=0,i=t.length;i>n;n++)0>P.a.i(e,t[n])&&e.push(t[n]);return e},V:function(t,e){t=t||[];for(var n=[],i=0,r=t.length;r>i;i++)n.push(e(t[i]));return n},fa:function(t,e){t=t||[];for(var n=[],i=0,r=t.length;r>i;i++)e(t[i])&&n.push(t[i]);return n},P:function(t,e){if(e instanceof Array)t.push.apply(t,e);else for(var n=0,i=e.length;i>n;n++)t.push(e[n]);return t},extend:function(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},ka:function(t){for(;t.firstChild;)P.removeNode(t.firstChild)},Hb:function(t){t=P.a.L(t);for(var e=s.createElement("div"),n=0,i=t.length;i>n;n++)e.appendChild(P.A(t[n]));return e},Ia:function(t,e){for(var n=0,r=t.length,a=[];r>n;n++){var o=t[n].cloneNode(i);a.push(e?P.A(o):o)}return a},N:function(t,e){if(P.a.ka(t),e)for(var n=0,i=e.length;i>n;n++)t.appendChild(e[n])},Ya:function(t,e){var n=t.nodeType?[t]:t;if(n.length>0){for(var i=n[0],r=i.parentNode,a=0,o=e.length;o>a;a++)r.insertBefore(e[a],i);for(a=0,o=n.length;o>a;a++)P.removeNode(n[a])}},bb:function(t,e){7>v?t.setAttribute("selected",e):t.selected=e},D:function(t){return(t||"").replace(n,"")},Rb:function(t,e){for(var n=[],i=(t||"").split(e),r=0,a=i.length;a>r;r++){var o=P.a.D(i[r]);""!==o&&n.push(o)}return n},Ob:function(t,e){return t=t||"",e.length>t.length?a:t.substring(0,e.length)===e},tb:function(t,e){if(e.compareDocumentPosition)return 16==(16&e.compareDocumentPosition(t));for(;t!=r;){if(t==e)return i;t=t.parentNode}return a},X:function(t){return P.a.tb(t,t.ownerDocument)},u:function(t){return t&&t.tagName&&t.tagName.toLowerCase()},n:function(n,r,o){var s=v&&y[r];if(s||c===void 0)s||"function"!=typeof n.addEventListener?n.attachEvent!==void 0?n.attachEvent("on"+r,function(t){o.call(n,t)}):t(Error("Browser doesn't support addEventListener or attachEvent")):n.addEventListener(r,o,a);else{if(e(n,r)){var l=o;o=function(t,e){var n=this.checked;e&&(this.checked=e.nb!==i),l.call(this,t),this.checked=n}}c(n).bind(r,o)}},Ba:function(n,r){if((!n||!n.nodeType)&&t(Error("element must be a DOM node when calling triggerEvent")),c!==void 0){var l=[];e(n,r)&&l.push({nb:n.checked}),c(n).trigger(r,l)}else"function"==typeof s.createEvent?"function"==typeof n.dispatchEvent?(l=s.createEvent(h[r]||"HTMLEvents"),l.initEvent(r,i,i,o,0,0,0,0,0,a,a,a,a,0,n),n.dispatchEvent(l)):t(Error("The supplied element doesn't support dispatchEvent")):n.fireEvent!==void 0?(e(n,r)&&(n.checked=n.checked!==i),n.fireEvent("on"+r)):t(Error("Browser doesn't support triggering events"))},d:function(t){return P.$(t)?t():t},ua:function(t){return P.$(t)?t.t():t},da:function(t,e,n){if(e){var i=/[\w-]+/g,r=t.className.match(i)||[];P.a.o(e.match(i),function(t){var e=P.a.i(r,t);e>=0?n||r.splice(e,1):n&&r.push(t)}),t.className=r.join(" ")}},cb:function(t,e){var n=P.a.d(e);if((n===r||n===u)&&(n=""),3===t.nodeType)t.data=n;else{var i=P.e.firstChild(t);!i||3!=i.nodeType||P.e.nextSibling(i)?P.e.N(t,[s.createTextNode(n)]):i.data=n,P.a.wb(t)}},ab:function(t,e){if(t.name=e,7>=v)try{t.mergeAttributes(s.createElement("<input name='"+t.name+"'/>"),a)}catch(n){}},wb:function(t){v>=9&&(t=1==t.nodeType?t:t.parentNode,t.style&&(t.style.zoom=t.style.zoom))},ub:function(t){if(v>=9){var e=t.style.width;t.style.width=0,t.style.width=e}},Lb:function(t,e){t=P.a.d(t),e=P.a.d(e);for(var n=[],i=t;e>=i;i++)n.push(i);return n},L:function(t){for(var e=[],n=0,i=t.length;i>n;n++)e.push(t[n]);return e},Pb:6===v,Qb:7===v,Z:v,Oa:function(t,e){for(var n=P.a.L(t.getElementsByTagName("input")).concat(P.a.L(t.getElementsByTagName("textarea"))),i="string"==typeof e?function(t){return t.name===e}:function(t){return e.test(t.name)},r=[],a=n.length-1;a>=0;a--)i(n[a])&&r.push(n[a]);return r},Ib:function(t){return"string"==typeof t&&(t=P.a.D(t))?o.JSON&&o.JSON.parse?o.JSON.parse(t):Function("return "+t)():r},xa:function(e,n,i){return("undefined"==typeof JSON||JSON.stringify===void 0)&&t(Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js")),JSON.stringify(P.a.d(e),n,i)},Jb:function(t,e,n){n=n||{};var i=n.params||{},r=n.includeFields||this.Na,a=t;if("object"==typeof t&&"form"===P.a.u(t))for(var a=t.action,o=r.length-1;o>=0;o--)for(var l=P.a.Oa(t,r[o]),c=l.length-1;c>=0;c--)i[l[c].name]=l[c].value;e=P.a.d(e);var u=s.createElement("form");u.style.display="none",u.action=a,u.method="post";for(var d in e)t=s.createElement("input"),t.name=d,t.value=P.a.xa(P.a.d(e[d])),u.appendChild(t);for(d in i)t=s.createElement("input"),t.name=d,t.value=i[d],u.appendChild(t);s.body.appendChild(u),n.submitter?n.submitter(u):u.submit(),setTimeout(function(){u.parentNode.removeChild(u)},0)}}},P.b("utils",P.a),P.b("utils.arrayForEach",P.a.o),P.b("utils.arrayFirst",P.a.lb),P.b("utils.arrayFilter",P.a.fa),P.b("utils.arrayGetDistinctValues",P.a.Ga),P.b("utils.arrayIndexOf",P.a.i),P.b("utils.arrayMap",P.a.V),P.b("utils.arrayPushAll",P.a.P),P.b("utils.arrayRemoveItem",P.a.ga),P.b("utils.extend",P.a.extend),P.b("utils.fieldsIncludedWithJsonPost",P.a.Na),P.b("utils.getFormFields",P.a.Oa),P.b("utils.peekObservable",P.a.ua),P.b("utils.postJson",P.a.Jb),P.b("utils.parseJson",P.a.Ib),P.b("utils.registerEventHandler",P.a.n),P.b("utils.stringifyJson",P.a.xa),P.b("utils.range",P.a.Lb),P.b("utils.toggleDomNodeCssClass",P.a.da),P.b("utils.triggerEvent",P.a.Ba),P.b("utils.unwrapObservable",P.a.d),Function.prototype.bind||(Function.prototype.bind=function(t){var e=this,n=Array.prototype.slice.call(arguments);return t=n.shift(),function(){return e.apply(t,n.concat(Array.prototype.slice.call(arguments)))}}),P.a.f=new function(){var t=0,e="__ko__"+(new Date).getTime(),n={};return{get:function(t,e){var n=P.a.f.la(t,a);return n===u?u:n[e]},set:function(t,e,n){n===u&&P.a.f.la(t,a)===u||(P.a.f.la(t,i)[e]=n)},la:function(i,r){var a=i[e];if(!a||"null"===a||!n[a]){if(!r)return u;a=i[e]="ko"+t++,n[a]={}}return n[a]},clear:function(t){var o=t[e];return o?(delete n[o],t[e]=r,i):a}}},P.b("utils.domData",P.a.f),P.b("utils.domData.clear",P.a.f.clear),P.a.F=new function(){function e(t,e){var n=P.a.f.get(t,r);return n===u&&e&&(n=[],P.a.f.set(t,r,n)),n}function n(t){var i=e(t,a);if(i)for(var i=i.slice(0),r=0;i.length>r;r++)i[r](t);if(P.a.f.clear(t),"function"==typeof c&&"function"==typeof c.cleanData&&c.cleanData([t]),s[t.nodeType])for(i=t.firstChild;t=i;)i=t.nextSibling,8===t.nodeType&&n(t)}var r="__ko_domNodeDisposal__"+(new Date).getTime(),o={1:i,8:i,9:i},s={1:i,9:i};return{Ca:function(n,r){"function"!=typeof r&&t(Error("Callback must be a function")),e(n,i).push(r)},Xa:function(t,n){var i=e(t,a);i&&(P.a.ga(i,n),0==i.length&&P.a.f.set(t,r,u))},A:function(t){if(o[t.nodeType]&&(n(t),s[t.nodeType])){var e=[];P.a.P(e,t.getElementsByTagName("*"));for(var i=0,r=e.length;r>i;i++)n(e[i])}return t},removeNode:function(t){P.A(t),t.parentNode&&t.parentNode.removeChild(t)}}},P.A=P.a.F.A,P.removeNode=P.a.F.removeNode,P.b("cleanNode",P.A),P.b("removeNode",P.removeNode),P.b("utils.domNodeDisposal",P.a.F),P.b("utils.domNodeDisposal.addDisposeCallback",P.a.F.Ca),P.b("utils.domNodeDisposal.removeDisposeCallback",P.a.F.Xa),P.a.ta=function(t){var e;if(c!==void 0){if(c.parseHTML)e=c.parseHTML(t);else if((e=c.clean([t]))&&e[0]){for(t=e[0];t.parentNode&&11!==t.parentNode.nodeType;)t=t.parentNode;t.parentNode&&t.parentNode.removeChild(t)}}else{var n=P.a.D(t).toLowerCase();for(e=s.createElement("div"),n=n.match(/^<(thead|tbody|tfoot)/)&&[1,"<table>","</table>"]||!n.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!n.indexOf("<td")||!n.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||[0,"",""],t="ignored<div>"+n[1]+t+n[2]+"</div>","function"==typeof o.innerShiv?e.appendChild(o.innerShiv(t)):e.innerHTML=t;n[0]--;)e=e.lastChild;e=P.a.L(e.lastChild.childNodes)}return e},P.a.ca=function(t,e){if(P.a.ka(t),e=P.a.d(e),e!==r&&e!==u)if("string"!=typeof e&&(e=""+e),c!==void 0)c(t).html(e);else for(var n=P.a.ta(e),i=0;n.length>i;i++)t.appendChild(n[i])},P.b("utils.parseHtmlFragment",P.a.ta),P.b("utils.setHtml",P.a.ca);var $={};P.s={ra:function(e){"function"!=typeof e&&t(Error("You can only pass a function to ko.memoization.memoize()"));var n=(0|4294967296*(1+Math.random())).toString(16).substring(1)+(0|4294967296*(1+Math.random())).toString(16).substring(1);return $[n]=e,"<!--[ko_memo:"+n+"]-->"},hb:function(e,n){var a=$[e];a===u&&t(Error("Couldn't find any memo with ID "+e+". Perhaps it's already been unmemoized."));try{return a.apply(r,n||[]),i}finally{delete $[e]}},ib:function(t,e){var n=[];M(t,n);for(var i=0,r=n.length;r>i;i++){var a=n[i].sb,o=[a];e&&P.a.P(o,e),P.s.hb(n[i].Fb,o),a.nodeValue="",a.parentNode&&a.parentNode.removeChild(a)}},Ua:function(t){return(t=t.match(/^\[ko_memo\:(.*?)\]$/))?t[1]:r}},P.b("memoization",P.s),P.b("memoization.memoize",P.s.ra),P.b("memoization.unmemoize",P.s.hb),P.b("memoization.parseMemoText",P.s.Ua),P.b("memoization.unmemoizeDomNodeAndDescendants",P.s.ib),P.Ma={throttle:function(t,e){t.throttleEvaluation=e;var n=r;return P.j({read:t,write:function(i){clearTimeout(n),n=setTimeout(function(){t(i)},e)}})},notify:function(t,n){return t.equalityComparer="always"==n?e(a):P.m.fn.equalityComparer,t}},P.b("extenders",P.Ma),P.fb=function(t,e,n){this.target=t,this.ha=e,this.rb=n,P.p(this,"dispose",this.B)},P.fb.prototype.B=function(){this.Cb=i,this.rb()},P.S=function(){this.w={},P.a.extend(this,P.S.fn),P.p(this,"subscribe",this.ya),P.p(this,"extend",this.extend),P.p(this,"getSubscriptionsCount",this.yb)},P.S.fn={ya:function(t,e,n){n=n||"change";var i=new P.fb(this,e?t.bind(e):t,function(){P.a.ga(this.w[n],i)}.bind(this));return this.w[n]||(this.w[n]=[]),this.w[n].push(i),i},notifySubscribers:function(t,e){e=e||"change",this.w[e]&&P.r.K(function(){P.a.o(this.w[e].slice(0),function(e){e&&e.Cb!==i&&e.ha(t)})},this)},yb:function(){var t,e=0;for(t in this.w)this.w.hasOwnProperty(t)&&(e+=this.w[t].length);return e},extend:function(t){var e=this;if(t)for(var n in t){var i=P.Ma[n];"function"==typeof i&&(e=i(e,t[n]))}return e}},P.Qa=function(t){return"function"==typeof t.ya&&"function"==typeof t.notifySubscribers},P.b("subscribable",P.S),P.b("isSubscribable",P.Qa);var N=[];P.r={mb:function(t){N.push({ha:t,La:[]})},end:function(){N.pop()},Wa:function(e){if(P.Qa(e)||t(Error("Only subscribable things can act as dependencies")),N.length>0){var n=N[N.length-1];n&&!(P.a.i(n.La,e)>=0)&&(n.La.push(e),n.ha(e))}},K:function(t,e,n){try{return N.push(r),t.apply(e,n||[])}finally{N.pop()}}};var G={undefined:i,"boolean":i,number:i,string:i};P.m=function(t){function e(){return arguments.length>0?(e.equalityComparer&&e.equalityComparer(n,arguments[0])||(e.H(),n=arguments[0],e.G()),this):(P.r.Wa(e),n)}var n=t;return P.S.call(e),e.t=function(){return n},e.G=function(){e.notifySubscribers(n)},e.H=function(){e.notifySubscribers(n,"beforeChange")},P.a.extend(e,P.m.fn),P.p(e,"peek",e.t),P.p(e,"valueHasMutated",e.G),P.p(e,"valueWillMutate",e.H),e},P.m.fn={equalityComparer:function(t,e){return t===r||typeof t in G?t===e:a}};var O=P.m.Kb="__ko_proto__";P.m.fn[O]=P.m,P.ma=function(t,e){return t===r||t===u||t[O]===u?a:t[O]===e?i:P.ma(t[O],e)},P.$=function(t){return P.ma(t,P.m)},P.Ra=function(t){return"function"==typeof t&&t[O]===P.m||"function"==typeof t&&t[O]===P.j&&t.zb?i:a},P.b("observable",P.m),P.b("isObservable",P.$),P.b("isWriteableObservable",P.Ra),P.R=function(e){0==arguments.length&&(e=[]),e!==r&&e!==u&&!("length"in e)&&t(Error("The argument passed when initializing an observable array must be an array, or null, or undefined."));var n=P.m(e);return P.a.extend(n,P.R.fn),n},P.R.fn={remove:function(t){for(var e=this.t(),n=[],i="function"==typeof t?t:function(e){return e===t},r=0;e.length>r;r++){var a=e[r];i(a)&&(0===n.length&&this.H(),n.push(a),e.splice(r,1),r--)}return n.length&&this.G(),n},removeAll:function(t){if(t===u){var e=this.t(),n=e.slice(0);return this.H(),e.splice(0,e.length),this.G(),n}return t?this.remove(function(e){return P.a.i(t,e)>=0}):[]},destroy:function(t){var e=this.t(),n="function"==typeof t?t:function(e){return e===t};this.H();for(var r=e.length-1;r>=0;r--)n(e[r])&&(e[r]._destroy=i);this.G()},destroyAll:function(t){return t===u?this.destroy(e(i)):t?this.destroy(function(e){return P.a.i(t,e)>=0}):[]},indexOf:function(t){var e=this();return P.a.i(e,t)},replace:function(t,e){var n=this.indexOf(t);n>=0&&(this.H(),this.t()[n]=e,this.G())}},P.a.o("pop push reverse shift sort splice unshift".split(" "),function(t){P.R.fn[t]=function(){var e=this.t();return this.H(),e=e[t].apply(e,arguments),this.G(),e}}),P.a.o(["slice"],function(t){P.R.fn[t]=function(){var e=this();return e[t].apply(e,arguments)}}),P.b("observableArray",P.R),P.j=function(n,o,s){function l(){P.a.o(w,function(t){t.B()}),w=[]}function c(){var t=h.throttleEvaluation;t&&t>=0?(clearTimeout(k),k=setTimeout(d,t)):d()}function d(){if(!m)if(g&&x())T();else{m=i;try{var t=P.a.V(w,function(t){return t.target});P.r.mb(function(e){var n;(n=P.a.i(t,e))>=0?t[n]=u:w.push(e.ya(c))});for(var e=v.call(o),n=t.length-1;n>=0;n--)t[n]&&w.splice(n,1)[0].B();g=i,h.notifySubscribers(f,"beforeChange"),f=e}finally{P.r.end()}h.notifySubscribers(f),m=a,w.length||T()}}function h(){return arguments.length>0?("function"==typeof y?y.apply(o,arguments):t(Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.")),this):(g||d(),P.r.Wa(h),f)}function p(){return!g||w.length>0}var f,g=a,m=a,v=n;v&&"object"==typeof v?(s=v,v=s.read):(s=s||{},v||(v=s.read)),"function"!=typeof v&&t(Error("Pass a function that returns the value of the ko.computed"));var y=s.write,b=s.disposeWhenNodeIsRemoved||s.W||r,x=s.disposeWhen||s.Ka||e(a),T=l,w=[],k=r;if(o||(o=s.owner),h.t=function(){return g||d(),f},h.xb=function(){return w.length},h.zb="function"==typeof s.write,h.B=function(){T()},h.pa=p,P.S.call(h),P.a.extend(h,P.j.fn),P.p(h,"peek",h.t),P.p(h,"dispose",h.B),P.p(h,"isActive",h.pa),P.p(h,"getDependenciesCount",h.xb),s.deferEvaluation!==i&&d(),b&&p()){T=function(){P.a.F.Xa(b,arguments.callee),l()},P.a.F.Ca(b,T);var A=x,x=function(){return!P.a.X(b)||A()}}return h},P.Bb=function(t){return P.ma(t,P.j)},n=P.m.Kb,P.j[n]=P.m,P.j.fn={},P.j.fn[n]=P.j,P.b("dependentObservable",P.j),P.b("computed",P.j),P.b("isComputed",P.Bb),P.gb=function(e){return 0==arguments.length&&t(Error("When calling ko.toJS, pass the object you want to convert.")),S(e,function(t){for(var e=0;P.$(t)&&10>e;e++)t=t();return t})},P.toJSON=function(t,e,n){return t=P.gb(t),P.a.xa(t,e,n)},P.b("toJS",P.gb),P.b("toJSON",P.toJSON),P.k={q:function(t){switch(P.a.u(t)){case"option":return t.__ko__hasDomDataOptionValue__===i?P.a.f.get(t,P.c.options.sa):7>=P.a.Z?t.getAttributeNode("value").specified?t.value:t.text:t.value;case"select":return t.selectedIndex>=0?P.k.q(t.options[t.selectedIndex]):u;default:return t.value}},T:function(t,e){switch(P.a.u(t)){case"option":switch(typeof e){case"string":P.a.f.set(t,P.c.options.sa,u),"__ko__hasDomDataOptionValue__"in t&&delete t.__ko__hasDomDataOptionValue__,t.value=e;break;default:P.a.f.set(t,P.c.options.sa,e),t.__ko__hasDomDataOptionValue__=i,t.value="number"==typeof e?e:""}break;case"select":for(var n=t.options.length-1;n>=0;n--)if(P.k.q(t.options[n])==e){t.selectedIndex=n;break}break;default:(e===r||e===u)&&(e=""),t.value=e}}},P.b("selectExtensions",P.k),P.b("selectExtensions.readValue",P.k.q),P.b("selectExtensions.writeValue",P.k.T);var L=/\@ko_token_(\d+)\@/g,F=["true","false"],B=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i;P.g={Q:[],aa:function(t){var e=P.a.D(t);if(3>e.length)return[];"{"===e.charAt(0)&&(e=e.substring(1,e.length-1)),t=[];for(var n,i=r,a=0;e.length>a;a++){var o=e.charAt(a);if(i===r)switch(o){case'"':case"'":case"/":i=a,n=o}else if(o==n&&"\\"!==e.charAt(a-1)){o=e.substring(i,a+1),t.push(o);var s="@ko_token_"+(t.length-1)+"@",e=e.substring(0,i)+s+e.substring(a+1),a=a-(o.length-s.length),i=r}}n=i=r;for(var l=0,c=r,a=0;e.length>a;a++){if(o=e.charAt(a),i===r)switch(o){case"{":i=a,c=o,n="}";break;case"(":i=a,c=o,n=")";break;case"[":i=a,c=o,n="]"}o===c?l++:o===n&&(l--,0===l&&(o=e.substring(i,a+1),t.push(o),s="@ko_token_"+(t.length-1)+"@",e=e.substring(0,i)+s+e.substring(a+1),a-=o.length-s.length,i=r))}for(n=[],e=e.split(","),i=0,a=e.length;a>i;i++)l=e[i],c=l.indexOf(":"),c>0&&l.length-1>c?(o=l.substring(c+1),n.push({key:C(l.substring(0,c),t),value:C(o,t)})):n.push({unknown:C(l,t)});return n},ba:function(t){var e="string"==typeof t?P.g.aa(t):t,n=[];t=[];for(var i,o=0;i=e[o];o++)if(n.length>0&&n.push(","),i.key){var s;t:{s=i.key;var l=P.a.D(s);switch(l.length&&l.charAt(0)){case"'":case'"':break t;default:s="'"+l+"'"}}i=i.value,n.push(s),n.push(":"),n.push(i),i=P.a.D(i),P.a.i(F,P.a.D(i).toLowerCase())>=0?i=a:(l=i.match(B),i=l===r?a:l[1]?"Object("+l[1]+")"+l[2]:i),i&&(t.length>0&&t.push(", "),t.push(s+" : function(__ko_value) { "+i+" = __ko_value; }"))}else i.unknown&&n.push(i.unknown);return e=n.join(""),t.length>0&&(e=e+", '_ko_property_writers' : { "+t.join("")+" } "),e},Eb:function(t,e){for(var n=0;t.length>n;n++)if(P.a.D(t[n].key)==e)return i;return a},ea:function(t,e,n,i,r){t&&P.Ra(t)?(!r||t.t()!==i)&&t(i):(t=e()._ko_property_writers)&&t[n]&&t[n](i)}},P.b("expressionRewriting",P.g),P.b("expressionRewriting.bindingRewriteValidators",P.g.Q),P.b("expressionRewriting.parseObjectLiteral",P.g.aa),P.b("expressionRewriting.preProcessBindings",P.g.ba),P.b("jsonExpressionRewriting",P.g),P.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",P.g.ba);var R="<!--test-->"===s.createComment("test").text,H=R?/^\x3c!--\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*--\x3e$/:/^\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*$/,U=R?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,z={ul:i,ol:i};P.e={I:{},childNodes:function(t){return _(t)?k(t):t.childNodes},Y:function(t){if(_(t)){t=P.e.childNodes(t);for(var e=0,n=t.length;n>e;e++)P.removeNode(t[e])}else P.a.ka(t)},N:function(t,e){if(_(t)){P.e.Y(t);for(var n=t.nextSibling,i=0,r=e.length;r>i;i++)n.parentNode.insertBefore(e[i],n)}else P.a.N(t,e)},Va:function(t,e){_(t)?t.parentNode.insertBefore(e,t.nextSibling):t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)},Pa:function(t,e,n){n?_(t)?t.parentNode.insertBefore(e,n.nextSibling):n.nextSibling?t.insertBefore(e,n.nextSibling):t.appendChild(e):P.e.Va(t,e)},firstChild:function(t){return _(t)?!t.nextSibling||A(t.nextSibling)?r:t.nextSibling:t.firstChild},nextSibling:function(t){return _(t)&&(t=w(t)),t.nextSibling&&A(t.nextSibling)?r:t.nextSibling},jb:function(t){return(t=_(t))?t[1]:r},Ta:function(t){if(z[P.a.u(t)]){var e=t.firstChild;if(e)do if(1===e.nodeType){var n;n=e.firstChild;var a=r;if(n)do if(a)a.push(n);else if(_(n)){var o=w(n,i);o?n=o:a=[n]}else A(n)&&(a=[n]);while(n=n.nextSibling);if(n=a)for(a=e.nextSibling,o=0;n.length>o;o++)a?t.insertBefore(n[o],a):t.appendChild(n[o])}while(e=e.nextSibling)}}},P.b("virtualElements",P.e),P.b("virtualElements.allowedBindings",P.e.I),P.b("virtualElements.emptyNode",P.e.Y),P.b("virtualElements.insertAfter",P.e.Pa),P.b("virtualElements.prepend",P.e.Va),P.b("virtualElements.setDomNodeChildren",P.e.N),P.J=function(){this.Ha={}},P.a.extend(P.J.prototype,{nodeHasBindings:function(t){switch(t.nodeType){case 1:return t.getAttribute("data-bind")!=r;case 8:return P.e.jb(t)!=r;default:return a}},getBindings:function(t,e){var n=this.getBindingsString(t,e);return n?this.parseBindingsString(n,e,t):r},getBindingsString:function(t){switch(t.nodeType){case 1:return t.getAttribute("data-bind");case 8:return P.e.jb(t);default:return r}},parseBindingsString:function(e,n,i){try{var r;if(!(r=this.Ha[e])){var a,o=this.Ha,s="with($context){with($data||{}){return{"+P.g.ba(e)+"}}}";a=Function("$context","$element",s),r=o[e]=a}return r(n,i)}catch(l){t(Error("Unable to parse bindings.\nMessage: "+l+";\nBindings value: "+e))}}}),P.J.instance=new P.J,P.b("bindingProvider",P.J),P.c={},P.z=function(t,e,n){e?(P.a.extend(this,e),this.$parentContext=e,this.$parent=e.$data,this.$parents=(e.$parents||[]).slice(0),this.$parents.unshift(this.$parent)):(this.$parents=[],this.$root=t,this.ko=P),this.$data=t,n&&(this[n]=t)},P.z.prototype.createChildContext=function(t,e){return new P.z(t,this,e)},P.z.prototype.extend=function(t){var e=P.a.extend(new P.z,this);return P.a.extend(e,t)},P.eb=function(t,e){return 2!=arguments.length?P.a.f.get(t,"__ko_bindingContext__"):(P.a.f.set(t,"__ko_bindingContext__",e),void 0)},P.Fa=function(t,e,n){return 1===t.nodeType&&P.e.Ta(t),b(t,e,n,i)},P.Ea=function(t,e){(1===e.nodeType||8===e.nodeType)&&T(t,e,i)},P.Da=function(e,n){n&&1!==n.nodeType&&8!==n.nodeType&&t(Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node")),n=n||o.document.body,x(e,n,i)},P.ja=function(t){switch(t.nodeType){case 1:case 8:var e=P.eb(t);if(e)return e;if(t.parentNode)return P.ja(t.parentNode)}return u},P.pb=function(t){return(t=P.ja(t))?t.$data:u},P.b("bindingHandlers",P.c),P.b("applyBindings",P.Da),P.b("applyBindingsToDescendants",P.Ea),P.b("applyBindingsToNode",P.Fa),P.b("contextFor",P.ja),P.b("dataFor",P.pb);var j={"class":"className","for":"htmlFor"};P.c.attr={update:function(t,e){var n,i=P.a.d(e())||{};for(n in i)if("string"==typeof n){var o=P.a.d(i[n]),s=o===a||o===r||o===u;s&&t.removeAttribute(n),8>=P.a.Z&&n in j?(n=j[n],s?t.removeAttribute(n):t[n]=o):s||t.setAttribute(n,""+o),"name"===n&&P.a.ab(t,s?"":""+o)}}},P.c.checked={init:function(t,n,r){P.a.n(t,"click",function(){var e;if("checkbox"==t.type)e=t.checked;else{if("radio"!=t.type||!t.checked)return;e=t.value}var a=n(),o=P.a.d(a);"checkbox"==t.type&&o instanceof Array?(e=P.a.i(o,t.value),t.checked&&0>e?a.push(t.value):!t.checked&&e>=0&&a.splice(e,1)):P.g.ea(a,r,"checked",e,i)}),"radio"==t.type&&!t.name&&P.c.uniqueName.init(t,e(i))},update:function(t,e){var n=P.a.d(e());"checkbox"==t.type?t.checked=n instanceof Array?P.a.i(n,t.value)>=0:n:"radio"==t.type&&(t.checked=t.value==n)}},P.c.css={update:function(t,e){var n=P.a.d(e());if("object"==typeof n)for(var r in n){var o=P.a.d(n[r]);P.a.da(t,r,o)}else n=(n||"")+"",P.a.da(t,t.__ko__cssValue,a),t.__ko__cssValue=n,P.a.da(t,n,i)}},P.c.enable={update:function(t,e){var n=P.a.d(e());n&&t.disabled?t.removeAttribute("disabled"):!n&&!t.disabled&&(t.disabled=i)}},P.c.disable={update:function(t,e){P.c.enable.update(t,function(){return!P.a.d(e())})}},P.c.event={init:function(t,e,n,r){var o,s=e()||{};for(o in s)(function(){var s=o;"string"==typeof s&&P.a.n(t,s,function(t){var o,l=e()[s];if(l){var c=n();try{var u=P.a.L(arguments);u.unshift(r),o=l.apply(r,u)}finally{o!==i&&(t.preventDefault?t.preventDefault():t.returnValue=a)}c[s+"Bubble"]===a&&(t.cancelBubble=i,t.stopPropagation&&t.stopPropagation())}})})()}},P.c.foreach={Sa:function(t){return function(){var e=t(),n=P.a.ua(e);return n&&"number"!=typeof n.length?(P.a.d(e),{foreach:n.data,as:n.as,includeDestroyed:n.includeDestroyed,afterAdd:n.afterAdd,beforeRemove:n.beforeRemove,afterRender:n.afterRender,beforeMove:n.beforeMove,afterMove:n.afterMove,templateEngine:P.C.oa}):{foreach:e,templateEngine:P.C.oa}}},init:function(t,e){return P.c.template.init(t,P.c.foreach.Sa(e))},update:function(t,e,n,i,r){return P.c.template.update(t,P.c.foreach.Sa(e),n,i,r)}},P.g.Q.foreach=a,P.e.I.foreach=i,P.c.hasfocus={init:function(t,e,n){function o(r){t.__ko_hasfocusUpdating=i;var o=t.ownerDocument;"activeElement"in o&&(r=o.activeElement===t),o=e(),P.g.ea(o,n,"hasfocus",r,i),t.__ko_hasfocusUpdating=a}var s=o.bind(r,i),l=o.bind(r,a);P.a.n(t,"focus",s),P.a.n(t,"focusin",s),P.a.n(t,"blur",l),P.a.n(t,"focusout",l)},update:function(t,e){var n=P.a.d(e());t.__ko_hasfocusUpdating||(n?t.focus():t.blur(),P.r.K(P.a.Ba,r,[t,n?"focusin":"focusout"]))}},P.c.html={init:function(){return{controlsDescendantBindings:i}},update:function(t,e){P.a.ca(t,e())}};var W="__ko_withIfBindingData";I("if"),I("ifnot",a,i),I("with",i,a,function(t,e){return t.createChildContext(e)}),P.c.options={update:function(e,n,r){"select"!==P.a.u(e)&&t(Error("options binding applies only to SELECT elements"));for(var a=0==e.length,o=P.a.V(P.a.fa(e.childNodes,function(t){return t.tagName&&"option"===P.a.u(t)&&t.selected}),function(t){return P.k.q(t)||t.innerText||t.textContent}),l=e.scrollTop,c=P.a.d(n());e.length>0;)P.A(e.options[0]),e.remove(0);if(c){r=r();var d=r.optionsIncludeDestroyed;if("number"!=typeof c.length&&(c=[c]),r.optionsCaption){var h=s.createElement("option");P.a.ca(h,r.optionsCaption),P.k.T(h,u),e.appendChild(h)}n=0;for(var p=c.length;p>n;n++){var f=c[n];if(!f||!f._destroy||d){var h=s.createElement("option"),g=function(t,e,n){var i=typeof e;return"function"==i?e(t):"string"==i?t[e]:n},m=g(f,r.optionsValue,f);P.k.T(h,P.a.d(m)),f=g(f,r.optionsText,m),P.a.cb(h,f),e.appendChild(h)}}for(c=e.getElementsByTagName("option"),n=d=0,p=c.length;p>n;n++)P.a.i(o,P.k.q(c[n]))>=0&&(P.a.bb(c[n],i),d++);e.scrollTop=l,a&&"value"in r&&D(e,P.a.ua(r.value),i),P.a.ub(e)}}},P.c.options.sa="__ko.optionValueDomData__",P.c.selectedOptions={init:function(t,e,n){P.a.n(t,"change",function(){var i=e(),r=[];P.a.o(t.getElementsByTagName("option"),function(t){t.selected&&r.push(P.k.q(t))
}),P.g.ea(i,n,"value",r)})},update:function(e,n){"select"!=P.a.u(e)&&t(Error("values binding applies only to SELECT elements"));var i=P.a.d(n());i&&"number"==typeof i.length&&P.a.o(e.getElementsByTagName("option"),function(t){var e=P.a.i(i,P.k.q(t))>=0;P.a.bb(t,e)})}},P.c.style={update:function(t,e){var n,i=P.a.d(e()||{});for(n in i)if("string"==typeof n){var r=P.a.d(i[n]);t.style[n]=r||""}}},P.c.submit={init:function(e,n,r,o){"function"!=typeof n()&&t(Error("The value for a submit binding must be a function")),P.a.n(e,"submit",function(t){var r,s=n();try{r=s.call(o,e)}finally{r!==i&&(t.preventDefault?t.preventDefault():t.returnValue=a)}})}},P.c.text={update:function(t,e){P.a.cb(t,e())}},P.e.I.text=i,P.c.uniqueName={init:function(t,e){if(e()){var n="ko_unique_"+ ++P.c.uniqueName.ob;P.a.ab(t,n)}}},P.c.uniqueName.ob=0,P.c.value={init:function(t,e,n){function r(){l=a;var i=e(),r=P.k.q(t);P.g.ea(i,n,"value",r)}var o=["change"],s=n().valueUpdate,l=a;s&&("string"==typeof s&&(s=[s]),P.a.P(o,s),o=P.a.Ga(o)),!P.a.Z||"input"!=t.tagName.toLowerCase()||"text"!=t.type||"off"==t.autocomplete||t.form&&"off"==t.form.autocomplete||-1!=P.a.i(o,"propertychange")||(P.a.n(t,"propertychange",function(){l=i}),P.a.n(t,"blur",function(){l&&r()})),P.a.o(o,function(e){var n=r;P.a.Ob(e,"after")&&(n=function(){setTimeout(r,0)},e=e.substring(5)),P.a.n(t,e,n)})},update:function(t,e){var n="select"===P.a.u(t),r=P.a.d(e()),o=P.k.q(t),s=r!=o;0===r&&0!==o&&"0"!==o&&(s=i),s&&(o=function(){P.k.T(t,r)},o(),n&&setTimeout(o,0)),n&&t.length>0&&D(t,r,a)}},P.c.visible={update:function(t,e){var n=P.a.d(e()),i="none"!=t.style.display;n&&!i?t.style.display="":!n&&i&&(t.style.display="none")}},P.c.click={init:function(t,e,n,i){return P.c.event.init.call(this,t,function(){var t={};return t.click=e(),t},n,i)}},P.v=function(){},P.v.prototype.renderTemplateSource=function(){t(Error("Override renderTemplateSource"))},P.v.prototype.createJavaScriptEvaluatorBlock=function(){t(Error("Override createJavaScriptEvaluatorBlock"))},P.v.prototype.makeTemplateSource=function(e,n){if("string"==typeof e){n=n||s;var i=n.getElementById(e);return i||t(Error("Cannot find template with ID "+e)),new P.l.h(i)}return 1==e.nodeType||8==e.nodeType?new P.l.O(e):(t(Error("Unknown template type: "+e)),void 0)},P.v.prototype.renderTemplate=function(t,e,n,i){return t=this.makeTemplateSource(t,i),this.renderTemplateSource(t,e,n)},P.v.prototype.isTemplateRewritten=function(t,e){return this.allowTemplateRewriting===a?i:this.makeTemplateSource(t,e).data("isRewritten")},P.v.prototype.rewriteTemplate=function(t,e,n){t=this.makeTemplateSource(t,n),e=e(t.text()),t.text(e),t.data("isRewritten",i)},P.b("templateEngine",P.v);var q=/(<[a-z]+\d*(\s+(?!data-bind=)[a-z0-9\-]+(=(\"[^\"]*\"|\'[^\']*\'))?)*\s+)data-bind=(["'])([\s\S]*?)\5/gi,V=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;P.za={vb:function(t,e,n){e.isTemplateRewritten(t,n)||e.rewriteTemplate(t,function(t){return P.za.Gb(t,e)},n)},Gb:function(t,e){return t.replace(q,function(t,n,i,r,a,o,s){return y(s,n,e)}).replace(V,function(t,n){return y(n,"<!-- ko -->",e)})},kb:function(t){return P.s.ra(function(e,n){e.nextSibling&&P.Fa(e.nextSibling,t,n)})}},P.b("__tr_ambtns",P.za.kb),P.l={},P.l.h=function(t){this.h=t},P.l.h.prototype.text=function(){var t=P.a.u(this.h),t="script"===t?"text":"textarea"===t?"value":"innerHTML";if(0==arguments.length)return this.h[t];var e=arguments[0];"innerHTML"===t?P.a.ca(this.h,e):this.h[t]=e},P.l.h.prototype.data=function(t){return 1===arguments.length?P.a.f.get(this.h,"templateSourceData_"+t):(P.a.f.set(this.h,"templateSourceData_"+t,arguments[1]),void 0)},P.l.O=function(t){this.h=t},P.l.O.prototype=new P.l.h,P.l.O.prototype.text=function(){if(0==arguments.length){var t=P.a.f.get(this.h,"__ko_anon_template__")||{};return t.Aa===u&&t.ia&&(t.Aa=t.ia.innerHTML),t.Aa}P.a.f.set(this.h,"__ko_anon_template__",{Aa:arguments[0]})},P.l.h.prototype.nodes=function(){return 0==arguments.length?(P.a.f.get(this.h,"__ko_anon_template__")||{}).ia:(P.a.f.set(this.h,"__ko_anon_template__",{ia:arguments[0]}),void 0)},P.b("templateSources",P.l),P.b("templateSources.domElement",P.l.h),P.b("templateSources.anonymousTemplate",P.l.O);var Y;P.wa=function(e){e!=u&&!(e instanceof P.v)&&t(Error("templateEngine must inherit from ko.templateEngine")),Y=e},P.va=function(e,n,i,a,o){if(i=i||{},(i.templateEngine||Y)==u&&t(Error("Set a template engine before calling renderTemplate")),o=o||"replaceChildren",a){var s=g(a);return P.j(function(){var t=n&&n instanceof P.z?n:new P.z(P.a.d(n)),r="function"==typeof e?e(t.$data,t):e,t=f(a,o,r,t,i);"replaceNode"==o&&(a=t,s=g(a))},r,{Ka:function(){return!s||!P.a.X(s)},W:s&&"replaceNode"==o?s.parentNode:s})}return P.s.ra(function(t){P.va(e,n,i,t,"replaceNode")})},P.Mb=function(t,e,n,i,a){function o(t,e){m(e,l),n.afterRender&&n.afterRender(e,t)}function s(e,i){l=a.createChildContext(P.a.d(e),n.as),l.$index=i;var o="function"==typeof t?t(e,l):t;return f(r,"ignoreTargetNode",o,l,n)}var l;return P.j(function(){var t=P.a.d(e)||[];t.length===void 0&&(t=[t]),t=P.a.fa(t,function(t){return n.includeDestroyed||t===u||t===r||!P.a.d(t._destroy)}),P.r.K(P.a.$a,r,[i,t,s,n,o])},r,{W:i})},P.c.template={init:function(t,e){var n=P.a.d(e());return"string"==typeof n||n.name||1!=t.nodeType&&8!=t.nodeType||(n=1==t.nodeType?t.childNodes:P.e.childNodes(t),n=P.a.Hb(n),new P.l.O(t).nodes(n)),{controlsDescendantBindings:i}},update:function(t,e,n,a,o){e=P.a.d(e()),n={},a=i;var s,l=r;"string"!=typeof e&&(n=e,e=n.name,"if"in n&&(a=P.a.d(n["if"])),a&&"ifnot"in n&&(a=!P.a.d(n.ifnot)),s=P.a.d(n.data)),"foreach"in n?l=P.Mb(e||t,a&&n.foreach||[],n,t,o):a?(o="data"in n?o.createChildContext(s,n.as):o,l=P.va(e||t,o,n,t)):P.e.Y(t),o=l,(s=P.a.f.get(t,"__ko__templateComputedDomDataKey__"))&&"function"==typeof s.B&&s.B(),P.a.f.set(t,"__ko__templateComputedDomDataKey__",o&&o.pa()?o:u)}},P.g.Q.template=function(t){return t=P.g.aa(t),1==t.length&&t[0].unknown||P.g.Eb(t,"name")?r:"This template engine does not support anonymous templates nested within its templates"},P.e.I.template=i,P.b("setTemplateEngine",P.wa),P.b("renderTemplate",P.va),P.a.Ja=function(t,e,n){return t=t||[],e=e||[],t.length<=e.length?p(t,e,"added","deleted",n):p(e,t,"deleted","added",n)},P.b("utils.compareArrays",P.a.Ja),P.a.$a=function(t,e,n,r,a){function o(t,e){x=c[e],v!==e&&(k[t]=x),x.na(v++),h(x.M),g.push(x),b.push(x)}function s(t,e){if(t)for(var n=0,i=e.length;i>n;n++)e[n]&&P.a.o(e[n].M,function(i){t(i,n,e[n].U)})}e=e||[],r=r||{};var l=P.a.f.get(t,"setDomNodeChildrenFromArrayMapping_lastMappingResult")===u,c=P.a.f.get(t,"setDomNodeChildrenFromArrayMapping_lastMappingResult")||[],p=P.a.V(c,function(t){return t.U}),f=P.a.Ja(p,e),g=[],m=0,v=0,y=[],b=[];e=[];for(var x,T,w,k=[],p=[],A=0;T=f[A];A++)switch(w=T.moved,T.status){case"deleted":w===u&&(x=c[m],x.j&&x.j.B(),y.push.apply(y,h(x.M)),r.beforeRemove&&(e[A]=x,b.push(x))),m++;break;case"retained":o(A,m++);break;case"added":w!==u?o(A,w):(x={U:T.value,na:P.m(v++)},g.push(x),b.push(x),l||(p[A]=x))}s(r.beforeMove,k),P.a.o(y,r.beforeRemove?P.A:P.removeNode);for(var _,A=0,l=P.e.firstChild(t);x=b[A];A++){for(x.M||P.a.extend(x,d(t,n,x.U,a,x.na)),m=0;f=x.M[m];l=f.nextSibling,_=f,m++)f!==l&&P.e.Pa(t,f,_);!x.Ab&&a&&(a(x.U,x.M,x.na),x.Ab=i)}s(r.beforeRemove,e),s(r.afterMove,k),s(r.afterAdd,p),P.a.f.set(t,"setDomNodeChildrenFromArrayMapping_lastMappingResult",g)},P.b("utils.setDomNodeChildrenFromArrayMapping",P.a.$a),P.C=function(){this.allowTemplateRewriting=a},P.C.prototype=new P.v,P.C.prototype.renderTemplateSource=function(t){var e=9>P.a.Z||!t.nodes?r:t.nodes();return e?P.a.L(e.cloneNode(i).childNodes):(t=t.text(),P.a.ta(t))},P.C.oa=new P.C,P.wa(P.C.oa),P.b("nativeTemplateEngine",P.C),P.qa=function(){var e=this.Db=function(){if(c===void 0||!c.tmpl)return 0;try{if((""+c.tmpl.tag.tmpl.open).indexOf("__")>=0)return 2}catch(t){}return 1}();this.renderTemplateSource=function(n,i,a){a=a||{},2>e&&t(Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later."));var o=n.data("precompiled");return o||(o=n.text()||"",o=c.template(r,"{{ko_with $item.koBindingContext}}"+o+"{{/ko_with}}"),n.data("precompiled",o)),n=[i.$data],i=c.extend({koBindingContext:i},a.templateOptions),i=c.tmpl(o,n,i),i.appendTo(s.createElement("div")),c.fragments={},i},this.createJavaScriptEvaluatorBlock=function(t){return"{{ko_code ((function() { return "+t+" })()) }}"},this.addTemplate=function(t,e){s.write("<script type='text/html' id='"+t+"'>"+e+"</script>")},e>0&&(c.tmpl.tag.ko_code={open:"__.push($1 || '');"},c.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},P.qa.prototype=new P.v,n=new P.qa,n.Db>0&&P.wa(n),P.b("jqueryTmplTemplateEngine",P.qa)}var i=!0,r=null,a=!1,o=window,s=document,l=navigator,c=window.jQuery,u=void 0;"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?n(module.exports||exports):"function"==typeof define&&define.amd?define(["exports"],n):n(o.ko={})}();var CryptoJS=CryptoJS||function(t,e){var n={},i=n.lib={},r=function(){},a=i.Base={extend:function(t){r.prototype=this;var e=new r;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},o=i.WordArray=a.extend({init:function(t,n){t=this.words=t||[],this.sigBytes=n!=e?n:4*t.length},toString:function(t){return(t||l).stringify(this)},concat:function(t){var e=this.words,n=t.words,i=this.sigBytes;if(t=t.sigBytes,this.clamp(),i%4)for(var r=0;t>r;r++)e[i+r>>>2]|=(255&n[r>>>2]>>>24-8*(r%4))<<24-8*((i+r)%4);else if(n.length>65535)for(r=0;t>r;r+=4)e[i+r>>>2]=n[r>>>2];else e.push.apply(e,n);return this.sigBytes+=t,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-8*(n%4),e.length=t.ceil(n/4)},clone:function(){var t=a.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n=[],i=0;e>i;i+=4)n.push(0|4294967296*t.random());return new o.init(n,e)}}),s=n.enc={},l=s.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],i=0;t>i;i++){var r=255&e[i>>>2]>>>24-8*(i%4);n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,n=[],i=0;e>i;i+=2)n[i>>>3]|=parseInt(t.substr(i,2),16)<<24-4*(i%8);return new o.init(n,e/2)}},c=s.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],i=0;t>i;i++)n.push(String.fromCharCode(255&e[i>>>2]>>>24-8*(i%4)));return n.join("")},parse:function(t){for(var e=t.length,n=[],i=0;e>i;i++)n[i>>>2]|=(255&t.charCodeAt(i))<<24-8*(i%4);return new o.init(n,e)}},u=s.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},d=i.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=u.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,i=n.words,r=n.sigBytes,a=this.blockSize,s=r/(4*a),s=e?t.ceil(s):t.max((0|s)-this._minBufferSize,0);if(e=s*a,r=t.min(4*e,r),e){for(var l=0;e>l;l+=a)this._doProcessBlock(i,l);l=i.splice(0,e),n.sigBytes-=r}return new o.init(l,r)},clone:function(){var t=a.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});i.Hasher=d.extend({cfg:a.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new h.HMAC.init(t,n).finalize(e)}}});var h=n.algo={};return n}(Math);(function(){var t=CryptoJS,e=t.lib,n=e.WordArray,i=e.Hasher,r=[],e=t.algo.SHA1=i.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var n=this._hash.words,i=n[0],a=n[1],o=n[2],s=n[3],l=n[4],c=0;80>c;c++){if(16>c)r[c]=0|t[e+c];else{var u=r[c-3]^r[c-8]^r[c-14]^r[c-16];r[c]=u<<1|u>>>31}u=(i<<5|i>>>27)+l+r[c],u=20>c?u+((a&o|~a&s)+1518500249):40>c?u+((a^o^s)+1859775393):60>c?u+((a&o|a&s|o&s)-1894007588):u+((a^o^s)-899497514),l=s,s=o,o=a<<30|a>>>2,a=i,i=u}n[0]=0|n[0]+i,n[1]=0|n[1]+a,n[2]=0|n[2]+o,n[3]=0|n[3]+s,n[4]=0|n[4]+l},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;return e[i>>>5]|=128<<24-i%32,e[(i+64>>>9<<4)+14]=Math.floor(n/4294967296),e[(i+64>>>9<<4)+15]=n,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});t.SHA1=i._createHelper(e),t.HmacSHA1=i._createHmacHelper(e)})();var CryptoJS=CryptoJS||function(t,e){var n={},i=n.lib={},r=function(){},a=i.Base={extend:function(t){r.prototype=this;var e=new r;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},o=i.WordArray=a.extend({init:function(t,n){t=this.words=t||[],this.sigBytes=n!=e?n:4*t.length},toString:function(t){return(t||l).stringify(this)},concat:function(t){var e=this.words,n=t.words,i=this.sigBytes;if(t=t.sigBytes,this.clamp(),i%4)for(var r=0;t>r;r++)e[i+r>>>2]|=(255&n[r>>>2]>>>24-8*(r%4))<<24-8*((i+r)%4);else if(n.length>65535)for(r=0;t>r;r+=4)e[i+r>>>2]=n[r>>>2];else e.push.apply(e,n);return this.sigBytes+=t,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-8*(n%4),e.length=t.ceil(n/4)},clone:function(){var t=a.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n=[],i=0;e>i;i+=4)n.push(0|4294967296*t.random());return new o.init(n,e)}}),s=n.enc={},l=s.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],i=0;t>i;i++){var r=255&e[i>>>2]>>>24-8*(i%4);n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,n=[],i=0;e>i;i+=2)n[i>>>3]|=parseInt(t.substr(i,2),16)<<24-4*(i%8);return new o.init(n,e/2)}},c=s.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],i=0;t>i;i++)n.push(String.fromCharCode(255&e[i>>>2]>>>24-8*(i%4)));return n.join("")},parse:function(t){for(var e=t.length,n=[],i=0;e>i;i++)n[i>>>2]|=(255&t.charCodeAt(i))<<24-8*(i%4);return new o.init(n,e)}},u=s.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},d=i.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=u.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,i=n.words,r=n.sigBytes,a=this.blockSize,s=r/(4*a),s=e?t.ceil(s):t.max((0|s)-this._minBufferSize,0);if(e=s*a,r=t.min(4*e,r),e){for(var l=0;e>l;l+=a)this._doProcessBlock(i,l);l=i.splice(0,e),n.sigBytes-=r}return new o.init(l,r)},clone:function(){var t=a.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});i.Hasher=d.extend({cfg:a.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new h.HMAC.init(t,n).finalize(e)}}});var h=n.algo={};return n}(Math);(function(t){for(var e=CryptoJS,n=e.lib,i=n.WordArray,r=n.Hasher,n=e.algo,a=[],o=[],s=function(t){return 0|4294967296*(t-(0|t))},l=2,c=0;64>c;){var u;t:{u=l;for(var d=t.sqrt(u),h=2;d>=h;h++)if(!(u%h)){u=!1;break t}u=!0}u&&(8>c&&(a[c]=s(t.pow(l,.5))),o[c]=s(t.pow(l,1/3)),c++),l++}var p=[],n=n.SHA256=r.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(t,e){for(var n=this._hash.words,i=n[0],r=n[1],a=n[2],s=n[3],l=n[4],c=n[5],u=n[6],d=n[7],h=0;64>h;h++){if(16>h)p[h]=0|t[e+h];else{var f=p[h-15],g=p[h-2];p[h]=((f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3)+p[h-7]+((g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10)+p[h-16]}f=d+((l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25))+(l&c^~l&u)+o[h]+p[h],g=((i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22))+(i&r^i&a^r&a),d=u,u=c,c=l,l=0|s+f,s=a,a=r,r=i,i=0|f+g}n[0]=0|n[0]+i,n[1]=0|n[1]+r,n[2]=0|n[2]+a,n[3]=0|n[3]+s,n[4]=0|n[4]+l,n[5]=0|n[5]+c,n[6]=0|n[6]+u,n[7]=0|n[7]+d},_doFinalize:function(){var e=this._data,n=e.words,i=8*this._nDataBytes,r=8*e.sigBytes;return n[r>>>5]|=128<<24-r%32,n[(r+64>>>9<<4)+14]=t.floor(i/4294967296),n[(r+64>>>9<<4)+15]=i,e.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var t=r.clone.call(this);return t._hash=this._hash.clone(),t}});e.SHA256=r._createHelper(n),e.HmacSHA256=r._createHmacHelper(n)})(Math),function(){var t=CryptoJS,e=t.lib.WordArray,n=t.algo,i=n.SHA256,n=n.SHA224=i.extend({_doReset:function(){this._hash=new e.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var t=i._doFinalize.call(this);return t.sigBytes-=4,t}});t.SHA224=i._createHelper(n),t.HmacSHA224=i._createHmacHelper(n)}();var CryptoJS=CryptoJS||function(t,e){var n={},i=n.lib={},r=function(){},a=i.Base={extend:function(t){r.prototype=this;var e=new r;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},o=i.WordArray=a.extend({init:function(t,n){t=this.words=t||[],this.sigBytes=n!=e?n:4*t.length},toString:function(t){return(t||l).stringify(this)},concat:function(t){var e=this.words,n=t.words,i=this.sigBytes;if(t=t.sigBytes,this.clamp(),i%4)for(var r=0;t>r;r++)e[i+r>>>2]|=(255&n[r>>>2]>>>24-8*(r%4))<<24-8*((i+r)%4);else if(n.length>65535)for(r=0;t>r;r+=4)e[i+r>>>2]=n[r>>>2];else e.push.apply(e,n);return this.sigBytes+=t,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-8*(n%4),e.length=t.ceil(n/4)},clone:function(){var t=a.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n=[],i=0;e>i;i+=4)n.push(0|4294967296*t.random());return new o.init(n,e)}}),s=n.enc={},l=s.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],i=0;t>i;i++){var r=255&e[i>>>2]>>>24-8*(i%4);n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,n=[],i=0;e>i;i+=2)n[i>>>3]|=parseInt(t.substr(i,2),16)<<24-4*(i%8);return new o.init(n,e/2)}},c=s.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],i=0;t>i;i++)n.push(String.fromCharCode(255&e[i>>>2]>>>24-8*(i%4)));return n.join("")},parse:function(t){for(var e=t.length,n=[],i=0;e>i;i++)n[i>>>2]|=(255&t.charCodeAt(i))<<24-8*(i%4);return new o.init(n,e)}},u=s.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},d=i.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=u.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,i=n.words,r=n.sigBytes,a=this.blockSize,s=r/(4*a),s=e?t.ceil(s):t.max((0|s)-this._minBufferSize,0);if(e=s*a,r=t.min(4*e,r),e){for(var l=0;e>l;l+=a)this._doProcessBlock(i,l);l=i.splice(0,e),n.sigBytes-=r}return new o.init(l,r)},clone:function(){var t=a.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});i.Hasher=d.extend({cfg:a.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new h.HMAC.init(t,n).finalize(e)}}});var h=n.algo={};return n}(Math);(function(t){for(var e=CryptoJS,n=e.lib,i=n.WordArray,r=n.Hasher,n=e.algo,a=[],o=[],s=function(t){return 0|4294967296*(t-(0|t))},l=2,c=0;64>c;){var u;t:{u=l;for(var d=t.sqrt(u),h=2;d>=h;h++)if(!(u%h)){u=!1;break t}u=!0}u&&(8>c&&(a[c]=s(t.pow(l,.5))),o[c]=s(t.pow(l,1/3)),c++),l++}var p=[],n=n.SHA256=r.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(t,e){for(var n=this._hash.words,i=n[0],r=n[1],a=n[2],s=n[3],l=n[4],c=n[5],u=n[6],d=n[7],h=0;64>h;h++){if(16>h)p[h]=0|t[e+h];else{var f=p[h-15],g=p[h-2];p[h]=((f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3)+p[h-7]+((g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10)+p[h-16]}f=d+((l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25))+(l&c^~l&u)+o[h]+p[h],g=((i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22))+(i&r^i&a^r&a),d=u,u=c,c=l,l=0|s+f,s=a,a=r,r=i,i=0|f+g}n[0]=0|n[0]+i,n[1]=0|n[1]+r,n[2]=0|n[2]+a,n[3]=0|n[3]+s,n[4]=0|n[4]+l,n[5]=0|n[5]+c,n[6]=0|n[6]+u,n[7]=0|n[7]+d},_doFinalize:function(){var e=this._data,n=e.words,i=8*this._nDataBytes,r=8*e.sigBytes;return n[r>>>5]|=128<<24-r%32,n[(r+64>>>9<<4)+14]=t.floor(i/4294967296),n[(r+64>>>9<<4)+15]=i,e.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var t=r.clone.call(this);return t._hash=this._hash.clone(),t}});e.SHA256=r._createHelper(n),e.HmacSHA256=r._createHmacHelper(n)})(Math);var CryptoJS=CryptoJS||function(t,e){var n={},i=n.lib={},r=function(){},a=i.Base={extend:function(t){r.prototype=this;var e=new r;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},o=i.WordArray=a.extend({init:function(t,n){t=this.words=t||[],this.sigBytes=n!=e?n:4*t.length},toString:function(t){return(t||l).stringify(this)},concat:function(t){var e=this.words,n=t.words,i=this.sigBytes;if(t=t.sigBytes,this.clamp(),i%4)for(var r=0;t>r;r++)e[i+r>>>2]|=(255&n[r>>>2]>>>24-8*(r%4))<<24-8*((i+r)%4);else if(n.length>65535)for(r=0;t>r;r+=4)e[i+r>>>2]=n[r>>>2];else e.push.apply(e,n);return this.sigBytes+=t,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-8*(n%4),e.length=t.ceil(n/4)},clone:function(){var t=a.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n=[],i=0;e>i;i+=4)n.push(0|4294967296*t.random());return new o.init(n,e)}}),s=n.enc={},l=s.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],i=0;t>i;i++){var r=255&e[i>>>2]>>>24-8*(i%4);n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,n=[],i=0;e>i;i+=2)n[i>>>3]|=parseInt(t.substr(i,2),16)<<24-4*(i%8);return new o.init(n,e/2)}},c=s.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],i=0;t>i;i++)n.push(String.fromCharCode(255&e[i>>>2]>>>24-8*(i%4)));return n.join("")},parse:function(t){for(var e=t.length,n=[],i=0;e>i;i++)n[i>>>2]|=(255&t.charCodeAt(i))<<24-8*(i%4);return new o.init(n,e)}},u=s.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},d=i.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=u.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,i=n.words,r=n.sigBytes,a=this.blockSize,s=r/(4*a),s=e?t.ceil(s):t.max((0|s)-this._minBufferSize,0);if(e=s*a,r=t.min(4*e,r),e){for(var l=0;e>l;l+=a)this._doProcessBlock(i,l);l=i.splice(0,e),n.sigBytes-=r}return new o.init(l,r)},clone:function(){var t=a.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});i.Hasher=d.extend({cfg:a.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new h.HMAC.init(t,n).finalize(e)}}});var h=n.algo={};return n}(Math);(function(t){var e=CryptoJS,n=e.lib,i=n.Base,r=n.WordArray,e=e.x64={};e.Word=i.extend({init:function(t,e){this.high=t,this.low=e}}),e.WordArray=i.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:8*e.length},toX32:function(){for(var t=this.words,e=t.length,n=[],i=0;e>i;i++){var a=t[i];n.push(a.high),n.push(a.low)}return r.create(n,this.sigBytes)},clone:function(){for(var t=i.clone.call(this),e=t.words=this.words.slice(0),n=e.length,r=0;n>r;r++)e[r]=e[r].clone();return t}})})(),function(){function t(){return r.create.apply(r,arguments)}for(var e=CryptoJS,n=e.lib.Hasher,i=e.x64,r=i.Word,a=i.WordArray,i=e.algo,o=[t(1116352408,3609767458),t(1899447441,602891725),t(3049323471,3964484399),t(3921009573,2173295548),t(961987163,4081628472),t(1508970993,3053834265),t(2453635748,2937671579),t(2870763221,3664609560),t(3624381080,2734883394),t(310598401,1164996542),t(607225278,1323610764),t(1426881987,3590304994),t(1925078388,4068182383),t(2162078206,991336113),t(2614888103,633803317),t(3248222580,3479774868),t(3835390401,2666613458),t(4022224774,944711139),t(264347078,2341262773),t(604807628,2007800933),t(770255983,1495990901),t(1249150122,1856431235),t(1555081692,3175218132),t(1996064986,2198950837),t(2554220882,3999719339),t(2821834349,766784016),t(2952996808,2566594879),t(3210313671,3203337956),t(3336571891,1034457026),t(3584528711,2466948901),t(113926993,3758326383),t(338241895,168717936),t(666307205,1188179964),t(773529912,1546045734),t(1294757372,1522805485),t(1396182291,2643833823),t(1695183700,2343527390),t(1986661051,1014477480),t(2177026350,1206759142),t(2456956037,344077627),t(2730485921,1290863460),t(2820302411,3158454273),t(3259730800,3505952657),t(3345764771,106217008),t(3516065817,3606008344),t(3600352804,1432725776),t(4094571909,1467031594),t(275423344,851169720),t(430227734,3100823752),t(506948616,1363258195),t(659060556,3750685593),t(883997877,3785050280),t(958139571,3318307427),t(1322822218,3812723403),t(1537002063,2003034995),t(1747873779,3602036899),t(1955562222,1575990012),t(2024104815,1125592928),t(2227730452,2716904306),t(2361852424,442776044),t(2428436474,593698344),t(2756734187,3733110249),t(3204031479,2999351573),t(3329325298,3815920427),t(3391569614,3928383900),t(3515267271,566280711),t(3940187606,3454069534),t(4118630271,4000239992),t(116418474,1914138554),t(174292421,2731055270),t(289380356,3203993006),t(460393269,320620315),t(685471733,587496836),t(852142971,1086792851),t(1017036298,365543100),t(1126000580,2618297676),t(1288033470,3409855158),t(1501505948,4234509866),t(1607167915,987167468),t(1816402316,1246189591)],s=[],l=0;80>l;l++)s[l]=t();i=i.SHA512=n.extend({_doReset:function(){this._hash=new a.init([new r.init(1779033703,4089235720),new r.init(3144134277,2227873595),new r.init(1013904242,4271175723),new r.init(2773480762,1595750129),new r.init(1359893119,2917565137),new r.init(2600822924,725511199),new r.init(528734635,4215389547),new r.init(1541459225,327033209)])},_doProcessBlock:function(t,e){for(var n=this._hash.words,i=n[0],r=n[1],a=n[2],l=n[3],c=n[4],u=n[5],d=n[6],n=n[7],h=i.high,p=i.low,f=r.high,g=r.low,m=a.high,v=a.low,y=l.high,b=l.low,x=c.high,T=c.low,w=u.high,k=u.low,A=d.high,_=d.low,C=n.high,E=n.low,S=h,M=p,I=f,D=g,P=m,$=v,N=y,G=b,O=x,L=T,F=w,B=k,R=A,H=_,U=C,z=E,j=0;80>j;j++){var W=s[j];if(16>j)var q=W.high=0|t[e+2*j],V=W.low=0|t[e+2*j+1];else{var q=s[j-15],V=q.high,Y=q.low,q=(V>>>1|Y<<31)^(V>>>8|Y<<24)^V>>>7,Y=(Y>>>1|V<<31)^(Y>>>8|V<<24)^(Y>>>7|V<<25),X=s[j-2],V=X.high,K=X.low,X=(V>>>19|K<<13)^(V<<3|K>>>29)^V>>>6,K=(K>>>19|V<<13)^(K<<3|V>>>29)^(K>>>6|V<<26),V=s[j-7],Z=V.high,Q=s[j-16],J=Q.high,Q=Q.low,V=Y+V.low,q=q+Z+(Y>>>0>V>>>0?1:0),V=V+K,q=q+X+(K>>>0>V>>>0?1:0),V=V+Q,q=q+J+(Q>>>0>V>>>0?1:0);W.high=q,W.low=V}var Z=O&F^~O&R,Q=L&B^~L&H,W=S&I^S&P^I&P,te=M&D^M&$^D&$,Y=(S>>>28|M<<4)^(S<<30|M>>>2)^(S<<25|M>>>7),X=(M>>>28|S<<4)^(M<<30|S>>>2)^(M<<25|S>>>7),K=o[j],ee=K.high,ne=K.low,K=z+((L>>>14|O<<18)^(L>>>18|O<<14)^(L<<23|O>>>9)),J=U+((O>>>14|L<<18)^(O>>>18|L<<14)^(O<<23|L>>>9))+(z>>>0>K>>>0?1:0),K=K+Q,J=J+Z+(Q>>>0>K>>>0?1:0),K=K+ne,J=J+ee+(ne>>>0>K>>>0?1:0),K=K+V,J=J+q+(V>>>0>K>>>0?1:0),V=X+te,W=Y+W+(X>>>0>V>>>0?1:0),U=R,z=H,R=F,H=B,F=O,B=L,L=0|G+K,O=0|N+J+(G>>>0>L>>>0?1:0),N=P,G=$,P=I,$=D,I=S,D=M,M=0|K+V,S=0|J+W+(K>>>0>M>>>0?1:0)}p=i.low=p+M,i.high=h+S+(M>>>0>p>>>0?1:0),g=r.low=g+D,r.high=f+I+(D>>>0>g>>>0?1:0),v=a.low=v+$,a.high=m+P+($>>>0>v>>>0?1:0),b=l.low=b+G,l.high=y+N+(G>>>0>b>>>0?1:0),T=c.low=T+L,c.high=x+O+(L>>>0>T>>>0?1:0),k=u.low=k+B,u.high=w+F+(B>>>0>k>>>0?1:0),_=d.low=_+H,d.high=A+R+(H>>>0>_>>>0?1:0),E=n.low=E+z,n.high=C+U+(z>>>0>E>>>0?1:0)},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;return e[i>>>5]|=128<<24-i%32,e[(i+128>>>10<<5)+30]=Math.floor(n/4294967296),e[(i+128>>>10<<5)+31]=n,t.sigBytes=4*e.length,this._process(),this._hash.toX32()},clone:function(){var t=n.clone.call(this);return t._hash=this._hash.clone(),t},blockSize:32}),e.SHA512=n._createHelper(i),e.HmacSHA512=n._createHmacHelper(i)}(),function(){var t=CryptoJS,e=t.x64,n=e.Word,i=e.WordArray,e=t.algo,r=e.SHA512,e=e.SHA384=r.extend({_doReset:function(){this._hash=new i.init([new n.init(3418070365,3238371032),new n.init(1654270250,914150663),new n.init(2438529370,812702999),new n.init(355462360,4144912697),new n.init(1731405415,4290775857),new n.init(2394180231,1750603025),new n.init(3675008525,1694076839),new n.init(1203062813,3204075428)])},_doFinalize:function(){var t=r._doFinalize.call(this);return t.sigBytes-=16,t}});t.SHA384=r._createHelper(e),t.HmacSHA384=r._createHmacHelper(e)}();var CryptoJS=CryptoJS||function(t,e){var n={},i=n.lib={},r=function(){},a=i.Base={extend:function(t){r.prototype=this;var e=new r;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},o=i.WordArray=a.extend({init:function(t,n){t=this.words=t||[],this.sigBytes=n!=e?n:4*t.length},toString:function(t){return(t||l).stringify(this)},concat:function(t){var e=this.words,n=t.words,i=this.sigBytes;if(t=t.sigBytes,this.clamp(),i%4)for(var r=0;t>r;r++)e[i+r>>>2]|=(255&n[r>>>2]>>>24-8*(r%4))<<24-8*((i+r)%4);else if(n.length>65535)for(r=0;t>r;r+=4)e[i+r>>>2]=n[r>>>2];else e.push.apply(e,n);return this.sigBytes+=t,this
},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-8*(n%4),e.length=t.ceil(n/4)},clone:function(){var t=a.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n=[],i=0;e>i;i+=4)n.push(0|4294967296*t.random());return new o.init(n,e)}}),s=n.enc={},l=s.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],i=0;t>i;i++){var r=255&e[i>>>2]>>>24-8*(i%4);n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,n=[],i=0;e>i;i+=2)n[i>>>3]|=parseInt(t.substr(i,2),16)<<24-4*(i%8);return new o.init(n,e/2)}},c=s.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],i=0;t>i;i++)n.push(String.fromCharCode(255&e[i>>>2]>>>24-8*(i%4)));return n.join("")},parse:function(t){for(var e=t.length,n=[],i=0;e>i;i++)n[i>>>2]|=(255&t.charCodeAt(i))<<24-8*(i%4);return new o.init(n,e)}},u=s.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},d=i.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=u.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,i=n.words,r=n.sigBytes,a=this.blockSize,s=r/(4*a),s=e?t.ceil(s):t.max((0|s)-this._minBufferSize,0);if(e=s*a,r=t.min(4*e,r),e){for(var l=0;e>l;l+=a)this._doProcessBlock(i,l);l=i.splice(0,e),n.sigBytes-=r}return new o.init(l,r)},clone:function(){var t=a.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});i.Hasher=d.extend({cfg:a.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new h.HMAC.init(t,n).finalize(e)}}});var h=n.algo={};return n}(Math);(function(t){var e=CryptoJS,n=e.lib,i=n.Base,r=n.WordArray,e=e.x64={};e.Word=i.extend({init:function(t,e){this.high=t,this.low=e}}),e.WordArray=i.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:8*e.length},toX32:function(){for(var t=this.words,e=t.length,n=[],i=0;e>i;i++){var a=t[i];n.push(a.high),n.push(a.low)}return r.create(n,this.sigBytes)},clone:function(){for(var t=i.clone.call(this),e=t.words=this.words.slice(0),n=e.length,r=0;n>r;r++)e[r]=e[r].clone();return t}})})(),function(){function t(){return r.create.apply(r,arguments)}for(var e=CryptoJS,n=e.lib.Hasher,i=e.x64,r=i.Word,a=i.WordArray,i=e.algo,o=[t(1116352408,3609767458),t(1899447441,602891725),t(3049323471,3964484399),t(3921009573,2173295548),t(961987163,4081628472),t(1508970993,3053834265),t(2453635748,2937671579),t(2870763221,3664609560),t(3624381080,2734883394),t(310598401,1164996542),t(607225278,1323610764),t(1426881987,3590304994),t(1925078388,4068182383),t(2162078206,991336113),t(2614888103,633803317),t(3248222580,3479774868),t(3835390401,2666613458),t(4022224774,944711139),t(264347078,2341262773),t(604807628,2007800933),t(770255983,1495990901),t(1249150122,1856431235),t(1555081692,3175218132),t(1996064986,2198950837),t(2554220882,3999719339),t(2821834349,766784016),t(2952996808,2566594879),t(3210313671,3203337956),t(3336571891,1034457026),t(3584528711,2466948901),t(113926993,3758326383),t(338241895,168717936),t(666307205,1188179964),t(773529912,1546045734),t(1294757372,1522805485),t(1396182291,2643833823),t(1695183700,2343527390),t(1986661051,1014477480),t(2177026350,1206759142),t(2456956037,344077627),t(2730485921,1290863460),t(2820302411,3158454273),t(3259730800,3505952657),t(3345764771,106217008),t(3516065817,3606008344),t(3600352804,1432725776),t(4094571909,1467031594),t(275423344,851169720),t(430227734,3100823752),t(506948616,1363258195),t(659060556,3750685593),t(883997877,3785050280),t(958139571,3318307427),t(1322822218,3812723403),t(1537002063,2003034995),t(1747873779,3602036899),t(1955562222,1575990012),t(2024104815,1125592928),t(2227730452,2716904306),t(2361852424,442776044),t(2428436474,593698344),t(2756734187,3733110249),t(3204031479,2999351573),t(3329325298,3815920427),t(3391569614,3928383900),t(3515267271,566280711),t(3940187606,3454069534),t(4118630271,4000239992),t(116418474,1914138554),t(174292421,2731055270),t(289380356,3203993006),t(460393269,320620315),t(685471733,587496836),t(852142971,1086792851),t(1017036298,365543100),t(1126000580,2618297676),t(1288033470,3409855158),t(1501505948,4234509866),t(1607167915,987167468),t(1816402316,1246189591)],s=[],l=0;80>l;l++)s[l]=t();i=i.SHA512=n.extend({_doReset:function(){this._hash=new a.init([new r.init(1779033703,4089235720),new r.init(3144134277,2227873595),new r.init(1013904242,4271175723),new r.init(2773480762,1595750129),new r.init(1359893119,2917565137),new r.init(2600822924,725511199),new r.init(528734635,4215389547),new r.init(1541459225,327033209)])},_doProcessBlock:function(t,e){for(var n=this._hash.words,i=n[0],r=n[1],a=n[2],l=n[3],c=n[4],u=n[5],d=n[6],n=n[7],h=i.high,p=i.low,f=r.high,g=r.low,m=a.high,v=a.low,y=l.high,b=l.low,x=c.high,T=c.low,w=u.high,k=u.low,A=d.high,_=d.low,C=n.high,E=n.low,S=h,M=p,I=f,D=g,P=m,$=v,N=y,G=b,O=x,L=T,F=w,B=k,R=A,H=_,U=C,z=E,j=0;80>j;j++){var W=s[j];if(16>j)var q=W.high=0|t[e+2*j],V=W.low=0|t[e+2*j+1];else{var q=s[j-15],V=q.high,Y=q.low,q=(V>>>1|Y<<31)^(V>>>8|Y<<24)^V>>>7,Y=(Y>>>1|V<<31)^(Y>>>8|V<<24)^(Y>>>7|V<<25),X=s[j-2],V=X.high,K=X.low,X=(V>>>19|K<<13)^(V<<3|K>>>29)^V>>>6,K=(K>>>19|V<<13)^(K<<3|V>>>29)^(K>>>6|V<<26),V=s[j-7],Z=V.high,Q=s[j-16],J=Q.high,Q=Q.low,V=Y+V.low,q=q+Z+(Y>>>0>V>>>0?1:0),V=V+K,q=q+X+(K>>>0>V>>>0?1:0),V=V+Q,q=q+J+(Q>>>0>V>>>0?1:0);W.high=q,W.low=V}var Z=O&F^~O&R,Q=L&B^~L&H,W=S&I^S&P^I&P,te=M&D^M&$^D&$,Y=(S>>>28|M<<4)^(S<<30|M>>>2)^(S<<25|M>>>7),X=(M>>>28|S<<4)^(M<<30|S>>>2)^(M<<25|S>>>7),K=o[j],ee=K.high,ne=K.low,K=z+((L>>>14|O<<18)^(L>>>18|O<<14)^(L<<23|O>>>9)),J=U+((O>>>14|L<<18)^(O>>>18|L<<14)^(O<<23|L>>>9))+(z>>>0>K>>>0?1:0),K=K+Q,J=J+Z+(Q>>>0>K>>>0?1:0),K=K+ne,J=J+ee+(ne>>>0>K>>>0?1:0),K=K+V,J=J+q+(V>>>0>K>>>0?1:0),V=X+te,W=Y+W+(X>>>0>V>>>0?1:0),U=R,z=H,R=F,H=B,F=O,B=L,L=0|G+K,O=0|N+J+(G>>>0>L>>>0?1:0),N=P,G=$,P=I,$=D,I=S,D=M,M=0|K+V,S=0|J+W+(K>>>0>M>>>0?1:0)}p=i.low=p+M,i.high=h+S+(M>>>0>p>>>0?1:0),g=r.low=g+D,r.high=f+I+(D>>>0>g>>>0?1:0),v=a.low=v+$,a.high=m+P+($>>>0>v>>>0?1:0),b=l.low=b+G,l.high=y+N+(G>>>0>b>>>0?1:0),T=c.low=T+L,c.high=x+O+(L>>>0>T>>>0?1:0),k=u.low=k+B,u.high=w+F+(B>>>0>k>>>0?1:0),_=d.low=_+H,d.high=A+R+(H>>>0>_>>>0?1:0),E=n.low=E+z,n.high=C+U+(z>>>0>E>>>0?1:0)},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;return e[i>>>5]|=128<<24-i%32,e[(i+128>>>10<<5)+30]=Math.floor(n/4294967296),e[(i+128>>>10<<5)+31]=n,t.sigBytes=4*e.length,this._process(),this._hash.toX32()},clone:function(){var t=n.clone.call(this);return t._hash=this._hash.clone(),t},blockSize:32}),e.SHA512=n._createHelper(i),e.HmacSHA512=n._createHmacHelper(i)}(),function(t){var e=0;t.getScrollbarWidth=function(){if(!e)if(t.browser.msie){var n=t('<textarea cols="10" rows="2"></textarea>').css({position:"absolute",top:-1e3,left:-1e3}).appendTo("body"),i=t('<textarea cols="10" rows="2" style="overflow: hidden;"></textarea>').css({position:"absolute",top:-1e3,left:-1e3}).appendTo("body");e=n.width()-i.width(),n.add(i).remove()}else{var r=t("<div />").css({width:100,height:100,overflow:"auto",position:"absolute",top:-1e3,left:-1e3}).prependTo("body").append("<div />").find("div").css({width:"100%",height:200});e=100-r.width(),r.parent().remove()}return e}}(jQuery),function(t,e){"$:nomunge";var n,i=t.jQuery||t.Cowboy||(t.Cowboy={});i.throttle=n=function(t,n,r,a){function o(){function i(){l=+new Date,r.apply(c,d)}function o(){s=e}var c=this,u=+new Date-l,d=arguments;a&&!s&&i(),s&&clearTimeout(s),a===e&&u>t?i():n!==!0&&(s=setTimeout(a?o:i,a===e?t-u:t))}var s,l=0;return"boolean"!=typeof n&&(a=r,r=n,n=e),i.guid&&(o.guid=r.guid=r.guid||i.guid++),o},i.debounce=function(t,i,r){return r===e?n(t,i,!1):n(t,r,i!==!1)}}(this),function(t){function e(t){for(var e,n=["transform","WebkitTransform","msTransform","MozTransform","OTransform"];e=n.shift();)if(t&&t.style[e]!==void 0)return e;return"transform"}var n=null,i=t.fn.css;t.fn.css=function(r,a){if(null===n&&(n=t.cssProps!==void 0?t.cssProps:t.props!==void 0?t.props:{}),n.transform===void 0&&("transform"==r||"object"==typeof r&&r.transform!==void 0)&&(n.transform=e(this.get(0))),"transform"!=n.transform)if("transform"==r){if(r=n.transform,a===void 0&&jQuery.style)return jQuery.style(this.get(0),r)}else"object"==typeof r&&r.transform!==void 0&&(r[n.transform]=r.transform,delete r.transform);return i.apply(this,arguments)}}(jQuery),function(t){var e="deg";t.fn.rotate=function(n){var i=t(this).css("transform")||"none";if(n===void 0){if(i){var r=i.match(/rotate\(([^)]+)\)/);if(r&&r[1])return r[1]}return 0}var r=(""+n).match(/^(-?\d+(\.\d+)?)(.+)?$/);return r&&(r[3]&&(e=r[3]),t(this).css("transform",i.replace(/none|rotate\([^)]*\)/,"")+"rotate("+r[1]+e+")")),this},t.fn.scale=function(e){var n=t(this).css("transform");if(e===void 0){if(n){var i=n.match(/scale\(([^)]+)\)/);if(i&&i[1])return i[1]}return 1}return t(this).css("transform",n.replace(/none|scale\([^)]*\)/,"")+"scale("+e+")"),this};var n=t.fx.prototype.cur;t.fx.prototype.cur=function(){return"rotate"==this.prop?parseFloat(t(this.elem).rotate()):"scale"==this.prop?parseFloat(t(this.elem).scale()):n.apply(this,arguments)},t.fx.step.rotate=function(n){t(n.elem).rotate(n.now+e)},t.fx.step.scale=function(e){t(e.elem).scale(e.now)};var i=t.fn.animate;t.fn.animate=function(t){if(t.rotate!==void 0){var n=(""+t.rotate).match(/^(([+-]=)?(-?\d+(\.\d+)?))(.+)?$/);n&&n[5]&&(e=n[5]),t.rotate=n[1]}return i.apply(this,arguments)}}(jQuery),window.jQuery&&function(t){t.extend({xml2json:function(e,n){function i(e,o){if(!e)return null;var s="",l=null,c=null;e.nodeType,r(e.localName||e.nodeName),e.text||e.nodeValue||"",e.childNodes&&e.childNodes.length>0&&t.each(e.childNodes,function(t,e){var n=e.nodeType,o=r(e.localName||e.nodeName),c=e.text||e.nodeValue||"";if(8!=n)if(3!=n&&4!=n&&o)l=l||{},l[o]?(l[o].length||(l[o]=a(l[o])),l[o]=a(l[o]),l[o][l[o].length]=i(e,!0),l[o].length=l[o].length):l[o]=i(e);else{if(c.match(/^\s+$/))return;s+=c.replace(/^\s+/,"").replace(/\s+$/,"")}}),e.attributes&&e.attributes.length>0&&(c={},l=l||{},t.each(e.attributes,function(t,e){var n=r(e.name),i=e.value;c[n]=i,l[n]?(l[cnn]=a(l[cnn]),l[n][l[n].length]=i,l[n].length=l[n].length):l[n]=i})),l&&(l=t.extend(""!=s?new String(s):{},l||{}),s=l.text?("object"==typeof l.text?l.text:[l.text||""]).concat([s]):s,s&&(l.text=s),s="");var u=l||s;return n&&(s&&(u={}),s=u.text||s||"",s&&(u.text=s),o||(u=a(u))),u}if(!e)return{};var r=function(t){return((t||"")+"").replace(/-/g,"_")},a=function(e){return t.isArray(e)||(e=[e]),e.length=e.length,e};if("string"==typeof e&&(e=t.text2xml(e)),e.nodeType){if(3==e.nodeType||4==e.nodeType)return e.nodeValue;var o=9==e.nodeType?e.documentElement:e,s=i(o,!0);return e=null,o=null,s}},text2xml:function(e){var n;try{var i=t.browser.msie?new ActiveXObject("Microsoft.XMLDOM"):new DOMParser;i.async=!1}catch(r){throw Error("XML Parser could not be instantiated")}try{n=t.browser.msie?i.loadXML(e)?i:!1:i.parseFromString(e,"text/xml")}catch(r){throw Error("Error parsing XML string")}return n}})}(jQuery),function(t,e){"use strict";function n(){if(!i.READY){i.event.determineEventTypes();for(var t in i.gestures)i.gestures.hasOwnProperty(t)&&i.detection.register(i.gestures[t]);i.event.onTouch(i.DOCUMENT,i.EVENT_MOVE,i.detection.detect),i.event.onTouch(i.DOCUMENT,i.EVENT_END,i.detection.detect),i.READY=!0}}var i=function(t,e){return new i.Instance(t,e||{})};i.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},i.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,i.HAS_TOUCHEVENTS="ontouchstart"in t,i.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i,i.NO_MOUSEEVENTS=i.HAS_TOUCHEVENTS&&navigator.userAgent.match(i.MOBILE_REGEX),i.EVENT_TYPES={},i.DIRECTION_DOWN="down",i.DIRECTION_LEFT="left",i.DIRECTION_UP="up",i.DIRECTION_RIGHT="right",i.POINTER_MOUSE="mouse",i.POINTER_TOUCH="touch",i.POINTER_PEN="pen",i.EVENT_START="start",i.EVENT_MOVE="move",i.EVENT_END="end",i.DOCUMENT=document,i.plugins={},i.READY=!1,i.Instance=function(t,e){var r=this;return n(),this.element=t,this.enabled=!0,this.options=i.utils.extend(i.utils.extend({},i.defaults),e||{}),this.options.stop_browser_behavior&&i.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),i.event.onTouch(t,i.EVENT_START,function(t){r.enabled&&i.detection.startDetect(r,t)}),this},i.Instance.prototype={on:function(t,e){for(var n=t.split(" "),i=0;n.length>i;i++)this.element.addEventListener(n[i],e,!1);return this},off:function(t,e){for(var n=t.split(" "),i=0;n.length>i;i++)this.element.removeEventListener(n[i],e,!1);return this},trigger:function(t,e){var n=i.DOCUMENT.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e;var r=this.element;return i.utils.hasParent(e.target,r)&&(r=e.target),r.dispatchEvent(n),this},enable:function(t){return this.enabled=t,this}};var r=null,a=!1,o=!1;i.event={bindDom:function(t,e,n){for(var i=e.split(" "),r=0;i.length>r;r++)t.addEventListener(i[r],n,!1)},onTouch:function(t,e,n){var s=this;this.bindDom(t,i.EVENT_TYPES[e],function(l){var c=l.type.toLowerCase();if(!c.match(/mouse/)||!o){(c.match(/touch/)||c.match(/pointerdown/)||c.match(/mouse/)&&1===l.which)&&(a=!0),c.match(/touch|pointer/)&&(o=!0);var u=0;a&&(i.HAS_POINTEREVENTS&&e!=i.EVENT_END?u=i.PointerEvent.updatePointer(e,l):c.match(/touch/)?u=l.touches.length:o||(u=c.match(/up/)?0:1),u>0&&e==i.EVENT_END?e=i.EVENT_MOVE:u||(e=i.EVENT_END),u||null===r?r=l:l=r,n.call(i.detection,s.collectEventData(t,e,l)),i.HAS_POINTEREVENTS&&e==i.EVENT_END&&(u=i.PointerEvent.updatePointer(e,l))),u||(r=null,a=!1,o=!1,i.PointerEvent.reset())}})},determineEventTypes:function(){var t;t=i.HAS_POINTEREVENTS?i.PointerEvent.getEvents():i.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],i.EVENT_TYPES[i.EVENT_START]=t[0],i.EVENT_TYPES[i.EVENT_MOVE]=t[1],i.EVENT_TYPES[i.EVENT_END]=t[2]},getTouchList:function(t){return i.HAS_POINTEREVENTS?i.PointerEvent.getTouchList():t.touches?t.touches:[{identifier:1,pageX:t.pageX,pageY:t.pageY,target:t.target}]},collectEventData:function(t,e,n){var r=this.getTouchList(n,e),a=i.POINTER_TOUCH;return(n.type.match(/mouse/)||i.PointerEvent.matchType(i.POINTER_MOUSE,n))&&(a=i.POINTER_MOUSE),{center:i.utils.getCenter(r),timeStamp:(new Date).getTime(),target:n.target,touches:r,eventType:e,pointerType:a,srcEvent:n,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return i.detection.stopDetect()}}}},i.PointerEvent={pointers:{},getTouchList:function(){var t=this,e=[];return Object.keys(t.pointers).sort().forEach(function(n){e.push(t.pointers[n])}),e},updatePointer:function(t,e){return t==i.EVENT_END?this.pointers={}:(e.identifier=e.pointerId,this.pointers[e.pointerId]=e),Object.keys(this.pointers).length},matchType:function(t,e){if(!e.pointerType)return!1;var n={};return n[i.POINTER_MOUSE]=e.pointerType==e.MSPOINTER_TYPE_MOUSE||e.pointerType==i.POINTER_MOUSE,n[i.POINTER_TOUCH]=e.pointerType==e.MSPOINTER_TYPE_TOUCH||e.pointerType==i.POINTER_TOUCH,n[i.POINTER_PEN]=e.pointerType==e.MSPOINTER_TYPE_PEN||e.pointerType==i.POINTER_PEN,n[t]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},i.utils={extend:function(t,n,i){for(var r in n)t[r]!==e&&i||(t[r]=n[r]);return t},hasParent:function(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1},getCenter:function(t){for(var e=[],n=[],i=0,r=t.length;r>i;i++)e.push(t[i].pageX),n.push(t[i].pageY);return{pageX:(Math.min.apply(Math,e)+Math.max.apply(Math,e))/2,pageY:(Math.min.apply(Math,n)+Math.max.apply(Math,n))/2}},getVelocity:function(t,e,n){return{x:Math.abs(e/t)||0,y:Math.abs(n/t)||0}},getAngle:function(t,e){var n=e.pageY-t.pageY,i=e.pageX-t.pageX;return 180*Math.atan2(n,i)/Math.PI},getDirection:function(t,e){var n=Math.abs(t.pageX-e.pageX),r=Math.abs(t.pageY-e.pageY);return n>=r?t.pageX-e.pageX>0?i.DIRECTION_LEFT:i.DIRECTION_RIGHT:t.pageY-e.pageY>0?i.DIRECTION_UP:i.DIRECTION_DOWN},getDistance:function(t,e){var n=e.pageX-t.pageX,i=e.pageY-t.pageY;return Math.sqrt(n*n+i*i)},getScale:function(t,e){return t.length>=2&&e.length>=2?this.getDistance(e[0],e[1])/this.getDistance(t[0],t[1]):1},getRotation:function(t,e){return t.length>=2&&e.length>=2?this.getAngle(e[1],e[0])-this.getAngle(t[1],t[0]):0},isVertical:function(t){return t==i.DIRECTION_UP||t==i.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(t,e){var n,i=["webkit","khtml","moz","ms","o",""];if(e&&t.style){for(var r=0;i.length>r;r++)for(var a in e)e.hasOwnProperty(a)&&(n=a,i[r]&&(n=i[r]+n.substring(0,1).toUpperCase()+n.substring(1)),t.style[n]=e[a]);"none"==e.userSelect&&(t.onselectstart=function(){return!1})}}},i.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(t,e){this.current||(this.stopped=!1,this.current={inst:t,startEvent:i.utils.extend({},e),lastEvent:!1,name:""},this.detect(e))},detect:function(t){if(this.current&&!this.stopped){t=this.extendEventData(t);for(var e=this.current.inst.options,n=0,r=this.gestures.length;r>n;n++){var a=this.gestures[n];if(!this.stopped&&e[a.name]!==!1&&a.handler.call(a,t,this.current.inst)===!1){this.stopDetect();break}}return this.current&&(this.current.lastEvent=t),t.eventType==i.EVENT_END&&!t.touches.length-1&&this.stopDetect(),t}},stopDetect:function(){this.previous=i.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(t){var e=this.current.startEvent;if(e&&(t.touches.length!=e.touches.length||t.touches===e.touches)){e.touches=[];for(var n=0,r=t.touches.length;r>n;n++)e.touches.push(i.utils.extend({},t.touches[n]))}var a=t.timeStamp-e.timeStamp,o=t.center.pageX-e.center.pageX,s=t.center.pageY-e.center.pageY,l=i.utils.getVelocity(a,o,s);return i.utils.extend(t,{deltaTime:a,deltaX:o,deltaY:s,velocityX:l.x,velocityY:l.y,distance:i.utils.getDistance(e.center,t.center),angle:i.utils.getAngle(e.center,t.center),direction:i.utils.getDirection(e.center,t.center),scale:i.utils.getScale(e.touches,t.touches),rotation:i.utils.getRotation(e.touches,t.touches),startEvent:e}),t},register:function(t){var n=t.defaults||{};return n[t.name]===e&&(n[t.name]=!0),i.utils.extend(i.defaults,n,!0),t.index=t.index||1e3,this.gestures.push(t),this.gestures.sort(function(t,e){return t.index<e.index?-1:t.index>e.index?1:0}),this.gestures}},i.gestures=i.gestures||{},i.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(t,e){switch(t.eventType){case i.EVENT_START:clearTimeout(this.timer),i.detection.current.name=this.name,this.timer=setTimeout(function(){"hold"==i.detection.current.name&&e.trigger("hold",t)},e.options.hold_timeout);break;case i.EVENT_MOVE:t.distance>e.options.hold_threshold&&clearTimeout(this.timer);break;case i.EVENT_END:clearTimeout(this.timer)}}},i.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(t,e){if(t.eventType==i.EVENT_END){var n=i.detection.previous,r=!1;if(t.deltaTime>e.options.tap_max_touchtime||t.distance>e.options.tap_max_distance)return;n&&"tap"==n.name&&t.timeStamp-n.lastEvent.timeStamp<e.options.doubletap_interval&&t.distance<e.options.doubletap_distance&&(e.trigger("doubletap",t),r=!0),(!r||e.options.tap_always)&&(i.detection.current.name="tap",e.trigger(i.detection.current.name,t))}}},i.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_max_touches:1,swipe_velocity:.7},handler:function(t,e){if(t.eventType==i.EVENT_END){if(e.options.swipe_max_touches>0&&t.touches.length>e.options.swipe_max_touches)return;(t.velocityX>e.options.swipe_velocity||t.velocityY>e.options.swipe_velocity)&&(e.trigger(this.name,t),e.trigger(this.name+t.direction,t))}}},i.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(t,n){if(i.detection.current.name!=this.name&&this.triggered)return n.trigger(this.name+"end",t),this.triggered=!1,e;if(!(n.options.drag_max_touches>0&&t.touches.length>n.options.drag_max_touches))switch(t.eventType){case i.EVENT_START:this.triggered=!1;break;case i.EVENT_MOVE:if(t.distance<n.options.drag_min_distance&&i.detection.current.name!=this.name)return;i.detection.current.name=this.name,(i.detection.current.lastEvent.drag_locked_to_axis||n.options.drag_lock_to_axis&&n.options.drag_lock_min_distance<=t.distance)&&(t.drag_locked_to_axis=!0);var r=i.detection.current.lastEvent.direction;t.drag_locked_to_axis&&r!==t.direction&&(t.direction=i.utils.isVertical(r)?0>t.deltaY?i.DIRECTION_UP:i.DIRECTION_DOWN:0>t.deltaX?i.DIRECTION_LEFT:i.DIRECTION_RIGHT),this.triggered||(n.trigger(this.name+"start",t),this.triggered=!0),n.trigger(this.name,t),n.trigger(this.name+t.direction,t),(n.options.drag_block_vertical&&i.utils.isVertical(t.direction)||n.options.drag_block_horizontal&&!i.utils.isVertical(t.direction))&&t.preventDefault();break;case i.EVENT_END:this.triggered&&n.trigger(this.name+"end",t),this.triggered=!1}}},i.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(t,n){if(i.detection.current.name!=this.name&&this.triggered)return n.trigger(this.name+"end",t),this.triggered=!1,e;if(!(2>t.touches.length))switch(n.options.transform_always_block&&t.preventDefault(),t.eventType){case i.EVENT_START:this.triggered=!1;break;case i.EVENT_MOVE:var r=Math.abs(1-t.scale),a=Math.abs(t.rotation);if(n.options.transform_min_scale>r&&n.options.transform_min_rotation>a)return;i.detection.current.name=this.name,this.triggered||(n.trigger(this.name+"start",t),this.triggered=!0),n.trigger(this.name,t),a>n.options.transform_min_rotation&&n.trigger("rotate",t),r>n.options.transform_min_scale&&(n.trigger("pinch",t),n.trigger("pinch"+(1>t.scale?"in":"out"),t));break;case i.EVENT_END:this.triggered&&n.trigger(this.name+"end",t),this.triggered=!1}}},i.gestures.Touch={name:"touch",index:-1/0,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(t,n){return n.options.prevent_mouseevents&&t.pointerType==i.POINTER_MOUSE?(t.stopDetect(),e):(n.options.prevent_default&&t.preventDefault(),t.eventType==i.EVENT_START&&n.trigger(this.name,t),e)}},i.gestures.Release={name:"release",index:1/0,handler:function(t,e){t.eventType==i.EVENT_END&&e.trigger(this.name,t)}},"object"==typeof module&&"object"==typeof module.exports?module.exports=i:(t.Hammer=i,"function"==typeof t.define&&t.define.amd&&t.define("hammer",[],function(){return i}))}(this),function(t,e){"use strict";t!==e&&(Hammer.event.bindDom=function(n,i,r){t(n).on(i,function(t){var n=t.originalEvent||t;n.pageX===e&&(n.pageX=t.pageX,n.pageY=t.pageY),n.target||(n.target=t.target),n.which===e&&(n.which=n.button),n.preventDefault||(n.preventDefault=t.preventDefault),n.stopPropagation||(n.stopPropagation=t.stopPropagation),r.call(this,n)})},Hammer.Instance.prototype.on=function(e,n){return t(this.element).on(e,n)},Hammer.Instance.prototype.off=function(e,n){return t(this.element).off(e,n)},Hammer.Instance.prototype.trigger=function(e,n){var i=t(this.element);return i.has(n.target).length&&(i=t(n.target)),i.trigger({type:e,gesture:n})},t.fn.hammer=function(e){return this.each(function(){var n=t(this),i=n.data("hammer");i?i&&e&&Hammer.utils.extend(i.options,e):n.data("hammer",new Hammer(this,e||{}))})})}(window.jQuery||window.Zepto),function(t,e){"use strict";function n(){if(!i.READY){i.event.determineEventTypes();for(var t in i.gestures)i.gestures.hasOwnProperty(t)&&i.detection.register(i.gestures[t]);i.event.onTouch(i.DOCUMENT,i.EVENT_MOVE,i.detection.detect),i.event.onTouch(i.DOCUMENT,i.EVENT_END,i.detection.detect),i.READY=!0}}var i=function(t,e){return new i.Instance(t,e||{})};i.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},i.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,i.HAS_TOUCHEVENTS="ontouchstart"in t,i.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i,i.NO_MOUSEEVENTS=i.HAS_TOUCHEVENTS&&navigator.userAgent.match(i.MOBILE_REGEX),i.EVENT_TYPES={},i.DIRECTION_DOWN="down",i.DIRECTION_LEFT="left",i.DIRECTION_UP="up",i.DIRECTION_RIGHT="right",i.POINTER_MOUSE="mouse",i.POINTER_TOUCH="touch",i.POINTER_PEN="pen",i.EVENT_START="start",i.EVENT_MOVE="move",i.EVENT_END="end",i.DOCUMENT=document,i.plugins={},i.READY=!1,i.Instance=function(t,e){var r=this;return n(),this.element=t,this.enabled=!0,this.options=i.utils.extend(i.utils.extend({},i.defaults),e||{}),this.options.stop_browser_behavior&&i.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),i.event.onTouch(t,i.EVENT_START,function(t){r.enabled&&i.detection.startDetect(r,t)}),this},i.Instance.prototype={on:function(t,e){for(var n=t.split(" "),i=0;n.length>i;i++)this.element.addEventListener(n[i],e,!1);return this},off:function(t,e){for(var n=t.split(" "),i=0;n.length>i;i++)this.element.removeEventListener(n[i],e,!1);return this},trigger:function(t,e){var n=i.DOCUMENT.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e;var r=this.element;return i.utils.hasParent(e.target,r)&&(r=e.target),"drag"===t&&console.log("drag"),r.dispatchEvent(n),this},enable:function(t){return this.enabled=t,this}};var r=null,a=!1,o=!1;i.event={bindDom:function(t,e,n){for(var i=e.split(" "),r=0;i.length>r;r++)t.addEventListener(i[r],n,!1)},onTouch:function(t,e,n){var s=this;this.bindDom(t,i.EVENT_TYPES[e],function(l){var c=l.type.toLowerCase();if(!c.match(/mouse/)||!o){(c.match(/touch/)||c.match(/pointerdown/)||c.match(/mouse/)&&1===l.which)&&(a=!0),c.match(/touch|pointer/)&&(o=!0);var u=0;a&&(i.HAS_POINTEREVENTS&&e!=i.EVENT_END?u=i.PointerEvent.updatePointer(e,l):c.match(/touch/)?u=l.touches.length:o||(u=c.match(/up/)?0:1),u>0&&e==i.EVENT_END?e=i.EVENT_MOVE:u||(e=i.EVENT_END),u||null===r?r=l:l=r,n.call(i.detection,s.collectEventData(t,e,l)),i.HAS_POINTEREVENTS&&e==i.EVENT_END&&(u=i.PointerEvent.updatePointer(e,l))),u||(r=null,a=!1,o=!1,i.PointerEvent.reset())}})},determineEventTypes:function(){var t;t=i.HAS_POINTEREVENTS?i.PointerEvent.getEvents():i.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],i.EVENT_TYPES[i.EVENT_START]=t[0],i.EVENT_TYPES[i.EVENT_MOVE]=t[1],i.EVENT_TYPES[i.EVENT_END]=t[2]},getTouchList:function(t){return i.HAS_POINTEREVENTS?i.PointerEvent.getTouchList():t.touches?t.touches:[{identifier:1,pageX:t.pageX,pageY:t.pageY,target:t.target}]},collectEventData:function(t,e,n){var r=this.getTouchList(n,e),a=i.POINTER_TOUCH;return(n.type.match(/mouse/)||i.PointerEvent.matchType(i.POINTER_MOUSE,n))&&(a=i.POINTER_MOUSE),{center:i.utils.getCenter(r),timeStamp:(new Date).getTime(),target:n.target,touches:r,eventType:e,pointerType:a,srcEvent:n,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return i.detection.stopDetect()}}}},i.PointerEvent={pointers:{},getTouchList:function(){var t=this,e=[];return Object.keys(t.pointers).sort().forEach(function(n){e.push(t.pointers[n])}),e},updatePointer:function(t,e){return t==i.EVENT_END?this.pointers={}:(e.identifier=e.pointerId,this.pointers[e.pointerId]=e),Object.keys(this.pointers).length},matchType:function(t,e){if(!e.pointerType)return!1;var n={};return n[i.POINTER_MOUSE]=e.pointerType==e.MSPOINTER_TYPE_MOUSE||e.pointerType==i.POINTER_MOUSE,n[i.POINTER_TOUCH]=e.pointerType==e.MSPOINTER_TYPE_TOUCH||e.pointerType==i.POINTER_TOUCH,n[i.POINTER_PEN]=e.pointerType==e.MSPOINTER_TYPE_PEN||e.pointerType==i.POINTER_PEN,n[t]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},i.utils={extend:function(t,n,i){for(var r in n)t[r]!==e&&i||(t[r]=n[r]);return t},hasParent:function(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1},getCenter:function(t){for(var e=[],n=[],i=0,r=t.length;r>i;i++)e.push(t[i].pageX),n.push(t[i].pageY);return{pageX:(Math.min.apply(Math,e)+Math.max.apply(Math,e))/2,pageY:(Math.min.apply(Math,n)+Math.max.apply(Math,n))/2}},getVelocity:function(t,e,n){return{x:Math.abs(e/t)||0,y:Math.abs(n/t)||0}},getAngle:function(t,e){var n=e.pageY-t.pageY,i=e.pageX-t.pageX;return 180*Math.atan2(n,i)/Math.PI},getDirection:function(t,e){var n=Math.abs(t.pageX-e.pageX),r=Math.abs(t.pageY-e.pageY);return n>=r?t.pageX-e.pageX>0?i.DIRECTION_LEFT:i.DIRECTION_RIGHT:t.pageY-e.pageY>0?i.DIRECTION_UP:i.DIRECTION_DOWN},getDistance:function(t,e){var n=e.pageX-t.pageX,i=e.pageY-t.pageY;return Math.sqrt(n*n+i*i)},getScale:function(t,e){return t.length>=2&&e.length>=2?this.getDistance(e[0],e[1])/this.getDistance(t[0],t[1]):1},getRotation:function(t,e){return t.length>=2&&e.length>=2?this.getAngle(e[1],e[0])-this.getAngle(t[1],t[0]):0},isVertical:function(t){return t==i.DIRECTION_UP||t==i.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(t,e){var n,i=["webkit","khtml","moz","ms","o",""];if(e&&t.style){for(var r=0;i.length>r;r++)for(var a in e)e.hasOwnProperty(a)&&(n=a,i[r]&&(n=i[r]+n.substring(0,1).toUpperCase()+n.substring(1)),t.style[n]=e[a]);"none"==e.userSelect&&(t.onselectstart=function(){return!1})}}},i.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(t,e){this.current||(this.stopped=!1,this.current={inst:t,startEvent:i.utils.extend({},e),lastEvent:!1,name:""},this.detect(e))},detect:function(t){if(this.current&&!this.stopped){t=this.extendEventData(t);for(var e=this.current.inst.options,n=0,r=this.gestures.length;r>n;n++){var a=this.gestures[n];if(!this.stopped&&e[a.name]!==!1&&a.handler.call(a,t,this.current.inst)===!1){this.stopDetect();break}}return this.current&&(this.current.lastEvent=t),t.eventType==i.EVENT_END&&!t.touches.length-1&&this.stopDetect(),t}},stopDetect:function(){this.previous=i.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(t){var e=this.current.startEvent;if(e&&(t.touches.length!=e.touches.length||t.touches===e.touches)){e.touches=[];for(var n=0,r=t.touches.length;r>n;n++)e.touches.push(i.utils.extend({},t.touches[n]))}var a=t.timeStamp-e.timeStamp,o=t.center.pageX-e.center.pageX,s=t.center.pageY-e.center.pageY,l=i.utils.getVelocity(a,o,s);return i.utils.extend(t,{deltaTime:a,deltaX:o,deltaY:s,velocityX:l.x,velocityY:l.y,distance:i.utils.getDistance(e.center,t.center),angle:i.utils.getAngle(e.center,t.center),direction:i.utils.getDirection(e.center,t.center),scale:i.utils.getScale(e.touches,t.touches),rotation:i.utils.getRotation(e.touches,t.touches),startEvent:e}),t},register:function(t){var n=t.defaults||{};return n[t.name]===e&&(n[t.name]=!0),i.utils.extend(i.defaults,n,!0),t.index=t.index||1e3,this.gestures.push(t),this.gestures.sort(function(t,e){return t.index<e.index?-1:t.index>e.index?1:0
}),this.gestures}},i.gestures=i.gestures||{},i.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(t,e){switch(t.eventType){case i.EVENT_START:clearTimeout(this.timer),i.detection.current.name=this.name,this.timer=setTimeout(function(){"hold"==i.detection.current.name&&e.trigger("hold",t)},e.options.hold_timeout);break;case i.EVENT_MOVE:t.distance>e.options.hold_threshold&&clearTimeout(this.timer);break;case i.EVENT_END:clearTimeout(this.timer)}}},i.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(t,e){if(t.eventType==i.EVENT_END){var n=i.detection.previous,r=!1;if(t.deltaTime>e.options.tap_max_touchtime||t.distance>e.options.tap_max_distance)return;n&&"tap"==n.name&&t.timeStamp-n.lastEvent.timeStamp<e.options.doubletap_interval&&t.distance<e.options.doubletap_distance&&(e.trigger("doubletap",t),r=!0),(!r||e.options.tap_always)&&(i.detection.current.name="tap",e.trigger(i.detection.current.name,t))}}},i.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_max_touches:1,swipe_velocity:.7},handler:function(t,e){if(t.eventType==i.EVENT_END){if(e.options.swipe_max_touches>0&&t.touches.length>e.options.swipe_max_touches)return;(t.velocityX>e.options.swipe_velocity||t.velocityY>e.options.swipe_velocity)&&(e.trigger(this.name,t),e.trigger(this.name+t.direction,t))}}},i.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(t,n){if(i.detection.current.name!=this.name&&this.triggered)return n.trigger(this.name+"end",t),this.triggered=!1,e;if(!(n.options.drag_max_touches>0&&t.touches.length>n.options.drag_max_touches))switch(t.eventType){case i.EVENT_START:this.triggered=!1;break;case i.EVENT_MOVE:if(t.distance<n.options.drag_min_distance&&i.detection.current.name!=this.name)return;i.detection.current.name=this.name,(i.detection.current.lastEvent.drag_locked_to_axis||n.options.drag_lock_to_axis&&n.options.drag_lock_min_distance<=t.distance)&&(t.drag_locked_to_axis=!0);var r=i.detection.current.lastEvent.direction;t.drag_locked_to_axis&&r!==t.direction&&(t.direction=i.utils.isVertical(r)?0>t.deltaY?i.DIRECTION_UP:i.DIRECTION_DOWN:0>t.deltaX?i.DIRECTION_LEFT:i.DIRECTION_RIGHT),this.triggered||(n.trigger(this.name+"start",t),this.triggered=!0),n.trigger(this.name,t),n.trigger(this.name+t.direction,t),(n.options.drag_block_vertical&&i.utils.isVertical(t.direction)||n.options.drag_block_horizontal&&!i.utils.isVertical(t.direction))&&t.preventDefault();break;case i.EVENT_END:this.triggered&&n.trigger(this.name+"end",t),this.triggered=!1}}},i.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(t,n){if(i.detection.current.name!=this.name&&this.triggered)return n.trigger(this.name+"end",t),this.triggered=!1,e;if(!(2>t.touches.length))switch(n.options.transform_always_block&&t.preventDefault(),t.eventType){case i.EVENT_START:this.triggered=!1;break;case i.EVENT_MOVE:var r=Math.abs(1-t.scale),a=Math.abs(t.rotation);if(n.options.transform_min_scale>r&&n.options.transform_min_rotation>a)return;i.detection.current.name=this.name,this.triggered||(n.trigger(this.name+"start",t),this.triggered=!0),n.trigger(this.name,t),a>n.options.transform_min_rotation&&n.trigger("rotate",t),r>n.options.transform_min_scale&&(n.trigger("pinch",t),n.trigger("pinch"+(1>t.scale?"in":"out"),t));break;case i.EVENT_END:this.triggered&&n.trigger(this.name+"end",t),this.triggered=!1}}},i.gestures.Touch={name:"touch",index:-1/0,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(t,n){return n.options.prevent_mouseevents&&t.pointerType==i.POINTER_MOUSE?(t.stopDetect(),e):(n.options.prevent_default&&t.preventDefault(),t.eventType==i.EVENT_START&&n.trigger(this.name,t),e)}},i.gestures.Release={name:"release",index:1/0,handler:function(t,e){t.eventType==i.EVENT_END&&e.trigger(this.name,t)}},"object"==typeof module&&"object"==typeof module.exports?module.exports=i:(t.Hammer=i,"function"==typeof t.define&&t.define.amd&&t.define("hammer",[],function(){return i}))}(this),AVLTree.prototype.add=function(t){if(this._root){var e=this._root.add(t);return this._root=e[0],e[1]&&e[0]||console.log("failed to add data"),e[1]}return this._root=new AVLNode(t,this._comparator),this._root},AVLTree.prototype.remove=function(t){if(this._root){var e=this._root.remove(t);return this._root=e[0],e[1]}return null},AVLTree.prototype.find=function(t){var e=this._find(t);return e?e._value:null},AVLTree.prototype.isEmpty=function(){return null===this._root||void 0===this._root},AVLTree.prototype.map=function(t){var e,n=this.getContents();for(e=0;n.length>e;e++)t(n[e])},AVLTree.prototype.getContents=function(){var t=[],e=[];if(!this._root)return[];for(var n=this._root;e.length>0||null!=n;)n?(e.push(n),n=n._left):(n=e.pop(),t.push(n._value),n=n._right);return t},AVLTree.prototype.printAVL=function(){for(var t=this.getContents(),e=0;t.length>e;e++)console.log(t[e].key)},AVLTree.prototype.clone=function(t){var e,n=t||this.getContents(),i=new AVLTree(this._comparator,this._valuation);for(e=0;n.length>e;e++)i.add(n[e]);return i},AVLTree.prototype.clear=function(t){var e=this.getNodesPostorder();t&&e.map(t),e.map(function(t){t._left=null,t._right=null}),this._current=null,this._root=null,this._intermediates=[]},AVLTree.prototype.getNodesPostorder=function(){var t=[];if(!this._root)return[];var e=this._root;return this.postorderHelper(e,t),t},AVLTree.prototype.postorderHelper=function(t,e){t&&(this.postorderHelper(t._left,e),this.postorderHelper(t._right,e),e.push(t))},AVLTree.prototype.nearestNeighbors=function(t,e){for(var n,i,r=this._root;r;){var a=this._valuation(t,r._value);if(0===a)return-1===e?[this.findPrevious(r._value),r._value]:1===e?[r._value,this.findNext(r._value)]:[this.findPrevious(r._value),this.findNext(r._value)];a>0?(n=r._value,r=r._right):(i=r._value,r=r._left)}return[n,i]},AVLTree.prototype.debugNN=function(t){var e=this.nearestNeighbors(t),n=e[0]?e[0].key:"is null",i=e[1]?e[1].key:"is null";console.log(n+", "+i)},AVLTree.prototype.findNext=function(t){var e=this._find(t,!0),n=this._next(e);return n?n._value:null},AVLTree.prototype.findPrevious=function(t){var e=this._find(t,!0),n=this._previous(e);return n?n._value:null},AVLTree.prototype.max=function(){var t=this._max();return t?t._value:null},AVLTree.prototype.min=function(){var t=this._min();return t?t._value:null},AVLTree.prototype.next=function(){return this._current=this._next(this._current),this._current?this._current._value:null},AVLTree.prototype.previous=function(){return this._current=this._previous(this._current),this._current?this._current._value:null},AVLTree.prototype.isSolo=function(){return this._root._left||this._root._right?!1:!0},AVLTree.prototype._find=function(t,e){e=e||!1;var n=this._root;for(e&&(this._intermediates=[]);null!==n;){var i=this._comparator(t,n._value);if(0===i)break;e&&this._intermediates.push(n),n=0>i?n._left:n._right}return n},AVLTree.prototype._min=function(t,e){var n=t||this._root;if(e=e||!1,n)for(;n._left;)e&&this._intermediates.push(t),n=n._left;return n},AVLTree.prototype._max=function(t,e){var n=t||this._root;if(e=e||!1,n)for(;n._right;)e&&this._intermediates.push(t),n=n._right;return n},AVLTree.prototype._next=function(t){if(t)if(t._right)this._intermediates.push(t),t=this._min(t._right,!0);else{for(var e=this._intermediates,n=e.pop();n&&n._right===t;)t=n,n=e.pop();t=n}else this._intermediates=[],t=this._min(this._root,!0);return t},AVLTree.prototype._previous=function(t){if(t)if(t._left)this._intermediates.push(t),t=this._max(t._left,!0);else{for(var e=this._intermediates,n=e.pop();n&&n._left===t;)t=n,n=e.pop();t=n}else this._intermediates=[],t=this._max(this._root,!0);return t},AVLNode.prototype.add=function(t){var e,n,i=this._comparator(t,this._value);return 0!==i?(0>i?this._left?(e=this._left.add(t),this._left=e[0],n=e[1]):(this._left=new AVLNode(t,this._comparator),n=this._left):i>0&&(this._right?(e=this._right.add(t),this._right=e[0],n=e[1]):(this._right=new AVLNode(t,this._comparator),n=this._right)),[this.balanceTree(),n]):[this,this]},AVLNode.prototype.remove=function(t){var e,n,i,r=this._comparator(t,this._value);return r?(0>r?this._left?(e=this._left.remove(t),this._left=e[0],n=e[1]):n=null:this._right?(e=this._right.remove(t),this._right=e[0],n=e[1]):n=null,i=this):(n=this,null==this._left?i=this._right:null==this._right?i=this._left:(i=this._left.merge(this._right),this._left=null,this._right=null)),n?i?[i.balanceTree(),n]:[i,n]:[this,null]},AVLNode.prototype.balanceTree=function(){var t=null!=this._left?this._left._height:0,e=null!=this._right?this._right._height:0;return t>e+1?this.swingRight():e>t+1?this.swingLeft():(this.setHeight(),this)},AVLNode.prototype.merge=function(t){if(null==t)return this;var e;return this._height>t._height?(e=this,e._right=t.merge(e._right)):(e=t,e._left=this.merge(e._left)),e.balanceTree()},AVLNode.prototype.moveLeft=function(){var t=this._right,e=t._left;return this._right=e,t._left=this,this.setHeight(),t.setHeight(),t},AVLNode.prototype.moveRight=function(){var t=this._left,e=t._right;return this._left=e,t._right=this,this.setHeight(),t.setHeight(),t},AVLNode.prototype.setHeight=function(){var t=this._left?this._left._height:0,e=this._right?this._right._height:0;this._height=e>t?e+1:t+1},AVLNode.prototype.swingLeft=function(){var t=this._right,e=t._left,n=t._right,i=this._left;i?i._height:0;var r=e?e._height:0,a=n?n._height:0;return r>a&&(this._right=t.moveRight()),this.moveLeft()},AVLNode.prototype.swingRight=function(){var t=this._left,e=t._right,n=t._left,i=this._right;null!=i?i._height:0;var r=null!=e?e._height:0,a=null!=n?n._height:0;return r>a&&(this._left=t.moveLeft()),this.moveRight()},AVLNode.prototype.traverse=function(t){this._left&&this._left.traverse(t),t(this),this._right&&this._right.traverse(t)},AVLNode.prototype.toString=function(){return""+this._value},binaryHeap.prototype={push:function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.sinkDown(0)),t},peek:function(){return this.content[0]},remove:function(t){for(var e=this.content.length,n=0;e>n;n++)if(this.content[n]===t){var i=this.content.pop();if(n==e-1)break;this.content[n]=i,this.bubbleUp(n),this.sinkDown(n);break}},size:function(){return this.content.length},findValue:function(t,e){for(var n,i=this.content.length,r=0;i>r;r++)if(e(this.content[r])===t){var a=this.content.pop();if(r==i-1){n=a;break}this.content[r]=a,this.bubbleUp(r),this.sinkDown(r);break}return n},bubbleUp:function(t){for(var e=this.content[t],n=this.scoreFunction(e);t>0;){var i=Math.floor((t+1)/2)-1,r=this.content[i];if(n>=this.scoreFunction(r))break;this.content[i]=e,this.content[t]=r,t=i}},sinkDown:function(t){for(var e=this.content.length,n=this.content[t],i=this.scoreFunction(n);;){var r=2*(t+1),a=r-1,o=null;if(e>a){var s=this.content[a],l=this.scoreFunction(s);i>l&&(o=a)}if(e>r){var c=this.content[r],u=this.scoreFunction(c);(null==o?i:l)>u&&(o=r)}if(null==o)break;this.content[t]=this.content[o],this.content[o]=n,t=o}},find:function(t){for(var e,n=this.content.length,i=0;n>i;i++)if(this.content[i]===t){var r=this.content.pop();if(i==n-1){e=r;break}this.content[i]=r,this.bubbleUp(i),this.sinkDown(i);break}return e}},DataHolder.prototype.reInitHeaps=function(){this._leftExternal=new binaryHeap(this._scoreFunctionMin),this._leftInternal=new binaryHeap(this._scoreFunctionMin),this._rightExternal=new binaryHeap(this._scoreFunctionMin),this._rightInternal=new binaryHeap(this._scoreFunctionMin)},DataHolder.prototype.insertTrack=function(t,e){var n={track:t,displays:new AVLTree(this._dispComparator,this._dispValuation)};return t.setStorageContainer(n),e===void 0||null===e?this._trackArray.push(n):this._trackArray.splice(e,0,n),this.mapTracks(function(t,e){t.track.updatePos(e)}),n},DataHolder.prototype.removeTrack=function(t){var e=this._trackArray[t.getPos()];return this._trackArray.splice(t.getPos(),1),this.mapTracks(function(t,e){t.track.updatePos(e)}),e},DataHolder.prototype.selectTrack=function(t){this._selectedTrack=t},DataHolder.prototype.getSelectedTrack=function(){return this._selectedTrack},DataHolder.prototype.indexOfTrack=function(t){var e;for(e=0;this._trackArray.length>e;e++){var n=this._trackArray[e];if(n.track=t)return e}return!1},DataHolder.prototype.mapTracks=function(t){this._trackArray.map(t)},DataHolder.prototype.getType=function(t){return t.getType()},DataHolder.prototype.getInkEnabled=function(t){return t.getInkEnabled()},DataHolder.prototype.getInkLink=function(t){return t.getInkLink()},DataHolder.prototype.getTracks=function(){return this._trackArray},DataHolder.prototype.numTracks=function(){return this._trackArray.length},DataHolder.prototype.findTrackByTitle=function(t){var e;for(e=0;this._trackArray.length>e;e++)if(this._trackArray[e].track.getTitle()===t)return this._trackArray[e].track;return null},DataHolder.prototype.addDisplay=function(t,e){var n=this._trackArray[t],i=new AVLTree(this._kfComparator,this._kfValuation),r={display:e,keyframes:i,displayTree:n.displays,hostTrack:n.track};return n.displays.add(r),e.setStorageContainer(r),e.setKeyframeTree(i),this.mapDisplays(n,function(t,e){t.display.setID(e)}),r},DataHolder.prototype.mapDisplays=function(t,e){t.displays.map(e)},DataHolder.prototype.removeDisplay=function(t,e){var n=this._trackArray[t],i=e.getStorageContainer();return n.displays.remove(i)},DataHolder.prototype.findDisplay=function(t,e){var n=this._trackArray[t],i=e.getStorageContainer();return n.displays.find(i)},DataHolder.prototype.findPreviousDisplay=function(t,e){var n=this._trackArray[t],i=e.getStorageContainer();return n.displays.findPrevious(i)},DataHolder.prototype.findNextDisplay=function(t,e){var n=this._trackArray[t],i=e.getStorageContainer();return n.displays.findNext(i)},DataHolder.prototype.minDisplay=function(t){var e=this._trackArray[t];return e.displays.min()},DataHolder.prototype.maxDisplay=function(t){var e=this._trackArray[t];return e.displays.max()},DataHolder.prototype.replaceKeyframes=function(t,e){t.getStorageContainer().keyframes=e},DataHolder.prototype.getDisplays=function(t){return this._trackArray[t]&&this._trackArray[t].displays},DataHolder.prototype.addKeyframe=function(t,e){var n=t.getStorageContainer();return n.keyframes.add(e),newKeyframe},DataHolder.prototype.removeKeyframe=function(t,e){var n=t.getStorageContainer();return n.keyframes.remove(e)},DataHolder.prototype.findKeyframe=function(t,e){var n=t.getStorageContainer();return n.keyframes.find(e)},DataHolder.prototype.findPrevKeyframe=function(t,e){var n=t.getStorageContainer();return n.keyframes.findPrevious(e)},DataHolder.prototype.findNextKeyframe=function(t,e){var n=t.getStorageContainer();return n.keyframes.findNext(e)},DataHolder.prototype.firstKeyframe=function(t){var e=t.getStorageContainer();return e.keyframes.min()},DataHolder.prototype.lastKeyframe=function(t){var e=t.getStorageContainer();return e.keyframes.max()},DataHolder.prototype.mapKeyframes=function(t,e){t.keyframes.map(e)},DataHolder.prototype.getKeyframes=function(t){return t.keyframes},DoublyLinkedList.prototype._createNewNode=function(t){var e={data:t,next:null,prev:null};return e},DoublyLinkedList.prototype.append=function(t){var e=this._createNewNode(t);return 0===this._length?(this._head=e,this._tail=e):(this._tail.next=e,e.prev=this._tail,this._tail=e),this._length++,e},DoublyLinkedList.prototype.prepend=function(t){var e=this._createNewNode(t);return null===this.first?(this.append(e),void 0):(this._head.prev=e,e.next=this._head,this._head=e,this._length++,e)},DoublyLinkedList.prototype.item=function(t){if(t>=0&&this._length>t){for(var e=this._head;t--;)e=e.next;return e}},DoublyLinkedList.prototype.search=function(t){for(var e=this._head;null!=e;){if(e.data===t)return e;e=e.next}return null},DoublyLinkedList.prototype.findNext=function(t){for(var e=this._head;null!=e;){if(e.data>=t)return e;e=e.next}return null},DoublyLinkedList.prototype.findPrev=function(t){for(var e=this._head;null!=e;){if(e.data>=t)return null===e.prev?null:e.prev;e=e.next}return null},DoublyLinkedList.prototype.head=function(){return this._head},DoublyLinkedList.prototype.tail=function(){return this._tail},DoublyLinkedList.prototype.size=function(){return this._length},DoublyLinkedList.prototype.printList=function(){var t=this._head;if(null===t)console.log("Empty List\n");else{console.log("Printing List...");for(var e=0;this._length>e;e++)console.log(t.data+" "),t=t.next;console.log("\n")}},DoublyLinkedList.prototype.remove=function(t){if(!(0>t||t>=this._length||0===this._length)){var e=this.item(t),n=e.next,i=e.prev;return null!=n&&null!=i?(i.next=n,n.prev=i):null===n&&null!=i?(i.next=null,this._tail=i):null===i&&null!=n?(n.prev=null,this._head=n):(this._head=null,this._tail=null),this._length--,e}console.log("index is out of bounds")},HashTable.prototype.insert=function(t,e){var n=void 0;return this._hasItem(t)?n=this._items[t]:this._length++,this._items[t]=e,n},HashTable.prototype.getLength=function(){return this._length},HashTable.prototype.lookup=function(t){return this._hasItem(t)?this._items[t]:void 0},HashTable.prototype._hasItem=function(t){return this._items.hasOwnProperty(t)},HashTable.prototype.removeItem=function(t){return this._hasItem(t)?(previous=this._items[t],this._length--,delete this._items[t],previous):void 0},HashTable.prototype.keys=function(){var t=[];for(var e in this._items)this._hasItem(e)&&t.push(e);return t},HashTable.prototype.values=function(){var t=[];for(var e in this._items)this._hasItem(e)&&t.push(this._items[e]);return t},HashTable.prototype.each=function(t){for(var e in this._items)this._hasItem(e)&&t(e,this._items[e])},HashTable.prototype.clear=function(){this._items={},this._length=0},function(){function t(t,e){try{for(var n in e)Object.defineProperty(t.prototype,n,{value:e[n],enumerable:!1})}catch(i){t.prototype=e}}function e(t){for(var e=-1,n=t.length,i=[];n>++e;)i.push(t[e]);return i}function n(t){return Array.prototype.slice.call(t)}function i(){}function r(t){return t}function a(){return this}function o(){return!0}function s(t){return"function"==typeof t?t:function(){return t}}function l(t,e,n){return function(){var i=n.apply(e,arguments);return arguments.length?t:i}}function c(t){return null!=t&&!isNaN(t)}function u(t){return t.length}function d(t){return null==t}function h(t){return t.replace(/^\s+|\s+$/g,"").replace(/\s+/g," ")}function p(t){for(var e=1;t*e%1;)e*=10;return e}function f(){}function g(t){function e(){for(var e,i=n,r=-1,a=i.length;a>++r;)(e=i[r].on)&&e.apply(this,arguments);return t}var n=[],r=new i;return e.on=function(e,i){var a,o=r.get(e);return 2>arguments.length?o&&o.on:(o&&(o.on=null,n=n.slice(0,a=n.indexOf(o)).concat(n.slice(a+1)),r.remove(e)),i&&n.push(r.set(e,{on:i})),t)},e}function m(t,e){return e-(t?1+Math.floor(Math.log(t+Math.pow(10,1+Math.floor(Math.log(t)/Math.LN10)-e))/Math.LN10):1)}function v(t){return t+""}function y(t){for(var e=t.lastIndexOf("."),n=e>=0?t.substring(e):(e=t.length,""),i=[];e>0;)i.push(t.substring(e-=3,e+3));return i.reverse().join(",")+n}function b(t,e){var n=Math.pow(10,3*Math.abs(8-e));return{scale:e>8?function(t){return t/n}:function(t){return t*n},symbol:t}}function x(t){return function(e){return 0>=e?0:e>=1?1:t(e)}}function T(t){return function(e){return 1-t(1-e)}}function w(t){return function(e){return.5*(.5>e?t(2*e):2-t(2-2*e))}}function k(t){return t}function A(t){return function(e){return Math.pow(e,t)}}function _(t){return 1-Math.cos(t*Math.PI/2)}function C(t){return Math.pow(2,10*(t-1))}function E(t){return 1-Math.sqrt(1-t*t)}function S(t,e){var n;return 2>arguments.length&&(e=.45),1>arguments.length?(t=1,n=e/4):n=e/(2*Math.PI)*Math.asin(1/t),function(i){return 1+t*Math.pow(2,10*-i)*Math.sin(2*(i-n)*Math.PI/e)}}function M(t){return t||(t=1.70158),function(e){return e*e*((t+1)*e-t)}}function I(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function D(){d3.event.stopPropagation(),d3.event.preventDefault()}function P(){for(var t,e=d3.event;t=e.sourceEvent;)e=t;return e}function $(t){for(var e=new f,n=0,i=arguments.length;i>++n;)e[arguments[n]]=g(e);return e.of=function(n,i){return function(r){try{var a=r.sourceEvent=d3.event;r.target=t,d3.event=r,e[r.type].apply(n,i)}finally{d3.event=a}}},e}function N(t){return"transform"==t?d3.interpolateTransform:d3.interpolate}function G(t,e){return e=e-(t=+t)?1/(e-t):0,function(n){return(n-t)*e}}function O(t,e){return e=e-(t=+t)?1/(e-t):0,function(n){return Math.max(0,Math.min(1,(n-t)*e))}}function L(t,e,n){return new F(t,e,n)}function F(t,e,n){this.r=t,this.g=e,this.b=n}function B(t){return 16>t?"0"+Math.max(0,t).toString(16):Math.min(255,t).toString(16)}function R(t,e,n){var i,r,a,o=0,s=0,l=0;if(i=/([a-z]+)\((.*)\)/i.exec(t))switch(r=i[2].split(","),i[1]){case"hsl":return n(parseFloat(r[0]),parseFloat(r[1])/100,parseFloat(r[2])/100);case"rgb":return e(U(r[0]),U(r[1]),U(r[2]))}return(a=Rr.get(t))?e(a.r,a.g,a.b):(null!=t&&"#"===t.charAt(0)&&(4===t.length?(o=t.charAt(1),o+=o,s=t.charAt(2),s+=s,l=t.charAt(3),l+=l):7===t.length&&(o=t.substring(1,3),s=t.substring(3,5),l=t.substring(5,7)),o=parseInt(o,16),s=parseInt(s,16),l=parseInt(l,16)),e(o,s,l))}function H(t,e,n){var i,r,a=Math.min(t/=255,e/=255,n/=255),o=Math.max(t,e,n),s=o-a,l=(o+a)/2;return s?(r=.5>l?s/(o+a):s/(2-o-a),i=t==o?(e-n)/s+(n>e?6:0):e==o?(n-t)/s+2:(t-e)/s+4,i*=60):r=i=0,z(i,r,l)}function U(t){var e=parseFloat(t);return"%"===t.charAt(t.length-1)?Math.round(2.55*e):e}function z(t,e,n){return new j(t,e,n)}function j(t,e,n){this.h=t,this.s=e,this.l=n}function W(t,e,n){function i(t){return t>360?t-=360:0>t&&(t+=360),60>t?a+(o-a)*t/60:180>t?o:240>t?a+(o-a)*(240-t)/60:a}function r(t){return Math.round(255*i(t))}var a,o;return t%=360,0>t&&(t+=360),e=0>e?0:e>1?1:e,n=0>n?0:n>1?1:n,o=.5>=n?n*(1+e):n+e-n*e,a=2*n-o,L(r(t+120),r(t),r(t-120))}function q(t){return _r(t,qr),t}function V(t){return function(){return Hr(t,this)}}function Y(t){return function(){return Ur(t,this)}}function X(t,e){function n(){if(e=this.classList)return e.add(t);var e=this.className,n=null!=e.baseVal,i=n?e.baseVal:e;a.lastIndex=0,a.test(i)||(i=h(i+" "+t),n?e.baseVal=i:this.className=i)}function i(){if(e=this.classList)return e.remove(t);var e=this.className,n=null!=e.baseVal,i=n?e.baseVal:e;i=h(i.replace(a," ")),n?e.baseVal=i:this.className=i}function r(){(e.apply(this,arguments)?n:i).call(this)}var a=RegExp("(^|\\s+)"+d3.requote(t)+"(\\s+|$)","g");if(2>arguments.length){var o=this.node();if(s=o.classList)return s.contains(t);var s=o.className;return a.lastIndex=0,a.test(null!=s.baseVal?s.baseVal:s)}return this.each("function"==typeof e?r:e?n:i)}function K(t){return{__data__:t}}function Z(t){return function(){return Wr(this,t)}}function Q(t){return arguments.length||(t=d3.ascending),function(e,n){return t(e&&e.__data__,n&&n.__data__)}}function J(t,e){for(var n=0,i=t.length;i>n;n++)for(var r,a=t[n],o=0,s=a.length;s>o;o++)(r=a[o])&&e(r,o,n);return t}function te(t){return _r(t,Yr),t}function ee(t,e,n){_r(t,Kr);var r=new i,a=d3.dispatch("start","end"),o=ra;return t.id=e,t.time=n,t.tween=function(e,n){return 2>arguments.length?r.get(e):(null==n?r.remove(e):r.set(e,n),t)},t.ease=function(e){return arguments.length?(o="function"==typeof e?e:d3.ease.apply(d3,arguments),t):o},t.each=function(e,n){return 2>arguments.length?re.call(t,e):(a.on(e,n),t)},d3.timer(function(i){return J(t,function(t,s){function l(i){return f.active>e?u():(f.active=e,r.forEach(function(e,n){(n=n.call(t,g,s))&&d.push(n)}),a.start.call(t,g,s),c(i)||d3.timer(c,0,n),1)}function c(n){if(f.active!==e)return u();for(var i=(n-h)/p,r=o(i),l=d.length;l>0;)d[--l].call(t,r);return i>=1?(u(),Qr=e,a.end.call(t,g,s),Qr=0,1):void 0}function u(){return--f.count||delete t.__transition__,1}var d=[],h=t.delay,p=t.duration,f=(t=t.node).__transition__||(t.__transition__={active:0,count:0}),g=t.__data__;++f.count,i>=h?l(i):d3.timer(l,h,n)})},0,n),t}function ne(t,e,n){return""!=n&&Xr}function ie(t,e){function n(t,n,i){var a=e.call(this,t,n);return null==a?""!=i&&Xr:i!=a&&r(i,a)}function i(t,n,i){return i!=e&&r(i,e)}var r=N(t);return"function"==typeof e?n:null==e?ne:(e+="",i)}function re(t){var e=Qr,n=ra,i=na,r=ia;return Qr=this.id,ra=this.ease(),J(this,function(e,n,i){na=e.delay,ia=e.duration,t.call(e=e.node,e.__data__,n,i)}),Qr=e,ra=n,na=i,ia=r,this}function ae(){for(var t,e=Date.now(),n=sa;n;)t=e-n.then,t>=n.delay&&(n.flush=n.callback(t)),n=n.next;var i=oe()-e;i>24?(isFinite(i)&&(clearTimeout(oa),oa=setTimeout(ae,i)),aa=0):(aa=1,la(ae))}function oe(){for(var t=null,e=sa,n=1/0;e;)e.flush?e=t?t.next=e.next:sa=e.next:(n=Math.min(n,e.then+e.delay),e=(t=e).next);return n}function se(t){var e=[t.a,t.b],n=[t.c,t.d],i=ce(e),r=le(e,n),a=ce(ue(n,e,-r))||0;e[0]*n[1]<n[0]*e[1]&&(e[0]*=-1,e[1]*=-1,i*=-1,r*=-1),this.rotate=(i?Math.atan2(e[1],e[0]):Math.atan2(-n[0],n[1]))*ca,this.translate=[t.e,t.f],this.scale=[i,a],this.skew=a?Math.atan2(r,a)*ca:0}function le(t,e){return t[0]*e[0]+t[1]*e[1]}function ce(t){var e=Math.sqrt(le(t,t));return e&&(t[0]/=e,t[1]/=e),e}function ue(t,e,n){return t[0]+=n*e[0],t[1]+=n*e[1],t}function de(t,e){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();if(0>ua&&(window.scrollX||window.scrollY)){n=d3.select(document.body).append("svg").style("position","absolute").style("top",0).style("left",0);var r=n[0][0].getScreenCTM();ua=!(r.f||r.e),n.remove()}return ua?(i.x=e.pageX,i.y=e.pageY):(i.x=e.clientX,i.y=e.clientY),i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}var a=t.getBoundingClientRect();return[e.clientX-a.left-t.clientLeft,e.clientY-a.top-t.clientTop]}function he(t){var e=t[0],n=t[t.length-1];return n>e?[e,n]:[n,e]}function pe(t){return t.rangeExtent?t.rangeExtent():he(t.range())}function fe(t,e){var n,i=0,r=t.length-1,a=t[i],o=t[r];return a>o&&(n=i,i=r,r=n,n=a,a=o,o=n),(n=o-a)&&(e=e(n),t[i]=e.floor(a),t[r]=e.ceil(o)),t}function ge(){return Math}function me(t,e,n,i){function r(){var r=Math.min(t.length,e.length)>2?ke:we,l=i?O:G;return o=r(t,e,l,n),s=r(e,t,l,d3.interpolate),a}function a(t){return o(t)}var o,s;return a.invert=function(t){return s(t)},a.domain=function(e){return arguments.length?(t=e.map(Number),r()):t},a.range=function(t){return arguments.length?(e=t,r()):e},a.rangeRound=function(t){return a.range(t).interpolate(d3.interpolateRound)},a.clamp=function(t){return arguments.length?(i=t,r()):i},a.interpolate=function(t){return arguments.length?(n=t,r()):n},a.ticks=function(e){return xe(t,e)},a.tickFormat=function(e){return Te(t,e)},a.nice=function(){return fe(t,ye),r()},a.copy=function(){return me(t,e,n,i)},r()}function ve(t,e){return d3.rebind(t,e,"range","rangeRound","interpolate","clamp")}function ye(t){return t=Math.pow(10,Math.round(Math.log(t)/Math.LN10)-1),{floor:function(e){return Math.floor(e/t)*t},ceil:function(e){return Math.ceil(e/t)*t}}}function be(t,e){var n=he(t),i=n[1]-n[0],r=Math.pow(10,Math.floor(Math.log(i/e)/Math.LN10)),a=e/i*r;return.15>=a?r*=10:.35>=a?r*=5:.75>=a&&(r*=2),n[0]=Math.ceil(n[0]/r)*r,n[1]=Math.floor(n[1]/r)*r+.5*r,n[2]=r,n}function xe(t,e){return d3.range.apply(d3,be(t,e))}function Te(t,e){return d3.format(",."+Math.max(0,-Math.floor(Math.log(be(t,e)[2])/Math.LN10+.01))+"f")}function we(t,e,n,i){var r=n(t[0],t[1]),a=i(e[0],e[1]);return function(t){return a(r(t))}}function ke(t,e,n,i){var r=[],a=[],o=0,s=Math.min(t.length,e.length)-1;for(t[s]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());s>=++o;)r.push(n(t[o-1],t[o])),a.push(i(e[o-1],e[o]));return function(e){var n=d3.bisect(t,e,1,s)-1;return a[n](r[n](e))}}function Ae(t,e){function n(n){return t(e(n))}var i=e.pow;return n.invert=function(e){return i(t.invert(e))},n.domain=function(r){return arguments.length?(e=0>r[0]?Ce:_e,i=e.pow,t.domain(r.map(e)),n):t.domain().map(i)},n.nice=function(){return t.domain(fe(t.domain(),ge)),n},n.ticks=function(){var n=he(t.domain()),r=[];if(n.every(isFinite)){var a=Math.floor(n[0]),o=Math.ceil(n[1]),s=i(n[0]),l=i(n[1]);if(e===Ce)for(r.push(i(a));o>a++;)for(var c=9;c>0;c--)r.push(i(a)*c);else{for(;o>a;a++)for(var c=1;10>c;c++)r.push(i(a)*c);r.push(i(a))}for(a=0;s>r[a];a++);for(o=r.length;r[o-1]>l;o--);r=r.slice(a,o)}return r},n.tickFormat=function(t,r){if(2>arguments.length&&(r=da),1>arguments.length)return r;var a,o=Math.max(.1,t/n.ticks().length),s=e===Ce?(a=-1e-12,Math.floor):(a=1e-12,Math.ceil);return function(t){return o>=t/i(s(e(t)+a))?r(t):""}},n.copy=function(){return Ae(t.copy(),e)},ve(n,t)}function _e(t){return Math.log(0>t?0:t)/Math.LN10}function Ce(t){return-Math.log(t>0?0:-t)/Math.LN10}function Ee(t,e){function n(e){return t(i(e))}var i=Se(e),r=Se(1/e);return n.invert=function(e){return r(t.invert(e))},n.domain=function(e){return arguments.length?(t.domain(e.map(i)),n):t.domain().map(r)},n.ticks=function(t){return xe(n.domain(),t)},n.tickFormat=function(t){return Te(n.domain(),t)},n.nice=function(){return n.domain(fe(n.domain(),ye))},n.exponent=function(t){if(!arguments.length)return e;var a=n.domain();return i=Se(e=t),r=Se(1/e),n.domain(a)},n.copy=function(){return Ee(t.copy(),e)},ve(n,t)}function Se(t){return function(e){return 0>e?-Math.pow(-e,t):Math.pow(e,t)}}function Me(t,e){function n(e){return o[((a.get(e)||a.set(e,t.push(e)))-1)%o.length]}function r(e,n){return d3.range(t.length).map(function(t){return e+n*t})}var a,o,s;return n.domain=function(r){if(!arguments.length)return t;t=[],a=new i;for(var o,s=-1,l=r.length;l>++s;)a.has(o=r[s])||a.set(o,t.push(o));return n[e.t](e.x,e.p)},n.range=function(t){return arguments.length?(o=t,s=0,e={t:"range",x:t},n):o},n.rangePoints=function(i,a){2>arguments.length&&(a=0);var l=i[0],c=i[1],u=(c-l)/(t.length-1+a);return o=r(2>t.length?(l+c)/2:l+u*a/2,u),s=0,e={t:"rangePoints",x:i,p:a},n},n.rangeBands=function(i,a){2>arguments.length&&(a=0);var l=i[1]<i[0],c=i[l-0],u=i[1-l],d=(u-c)/(t.length+a);return o=r(c+d*a,d),l&&o.reverse(),s=d*(1-a),e={t:"rangeBands",x:i,p:a},n},n.rangeRoundBands=function(i,a){2>arguments.length&&(a=0);var l=i[1]<i[0],c=i[l-0],u=i[1-l],d=Math.floor((u-c)/(t.length+a)),h=u-c-(t.length-a)*d;return o=r(c+Math.round(h/2),d),l&&o.reverse(),s=Math.round(d*(1-a)),e={t:"rangeRoundBands",x:i,p:a},n},n.rangeBand=function(){return s},n.rangeExtent=function(){return he(e.x)},n.copy=function(){return Me(t,e)},n.domain(t)}function Ie(t,e){function n(){var n=0,a=(t.length,e.length);for(r=[];a>++n;)r[n-1]=d3.quantile(t,n/a);return i}function i(t){return isNaN(t=+t)?0/0:e[d3.bisect(r,t)]}var r;return i.domain=function(e){return arguments.length?(t=e.filter(function(t){return!isNaN(t)}).sort(d3.ascending),n()):t},i.range=function(t){return arguments.length?(e=t,n()):e},i.quantiles=function(){return r},i.copy=function(){return Ie(t,e)},n()}function De(t,e,n){function i(e){return n[Math.max(0,Math.min(o,Math.floor(a*(e-t))))]}function r(){return a=n.length/(e-t),o=n.length-1,i}var a,o;return i.domain=function(n){return arguments.length?(t=+n[0],e=+n[n.length-1],r()):[t,e]},i.range=function(t){return arguments.length?(n=t,r()):n},i.copy=function(){return De(t,e,n)},r()}function Pe(t){function e(t){return+t}return e.invert=e,e.domain=e.range=function(n){return arguments.length?(t=n.map(e),e):t},e.ticks=function(e){return xe(t,e)},e.tickFormat=function(e){return Te(t,e)},e.copy=function(){return Pe(t)},e}function $e(t){return t.innerRadius}function Ne(t){return t.outerRadius}function Ge(t){return t.startAngle}function Oe(t){return t.endAngle}function Le(t){function e(e){function a(){u.push("M",l(t(d),c))}for(var o,u=[],d=[],h=-1,p=e.length,f=s(n),g=s(i);p>++h;)r.call(this,o=e[h],h)?d.push([+f.call(this,o,h),+g.call(this,o,h)]):d.length&&(a(),d=[]);
return d.length&&a(),u.length?u.join(""):null}var n=Fe,i=Be,r=o,a=ya,l=Re,c=.7;return e.x=function(t){return arguments.length?(n=t,e):n},e.y=function(t){return arguments.length?(i=t,e):i},e.defined=function(t){return arguments.length?(r=t,e):r},e.interpolate=function(t){return arguments.length?(ba.has(t+="")||(t=ya),l=ba.get(a=t),e):a},e.tension=function(t){return arguments.length?(c=t,e):c},e}function Fe(t){return t[0]}function Be(t){return t[1]}function Re(t){for(var e=0,n=t.length,i=t[0],r=[i[0],",",i[1]];n>++e;)r.push("L",(i=t[e])[0],",",i[1]);return r.join("")}function He(t){for(var e=0,n=t.length,i=t[0],r=[i[0],",",i[1]];n>++e;)r.push("V",(i=t[e])[1],"H",i[0]);return r.join("")}function Ue(t){for(var e=0,n=t.length,i=t[0],r=[i[0],",",i[1]];n>++e;)r.push("H",(i=t[e])[0],"V",i[1]);return r.join("")}function ze(t,e){return 4>t.length?Re(t):t[1]+qe(t.slice(1,t.length-1),Ve(t,e))}function je(t,e){return 3>t.length?Re(t):t[0]+qe((t.push(t[0]),t),Ve([t[t.length-2]].concat(t,[t[1]]),e))}function We(t,e){return 3>t.length?Re(t):t[0]+qe(t,Ve(t,e))}function qe(t,e){if(1>e.length||t.length!=e.length&&t.length!=e.length+2)return Re(t);var n=t.length!=e.length,i="",r=t[0],a=t[1],o=e[0],s=o,l=1;if(n&&(i+="Q"+(a[0]-2*o[0]/3)+","+(a[1]-2*o[1]/3)+","+a[0]+","+a[1],r=t[1],l=2),e.length>1){s=e[1],a=t[l],l++,i+="C"+(r[0]+o[0])+","+(r[1]+o[1])+","+(a[0]-s[0])+","+(a[1]-s[1])+","+a[0]+","+a[1];for(var c=2;e.length>c;c++,l++)a=t[l],s=e[c],i+="S"+(a[0]-s[0])+","+(a[1]-s[1])+","+a[0]+","+a[1]}if(n){var u=t[l];i+="Q"+(a[0]+2*s[0]/3)+","+(a[1]+2*s[1]/3)+","+u[0]+","+u[1]}return i}function Ve(t,e){for(var n,i=[],r=(1-e)/2,a=t[0],o=t[1],s=1,l=t.length;l>++s;)n=a,a=o,o=t[s],i.push([r*(o[0]-n[0]),r*(o[1]-n[1])]);return i}function Ye(t){if(3>t.length)return Re(t);var e=1,n=t.length,i=t[0],r=i[0],a=i[1],o=[r,r,r,(i=t[1])[0]],s=[a,a,a,i[1]],l=[r,",",a];for(Je(l,o,s);n>++e;)i=t[e],o.shift(),o.push(i[0]),s.shift(),s.push(i[1]),Je(l,o,s);for(e=-1;2>++e;)o.shift(),o.push(i[0]),s.shift(),s.push(i[1]),Je(l,o,s);return l.join("")}function Xe(t){if(4>t.length)return Re(t);for(var e,n=[],i=-1,r=t.length,a=[0],o=[0];3>++i;)e=t[i],a.push(e[0]),o.push(e[1]);for(n.push(Qe(wa,a)+","+Qe(wa,o)),--i;r>++i;)e=t[i],a.shift(),a.push(e[0]),o.shift(),o.push(e[1]),Je(n,a,o);return n.join("")}function Ke(t){for(var e,n,i=-1,r=t.length,a=r+4,o=[],s=[];4>++i;)n=t[i%r],o.push(n[0]),s.push(n[1]);for(e=[Qe(wa,o),",",Qe(wa,s)],--i;a>++i;)n=t[i%r],o.shift(),o.push(n[0]),s.shift(),s.push(n[1]),Je(e,o,s);return e.join("")}function Ze(t,e){var n=t.length-1;if(n)for(var i,r,a=t[0][0],o=t[0][1],s=t[n][0]-a,l=t[n][1]-o,c=-1;n>=++c;)i=t[c],r=c/n,i[0]=e*i[0]+(1-e)*(a+r*s),i[1]=e*i[1]+(1-e)*(o+r*l);return Ye(t)}function Qe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Je(t,e,n){t.push("C",Qe(xa,e),",",Qe(xa,n),",",Qe(Ta,e),",",Qe(Ta,n),",",Qe(wa,e),",",Qe(wa,n))}function tn(t,e){return(e[1]-t[1])/(e[0]-t[0])}function en(t){for(var e=0,n=t.length-1,i=[],r=t[0],a=t[1],o=i[0]=tn(r,a);n>++e;)i[e]=o+(o=tn(r=a,a=t[e+1]));return i[e]=o,i}function nn(t){for(var e,n,i,r,a=[],o=en(t),s=-1,l=t.length-1;l>++s;)e=tn(t[s],t[s+1]),1e-6>Math.abs(e)?o[s]=o[s+1]=0:(n=o[s]/e,i=o[s+1]/e,r=n*n+i*i,r>9&&(r=3*e/Math.sqrt(r),o[s]=r*n,o[s+1]=r*i));for(s=-1;l>=++s;)r=(t[Math.min(l,s+1)][0]-t[Math.max(0,s-1)][0])/(6*(1+o[s]*o[s])),a.push([r||0,o[s]*r||0]);return a}function rn(t){return 3>t.length?Re(t):t[0]+qe(t,nn(t))}function an(t){for(var e,n,i,r=-1,a=t.length;a>++r;)e=t[r],n=e[0],i=e[1]+ma,e[0]=n*Math.cos(i),e[1]=n*Math.sin(i);return t}function on(t){function e(e){function o(){m.push("M",u(t(y),p),h,d(t(v.reverse()),p),"Z")}for(var c,f,g,m=[],v=[],y=[],b=-1,x=e.length,T=s(n),w=s(r),k=n===i?function(){return f}:s(i),A=r===a?function(){return g}:s(a);x>++b;)l.call(this,c=e[b],b)?(v.push([f=+T.call(this,c,b),g=+w.call(this,c,b)]),y.push([+k.call(this,c,b),+A.call(this,c,b)])):v.length&&(o(),v=[],y=[]);return v.length&&o(),m.length?m.join(""):null}var n=Fe,i=Fe,r=0,a=Be,l=o,c=ya,u=Re,d=Re,h="L",p=.7;return e.x=function(t){return arguments.length?(n=i=t,e):i},e.x0=function(t){return arguments.length?(n=t,e):n},e.x1=function(t){return arguments.length?(i=t,e):i},e.y=function(t){return arguments.length?(r=a=t,e):a},e.y0=function(t){return arguments.length?(r=t,e):r},e.y1=function(t){return arguments.length?(a=t,e):a},e.defined=function(t){return arguments.length?(l=t,e):l},e.interpolate=function(t){return arguments.length?(ba.has(t+="")||(t=ya),u=ba.get(c=t),d=u.reverse||u,h=/-closed$/.test(t)?"M":"L",e):c},e.tension=function(t){return arguments.length?(p=t,e):p},e}function sn(t){return t.source}function ln(t){return t.target}function cn(t){return t.radius}function un(t){return[t.x,t.y]}function dn(t){return function(){var e=t.apply(this,arguments),n=e[0],i=e[1]+ma;return[n*Math.cos(i),n*Math.sin(i)]}}function hn(){return 64}function pn(){return"circle"}function fn(t){var e=Math.sqrt(t/Math.PI);return"M0,"+e+"A"+e+","+e+" 0 1,1 0,"+-e+"A"+e+","+e+" 0 1,1 0,"+e+"Z"}function gn(t,e){t.attr("transform",function(t){return"translate("+e(t)+",0)"})}function mn(t,e){t.attr("transform",function(t){return"translate(0,"+e(t)+")"})}function vn(t,e,n){if(i=[],n&&e.length>1){for(var i,r,a,o=he(t.domain()),s=-1,l=e.length,c=(e[1]-e[0])/++n;l>++s;)for(r=n;--r>0;)(a=+e[s]-r*c)>=o[0]&&i.push(a);for(--s,r=0;n>++r&&(a=+e[s]+r*c)<o[1];)i.push(a)}return i}function yn(){Sa||(Sa=d3.select("body").append("div").style("visibility","hidden").style("top",0).style("height",0).style("width",0).style("overflow-y","scroll").append("div").style("height","2000px").node().parentNode);var t,e=d3.event;try{Sa.scrollTop=1e3,Sa.dispatchEvent(e),t=1e3-Sa.scrollTop}catch(n){t=e.wheelDelta||5*-e.detail}return t}function bn(t){for(var e=t.source,n=t.target,i=Tn(e,n),r=[e];e!==i;)e=e.parent,r.push(e);for(var a=r.length;n!==i;)r.splice(a,0,n),n=n.parent;return r}function xn(t){for(var e=[],n=t.parent;null!=n;)e.push(t),t=n,n=n.parent;return e.push(t),e}function Tn(t,e){if(t===e)return t;for(var n=xn(t),i=xn(e),r=n.pop(),a=i.pop(),o=null;r===a;)o=r,r=n.pop(),a=i.pop();return o}function wn(t){t.fixed|=2}function kn(t){t!==Da&&(t.fixed&=1)}function An(){Da.fixed&=1,Ia=Da=null}function _n(){Da.px=d3.event.x,Da.py=d3.event.y,Ia.resume()}function Cn(t,e,n){var i=0,r=0;if(t.charge=0,!t.leaf)for(var a,o=t.nodes,s=o.length,l=-1;s>++l;)a=o[l],null!=a&&(Cn(a,e,n),t.charge+=a.charge,i+=a.charge*a.cx,r+=a.charge*a.cy);if(t.point){t.leaf||(t.point.x+=Math.random()-.5,t.point.y+=Math.random()-.5);var c=e*n[t.point.index];t.charge+=t.pointCharge=c,i+=c*t.point.x,r+=c*t.point.y}t.cx=i/t.charge,t.cy=r/t.charge}function En(){return 20}function Sn(){return 1}function Mn(t){return t.x}function In(t){return t.y}function Dn(t,e,n){t.y0=e,t.y=n}function Pn(t){return d3.range(t.length)}function $n(t){for(var e=-1,n=t[0].length,i=[];n>++e;)i[e]=0;return i}function Nn(t){for(var e,n=1,i=0,r=t[0][1],a=t.length;a>n;++n)(e=t[n][1])>r&&(i=n,r=e);return i}function Gn(t){return t.reduce(On,0)}function On(t,e){return t+e[1]}function Ln(t,e){return Fn(t,Math.ceil(Math.log(e.length)/Math.LN2+1))}function Fn(t,e){for(var n=-1,i=+t[0],r=(t[1]-i)/e,a=[];e>=++n;)a[n]=r*n+i;return a}function Bn(t){return[d3.min(t),d3.max(t)]}function Rn(t,e){return d3.rebind(t,e,"sort","children","value"),t.links=jn,t.nodes=function(e){return Ga=!0,(t.nodes=t)(e)},t}function Hn(t){return t.children}function Un(t){return t.value}function zn(t,e){return e.value-t.value}function jn(t){return d3.merge(t.map(function(t){return(t.children||[]).map(function(e){return{source:t,target:e}})}))}function Wn(t,e){return t.value-e.value}function qn(t,e){var n=t._pack_next;t._pack_next=e,e._pack_prev=t,e._pack_next=n,n._pack_prev=e}function Vn(t,e){t._pack_next=e,e._pack_prev=t}function Yn(t,e){var n=e.x-t.x,i=e.y-t.y,r=t.r+e.r;return r*r-n*n-i*i>.001}function Xn(t){function e(t){s=Math.min(t.x-t.r,s),l=Math.max(t.x+t.r,l),c=Math.min(t.y-t.r,c),u=Math.max(t.y+t.r,u)}var n,i,r,a,o,s=1/0,l=-1/0,c=1/0,u=-1/0,d=t.length;if(t.forEach(Kn),n=t[0],n.x=-n.r,n.y=0,e(n),d>1&&(i=t[1],i.x=i.r,i.y=0,e(i),d>2)){r=t[2],ti(n,i,r),e(r),qn(n,r),n._pack_prev=r,qn(r,i),i=n._pack_next;for(var h=3;d>h;h++){ti(n,i,r=t[h]);var p=0,f=1,g=1;for(a=i._pack_next;a!==i;a=a._pack_next,f++)if(Yn(a,r)){p=1;break}if(1==p)for(o=n._pack_prev;o!==a._pack_prev&&!Yn(o,r);o=o._pack_prev,g++);p?(g>f||f==g&&i.r<n.r?Vn(n,i=a):Vn(n=o,i),h--):(qn(n,r),i=r,e(r))}}for(var m=(s+l)/2,v=(c+u)/2,y=0,h=0;d>h;h++){var b=t[h];b.x-=m,b.y-=v,y=Math.max(y,b.r+Math.sqrt(b.x*b.x+b.y*b.y))}return t.forEach(Zn),y}function Kn(t){t._pack_next=t._pack_prev=t}function Zn(t){delete t._pack_next,delete t._pack_prev}function Qn(t){var e=t.children;e&&e.length?(e.forEach(Qn),t.r=Xn(e)):t.r=Math.sqrt(t.value)}function Jn(t,e,n,i){var r=t.children;if(t.x=e+=i*t.x,t.y=n+=i*t.y,t.r*=i,r)for(var a=-1,o=r.length;o>++a;)Jn(r[a],e,n,i)}function ti(t,e,n){var i=t.r+n.r,r=e.x-t.x,a=e.y-t.y;if(i&&(r||a)){var o=e.r+n.r,s=Math.sqrt(r*r+a*a),l=Math.max(-1,Math.min(1,(i*i+s*s-o*o)/(2*i*s))),c=Math.acos(l),u=l*(i/=s),d=Math.sin(c)*i;n.x=t.x+u*r+d*a,n.y=t.y+u*a-d*r}else n.x=t.x+i,n.y=t.y}function ei(t){return 1+d3.max(t,function(t){return t.y})}function ni(t){return t.reduce(function(t,e){return t+e.x},0)/t.length}function ii(t){var e=t.children;return e&&e.length?ii(e[0]):t}function ri(t){var e,n=t.children;return n&&(e=n.length)?ri(n[e-1]):t}function ai(t,e){return t.parent==e.parent?1:2}function oi(t){var e=t.children;return e&&e.length?e[0]:t._tree.thread}function si(t){var e,n=t.children;return n&&(e=n.length)?n[e-1]:t._tree.thread}function li(t,e){var n=t.children;if(n&&(r=n.length))for(var i,r,a=-1;r>++a;)e(i=li(n[a],e),t)>0&&(t=i);return t}function ci(t,e){return t.x-e.x}function ui(t,e){return e.x-t.x}function di(t,e){return t.depth-e.depth}function hi(t,e){function n(t,i){var r=t.children;if(r&&(o=r.length))for(var a,o,s=null,l=-1;o>++l;)a=r[l],n(a,s),s=a;e(t,i)}n(t,null)}function pi(t){for(var e,n=0,i=0,r=t.children,a=r.length;--a>=0;)e=r[a]._tree,e.prelim+=n,e.mod+=n,n+=e.shift+(i+=e.change)}function fi(t,e,n){t=t._tree,e=e._tree;var i=n/(e.number-t.number);t.change+=i,e.change-=i,e.shift+=n,e.prelim+=n,e.mod+=n}function gi(t,e,n){return t._tree.ancestor.parent==e.parent?t._tree.ancestor:n}function mi(t){return{x:t.x,y:t.y,dx:t.dx,dy:t.dy}}function vi(t,e){var n=t.x+e[3],i=t.y+e[0],r=t.dx-e[1]-e[3],a=t.dy-e[0]-e[2];return 0>r&&(n+=r/2,r=0),0>a&&(i+=a/2,a=0),{x:n,y:i,dx:r,dy:a}}function yi(t){return t.map(bi).join(",")}function bi(t){return/[",\n]/.test(t)?'"'+t.replace(/\"/g,'""')+'"':t}function xi(t,e){return function(n){return n&&t.hasOwnProperty(n.type)?t[n.type](n):e}}function Ti(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function wi(t,e){La.hasOwnProperty(t.type)&&La[t.type](t,e)}function ki(t,e){wi(t.geometry,e)}function Ai(t,e){for(var n=t.features,i=0,r=n.length;r>i;i++)wi(n[i].geometry,e)}function _i(t,e){for(var n=t.geometries,i=0,r=n.length;r>i;i++)wi(n[i],e)}function Ci(t,e){for(var n=t.coordinates,i=0,r=n.length;r>i;i++)e.apply(null,n[i])}function Ei(t,e){for(var n=t.coordinates,i=0,r=n.length;r>i;i++)for(var a=n[i],o=0,s=a.length;s>o;o++)e.apply(null,a[o])}function Si(t,e){for(var n=t.coordinates,i=0,r=n.length;r>i;i++)for(var a=n[i][0],o=0,s=a.length;s>o;o++)e.apply(null,a[o])}function Mi(t,e){e.apply(null,t.coordinates)}function Ii(t,e){for(var n=t.coordinates[0],i=0,r=n.length;r>i;i++)e.apply(null,n[i])}function Di(t){return t.source}function Pi(t){return t.target}function $i(){function t(t){var e=Math.sin(t*=p)*f,n=Math.sin(p-t)*f,i=n*a+e*d,s=n*o+e*h,l=n*r+e*u;return[Math.atan2(s,i)/Oa,Math.atan2(l,Math.sqrt(i*i+s*s))/Oa]}var e,n,i,r,a,o,s,l,c,u,d,h,p,f;return t.distance=function(){return null==p&&(f=1/Math.sin(p=Math.acos(Math.max(-1,Math.min(1,r*u+i*c*Math.cos(s-e)))))),p},t.source=function(s){var l=Math.cos(e=s[0]*Oa),c=Math.sin(e);return i=Math.cos(n=s[1]*Oa),r=Math.sin(n),a=i*l,o=i*c,p=null,t},t.target=function(e){var n=Math.cos(s=e[0]*Oa),i=Math.sin(s);return c=Math.cos(l=e[1]*Oa),u=Math.sin(l),d=c*n,h=c*i,p=null,t},t}function Ni(t,e){var n=$i().source(t).target(e);return n.distance(),n}function Gi(t){for(var e=0,n=0;;){if(t(e,n))return[e,n];0===e?(e=n+1,n=0):(e-=1,n+=1)}}function Oi(t,e,n,i){var r,a,o,s,l,c,u;return r=i[t],a=r[0],o=r[1],r=i[e],s=r[0],l=r[1],r=i[n],c=r[0],u=r[1],(u-o)*(s-a)-(l-o)*(c-a)>0}function Li(t,e,n){return(n[0]-e[0])*(t[1]-e[1])<(n[1]-e[1])*(t[0]-e[0])}function Fi(t,e,n,i){var r=t[0],a=e[0],o=n[0],s=i[0],l=t[1],c=e[1],u=n[1],d=i[1],h=r-o,p=a-r,f=s-o,g=l-u,m=c-l,v=d-u,y=(f*g-v*h)/(v*p-f*m);return[r+y*p,l+y*m]}function Bi(t,e){var n={list:t.map(function(t,e){return{index:e,x:t[0],y:t[1]}}).sort(function(t,e){return t.y<e.y?-1:t.y>e.y?1:t.x<e.x?-1:t.x>e.x?1:0}),bottomSite:null},i={list:[],leftEnd:null,rightEnd:null,init:function(){i.leftEnd=i.createHalfEdge(null,"l"),i.rightEnd=i.createHalfEdge(null,"l"),i.leftEnd.r=i.rightEnd,i.rightEnd.l=i.leftEnd,i.list.unshift(i.leftEnd,i.rightEnd)},createHalfEdge:function(t,e){return{edge:t,side:e,vertex:null,l:null,r:null}},insert:function(t,e){e.l=t,e.r=t.r,t.r.l=e,t.r=e},leftBound:function(t){var e=i.leftEnd;do e=e.r;while(e!=i.rightEnd&&r.rightOf(e,t));return e=e.l},del:function(t){t.l.r=t.r,t.r.l=t.l,t.edge=null},right:function(t){return t.r},left:function(t){return t.l},leftRegion:function(t){return null==t.edge?n.bottomSite:t.edge.region[t.side]},rightRegion:function(t){return null==t.edge?n.bottomSite:t.edge.region[Ra[t.side]]}},r={bisect:function(t,e){var n={region:{l:t,r:e},ep:{l:null,r:null}},i=e.x-t.x,r=e.y-t.y,a=i>0?i:-i,o=r>0?r:-r;return n.c=t.x*i+t.y*r+.5*(i*i+r*r),a>o?(n.a=1,n.b=r/i,n.c/=i):(n.b=1,n.a=i/r,n.c/=r),n},intersect:function(t,e){var n=t.edge,i=e.edge;if(!n||!i||n.region.r==i.region.r)return null;var r=n.a*i.b-n.b*i.a;if(1e-10>Math.abs(r))return null;var a,o,s=(n.c*i.b-i.c*n.b)/r,l=(i.c*n.a-n.c*i.a)/r,c=n.region.r,u=i.region.r;c.y<u.y||c.y==u.y&&c.x<u.x?(a=t,o=n):(a=e,o=i);var d=s>=o.region.r.x;return d&&"l"===a.side||!d&&"r"===a.side?null:{x:s,y:l}},rightOf:function(t,e){var n=t.edge,i=n.region.r,r=e.x>i.x;if(r&&"l"===t.side)return 1;if(!r&&"r"===t.side)return 0;if(1===n.a){var a=e.y-i.y,o=e.x-i.x,s=0,l=0;if(!r&&0>n.b||r&&n.b>=0?l=s=a>=n.b*o:(l=e.x+e.y*n.b>n.c,0>n.b&&(l=!l),l||(s=1)),!s){var c=i.x-n.region.l.x;l=n.b*(o*o-a*a)<c*a*(1+2*o/c+n.b*n.b),0>n.b&&(l=!l)}}else{var u=n.c-n.a*e.x,d=e.y-u,h=e.x-i.x,p=u-i.y;l=d*d>h*h+p*p}return"l"===t.side?l:!l},endPoint:function(t,n,i){t.ep[n]=i,t.ep[Ra[n]]&&e(t)},distance:function(t,e){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}},a={list:[],insert:function(t,e,n){t.vertex=e,t.ystar=e.y+n;for(var i=0,r=a.list,o=r.length;o>i;i++){var s=r[i];if(!(t.ystar>s.ystar||t.ystar==s.ystar&&e.x>s.vertex.x))break}r.splice(i,0,t)},del:function(t){for(var e=0,n=a.list,i=n.length;i>e&&n[e]!=t;++e);n.splice(e,1)},empty:function(){return 0===a.list.length},nextEvent:function(t){for(var e=0,n=a.list,i=n.length;i>e;++e)if(n[e]==t)return n[e+1];return null},min:function(){var t=a.list[0];return{x:t.vertex.x,y:t.ystar}},extractMin:function(){return a.list.shift()}};i.init(),n.bottomSite=n.list.shift();for(var o,s,l,c,u,d,h,p,f,g,m,v,y,b=n.list.shift();;)if(a.empty()||(o=a.min()),b&&(a.empty()||b.y<o.y||b.y==o.y&&b.x<o.x))s=i.leftBound(b),l=i.right(s),h=i.rightRegion(s),v=r.bisect(h,b),d=i.createHalfEdge(v,"l"),i.insert(s,d),g=r.intersect(s,d),g&&(a.del(s),a.insert(s,g,r.distance(g,b))),s=d,d=i.createHalfEdge(v,"r"),i.insert(s,d),g=r.intersect(d,l),g&&a.insert(d,g,r.distance(g,b)),b=n.list.shift();else{if(a.empty())break;s=a.extractMin(),c=i.left(s),l=i.right(s),u=i.right(l),h=i.leftRegion(s),p=i.rightRegion(l),m=s.vertex,r.endPoint(s.edge,s.side,m),r.endPoint(l.edge,l.side,m),i.del(s),a.del(l),i.del(l),y="l",h.y>p.y&&(f=h,h=p,p=f,y="r"),v=r.bisect(h,p),d=i.createHalfEdge(v,y),i.insert(c,d),r.endPoint(v,Ra[y],m),g=r.intersect(c,d),g&&(a.del(c),a.insert(c,g,r.distance(g,h))),g=r.intersect(d,u),g&&a.insert(d,g,r.distance(g,h))}for(s=i.right(i.leftEnd);s!=i.rightEnd;s=i.right(s))e(s.edge)}function Ri(){return{leaf:!0,nodes:[],point:null}}function Hi(t,e,n,i,r,a){if(!t(e,n,i,r,a)){var o=.5*(n+r),s=.5*(i+a),l=e.nodes;l[0]&&Hi(t,l[0],n,i,o,s),l[1]&&Hi(t,l[1],o,i,r,s),l[2]&&Hi(t,l[2],n,s,o,a),l[3]&&Hi(t,l[3],o,s,r,a)}}function Ui(t){return{x:t[0],y:t[1]}}function zi(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function ji(t,e,n,i){for(var r,a,o=0,s=e.length,l=n.length;s>o;){if(i>=l)return-1;if(r=e.charCodeAt(o++),37==r){if(a=Ya[e.charAt(o++)],!a||0>(i=a(t,n,i)))return-1}else if(r!=n.charCodeAt(i++))return-1}return i}function Wi(t,e,n){return Xa.test(e.substring(n,n+=3))?n:-1}function qi(t,e,n){Ka.lastIndex=0;var i=Ka.exec(e.substring(n,n+10));return i?n+=i[0].length:-1}function Vi(t,e,n){var i=Qa.get(e.substring(n,n+=3).toLowerCase());return null==i?-1:(t.m=i,n)}function Yi(t,e,n){Ja.lastIndex=0;var i=Ja.exec(e.substring(n,n+12));return i?(t.m=to.get(i[0].toLowerCase()),n+=i[0].length):-1}function Xi(t,e,n){return ji(t,""+Va.c,e,n)}function Ki(t,e,n){return ji(t,""+Va.x,e,n)}function Zi(t,e,n){return ji(t,""+Va.X,e,n)}function Qi(t,e,n){no.lastIndex=0;var i=no.exec(e.substring(n,n+4));return i?(t.y=+i[0],n+=i[0].length):-1}function Ji(t,e,n){no.lastIndex=0;var i=no.exec(e.substring(n,n+2));return i?(t.y=tr()+ +i[0],n+=i[0].length):-1}function tr(){return 1e3*~~((new Date).getFullYear()/1e3)}function er(t,e,n){no.lastIndex=0;var i=no.exec(e.substring(n,n+2));return i?(t.m=i[0]-1,n+=i[0].length):-1}function nr(t,e,n){no.lastIndex=0;var i=no.exec(e.substring(n,n+2));return i?(t.d=+i[0],n+=i[0].length):-1}function ir(t,e,n){no.lastIndex=0;var i=no.exec(e.substring(n,n+2));return i?(t.H=+i[0],n+=i[0].length):-1}function rr(t,e,n){no.lastIndex=0;var i=no.exec(e.substring(n,n+2));return i?(t.M=+i[0],n+=i[0].length):-1}function ar(t,e,n){no.lastIndex=0;var i=no.exec(e.substring(n,n+2));return i?(t.S=+i[0],n+=i[0].length):-1}function or(t,e,n){no.lastIndex=0;var i=no.exec(e.substring(n,n+3));return i?(t.L=+i[0],n+=i[0].length):-1}function sr(t,e,n){var i=io.get(e.substring(n,n+=2).toLowerCase());return null==i?-1:(t.p=i,n)}function lr(t){var e=t.getTimezoneOffset(),n=e>0?"-":"+",i=~~(Math.abs(e)/60),r=Math.abs(e)%60;return n+za(i)+za(r)}function cr(t){return t.toISOString()}function ur(t,e,n){function i(e){var n=t(e),i=a(n,1);return i-e>e-n?n:i}function r(n){return e(n=t(new Ha(n-1)),1),n}function a(t,n){return e(t=new Ha(+t),n),t}function o(t,i,a){var o=r(t),s=[];if(a>1)for(;i>o;)n(o)%a||s.push(new Date(+o)),e(o,1);else for(;i>o;)s.push(new Date(+o)),e(o,1);return s}function s(t,e,n){try{Ha=zi;var i=new zi;return i._=t,o(i,e,n)}finally{Ha=Date}}t.floor=t,t.round=i,t.ceil=r,t.offset=a,t.range=o;var l=t.utc=dr(t);return l.floor=l,l.round=dr(i),l.ceil=dr(r),l.offset=dr(a),l.range=s,t}function dr(t){return function(e,n){try{Ha=zi;var i=new zi;return i._=e,t(i,n)._}finally{Ha=Date}}}function hr(t,e,n){function i(e){return t(e)}return i.invert=function(e){return fr(t.invert(e))},i.domain=function(e){return arguments.length?(t.domain(e),i):t.domain().map(fr)},i.nice=function(t){var e=pr(i.domain());return i.domain([t.floor(e[0]),t.ceil(e[1])])},i.ticks=function(n,r){var a=pr(i.domain());if("function"!=typeof n){var o=a[1]-a[0],s=o/n,l=d3.bisect(ao,s);if(l==ao.length)return e.year(a,n);if(!l)return t.ticks(n).map(fr);Math.log(s/ao[l-1])<Math.log(ao[l]/s)&&--l,n=e[l],r=n[1],n=n[0].range}return n(a[0],new Date(+a[1]+1),r)},i.tickFormat=function(){return n},i.copy=function(){return hr(t.copy(),e,n)},d3.rebind(i,t,"range","rangeRound","interpolate","clamp")}function pr(t){var e=t[0],n=t[t.length-1];return n>e?[e,n]:[n,e]}function fr(t){return new Date(t)}function gr(t){return function(e){for(var n=t.length-1,i=t[n];!i[1](e);)i=t[--n];return i[0](e)}}function mr(t){var e=new Date(t,0,1);return e.setFullYear(t),e}function vr(t){var e=t.getFullYear(),n=mr(e),i=mr(e+1);return e+(t-n)/(i-n)}function yr(t){var e=new Date(Date.UTC(t,0,1));return e.setUTCFullYear(t),e}function br(t){var e=t.getUTCFullYear(),n=yr(e),i=yr(e+1);return e+(t-n)/(i-n)}Date.now||(Date.now=function(){return+new Date});try{document.createElement("div").style.setProperty("opacity",0,"")}catch(xr){var Tr=CSSStyleDeclaration.prototype,wr=Tr.setProperty;Tr.setProperty=function(t,e,n){wr.call(this,t,e+"",n)}}d3={version:"2.9.6"};var kr=n;try{kr(document.documentElement.childNodes)[0].nodeType}catch(Ar){kr=e}var _r=[].__proto__?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)t[n]=e[n]};d3.map=function(t){var e=new i;for(var n in t)e.set(n,t[n]);return e},t(i,{has:function(t){return Cr+t in this},get:function(t){return this[Cr+t]},set:function(t,e){return this[Cr+t]=e},remove:function(t){return t=Cr+t,t in this&&delete this[t]},keys:function(){var t=[];return this.forEach(function(e){t.push(e)}),t},values:function(){var t=[];return this.forEach(function(e,n){t.push(n)}),t},entries:function(){var t=[];return this.forEach(function(e,n){t.push({key:e,value:n})}),t},forEach:function(t){for(var e in this)e.charCodeAt(0)===Er&&t.call(this,e.substring(1),this[e])}});var Cr="\0",Er=Cr.charCodeAt(0);d3.functor=s,d3.rebind=function(t,e){for(var n,i=1,r=arguments.length;r>++i;)t[n=arguments[i]]=l(t,e,e[n]);return t},d3.ascending=function(t,e){return e>t?-1:t>e?1:t>=e?0:0/0},d3.descending=function(t,e){return t>e?-1:e>t?1:e>=t?0:0/0},d3.mean=function(t,e){var n,i=t.length,r=0,a=-1,o=0;if(1===arguments.length)for(;i>++a;)c(n=t[a])&&(r+=(n-r)/++o);else for(;i>++a;)c(n=e.call(t,t[a],a))&&(r+=(n-r)/++o);return o?r:void 0},d3.median=function(t,e){return arguments.length>1&&(t=t.map(e)),t=t.filter(c),t.length?d3.quantile(t.sort(d3.ascending),.5):void 0},d3.min=function(t,e){var n,i,r=-1,a=t.length;if(1===arguments.length){for(;a>++r&&(null==(n=t[r])||n!=n);)n=void 0;for(;a>++r;)null!=(i=t[r])&&n>i&&(n=i)}else{for(;a>++r&&(null==(n=e.call(t,t[r],r))||n!=n);)n=void 0;for(;a>++r;)null!=(i=e.call(t,t[r],r))&&n>i&&(n=i)}return n},d3.max=function(t,e){var n,i,r=-1,a=t.length;if(1===arguments.length){for(;a>++r&&(null==(n=t[r])||n!=n);)n=void 0;for(;a>++r;)null!=(i=t[r])&&i>n&&(n=i)}else{for(;a>++r&&(null==(n=e.call(t,t[r],r))||n!=n);)n=void 0;for(;a>++r;)null!=(i=e.call(t,t[r],r))&&i>n&&(n=i)}return n},d3.extent=function(t,e){var n,i,r,a=-1,o=t.length;if(1===arguments.length){for(;o>++a&&(null==(n=r=t[a])||n!=n);)n=r=void 0;for(;o>++a;)null!=(i=t[a])&&(n>i&&(n=i),i>r&&(r=i))}else{for(;o>++a&&(null==(n=r=e.call(t,t[a],a))||n!=n);)n=void 0;for(;o>++a;)null!=(i=e.call(t,t[a],a))&&(n>i&&(n=i),i>r&&(r=i))}return[n,r]},d3.random={normal:function(t,e){return 2>arguments.length&&(e=1),1>arguments.length&&(t=0),function(){var n,i,r;do n=2*Math.random()-1,i=2*Math.random()-1,r=n*n+i*i;while(!r||r>1);return t+e*n*Math.sqrt(-2*Math.log(r)/r)}}},d3.sum=function(t,e){var n,i=0,r=t.length,a=-1;if(1===arguments.length)for(;r>++a;)isNaN(n=+t[a])||(i+=n);else for(;r>++a;)isNaN(n=+e.call(t,t[a],a))||(i+=n);return i},d3.quantile=function(t,e){var n=(t.length-1)*e+1,i=Math.floor(n),r=t[i-1],a=n-i;return a?r+a*(t[i]-r):r},d3.transpose=function(t){return d3.zip.apply(d3,t)},d3.zip=function(){if(!(i=arguments.length))return[];for(var t=-1,e=d3.min(arguments,u),n=Array(e);e>++t;)for(var i,r=-1,a=n[t]=Array(i);i>++r;)a[r]=arguments[r][t];return n},d3.bisector=function(t){return{left:function(e,n,i,r){for(3>arguments.length&&(i=0),4>arguments.length&&(r=e.length);r>i;){var a=i+r>>1;n>t.call(e,e[a],a)?i=a+1:r=a}return i},right:function(e,n,i,r){for(3>arguments.length&&(i=0),4>arguments.length&&(r=e.length);r>i;){var a=i+r>>1;t.call(e,e[a],a)>n?r=a:i=a+1}return i}}};var Sr=d3.bisector(function(t){return t});d3.bisectLeft=Sr.left,d3.bisect=d3.bisectRight=Sr.right,d3.first=function(t,e){var n,i=0,r=t.length,a=t[0];for(1===arguments.length&&(e=d3.ascending);r>++i;)e.call(t,a,n=t[i])>0&&(a=n);return a},d3.last=function(t,e){var n,i=0,r=t.length,a=t[0];for(1===arguments.length&&(e=d3.ascending);r>++i;)0>=e.call(t,a,n=t[i])&&(a=n);return a},d3.nest=function(){function t(e,s){if(s>=o.length)return r?r.call(a,e):n?e.sort(n):e;for(var l,c,u,d=-1,h=e.length,p=o[s++],f=new i,g={};h>++d;)(u=f.get(l=p(c=e[d])))?u.push(c):f.set(l,[c]);return f.forEach(function(e){g[e]=t(f.get(e),s)}),g}function e(t,n){if(n>=o.length)return t;var i,r=[],a=s[n++];for(i in t)r.push({key:i,values:e(t[i],n)});return a&&r.sort(function(t,e){return a(t.key,e.key)}),r}var n,r,a={},o=[],s=[];return a.map=function(e){return t(e,0)},a.entries=function(n){return e(t(n,0),0)},a.key=function(t){return o.push(t),a},a.sortKeys=function(t){return s[o.length-1]=t,a},a.sortValues=function(t){return n=t,a},a.rollup=function(t){return r=t,a},a},d3.keys=function(t){var e=[];for(var n in t)e.push(n);return e},d3.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},d3.entries=function(t){var e=[];for(var n in t)e.push({key:n,value:t[n]});return e},d3.permute=function(t,e){for(var n=[],i=-1,r=e.length;r>++i;)n[i]=t[e[i]];return n},d3.merge=function(t){return Array.prototype.concat.apply([],t)},d3.split=function(t,e){var n,i=[],r=[],a=-1,o=t.length;for(2>arguments.length&&(e=d);o>++a;)e.call(r,n=t[a],a)?r=[]:(r.length||i.push(r),r.push(n));return i},d3.range=function(t,e,n){if(3>arguments.length&&(n=1,2>arguments.length&&(e=t,t=0)),1/0===(e-t)/n)throw Error("infinite range");var i,r=[],a=p(Math.abs(n)),o=-1;if(t*=a,e*=a,n*=a,0>n)for(;(i=t+n*++o)>e;)r.push(i/a);else for(;e>(i=t+n*++o);)r.push(i/a);return r},d3.requote=function(t){return t.replace(Mr,"\\$&")};var Mr=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;d3.round=function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)},d3.xhr=function(t,e,n){var i=new XMLHttpRequest;3>arguments.length?(n=e,e=null):e&&i.overrideMimeType&&i.overrideMimeType(e),i.open("GET",t,!0),e&&i.setRequestHeader("Accept",e),i.onreadystatechange=function(){if(4===i.readyState){var t=i.status;n(!t&&i.response||t>=200&&300>t||304===t?i:null)}},i.send(null)},d3.text=function(t,e,n){function i(t){n(t&&t.responseText)}3>arguments.length&&(n=e,e=null),d3.xhr(t,e,i)},d3.json=function(t,e){d3.text(t,"application/json",function(t){e(t?JSON.parse(t):null)})},d3.html=function(t,e){d3.text(t,"text/html",function(t){if(null!=t){var n=document.createRange();n.selectNode(document.body),t=n.createContextualFragment(t)}e(t)})},d3.xml=function(t,e,n){function i(t){n(t&&t.responseXML)}3>arguments.length&&(n=e,e=null),d3.xhr(t,e,i)};var Ir={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};d3.ns={prefix:Ir,qualify:function(t){var e=t.indexOf(":"),n=t;return e>=0&&(n=t.substring(0,e),t=t.substring(e+1)),Ir.hasOwnProperty(n)?{space:Ir[n],local:t}:t}},d3.dispatch=function(){for(var t=new f,e=-1,n=arguments.length;n>++e;)t[arguments[e]]=g(t);return t},f.prototype.on=function(t,e){var n=t.indexOf("."),i="";return n>0&&(i=t.substring(n+1),t=t.substring(0,n)),2>arguments.length?this[t].on(i):this[t].on(i,e)},d3.format=function(t){var e=Dr.exec(t),n=e[1]||" ",i=e[3]||"",r=e[5],a=+e[6],o=e[7],s=e[8],l=e[9],c=1,u="",d=!1;switch(s&&(s=+s.substring(1)),r&&(n="0",o&&(a-=Math.floor((a-1)/4))),l){case"n":o=!0,l="g";break;case"%":c=100,u="%",l="f";break;case"p":c=100,u="%",l="r";break;case"d":d=!0,s=0;break;case"s":c=-1,l="r"}return"r"!=l||s||(l="g"),l=Pr.get(l)||v,function(t){if(d&&t%1)return"";var e=0>t&&(t=-t)?"−":i;if(0>c){var h=d3.formatPrefix(t,s);t=h.scale(t),u=h.symbol}else t*=c;if(t=l(t,s),r){var p=t.length+e.length;a>p&&(t=Array(a-p+1).join(n)+t),o&&(t=y(t)),t=e+t}else{o&&(t=y(t)),t=e+t;var p=t.length;a>p&&(t=Array(a-p+1).join(n)+t)}return t+u}};var Dr=/(?:([^{])?([<>=^]))?([+\- ])?(#)?(0)?([0-9]+)?(,)?(\.[0-9]+)?([a-zA-Z%])?/,Pr=d3.map({g:function(t,e){return t.toPrecision(e)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},r:function(t,e){return d3.round(t,e=m(t,e)).toFixed(Math.max(0,Math.min(20,e)))}}),$r=["y","z","a","f","p","n","μ","m","","k","M","G","T","P","E","Z","Y"].map(b);d3.formatPrefix=function(t,e){var n=0;return t&&(0>t&&(t*=-1),e&&(t=d3.round(t,m(t,e))),n=1+Math.floor(1e-12+Math.log(t)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((0>=n?n+1:n-1)/3)))),$r[8+n/3]};var Nr=A(2),Gr=A(3),Or=function(){return k},Lr=d3.map({linear:Or,poly:A,quad:function(){return Nr},cubic:function(){return Gr},sin:function(){return _},exp:function(){return C},circle:function(){return E},elastic:S,back:M,bounce:function(){return I}}),Fr=d3.map({"in":k,out:T,"in-out":w,"out-in":function(t){return w(T(t))}});d3.ease=function(t){var e=t.indexOf("-"),n=e>=0?t.substring(0,e):t,i=e>=0?t.substring(e+1):"in";return n=Lr.get(n)||Or,i=Fr.get(i)||k,x(i(n.apply(null,Array.prototype.slice.call(arguments,1))))},d3.event=null,d3.interpolate=function(t,e){for(var n,i=d3.interpolators.length;--i>=0&&!(n=d3.interpolators[i](t,e)););return n},d3.interpolateNumber=function(t,e){return e-=t,function(n){return t+e*n}},d3.interpolateRound=function(t,e){return e-=t,function(n){return Math.round(t+e*n)}},d3.interpolateString=function(t,e){var n,i,r,a,o,s=0,l=0,c=[],u=[];for(Br.lastIndex=0,i=0;n=Br.exec(e);++i)n.index&&c.push(e.substring(s,l=n.index)),u.push({i:c.length,x:n[0]}),c.push(null),s=Br.lastIndex;for(e.length>s&&c.push(e.substring(s)),i=0,a=u.length;(n=Br.exec(t))&&a>i;++i)if(o=u[i],o.x==n[0]){if(o.i)if(null==c[o.i+1])for(c[o.i-1]+=o.x,c.splice(o.i,1),r=i+1;a>r;++r)u[r].i--;else for(c[o.i-1]+=o.x+c[o.i+1],c.splice(o.i,2),r=i+1;a>r;++r)u[r].i-=2;else if(null==c[o.i+1])c[o.i]=o.x;else for(c[o.i]=o.x+c[o.i+1],c.splice(o.i+1,1),r=i+1;a>r;++r)u[r].i--;u.splice(i,1),a--,i--}else o.x=d3.interpolateNumber(parseFloat(n[0]),parseFloat(o.x));for(;a>i;)o=u.pop(),null==c[o.i+1]?c[o.i]=o.x:(c[o.i]=o.x+c[o.i+1],c.splice(o.i+1,1)),a--;return 1===c.length?null==c[0]?u[0].x:function(){return e}:function(t){for(i=0;a>i;++i)c[(o=u[i]).i]=o.x(t);return c.join("")}},d3.interpolateTransform=function(t,e){var n,i=[],r=[],a=d3.transform(t),o=d3.transform(e),s=a.translate,l=o.translate,c=a.rotate,u=o.rotate,d=a.skew,h=o.skew,p=a.scale,f=o.scale;return s[0]!=l[0]||s[1]!=l[1]?(i.push("translate(",null,",",null,")"),r.push({i:1,x:d3.interpolateNumber(s[0],l[0])},{i:3,x:d3.interpolateNumber(s[1],l[1])})):l[0]||l[1]?i.push("translate("+l+")"):i.push(""),c!=u?(c-u>180?u+=360:u-c>180&&(c+=360),r.push({i:i.push(i.pop()+"rotate(",null,")")-2,x:d3.interpolateNumber(c,u)})):u&&i.push(i.pop()+"rotate("+u+")"),d!=h?r.push({i:i.push(i.pop()+"skewX(",null,")")-2,x:d3.interpolateNumber(d,h)}):h&&i.push(i.pop()+"skewX("+h+")"),p[0]!=f[0]||p[1]!=f[1]?(n=i.push(i.pop()+"scale(",null,",",null,")"),r.push({i:n-4,x:d3.interpolateNumber(p[0],f[0])},{i:n-2,x:d3.interpolateNumber(p[1],f[1])})):(1!=f[0]||1!=f[1])&&i.push(i.pop()+"scale("+f+")"),n=r.length,function(t){for(var e,a=-1;n>++a;)i[(e=r[a]).i]=e.x(t);return i.join("")}},d3.interpolateRgb=function(t,e){t=d3.rgb(t),e=d3.rgb(e);var n=t.r,i=t.g,r=t.b,a=e.r-n,o=e.g-i,s=e.b-r;return function(t){return"#"+B(Math.round(n+a*t))+B(Math.round(i+o*t))+B(Math.round(r+s*t))}},d3.interpolateHsl=function(t,e){t=d3.hsl(t),e=d3.hsl(e);var n=t.h,i=t.s,r=t.l,a=e.h-n,o=e.s-i,s=e.l-r;return a>180?a-=360:-180>a&&(a+=360),function(t){return""+W(n+a*t,i+o*t,r+s*t)}},d3.interpolateArray=function(t,e){var n,i=[],r=[],a=t.length,o=e.length,s=Math.min(t.length,e.length);for(n=0;s>n;++n)i.push(d3.interpolate(t[n],e[n]));for(;a>n;++n)r[n]=t[n];for(;o>n;++n)r[n]=e[n];return function(t){for(n=0;s>n;++n)r[n]=i[n](t);return r}},d3.interpolateObject=function(t,e){var n,i={},r={};for(n in t)n in e?i[n]=N(n)(t[n],e[n]):r[n]=t[n];for(n in e)n in t||(r[n]=e[n]);return function(t){for(n in i)r[n]=i[n](t);return r}};var Br=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;d3.interpolators=[d3.interpolateObject,function(t,e){return e instanceof Array&&d3.interpolateArray(t,e)},function(t,e){return("string"==typeof t||"string"==typeof e)&&d3.interpolateString(t+"",e+"")},function(t,e){return("string"==typeof e?Rr.has(e)||/^(#|rgb\(|hsl\()/.test(e):e instanceof F||e instanceof j)&&d3.interpolateRgb(t,e)
},function(t,e){return!isNaN(t=+t)&&!isNaN(e=+e)&&d3.interpolateNumber(t,e)}],d3.rgb=function(t,e,n){return 1===arguments.length?t instanceof F?L(t.r,t.g,t.b):R(""+t,L,W):L(~~t,~~e,~~n)},F.prototype.brighter=function(t){t=Math.pow(.7,arguments.length?t:1);var e=this.r,n=this.g,i=this.b,r=30;return e||n||i?(e&&r>e&&(e=r),n&&r>n&&(n=r),i&&r>i&&(i=r),L(Math.min(255,Math.floor(e/t)),Math.min(255,Math.floor(n/t)),Math.min(255,Math.floor(i/t)))):L(r,r,r)},F.prototype.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),L(Math.floor(t*this.r),Math.floor(t*this.g),Math.floor(t*this.b))},F.prototype.hsl=function(){return H(this.r,this.g,this.b)},F.prototype.toString=function(){return"#"+B(this.r)+B(this.g)+B(this.b)};var Rr=d3.map({aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"});Rr.forEach(function(t,e){Rr.set(t,R(e,L,W))}),d3.hsl=function(t,e,n){return 1===arguments.length?t instanceof j?z(t.h,t.s,t.l):R(""+t,H,z):z(+t,+e,+n)},j.prototype.brighter=function(t){return t=Math.pow(.7,arguments.length?t:1),z(this.h,this.s,this.l/t)},j.prototype.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),z(this.h,this.s,t*this.l)},j.prototype.rgb=function(){return W(this.h,this.s,this.l)},j.prototype.toString=function(){return""+this.rgb()};var Hr=function(t,e){return e.querySelector(t)},Ur=function(t,e){return e.querySelectorAll(t)},zr=document.documentElement,jr=zr.matchesSelector||zr.webkitMatchesSelector||zr.mozMatchesSelector||zr.msMatchesSelector||zr.oMatchesSelector,Wr=function(t,e){return jr.call(t,e)};"function"==typeof Sizzle&&(Hr=function(t,e){return Sizzle(t,e)[0]||null},Ur=function(t,e){return Sizzle.uniqueSort(Sizzle(t,e))},Wr=Sizzle.matchesSelector);var qr=[];d3.selection=function(){return Vr},d3.selection.prototype=qr,qr.select=function(t){var e,n,i,r,a=[];"function"!=typeof t&&(t=V(t));for(var o=-1,s=this.length;s>++o;){a.push(e=[]),e.parentNode=(i=this[o]).parentNode;for(var l=-1,c=i.length;c>++l;)(r=i[l])?(e.push(n=t.call(r,r.__data__,l)),n&&"__data__"in r&&(n.__data__=r.__data__)):e.push(null)}return q(a)},qr.selectAll=function(t){var e,n,i=[];"function"!=typeof t&&(t=Y(t));for(var r=-1,a=this.length;a>++r;)for(var o=this[r],s=-1,l=o.length;l>++s;)(n=o[s])&&(i.push(e=kr(t.call(n,n.__data__,s))),e.parentNode=n);return q(i)},qr.attr=function(t,e){function n(){this.removeAttribute(t)}function i(){this.removeAttributeNS(t.space,t.local)}function r(){this.setAttribute(t,e)}function a(){this.setAttributeNS(t.space,t.local,e)}function o(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}function s(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}if(t=d3.ns.qualify(t),2>arguments.length){var l=this.node();return t.local?l.getAttributeNS(t.space,t.local):l.getAttribute(t)}return this.each(null==e?t.local?i:n:"function"==typeof e?t.local?s:o:t.local?a:r)},qr.classed=function(t,e){var n=h(t).split(" "),i=n.length,r=-1;if(arguments.length>1){for(;i>++r;)X.call(this,n[r],e);return this}for(;i>++r;)if(!X.call(this,n[r]))return!1;return!0},qr.style=function(t,e,n){function i(){this.style.removeProperty(t)}function r(){this.style.setProperty(t,e,n)}function a(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}return 3>arguments.length&&(n=""),2>arguments.length?window.getComputedStyle(this.node(),null).getPropertyValue(t):this.each(null==e?i:"function"==typeof e?a:r)},qr.property=function(t,e){function n(){delete this[t]}function i(){this[t]=e}function r(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}return 2>arguments.length?this.node()[t]:this.each(null==e?n:"function"==typeof e?r:i)},qr.text=function(t){return 1>arguments.length?this.node().textContent:this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}:null==t?function(){this.textContent=""}:function(){this.textContent=t})},qr.html=function(t){return 1>arguments.length?this.node().innerHTML:this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}:null==t?function(){this.innerHTML=""}:function(){this.innerHTML=t})},qr.append=function(t){function e(){return this.appendChild(document.createElementNS(this.namespaceURI,t))}function n(){return this.appendChild(document.createElementNS(t.space,t.local))}return t=d3.ns.qualify(t),this.select(t.local?n:e)},qr.insert=function(t,e){function n(){return this.insertBefore(document.createElementNS(this.namespaceURI,t),Hr(e,this))}function i(){return this.insertBefore(document.createElementNS(t.space,t.local),Hr(e,this))}return t=d3.ns.qualify(t),this.select(t.local?i:n)},qr.remove=function(){return this.each(function(){var t=this.parentNode;t&&t.removeChild(this)})},qr.data=function(t,e){function n(t,n){var r,a,o,s=t.length,d=n.length,h=Math.min(s,d),p=Math.max(s,d),f=[],g=[],m=[];if(e){var v,y=new i,b=[],x=n.length;for(r=-1;s>++r;)v=e.call(a=t[r],a.__data__,r),y.has(v)?m[x++]=a:y.set(v,a),b.push(v);for(r=-1;d>++r;)v=e.call(n,o=n[r],r),y.has(v)?(f[r]=a=y.get(v),a.__data__=o,g[r]=m[r]=null):(g[r]=K(o),f[r]=m[r]=null),y.remove(v);for(r=-1;s>++r;)y.has(b[r])&&(m[r]=t[r])}else{for(r=-1;h>++r;)a=t[r],o=n[r],a?(a.__data__=o,f[r]=a,g[r]=m[r]=null):(g[r]=K(o),f[r]=m[r]=null);for(;d>r;++r)g[r]=K(n[r]),f[r]=m[r]=null;for(;p>r;++r)m[r]=t[r],g[r]=f[r]=null}g.update=f,g.parentNode=f.parentNode=m.parentNode=t.parentNode,l.push(g),c.push(f),u.push(m)}var r,a,o=-1,s=this.length;if(!arguments.length){for(t=Array(s=(r=this[0]).length);s>++o;)(a=r[o])&&(t[o]=a.__data__);return t}var l=te([]),c=q([]),u=q([]);if("function"==typeof t)for(;s>++o;)n(r=this[o],t.call(r,r.parentNode.__data__,o));else for(;s>++o;)n(r=this[o],t);return c.enter=function(){return l},c.exit=function(){return u},c},qr.datum=qr.map=function(t){return 1>arguments.length?this.property("__data__"):this.property("__data__",t)},qr.filter=function(t){var e,n,i,r=[];"function"!=typeof t&&(t=Z(t));for(var a=0,o=this.length;o>a;a++){r.push(e=[]),e.parentNode=(n=this[a]).parentNode;for(var s=0,l=n.length;l>s;s++)(i=n[s])&&t.call(i,i.__data__,s)&&e.push(i)}return q(r)},qr.order=function(){for(var t=-1,e=this.length;e>++t;)for(var n,i=this[t],r=i.length-1,a=i[r];--r>=0;)(n=i[r])&&(a&&a!==n.nextSibling&&a.parentNode.insertBefore(n,a),a=n);return this},qr.sort=function(t){t=Q.apply(this,arguments);for(var e=-1,n=this.length;n>++e;)this[e].sort(t);return this.order()},qr.on=function(t,e,n){3>arguments.length&&(n=!1);var i="__on"+t,r=t.indexOf(".");return r>0&&(t=t.substring(0,r)),2>arguments.length?(r=this.node()[i])&&r._:this.each(function(r,a){function o(t){var n=d3.event;d3.event=t;try{e.call(s,s.__data__,a)}finally{d3.event=n}}var s=this,l=s[i];l&&(s.removeEventListener(t,l,l.$),delete s[i]),e&&(s.addEventListener(t,s[i]=o,o.$=n),o._=e)})},qr.each=function(t){return J(this,function(e,n,i){t.call(e,e.__data__,n,i)})},qr.call=function(t){return t.apply(this,(arguments[0]=this,arguments)),this},qr.empty=function(){return!this.node()},qr.node=function(){for(var t=0,e=this.length;e>t;t++)for(var n=this[t],i=0,r=n.length;r>i;i++){var a=n[i];if(a)return a}return null},qr.transition=function(){for(var t,e,n=[],i=-1,r=this.length;r>++i;){n.push(t=[]);for(var a=this[i],o=-1,s=a.length;s>++o;)t.push((e=a[o])?{node:e,delay:na,duration:ia}:null)}return ee(n,Qr||++Zr,Date.now())};var Vr=q([[document]]);Vr[0].parentNode=zr,d3.select=function(t){return"string"==typeof t?Vr.select(t):q([[t]])},d3.selectAll=function(t){return"string"==typeof t?Vr.selectAll(t):q([kr(t)])};var Yr=[];d3.selection.enter=te,d3.selection.enter.prototype=Yr,Yr.append=qr.append,Yr.insert=qr.insert,Yr.empty=qr.empty,Yr.node=qr.node,Yr.select=function(t){for(var e,n,i,r,a,o=[],s=-1,l=this.length;l>++s;){i=(r=this[s]).update,o.push(e=[]),e.parentNode=r.parentNode;for(var c=-1,u=r.length;u>++c;)(a=r[c])?(e.push(i[c]=n=t.call(r.parentNode,a.__data__,c)),n.__data__=a.__data__):e.push(null)}return q(o)};var Xr={},Kr=[],Zr=0,Qr=0,Jr=0,ta=250,ea=d3.ease("cubic-in-out"),na=Jr,ia=ta,ra=ea;Kr.call=qr.call,d3.transition=function(t){return arguments.length?Qr?t.transition():t:Vr.transition()},d3.transition.prototype=Kr,Kr.select=function(t){var e,n,i,r=[];"function"!=typeof t&&(t=V(t));for(var a=-1,o=this.length;o>++a;){r.push(e=[]);for(var s=this[a],l=-1,c=s.length;c>++l;)(i=s[l])&&(n=t.call(i.node,i.node.__data__,l))?("__data__"in i.node&&(n.__data__=i.node.__data__),e.push({node:n,delay:i.delay,duration:i.duration})):e.push(null)}return ee(r,this.id,this.time).ease(this.ease())},Kr.selectAll=function(t){var e,n,i,r=[];"function"!=typeof t&&(t=Y(t));for(var a=-1,o=this.length;o>++a;)for(var s=this[a],l=-1,c=s.length;c>++l;)if(i=s[l]){n=t.call(i.node,i.node.__data__,l),r.push(e=[]);for(var u=-1,d=n.length;d>++u;)e.push({node:n[u],delay:i.delay,duration:i.duration})}return ee(r,this.id,this.time).ease(this.ease())},Kr.attr=function(t,e){return this.attrTween(t,ie(t,e))},Kr.attrTween=function(t,e){function n(t,n){var i=e.call(this,t,n,this.getAttribute(r));return i===Xr?(this.removeAttribute(r),null):i&&function(t){this.setAttribute(r,i(t))}}function i(t,n){var i=e.call(this,t,n,this.getAttributeNS(r.space,r.local));return i===Xr?(this.removeAttributeNS(r.space,r.local),null):i&&function(t){this.setAttributeNS(r.space,r.local,i(t))}}var r=d3.ns.qualify(t);return this.tween("attr."+t,r.local?i:n)},Kr.style=function(t,e,n){return 3>arguments.length&&(n=""),this.styleTween(t,ie(t,e),n)},Kr.styleTween=function(t,e,n){return 3>arguments.length&&(n=""),this.tween("style."+t,function(i,r){var a=e.call(this,i,r,window.getComputedStyle(this,null).getPropertyValue(t));return a===Xr?(this.style.removeProperty(t),null):a&&function(e){this.style.setProperty(t,a(e),n)}})},Kr.text=function(t){return this.tween("text",function(e,n){this.textContent="function"==typeof t?t.call(this,e,n):t})},Kr.remove=function(){return this.each("end.transition",function(){var t;!this.__transition__&&(t=this.parentNode)&&t.removeChild(this)})},Kr.delay=function(t){return J(this,"function"==typeof t?function(e,n,i){e.delay=0|t.call(e=e.node,e.__data__,n,i)}:(t=0|t,function(e){e.delay=t}))},Kr.duration=function(t){return J(this,"function"==typeof t?function(e,n,i){e.duration=Math.max(1,0|t.call(e=e.node,e.__data__,n,i))}:(t=Math.max(1,0|t),function(e){e.duration=t}))},Kr.transition=function(){return this.select(a)};var aa,oa,sa=null;d3.timer=function(t,e,n){var i,r=!1,a=sa;if(3>arguments.length){if(2>arguments.length)e=0;else if(!isFinite(e))return;n=Date.now()}for(;a;){if(a.callback===t){a.then=n,a.delay=e,r=!0;break}i=a,a=a.next}r||(sa={callback:t,then:n,delay:e,next:sa}),aa||(oa=clearTimeout(oa),aa=1,la(ae))},d3.timer.flush=function(){for(var t,e=Date.now(),n=sa;n;)t=e-n.then,n.delay||(n.flush=n.callback(t)),n=n.next;oe()};var la=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,17)};d3.transform=function(t){var e=document.createElementNS(d3.ns.prefix.svg,"g"),n={a:1,b:0,c:0,d:1,e:0,f:0};return(d3.transform=function(t){e.setAttribute("transform",t);var i=e.transform.baseVal.consolidate();return new se(i?i.matrix:n)})(t)},se.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var ca=180/Math.PI;d3.mouse=function(t){return de(t,P())};var ua=/WebKit/.test(navigator.userAgent)?-1:0;d3.touches=function(t,e){return 2>arguments.length&&(e=P().touches),e?kr(e).map(function(e){var n=de(t,e);return n.identifier=e.identifier,n}):[]},d3.scale={},d3.scale.linear=function(){return me([0,1],[0,1],d3.interpolate,!1)},d3.scale.log=function(){return Ae(d3.scale.linear(),_e)};var da=d3.format(".0e");_e.pow=function(t){return Math.pow(10,t)},Ce.pow=function(t){return-Math.pow(10,-t)},d3.scale.pow=function(){return Ee(d3.scale.linear(),1)},d3.scale.sqrt=function(){return d3.scale.pow().exponent(.5)},d3.scale.ordinal=function(){return Me([],{t:"range",x:[]})},d3.scale.category10=function(){return d3.scale.ordinal().range(ha)},d3.scale.category20=function(){return d3.scale.ordinal().range(pa)},d3.scale.category20b=function(){return d3.scale.ordinal().range(fa)},d3.scale.category20c=function(){return d3.scale.ordinal().range(ga)};var ha=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],pa=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],fa=["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"],ga=["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"];d3.scale.quantile=function(){return Ie([],[])},d3.scale.quantize=function(){return De(0,1,[0,1])},d3.scale.identity=function(){return Pe([0,1])},d3.svg={},d3.svg.arc=function(){function t(){var t=e.apply(this,arguments),a=n.apply(this,arguments),o=i.apply(this,arguments)+ma,s=r.apply(this,arguments)+ma,l=(o>s&&(l=o,o=s,s=l),s-o),c=Math.PI>l?"0":"1",u=Math.cos(o),d=Math.sin(o),h=Math.cos(s),p=Math.sin(s);return l>=va?t?"M0,"+a+"A"+a+","+a+" 0 1,1 0,"+-a+"A"+a+","+a+" 0 1,1 0,"+a+"M0,"+t+"A"+t+","+t+" 0 1,0 0,"+-t+"A"+t+","+t+" 0 1,0 0,"+t+"Z":"M0,"+a+"A"+a+","+a+" 0 1,1 0,"+-a+"A"+a+","+a+" 0 1,1 0,"+a+"Z":t?"M"+a*u+","+a*d+"A"+a+","+a+" 0 "+c+",1 "+a*h+","+a*p+"L"+t*h+","+t*p+"A"+t+","+t+" 0 "+c+",0 "+t*u+","+t*d+"Z":"M"+a*u+","+a*d+"A"+a+","+a+" 0 "+c+",1 "+a*h+","+a*p+"L0,0"+"Z"}var e=$e,n=Ne,i=Ge,r=Oe;return t.innerRadius=function(n){return arguments.length?(e=s(n),t):e},t.outerRadius=function(e){return arguments.length?(n=s(e),t):n},t.startAngle=function(e){return arguments.length?(i=s(e),t):i},t.endAngle=function(e){return arguments.length?(r=s(e),t):r},t.centroid=function(){var t=(e.apply(this,arguments)+n.apply(this,arguments))/2,a=(i.apply(this,arguments)+r.apply(this,arguments))/2+ma;return[Math.cos(a)*t,Math.sin(a)*t]},t};var ma=-Math.PI/2,va=2*Math.PI-1e-6;d3.svg.line=function(){return Le(r)};var ya="linear",ba=d3.map({linear:Re,"step-before":He,"step-after":Ue,basis:Ye,"basis-open":Xe,"basis-closed":Ke,bundle:Ze,cardinal:We,"cardinal-open":ze,"cardinal-closed":je,monotone:rn}),xa=[0,2/3,1/3,0],Ta=[0,1/3,2/3,0],wa=[0,1/6,2/3,1/6];d3.svg.line.radial=function(){var t=Le(an);return t.radius=t.x,delete t.x,t.angle=t.y,delete t.y,t},He.reverse=Ue,Ue.reverse=He,d3.svg.area=function(){return on(Object)},d3.svg.area.radial=function(){var t=on(an);return t.radius=t.x,delete t.x,t.innerRadius=t.x0,delete t.x0,t.outerRadius=t.x1,delete t.x1,t.angle=t.y,delete t.y,t.startAngle=t.y0,delete t.y0,t.endAngle=t.y1,delete t.y1,t},d3.svg.chord=function(){function t(t,s){var l=e(this,a,t,s),c=e(this,o,t,s);return"M"+l.p0+i(l.r,l.p1,l.a1-l.a0)+(n(l,c)?r(l.r,l.p1,l.r,l.p0):r(l.r,l.p1,c.r,c.p0)+i(c.r,c.p1,c.a1-c.a0)+r(c.r,c.p1,l.r,l.p0))+"Z"}function e(t,e,n,i){var r=e.call(t,n,i),a=l.call(t,r,i),o=c.call(t,r,i)+ma,s=u.call(t,r,i)+ma;return{r:a,a0:o,a1:s,p0:[a*Math.cos(o),a*Math.sin(o)],p1:[a*Math.cos(s),a*Math.sin(s)]}}function n(t,e){return t.a0==e.a0&&t.a1==e.a1}function i(t,e,n){return"A"+t+","+t+" 0 "+ +(n>Math.PI)+",1 "+e}function r(t,e,n,i){return"Q 0,0 "+i}var a=sn,o=ln,l=cn,c=Ge,u=Oe;return t.radius=function(e){return arguments.length?(l=s(e),t):l},t.source=function(e){return arguments.length?(a=s(e),t):a},t.target=function(e){return arguments.length?(o=s(e),t):o},t.startAngle=function(e){return arguments.length?(c=s(e),t):c},t.endAngle=function(e){return arguments.length?(u=s(e),t):u},t},d3.svg.diagonal=function(){function t(t,r){var a=e.call(this,t,r),o=n.call(this,t,r),s=(a.y+o.y)/2,l=[a,{x:a.x,y:s},{x:o.x,y:s},o];return l=l.map(i),"M"+l[0]+"C"+l[1]+" "+l[2]+" "+l[3]}var e=sn,n=ln,i=un;return t.source=function(n){return arguments.length?(e=s(n),t):e},t.target=function(e){return arguments.length?(n=s(e),t):n},t.projection=function(e){return arguments.length?(i=e,t):i},t},d3.svg.diagonal.radial=function(){var t=d3.svg.diagonal(),e=un,n=t.projection;return t.projection=function(t){return arguments.length?n(dn(e=t)):e},t},d3.svg.mouse=d3.mouse,d3.svg.touches=d3.touches,d3.svg.symbol=function(){function t(t,i){return(ka.get(e.call(this,t,i))||fn)(n.call(this,t,i))}var e=pn,n=hn;return t.type=function(n){return arguments.length?(e=s(n),t):e},t.size=function(e){return arguments.length?(n=s(e),t):n},t};var ka=d3.map({circle:fn,cross:function(t){var e=Math.sqrt(t/5)/2;return"M"+-3*e+","+-e+"H"+-e+"V"+-3*e+"H"+e+"V"+-e+"H"+3*e+"V"+e+"H"+e+"V"+3*e+"H"+-e+"V"+e+"H"+-3*e+"Z"},diamond:function(t){var e=Math.sqrt(t/(2*_a)),n=e*_a;return"M0,"+-e+"L"+n+",0"+" 0,"+e+" "+-n+",0"+"Z"},square:function(t){var e=Math.sqrt(t)/2;return"M"+-e+","+-e+"L"+e+","+-e+" "+e+","+e+" "+-e+","+e+"Z"},"triangle-down":function(t){var e=Math.sqrt(t/Aa),n=e*Aa/2;return"M0,"+n+"L"+e+","+-n+" "+-e+","+-n+"Z"},"triangle-up":function(t){var e=Math.sqrt(t/Aa),n=e*Aa/2;return"M0,"+-n+"L"+e+","+n+" "+-e+","+n+"Z"}});d3.svg.symbolTypes=ka.keys();var Aa=Math.sqrt(3),_a=Math.tan(30*Math.PI/180);d3.svg.axis=function(){function t(t){t.each(function(){var t,d=d3.select(this),h=null==c?n.ticks?n.ticks.apply(n,l):n.domain():c,p=null==e?n.tickFormat?n.tickFormat.apply(n,l):String:e,f=vn(n,h,u),g=d.selectAll(".minor").data(f,String),m=g.enter().insert("line","g").attr("class","tick minor").style("opacity",1e-6),v=d3.transition(g.exit()).style("opacity",1e-6).remove(),y=d3.transition(g).style("opacity",1),b=d.selectAll("g").data(h,String),x=b.enter().insert("g","path").style("opacity",1e-6),T=d3.transition(b.exit()).style("opacity",1e-6).remove(),w=d3.transition(b).style("opacity",1),k=pe(n),A=d.selectAll(".domain").data([0]),_=(A.enter().append("path").attr("class","domain"),d3.transition(A)),C=n.copy(),E=this.__chart__||C;this.__chart__=C,x.append("line").attr("class","tick"),x.append("text");var S=x.select("line"),M=w.select("line"),I=b.select("text").text(p),D=x.select("text"),P=w.select("text");switch(i){case"bottom":t=gn,m.attr("y2",a),y.attr("x2",0).attr("y2",a),S.attr("y2",r),D.attr("y",Math.max(r,0)+s),M.attr("x2",0).attr("y2",r),P.attr("x",0).attr("y",Math.max(r,0)+s),I.attr("dy",".71em").attr("text-anchor","middle"),_.attr("d","M"+k[0]+","+o+"V0H"+k[1]+"V"+o);break;case"top":t=gn,m.attr("y2",-a),y.attr("x2",0).attr("y2",-a),S.attr("y2",-r),D.attr("y",-(Math.max(r,0)+s)),M.attr("x2",0).attr("y2",-r),P.attr("x",0).attr("y",-(Math.max(r,0)+s)),I.attr("dy","0em").attr("text-anchor","middle"),_.attr("d","M"+k[0]+","+-o+"V0H"+k[1]+"V"+-o);break;case"left":t=mn,m.attr("x2",-a),y.attr("x2",-a).attr("y2",0),S.attr("x2",-r),D.attr("x",-(Math.max(r,0)+s)),M.attr("x2",-r).attr("y2",0),P.attr("x",-(Math.max(r,0)+s)).attr("y",0),I.attr("dy",".32em").attr("text-anchor","end"),_.attr("d","M"+-o+","+k[0]+"H0V"+k[1]+"H"+-o);break;case"right":t=mn,m.attr("x2",a),y.attr("x2",a).attr("y2",0),S.attr("x2",r),D.attr("x",Math.max(r,0)+s),M.attr("x2",r).attr("y2",0),P.attr("x",Math.max(r,0)+s).attr("y",0),I.attr("dy",".32em").attr("text-anchor","start"),_.attr("d","M"+o+","+k[0]+"H0V"+k[1]+"H"+o)}if(n.ticks)x.call(t,E),w.call(t,C),T.call(t,C),m.call(t,E),y.call(t,C),v.call(t,C);else{var $=C.rangeBand()/2,N=function(t){return C(t)+$};x.call(t,N),w.call(t,N)}})}var e,n=d3.scale.linear(),i="bottom",r=6,a=6,o=6,s=3,l=[10],c=null,u=0;return t.scale=function(e){return arguments.length?(n=e,t):n},t.orient=function(e){return arguments.length?(i=e,t):i},t.ticks=function(){return arguments.length?(l=arguments,t):l},t.tickValues=function(e){return arguments.length?(c=e,t):c},t.tickFormat=function(n){return arguments.length?(e=n,t):e},t.tickSize=function(e,n){if(!arguments.length)return r;var i=arguments.length-1;return r=+e,a=i>1?+n:r,o=i>0?+arguments[i]:r,t},t.tickPadding=function(e){return arguments.length?(s=+e,t):s},t.tickSubdivide=function(e){return arguments.length?(u=+e,t):u},t},d3.svg.brush=function(){function t(a){a.each(function(){var a,o=d3.select(this),u=o.selectAll(".background").data([0]),d=o.selectAll(".extent").data([0]),h=o.selectAll(".resize").data(c,String);o.style("pointer-events","all").on("mousedown.brush",r).on("touchstart.brush",r),u.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),d.enter().append("rect").attr("class","extent").style("cursor","move"),h.enter().append("g").attr("class",function(t){return"resize "+t}).style("cursor",function(t){return Ca[t]}).append("rect").attr("x",function(t){return/[ew]$/.test(t)?-3:null}).attr("y",function(t){return/^[ns]/.test(t)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),h.style("display",t.empty()?"none":null),h.exit().remove(),s&&(a=pe(s),u.attr("x",a[0]).attr("width",a[1]-a[0]),n(o)),l&&(a=pe(l),u.attr("y",a[0]).attr("height",a[1]-a[0]),i(o)),e(o)})}function e(t){t.selectAll(".resize").attr("transform",function(t){return"translate("+u[+/e$/.test(t)][0]+","+u[+/^s/.test(t)][1]+")"})}function n(t){t.select(".extent").attr("x",u[0][0]),t.selectAll(".extent,.n>rect,.s>rect").attr("width",u[1][0]-u[0][0])}function i(t){t.select(".extent").attr("y",u[0][1]),t.selectAll(".extent,.e>rect,.w>rect").attr("height",u[1][1]-u[0][1])}function r(){function r(){var t=d3.event.changedTouches;return t?d3.touches(v,t)[0]:d3.mouse(v)}function c(){32==d3.event.keyCode&&(A||(g=null,_[0]-=u[1][0],_[1]-=u[1][1],A=2),D())}function d(){32==d3.event.keyCode&&2==A&&(_[0]+=u[1][0],_[1]+=u[1][1],A=0,D())}function h(){var t=r(),a=!1;m&&(t[0]+=m[0],t[1]+=m[1]),A||(d3.event.altKey?(g||(g=[(u[0][0]+u[1][0])/2,(u[0][1]+u[1][1])/2]),_[0]=u[+(t[0]<g[0])][0],_[1]=u[+(t[1]<g[1])][1]):g=null),w&&p(t,s,0)&&(n(x),a=!0),k&&p(t,l,1)&&(i(x),a=!0),a&&(e(x),b({type:"brush",mode:A?"move":"resize"}))}function p(t,e,n){var i,r,o=pe(e),s=o[0],l=o[1],c=_[n],d=u[1][n]-u[0][n];return A&&(s-=c,l-=d+c),i=Math.max(s,Math.min(l,t[n])),A?r=(i+=c)+d:(g&&(c=Math.max(s,Math.min(l,2*g[n]-i))),i>c?(r=i,i=c):r=c),u[0][n]!==i||u[1][n]!==r?(a=null,u[0][n]=i,u[1][n]=r,!0):void 0}function f(){h(),x.style("pointer-events","all").selectAll(".resize").style("display",t.empty()?"none":null),d3.select("body").style("cursor",null),C.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),b({type:"brushend"}),D()}var g,m,v=this,y=d3.select(d3.event.target),b=o.of(v,arguments),x=d3.select(v),T=y.datum(),w=!/^(n|s)$/.test(T)&&s,k=!/^(e|w)$/.test(T)&&l,A=y.classed("extent"),_=r(),C=d3.select(window).on("mousemove.brush",h).on("mouseup.brush",f).on("touchmove.brush",h).on("touchend.brush",f).on("keydown.brush",c).on("keyup.brush",d);if(A)_[0]=u[0][0]-_[0],_[1]=u[0][1]-_[1];else if(T){var E=+/w$/.test(T),S=+/^n/.test(T);m=[u[1-E][0]-_[0],u[1-S][1]-_[1]],_[0]=u[E][0],_[1]=u[S][1]}else d3.event.altKey&&(g=_.slice());x.style("pointer-events","none").selectAll(".resize").style("display",null),d3.select("body").style("cursor",y.style("cursor")),b({type:"brushstart"}),h(),D()}var a,o=$(t,"brushstart","brush","brushend"),s=null,l=null,c=Ea[0],u=[[0,0],[0,0]];return t.x=function(e){return arguments.length?(s=e,c=Ea[!s<<1|!l],t):s},t.y=function(e){return arguments.length?(l=e,c=Ea[!s<<1|!l],t):l},t.extent=function(e){var n,i,r,o,c;return arguments.length?(a=[[0,0],[0,0]],s&&(n=e[0],i=e[1],l&&(n=n[0],i=i[0]),a[0][0]=n,a[1][0]=i,s.invert&&(n=s(n),i=s(i)),n>i&&(c=n,n=i,i=c),u[0][0]=0|n,u[1][0]=0|i),l&&(r=e[0],o=e[1],s&&(r=r[1],o=o[1]),a[0][1]=r,a[1][1]=o,l.invert&&(r=l(r),o=l(o)),r>o&&(c=r,r=o,o=c),u[0][1]=0|r,u[1][1]=0|o),t):(e=a||u,s&&(n=e[0][0],i=e[1][0],a||(n=u[0][0],i=u[1][0],s.invert&&(n=s.invert(n),i=s.invert(i)),n>i&&(c=n,n=i,i=c))),l&&(r=e[0][1],o=e[1][1],a||(r=u[0][1],o=u[1][1],l.invert&&(r=l.invert(r),o=l.invert(o)),r>o&&(c=r,r=o,o=c))),s&&l?[[n,r],[i,o]]:s?[n,i]:l&&[r,o])},t.clear=function(){return a=null,u[0][0]=u[0][1]=u[1][0]=u[1][1]=0,t},t.empty=function(){return s&&u[0][0]===u[1][0]||l&&u[0][1]===u[1][1]},d3.rebind(t,o,"on")};var Ca={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Ea=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];d3.behavior={},d3.behavior.drag=function(){function t(){this.on("mousedown.drag",e).on("touchstart.drag",e)}function e(){function t(){var t=s.parentNode,e=d3.event.changedTouches;return e?d3.touches(t,e)[0]:d3.mouse(t)}function e(){if(!s.parentNode)return r();var e=t(),n=e[0]-u[0],i=e[1]-u[1];d|=n|i,u=e,D(),l({type:"drag",x:e[0]+o[0],y:e[1]+o[1],dx:n,dy:i})}function r(){l({type:"dragend"}),d&&(D(),d3.event.target===c&&h.on("click.drag",a,!0)),h.on("mousemove.drag",null).on("touchmove.drag",null).on("mouseup.drag",null).on("touchend.drag",null)}function a(){D(),h.on("click.drag",null)}var o,s=this,l=n.of(s,arguments),c=d3.event.target,u=t(),d=0,h=d3.select(window).on("mousemove.drag",e).on("touchmove.drag",e).on("mouseup.drag",r,!0).on("touchend.drag",r,!0);i?(o=i.apply(s,arguments),o=[o.x-u[0],o.y-u[1]]):o=[0,0],D(),l({type:"dragstart"})}var n=$(t,"drag","dragstart","dragend"),i=null;return t.origin=function(e){return arguments.length?(i=e,t):i},d3.rebind(t,n,"on")},d3.behavior.zoom=function(){function t(){this.on("mousedown.zoom",o).on("mousewheel.zoom",s).on("mousemove.zoom",l).on("DOMMouseScroll.zoom",s).on("dblclick.zoom",c).on("touchstart.zoom",u).on("touchmove.zoom",d).on("touchend.zoom",u)}function e(t){return[(t[0]-b[0])/x,(t[1]-b[1])/x]}function n(t){return[t[0]*x+b[0],t[1]*x+b[1]]}function i(t){x=Math.max(T[0],Math.min(T[1],t))}function r(t,e){e=n(e),b[0]+=t[0]-e[0],b[1]+=t[1]-e[1]}function a(t){g&&g.domain(f.range().map(function(t){return(t-b[0])/x}).map(f.invert)),v&&v.domain(m.range().map(function(t){return(t-b[1])/x}).map(m.invert)),d3.event.preventDefault(),t({type:"zoom",scale:x,translate:b})}function o(){function t(){c=1,r(d3.mouse(o),d),a(s)}function n(){c&&D(),u.on("mousemove.zoom",null).on("mouseup.zoom",null),c&&d3.event.target===l&&u.on("click.zoom",i,!0)}function i(){D(),u.on("click.zoom",null)}var o=this,s=w.of(o,arguments),l=d3.event.target,c=0,u=d3.select(window).on("mousemove.zoom",t).on("mouseup.zoom",n),d=e(d3.mouse(o));window.focus(),D()}function s(){h||(h=e(d3.mouse(this))),i(Math.pow(2,.002*yn())*x),r(d3.mouse(this),h),a(w.of(this,arguments))}function l(){h=null}function c(){var t=d3.mouse(this),n=e(t);i(d3.event.shiftKey?x/2:2*x),r(t,n),a(w.of(this,arguments))}function u(){var t=d3.touches(this),n=Date.now();if(p=x,h={},t.forEach(function(t){h[t.identifier]=e(t)}),D(),1===t.length&&500>n-y){var o=t[0],s=e(t[0]);i(2*x),r(o,s),a(w.of(this,arguments))}y=n}function d(){var t=d3.touches(this),e=t[0],n=h[e.identifier];if(o=t[1]){var o,s=h[o.identifier];e=[(e[0]+o[0])/2,(e[1]+o[1])/2],n=[(n[0]+s[0])/2,(n[1]+s[1])/2],i(d3.event.scale*p)}r(e,n),a(w.of(this,arguments))}var h,p,f,g,m,v,y,b=[0,0],x=1,T=Ma,w=$(t,"zoom");return t.translate=function(e){return arguments.length?(b=e.map(Number),t):b},t.scale=function(e){return arguments.length?(x=+e,t):x},t.scaleExtent=function(e){return arguments.length?(T=null==e?Ma:e.map(Number),t):T},t.x=function(e){return arguments.length?(g=e,f=e.copy(),t):g},t.y=function(e){return arguments.length?(v=e,m=e.copy(),t):v},d3.rebind(t,w,"on")};var Sa,Ma=[0,1/0];d3.layout={},d3.layout.bundle=function(){return function(t){for(var e=[],n=-1,i=t.length;i>++n;)e.push(bn(t[n]));return e}},d3.layout.chord=function(){function t(){var t,c,d,h,p,f={},g=[],m=d3.range(a),v=[];for(n=[],i=[],t=0,h=-1;a>++h;){for(c=0,p=-1;a>++p;)c+=r[h][p];g.push(c),v.push(d3.range(a)),t+=c}for(o&&m.sort(function(t,e){return o(g[t],g[e])}),s&&v.forEach(function(t,e){t.sort(function(t,n){return s(r[e][t],r[e][n])})}),t=(2*Math.PI-u*a)/t,c=0,h=-1;a>++h;){for(d=c,p=-1;a>++p;){var y=m[h],b=v[y][p],x=r[y][b],T=c,w=c+=x*t;f[y+"-"+b]={index:y,subindex:b,startAngle:T,endAngle:w,value:x}}i[y]={index:y,startAngle:d,endAngle:c,value:(c-d)/t},c+=u}for(h=-1;a>++h;)for(p=h-1;a>++p;){var k=f[h+"-"+p],A=f[p+"-"+h];(k.value||A.value)&&n.push(k.value<A.value?{source:A,target:k}:{source:k,target:A})}l&&e()}function e(){n.sort(function(t,e){return l((t.source.value+t.target.value)/2,(e.source.value+e.target.value)/2)})}var n,i,r,a,o,s,l,c={},u=0;return c.matrix=function(t){return arguments.length?(a=(r=t)&&r.length,n=i=null,c):r},c.padding=function(t){return arguments.length?(u=t,n=i=null,c):u},c.sortGroups=function(t){return arguments.length?(o=t,n=i=null,c):o},c.sortSubgroups=function(t){return arguments.length?(s=t,n=null,c):s},c.sortChords=function(t){return arguments.length?(l=t,n&&e(),c):l},c.chords=function(){return n||t(),n},c.groups=function(){return i||t(),i},c},d3.layout.force=function(){function t(t){return function(e,n,i,r){if(e.point!==t){var a=e.cx-t.x,o=e.cy-t.y,s=1/Math.sqrt(a*a+o*o);if(v>(r-n)*s){var l=e.charge*s*s;
return t.px-=a*l,t.py-=o*l,!0}if(e.point&&isFinite(s)){var l=e.pointCharge*s*s;t.px-=a*l,t.py-=o*l}}return!e.charge}}function e(t){wn(Da=t),Ia=c}var n,i,a,o,l,c={},u=d3.dispatch("start","tick","end"),d=[1,1],h=.9,p=En,f=Sn,g=-30,m=.1,v=.8,y=[],b=[];return c.tick=function(){if(.005>(i*=.99))return u.end({type:"end",alpha:i=0}),!0;var e,n,r,s,c,p,f,v,x,T=y.length,w=b.length;for(n=0;w>n;++n)r=b[n],s=r.source,c=r.target,v=c.x-s.x,x=c.y-s.y,(p=v*v+x*x)&&(p=i*o[n]*((p=Math.sqrt(p))-a[n])/p,v*=p,x*=p,c.x-=v*(f=s.weight/(c.weight+s.weight)),c.y-=x*f,s.x+=v*(f=1-f),s.y+=x*f);if((f=i*m)&&(v=d[0]/2,x=d[1]/2,n=-1,f))for(;T>++n;)r=y[n],r.x+=(v-r.x)*f,r.y+=(x-r.y)*f;if(g)for(Cn(e=d3.geom.quadtree(y),i,l),n=-1;T>++n;)(r=y[n]).fixed||e.visit(t(r));for(n=-1;T>++n;)r=y[n],r.fixed?(r.x=r.px,r.y=r.py):(r.x-=(r.px-(r.px=r.x))*h,r.y-=(r.py-(r.py=r.y))*h);u.tick({type:"tick",alpha:i})},c.nodes=function(t){return arguments.length?(y=t,c):y},c.links=function(t){return arguments.length?(b=t,c):b},c.size=function(t){return arguments.length?(d=t,c):d},c.linkDistance=function(t){return arguments.length?(p=s(t),c):p},c.distance=c.linkDistance,c.linkStrength=function(t){return arguments.length?(f=s(t),c):f},c.friction=function(t){return arguments.length?(h=t,c):h},c.charge=function(t){return arguments.length?(g="function"==typeof t?t:+t,c):g},c.gravity=function(t){return arguments.length?(m=t,c):m},c.theta=function(t){return arguments.length?(v=t,c):v},c.alpha=function(t){return arguments.length?(i?i=t>0?t:0:t>0&&(u.start({type:"start",alpha:i=t}),d3.timer(c.tick)),c):i},c.start=function(){function t(t,i){for(var r,a=e(n),o=-1,s=a.length;s>++o;)if(!isNaN(r=a[o][t]))return r;return Math.random()*i}function e(){if(!r){for(r=[],i=0;u>i;++i)r[i]=[];for(i=0;h>i;++i){var t=b[i];r[t.source.index].push(t.target),r[t.target.index].push(t.source)}}return r[n]}var n,i,r,s,u=y.length,h=b.length,m=d[0],v=d[1];for(n=0;u>n;++n)(s=y[n]).index=n,s.weight=0;for(a=[],o=[],n=0;h>n;++n)s=b[n],"number"==typeof s.source&&(s.source=y[s.source]),"number"==typeof s.target&&(s.target=y[s.target]),a[n]=p.call(this,s,n),o[n]=f.call(this,s,n),++s.source.weight,++s.target.weight;for(n=0;u>n;++n)s=y[n],isNaN(s.x)&&(s.x=t("x",m)),isNaN(s.y)&&(s.y=t("y",v)),isNaN(s.px)&&(s.px=s.x),isNaN(s.py)&&(s.py=s.y);if(l=[],"function"==typeof g)for(n=0;u>n;++n)l[n]=+g.call(this,y[n],n);else for(n=0;u>n;++n)l[n]=g;return c.resume()},c.resume=function(){return c.alpha(.1)},c.stop=function(){return c.alpha(0)},c.drag=function(){n||(n=d3.behavior.drag().origin(r).on("dragstart",e).on("drag",_n).on("dragend",An)),this.on("mouseover.force",wn).on("mouseout.force",kn).call(n)},d3.rebind(c,u,"on")};var Ia,Da;d3.layout.partition=function(){function t(e,n,i,r){var a=e.children;if(e.x=n,e.y=e.depth*r,e.dx=i,e.dy=r,a&&(o=a.length)){var o,s,l,c=-1;for(i=e.value?i/e.value:0;o>++c;)t(s=a[c],n,l=s.value*i,r),n+=l}}function e(t){var n=t.children,i=0;if(n&&(r=n.length))for(var r,a=-1;r>++a;)i=Math.max(i,e(n[a]));return 1+i}function n(n,a){var o=i.call(this,n,a);return t(o[0],0,r[0],r[1]/e(o[0])),o}var i=d3.layout.hierarchy(),r=[1,1];return n.size=function(t){return arguments.length?(r=t,n):r},Rn(n,i)},d3.layout.pie=function(){function t(a){var o=a.map(function(n,i){return+e.call(t,n,i)}),s=+("function"==typeof i?i.apply(this,arguments):i),l=(("function"==typeof r?r.apply(this,arguments):r)-i)/d3.sum(o),c=d3.range(a.length);null!=n&&c.sort(n===Pa?function(t,e){return o[e]-o[t]}:function(t,e){return n(a[t],a[e])});var u=[];return c.forEach(function(t){var e;u[t]={data:a[t],value:e=o[t],startAngle:s,endAngle:s+=e*l}}),u}var e=Number,n=Pa,i=0,r=2*Math.PI;return t.value=function(n){return arguments.length?(e=n,t):e},t.sort=function(e){return arguments.length?(n=e,t):n},t.startAngle=function(e){return arguments.length?(i=e,t):i},t.endAngle=function(e){return arguments.length?(r=e,t):r},t};var Pa={};d3.layout.stack=function(){function t(r,l){var c=r.map(function(n,i){return e.call(t,n,i)}),u=c.map(function(e){return e.map(function(e,n){return[o.call(t,e,n),s.call(t,e,n)]})}),d=n.call(t,u,l);c=d3.permute(c,d),u=d3.permute(u,d);var h,p,f,g=i.call(t,u,l),m=c.length,v=c[0].length;for(p=0;v>p;++p)for(a.call(t,c[0][p],f=g[p],u[0][p][1]),h=1;m>h;++h)a.call(t,c[h][p],f+=u[h-1][p][1],u[h][p][1]);return r}var e=r,n=Pn,i=$n,a=Dn,o=Mn,s=In;return t.values=function(n){return arguments.length?(e=n,t):e},t.order=function(e){return arguments.length?(n="function"==typeof e?e:$a.get(e)||Pn,t):n},t.offset=function(e){return arguments.length?(i="function"==typeof e?e:Na.get(e)||$n,t):i},t.x=function(e){return arguments.length?(o=e,t):o},t.y=function(e){return arguments.length?(s=e,t):s},t.out=function(e){return arguments.length?(a=e,t):a},t};var $a=d3.map({"inside-out":function(t){var e,n,i=t.length,r=t.map(Nn),a=t.map(Gn),o=d3.range(i).sort(function(t,e){return r[t]-r[e]}),s=0,l=0,c=[],u=[];for(e=0;i>e;++e)n=o[e],l>s?(s+=a[n],c.push(n)):(l+=a[n],u.push(n));return u.reverse().concat(c)},reverse:function(t){return d3.range(t.length).reverse()},"default":Pn}),Na=d3.map({silhouette:function(t){var e,n,i,r=t.length,a=t[0].length,o=[],s=0,l=[];for(n=0;a>n;++n){for(e=0,i=0;r>e;e++)i+=t[e][n][1];i>s&&(s=i),o.push(i)}for(n=0;a>n;++n)l[n]=(s-o[n])/2;return l},wiggle:function(t){var e,n,i,r,a,o,s,l,c,u=t.length,d=t[0],h=d.length,p=[];for(p[0]=l=c=0,n=1;h>n;++n){for(e=0,r=0;u>e;++e)r+=t[e][n][1];for(e=0,a=0,s=d[n][0]-d[n-1][0];u>e;++e){for(i=0,o=(t[e][n][1]-t[e][n-1][1])/(2*s);e>i;++i)o+=(t[i][n][1]-t[i][n-1][1])/s;a+=o*t[e][n][1]}p[n]=l-=r?a/r*s:0,c>l&&(c=l)}for(n=0;h>n;++n)p[n]-=c;return p},expand:function(t){var e,n,i,r=t.length,a=t[0].length,o=1/r,s=[];for(n=0;a>n;++n){for(e=0,i=0;r>e;e++)i+=t[e][n][1];if(i)for(e=0;r>e;e++)t[e][n][1]/=i;else for(e=0;r>e;e++)t[e][n][1]=o}for(n=0;a>n;++n)s[n]=0;return s},zero:$n});d3.layout.histogram=function(){function t(t,a){for(var o,s,l=[],c=t.map(n,this),u=i.call(this,c,a),d=r.call(this,u,c,a),a=-1,h=c.length,p=d.length-1,f=e?1:1/h;p>++a;)o=l[a]=[],o.dx=d[a+1]-(o.x=d[a]),o.y=0;if(p>0)for(a=-1;h>++a;)s=c[a],s>=u[0]&&u[1]>=s&&(o=l[d3.bisect(d,s,1,p)-1],o.y+=f,o.push(t[a]));return l}var e=!0,n=Number,i=Bn,r=Ln;return t.value=function(e){return arguments.length?(n=e,t):n},t.range=function(e){return arguments.length?(i=s(e),t):i},t.bins=function(e){return arguments.length?(r="number"==typeof e?function(t){return Fn(t,e)}:s(e),t):r},t.frequency=function(n){return arguments.length?(e=!!n,t):e},t},d3.layout.hierarchy=function(){function t(e,o,s){var l=r.call(n,e,o),c=Ga?e:{data:e};if(c.depth=o,s.push(c),l&&(u=l.length)){for(var u,d,h=-1,p=c.children=[],f=0,g=o+1;u>++h;)d=t(l[h],g,s),d.parent=c,p.push(d),f+=d.value;i&&p.sort(i),a&&(c.value=f)}else a&&(c.value=+a.call(n,e,o)||0);return c}function e(t,i){var r=t.children,o=0;if(r&&(s=r.length))for(var s,l=-1,c=i+1;s>++l;)o+=e(r[l],c);else a&&(o=+a.call(n,Ga?t:t.data,i)||0);return a&&(t.value=o),o}function n(e){var n=[];return t(e,0,n),n}var i=zn,r=Hn,a=Un;return n.sort=function(t){return arguments.length?(i=t,n):i},n.children=function(t){return arguments.length?(r=t,n):r},n.value=function(t){return arguments.length?(a=t,n):a},n.revalue=function(t){return e(t,0),t},n};var Ga=!1;d3.layout.pack=function(){function t(t,i){var r=e.call(this,t,i),a=r[0];a.x=0,a.y=0,Qn(a);var o=n[0],s=n[1],l=1/Math.max(2*a.r/o,2*a.r/s);return Jn(a,o/2,s/2,l),r}var e=d3.layout.hierarchy().sort(Wn),n=[1,1];return t.size=function(e){return arguments.length?(n=e,t):n},Rn(t,e)},d3.layout.cluster=function(){function t(t,r){var a,o=e.call(this,t,r),s=o[0],l=0;hi(s,function(t){var e=t.children;e&&e.length?(t.x=ni(e),t.y=ei(e)):(t.x=a?l+=n(t,a):0,t.y=0,a=t)});var c=ii(s),u=ri(s),d=c.x-n(c,u)/2,h=u.x+n(u,c)/2;return hi(s,function(t){t.x=(t.x-d)/(h-d)*i[0],t.y=(1-(s.y?t.y/s.y:1))*i[1]}),o}var e=d3.layout.hierarchy().sort(null).value(null),n=ai,i=[1,1];return t.separation=function(e){return arguments.length?(n=e,t):n},t.size=function(e){return arguments.length?(i=e,t):i},Rn(t,e)},d3.layout.tree=function(){function t(t,r){function a(t,e){var i=t.children,r=t._tree;if(i&&(o=i.length)){for(var o,l,c,u=i[0],d=u,h=-1;o>++h;)c=i[h],a(c,l),d=s(c,l,d),l=c;pi(t);var p=.5*(u._tree.prelim+c._tree.prelim);e?(r.prelim=e._tree.prelim+n(t,e),r.mod=r.prelim-p):r.prelim=p}else e&&(r.prelim=e._tree.prelim+n(t,e))}function o(t,e){t.x=t._tree.prelim+e;var n=t.children;if(n&&(i=n.length)){var i,r=-1;for(e+=t._tree.mod;i>++r;)o(n[r],e)}}function s(t,e,i){if(e){for(var r,a=t,o=t,s=e,l=t.parent.children[0],c=a._tree.mod,u=o._tree.mod,d=s._tree.mod,h=l._tree.mod;s=si(s),a=oi(a),s&&a;)l=oi(l),o=si(o),o._tree.ancestor=t,r=s._tree.prelim+d-a._tree.prelim-c+n(s,a),r>0&&(fi(gi(s,t,i),t,r),c+=r,u+=r),d+=s._tree.mod,c+=a._tree.mod,h+=l._tree.mod,u+=o._tree.mod;s&&!si(o)&&(o._tree.thread=s,o._tree.mod+=d-u),a&&!oi(l)&&(l._tree.thread=a,l._tree.mod+=c-h,i=t)}return i}var l=e.call(this,t,r),c=l[0];hi(c,function(t,e){t._tree={ancestor:t,prelim:0,mod:0,change:0,shift:0,number:e?e._tree.number+1:0}}),a(c),o(c,-c._tree.prelim);var u=li(c,ui),d=li(c,ci),h=li(c,di),p=u.x-n(u,d)/2,f=d.x+n(d,u)/2,g=h.depth||1;return hi(c,function(t){t.x=(t.x-p)/(f-p)*i[0],t.y=t.depth/g*i[1],delete t._tree}),l}var e=d3.layout.hierarchy().sort(null).value(null),n=ai,i=[1,1];return t.separation=function(e){return arguments.length?(n=e,t):n},t.size=function(e){return arguments.length?(i=e,t):i},Rn(t,e)},d3.layout.treemap=function(){function t(t,e){for(var n,i,r=-1,a=t.length;a>++r;)i=(n=t[r]).value*(0>e?0:e),n.area=isNaN(i)||0>=i?0:i}function e(n){var a=n.children;if(a&&a.length){var o,s,l,c=d(n),u=[],h=a.slice(),p=1/0,f=Math.min(c.dx,c.dy);for(t(h,c.dx*c.dy/n.value),u.area=0;(l=h.length)>0;)u.push(o=h[l-1]),u.area+=o.area,p>=(s=i(u,f))?(h.pop(),p=s):(u.area-=u.pop().area,r(u,f,c,!1),f=Math.min(c.dx,c.dy),u.length=u.area=0,p=1/0);u.length&&(r(u,f,c,!0),u.length=u.area=0),a.forEach(e)}}function n(e){var i=e.children;if(i&&i.length){var a,o=d(e),s=i.slice(),l=[];for(t(s,o.dx*o.dy/e.value),l.area=0;a=s.pop();)l.push(a),l.area+=a.area,null!=a.z&&(r(l,a.z?o.dx:o.dy,o,!s.length),l.length=l.area=0);i.forEach(n)}}function i(t,e){for(var n,i=t.area,r=0,a=1/0,o=-1,s=t.length;s>++o;)(n=t[o].area)&&(a>n&&(a=n),n>r&&(r=n));return i*=i,e*=e,i?Math.max(e*r*p/i,i/(e*a*p)):1/0}function r(t,e,n,i){var r,a=-1,o=t.length,s=n.x,c=n.y,u=e?l(t.area/e):0;if(e==n.dx){for((i||u>n.dy)&&(u=n.dy);o>++a;)r=t[a],r.x=s,r.y=c,r.dy=u,s+=r.dx=Math.min(n.x+n.dx-s,u?l(r.area/u):0);r.z=!0,r.dx+=n.x+n.dx-s,n.y+=u,n.dy-=u}else{for((i||u>n.dx)&&(u=n.dx);o>++a;)r=t[a],r.x=s,r.y=c,r.dx=u,c+=r.dy=Math.min(n.y+n.dy-c,u?l(r.area/u):0);r.z=!1,r.dy+=n.y+n.dy-c,n.x+=u,n.dx-=u}}function a(i){var r=o||s(i),a=r[0];return a.x=0,a.y=0,a.dx=c[0],a.dy=c[1],o&&s.revalue(a),t([a],a.dx*a.dy/a.value),(o?n:e)(a),h&&(o=r),r}var o,s=d3.layout.hierarchy(),l=Math.round,c=[1,1],u=null,d=mi,h=!1,p=.5*(1+Math.sqrt(5));return a.size=function(t){return arguments.length?(c=t,a):c},a.padding=function(t){function e(e){var n=t.call(a,e,e.depth);return null==n?mi(e):vi(e,"number"==typeof n?[n,n,n,n]:n)}function n(e){return vi(e,t)}if(!arguments.length)return u;var i;return d=null==(u=t)?mi:"function"==(i=typeof t)?e:"number"===i?(t=[t,t,t,t],n):n,a},a.round=function(t){return arguments.length?(l=t?Math.round:Number,a):l!=Number},a.sticky=function(t){return arguments.length?(h=t,o=null,a):h},a.ratio=function(t){return arguments.length?(p=t,a):p},Rn(a,s)},d3.csv=function(t,e){d3.text(t,"text/csv",function(t){e(t&&d3.csv.parse(t))})},d3.csv.parse=function(t){var e;return d3.csv.parseRows(t,function(t,n){if(n){for(var i={},r=-1,a=e.length;a>++r;)i[e[r]]=t[r];return i}return e=t,null})},d3.csv.parseRows=function(t,e){function n(){if(l.lastIndex>=t.length)return o;if(r)return r=!1,a;var e=l.lastIndex;if(34===t.charCodeAt(e)){for(var n=e;n++<t.length;)if(34===t.charCodeAt(n)){if(34!==t.charCodeAt(n+1))break;n++}l.lastIndex=n+2;var i=t.charCodeAt(n+1);return 13===i?(r=!0,10===t.charCodeAt(n+2)&&l.lastIndex++):10===i&&(r=!0),t.substring(e+1,n).replace(/""/g,'"')}var s=l.exec(t);return s?(r=44!==s[0].charCodeAt(0),t.substring(e,s.index)):(l.lastIndex=t.length,t.substring(e))}var i,r,a={},o={},s=[],l=/\r\n|[,\r\n]/g,c=0;for(l.lastIndex=0;(i=n())!==o;){for(var u=[];i!==a&&i!==o;)u.push(i),i=n();(!e||(u=e(u,c++)))&&s.push(u)}return s},d3.csv.format=function(t){return t.map(yi).join("\n")},d3.geo={};var Oa=Math.PI/180;d3.geo.azimuthal=function(){function t(t){var e,i=t[0]*Oa-n,c=t[1]*Oa,u=Math.cos(i),d=Math.sin(i),h=Math.cos(c),p=Math.sin(c),f="orthographic"!==o?a*p+r*h*u:null,g="stereographic"===o?1/(1+f):"gnomonic"===o?1/f:"equidistant"===o?(e=Math.acos(f),e?e/Math.sin(e):0):"equalarea"===o?Math.sqrt(2/(1+f)):1,m=g*h*d,v=g*(a*h*u-r*p);return[s*m+l[0],s*v+l[1]]}var e,n,i,r,a,o="orthographic",s=200,l=[480,250];return t.invert=function(t){var e=(t[0]-l[0])/s,i=(t[1]-l[1])/s,c=Math.sqrt(e*e+i*i),u="stereographic"===o?2*Math.atan(c):"gnomonic"===o?Math.atan(c):"equidistant"===o?c:"equalarea"===o?2*Math.asin(.5*c):Math.asin(c),d=Math.sin(u),h=Math.cos(u);return[(n+Math.atan2(e*d,c*r*h+i*a*d))/Oa,Math.asin(h*a-(c?i*d*r/c:0))/Oa]},t.mode=function(e){return arguments.length?(o=e+"",t):o},t.origin=function(o){return arguments.length?(e=o,n=e[0]*Oa,i=e[1]*Oa,r=Math.cos(i),a=Math.sin(i),t):e},t.scale=function(e){return arguments.length?(s=+e,t):s},t.translate=function(e){return arguments.length?(l=[+e[0],+e[1]],t):l},t.origin([0,0])},d3.geo.albers=function(){function t(t){var e=i*(Oa*t[0]-n),o=Math.sqrt(r-2*i*Math.sin(Oa*t[1]))/i;return[l*o*Math.sin(e)+c[0],l*(o*Math.cos(e)-a)+c[1]]}function e(){var e=Oa*s[0],l=Oa*s[1],c=Oa*o[1],u=Math.sin(e),d=Math.cos(e);return n=Oa*o[0],i=.5*(u+Math.sin(l)),r=d*d+2*i*u,a=Math.sqrt(r-2*i*Math.sin(c))/i,t}var n,i,r,a,o=[-98,38],s=[29.5,45.5],l=1e3,c=[480,250];return t.invert=function(t){var e=(t[0]-c[0])/l,o=(t[1]-c[1])/l,s=a+o,u=Math.atan2(e,s),d=Math.sqrt(e*e+s*s);return[(n+u/i)/Oa,Math.asin((r-d*d*i*i)/(2*i))/Oa]},t.origin=function(t){return arguments.length?(o=[+t[0],+t[1]],e()):o},t.parallels=function(t){return arguments.length?(s=[+t[0],+t[1]],e()):s},t.scale=function(e){return arguments.length?(l=+e,t):l},t.translate=function(e){return arguments.length?(c=[+e[0],+e[1]],t):c},e()},d3.geo.albersUsa=function(){function t(t){var a=t[0],o=t[1];return(o>50?n:-140>a?i:21>o?r:e)(t)}var e=d3.geo.albers(),n=d3.geo.albers().origin([-160,60]).parallels([55,65]),i=d3.geo.albers().origin([-160,20]).parallels([8,18]),r=d3.geo.albers().origin([-60,10]).parallels([8,18]);return t.scale=function(a){return arguments.length?(e.scale(a),n.scale(.6*a),i.scale(a),r.scale(1.5*a),t.translate(e.translate())):e.scale()},t.translate=function(a){if(!arguments.length)return e.translate();var o=e.scale()/1e3,s=a[0],l=a[1];return e.translate(a),n.translate([s-400*o,l+170*o]),i.translate([s-190*o,l+200*o]),r.translate([s+580*o,l+430*o]),t},t.scale(e.scale())},d3.geo.bonne=function(){function t(t){var s=t[0]*Oa-e,l=t[1]*Oa-n;if(i){var c=r+i-l,u=s*Math.cos(l)/c;s=c*Math.sin(u),l=c*Math.cos(u)-r}else s*=Math.cos(l),l*=-1;return[a*s+o[0],a*l+o[1]]}var e,n,i,r,a=200,o=[480,250];return t.invert=function(t){var n=(t[0]-o[0])/a,s=(t[1]-o[1])/a;if(i){var l=r+s,c=Math.sqrt(n*n+l*l);s=r+i-c,n=e+c*Math.atan2(n,l)/Math.cos(s)}else s*=-1,n/=Math.cos(s);return[n/Oa,s/Oa]},t.parallel=function(e){return arguments.length?(r=1/Math.tan(i=e*Oa),t):i/Oa},t.origin=function(i){return arguments.length?(e=i[0]*Oa,n=i[1]*Oa,t):[e/Oa,n/Oa]},t.scale=function(e){return arguments.length?(a=+e,t):a},t.translate=function(e){return arguments.length?(o=[+e[0],+e[1]],t):o},t.origin([0,0]).parallel(45)},d3.geo.equirectangular=function(){function t(t){var i=t[0]/360,r=-t[1]/360;return[e*i+n[0],e*r+n[1]]}var e=500,n=[480,250];return t.invert=function(t){var i=(t[0]-n[0])/e,r=(t[1]-n[1])/e;return[360*i,-360*r]},t.scale=function(n){return arguments.length?(e=+n,t):e},t.translate=function(e){return arguments.length?(n=[+e[0],+e[1]],t):n},t},d3.geo.mercator=function(){function t(t){var i=t[0]/360,r=-(Math.log(Math.tan(Math.PI/4+t[1]*Oa/2))/Oa)/360;return[e*i+n[0],e*Math.max(-.5,Math.min(.5,r))+n[1]]}var e=500,n=[480,250];return t.invert=function(t){var i=(t[0]-n[0])/e,r=(t[1]-n[1])/e;return[360*i,2*Math.atan(Math.exp(-360*r*Oa))/Oa-90]},t.scale=function(n){return arguments.length?(e=+n,t):e},t.translate=function(e){return arguments.length?(n=[+e[0],+e[1]],t):n},t},d3.geo.path=function(){function t(t){"function"==typeof a&&(o=Ti(a.apply(this,arguments))),c(t);var e=l.length?l.join(""):null;return l=[],e}function e(t){return s(t).join(",")}function n(t){for(var e=r(t[0]),n=0,i=t.length;i>++n;)e-=r(t[n]);return e}function i(t){for(var e=d3.geom.polygon(t[0].map(s)),n=e.area(),i=e.centroid(0>n?(n*=-1,1):-1),r=i[0],a=i[1],o=n,l=0,c=t.length;c>++l;)e=d3.geom.polygon(t[l].map(s)),n=e.area(),i=e.centroid(0>n?(n*=-1,1):-1),r-=i[0],a-=i[1],o-=n;return[r,a,6*o]}function r(t){return Math.abs(d3.geom.polygon(t.map(s)).area())}var a=4.5,o=Ti(a),s=d3.geo.albersUsa(),l=[],c=xi({FeatureCollection:function(t){for(var e=t.features,n=-1,i=e.length;i>++n;)l.push(c(e[n].geometry))},Feature:function(t){c(t.geometry)},Point:function(t){l.push("M",e(t.coordinates),o)},MultiPoint:function(t){for(var n=t.coordinates,i=-1,r=n.length;r>++i;)l.push("M",e(n[i]),o)},LineString:function(t){var n=t.coordinates,i=-1,r=n.length;for(l.push("M");r>++i;)l.push(e(n[i]),"L");l.pop()},MultiLineString:function(t){for(var n,i,r,a=t.coordinates,o=-1,s=a.length;s>++o;){for(n=a[o],i=-1,r=n.length,l.push("M");r>++i;)l.push(e(n[i]),"L");l.pop()}},Polygon:function(t){for(var n,i,r,a=t.coordinates,o=-1,s=a.length;s>++o;)if(n=a[o],i=-1,(r=n.length-1)>0){for(l.push("M");r>++i;)l.push(e(n[i]),"L");l[l.length-1]="Z"}},MultiPolygon:function(t){for(var n,i,r,a,o,s,c=t.coordinates,u=-1,d=c.length;d>++u;)for(n=c[u],i=-1,r=n.length;r>++i;)if(a=n[i],o=-1,(s=a.length-1)>0){for(l.push("M");s>++o;)l.push(e(a[o]),"L");l[l.length-1]="Z"}},GeometryCollection:function(t){for(var e=t.geometries,n=-1,i=e.length;i>++n;)l.push(c(e[n]))}}),u=t.area=xi({FeatureCollection:function(t){for(var e=0,n=t.features,i=-1,r=n.length;r>++i;)e+=u(n[i]);return e},Feature:function(t){return u(t.geometry)},Polygon:function(t){return n(t.coordinates)},MultiPolygon:function(t){for(var e=0,i=t.coordinates,r=-1,a=i.length;a>++r;)e+=n(i[r]);return e},GeometryCollection:function(t){for(var e=0,n=t.geometries,i=-1,r=n.length;r>++i;)e+=u(n[i]);return e}},0),d=t.centroid=xi({Feature:function(t){return d(t.geometry)},Polygon:function(t){var e=i(t.coordinates);return[e[0]/e[2],e[1]/e[2]]},MultiPolygon:function(t){for(var e,n=t.coordinates,r=0,a=0,o=0,s=-1,l=n.length;l>++s;)e=i(n[s]),r+=e[0],a+=e[1],o+=e[2];return[r/o,a/o]}});return t.projection=function(e){return s=e,t},t.pointRadius=function(e){return"function"==typeof e?a=e:(a=+e,o=Ti(a)),t},t},d3.geo.bounds=function(t){var e=1/0,n=1/0,i=-1/0,r=-1/0;return wi(t,function(t,a){e>t&&(e=t),t>i&&(i=t),n>a&&(n=a),a>r&&(r=a)}),[[e,n],[i,r]]};var La={Feature:ki,FeatureCollection:Ai,GeometryCollection:_i,LineString:Ci,MultiLineString:Ei,MultiPoint:Ci,MultiPolygon:Si,Point:Mi,Polygon:Ii};d3.geo.circle=function(){function t(){}function e(t){return s>l.distance(t)}function n(t){for(var e,n,r,a,o,c=-1,u=t.length,d=[];u>++c;)o=l.distance(r=t[c]),s>o?(n&&d.push(Ni(n,r)((a-s)/(a-o))),d.push(r),e=n=null):(n=r,!e&&d.length&&(d.push(Ni(d[d.length-1],n)((s-a)/(o-a))),e=n)),a=o;return e=t[0],n=d[0],!n||r[0]!==e[0]||r[1]!==e[1]||r[0]===n[0]&&r[1]===n[1]||d.push(n),i(d)}function i(t){for(var e,n,i,r=0,a=t.length,o=a?[t[0]]:t,s=l.source();a>++r;)for(i=l.source(t[r-1])(t[r]).coordinates,e=0,n=i.length;n>++e;)o.push(i[e]);return l.source(s),o}var a=[0,0],o=89.99,s=o*Oa,l=d3.geo.greatArc().source(a).target(r);t.clip=function(t){return"function"==typeof a&&l.source(a.apply(this,arguments)),c(t)||null};var c=xi({FeatureCollection:function(t){var e=t.features.map(c).filter(r);return e&&(t=Object.create(t),t.features=e,t)},Feature:function(t){var e=c(t.geometry);return e&&(t=Object.create(t),t.geometry=e,t)},Point:function(t){return e(t.coordinates)&&t},MultiPoint:function(t){var n=t.coordinates.filter(e);return n.length&&{type:t.type,coordinates:n}},LineString:function(t){var e=n(t.coordinates);return e.length&&(t=Object.create(t),t.coordinates=e,t)},MultiLineString:function(t){var e=t.coordinates.map(n).filter(function(t){return t.length});return e.length&&(t=Object.create(t),t.coordinates=e,t)},Polygon:function(t){var e=t.coordinates.map(n);return e[0].length&&(t=Object.create(t),t.coordinates=e,t)},MultiPolygon:function(t){var e=t.coordinates.map(function(t){return t.map(n)}).filter(function(t){return t[0].length});return e.length&&(t=Object.create(t),t.coordinates=e,t)},GeometryCollection:function(t){var e=t.geometries.map(c).filter(r);return e.length&&(t=Object.create(t),t.geometries=e,t)}});return t.origin=function(e){return arguments.length?(a=e,"function"!=typeof a&&l.source(a),t):a},t.angle=function(e){return arguments.length?(s=(o=+e)*Oa,t):o},d3.rebind(t,l,"precision")},d3.geo.greatArc=function(){function t(){for(var i=t.distance.apply(this,arguments),r=0,s=a/i,l=[e];1>(r+=s);)l.push(o(r));return l.push(n),{type:"LineString",coordinates:l}}var e,n,i=Di,r=Pi,a=6*Oa,o=$i();return t.distance=function(){return"function"==typeof i&&o.source(e=i.apply(this,arguments)),"function"==typeof r&&o.target(n=r.apply(this,arguments)),o.distance()},t.source=function(n){return arguments.length?(i=n,"function"!=typeof i&&o.source(e=i),t):i},t.target=function(e){return arguments.length?(r=e,"function"!=typeof r&&o.target(n=r),t):r},t.precision=function(e){return arguments.length?(a=e*Oa,t):a/Oa},t},d3.geo.greatCircle=d3.geo.circle,d3.geom={},d3.geom.contour=function(t,e){var n=e||Gi(t),i=[],r=n[0],a=n[1],o=0,s=0,l=0/0,c=0/0,u=0;do u=0,t(r-1,a-1)&&(u+=1),t(r,a-1)&&(u+=2),t(r-1,a)&&(u+=4),t(r,a)&&(u+=8),6===u?(o=-1===c?-1:1,s=0):9===u?(o=0,s=1===l?-1:1):(o=Fa[u],s=Ba[u]),o!=l&&s!=c&&(i.push([r,a]),l=o,c=s),r+=o,a+=s;while(n[0]!=r||n[1]!=a);return i};var Fa=[1,0,1,1,-1,0,-1,1,0,0,0,0,-1,0,-1,0/0],Ba=[0,-1,0,0,0,-1,0,0,1,-1,1,1,0,-1,0,0/0];d3.geom.hull=function(t){if(3>t.length)return[];var e,n,i,r,a,o,s,l,c,u,d=t.length,h=d-1,p=[],f=[],g=0;for(e=1;d>e;++e)t[e][1]<t[g][1]?g=e:t[e][1]==t[g][1]&&(g=t[e][0]<t[g][0]?e:g);for(e=0;d>e;++e)e!==g&&(r=t[e][1]-t[g][1],i=t[e][0]-t[g][0],p.push({angle:Math.atan2(r,i),index:e}));for(p.sort(function(t,e){return t.angle-e.angle}),c=p[0].angle,l=p[0].index,s=0,e=1;h>e;++e)n=p[e].index,c==p[e].angle?(i=t[l][0]-t[g][0],r=t[l][1]-t[g][1],a=t[n][0]-t[g][0],o=t[n][1]-t[g][1],i*i+r*r>=a*a+o*o?p[e].index=-1:(p[s].index=-1,c=p[e].angle,s=e,l=n)):(c=p[e].angle,s=e,l=n);for(f.push(g),e=0,n=0;2>e;++n)-1!==p[n].index&&(f.push(p[n].index),e++);for(u=f.length;h>n;++n)if(-1!==p[n].index){for(;!Oi(f[u-2],f[u-1],p[n].index,t);)--u;f[u++]=p[n].index}var m=[];for(e=0;u>e;++e)m.push(t[f[e]]);return m},d3.geom.polygon=function(t){return t.area=function(){for(var e=0,n=t.length,i=t[n-1][0]*t[0][1],r=t[n-1][1]*t[0][0];n>++e;)i+=t[e-1][0]*t[e][1],r+=t[e-1][1]*t[e][0];return.5*(r-i)},t.centroid=function(e){var n,i,r=-1,a=t.length,o=0,s=0,l=t[a-1];for(arguments.length||(e=-1/(6*t.area()));a>++r;)n=l,l=t[r],i=n[0]*l[1]-l[0]*n[1],o+=(n[0]+l[0])*i,s+=(n[1]+l[1])*i;return[o*e,s*e]},t.clip=function(e){for(var n,i,r,a,o,s,l=-1,c=t.length,u=t[c-1];c>++l;){for(n=e.slice(),e.length=0,a=t[l],o=n[(r=n.length)-1],i=-1;r>++i;)s=n[i],Li(s,u,a)?(Li(o,u,a)||e.push(Fi(o,s,u,a)),e.push(s)):Li(o,u,a)&&e.push(Fi(o,s,u,a)),o=s;u=a}return e},t},d3.geom.voronoi=function(t){var e=t.map(function(){return[]});return Bi(t,function(t){var n,i,r,a,o,s;1===t.a&&t.b>=0?(n=t.ep.r,i=t.ep.l):(n=t.ep.l,i=t.ep.r),1===t.a?(o=n?n.y:-1e6,r=t.c-t.b*o,s=i?i.y:1e6,a=t.c-t.b*s):(r=n?n.x:-1e6,o=t.c-t.a*r,a=i?i.x:1e6,s=t.c-t.a*a);var l=[r,o],c=[a,s];e[t.region.l.index].push(l,c),e[t.region.r.index].push(l,c)}),e.map(function(e,n){var i=t[n][0],r=t[n][1];return e.forEach(function(t){t.angle=Math.atan2(t[0]-i,t[1]-r)}),e.sort(function(t,e){return t.angle-e.angle}).filter(function(t,n){return!n||t.angle-e[n-1].angle>1e-10})})};var Ra={l:"r",r:"l"};d3.geom.delaunay=function(t){var e=t.map(function(){return[]}),n=[];return Bi(t,function(n){e[n.region.l.index].push(t[n.region.r.index])}),e.forEach(function(e,i){var r=t[i],a=r[0],o=r[1];e.forEach(function(t){t.angle=Math.atan2(t[0]-a,t[1]-o)}),e.sort(function(t,e){return t.angle-e.angle});for(var s=0,l=e.length-1;l>s;s++)n.push([r,e[s],e[s+1]])}),n},d3.geom.quadtree=function(t,e,n,i,r){function a(t,e,n,i,r,a){if(!isNaN(e.x)&&!isNaN(e.y))if(t.leaf){var s=t.point;s?.01>Math.abs(s.x-e.x)+Math.abs(s.y-e.y)?o(t,e,n,i,r,a):(t.point=null,o(t,s,n,i,r,a),o(t,e,n,i,r,a)):t.point=e}else o(t,e,n,i,r,a)}function o(t,e,n,i,r,o){var s=.5*(n+r),l=.5*(i+o),c=e.x>=s,u=e.y>=l,d=(u<<1)+c;t.leaf=!1,t=t.nodes[d]||(t.nodes[d]=Ri()),c?n=s:r=s,u?i=l:o=l,a(t,e,n,i,r,o)}var s,l=-1,c=t.length;if(c&&isNaN(t[0].x)&&(t=t.map(Ui)),5>arguments.length)if(3===arguments.length)r=i=n,n=e;else{for(e=n=1/0,i=r=-1/0;c>++l;)s=t[l],e>s.x&&(e=s.x),n>s.y&&(n=s.y),s.x>i&&(i=s.x),s.y>r&&(r=s.y);var u=i-e,d=r-n;u>d?r=n+u:i=e+d}var h=Ri();return h.add=function(t){a(h,t,e,n,i,r)},h.visit=function(t){Hi(t,h,e,n,i,r)},t.forEach(h.add),h},d3.time={};var Ha=Date;zi.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){Ua.setUTCDate.apply(this._,arguments)},setDay:function(){Ua.setUTCDay.apply(this._,arguments)},setFullYear:function(){Ua.setUTCFullYear.apply(this._,arguments)},setHours:function(){Ua.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){Ua.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){Ua.setUTCMinutes.apply(this._,arguments)},setMonth:function(){Ua.setUTCMonth.apply(this._,arguments)},setSeconds:function(){Ua.setUTCSeconds.apply(this._,arguments)},setTime:function(){Ua.setTime.apply(this._,arguments)}};var Ua=Date.prototype;d3.time.format=function(t){function e(e){for(var i,r,a=[],o=-1,s=0;n>++o;)37==t.charCodeAt(o)&&(a.push(t.substring(s,o),(r=Va[i=t.charAt(++o)])?r(e):i),s=o+1);return a.push(t.substring(s,o)),a.join("")}var n=t.length;return e.parse=function(e){var n={y:1900,m:0,d:1,H:0,M:0,S:0,L:0},i=ji(n,t,e,0);if(i!=e.length)return null;"p"in n&&(n.H=n.H%12+12*n.p);var r=new Ha;return r.setFullYear(n.y,n.m,n.d),r.setHours(n.H,n.M,n.S,n.L),r},e.toString=function(){return t},e};var za=d3.format("02d"),ja=d3.format("03d"),Wa=d3.format("04d"),qa=d3.format("2d"),Va={a:function(t){return Za[t.getDay()].substring(0,3)},A:function(t){return Za[t.getDay()]},b:function(t){return eo[t.getMonth()].substring(0,3)},B:function(t){return eo[t.getMonth()]},c:d3.time.format("%a %b %e %H:%M:%S %Y"),d:function(t){return za(t.getDate())},e:function(t){return qa(t.getDate())},H:function(t){return za(t.getHours())},I:function(t){return za(t.getHours()%12||12)},j:function(t){return ja(1+d3.time.dayOfYear(t))},L:function(t){return ja(t.getMilliseconds())},m:function(t){return za(t.getMonth()+1)},M:function(t){return za(t.getMinutes())},p:function(t){return t.getHours()>=12?"PM":"AM"},S:function(t){return za(t.getSeconds())},U:function(t){return za(d3.time.sundayOfYear(t))},w:function(t){return t.getDay()},W:function(t){return za(d3.time.mondayOfYear(t))},x:d3.time.format("%m/%d/%y"),X:d3.time.format("%H:%M:%S"),y:function(t){return za(t.getFullYear()%100)},Y:function(t){return Wa(t.getFullYear()%1e4)},Z:lr,"%":function(){return"%"}},Ya={a:Wi,A:qi,b:Vi,B:Yi,c:Xi,d:nr,e:nr,H:ir,I:ir,L:or,m:er,M:rr,p:sr,S:ar,x:Ki,X:Zi,y:Ji,Y:Qi},Xa=/^(?:sun|mon|tue|wed|thu|fri|sat)/i,Ka=/^(?:Sunday|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday)/i,Za=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Qa=d3.map({jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11}),Ja=/^(?:January|February|March|April|May|June|July|August|September|October|November|December)/gi,to=d3.map({january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11}),eo=["January","February","March","April","May","June","July","August","September","October","November","December"],no=/\s*\d+/,io=d3.map({am:0,pm:1});d3.time.format.utc=function(t){function e(t){try{Ha=zi;var e=new Ha;return e._=t,n(e)}finally{Ha=Date}}var n=d3.time.format(t);return e.parse=function(t){try{Ha=zi;var e=n.parse(t);return e&&e._}finally{Ha=Date}},e.toString=n.toString,e};var ro=d3.time.format.utc("%Y-%m-%dT%H:%M:%S.%LZ");d3.time.format.iso=Date.prototype.toISOString?cr:ro,cr.parse=function(t){var e=new Date(t);return isNaN(e)?null:e},cr.toString=ro.toString,d3.time.second=ur(function(t){return new Ha(1e3*Math.floor(t/1e3))},function(t,e){t.setTime(t.getTime()+1e3*Math.floor(e))},function(t){return t.getSeconds()}),d3.time.seconds=d3.time.second.range,d3.time.seconds.utc=d3.time.second.utc.range,d3.time.minute=ur(function(t){return new Ha(6e4*Math.floor(t/6e4))},function(t,e){t.setTime(t.getTime()+6e4*Math.floor(e))},function(t){return t.getMinutes()}),d3.time.minutes=d3.time.minute.range,d3.time.minutes.utc=d3.time.minute.utc.range,d3.time.hour=ur(function(t){var e=t.getTimezoneOffset()/60;return new Ha(36e5*(Math.floor(t/36e5-e)+e))},function(t,e){t.setTime(t.getTime()+36e5*Math.floor(e))},function(t){return t.getHours()}),d3.time.hours=d3.time.hour.range,d3.time.hours.utc=d3.time.hour.utc.range,d3.time.day=ur(function(t){return new Ha(t.getFullYear(),t.getMonth(),t.getDate())},function(t,e){t.setDate(t.getDate()+e)},function(t){return t.getDate()-1}),d3.time.days=d3.time.day.range,d3.time.days.utc=d3.time.day.utc.range,d3.time.dayOfYear=function(t){var e=d3.time.year(t);return Math.floor((t-e)/864e5-(t.getTimezoneOffset()-e.getTimezoneOffset())/1440)},Za.forEach(function(t,e){t=t.toLowerCase(),e=7-e;var n=d3.time[t]=ur(function(t){return(t=d3.time.day(t)).setDate(t.getDate()-(t.getDay()+e)%7),t},function(t,e){t.setDate(t.getDate()+7*Math.floor(e))},function(t){var n=d3.time.year(t).getDay();return Math.floor((d3.time.dayOfYear(t)+(n+e)%7)/7)-(n!==e)});d3.time[t+"s"]=n.range,d3.time[t+"s"].utc=n.utc.range,d3.time[t+"OfYear"]=function(t){var n=d3.time.year(t).getDay();return Math.floor((d3.time.dayOfYear(t)+(n+e)%7)/7)}}),d3.time.week=d3.time.sunday,d3.time.weeks=d3.time.sunday.range,d3.time.weeks.utc=d3.time.sunday.utc.range,d3.time.weekOfYear=d3.time.sundayOfYear,d3.time.month=ur(function(t){return new Ha(t.getFullYear(),t.getMonth(),1)},function(t,e){t.setMonth(t.getMonth()+e)},function(t){return t.getMonth()}),d3.time.months=d3.time.month.range,d3.time.months.utc=d3.time.month.utc.range,d3.time.year=ur(function(t){return new Ha(t.getFullYear(),0,1)},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t){return t.getFullYear()}),d3.time.years=d3.time.year.range,d3.time.years.utc=d3.time.year.utc.range;var ao=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],oo=[[d3.time.second,1],[d3.time.second,5],[d3.time.second,15],[d3.time.second,30],[d3.time.minute,1],[d3.time.minute,5],[d3.time.minute,15],[d3.time.minute,30],[d3.time.hour,1],[d3.time.hour,3],[d3.time.hour,6],[d3.time.hour,12],[d3.time.day,1],[d3.time.day,2],[d3.time.week,1],[d3.time.month,1],[d3.time.month,3],[d3.time.year,1]],so=[[d3.time.format("%Y"),function(){return!0}],[d3.time.format("%B"),function(t){return t.getMonth()}],[d3.time.format("%b %d"),function(t){return 1!=t.getDate()}],[d3.time.format("%a %d"),function(t){return t.getDay()&&1!=t.getDate()}],[d3.time.format("%I %p"),function(t){return t.getHours()}],[d3.time.format("%I:%M"),function(t){return t.getMinutes()}],[d3.time.format(":%S"),function(t){return t.getSeconds()
}],[d3.time.format(".%L"),function(t){return t.getMilliseconds()}]],lo=d3.scale.linear(),co=gr(so);oo.year=function(t,e){return lo.domain(t.map(vr)).ticks(e).map(mr)},d3.time.scale=function(){return hr(d3.scale.linear(),oo,co)};var uo=oo.map(function(t){return[t[0].utc,t[1]]}),ho=[[d3.time.format.utc("%Y"),function(){return!0}],[d3.time.format.utc("%B"),function(t){return t.getUTCMonth()}],[d3.time.format.utc("%b %d"),function(t){return 1!=t.getUTCDate()}],[d3.time.format.utc("%a %d"),function(t){return t.getUTCDay()&&1!=t.getUTCDate()}],[d3.time.format.utc("%I %p"),function(t){return t.getUTCHours()}],[d3.time.format.utc("%I:%M"),function(t){return t.getUTCMinutes()}],[d3.time.format.utc(":%S"),function(t){return t.getUTCSeconds()}],[d3.time.format.utc(".%L"),function(t){return t.getUTCMilliseconds()}]],po=gr(ho);uo.year=function(t,e){return lo.domain(t.map(br)).ticks(e).map(yr)},d3.time.scale.utc=function(){return hr(d3.scale.linear(),uo,po)}}();var TAG=TAG||{},Worktop=Worktop||{};TAG.Util=function(){"use strict";function t(t,e,n){var i,r,a,o=n.center_h||!1,s=n.center_v||!1,l=t,c=e;r=n.max_height?Math.min(n.height*c,n.max_height):n.height*c,a=n.max_width?Math.min(n.width*l,n.max_width):n.width*l;var u,d;return u=o?n.x_max_offset?.5*(l-a)+Math.min(n.x_offset*l,n.x_max_offset):.5*(l-a):n.x_max_offset?n.align_right?l-Math.min(n.x_offset*l,n.x_max_offset)-a:Math.min(n.x_offset*l,n.x_max_offset):n.x_offset*l,d=s?n.y_max_offset?.5*(c-r)+Math.min(n.y_offset*c,n.y_max_offset):.5*(c-r):n.y_max_offset?n.align_bottom?c-Math.min(n.y_offset*c,n.y_max_offset)-r:Math.min(n.y_offset*c,n.y_max_offset):n.y_offset*c,i={height:r,width:a,x:u,y:d}}function e(t,e,i,r){e.val(t),i&&e.focus(function(){e.val()===t&&e.val("").change()}),e.blur(function(){""===e.val()&&(e.val(t).change(),n("",".artButton",r))})}function n(t,e,n){$.each($(e),function(e,r){var a=$(r).data(),o=!1;$.each(a,function(e,r){-1===$.inArray(e,n)&&i(r,t)&&(o=!0)}),a.visible===!1&&(o=!1),o?$(r).show():$(r).hide()})}function i(t,e){return t?-1!==t.toLowerCase().indexOf(e.toLowerCase()):!0}function r(){}function a(){return{_timer:null,_queue:[],add:function(t,e,n){var i=function(t,e){e._timer=setTimeout(function(){t=e.add(),e._queue.length&&i(t,e)},t||2)};if(t)return this._queue.push([t,e,n]),1===this._queue.length&&i(n,this),void 0;var r=this._queue.shift();return r?(r[0].call(r[1]||window),r[2]):0},clear:function(){clearTimeout(this._timer),this._queue=[]}}}function o(t){return t=t.replace("http://",""),t=t.split(":")[0]}function s(t){for(var e=[],n=1;arguments.length>n;n++)e[n-1]=arguments[n];t&&"function"==typeof t&&t.apply(null,e)}function l(t){for(var e=[],n=1;arguments.length>n;n++)e[n-1]=arguments[n];return function(){t&&"function"==typeof t&&t.apply(null,e)}}function c(){var t=arguments;return function(){for(var e=[],n=0;arguments.length>n;n++)e[n]=arguments[n];var i;if(t&&t.length)for(var r=0;t.length>r;r++)i=[t[r]].concat(e),s.apply(null,i)}}function u(t,e){return t&&t.indexOf?-1!==t.indexOf(e):!1}function d(t,e){for(var n=h(t),i=0;n.length>i;i++)if(n[i].childNodes[0].textContent===e){var r=n[i].childNodes[1].childNodes[0];return r?r:(n[i].childNodes[1].appendChild(t.createTextNode("")),n[i].childNodes[1].childNodes[0])}return null}function h(t){return t.getElementsByTagName("Metadata")[0].childNodes[0].childNodes[0].childNodes[1].childNodes[0].childNodes}function p(t){var e=document.createElement("div");return e.innerText=e.textContent=t,t=e.innerHTML}function f(t){return t?t.replace(/\n/g,"<br>").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\'/g,"&apos;").replace(/\"/g,"&quot;"):""}function g(t,e,n){var i=setInterval(function(){S($(t))&&($(t).fitText(e,n),clearInterval(i))})}function m(t){var e=$(t),n=e.attr("src"),i=e.attr("id"),r=e.attr("class"),a=e.attr("style");$.get(n,function(t){var n=$(t).find("svg");return i!==void 0&&(n=n.attr("id",i)),r!==void 0&&(n=n.attr("class",r)),a!==void 0&&(n=n.attr("style",a)),n=n.removeAttr("xmlns:a"),e.replaceWith(n),e})}function v(t,e,n,i){var r={position:"absolute","z-index":"50",height:"auto",width:"10%",left:"50%",top:"50%"};(n||i)&&(r.top=n,r.left=i);var a="0px",o="0px";e&&(r.width=e);var s=$(t).css("background-color"),l=s.substring(s.indexOf("(")+1,s.lastIndexOf(")")).split(/, \s*/),c="rgba("+l[0]+","+l[1]+","+l[2]+","+"0.5)";t.css({"background-color":c}),x($(t),r,a,o,!1)}function y(t){var e=$(t).css("background-color"),n=e.substring(e.indexOf("(")+1,e.lastIndexOf(")")).split(/, \s*/),i="rgba("+n[0]+","+n[1]+","+n[2]+","+"1)";t.css({"background-color":i});var r=t.find(".progressCircle");b(r)}function b(t){t.remove(),t=null}function x(t,e,n,i,r){var a=$(document.createElement("img"));return a.addClass("progressCircle"),t.append(a),a.attr("src",tagPath+"images/icons/progress-circle.gif"),a.css(e||{position:"absolute",left:"5%","z-index":"50",height:"auto",bottom:"10%",width:"10%"}),r&&a.css({top:i-.5*a.height(),left:n-.5*a.width()}),a}function T(t){return t*(window.innerWidth/1920)+"%"}function w(t){var e,n=t.childNodes;for(e in n)n[e].__data__=t.__data__,w(n[e])}function k(t){var e=t.split("."),n=window,i="",r=0;"TAG"===e[0]?(TAG=TAG||{},n=TAG,r=1):"Worktop"===e[0]&&(Worktop=Worktop||{},n=Worktop,r=1);for(var a=r,o=e.length;o>a;a++)i=e[a],n[i]=n[i]||{},n=n[i];return n}function A(t,e){return $.extend({},e,t)}function _(t,e,n,i,r){if(console.log("getting max font size....."),t){var a=$(document.createElement("div")),o=$("#tagRoot");r=r||.1;var s=e;if(a.css({position:"absolute",visibility:"hidden","font-size":e+"em",height:"auto",width:"auto"}),a.text(t),o.append(a),a.width()>=n||a.height()>=i)return e+"em";for(;n>a.width()&&i>a.height();)s+=r,a.css("font-size",s+"em");return a.remove(),s+"em"}}function C(){var t=new Windows.UI.Input.GestureRecognizer;return t.gestureSettings=Windows.UI.Input.GestureSettings.manipulationRotate|Windows.UI.Input.GestureSettings.manipulationTranslateX|Windows.UI.Input.GestureSettings.manipulationTranslateY|Windows.UI.Input.GestureSettings.manipulationScale|Windows.UI.Input.GestureSettings.manipulationRotateInertia|Windows.UI.Input.GestureSettings.manipulationScaleInertia|Windows.UI.Input.GestureSettings.manipulationTranslateInertia|Windows.UI.Input.GestureSettings.hold|Windows.UI.Input.GestureSettings.holdWithMouse|Windows.UI.Input.GestureSettings.rightTap|Windows.UI.Input.GestureSettings.tap,t}function E(t){var e=new XMLHttpRequest;e.open("GET",t,!1),e.send(null);return e}function S(t){for(t=$(t)[0];t;){if(t===document)return!0;t=t.parentNode}return!1}function M(t){t.attr("ondragstart","return false")}function I(t,e){return{_minComp:t,_maxComp:e,_maxheap:new binaryHeap(e),_minheap:new binaryHeap(t),add:function(t){return this._maxheap.push(t),this._minheap.push(t),t},getMin:function(){return this._minheap.peek()},getMax:function(){return this._maxheap.peek()},removeMin:function(){return this._minheap.pop()},removeMax:function(){return this._maxheap.pop()},remove:function(t){this._maxheap.remove(t),this._minheap.remove(t)},size:function(){return this._maxheap.size()},clear:function(){this._maxheap=new binaryHeap(this._maxComp),this._minheap=new binaryHeap(this._minComp)},find:function(t){return this._maxheap.find(t)}}}function D(t,e,n,i){function r(t){var n;if(t.gesture){d(t,!0);var r={x:t.gesture.center.pageX-x.offset().left,y:t.gesture.center.pageY-x.offset().top},a=t.gesture.rotation;n=T.x||0===T.x?{x:t.gesture.center.pageX-T.x,y:t.gesture.center.pageY-T.y}:{x:t.gesture.deltaX,y:t.gesture.deltaY};var o=t.gesture.scale-k;k=t.gesture.scale,T.x=t.gesture.center.pageX,T.y=t.gesture.center.pageY,f=t,"function"==typeof e.onManipulate&&e.onManipulate({pivot:r,translation:n,rotation:a,scale:1+o,target:t.gesture.target,touches:t.gesture.touches,pointerType:t.gesture.pointerType,center:t.gesture.center,deltaTime:t.gesture.deltaTime,deltaX:t.gesture.deltaX,deltaY:t.gesture.deltaY,velocityX:t.gesture.velocityX,velocityY:t.gesture.velocityY,angle:t.gesture.angle,direction:t.gesture.direction,distance:t.gesture.distance,eventType:t.gesture.eventType,srcEvent:t.gesture.srcEvent,startEvent:t.gesture.startEvent},t)}else{d(t,!0);var r={x:t.pageX-x.offset().left,y:t.pageY-x.offset().top};n={x:t.pageX-T.x,y:t.pageY-T.y},console.log("translation.y = "+n.y);var o=t.gesture.scale-k;k=t.gesture.scale,T.x=t.pageX,T.y=t.pageY,f=t,"function"==typeof e.onManipulate&&e.onManipulate({pivot:r,translation:n,rotation:a,scale:1+o,target:t.gesture.target,touches:t.gesture.touches,pointerType:t.gesture.pointerType,center:t.gesture.center,deltaTime:t.gesture.deltaTime,deltaX:t.gesture.deltaX,deltaY:t.gesture.deltaY,velocityX:t.gesture.velocityX,velocityY:t.gesture.velocityY,angle:t.gesture.angle,direction:t.gesture.direction,distance:t.gesture.distance,eventType:t.gesture.eventType,srcEvent:t.gesture.srcEvent,startEvent:t.gesture.startEvent},t),clearTimeout(g),g=setTimeout(function(){var e=d(t);"mouse"===t.gesture.pointerType||i||l(30*e.vx,30*e.vy,null,w)},5)}}function a(t){var n,i={x:t.gesture.center.pageX-x.offset().left,y:t.gesture.center.pageY-x.offset().top},r=t.gesture.scale-k,a=t.gesture.rotation;n=T.x||0===T.x?{x:t.gesture.center.pageX-T.x,y:t.gesture.center.pageY-T.y}:{x:0,y:0},T.x=t.gesture.center.pageX,T.y=t.gesture.center.pageY,d(t,!0),r!==k&&"function"==typeof e.onScroll&&e.onScroll(1+r,i),"function"==typeof e.onManipulate&&e.onManipulate({pivot:i,translation:n,rotation:a,target:t.gesture.target,touches:t.gesture.touches,pointerType:t.gesture.pointerType,center:t.gesture.center,deltaTime:t.gesture.deltaTime,deltaX:t.gesture.deltaX,deltaY:t.gesture.deltaY,velocityX:t.gesture.velocityX,velocityY:t.gesture.velocityY,angle:t.gesture.angle,direction:t.gesture.direction,distance:t.gesture.distance,eventType:t.gesture.eventType,srcEvent:t.gesture.srcEvent,startEvent:t.gesture.startEvent,scale:1},t),k=t.gesture.scale}function o(t){k=1,b=!0,m=t.gesture.center,f=null,y=t.srcElement,w++,u(),clearTimeout(g),r(t)}function s(t){r(t)}function l(t,n,i,r){if(f&&w===r&&!(4>=Math.abs(t)&&4>=Math.abs(n))){var a=x.offset();i=i||5;var o={x:f.gesture.center.pageX-a.left,y:f.gesture.center.pageY-a.top},s=0,c={x:t,y:n},u=1;"function"==typeof e.onManipulate&&e.onManipulate({pivot:o,translation:c,rotation:s,scale:u},f),g=setTimeout(function(){l(.95*t,.95*n,i,r)},i),g=window.requestAnimationFrame(l(.95*t,.95*n,i,r),x)}}function c(t){b=!1,T={};var n=d(t);"mouse"!==t.gesture.pointerType||i||l(30*n.vx,30*n.vy,null,w),"function"==typeof e.onRelease&&e.onRelease(t)}function u(){A=null,_=null,C=0,E=0,S=null}function d(t,e){if(A)t.gesture.deltaX>S.gesture.deltaX&&1!==A.currentDir?(A=t,A.currentDir=1):t.gesture.deltaX<S.gesture.deltaX&&-1!==A.currentDir&&(A=t,A.currentDir=-1);else if(A=t,A.currentDir=A.gesture.deltaX/Math.abs(A.gesture.deltaX)||0,!S)return S=t,{vx:0,vy:0};return _?t.gesture.deltaY>S.gesture.deltaY&&1!==_.currentDir?(_=t,_.currentDir=1):t.gesture.deltaY<S.gesture.deltaY&&-1!==_.currentDir&&(_=t,_.currentDir=-1):(_=t,_.currentDir=_.gesture.deltaY/Math.abs(_.gesture.deltaY)||0),S=t,e?void 0:{vx:(t.gesture.deltaX-A.gesture.deltaX)/(t.gesture.timeStamp-A.gesture.timeStamp)||0,vy:(t.gesture.deltaY-_.gesture.deltaY)/(t.gesture.timeStamp-_.gesture.timeStamp)||0}}function h(t){var n={x:t.clientX-x.offset().left,y:t.clientY-x.offset().top};console.log(t.detail);var i=-t.detail;i=0>i?1/1.1:1.1,console.log("delta processed "+i),t.cancelBubble=!0,"function"==typeof e.onScroll&&e.onScroll(i,n)}function p(t){var n={x:t.x-x.offset().left,y:t.y-x.offset().top},i=t.wheelDelta;i=0>t.wheelDelta?1/1.1:1.1,t.cancelBubble=!0,"function"==typeof e.onScroll&&e.onScroll(i,n)}var f,g,m,v=new Hammer(t,{hold_threshold:3,drag_min_distance:9,drag_max_touches:10,hold_timeout:600,tap_max_distance:15,doubletap_distance:17,doubletap_interval:200,swipe:!1}),y=null,b=!1,x=$(t),T={},w=0,k=1;(function(){for(var t=0,e=["ms","moz","webkit","o"],n=0;e.length>n&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var n=Date.now(),i=Math.max(0,16-(n-t)),r=window.setTimeout(function(){e(n+i)},i);return t=n+i,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})})();var A,_,C,E,S;v.on("touch",o),v.on("drag",function(t){s(t)}),v.on("pinch",a),v.on("release",c),t.onmousewheel=p,t.addEventListener("DOMMouseScroll",h);var M,I;"function"==typeof e.onDoubleTapped&&(M=function(n){n.gesture.srcEvent.button>0||2==n.gesture.srcEvent.buttons||(I={},I.position={},I.position.x=n.gesture.center.pageX-$(t).offset().left,I.position.y=n.gesture.center.pageY-$(t).offset().top,e.onDoubleTapped(I))},v.on("doubletap",M));var D=null;"function"==typeof e.onTapped&&(D=function(n){return n.gesture.srcEvent.button>0?(n.stopPropagation(),I={},I.gesture=n.gesture,I.position={},I.position.x=n.gesture.center.pageX-$(t).offset().left,I.position.y=n.gesture.center.pageY-$(t).offset().top,e.onTappedRight&&e.onTappedRight(I),void 0):(I={},I.position={},I.button=n.button,I.gesture=n.gesture,I.position.x=n.gesture.center.pageX-$(t).offset().left,I.position.y=n.gesture.center.pageY-$(t).offset().top,e.onTapped(I),void 0)},v.on("tap",D));var P=null;"function"==typeof e.onRelease&&(P=function(n){I={},I.position={},I.position.x=n.gesture.center.pageX-$(t).offset().left,I.position.y=n.gesture.center.pageY-$(t).offset().top,e.onRelease(I)},v.on("release",P));var N=null,G=null,O=!1;return"function"==typeof e.onTappedRight&&(N=function(t){t.stopPropagation(),O=!0,I={},I.gesture=t.gesture,I.position={},I.position.x=t.gesture.center.pageX-x.offset().left,I.position.y=t.gesture.center.pageY-x.offset().top,e.onTappedRight(I)},G=function(t){t.stopPropagation(),I={},I.button=t.button,I.gesture=t.gesture,I.position={},I.position.x=t.pageX-x.offset().left,I.position.y=t.pageY-x.offset().top,e.onTappedRight(I)},t.addEventListener("MSPointerDown",function(t){return console.log(t),O?(console.log("STOPPING CLICK"),t.stopPropagation(),setTimeout(function(){O=!1},1),void 0):void 0},!0),t.addEventListener("mouseup",function(t){return console.log("CLICK"),O?(console.log("STOPPING CLICK"),t.stopPropagation(),setTimeout(function(){O=!1},1),void 0):(2===t.button&&G(t),void 0)},!0),v.on("hold",N)),{cancelAccel:function(){w++,clearTimeout(g)}}}function P(t,e,n){function i(t){if(t.delta){var n={x:t.position.x,y:t.position.y},i=t.delta.rotation/180*Math.PI,r={x:t.delta.translation.x,y:t.delta.translation.y},a=t.delta.scale;"function"==typeof e.onManipulate&&e.onManipulate({pivot:n,translation:r,rotation:i,target:t.gesture.target,touches:t.gesture.touches,pointerType:t.gesture.pointerType,center:t.gesture.center,deltaTime:t.gesture.deltaTime,deltaX:t.gesture.deltaX,deltaY:t.gesture.deltaY,velocityX:t.gesture.velocityX,velocityY:t.gesture.velocityY,angle:t.gesture.angle,direction:t.gesture.direction,distance:t.gesture.distance,eventType:t.gesture.eventType,srcEvent:t.gesture.srcEvent,startEvent:t.gesture.startEvent,scale:a})}}function r(e){d=e.srcElement;var n=e.currentPoint;try{h.processDownEvent(n),t.msSetPointerCapture(e.pointerId),e.cancelBubble=!0}catch(i){i.message}}function a(e){if(!n||!(0>e.x||0>e.y||e.x>$(t).width()||e.y>$(t).height())){var i=e.intermediatePoints;try{h.processMoveEvents(i)}catch(r){r.message}}}function o(t){var e=t.currentPoint;try{h.processUpEvent(e)}catch(n){n.message}}function s(t){var n={x:t.x,y:t.y},i=t.wheelDelta;i=0>t.wheelDelta?1/1.1:1.1,t.cancelBubble=!0,"function"==typeof e.onScroll&&e.onScroll(i,n)}function l(t){p=!0,i(t)}function c(t){i(t)}function u(t){p=!1,i(t)}var d=null,h=TAG.Util.getGestureRecognizer(),p=!1;t.addEventListener("MSPointerDown",r,!1),t.addEventListener("MSPointerMove",a,!1),t.addEventListener("MSPointerUp",o,!1),t.onmousewheel=s,h.addEventListener("manipulationstarted",l),h.addEventListener("manipulationupdated",c),h.addEventListener("manipulationcompleted",u);var f=null;"function"==typeof e.onTapped&&(f=function(n){var i={};i.position={},i.position.x=50>n.position.x?$(d).offset().left-$(t).offset().left+n.position.x:n.position.x,i.position.y=$(d).offset().top-$(t).offset().top+n.position.y,e.onTapped(i)},h.addEventListener("tapped",f));var g=null;return"function"==typeof e.onTappedRight&&(rightTapHandler=function(t){var n={};n.position={},n.position.x=t.position.x,n.position.y=t.position.y,e.onTappedRight(n)},h.addEventListener("righttapped",g)),h}function N(t){return t?$("<div />").text(escape(t)).html():""}function G(t){return t?unescape($("<div />").html(t).text()):""}function O(t,e){return function(n){var i="";switch(n.target.error.code){case n.target.error.MEDIA_ERR_ABORTED:i="Video playback aborted. Please see FAQs on the TAG website.";break;case n.target.error.MEDIA_ERR_NETWORK:i="Network error during video upload. Please see FAQs on the TAG website.";break;case n.target.error.MEDIA_ERR_DECODE:i="Error decoding video. Please see FAQs on the TAG website.";break;case n.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:i="Either the video format is not supported or a network or server error occurred. Please see FAQs on the TAG website.";break;default:i="Error: please see FAQs on the TAG website."}console.log("video error: "+i);var r=$(document.createElement("div"));r.css({position:"absolute",width:"80%",left:"10%",top:"50%",color:"white","text-align":"center","font-size":TAG.Util.getMaxFontSizeEM(i,2,.8*e.width(),.2*e.height(),.1)}),r.text(i),t.hide(),e.append(r),t[0].onerror=function(){}}}function L(t){var e;return $.ajax({async:!1,cache:!1,url:tagPath+"html/"+t,success:function(t){e=$(t)},error:function(n){console.log("url = "+t),console.log("error: "+n.statusText),e=null},dataType:"html"}),e}function F(t,e){localStorage.invisibleCollectionsTAG=localStorage.invisibleCollectionsTAG||"[]";var n,i;try{n=JSON.parse(localStorage.invisibleCollectionsTAG)}catch(r){localStorage.invisibleCollectionsTAG="[]",n=[]}if(i=n.indexOf(t),e&&e.visible)i>=0&&n.splice(i,1);else{if(!e||!e.hasOwnProperty("visible"))return i>=0?!1:!0;-1===i&&n.push(t)}localStorage.invisibleCollectionsTAG=JSON.stringify(n)}return{makeNamespace:k,setToDefaults:A,getGestureRecognizer:C,makeXmlRequest:E,makeManipulatable:D,makeManipulatableWin:P,applyD3DataRec:w,elementInDocument:S,fitText:g,encodeText:p,disableDrag:M,getFontSize:T,showLoading:v,hideLoading:y,removeProgressCircle:b,showProgressCircle:x,createQueue:a,createDoubleEndedPQ:I,replaceSVGImg:m,getMaxFontSizeEM:_,encodeXML:f,constrainAndPosition:t,getFieldValueFromMetadata:d,formatAddress:o,safeCall:s,safeCallHandler:l,multiFnHandler:c,contains:u,defaultVal:e,searchData:n,searchString:i,saveThumbnail:r,htmlEntityEncode:N,htmlEntityDecode:G,videoErrorHandler:O,getHtmlAjax:L,localVisibility:F}}(),TAG.Util.UI=function(){"use strict";function t(){window.addEventListener("keydown",function(t){F&&F[0]&&F[0][t.which]&&F[0][t.which]()})}function e(){return F}function n(){}function i(t){var e,n,i,r,o,s=t.x,l=t.fadeIn,c=t.fadeOut,u=t.mainLength,d=(t.fadeColor||"#ff7700",t.mainColor||"#81ad62"),h=t.height||"100%",p=t.container;return e=$(document.createElement("div")),e.addClass("inRect"),e.css({position:"absolute",left:s+"px",top:"0px",width:l+"px",height:h,"border-left":"1px solid black","border-right":"1px solid black",background:"linear-gradient(to right,white, "+d+")"}),n=$(document.createElement("div")),n.addClass("mainRect"),n.css({position:"absolute",left:s+l+"px",top:"0px",width:u+"px",height:h,"background-color":d}),i=$(document.createElement("div")),i.addClass("outRect"),i.css({position:"absolute",left:s+l+u+"px",top:"0px",width:c+"px",height:h,"border-left":"1px solid black","border-right":"1px solid black",background:"linear-gradient(to right, "+d+",white)"}),r=a(s,48,15,5,"#000000","#ffffff"),r.addClass("inHandle"),o=a(s+u+l+c,48,15,5,"#000000","#ffffff"),o.addClass("outHandle"),p&&p.append(n).append(e).append(i).append(r).append(o),{inRect:e,mainRect:n,outRect:i,inHandle:r,outHandle:o}}function r(t){var e=t.x,n=t.y||48,i=t.container,r=o(e);r.addClass("keyframeLine");var s=a(e,n);s.addClass("keyframeCirc");var l=a(e,n,17,0,"#ff0000","#ffffff");return r.css("z-index",2),s.css("z-index",3),l.css("z-index",3),l.addClass("keyframeInnerCirc"),i&&i.append(r),i&&i.append(s),i&&i.append(l),{line:r,circ:s,innerCirc:l}}function a(t,e,n,i,r,a){var o=$(document.createElement("div"));return n=n||21,i=0===i||i?i:5,r=r||"#296b2f",a=a||"#ffffff",o.css({border:i+"px solid "+r,"-webkit-border-radius":2*n+"px","-moz-border-radius":2*n+"px","border-radius":2*n+"px",width:2*n+"px",height:2*n+"px","background-color":a,position:"absolute",left:t-n-i+"px",top:e-n-i+"px"}),o}function o(t,e,n){var i=$(document.createElement("div"));return e=e||3,n=n||"#296b2f",i.css({width:e+"px",height:"100%","background-color":n,position:"absolute",left:t-e/2+"px",top:"0px"}),i}function s(){function t(){var t=a.val();switch(t){case"tagunicorn":var e=$(document.createElement("img"));return e.attr("src",tagPath+"images/unicorn.jpg"),e.css({width:"100%",height:"100%","z-index":2147483647,display:"none",position:"absolute"}),n.append(e),e.fadeIn(500),setTimeout(function(){$("img").attr("src",tagPath+"images/unicorn.jpg"),$(".background").css("background-image","url("+tagPath+'"images/unicorn.jpg")'),e.fadeOut(500,function(){e.remove()})},5e3),void 0;case"tagtest":t="tagtestserver.cloudapp.net";break;case"tagdemo":t="tagdemo.cloudapp.net";break;case"taglive":t="browntagserver.com";break;case"taglocal":t="10.116.71.58";break;case"sam":case"seattleartmuseum":t="tag.seattleartmuseum.org";break;default:}u.hide(),l.hide(),c.html("Connecting..."),c.show(),TAG.Worktop.Database.changeServer(t,!1,function(){TAG.Layout.StartPage(null,function(t){TAG.Util.UI.slidePageRight(t)})},function(){u.show(),l.show(),c.html("Could not connect to the specified address. Please try again."),c.css({"margin-top":"-3%"}),c.show(),r.css({"margin-bottom":"-3%"}),i.css({width:"40%",height:"45%"}),o.css({"margin-top":"13%",color:"white","text-align":"center"})})}var e=$(document.createElement("div"));localStorage.ip;var n=$("#tagRoot");e.attr("id","serverDialogOverlay"),e.css({display:"block",position:"absolute",top:0,left:0,width:"100%",height:"100%","background-color":"rgba(0,0,0,0.6)","z-index":1e9+5});var i=$(document.createElement("div"));i.attr("id","serverDialog"),TAG.Util.constrainAndPosition($(n).width(),$(n).height(),{center_h:!0,center_v:!0,width:.5,height:.35,max_width:560,max_height:230}),i.css({position:"absolute",left:"30%",top:"30%",width:"40%",height:"40%",border:"3px double white","text-align":"center","background-color":"black"}),e.append(i);var r=$(document.createElement("div"));r.attr("id","dialogTitle"),r.css({color:"white",width:"80%",height:"15%",left:"10%",top:"10%","font-size":"1.35em",position:"relative","text-align":"center"}),r.text("TAG Server Address:"),i.append(r);var a=$(document.createElement("input"));a.attr("id","serverDialogInput"),a.css({display:"block",margin:"auto","margin-bottom":"1%",width:"60%",height:"10%",position:"relative",top:"15%","font-size":"100%"}),a.val(localStorage.ip),a.focus(function(){a.select()}),i.append(a),a.on("keydown",function(e){13===e.which&&t()}),TAG.Telemetry.register(a,"keydown","change_server",function(t,e){return 13!==e.which?!0:(t.old_address=localStorage.ip,t.new_address=a.val(),void 0)});var o=$(document.createElement("div"));o.css({"margin-top":"10%",color:"white","text-align":"center"}),o.html("Contact us for server setup at:<br /><a href='mailto:brown.touchartgallery@outlook.com'>brown.touchartgallery@outlook.com</a>."),i.append(o);var s=$(document.createElement("div"));s.css({"margin-top":"5%"}),i.append(s);var l=$(document.createElement("button"));l.css({padding:"1%",border:"1px solid white",width:"14%",height:"3%",position:"relative","margin-top":"1%","float":"left","margin-left":"7%","font-size":"90%",bottom:"1%"}),l.text("Save");var c=$(document.createElement("div"));c.attr("id","serverErrorMessage"),c.css({color:"white",left:"10%",width:"80%",height:"10%","text-align":"center",position:"relative"}),s.append(c),c.hide();var u=$(document.createElement("button"));u.css({padding:"1%",border:"1px solid white",width:"14%",height:"3%",position:"relative","margin-top":"1%","float":"right","margin-right":"7%","font-size":"90%",bottom:"1%"}),u.text("Cancel"),u.attr("type","button"),s.append(u),s.append(l),u.click(function(){$("#serverDialogOverlay").remove()}),l.on("click",t),TAG.Telemetry.register(l,"click","change_server",function(t){t.old_address=localStorage.ip,t.new_address=a.val()});var d=$(document.createElement("img"));d.css({width:"20px",height:"auto",display:"none","margin-right":"3%","margin-top":"2.5%","float":"right"}),d.attr("src",tagPath+"images/icons/progress-circle.gif");var h=$(document.createElement("div"));h.attr("id","serverPasswordErrorMessage"),h.css({color:"white","font-size":"1.25em","margin-bottom":"10px"}),h.html("Invalid authoring password entered. Please try again."),h.hide(),n.append(e),a.focus()}function l(t,e){function n(){var n="function"==typeof t?t():t,i="function"==typeof e?e():e;TAG.Worktop.Database.createFeedback($(c).val(),n,i),$(r).css({display:"none"}),$(c).val("");var o=TAG.Util.UI.popUpMessage(null,"Your feedback has been submitted, thank you for your feedback.",null,null,null,!0);a.append(o),$(o).css("z-index",1e6),$(o).show()}function i(){$(c).val(""),$(r).css({display:"none"})}var r=$(document.createElement("div")),a=$("#tagRoot");$(r).attr("id","dialogOverlay"),$(r).css({display:"none",position:"absolute",top:0,left:0,width:"100%",height:"100%","background-color":"rgba(0,0,0,0.6)","z-index":1e7});var o=$(document.createElement("div"));$(o).addClass("feedbackBox");var s=TAG.Util.constrainAndPosition($(window).width(),$(window).height(),{center_h:!0,center_v:!0,width:.5,height:.35,max_width:560,max_height:210});.5*($("#tagRoot").width()-s.width),$(o).css({position:"absolute",left:"20%",top:"25%",width:"62%",height:"45%",border:"3px double white","background-color":"black"}),$(r).append(o),$(r).click(i),$(o).click(function(t){t.stopPropagation()});var l=$(document.createElement("label"));$(l).addClass("feedbackLabel"),$(l).text("Send Feedback"),$(l).css({left:"9%",top:"12.5%",width:"80%",height:"15%","text-align":"left",color:"white",position:"absolute","font-size":"100%"});var c=$(document.createElement("textarea"));$(c).addClass("commentBox"),$(c).css({"border-color":"gray",color:"gray",position:"relative","min-width":0,left:"9%",top:"12%",width:"77%",height:"30%"}),$(c).attr("placeholder","Questions or Comments");var u=$(document.createElement("div"));$(u).css({position:"relative",width:"80%",left:"10%",bottom:"-74%",display:"inline-block"});var d=$(document.createElement("button"));$(d).css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","margin-top":"1%","margin-left":"-2%",display:"inline-block"}),$(d).text("Send "),$(d).on("click",n);var h=$(document.createElement("button"));return $(h).css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","margin-top":"1%","float":"right","margin-right":"-2%",display:"inline-block"}),$(h).text("Cancel"),$(h).click(i),$(o).append(u),$(u).append(d),$(u).append(h),$(o).append(c),$(o).append(l),r}function c(t){t=t?Math.max(Math.min(parseFloat(t),1),0):.6;var e=document.createElement("div");return $(e).attr("id","blockInteractionOverlay"),$(e).css({display:"none",position:"absolute",top:0,left:0,width:"100%",height:"100%","background-color":"rgba(0,0,0,"+t+")","z-index":"10000000"}),e}function u(t,e,n,i,r,a){function o(){t&&t(),s()}function s(){i?($(l).hide(),$(l).remove()):$(l).fadeOut(500,function(){$(l).remove()}),F[0]=p}var l=c(),u=document.createElement("div"),d=TAG.Util.constrainAndPosition($(window).width(),$(window).height(),{center_h:!0,center_v:!0,width:.5,height:.35,max_width:560,max_height:200}),h=.5*($("#tagRoot").width()-d.width),p=F[0];$(u).css({position:"absolute",left:h+"px",top:d.y+"px",width:d.width+"px",height:d.height+"px",border:"3px double white","background-color":"black"}),a&&($(l).click(s),$(u).click(function(t){t.stopPropagation()}));var f=document.createElement("div");$(f).css({color:"white",width:"80%",height:"15%",left:"10%",top:"12.5%","font-size":"1.25em",position:"relative","text-align":"center","word-wrap":"break-word"}),r?$(f).html(e):$(f).text(e);var g=document.createElement("div");$(g).addClass("optionButtonDiv"),$(g).css({height:"10%",width:"100%",position:"absolute",bottom:"12%",right:"2%"});var m=document.createElement("button");return $(m).css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","float":"right","margin-right":"3%","margin-top":"-3%"}),n=n&&""!==n?n:"OK",$(m).text(n),m.onclick=function(){t&&t(),s()},F[0]={13:o},$(g).append(m),$(u).append(f),$(u).append(g),$(l).append(u),l}function d(t,e,n,i,r,a){function o(){s(),t()}function s(){i?($(l).hide(),$(l).remove()):$(l).fadeOut(500,function(){$(l).remove()}),F[0]=h}var l=c();a=a||window;var u=document.createElement("div"),d={13:o},h=F[0];F[0]=d;var p=TAG.Util.constrainAndPosition($(a).width(),$(a).height(),{center_h:!0,center_v:!0,width:.5,height:.35,max_width:560,max_height:200});$(u).css({position:"absolute",left:p.x+"px",top:p.y+"px",width:p.width+"px",height:p.height+"px",border:"3px double white","background-color":"black"});var f=document.createElement("div");$(f).css({color:"white",width:"80%",height:"15%",left:"10%",top:"12.5%","font-size":"1.25em",position:"relative","text-align":"center","word-wrap":"break-word"}),$(f).text(e);var g=document.createElement("div");$(g).addClass("optionButtonDiv"),$(g).css({height:"20%",width:"100%",position:"absolute",bottom:"10%",right:"5%"});var m=document.createElement("button");$(m).css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","float":"left","margin-left":"12%","margin-top":"-1%"}),n=n&&""!==n?n:"Confirm",$(m).text(n),m.onclick=function(){s(),t()};var v=document.createElement("button");return $(v).css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","float":"right","margin-right":"3%","margin-top":"-1%"}),$(v).text("Cancel"),v.onclick=function(){s(),r&&r()},$(g).append(v),$(g).append(m),$(u).append(f),$(u).append(g),$(l).append(u),l}function h(t,e,n){switch(t){case"backButton":n?$(e).css({"background-color":"transparent","border-radius":"999px"}):$(e).css({"background-color":"gray","border-radius":"999px"});break;case"labelButton":$(e).css({"background-color":"white",color:"black"});break;case"forwardButton":$(e).css({"background-color":"gray"})}}function p(t,e){t.on("mouseleave",function(){h("backButton",t,!0)}),t.on("mousedown",function(){h("backButton",t,!1)}),t.on("click",e)}function f(t,e,n){function i(){r&&a&&n&&n()}var r=!1,a=!1,o=t.parent(),s=y(),l=y(),c=o.children();c.remove(),c.appendTo($(s)),$(s).css({left:"0%","float":"left"}),$(l).append(e),$(l).css({left:"120%",display:"inline"}),o.append(s),o.append(l),$(s).animate({left:"-120%"},1e3,"easeOutQuad",function(){$(s).remove(),r=!0,i()}),$(l).animate({left:"0%"},1e3,"easeOutQuad",function(){$(l).detach(),o.append(e),a=!0,i()})}function g(t,e,n){function i(){r&&a&&n&&n()}var r=!1,a=!1,o=t.parent(),s=y(),l=y(),c=o.children();c.detach(),c.appendTo($(s)),$(s).css({left:"0%","float":"left"}),$(l).append(e),$(l).css({left:"-120%",display:"inline"}),o.append(s),o.append(l),$(s).animate({left:"120%"},1e3,"easeOutQuad",function(){$(s).remove(),r=!0,i()}),$(l).animate({left:"0%"},1e3,"easeOutQuad",function(){$(l).detach(),o.append(e),a=!0,i()})}function m(t,e){function n(){i&&r&&e&&e()}var i=!1,r=!1,a=$("#tagRoot"),o=a.children();o.remove();var s=y();o.appendTo($(s)),$(s).css({left:"0%","float":"left"});var l=y();$(l).append(t),$(l).css({left:"120%",display:"inline"}),a.append(s),a.append(l),$(s).animate({left:"-120%"},1e3,"easeOutQuad",function(){$(s).remove(),i=!0,n()}),$(l).animate({left:"0%"},1e3,"easeOutQuad",function(){$(l).detach(),a.append(t),r=!0,n()})
}function v(t,e){function n(){i&&r&&e&&e()}var i=!1,r=!1,a=$("#tagRoot"),o=a.children();o.remove();var s=y();o.appendTo($(s)),$(s).css({left:"0%","float":"left"});var l=y();$(l).append(t),$(l).css({left:"-120%",display:"inline"}),a.append(s),a.append(l),$(s).animate({left:"120%"},1e3,"easeOutQuad",function(){$(s).remove(),i=!0,n()}),$(l).animate({left:"0%"},1e3,"easeOutQuad",function(){$(l).detach(),a.append(t),r=!0,n()})}function y(){var t=document.createElement("div");return $(t).css({height:"100%",width:"100%",position:"absolute"}),t}function b(t){return"rgba("+x(t)+","+T(t)+","+w(t)+","}function x(t){return parseInt(k(t).substring(0,2),16)}function T(t){return parseInt(k(t).substring(2,4),16)}function w(t){return parseInt(k(t).substring(4,6),16)}function k(t){return"#"===t.charAt(0)?t.substring(1,7):t}function A(t,e){var n,i,r;return t=t.replace(/\#/g,""),t=t.substring(0,6),n=parseInt(t.substring(0,2),16),i=parseInt(t.substring(2,4),16),r=parseInt(t.substring(4,6),16),"rgba("+n+","+i+","+r+","+e+")"}function _(t){function e(t){var e=("0"+parseInt(t,10).toString(16)).toUpperCase();return e.slice(-2)}var n=t.match(/(rgb|rgba)\((\d+),\s*(\d+),\s*(\d+)\,*\s*((\d+\.\d+)|\d+)*\)$/);return null!==n&&void 0!==n?e(n[2])+e(n[3])+e(n[4]):"transparent"===t?"000000":"000000"}function C(t,e){var n,i,r;return e=e||3,t=t.replace(/\#/g,""),t=t.substring(0,6),n=Math.round(parseInt(t.substring(0,2),16)/e),i=Math.round(parseInt(t.substring(2,4),16)/e),r=Math.round(parseInt(t.substring(4,6),16)/e),"rgb("+n+","+i+","+r+")"}function E(t,e,n){var i=parseInt(t.css("font-size"),10);if(parseInt(t.parent()[0].scrollHeight,10)>t.parent().height())for(;parseInt(t.parent()[0].scrollHeight,10)>t.parent().height()&&i>n;)i--,t.css("font-size",i+"px");else if(parseInt(t.height(),10)<t.parent().height())for(;parseInt(t.height(),10)<t.parent().height()&&e>i;)if(i++,t.css("font-size",i+"px"),parseInt(t.parent()[0].scrollHeight,10)>t.parent().height()){i--,t.css("font-size",i);break}}function S(t,e){e.entities.clear();for(var n=0;t.length>n;n++){var i,r=t[n];if(r.resource.latitude)i=r.resource;else{var a=r.resource.point.coordinates[0],o=r.resource.point.coordinates[1];i=new Microsoft.Maps.Location(a,o)}var s={text:n+1+"",icon:tagPath+"images/icons/locationPin.png",width:20,height:30},l=new Microsoft.Maps.Pushpin(i,s);l.location=r.address,l.description="",r.info&&(l.description=r.info),e.entities.push(l)}}function M(t,e){var n={text:e+"",icon:tagPath+"/images/icons/locationPin.png",width:20,height:30},i=new Microsoft.Maps.Pushpin(t.resource,n);i.location=t.address,i.description="",t.info&&(i.description=t.info),t.pushpin=i}function I(t,e){if(t.resource.latitude)return M(t,e),void 0;var n=t.resource.point.coordinates[0],i=t.resource.point.coordinates[1],r=new Microsoft.Maps.Location(n,i),a={text:e+"",icon:tagPath+"/images/icons/locationPin.png",width:20,height:30},o=new Microsoft.Maps.Pushpin(r,a);o.location=t.address,o.description="",t.info&&(o.description=t.info),t.pushpin=o}function D(t){var e,n=t.Location;try{e=JSON.parse(n)}catch(i){console.log("artwork location metadata cannot be parsed."),e=[]}for(var r=0;e.length>r;r++){var a=e[r];if(a.date){if(a.date.getFullYear){var o=date.getUTCFullYear(),s=date.getUTCMonth(),l=date.getUTCDay();a.date={year:o,month:s,day:l}}a.pushpin.date=a.date}}return e}function P(t,e,n,i,r,a,o){function s(){z=TAG.Util.showProgressCircle(U,j),v(),F[0]=R}function l(t){return function(){if(B.clear(),z=TAG.Util.showProgressCircle(U,j),_.attr("value",""),S.empty(),$(".tab").css({"border-top":"1px solid black","border-right":"1px solid black","border-left":"1px solid black","border-bottom":"1px solid white"}),$("#tab"+t).css({"border-top":"1px solid white","border-right":"1px solid white","border-left":"1px solid white","border-bottom":"1px solid black"}),N[t].cached)u(N[t].comps);else{var e=(r[t].args||[]).concat([function(e){N[t].cached=!0,N[t].comps=e,u(e)},d,h]);r[t].getObjs.apply(null,e)}}}function u(t){for(var e=[],n=0;t.length>n;n++)("artwork"!==i||"VideoArtwork"!==t[n].Metadata.Type)&&e.push(t[n]);p(e,m),TAG.Util.removeProgressCircle(z)}function d(){console.log("ERROR IN TABHELPER")}function h(){d()}function p(t,e){if(t){M.length=0,I.length=0,D.length=0,t.sort(function(t,e){return t.Name.toLowerCase()<e.Name.toLowerCase()?-1:1});for(var n=0;t.length>n;n++)B.add(f(t[n],e))}}function f(t,e){return function(){var n=$(document.createElement("div"));n.addClass("compHolder"),n.attr("id",t.Identifier),n.data({type:t.Metadata.ContentType,guid:t.Identifier,name:t.Name,duration:t.Metadata.Duration,comp:t});var i=P.indexOf(t.Identifier)>=0;i&&console.log("is selected"),n.data("selected",i),n.css({"float":"left",background:i?"#999":"#222",width:"15%",height:"35%",padding:"1%",margin:"1%","text-align":"center",border:"1px solid white",color:"white"}),S.append(n);var r=$(document.createElement("div"));r.addClass("compHolderDiv"),r.css({position:"relative",height:"75%",margin:"2%",width:"96%"}),n.append(r);var a=$(document.createElement("img"));a.addClass("compHolderImage");var o=$(document.createElement("img"));o.addClass("typeIndicatorImage");var s=TAG.Worktop.Database.fixPath,l=!1;"Audio"===t.Metadata.ContentType?a.attr("src",tagPath+"images/audio_icon.svg"):"Video"===t.Metadata.ContentType||"Video"===t.Type||"VideoArtwork"===t.Metadata.Type?(a.attr("src",t.Metadata.Thumbnail&&!t.Metadata.Thumbnail.match(/.mp4/)?s(t.Metadata.Thumbnail):"images/video_icon.svg"),l=!0,o.attr("src",tagPath+"images/icons/catalog_video_icon.svg")):"Image"===t.Metadata.ContentType||"Image"===t.Type?a.attr("src",t.Metadata.Thumbnail?s(t.Metadata.Thumbnail):tagPath+"images/image_icon.svg"):"Empty"===t.Type?(a.attr("src",t.Metadata.Thumbnail?s(t.Metadata.Thumbnail):tagPath+"images/icons/catalog_tour_icon.svg"),l=!0,o.attr("src",tagPath+"images/icons/catalog_tour_icon.svg")):a.attr("src",tagPath+"images/text_icon.svg"),a.css({width:"100%",height:"100%","max-width":"100%","max-height":"100%"}),a.removeAttr("width"),a.removeAttr("height"),r.append(a),l&&(o.css({position:"absolute",width:"20%",height:"auto",left:"75%",bottom:"5%","z-index":2}),o.removeAttr("width"),o.removeAttr("height"),r.append(o));var c=$(document.createElement("div"));c.addClass("compHolderText");var u=t.Name;c.text(u),c.css({"padding-left":"3%","font-size":"70%",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap",height:"22%"}),n.append(c),e(n)}}function g(t,e){var n,i=e.data("guid"),r=P.indexOf(i);e.data("selected")?(e.data("selected",!1),e.css("background","#222"),r>=0?D.push(i):(n=M.indexOf(i),M.splice(n,1),I.splice(n,1))):(e.data("selected",!0),e.css("background","#999"),r>=0?D.remove(i):(M.push(i),I.push(e.data("comp"))))}function m(t){t.click(function(e){var n=this;setTimeout(function(){var i=parseInt($(n).data("double"),10);i>0?$(n).data("double",i-1):g.call(n,e,t)},300)})}function v(){var t={};if("artwork"===i&&"artwork"===n.type)for(var e=0;M.length>e;e++)0>L.indexOf(M[e])&&(L.push(M[e]),O.push(I[e]));M.length&&(t.AddIDs=M.join(",")),D.length&&(t.RemoveIDs=D.join(",")),M.length||D.length?"artwork"===i&&"artwork"===n.type?TAG.Worktop.Database.changeArtwork(n.comp.Identifier,t,function(){o(),y.fadeOut(),y.empty(),y.remove()},function(t){console.log(t.message)},function(t){console.log(t.message)},function(t){console.log(t.message)}):"artwork"===i&&"media"===n.type?TAG.Worktop.Database.changeHotspot(n.comp.Identifier,t,function(){o(),y.fadeOut(),y.empty(),y.remove()},function(t){console.log(t.message)},function(t){console.log(t.message)},function(t){console.log(t.message)}):"exhib"===i&&"exhib"===n.type&&TAG.Worktop.Database.changeExhibition(n.comp.Identifier,t,function(){o(),y.fadeOut(),y.empty(),y.remove()},function(t){console.log(t.message)},function(t){console.log(t.message)},function(t){console.log(t.message)}):(o(),y.fadeOut(),y.empty(),y.remove())}var y,b,x,T,w,k,A,_,C,E,S,M=[],I=[],D=[],P=[],N=[],B=TAG.Util.createQueue(),R=F[0];for(F[0]={13:s},k=0;r.length>k;k++)N.push({cached:!1,comps:[]});var H=(a.args||[]).concat([function(t){for(k=0;t.length>k;k++)P.push(t[k].Identifier)},d,h]);if(a.getObjs.apply(null,H),y=$(c()),y.addClass("pickerOverlay"),y.css("z-index",1e7),y.appendTo($(t)),y.fadeIn(),b=$(document.createElement("div")),b.addClass("picker"),b.css({position:"absolute",width:"70%",height:"60%",padding:"1%","padding-left":"2%","background-color":"black",border:"3px double white",top:"19%",left:"19%"}),y.append(b),x=$(document.createElement("div")),x.addClass("pickerHeading"),x.text(e),x.css({width:"100%",color:"white","font-size":"150%",height:"8%","margin-bottom":"10px"}),b.append(x),r.length>=2){for(T=$(document.createElement("div")),T.css({width:"100%",height:"8%",left:"5%"}),T.attr("id","tabBanner"),b.append(T),k=0;r.length>k;k++)w=$(document.createElement("div")),w.addClass("tab"),w.attr("id","tab"+k),w.css({display:"inline-block","min-width":"20%",width:"auto","padding-left":"2%","padding-right":"2%","padding-top":"1%",height:"85%",color:"white","border-top":"1px solid "+(0===k?"white":"black"),"border-right":"1px solid "+(0===k?"white":"black"),"border-left":"1px solid "+(0===k?"white":"black"),"border-bottom":"1px solid "+(0===k?"black":"white"),"text-align":"center"}),w.text(r[k].name),w.on("click",l(k)),T.append(w);w=$(document.createElement("div")),w.attr("id","extraSpaceAwwwwwYeahhhh"),w.css({display:"inline-block",color:"black",width:90-20*r.length+"%",height:"100%","border-bottom":"1px solid white","border-left":"1px solid black"}),w.text("_")}A=$(document.createElement("div")),A.attr("id","searchTab"),A.css({height:"8%",width:"100%","margin-top":"2%",top:"13%"}),b.append(A),_=$(document.createElement("input")),_.attr("type","text"),_.css({"margin-left":"1%",width:"20%",height:"55%"}),_.on("keyup",function(t){t.stopPropagation()}),_.attr("placeholder","Search by Name..."),_.keyup(function(){TAG.Util.searchData(_.val(),".compHolder",G)}),_.change(function(){""!==_.val()&&TAG.Util.searchData(_.val(),".compHolder",G)}),A.append(_),C=$(document.createElement("div")),C.attr("id","selectAllLabel"),C.css({color:"#aaaaaa",display:"inline-block","margin-left":"5%"}),C.text("Select All"),C.on("click",function(){var t,e,n;$.each($(".compHolder"),function(i,r){t=$(r),t.data("selected")||"none"===t.css("display")||(t.css("background","#999"),t.data("selected",!0),e=t.data("guid"),n=P.indexOf(e),n>=0?D.remove(e):(M.push(e),I.push(t.data("comp"))))})}),A.append(C),E=$(document.createElement("div")),E.attr("id","deselectAllLabel"),E.css({color:"#aaaaaa",display:"inline-block","margin-left":"5%"}),E.text("Deselect All"),E.on("click",function(){var t,e,n,i;$.each($(".compHolder"),function(r,a){t=$(a),t.data("selected")&&"none"!==t.css("display")&&(t.css("background","#222"),t.data("selected",!1),e=t.data("guid"),n=P.indexOf(e),n>=0?D.push(e):(i=M.indexOf(e),M.splice(i,1),I.splice(i,1)))})}),A.append(E),S=$(document.createElement("div")),S.attr("id","mainThumbnailContainer"),S.css({"overflow-y":"scroll","margin-top":"10px",width:"100%"}),b.append(S),S.css({height:b.height()-S.offset().top+b.offset().top-30+"px"});var U=$(document.createElement("div"));U.addClass("optionButtonDiv"),U.css({height:"5%",width:"100%"});var z,j={left:"5%",top:"15px",width:"40px",height:"auto",position:"relative","z-index":50},W=$(document.createElement("button"));W.css({margin:"1%",border:"1px solid white",color:"white","padding-left":"1%","padding-right":"1%","background-color":"black",width:"auto",position:"relative","float":"right"}),W.text("Save Changes"),W.on("click",function(){z=TAG.Util.showProgressCircle(U,j),v(),F[0]=R});var q=$(document.createElement("button"));q.css({margin:"1%",border:"1px solid white",width:"auto",color:"white","padding-left":"1%","padding-right":"1%","background-color":"black",position:"relative","float":"right","margin-right":"3%"}),q.text("Cancel"),q.on("click",function(){y.fadeOut(function(){y.empty(),y.remove()}),F[0]=R}),U.append(q),U.append(W),b.append(U),l(0)()}function N(t){t(O)}var G=["visible","exhibits","selected","guid","url","comp"],O=[],L=[],F=[];return{slidePageLeftSplit:f,slidePageRightSplit:g,slidePageLeft:m,slidePageRight:v,hexToR:x,hexToG:T,hexToB:w,hexToRGB:b,hexToRGBA:A,colorToHex:_,dimColor:C,fitTextInDiv:E,drawPushpins:S,addPushpinToLoc:I,getLocationList:D,popUpMessage:u,PopUpConfirmation:d,cgBackColor:h,setUpBackButton:p,blockInteractionOverlay:c,FeedbackBox:l,ChangeServerDialog:s,createAssociationPicker:P,getRecentlyAssociated:N,createCirc:a,createLine:o,createKeyframe:r,createDisplay:i,createTrack:n,getStack:e,initKeyHandler:t}}(),TAG.Util.Artwork=function(){"use strict";function t(t){t=t||{};var e=t.title,n=t.handler,i=t.buttonClass,r=t.buttonID,a=t.src,o=(t.width,t.height||.15*$("#tagRoot").height()+"px"),s=$(document.createElement("div")).addClass("thumbnailButton"),l=$(document.createElement("div")).addClass("thumbnailHolderDiv"),c=$(document.createElement("div")).addClass("thumbnailButtonContainer"),u=$(document.createElement("div")).addClass("thumbnailButtonInnerContainer"),d=$(document.createElement("img")).addClass("thumbnailButtonImage"),h=$(document.createElement("div")).addClass("thumbnailButtonTitle");return i&&s.addClass(i),s.css("height",o),r&&s.attr("id",r),s.on("click",n),s.append(l),l.append(c),c.append(u),d.attr("src",a),d.removeAttr("width"),d.removeAttr("height"),d.css({"max-height":.105*$("#tagRoot").height()+"px","max-width":.06845168*$("#tagRoot").width()+"px"}),u.append(d),h.text(e),s.append(h),s}return{createThumbnailButton:t}}(),Function.prototype.method=function(t,e){return this.prototype[t]?void 0:(this.prototype[t]=e,this)},Function.method("curry",function(){var t=Array.prototype.slice,e=t.apply(arguments),n=this;return function(){return n.apply(null,e.concat(t.apply(arguments)))}}),Array.method("remove",function(t){var e=this.indexOf(t);return-1!==e?(this.splice(e,1),!0):!1}),Array.method("insert",function(t,e){var n;for(n=0;this.length>n;n++)if(e(this[n],t))return this.splice(n,0,t),n;return this.push(t),this.length-1}),Math.constrain||(Math.constrain=function(t,e,n){return Math.min(n,Math.max(e,t))}),Math.twoDecPlaces=function(t){return Math.floor(100*t)/100},function(t,e,n){"use strict";function i(e){c.logging&&t.console&&t.console.log&&t.console.log(e)}function r(t){return{zindex:t,children:[]}}function a(t,e){var n=[];return{storage:n,width:t,height:e,fillRect:function(){n.push({type:"function",name:"fillRect",arguments:arguments})},drawImage:function(){n.push({type:"function",name:"drawImage",arguments:arguments})},fillText:function(){n.push({type:"function",name:"fillText",arguments:arguments})},setVariable:function(t,e){n.push({type:"variable",name:t,arguments:e})}}}var o,s,l,c={};c.Util={},c.Util.backgroundImage=function(t){return/data:image\/.*;base64,/i.test(t)||/^(-webkit|-moz|linear-gradient|-o-)/.test(t)?t:('url("'===t.toLowerCase().substr(0,5)?(t=t.substr(5),t=t.substr(0,t.length-2)):(t=t.substr(4),t=t.substr(0,t.length-1)),t)},c.Util.Bounds=function(t){var e,i={};return t.getBoundingClientRect?(e=t.getBoundingClientRect(),i.top=e.top,i.bottom=e.bottom||e.top+e.height,i.left=e.left,i.width=e.width||e.right-e.left,i.height=e.height||e.bottom-e.top,i):n},c.Util.getCSS=function(i,r){function a(t,e){var n,r=i.runtimeStyle&&i.runtimeStyle[t],a=i.style;return!/^-?[0-9]+\.?[0-9]*(?:px)?$/i.test(e)&&/^-?\d/.test(e)&&(n=a.left,r&&(i.runtimeStyle.left=i.currentStyle.left),a.left="fontSize"===t?"1em":e||0,e=a.pixelLeft+"px",a.left=n,r&&(i.runtimeStyle.left=r)),/^(thin|medium|thick)$/i.test(e)?e:Math.round(parseFloat(e))+"px"}var l;if(t.getComputedStyle)o!==i&&(s=e.defaultView.getComputedStyle(i,null)),l=s[r],"backgroundPosition"===r&&(l=(l.split(",")[0]||"0 0").split(" "),l[0]=-1===l[0].indexOf("%")?a(r+"X",l[0]):l[0],l[1]=l[1]===n?l[0]:l[1],l[1]=-1===l[1].indexOf("%")?a(r+"Y",l[1]):l[1]);else if(i.currentStyle)if("backgroundPosition"===r)l=[a(r+"X",i.currentStyle[r+"X"]),a(r+"Y",i.currentStyle[r+"Y"])];else if(l=a(r,i.currentStyle[r]),/^(border)/i.test(r)&&/^(medium|thin|thick)$/i.test(l))switch(l){case"thin":l="1px";break;case"medium":l="0px";break;case"thick":l="5px"}return l},c.Util.BackgroundPosition=function(t,e,n){var i,r,a,o,s=c.Util.getCSS(t,"backgroundPosition");return 1===s.length&&(o=s,s=[],s[0]=o,s[1]=o),-1!==(""+s[0]).indexOf("%")?(a=parseFloat(s[0])/100,r=e.width*a-n.width*a):r=parseInt(s[0],10),-1!==(""+s[1]).indexOf("%")?(a=parseFloat(s[1])/100,i=e.height*a-n.height*a):i=parseInt(s[1],10),{top:i,left:r}},c.Util.Extend=function(t,e){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},c.Util.Children=function(t){var e;try{e=t.nodeName&&"IFRAME"===t.nodeName.toUpperCase()?t.contentDocument||t.contentWindow.document:function(t){var e=[];return null!==t&&function(t,e){var i=t.length,r=0;if("number"==typeof e.length)for(var a=e.length;a>r;r++)t[i++]=e[r];else for(;e[r]!==n;)t[i++]=e[r++];return t.length=i,t}(e,t),e}(t.childNodes)}catch(r){i("html2canvas.Util.Children failed with exception: "+r.message),e=[]}return e},function(){c.Generate={};var t=[/^(-webkit-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-gradient)\((linear|radial),\s((?:\d{1,3}%?)\s(?:\d{1,3}%?),\s(?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)-]+)\)$/,/^(-moz-linear-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z-]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-moz-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s?([a-z-]*)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z-]+)([\w\d\.\s,%\(\)]+)\)$/];c.Generate.parseGradient=function(e,n){var i,r,a,o,s,l,c,u,d=t.length;for(r=0;d>r&&!(a=e.match(t[r]));r+=1);if(a)switch(a[1]){case"-webkit-linear-gradient":case"-o-linear-gradient":if(i={type:"linear",x0:null,y0:null,x1:null,y1:null,colorStops:[]},s=a[2].match(/\w+/g))for(l=s.length,r=0;l>r;r+=1)switch(s[r]){case"top":i.y0=0,i.y1=n.height;break;case"right":i.x0=n.width,i.x1=0;break;case"bottom":i.y0=n.height,i.y1=0;break;case"left":i.x0=0,i.x1=n.width}if(null===i.x0&&null===i.x1&&(i.x0=i.x1=n.width/2),null===i.y0&&null===i.y1&&(i.y0=i.y1=n.height/2),s=a[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g))for(l=s.length,c=1/Math.max(l-1,1),r=0;l>r;r+=1)u=s[r].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/),u[2]?(o=parseFloat(u[2]),o/="%"===u[3]?100:n.width):o=r*c,i.colorStops.push({color:u[1],stop:o});break;case"-webkit-gradient":if(i={type:"radial"===a[2]?"circle":a[2],x0:0,y0:0,x1:0,y1:0,colorStops:[]},s=a[3].match(/(\d{1,3})%?\s(\d{1,3})%?,\s(\d{1,3})%?\s(\d{1,3})%?/),s&&(i.x0=s[1]*n.width/100,i.y0=s[2]*n.height/100,i.x1=s[3]*n.width/100,i.y1=s[4]*n.height/100),s=a[4].match(/((?:from|to|color-stop)\((?:[0-9\.]+,\s)?(?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)\))+/g))for(l=s.length,r=0;l>r;r+=1)u=s[r].match(/(from|to|color-stop)\(([0-9\.]+)?(?:,\s)?((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\)/),o=parseFloat(u[2]),"from"===u[1]&&(o=0),"to"===u[1]&&(o=1),i.colorStops.push({color:u[3],stop:o});break;case"-moz-linear-gradient":if(i={type:"linear",x0:0,y0:0,x1:0,y1:0,colorStops:[]},s=a[2].match(/(\d{1,3})%?\s(\d{1,3})%?/),s&&(i.x0=s[1]*n.width/100,i.y0=s[2]*n.height/100,i.x1=n.width-i.x0,i.y1=n.height-i.y0),s=a[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}%)?)+/g))for(l=s.length,c=1/Math.max(l-1,1),r=0;l>r;r+=1)u=s[r].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%)?/),u[2]?(o=parseFloat(u[2]),u[3]&&(o/=100)):o=r*c,i.colorStops.push({color:u[1],stop:o});break;case"-webkit-radial-gradient":case"-moz-radial-gradient":case"-o-radial-gradient":if(i={type:"circle",x0:0,y0:0,x1:n.width,y1:n.height,cx:0,cy:0,rx:0,ry:0,colorStops:[]},s=a[2].match(/(\d{1,3})%?\s(\d{1,3})%?/),s&&(i.cx=s[1]*n.width/100,i.cy=s[2]*n.height/100),s=a[3].match(/\w+/),u=a[4].match(/[a-z-]*/),s&&u)switch(u[0]){case"farthest-corner":case"cover":case"":var h=Math.sqrt(Math.pow(i.cx,2)+Math.pow(i.cy,2)),p=Math.sqrt(Math.pow(i.cx,2)+Math.pow(i.y1-i.cy,2)),f=Math.sqrt(Math.pow(i.x1-i.cx,2)+Math.pow(i.y1-i.cy,2)),g=Math.sqrt(Math.pow(i.x1-i.cx,2)+Math.pow(i.cy,2));i.rx=i.ry=Math.max(h,p,f,g);break;case"closest-corner":var h=Math.sqrt(Math.pow(i.cx,2)+Math.pow(i.cy,2)),p=Math.sqrt(Math.pow(i.cx,2)+Math.pow(i.y1-i.cy,2)),f=Math.sqrt(Math.pow(i.x1-i.cx,2)+Math.pow(i.y1-i.cy,2)),g=Math.sqrt(Math.pow(i.x1-i.cx,2)+Math.pow(i.cy,2));i.rx=i.ry=Math.min(h,p,f,g);break;case"farthest-side":"circle"===s[0]?i.rx=i.ry=Math.max(i.cx,i.cy,i.x1-i.cx,i.y1-i.cy):(i.type=s[0],i.rx=Math.max(i.cx,i.x1-i.cx),i.ry=Math.max(i.cy,i.y1-i.cy));break;case"closest-side":case"contain":"circle"===s[0]?i.rx=i.ry=Math.min(i.cx,i.cy,i.x1-i.cx,i.y1-i.cy):(i.type=s[0],i.rx=Math.min(i.cx,i.x1-i.cx),i.ry=Math.min(i.cy,i.y1-i.cy))}if(s=a[5].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g))for(l=s.length,c=1/Math.max(l-1,1),r=0;l>r;r+=1)u=s[r].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/),u[2]?(o=parseFloat(u[2]),o/="%"===u[3]?100:n.width):o=r*c,i.colorStops.push({color:u[1],stop:o})}return i},c.Generate.Gradient=function(t,n){var r,a,o,s,l,u=e.createElement("canvas"),d=u.getContext("2d");if(u.width=n.width,u.height=n.height,r=c.Generate.parseGradient(t,n),l=new Image,r)if("linear"===r.type){for(a=d.createLinearGradient(r.x0,r.y0,r.x1,r.y1),o=0,s=r.colorStops.length;s>o;o+=1)try{a.addColorStop(r.colorStops[o].stop,r.colorStops[o].color)}catch(h){i(["failed to add color stop: ",h,"; tried to add: ",r.colorStops[o],"; stop: ",o,"; in: ",t])}d.fillStyle=a,d.fillRect(0,0,n.width,n.height),l.src=u.toDataURL()}else if("circle"===r.type){for(a=d.createRadialGradient(r.cx,r.cy,0,r.cx,r.cy,r.rx),o=0,s=r.colorStops.length;s>o;o+=1)try{a.addColorStop(r.colorStops[o].stop,r.colorStops[o].color)}catch(h){i(["failed to add color stop: ",h,"; tried to add: ",r.colorStops[o],"; stop: ",o,"; in: ",t])}d.fillStyle=a,d.fillRect(0,0,n.width,n.height),l.src=u.toDataURL()}else if("ellipse"===r.type){var p,f=e.createElement("canvas"),g=f.getContext("2d"),m=Math.max(r.rx,r.ry),v=2*m;for(f.width=f.height=v,a=g.createRadialGradient(r.rx,r.ry,0,r.rx,r.ry,m),o=0,s=r.colorStops.length;s>o;o+=1)try{a.addColorStop(r.colorStops[o].stop,r.colorStops[o].color)}catch(h){i(["failed to add color stop: ",h,"; tried to add: ",r.colorStops[o],"; stop: ",o,"; in: ",t])}g.fillStyle=a,g.fillRect(0,0,v,v),d.fillStyle=r.colorStops[o-1].color,d.fillRect(0,0,u.width,u.height),p=new Image,p.onload=function(){d.drawImage(p,r.cx-r.rx,r.cy-r.ry,2*r.rx,2*r.ry),l.src=u.toDataURL()},p.src=f.toDataURL()}return l},c.Generate.ListAlpha=function(t){var e,n="";do e=t%26,n=String.fromCharCode(e+64)+n,t/=26;while(26*t>26);return n},c.Generate.ListRoman=function(t){var e,n=["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"],i=[1e3,900,500,400,100,90,50,40,10,9,5,4,1],r="",a=n.length;if(0>=t||t>=4e3)return t;for(e=0;a>e;e+=1)for(;t>=i[e];)t-=i[e],r+=n[e];return r}}(),c.Parse=function(o,s){function l(){return{width:Math.max(Math.max(V.body.scrollWidth,V.documentElement.scrollWidth),Math.max(V.body.offsetWidth,V.documentElement.offsetWidth),Math.max(V.body.clientWidth,V.documentElement.clientWidth)),height:Math.max(Math.max(V.body.scrollHeight,V.documentElement.scrollHeight),Math.max(V.body.offsetHeight,V.documentElement.offsetHeight),Math.max(V.body.clientHeight,V.documentElement.clientHeight))}}function u(t,e){var n=parseInt(K(t,e),10);return isNaN(n)?0:n}function d(t,e,n,i,r,a){"transparent"!==a&&(t.setVariable("fillStyle",a),t.fillRect(e,n,i,r),W+=1)}function h(t,e){switch(e){case"lowercase":return t.toLowerCase();case"capitalize":return t.replace(/(^|\s|:|-|\(|\))([a-z])/g,function(t,e,i){return t.length>0?e+i.toUpperCase():n});case"uppercase":return t.toUpperCase();default:return t}}function p(t){return t.replace(/^\s*/g,"").replace(/\s*$/g,"")}function f(t,e){if(q[t+"-"+e]!==n)return q[t+"-"+e];var i,r,a,o=V.createElement("div"),s=V.createElement("img"),l=V.createElement("span");return o.style.visibility="hidden",o.style.fontFamily=t,o.style.fontSize=e,o.style.margin=0,o.style.padding=0,X.appendChild(o),s.src="data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACwAAAAAAQABAAACAkQBADs=",s.width=1,s.height=1,s.style.margin=0,s.style.padding=0,s.style.verticalAlign="baseline",l.style.fontFamily=t,l.style.fontSize=e,l.style.margin=0,l.style.padding=0,l.appendChild(V.createTextNode("Hidden Text")),o.appendChild(l),o.appendChild(s),i=s.offsetTop-l.offsetTop+1,o.removeChild(l),o.appendChild(V.createTextNode("Hidden Text")),o.style.lineHeight="normal",s.style.verticalAlign="super",r=s.offsetTop-o.offsetTop+1,a={baseline:i,lineWidth:1,middle:r},q[t+"-"+e]=a,X.removeChild(o),a}function g(t,e,n,i){p(t).length>0&&(i.fillText(t,e,n),W+=1)}function m(t,e,n){var i,r,a,o,l,u,m,v,y,b,x,T,w,k=n.ctx,A=K(t,"fontFamily"),_=K(t,"fontSize"),C=K(t,"color"),E=K(t,"textDecoration"),S=K(t,"textAlign"),M=K(t,"letterSpacing"),I=K(t,"fontWeight"),D=K(t,"fontStyle"),P=K(t,"fontVariant"),$=!1,N=0;if(e.nodeValue=h(e.nodeValue,K(t,"textTransform")),r=p(e.nodeValue),r.length>0){switch("none"!==E&&(a=f(A,_)),S=S.replace(["-webkit-auto"],["auto"]),o=s.letterRendering===!1&&/^(left|right|justify|auto)$/.test(S)&&/^(normal|none)$/.test(M)?e.nodeValue.split(/(\b| )/):e.nodeValue.split(""),parseInt(I,10)){case 401:I="bold";break;case 400:I="normal"}for(k.setVariable("fillStyle",C),k.setVariable("font",D+" "+P+" "+I+" "+_+" "+A),$?k.setVariable("textAlign","right"):k.setVariable("textAlign","left"),v=e,y=0,l=o.length;l>y;y+=1){if(m=null,U.rangeBounds)("none"!==E||0!==p(o[y]).length)&&(m=o[y],V.createRange?(b=V.createRange(),b.setStart(e,N),b.setEnd(e,N+m.length)):b=X.createTextRange(),i=b.getBoundingClientRect()?b.getBoundingClientRect():{});else{if("string"!=typeof v.nodeValue)continue;u=v.splitText(o[y].length),x=v.parentNode,T=V.createElement("wrapper"),w=v.cloneNode(!0),T.appendChild(v.cloneNode(!0)),x.replaceChild(T,v),i=c.Util.Bounds(T),m=v.nodeValue,v=u,x.replaceChild(w,T)}switch(null!==m&&g(m,i.left,i.bottom,k),E){case"underline":d(k,i.left,Math.round(i.top+a.baseline+a.lineWidth),i.width,1,C);break;case"overline":d(k,i.left,i.top,i.width,1,C);break;case"line-through":d(k,i.left,Math.ceil(i.top+a.middle+a.lineWidth),i.width,1,C)}N+=o[y].length}}}function v(t,e){var n,i,r=V.createElement("boundelement");return r.style.display="inline",n=t.style.listStyleType,t.style.listStyleType="none",r.appendChild(V.createTextNode(e)),t.insertBefore(r,t.firstChild),i=c.Util.Bounds(r),t.removeChild(r),t.style.listStyleType=n,i}function y(t){var e=-1,n=1,i=t.parentNode.childNodes;if(t.parentNode){for(;i[++e]!==t;)1===i[e].nodeType&&n++;return n}return-1}function b(t,e,n){var i,r,a,o,s,l=K(t,"listStylePosition"),u=K(t,"listStyleType"),d=K(t,"fontWeight");if(/^(decimal|decimal-leading-zero|upper-alpha|upper-latin|upper-roman|lower-alpha|lower-greek|lower-latin|lower-roman)$/i.test(u)){switch(a=y(t),u){case"decimal":o=a;break;case"decimal-leading-zero":o=1===(""+a).length?a="0"+(""+a):""+a;break;case"upper-roman":o=c.Generate.ListRoman(a);break;case"lower-roman":o=c.Generate.ListRoman(a).toLowerCase();break;case"lower-alpha":o=c.Generate.ListAlpha(a).toLowerCase();break;case"upper-alpha":o=c.Generate.ListAlpha(a)}switch(o+=". ",s=v(t,o),d){case 401:d="bold";break;case 400:d="normal"}if(L.setVariable("fillStyle",K(t,"color")),L.setVariable("font",K(t,"fontVariant")+" "+d+" "+K(t,"fontStyle")+" "+K(t,"fontSize")+" "+K(t,"fontFamily")),"inside"!==l)return;L.setVariable("textAlign","left"),i=n.left,r=s.bottom,g(o,i,r,L)}}function x(t){var e=o[t];return e&&e.succeeded===!0?e.img:!1}function T(t,e){var n=Math.max(t.left,e.left),i=Math.max(t.top,e.top),r=Math.min(t.left+t.width,e.left+e.width),a=Math.min(t.top+t.height,e.top+e.height);return{left:n,top:i,width:r-n,height:a-i}}function w(t,e){var n;return e?"auto"!==t?(j=!0,n=r(t),e.children.push(n),n):e:n=r(0)}function k(t,e,n,i){var r,a,o,s,l,c,h,p=n.left,f=n.top,g=n.width,m=n.height,v=function(t){var e,n=[],i=["Top","Right","Bottom","Left"];for(e=0;4>e;e+=1)n.push({width:u(t,"border"+i[e]+"Width"),color:K(t,"border"+i[e]+"Color")});return n}(t);for(r=0;4>r;r+=1)if(a=v[r],a.width>0){switch(o=p,s=f,l=g,c=m-v[2].width,r){case 0:c=v[0].width;break;case 1:o=p+g-v[1].width,l=v[1].width;break;case 2:s=s+m-v[2].width,c=v[2].width;break;case 3:l=v[3].width}h={left:o,top:s,width:l,height:c},i&&(h=T(h,i)),h.width>0&&h.height>0&&d(e,o,s,h.width,h.height,a.color)}return v}function A(t,e,n){var r,a,o,s,l,c=V.createElement("valuewrap"),u=["lineHeight","textAlign","fontFamily","color","fontSize","paddingLeft","paddingTop","width","height","border","borderLeftWidth","borderTopWidth"];for(r=0,s=u.length;s>r;r+=1){l=u[r];try{c.style[l]=K(t,l)}catch(d){i("html2canvas: Parse: Exception caught in renderFormValue: "+d.message)}}c.style.borderColor="black",c.style.borderStyle="solid",c.style.display="block",c.style.position="absolute",(/^(submit|reset|button|text|password)$/.test(t.type)||"SELECT"===t.nodeName)&&(c.style.lineHeight=K(t,"height")),c.style.top=e.top+"px",c.style.left=e.left+"px",a="SELECT"===t.nodeName?t.options[t.selectedIndex].text:t.value,o=V.createTextNode(a),c.appendChild(o),X.appendChild(c),m(t,o,n),X.removeChild(c)}function _(t,e,n,i,r,a,o,s,l,c){t.drawImage(e,n,i,r,a,o,s,l,c),W+=1}function C(t,e,n,i,r,a,o,s){var l=0,c=0;o-n>0&&(l=o-n),s-i>0&&(c=s-i),_(t,e,l,c,r-l,a-c,n+l,i+c,r-l,a-c)}function E(t,e,n,i,r,a,o){var s,l,c=Math.min(e.width,a);for(n.top=n.top-Math.ceil(n.top/e.height)*e.height,l=r+n.top;o+r>l;)s=Math.floor(l+e.height)>o+r?o+r-l:e.height,C(t,e,i+n.left,l,c,s,i,r),l=Math.floor(l+e.height)}function S(t,e,n,i,r,a,o){var s,l,c=Math.min(e.height,o);for(n.left=n.left-Math.ceil(n.left/e.width)*e.width,l=i+n.left;a+i>l;)s=Math.floor(l+e.width)>a+i?a+i-l:e.width,C(t,e,l,r+n.top,s,c,i,r),l=Math.floor(l+e.width)}function M(t,e,r){var a,o,s,l,u,d,h,p,f,g,m,v,y=K(t,"backgroundImage"),b=K(t,"backgroundRepeat").split(",")[0];if(/data:image\/.*;base64,/i.test(y)||/^(-webkit|-moz|linear-gradient|-o-)/.test(y)||(y=y.split(",")[0]),y!==n&&/^(1|none)$/.test(y)===!1)if(y=c.Util.backgroundImage(y),a=x(y),o=c.Util.BackgroundPosition(t,e,a),a)switch(b){case"repeat-x":S(r,a,o,e.left,e.top,e.width,e.height);break;case"repeat-y":E(r,a,o,e.left,e.top,e.width,e.height);break;case"no-repeat":l=e.width-o.left,f=e.height-o.top,u=o.left,d=o.top,h=o.left+e.left,p=o.top+e.top,0>u?(u=Math.abs(u),h+=u,l=Math.min(e.width,a.width-u)):(l=Math.min(l,a.width),u=0),0>d?(d=Math.abs(d),p+=d,f=Math.min(e.height,a.height-d)):(f=Math.min(f,a.height),d=0),f>0&&l>0&&_(r,a,u,d,l,f,h,p,l,f);break;default:for(o.top=o.top-Math.ceil(o.top/a.height)*a.height,s=e.top+o.top;e.height+e.top>s;)g=Math.min(a.height,e.height+e.top-s),m=Math.floor(s+a.height)>g+s?g+s-s:a.height,e.top>s?(v=e.top-s,s=e.top):v=0,S(r,a,o,e.left,s,e.width,m),v>0&&(o.top+=v),s=Math.floor(s+a.height)-v}else i("html2canvas: Error loading background:"+y)}function I(t,e){var n,r,o,h,p,f,g,m,v,y,C,E,S=c.Util.Bounds(t),I=S.left,D=S.top,P=S.width,$=S.height,N=K(t,"backgroundColor"),G=K(t,"position"),O=K(t,"opacity");switch(e?F={}:(F=l(),e={opacity:1}),r=w(K(t,"zIndex"),e.zIndex),o={ctx:a(F.width||P,F.height||$),zIndex:r,opacity:O*e.opacity,cssPosition:G},e.clip&&(o.clip=c.Util.Extend({},e.clip)),s.useOverflow===!0&&/(hidden|scroll|auto)/.test(K(t,"overflow"))===!0&&/(BODY)/i.test(t.nodeName)===!1&&(o.clip=o.clip?T(o.clip,S):S),h=r.children.push(o),f=r.children[h-1].ctx,f.setVariable("globalAlpha",o.opacity),p=k(t,f,S,!1),o.borders=p,Y.test(t.nodeName)&&"transparent"!==s.iframeDefault&&(N="default"===s.iframeDefault?"#efefef":s.iframeDefault),g={left:I+p[3].width,top:D+p[0].width,width:P-(p[1].width+p[3].width),height:$-(p[0].width+p[2].width)},o.clip&&(g=T(g,o.clip)),g.height>0&&g.width>0&&(d(f,g.left,g.top,g.width,g.height,N),M(t,g,f)),t.nodeName){case"IMG":m=t.getAttribute("src"),n=x(m),n?(v=u(t,"paddingLeft"),y=u(t,"paddingTop"),C=u(t,"paddingRight"),E=u(t,"paddingBottom"),_(f,n,0,0,n.width,n.height,I+v+p[3].width,D+y+p[0].width,S.width-(p[1].width+p[3].width+v+C),S.height-(p[0].width+p[2].width+y+E))):i("html2canvas: Error loading <img>:"+m);
break;case"INPUT":/^(text|url|email|submit|button|reset)$/.test(t.type)&&t.value.length>0&&A(t,S,o);break;case"TEXTAREA":t.value.length>0&&A(t,S,o);break;case"SELECT":t.options.length>0&&A(t,S,o);break;case"LI":b(t,o,g);break;case"CANVAS":v=u(t,"paddingLeft"),y=u(t,"paddingTop"),C=u(t,"paddingRight"),E=u(t,"paddingBottom"),_(f,t,0,0,t.width,t.height,I+v+p[3].width,D+y+p[0].width,S.width-(p[1].width+p[3].width+v+C),S.height-(p[0].width+p[2].width+y+E))}return r.children[h-1]}function D(t,e){if("none"!==K(t,"display")&&"hidden"!==K(t,"visibility")&&(e=I(t,e)||e,L=e.ctx,!Y.test(t.nodeName))){var n,i,r,a=c.Util.Children(t);for(n=0,r=a.length;r>n;n+=1)i=a[n],1===i.nodeType?D(i,e):3===i.nodeType&&m(t,i,e)}}t.scroll(0,0);var P,$,N,G,O,L,F,B,R,H,U={rangeBounds:!1,svgRendering:s.svgRendering&&function(){var t=new Image,r=e.createElement("canvas"),a=r.getContext===n?!1:r.getContext("2d");if(a===!1)return!1;r.width=r.height=10,t.src=["data:image/svg+xml,","<svg xmlns='http://www.w3.org/2000/svg' width='10' height='10'>","<foreignObject width='10' height='10'>","<div xmlns='http://www.w3.org/1999/xhtml' style='width:10;height:10;'>","sup","</div>","</foreignObject>","</svg>"].join("");try{a.drawImage(t,0,0),r.toDataURL()}catch(o){return!1}return i("html2canvas: Parse: SVG powered rendering available"),!0}()},z=s.elements===n?e.body:s.elements[0],j=!1,W=0,q={},V=z.ownerDocument,Y=RegExp("("+s.ignoreElements+")"),X=V.body;o=o||{},V.createRange&&(P=V.createRange(),P.getBoundingClientRect&&($=V.createElement("boundtest"),$.style.height="123px",$.style.display="block",X.appendChild($),P.selectNode($),N=P.getBoundingClientRect(),G=N.height,123===G&&(U.rangeBounds=!0),X.removeChild($)));var K=c.Util.getCSS;for(O=I(z,null),U.svgRendering&&function(t){function e(t){var n,i,a,o,s,l=c.Util.Children(t),u=l.length;for(s=0;u>s;s+=1)if(o=l[s],3===o.nodeType)r+=o.nodeValue.replace(/\</g,"&lt;").replace(/\>/g,"&gt;");else if(1===o.nodeType&&!/^(script|meta|title)$/.test(o.nodeName.toLowerCase())){if(r+="<"+o.nodeName.toLowerCase(),o.hasAttributes())for(n=o.attributes,a=n.length,i=0;a>i;i+=1)r+=" "+n[i].name+'="'+n[i].value+'"';r+=">",e(o),r+="</"+o.nodeName.toLowerCase()+">"}}var n=new Image,i=l(),r="";e(t),n.src=["data:image/svg+xml,","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='"+i.width+"' height='"+i.height+"'>","<foreignObject width='"+i.width+"' height='"+i.height+"'>","<html xmlns='http://www.w3.org/1999/xhtml' style='margin:0;'>",r.replace(/\#/g,"%23"),"</html>","</foreignObject>","</svg>"].join(""),n.onload=function(){O.svgRender=n}}(e.documentElement),B=0,R=z.children,H=R.length;H>B;B+=1)D(R[B],O);return O.backgroundColor=K(e.documentElement,"backgroundColor"),O},c.Preload=function(r){function a(t){T.href=t,T.href=T.href;var e=T.protocol+T.host;return e===d}function o(){i("html2canvas: start: images: "+g.numLoaded+" / "+g.numTotal+" (failed: "+g.numFailed+")"),!g.firstRun&&g.numLoaded>=g.numTotal&&(i("Finished loading images: # "+g.numTotal+" (failed: "+g.numFailed+")"),"function"==typeof r.complete&&r.complete(g))}function s(e,i,a){var s,l,c=r.proxy;T.href=e,e=T.href,s="html2canvas_"+m++,a.callbackname=s,c+=c.indexOf("?")>-1?"&":"?",c+="url="+encodeURIComponent(e)+"&callback="+s,l=y.createElement("script"),t[s]=function(e){"error:"===e.substring(0,6)?(a.succeeded=!1,g.numLoaded++,g.numFailed++,o()):(u(i,a),i.src=e),t[s]=n;try{delete t[s]}catch(r){}l.parentNode.removeChild(l),l=null,delete a.script,delete a.callbackname},l.setAttribute("type","text/javascript"),l.setAttribute("src",c),a.script=l,t.document.body.appendChild(l)}function l(t){var e,r,a,s,u=c.Util.Children(t),d=!1;try{var p=u.length;for(e=0;p>e;e+=1)l(u[e])}catch(f){}try{d=t.nodeType}catch(m){d=!1,i("html2canvas: failed to access some element's nodeType - Exception: "+m.message)}if(1===d||d===n){try{r=c.Util.getCSS(t,"backgroundImage")}catch(f){i("html2canvas: failed to get background-image - Exception: "+f.message)}r&&"1"!==r&&"none"!==r&&(/^(-webkit|-o|-moz|-ms|linear)-/.test(r)?(s=c.Generate.Gradient(r,c.Util.Bounds(t)),s!==n&&(g[r]={img:s,succeeded:!0},g.numTotal++,g.numLoaded++,o())):(a=c.Util.backgroundImage(r.match(/data:image\/.*;base64,/i)?r:r.split(",")[0]),h.loadImage(a)))}}function u(e,i){e.onload=function(){i.timer!==n&&t.clearTimeout(i.timer),g.numLoaded++,i.succeeded=!0,e.onerror=e.onload=null,o()},e.onerror=function(){if("anonymous"===e.crossOrigin&&(t.clearTimeout(i.timer),r.proxy)){var a=e.src;return e=new Image,i.img=e,e.src=a,s(e.src,e,i),n}g.numLoaded++,g.numFailed++,i.succeeded=!1,e.onerror=e.onload=null,o()}}var d,h,p,f,g={numLoaded:0,numFailed:0,numTotal:0,cleanupDone:!1},m=0,v=r.elements[0]||e.body,y=v.ownerDocument,b=y.images,x=b.length,T=y.createElement("a"),w=function(t){return t.crossOrigin!==n}(new Image);for(T.href=t.location.href,d=T.protocol+T.host,h={loadImage:function(e){var i,o;e&&g[e]===n&&(i=new Image,e.match(/data:image\/.*;base64,/i)?(i.src=e.replace(/url\(['"]{0,}|['"]{0,}\)$/gi,""),o=g[e]={img:i},g.numTotal++,u(i,o)):a(e)||r.allowTaint===!0?(o=g[e]={img:i},g.numTotal++,u(i,o),i.src=e):w&&!r.allowTaint&&r.useCORS?(i.crossOrigin="anonymous",o=g[e]={img:i},g.numTotal++,u(i,o),i.src=e,i.customComplete=function(){this.img.complete?this.img.onerror():this.timer=t.setTimeout(this.img.customComplete,100)}.bind(o),i.customComplete()):r.proxy&&(o=g[e]={img:i},g.numTotal++,s(e,i,o)))},cleanupDOM:function(a){var s,l;if(!g.cleanupDone){a&&"string"==typeof a?i("html2canvas: Cleanup because: "+a):i("html2canvas: Cleanup after timeout: "+r.timeout+" ms.");for(l in g)if(g.hasOwnProperty(l)&&(s=g[l],"object"==typeof s&&s.callbackname&&s.succeeded===n)){t[s.callbackname]=n;try{delete t[s.callbackname]}catch(c){}s.script&&s.script.parentNode&&(s.script.setAttribute("src","about:blank"),s.script.parentNode.removeChild(s.script)),g.numLoaded++,g.numFailed++,i("html2canvas: Cleaned up failed img: '"+l+"' Steps: "+g.numLoaded+" / "+g.numTotal)}t.stop!==n?t.stop():e.execCommand!==n&&e.execCommand("Stop",!1),e.close!==n&&e.close(),g.cleanupDone=!0,a&&"string"==typeof a||o()}},renderingDone:function(){f&&t.clearTimeout(f)}},r.timeout>0&&(f=t.setTimeout(h.cleanupDOM,r.timeout)),i("html2canvas: Preload starts: finding background-images"),g.firstRun=!0,l(v),i("html2canvas: Preload: Finding images"),p=0;x>p;p+=1)h.loadImage(b[p].getAttribute("src"));return g.firstRun=!1,i("html2canvas: Preload: Done."),g.numTotal===g.numLoaded&&o(),h},c.Renderer=function(t,n){function i(t){var e,n,a,o,s,l,c,u,d=[],h=[],p=t.children;for(e=0,s=p.length;s>e;e+=1)l=p[e],l.children&&l.children.length>0?(d.push(l),h.push(l.zindex)):r.push(l);for(h.sort(function(t,e){return t-e}),n=0,a=h.length;a>n;n+=1)for(o=h[n],c=0,u=d.length;u>=c;c+=1)if(d[c].zindex===o){l=d.splice(c,1),i(l[0]);break}}var r=[];if(i(t.zIndex),"function"!=typeof n._renderer._create)throw Error("Invalid renderer defined");return n._renderer._create(t,n,e,r,c)},l=function(e,r){var a,o,s={logging:!1,elements:e,proxy:"http://html2canvas.appspot.com/",timeout:0,useCORS:!1,allowTaint:!1,svgRendering:!1,iframeDefault:"default",ignoreElements:"IFRAME|OBJECT|PARAM",useOverflow:!0,letterRendering:!1,flashcanvas:n,width:null,height:null,taintTest:!0,renderer:"Canvas"};if(s=c.Util.Extend(r,s),"string"==typeof s.renderer&&c.Renderer[s.renderer]!==n)s._renderer=c.Renderer[s.renderer](s);else{if("function"!=typeof s.renderer)throw"Unknown renderer";s._renderer=s.renderer(s)}return c.logging=s.logging,s.complete=function(t){("function"!=typeof s.onpreloaded||s.onpreloaded(t)!==!1)&&(a=c.Parse(t,s),("function"!=typeof s.onparsed||s.onparsed(a)!==!1)&&(o=c.Renderer(a,s),"function"==typeof s.onrendered&&s.onrendered(o)))},t.setTimeout(function(){c.Preload(s)},0),{render:function(t,e){return c.Renderer(t,c.Util.Extend(e,s))},parse:function(t,e){return c.Parse(t,c.Util.Extend(e,s))},preload:function(t){return c.Preload(c.Util.Extend(t,s))},log:i}},l.log=i,l.Renderer={Canvas:n},c.Renderer.Canvas=function(r){r=r||{};var a,o=e,s=r.canvas||o.createElement("canvas"),l=!1,c=!1,u=!1,d=2880;if(s.getContext)i("html2canvas: Renderer: using canvas renderer"),u=!0;else if(r.flashcanvas!==n){l=!0,i("html2canvas: Renderer: canvas not available, using flashcanvas");var h=o.createElement("script");h.src=r.flashcanvas,h.onload=function(e,r){var a;return e.onload!==n?r:(e.onreadystatechange!==n?(a=function(){"loaded"!==e.readyState&&"complete"!==e.readyState?t.setTimeout(a,250):r()},t.setTimeout(a,250)):i("html2canvas: Renderer: Can't track when flashcanvas is loaded"),n)}(h,function(){t.FlashCanvas!==n&&(i("html2canvas: Renderer: Flashcanvas initialized"),t.FlashCanvas.initElement(s),u=!0,c!==!1&&a._create.apply(null,c))}),o.body.appendChild(h)}return a={_create:function(t,r,a,o,h){if(!u)return c=arguments,s;var p,f,g,m,v,y,b,x,T,w=s.getContext("2d"),k=e.createElement("canvas"),A=k.getContext!==n,_=A?k.getContext("2d"):{},C=[];if(s.width=s.style.width=l?Math.min(d,r.width||t.ctx.width):r.width||t.ctx.width,s.height=s.style.height=l?Math.min(d,r.height||t.ctx.height):r.height||t.ctx.height,T=w.fillStyle,w.fillStyle=t.backgroundColor,w.fillRect(0,0,s.width,s.height),w.fillStyle=T,r.svgRendering&&t.svgRender!==n)w.drawImage(t.svgRender,0,0);else for(f=0,g=o.length;g>f;f+=1){if(p=o.splice(0,1)[0],p.canvasPosition=p.canvasPosition||{},w.textBaseline="bottom",p.clip&&(w.save(),w.beginPath(),w.rect(p.clip.left,p.clip.top,p.clip.width,p.clip.height),w.clip()),p.ctx.storage)for(m=0,b=p.ctx.storage.length;b>m;m+=1)switch(x=p.ctx.storage[m],x.type){case"variable":w[x.name]=x.arguments;break;case"function":if("fillRect"===x.name)(!l||d>x.arguments[0]+x.arguments[2]&&d>x.arguments[1]+x.arguments[3])&&w.fillRect.apply(w,x.arguments);else if("fillText"===x.name)(!l||d>x.arguments[1]&&d>x.arguments[2])&&w.fillText.apply(w,x.arguments);else if("drawImage"===x.name&&x.arguments[8]>0&&x.arguments[7]){if(A&&r.taintTest&&-1===C.indexOf(x.arguments[0].src)){_.drawImage(x.arguments[0],0,0);try{_.getImageData(0,0,1,1)}catch(E){k=a.createElement("canvas"),_=k.getContext("2d");continue}C.push(x.arguments[0].src)}w.drawImage.apply(w,x.arguments)}break;default:}p.clip&&w.restore()}return i("html2canvas: Renderer: Canvas renderer done - returning canvas obj"),g=r.elements.length,1===g&&"object"==typeof r.elements[0]&&"BODY"!==r.elements[0].nodeName&&l===!1?(y=h.Util.Bounds(r.elements[0]),v=a.createElement("canvas"),v.width=y.width,v.height=y.height,w=v.getContext("2d"),w.drawImage(s,y.left,y.top,y.width,y.height,0,0,y.width,y.height),s=null,v):s}}},t.html2canvas=l}(window,document),function(t){t.extend(t.fn,{livequery:function(e,n,i){var r,a=this;return t.isFunction(e)&&(i=n,n=e,e=void 0),t.each(t.livequery.queries,function(t,o){return a.selector!=o.selector||a.context!=o.context||e!=o.type||n&&n.$lqguid!=o.fn.$lqguid||i&&i.$lqguid!=o.fn2.$lqguid?void 0:(r=o)&&!1}),r=r||new t.livequery(this.selector,this.context,e,n,i),r.stopped=!1,r.run(),this},expire:function(e,n,i){var r=this;return t.isFunction(e)&&(i=n,n=e,e=void 0),t.each(t.livequery.queries,function(a,o){r.selector!=o.selector||r.context!=o.context||e&&e!=o.type||n&&n.$lqguid!=o.fn.$lqguid||i&&i.$lqguid!=o.fn2.$lqguid||this.stopped||t.livequery.stop(o.id)}),this}}),t.livequery=function(e,n,i,r,a){return this.selector=e,this.context=n,this.type=i,this.fn=r,this.fn2=a,this.elements=[],this.stopped=!1,this.id=t.livequery.queries.push(this)-1,r.$lqguid=r.$lqguid||t.livequery.guid++,a&&(a.$lqguid=a.$lqguid||t.livequery.guid++),this},t.livequery.prototype={stop:function(){var t=this;this.type?this.elements.unbind(this.type,this.fn):this.fn2&&this.elements.each(function(e,n){t.fn2.apply(n)}),this.elements=[],this.stopped=!0},run:function(){if(!this.stopped){var e=this,n=this.elements,i=t(this.selector,this.context),r=i.not(n);this.elements=i,this.type?(r.bind(this.type,this.fn),n.length>0&&t.each(n,function(n,r){0>t.inArray(r,i)&&t.event.remove(r,e.type,e.fn)})):(r.each(function(){e.fn.apply(this)}),this.fn2&&n.length>0&&t.each(n,function(n,r){0>t.inArray(r,i)&&e.fn2.apply(r)}))}}},t.extend(t.livequery,{guid:0,queries:[],queue:[],running:!1,timeout:null,checkQueue:function(){if(t.livequery.running&&t.livequery.queue.length)for(var e=t.livequery.queue.length;e--;)t.livequery.queries[t.livequery.queue.shift()].run()},pause:function(){t.livequery.running=!1},play:function(){t.livequery.running=!0,t.livequery.run()},registerPlugin:function(){t.each(arguments,function(e,n){if(t.fn[n]){var i=t.fn[n];t.fn[n]=function(){var e=i.apply(this,arguments);return t.livequery.run(),e}}})},run:function(e){void 0!=e?0>t.inArray(e,t.livequery.queue)&&t.livequery.queue.push(e):t.each(t.livequery.queries,function(e){0>t.inArray(e,t.livequery.queue)&&t.livequery.queue.push(e)}),t.livequery.timeout&&clearTimeout(t.livequery.timeout),t.livequery.timeout=setTimeout(t.livequery.checkQueue,20)},stop:function(e){void 0!=e?t.livequery.queries[e].stop():t.each(t.livequery.queries,function(e){t.livequery.queries[e].stop()})}}),t.livequery.registerPlugin("append","prepend","after","before","wrap","attr","removeAttr","addClass","removeClass","toggleClass","empty","remove","html"),t(function(){t.livequery.play()})}(jQuery),TAG.Util.makeNamespace("TAG.TourAuthoring.Constants"),TAG.TourAuthoring.Constants=function(){"use strict";return{aboveRinZIndex:1e8,keyframeSize:21,innerKeyframeSize:17,keyframeStrokeW:5,keyframeLineW:3,fadeBtnSize:15,rinBorder:2,minZoom:1,maxZoom:100,handleColor:"#DAD9CC",keyframeColor:"#296B2F",audioKeyframeColor:"#283F53",selectedKeyframeColor:"#6B293F",displayColor:"#81AD62",inkDisplayColor:"#AAAAAA",selectedDisplayColor:"#143417",selectedInkDisplayColor:"#2E2E2E",inkDragHandleRadius:20,doubleTap:400,trackHeight:96,minimizedTrackHeight:36,esOffset:.05,timeRulerSize:54,defaultVolume:.8,epsilon:.01,menuDecimals:2,maxTourLength:900,minMediaLength:5,inkTrackOffset:0,defaultFade:.5,displayEpsilon:.5}}(),TAG.Util.makeNamespace("TAG.Util.Constants"),TAG.Util.Constants=function(){"use strict";function t(t,e){return n[t]||e}function e(t,e){n[t]=e}var n={},i={START_PAGE:0,COLLECTIONS_PAGE:1,ARTWORK_VIEWER:2,VIDEO_PLAYER:3,TOUR_PLAYER:4,AUTHORING_HUB:5,ARTWORK_EDITOR:6,TOUR_AUTHORING:7};return{pages:i,get:t,set:e}}(),TAG.Util.makeNamespace("TAG.Util.Splitscreen"),TAG.Util.Splitscreen=function(){"use strict";function t(){return a}function e(t){a=t}function n(t,e){"L"===t.data("split")&&(o=e.viewer),"R"===t.data("split")&&(s=e.viewer)}function i(t,e){function n(t){var e=$(document.createElement("img"));return e.attr("src","images/icons/x.svg"),e.css({position:"absolute",top:"94%",width:"115%",height:"auto"}),e.click(function(){r(t)}),e}a=!0;var i=$(document.createElement("div")),o=$(document.createElement("div")),s=$(document.createElement("div"));$(document.createElement("img")),i.attr("id","metascreen-L"),i.append(t),i.css({position:"absolute",left:"0%",top:"0%",width:"  .5%",height:"100%","z-index":"999",overflow:"hidden"}),o.attr("id","metascreen-R"),o.append(e),o.css({position:"absolute",left:"50.5%",top:"0%",width:"49.5%",height:"100%","z-index":"998",overflow:"hidden"}),s.attr("id","splitbar"),s.css({position:"absolute",left:"49.5%",top:"0%",width:"1%",height:"100%","z-index":"1000","background-color":"#191915"});var l=n("R"),c=n("L");l.css({left:"-350%",width:"300%"}),c.css({right:"-350%",width:"300%"}),s.append(l).append(c),$("body").append(i).append(s).append(o)}function r(t){function e(){if(i.hasClass("artmode")){var t=i.find(".sideBar"),e=i.find(".toggler"),n=i.find(".togglerImage"),r=i.find("#splitscreenContainer"),a=i.find(".splitscreen-icon"),o=(i.find(".locationHistoryDiv"),i.find(".locationHistoryPanel"),i.find(".locationHistoryToggle")),s=i.find(".locationHistoryToggleIcon"),l=i.find(".locationHistoryContainer").find("img"),c=i.find(".locationHistoryContainer").find("div"),u=i.find(".lpMapDiv");.2*window.innerWidth,.8*window.innerWidth,i.data("split","L"),t.css({left:"0px"}),e.css({position:"absolute",left:"auto",right:"-12%",borderTopRightRadius:"10px",borderBottomRightRadius:"10px",borderTopLeftRadius:"0px",borderBottomLeftRadius:"0px"}),n.attr("src","images/icons/Left.png"),r.show(),a.attr("src","images/icons/SplitW.svg"),o.css({left:"87.5%","border-bottom-right-radius":"10px","border-top-right-radius":"10px"}),$(s).attr("src","images/icons/Left.png"),l.css("opacity","1.0"),c.css("opacity","1.0"),u.attr("id","lpMapDiv")}else if(i.hasClass("videoPlayer"))i.data("split","L"),i.find("#playPauseButton").attr("src","images/icons/PlayWhite.svg");else if(i.hasClass("exhibition")){i.data("split","L"),i.find(".leftbar-header").css({height:"5%"}),i.find(".exhibition-label").css({width:"50%"}),i.find(".videos-label").css({width:"50%"}),i.find(".selectExhibition").css({"font-size":"1.5em","letter-spacing":"inherit"}),i.find(".exhibition-title").css({"font-size":"5.7em","letter-spacing":"inherit"}),i.find(".exhibition-subtitle-1").css({"font-size":"3em","letter-spacing":"inherit"}),i.find(".exhibition-subtitle-2").css({"font-size":"2em","letter-spacing":"inherit"}),i.find("#catalogBackButton").css({display:"block"}),i.find(".feedback-icon").css({display:"inline"}),i.find("#exhibition-label").css({display:"block"});var d=.0432*$(window).height(),h=TAG.Util.getMaxFontSizeEM("W",.25,9999,.85*d,.1);$(".exhibition-selection .exhibition-title").css({"font-size":h}),i.find("#exhibition-label").css("font-size",TAG.Util.getMaxFontSizeEM("Collections",1,.1*$(window).width(),1e3)),i.find(".exhibition-name-div").css("font-size",TAG.Util.getMaxFontSizeEM(i.find(".exhibition-name-div").text(),1.5,.8*.75*$(window).width(),.2*i.find(".exhibition-info").height()));var p=.4*$(".contentdiv").width(),f=p/1.4;i.find(".img-container").css({height:f+"px",width:p+"px"}),i.find(".explore-text").css("font-size",TAG.Util.getMaxFontSizeEM("Explore",.5,.5*i.find(".explore-tab").width(),.7*i.find(".explore-tab").height()))}}var n=$("#metascreen-"+t).detach(),i=n.children(".root");a=!1,"L"===t?($("#metascreen-R").remove(),o&&($(o.container).css({width:"100%",height:"100%"}),o.scheduleUpdate()),s=null):($("#metascreen-L").remove(),s&&($(s.container).css({width:"100%",height:"100%"}),s.scheduleUpdate()),o=null),$("#splitbar").remove(),$("body").append(i),e(),o&&o.scheduleUpdate(),s&&s.scheduleUpdate(),o=null,s=null}var a=!1,o=null,s=null;return{init:i,exit:r,on:t,setOn:e,setViewers:n}}();var TAG=TAG||{};TAG.Util.IdleTimer=function(){function t(t,e){function r(){v=setTimeout(d,p),b=!0}function a(){v&&clearTimeout(v),y&&clearTimeout(y),u&&clearInterval(u),b=!1}function o(){return b}function s(){v&&clearTimeout(v),y&&clearTimeout(y),u&&clearInterval(u),v=setTimeout(d,p),b=!0}function l(t,e){clearTimeout(v),clearTimeout(y),p=t.duration,f=t.callback,g=e.duration,m=e.callback,v=null,y=null,c=g,b=!1,u&&clearInterval(u)}function d(){f(),y=setTimeout(h,g)}function h(){m(),b=!1}t=t||{},e=e||{};var p=t.duration||idleDuration||12e4,f=t.callback||n,g=e.duration||1e4,m=e.callback||i,v=null,y=null,b=!1;return c=g,{start:r,kill:a,isStopped:o,restart:s,reinitialize:l}}function e(t,e){return{duration:t,callback:e}}function n(){return r()}function i(){return o()}function r(){var t,e=$(document.createElement("div")).addClass("idleTimerTextRegion"),n=$(document.createElement("div")).addClass("idleTimerClock"),i=0,r=new Date,o=r.getTime();l=$(TAG.Util.UI.blockInteractionOverlay(.8)),l.css({"text-align":"center"}),e.css({"font-size":"2em",left:"10%",position:"absolute","text-align":"center",top:"30%",width:"80%"}),n.css({"background-color":"white",border:"2px solid #ffffff","border-radius":"50%",display:"block",left:"45%",position:"absolute",top:"50%",width:"10%"}),e.html("Starting a new session when the timer below expires.<br />Tap anywhere to continue exploring."),l.append(e),l.append(n),$("#tagRoot").append(l),l.fadeIn(),t=n.width(),n.css("height",t+"px"),l.on("click",function(){l.off("click"),idleTimer&&idleTimer.restart(),a()}),u=setInterval(function(){var t,e,r=new Date;i=r.getTime()-o,t=Math.min(i/c,1),e=.5>=t?"linear-gradient("+(90+360*t)+"deg, transparent 50%, black 50%), linear-gradient(90deg, black 50%, transparent 50%)":"linear-gradient("+(90+360*(t-.5))+"deg, transparent 50%, white 50%), linear-gradient(90deg, black 50%, transparent 50%)",n.css("background-image",e),t>=1&&clearInterval(u)},10)}function a(){l&&l.fadeOut(l.remove)}function o(){currentPage.name===TAG.Util.Constants.pages.COLLECTIONS_PAGE&&currentPage.obj&&currentPage.obj.loadFirstCollection?(a(),currentPage.obj.loadFirstCollection()):(catalog=new TAG.Layout.CollectionsPage,TAG.Util.UI.slidePageRight(catalog.getRoot()))}function s(){idleTimer&&idleTimer.restart()}var l,c,u;return{TwoStageTimer:t,timerPair:e,restartTimer:s,removeIdleOverlay:a}}(),TAG.Util.makeNamespace("Worktop.Database"),Worktop.Database=function(t){function e(t){A("Exhibitions",D("exhibs","doqs"),D("exhibs","count"),t)}function n(t){A("Artworks",D("artworks","doqs"),D("artworks","count"),t)}function i(t){A("Tours",D("tours","doqs"),D("tours","count"),t)}function r(t){A("AllAssociatedMedia",D("media","doqs"),D("media","count"),t)}function a(t){A("Feedback",D("feedback","doqs"),D("feedback","count"),t)}function o(t,e){A("Doq",D("doqs",t),D("doqs",t,"Metadata","Count"),e,{Guid:t})}function s(t){A("Main",D("main"),D(!0,!1,"main","Metadata","MainCount"),t)}function l(t,e){A("AssociatedMedia",D("doqMedia",t,"doqs"),D("doqMedia",t,"LinqCount"),e,{Guid:t})}function c(t,e){A("ArtworksAssociated",D("doqMedia",t,"doqs"),D("doqMedia",t,"LinqCount"),e,{Guid:t})}function u(t,e,n){A("Linq",D("linqs",t,e,"linq"),D("linqs",t,e,"Count"),n,{Guid1:t,Guid2:e})}function d(t,e){A("ArtworksIn",D("artIn",t,"art"),D("artIn",t,"Count"),e,{Guid:t})}function h(t,e,n,i){e=e||{};var r=S(e,W.params.tour,"ChangeTour",i);r.urlOptions.Guid=t,E("ChangeTour",n,r.urlOptions,r.bodyOptions,!0)}function p(t,e,n,i){e=e||{};var r=S(e,W.params.exhibition,"ChangeExhibition",i);r.urlOptions.Guid=t,E("ChangeExhibition",n,r.urlOptions,r.bodyOptions,!0)}function f(t,e,n,i){e=e||{};var r=S(e,W.params.artwork,"ChangeArtwork",i);r.urlOptions.Guid=t,E("ChangeArtwork",n,r.urlOptions,r.bodyOptions,!0)}function g(t,e,n,i){e=e||{};var r=S(e,W.params.hotspot,"ChangeHotspot",i);r.urlOptions.Guid=t,E("ChangeAssociatedMedia",n,r.urlOptions,r.bodyOptions,!0)}function m(t,e,n){t=t||{};var i=S(t,W.params.main,"ChangeMain",n);E("Main",e,i.urlOptions,i.bodyOptions,!0,D("main","Metadata","MainCount").get())}function v(t,e,n,i){t=t||{};var r=S(t,W.params.tour,"CreateTour",i);_("CreateTour",e,r.urlOptions,r.bodyOptions,n,!0)}function y(t,e,n,i){t=t||{};var r=S(t,W.params.exhibition,"CreateExhibition",i);_("CreateExhibition",e,r.urlOptions,r.bodyOptions,n,!0)}function b(t,e,n,i){t=t||{};var r=S(t,W.params.feedback,"CreateFeedback",i);_("CreateFeedback",e,r.urlOptions,r.bodyOptions,n)}function x(t,e,n,i){t=t||{};var r=S(t,W.params.artwork,"CreateArtwork",i);_("CreateArtwork",e,r.urlOptions,r.bodyOptions,n,!0)}function T(t,e,n,i){t=t||{};var r=S(t,W.params.hotspot,"CreateHotspot",i);_("CreateHotspot",e,r.urlOptions,r.bodyOptions,n,!0)}function w(t,e){C("Doq",e,{Guid:t},!0)}function k(t,e){C("Linq",e,{Guid:t},!0)}function A(t,e,n,i,r,a,o){i=i||{},r=r||{};var a=a||P(e,n),s=-1;"function"==typeof n.get&&(s=n.get(),s||0===s||(s=-1)),r.Count=s;var l={200:W.convertToDocHandler(q.multiFnHandler(i.success,a,I),i.error),304:q.safeCallHandler(i.success,e.get()),401:M(i.unauth),error:q.multiFnHandler(i.error,q.safeCallHandler(i.errorCache,e.get()))};W.asyncRequest("GET",t,r,null,l,o)}function _(t,e,n,i,r,a){e=e||{},n=n||{},n.Token=TAG.Auth.getToken(),n.ReturnDoq=r;var o={200:r&&W.convertToDocHandler(e.success,e.error)||e.success,401:M(e.unauth),error:e.error};W.asyncRequest("PUT",t,n,i,o,a)}function C(t,e,n,i){e=e||{},n=n||{},n.Token=TAG.Auth.getToken(),n.Count=D("doqs",n.Guid).get().Metadata.Count||0;var r={200:e.success,401:M(e.unauth),409:e.conflict,error:e.error};W.asyncRequest("DELETE",t,n,null,r,i)}function E(t,e,n,i,r,a){e=e||{},n=n||{},n.Token=TAG.Auth.getToken();var o=D("doqs",n.Guid).get();0!==a&&(a=a||o&&o.Metadata&&D("doqs",n.Guid).get().Metadata.Count||0),n.Count=a;var s={200:e.success,401:M(e.unauth),409:e.conflict,error:e.error};W.asyncRequest("POST",t,n,i,s,r)}function S(t,e,n,i){var r={},a={};return $.each(t,function(t,o){if(!q.contains(e.url,t)&&!q.contains(e.body,t)){if(i)throw"'"+t+"' is not a valid request parameter for "+n;console.log("Warning: '"+t+"' is not a valid request parameter for "+n)}q.contains(e.body,t)?a[t]=o:r[t]=o}),{bodyOptions:a,urlOptions:r}}function M(t){return function(e,n){TAG.Auth.authenticate(function(){n.setToken(TAG.Auth.getToken()).call()},t)}}function I(t){t&&t[0]?$.each(t,function(t,e){D("doqs",e.Identifier).set(e)}):t&&D("doqs",t.Identifier).set(t)}function D(t,e){var n,i,r=0;"boolean"==typeof e?(i=!e,n=!t,r=2):"boolean"==typeof t&&(n=!t,r=1);for(var a=[],o=r;arguments.length>o;o++)a[o-r]=arguments[o];return{set:function(t){if(!i){for(var e=z,n=0;a.length-1>n;n++)e[a[n]]||(e[a[n]]={}),e=e[a[n]];e[a[n]]=t,V()}},get:function(){if(!n){for(var t=z,e=0;a.length-1>e;e++)t[a[e]]||(t[a[e]]={}),t=t[a[e]];return t[a[e]]}}}}function P(t,e){return function(n,i){t.set(n),e.set(parseInt(i.statusText))}}function N(t){U=t}function G(t){U=t}function O(){return"http://"+U+":"+B}function L(){var t=TAG.Worktop.Database.checkSetting("UseHTTPS");return t&&"true"===t.toLowerCase()?"https://"+U+":"+R:"http://"+U+":"+B}function F(){return"http://"+U+":"+H}var B=TAG.Worktop.Database.HTTP_PORT,R=TAG.Worktop.Database.HTTPS_PORT,H=TAG.Worktop.Database.FILE_PORT;"137.117.37.220"===localStorage.ip&&(localStorage.ip="browntagserver.com");var U=localStorage.ip?localStorage.ip:"browntagserver.com";localStorage.ip=U;var z,j="tag_cache.";if(localStorage[j+U])z=JSON.parse(localStorage[j+U]);else var z={main:null,tours:null,exhibs:null,artworks:null,feedback:null,media:null,doqs:{},doqMedia:{},linqs:{}};t&&z.main&&z.main.Identifier&&t!==z.main.Identifier&&(z={});var W=TAG.Worktop.Database,q=TAG.Util,V=$.debounce(250,function(){localStorage[j+U]=JSON.stringify(z)});return{getURL:O,getFileURL:F,getSecureURL:L,setURL:G,setBaseURL:N,getExhibitions:e,getArtworks:n,getTours:i,getAssocMedia:r,getDoq:o,getFeedback:a,getMain:s,getAssocMediaTo:l,getArtworksAssocTo:c,getLinq:u,getArtworksIn:d,putTour:v,putExhibition:y,putFeedback:b,putArtwork:x,putHotspot:T,postTour:h,postExhibition:p,postArtwork:f,postHotspot:g,postMain:m,deleteDoq:w,deleteLinq:k}},TAG.Util.makeNamespace("Worktop.Doq"),Worktop.Doq=function(t){function e(t){if(void 0!=t){if(!t.Metadata)return null;var e={},n=t.Metadata.Dicts.KeyValueOfguidMetadataDictionaryYwP_PEBe9?t.Metadata.Dicts.KeyValueOfguidMetadataDictionaryYwP_PEBe9.Value.Dict.KeyValueOfstringanyType:[];if(n.length)$.each(n,function(t){var i=n[t].Key,r=n[t].Value.text;e[i]=r});else{var i=n.Key,r=n.Value;e[i]=r}if(t.Metadata=e,t.Metadata&&"string"==typeof t.Metadata.InfoFields)try{t.Metadata.InfoFields=JSON.parse(t.Metadata.InfoFields)}catch(a){t.Metadata.InfoFields={}}}}function n(t){void 0!=t&&t._Folders&&(t.Folders=t._Folders.FolderData)}var i=$.parseXML(t),r=$.xml2json(i);if(r.DoqData){var a=[];return r.DoqData[0]?$.each(r.DoqData,function(){e(this),n(this),a.push(this)}):(e(r.DoqData),n(r.DoqData),a.push(r.DoqData)),a}if(r.LinqData){var o=[];return r.LinqData[0]?$.each(r.LinqData,function(){e(this),o.push(this)}):(e(r.LinqData),o.push(r.LinqData)),o}return e(r),n(r),r},TAG.Util.makeNamespace("TAG.Worktop.Database"),TAG.Worktop.Database=function(){function t(t,e,n){G("HEAD","ClearToken",{Token:t},null,{success:e,error:n},!0)}function e(t,e,n,i){G("HEAD","CheckToken",{Token:t},null,{success:e,401:n,error:i},!0)}function n(t,e,n){oe=oe||new Worktop.Database,oe.getExhibitions({success:t,error:e,errorCache:n})}function i(t,e,n){oe=oe||new Worktop.Database,oe.getFeedback({success:t,error:e,errorCache:n})}function r(t,e,n){oe=oe||new Worktop.Database,oe.getArtworks({success:t,error:e,errorCache:n})}function a(t,e,n){oe=oe||new Worktop.Database,oe.getTours({success:t,error:e,errorCache:n})}function o(t,e,n){var i=[];r(function(r){i=r,a(function(e){t(i.concat(e))},e,n)},e,n)}function s(t,e,n,i){oe=oe||new Worktop.Database,oe.getDoq(t,{success:e,error:n,errorCache:i})}function l(t,e,n){oe=oe||new Worktop.Database,oe.getMain({success:function(e){se=e,t&&t(e)},error:e,errorCache:n})}function c(t,e,n){oe=oe||new Worktop.Database,oe.getAssocMedia({success:t,error:e,errorCache:n})}function u(t,e,n,i,r){oe=oe||new Worktop.Database,oe.getLinq(t,e,{success:n,error:i,errorCache:r})}function d(t,e,n,i){oe=oe||new Worktop.Database,oe.getAssocMediaTo(t,{success:e,error:n,errorCache:i})}function h(t,e,n,i){oe=oe||new Worktop.Database,oe.getArtworksAssocTo(t,{success:e,error:n,errorCache:i})}function p(t,e,n,i){oe=oe||new Worktop.Database,oe.getArtworksIn(t,{success:e,error:n,errorCache:i})}function f(t,e){G("GET","Salt",null,null,{success:P(t),error:e},!0)}function g(t,e,n,i,r){G("GET","Auth",{Hash:TAG.Auth.hashPass(t,e)},null,{success:P(n),401:i,error:r},!0)}function m(t,e){G("GET","CheckVersion",null,null,{success:N(t),error:e})}function v(t,e,n,i,r,a){G("POST","ChangePassword",{OldHash:TAG.Auth.hashPass(t,e),NewPass:n},null,{success:P(i),unauth:r,error:a},!0)}function y(t,e,n,i,r){oe=oe||new Worktop.Database,oe.putTour(t,{success:e,error:i,unauth:n},r,he)}function b(t,e,n,i,r){oe=oe||new Worktop.Database,oe.putExhibition(t,{success:e,error:i,unauth:n},r,he)}function x(t,e,n,i,r){oe=oe||new Worktop.Database,t=t||"No Text",oe.putFeedback({SourceID:n,SourceType:e,Description:t},{success:i,error:r},!1,he)}function T(t,e,n,i,r){oe=oe||new Worktop.Database,oe.putArtwork(t,{success:e,error:i,unauth:n},r,he)}function w(t,e,n,i,r){oe=oe||new Worktop.Database,oe.putHotspot(t,{success:e,error:i,unauth:n},r,he)}function k(t,e,n,i,r,a){oe=oe||new Worktop.Database,"string"!=typeof t&&t&&t.Identifier&&(t=t.Identifier),oe.postTour(t,e,{success:n,unauth:i,conflict:r,error:a},he)}function A(t,e,n,i,r,a){oe=oe||new Worktop.Database,"string"!=typeof t&&t&&t.Identifier&&(t=t.Identifier),oe.postExhibition(t,e,{success:n,unauth:i,conflict:r,error:a},he)}function _(t,e,n,i,r,a){oe=oe||new Worktop.Database,"string"!=typeof t&&t&&t.Identifier&&(t=t.Identifier),oe.postArtwork(t,e,{success:n,unauth:i,conflict:r,error:a},he)}function C(t,e,n,i,r,a){oe=oe||new Worktop.Database,"string"!=typeof t&&t&&t.Identifier&&(t=t.Identifier),oe.postHotspot(t,e,{success:n,unauth:i,conflict:r,error:a},he)}function E(t,e,n,i,r){oe=oe||new Worktop.Database,oe.postMain(t,{success:e,unauth:n,conflict:i,error:r},he)}function S(t,e,n,i){G("POST","FileUploadDataURL",{Token:TAG.Auth.getToken()},null,{success:P(e),unauth:n,error:i},!0,t)}function M(t,e,n,i,r){oe=oe||new Worktop.Database,"string"!=typeof t&&t&&t.Identifier&&(t=t.Identifier),oe.deleteDoq(t,{success:e,error:r,unauth:n,conflict:i})}function I(t,e,n,i,r){oe=oe||new Worktop.Database,"string"!=typeof t&&t&&t.Identifier&&(t=t.Identifier),oe.deleteLinq(t,{success:e,error:r,unauth:n,conflict:i})}function D(t,e){return function(n,i){var r;try{r=new Worktop.Doq(n.responseText)}catch(a){de.safeCall(e,n,i)}r&&(r.Name||r.Offset)?de.safeCall(t,r,n):r&&r[0]?de.safeCall(t,r,n):r&&de.safeCall(t,[],n)}}function P(t){return function(e){de.safeCall(t,e.responseText)}}function N(t){return function(e){de.safeCall(t,e.statusText)}}function G(t,e,n,i,r,a,o,s){if(!e)return!1;r=r||{},n=n||{},i=i||{},n.Force="true";var l=(s?s:a?oe.getSecureURL():oe.getURL())+"/?Type="+e;$.each(n,function(t,e){l=l+"&"+t+"="+escape(e)});var c,u;Object.keys(i).length&&(c=L(i),u="Boundary:"+c,c="\r\n"+c+"\r\n",$.each(i,function(t,e){u=u+c+t+":"+e}));var d={call:function(){$.ajax({type:t,url:l,cache:!1,dataType:"text",async:!0,processData:!1,data:o||u,success:function(t,e,n){r[n.status]||de.safeCall(r.success,n,d),de.safeCall(r[n.status],n,d)},error:function(t){r[t.status]||de.safeCall(r.error,t,d),de.safeCall(r[t.status],t,d)}})},force:function(){l+="&Force=true",d.call()},setToken:function(t){return l=O(l),l=l+"&Token="+t,d}};d.call()}function O(t){var e=t.indexOf("&Token="),n=t.indexOf("&",e+1),i=t.substring(e,n);
return t.replace(i,"")}function L(t){var e="----",n=!1;do n=!1,e+="-",$.each(t,function(t,i){return TAG.Util.contains(t,e)?(n=!0,!1):TAG.Util.contains(i,e)?(n=!0,!1):void 0});while(n);return e}function F(t,e){return e?(oe.getMain({success:function(n){e(n.Metadata["Setting_"+t])}}),void 0):se.Metadata["Setting_"+t]}function B(){return se.Metadata.MuseumName}function R(){return se.Metadata.OverlayColor}function H(){return se.Metadata.OverlayTransparency}function U(){return se.Metadata.MuseumLoc}function z(){return se.Metadata.MuseumInfo}function j(){return se.Metadata.BaseFontSize||"1.77"}function W(){return se.Metadata.BackgroundColor||"#000000"}function q(){return se.Metadata.PrimaryFontColor||"#FFFFFF"}function V(){return se.Metadata.SecondaryFontColor||"#FFFFFF"}function Y(){return TAG.Worktop.Database.fixPath(se.Metadata.BackgroundImage)}function X(){return TAG.Worktop.Database.fixPath(se.Metadata.Icon)}function K(){return se.Metadata.IconColor}function Z(){return se.Metadata.BackgroundOpacity||"75"}function Q(){return se.Metadata.FontFamily||"Source Sans Pro"}function J(){return oe.getURL()}function te(){return oe.getSecureURL()}function ee(){return oe.getFileURL()}function ne(t){oe.setURL(t)}function ie(t,e){TAG.Auth.authenticate(t,e)}function re(t,e,n,i){function r(){function e(e){e.statusText;var i=e.responseText;localStorage.ip=t,oe=new Worktop.Database(i),n&&n()}function r(){i&&i()}G("GET","CheckVersion",null,null,{success:e,error:r},!1,null,"http://"+t+":8080")}t=TAG.Util.formatAddress(t),e?f(function(t){g(e,t,r,i,i)},i):r()}function ae(t){return t?-1!==t.indexOf("blob:")?t:(-1!==t.indexOf("http")&&(t=t.replace(/http.?.?\/\/[^\/]*/,"")),0!==t.indexOf("/")&&(t="/"+t),oe.getFileURL()+t):void 0}var oe,se,le="8080",ce="9001",ue="8086",de=TAG.Util,he=!0,pe={exhibition:{url:["Name","Sub1","Sub2","Background","Img1","Img2","Private"],body:["Description","AddIDs","RemoveIDs"]},artwork:{url:["Name","Title","Artist","Year","Preview","Thumbnail","Deepzoom","Source","Duration"],body:["Description","Location","AddIDs","RemoveIDs","InfoFields","Duration"]},tour:{url:["Name","Thumbnail","Private"],body:["Description","Content","RelatedArtworks"]},hotspot:{url:["Name","ContentType","Duration","Source","LinqTo","X","Y","LinqType","Thumbnail"],body:["Description","AddIDs","RemoveIDs"]},feedback:{url:["SourceID","SourceType"],body:["Description"]},main:{url:["Name","OverlayColor","OverlayTrans","Location","Background","Icon","IconColor","BackgroundColor","BackgroundOpacity","PrimaryFontColor","SecondaryFontColor","FontFamily"],body:["Info"]}};return{HTTP_PORT:le,HTTPS_PORT:ce,FILE_PORT:ue,getURL:J,getSecureURL:te,setURL:ne,getFileURL:ee,fixPath:ae,checkAuth:ie,changeServer:re,checkSetting:F,getMuseumName:B,getMuseumLoc:U,getMuseumInfo:z,getStartPageBackground:Y,getMuseumLogo:X,getMuseumOverlayColor:R,getMuseumOverlayTransparency:H,getLogoBackgroundColor:K,getBaseFontSize:j,getBackgroundColor:W,getBackgroundOpacity:Z,getPrimaryFontColor:q,getSecondaryFontColor:V,getFontFamily:Q,asyncRequest:G,convertToDocHandler:D,params:pe,convertToTextHandler:P,clearToken:t,checkToken:e,getExhibitions:n,getFeedback:i,getArtworks:r,getTours:a,getArtworksAndTours:o,getMain:l,getAssocMedia:c,getLinq:u,getAssocMediaTo:d,getArtworksAssocTo:h,getArtworksIn:p,getSalt:f,getAuth:g,getVersion:m,getDoq:s,changePass:v,deleteDoq:M,deleteLinq:I,createTour:y,createExhibition:b,createFeedback:x,createArtwork:T,createHotspot:w,changeTour:k,changeExhibition:A,changeArtwork:_,changeHotspot:C,changeMain:E,uploadImage:S}}(),TAG.Util.makeNamespace("TAG.AnnotatedImage"),TAG.AnnotatedImage=function(t){"use strict";function e(){return A}function n(){return g}function i(){return k}function r(t){return m&&t&&t.Metadata&&t.Metadata.DeepZoom?(m.openDzi(w(t.Metadata.DeepZoom)),!0):(console.log("ERROR IN openDZI"),!1)}function a(t,e,n){m.isOpen()?(m.drawer.addOverlay(t,e,n),m.drawer.updateOverlay(t,e,n)):m.addEventListener("open",function(){m.drawer.addOverlay(t,e,n),m.drawer.updateOverlay(t,e,n)})}function o(t){m.isOpen()?m.drawer.removeOverlay(t):m.addEventListener("open",function(){m.drawer.removeOverlay(t)})}function s(){m&&m.unload()}function l(){g={height:_,width:C},A=c,TAG.Util.IdleTimer.restartTimer()}function c(t){var e=t.scale,n=t.translation,i=t.pivot;l(),m.viewport.zoomBy(e,m.viewport.pointFromPixel(new Seadragon.Point(i.x,i.y)),!1),m.viewport.panBy(m.viewport.deltaPointsFromPixels(new Seadragon.Point(n.x,n.y)),!1),m.viewport.applyConstraints()}function u(t,e){c({scale:t,translation:{x:0,y:0},pivot:e})}function d(){var t,e;Seadragon.Config&&(Seadragon.Config.visibilityRatio=.8),t=$(document.createElement("div")),t.attr("id","annotatedImageViewer"),t.on("mousedown scroll click mousemove resize",function(t){t.preventDefault()}),y.append(t),m=new Seadragon.Viewer(t[0]),m.setMouseNavEnabled(!1),m.clearControls(),e=$(m.canvas),e.addClass("artworkCanvasTesting"),TAG.Util.makeManipulatable(e[0],{onScroll:function(t,e){u(t,e)},onManipulate:function(t){t.translation.x=-t.translation.x,t.translation.y=-t.translation.y,c(t)}},null,!0),v=$(document.createElement("div")),v.attr("id","annotatedImageAssetCanvas"),y.append(v),T?setTimeout(function(){x&&x()},1):p(x)}function h(t){m.addEventListener("animation",t)}function p(t){function e(e){var r;if(i=e?e.length:0,i>0)for(r=0;e.length>r;r++)TAG.Worktop.Database.getLinq(b.Identifier,e[r].Identifier,n(e[r]),null,n(e[r]));else t&&t(k)}function n(e){return function(n){k[e.Identifier]=f(e,n),k.guids.push(e.Identifier),++r>=i&&t&&t(k)}}var i,r=0;TAG.Worktop.Database.getAssocMediaTo(b.Identifier,e,null,e)}function f(t,e){function n(){F.css("width",Math.min(Math.max(250,C/5),450)+"px"),B.css("backgroundColor","rgba(0,0,0,0.65)"),j&&(P=$(document.createElement("div")),P.addClass("annotatedImageMediaTitle"),P.text(j),B.append(P)),B.append(R),V&&(N=$(document.createElement("div")),N.addClass("annotatedImageMediaDescription"),N.html(Autolinker.link(V,{email:!1,twitter:!1})),B.append(N)),F.append(B),v.append(F),F.hide(),H&&(E=$(document.createElement("img")),S=new Seadragon.Point(U,z),E.attr("src",tagPath+"images/icons/hotspot_circle.svg"),E.addClass("annotatedImageHotspotCircle"),y.append(E)),TAG.Util.disableDrag(F),TAG.Util.makeManipulatable(F[0],{onManipulate:c,onScroll:d},null,!0)}function i(){var e=D,n=$(e),i=$(document.createElement("div")).addClass("annotatedImageMediaControlPanel"),r=$(document.createElement("img")).addClass("mediaVolButton"),a=$(document.createElement("div")).addClass("mediaTimeContainer"),o=$(document.createElement("span")).addClass("mediaTimeDisplay"),s=$(document.createElement("div")).addClass("mediaPlayHolder"),l=$(document.createElement("div")).addClass("mediaVolHolder"),c=$(document.createElement("div")).addClass("mediaSliderContainer"),u=$(document.createElement("div")).addClass("mediaSliderPoint");i.attr("id","media-control-panel-"+t.Identifier),L=$(document.createElement("img")).addClass("mediaPlayButton"),L.attr("src",tagPath+"images/icons/PlayWhite.svg"),r.attr("src",tagPath+"images/icons/VolumeUpWhite.svg"),o.text("00:00"),L.css({position:"relative",height:"20px",width:"20px",display:"inline-block"}),s.css({position:"relative",height:"20px",width:"20px",display:"inline-block",margin:"2px 1% 0px 1%"}),c.css({position:"absolute",height:"15px",width:"100%",left:"0px",bottom:"0px"}),u.css({position:"absolute",height:"100%","background-color":"#3cf",width:"0%",left:"0%"}),r.css({height:"20px",width:"20px",position:"relative",display:"inline-block"}),l.css({height:"20px",width:"20px",position:"absolute",right:"5px",top:"2px"}),a.css({height:"20px",width:"40px",right:l.width()+25+"px",position:"absolute","vertical-align":"top",padding:"0",display:"inline-block",overflow:"hidden"}),s.append(L),c.append(u),l.append(r),L.on("click",function(){e.paused?(e.play(),L.attr("src",tagPath+"images/icons/PauseWhite.svg")):(e.pause(),L.attr("src",tagPath+"images/icons/PlayWhite.svg"))}),r.on("click",function(){e.muted?(e.muted=!1,r.attr("src",tagPath+"images/icons/VolumeUpWhite.svg")):(e.muted=!0,r.attr("src",tagPath+"images/icons/VolumeDownWhite.svg"))}),n.on("ended",function(){e.pause(),L.attr("src",tagPath+"images/icons/PlayWhite.svg")}),c.on("mousedown",function(t){var n=e.duration*((t.pageX-$(t.target).offset().left)/c.width()),i=t.pageX,r=e.duration/c.width(),a=Math.max(0,Math.min(e.duration,e.currentTime)),s=n,l=a/r,d=Math.floor(a/60),h=Math.floor(a%60),p=10>d?"0"+d:d,f=10>h?"0"+h:h;t.stopPropagation(),isNaN(n)||(o.text(p+":"+f),e.currentTime=n,u.css("width",100*(l/c.width())+"%")),c.on("mousemove.seek",function(t){var n=t.pageX,g=(n-i)*r;a=Math.max(0,Math.min(e.duration,s+g)),l=a/r,d=Math.floor(a/60),h=Math.floor(a%60),p=10>d?"0"+d:d,f=10>h?"0"+h:h,isNaN(a)||(o.text(p+":"+f),e.currentTime=a,u.css("width",100*(l/c.width())+"%"))}),$("body").on("mouseup.seek mouseleave.seek",function(){c.off("mouseup.seek mouseleave.seek mousemove.seek")})}),n.on("timeupdate",function(){var t=(100*e.currentTime/e.duration,e.duration/c.width()),n=e.currentTime/t,i=Math.floor(e.currentTime/60),r=Math.floor(e.currentTime%60),a=10>i?"0"+i:i,s=10>r?"0"+r:r;isNaN(e.currentTime)||(o.text(a+":"+s),u.css("width",100*(n/c.width())+"%"))}),R.append(e),R.append(i),i.append(s),i.append(c),a.append(o),i.append(a),i.append(l)}function r(){var t,e,n=h();R.append(n[0]),n.on("click",function(t){t.stopPropagation(),b()}),M||(M=!0,"Image"===W?(e=document.createElement("img"),e.src=w(q),$(e).css({position:"relative",width:"100%",height:"auto"}),R.append(e),M=!0):"Video"===W?(D=document.createElement("video"),t=$(D),t.attr({preload:"none",poster:Y&&!Y.match(/.mp4/)?w(Y):"",src:w(q),type:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',controls:!1}),t.css({position:"relative",width:"100%"}),i(D)):"Audio"===W&&(D=document.createElement("audio"),t=$(D),t.attr({preload:"none",type:"audio/mp3",src:w(q),controls:!1}),i(D),t.on("error",function(){console.log("Here's an error ")})))}function s(){var t=F.width(),e=F.height();g={height:e,width:t},A=c,$(".mediaOuterContainer").css("z-index",1e3),F.css("z-index",1001),TAG.Util.IdleTimer.restartTimer()}function c(t){if(!X&&t){var e,n,i,r,a,o,l,c=t.scale,d=t.translation,h=t.pivot,p=parseFloat(F.css("top")),f=parseFloat(F.css("left")),g=F.width(),v=F.height(),y=50,x=g*c;if("start"===t.eventType&&(O={x:f,y:p}),"Image"===W?(e=3e3,n=200):"Video"===W?(e=1e3,n=250):"Audio"===W&&(e=800,n=250),(n>x||x>e)&&(x=Math.min(e,Math.max(n,x)),c=x/g),x===g){if(!(p+v>0&&_>p&&f+g>0&&C>f))return b(),k(),void 0;o=Date.now(),i=t.eventType?{x:f,y:p}:{x:F.position().left,y:F.position().top},a=t.center?{x:t.center.pageX-(t.startEvent.center.pageX-O.x),y:t.center.pageY-(t.startEvent.center.pageY-O.y)}:{x:i.x+t.translation.x,y:i.y+t.translation.y},r={x:a.x-i.x,y:a.y-i.y},l={x:r.x/y,y:r.y/y},u(l,i,a,y/50),m.viewport.applyConstraints()}else F.css("top",p+d.y+(1-c)*h.y+"px"),F.css("left",f+d.x+(1-c)*h.x+"px"),F.css("width",x+"px"),F.css("height","auto");s()}}function u(t,e,n,i){var r,a;if(!(F.position().top+F.height()>0&&_>F.position().top&&F.position().left+F.width()>0&&C>F.position().left))return b(),k(),void 0;if(!(.1>Math.abs(t.x)&&.1>Math.abs(t.y))){r={x:e.x+i*t.x,y:e.y+i*t.y},a={x:(n.x-r.x)/(50*i),y:(n.y-r.y)/(50*i)},F.css({left:r.x,top:r.y});for(var o=0;K.length>o;o++)clearTimeout(K[o]);K=[],K.push(setTimeout(function(){u(a,r,n,i)},1))}}function d(t,e){c({scale:t,translation:{x:0,y:0},pivot:e})}function h(){var t=$(document.createElement("img"));return t.attr("src",tagPath+"images/icons/x.svg"),t.text("X"),t.css({position:"absolute",top:"0%",width:"4%",height:"4%","z-index":"1","background-color":"","margin-left":"95%"}),t}function f(){var e,n,i=F.height();F.width(),H?(E.css("visibility","visible"),a(E[0],S,Seadragon.OverlayPlacement.TOP_LEFT),m.viewport.panTo(S,!1),m.viewport.applyConstraints(),e=m.viewport.pixelFromPoint(S).y-i/2+Z/2,n=m.viewport.pixelFromPoint(S).x+Z):(e=1*_/10+2*Math.random()*_/10,n=3*C/10+2*Math.random()*C/10),F.css({top:e+"px",left:n+"px",position:"absolute","z-index":1e3,"pointer-events":"all"}),F.show(),v.append(F),G||(G=$("#thumbnailButton-"+t.Identifier)),G.css({color:"black","background-color":"rgba(255,255,255, 0.3)"}),I=!1}function b(){k(),H&&o(E[0]),F.hide(),I=!0,G||(G=$("#thumbnailButton-"+t.Identifier)),G.css({color:"white","background-color":""}),TAG.Util.IdleTimer.restartTimer(),l()}function x(){I?f():b()}function T(){return!I}function k(){!D||4>D.readyState||(D.currentTime=0,D.pause(),L.attr("src",tagPath+"images/icons/PlayWhite.svg"))}var E,S,M,I,D,P,N,G,O,L,F=$(document.createElement("div")).addClass("mediaOuterContainer"),B=$(document.createElement("div")).addClass("mediaInnerContainer"),R=$(document.createElement("div")).addClass("mediaMediaContainer"),H=e.Metadata.Type?"Hotspot"===e.Metadata.Type:!1,U=parseFloat(e.Offset._x),z=parseFloat(e.Offset._y),j=TAG.Util.htmlEntityDecode(t.Name),W=t.Metadata.ContentType,q=t.Metadata.Source,V=TAG.Util.htmlEntityDecode(t.Metadata.Description),Y=t.Metadata.Thumbnail,I=!0,X=!1,K=[],Z=60;return n(),F.on("click",function(t){t.stopPropagation(),t.preventDefault(),TAG.Util.IdleTimer.restartTimer(),s()}),{doq:t,linq:e,show:f,hide:b,create:r,pauseReset:k,toggle:x,createMediaElements:r,isVisible:T,mediaManipPreprocessing:s,loadAssociatedMedia:p}}var g,m,v,y=t.root,b=t.doq,x=t.callback,T=t.noMedia,w=TAG.Worktop.Database.fixPath,k=(b.Name,{guids:[]}),A=c,_=$("#tagRoot").height(),C=$("#tagRoot").width(),g={height:_,width:C};return d(),{getAssociatedMedia:i,unload:s,dzManip:c,dzScroll:u,openArtwork:r,addAnimateHandler:h,getToManip:e,getMediaDimensions:n,dzManipPreprocessing:l,viewer:m}};var TAG=TAG||{};TAG.Auth=function(){"use strict";function t(){return TAG.AuthToken||null}function e(){TAG.Worktop.Database.clearToken(TAG.AuthToken),TAG.AuthToken=null}function n(t,e){for(var n=t+e,i=CryptoJS.SHA256(n),r=0;1023>r;r++)i=CryptoJS.SHA256(i);return i}function i(t,e,n,i){TAG.Worktop.Database.getSalt(function(r){TAG.Worktop.Database.getAuth(t,r,function(t){TAG.AuthToken=t,e()},n,i)},i)}function r(t,e,n,i,r){return a(e)?(TAG.Worktop.Database.getSalt(function(a){TAG.Worktop.Database.changePass(t,a,e,function(t){TAG.AuthToken=t,n()},i,r)}),void 0):(i("Password must contain at least 8 characters with 3 of the following types:<br>Lowercase letter<br>Uppercase letter<br>Number<br>Symbol"),void 0)}function a(t){if(t&&t.length>=8){var e=0;if(t.match(/(?=.*[a-z])/)&&e++,t.match(/(?=.*[A-Z])/)&&e++,t.match(/(?=.*[\d])/)&&e++,t.match(/(?=.*[\W])/)&&e++,e>=3)return!0}return!1}function o(t,e){function n(){$("#startPageRoot").append(TAG.AuthOverlay),TAG.AuthInput.val(""),TAG.AuthOverlay.fadeIn(500),TAG.AuthInput.focus(),TAG.AuthSubmit.show(),TAG.AuthCancel.show(),TAG.AuthCancel.click(function(){TAG.AuthError.hide(),TAG.AuthCircle.hide(),TAG.AuthOverlay.fadeOut(500,function(){TAG.AuthOverlay.remove(),e&&e()})}),TAG.AuthSubmit.click(function(){TAG.AuthError.hide(),TAG.AuthCircle.show(),TAG.AuthSubmit.hide(),TAG.AuthCancel.hide(),i(TAG.AuthInput.val(),function(){TAG.AuthError.hide(),TAG.AuthCircle.hide(),TAG.AuthOverlay.remove(),t()},function(){TAG.AuthError.html("Invalid Password. Please try again..."),TAG.AuthError.show(),TAG.AuthCircle.hide(),TAG.AuthSubmit.show(),TAG.AuthCancel.show()},function(){TAG.AuthError.html("There was an error contacting the server. Contact a server administrator if this error persists."),TAG.AuthError.show(),TAG.AuthError.css({bottom:"30%"}),TAG.AuthCircle.hide(),TAG.AuthSubmit.show(),TAG.AuthCancel.show()})}),TAG.AuthInput.keypress(function(e){13===e.which&&(TAG.AuthError.hide(),TAG.AuthCircle.show(),TAG.AuthSubmit.hide(),TAG.AuthCancel.hide(),i(TAG.AuthInput.val(),function(){TAG.AuthError.hide(),TAG.AuthCircle.hide(),TAG.AuthOverlay.remove(),t()},function(){TAG.AuthError.html("Invalid Password. Please try again..."),TAG.AuthError.show(),TAG.AuthCircle.hide(),TAG.AuthSubmit.show(),TAG.AuthCancel.show()},function(){TAG.AuthError.html("There was an error contacting the server. Contact a server administrator if this error persists."),TAG.AuthError.show(),TAG.AuthError.css({bottom:"30%"}),TAG.AuthCircle.hide(),TAG.AuthSubmit.show(),TAG.AuthCancel.show()}))})}c=t,TAG.AuthToken?TAG.Worktop.Database.checkToken(TAG.AuthToken,t,n,n):n()}function s(){var t=$(document.createElement("div"));t.attr("id","loginOverlay");var e=$(document.createElement("div"));e.attr("id","loginDialog"),u=e,t.css({display:"none",position:"absolute",top:0,left:0,width:"100%",height:"100%","background-color":"rgba(0,0,0,0.6)","z-index":100000002});var n=TAG.Util.constrainAndPosition($(window).width(),$(window).height(),{center_h:!0,center_v:!0,width:.5,height:.35,max_width:560,max_height:210});e.css({position:"absolute",top:n.y+"px",width:n.width+"px",height:n.height-20+"px",left:n.x-75.5+"px",border:"3px double white","background-color":"black"}),t.append(e);var i=$(document.createElement("div"));i.attr("id","dialogTitle"),i.css({color:"white",width:"80%",height:"15%",left:"10%",top:"12.5%",position:"relative","text-align":"center"}),i.text("Please enter authoring mode password.");var r=$(document.createElement("input"));r.attr({type:"password",id:"password",name:"password",placeholder:"password"}),r.css({display:"block",position:"relative",margin:"auto","margin-top":"5%","margin-bottom":"5%"});var a=$(document.createElement("div"));a.attr("id","errorMessage"),a.css({color:"white","margin-bottom":"10px",left:"10%",width:"80%","text-align":"center",bottom:"36%",position:"absolute"}),a.html("Invalid Password. Please try again..."),a.hide();var o=$(document.createElement("div"));o.css({position:"relative",display:"block",width:"80%",left:"10%",bottom:"0%"});var s=$(document.createElement("button"));s.css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","margin-top":"1%","margin-left":"-2%",display:"inline-block"});var l=$(document.createElement("img"));l.css({width:"20px",height:"auto",display:"none","margin-right":"3%","margin-top":"2.5%","float":"right"}),l.attr("src",tagPath+"images/icons/progress-circle.gif"),s.text("Submit");var c=$(document.createElement("button"));return c.attr("type","button"),c.css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","margin-top":"1%","float":"right","margin-right":"-2%",display:"inline-block"}),c.text("Cancel"),e.append(i),e.append(r),e.append(a),e.append(o),o.append(c),o.append(s),o.append(l),{overlay:t,input:r,submit:s,cancel:c,error:a,circle:l}}if(!TAG.AuthOverlay){var l=s();TAG.AuthOverlay=l.overlay,TAG.AuthSubmit=l.submit,TAG.AuthCancel=l.cancel,TAG.AuthInput=l.input,TAG.AuthError=l.error,TAG.AuthCircle=l.circle;var c,u}return{getToken:t,clearToken:e,authenticate:o,hashPass:n,changePassword:r}}(),TAG.Util.makeNamespace("TAG.Layout.StartPage"),TAG.Layout.StartPage=function(t,e){"use strict";function n(t){var e=t&&t.internetURL||"http://www.google.com/";console.log("checking server url: "+v),$.ajax({url:v,dataType:"text",async:!0,cache:!1,success:function(){console.log("success checking server url"),i()},error:function(){$.ajax({url:e,dataType:"text",async:!1,cache:!1,success:function(){y.empty(),y.append(new TAG.Layout.InternetFailurePage("Server Down").getRoot())},error:function(){y.empty(),y.append(new TAG.Layout.InternetFailurePage("No Internet").getRoot())}})}})}function i(){TAG.Worktop.Database.getMain(r,function(){y.empty(),y.append(new TAG.Layout.InternetFailurePage("Server Down").getRoot())})}function r(t){function n(){var t;x.off("click"),t=TAG.Layout.CollectionsPage(),TAG.Util.UI.slidePageLeft(t.getRoot()),currentPage.name=TAG.Util.Constants.pages.COLLECTIONS_PAGE,currentPage.obj=t}e&&e(b),TAG.Util.Constants.set("START_PAGE_SPLASH",tagPath+"images/birdtextile.jpg"),allowServerChange||$("#serverTagBuffer").remove(),allowAuthoringMode||$("#authoringButtonBuffer").remove(),x.on("click",n),u(t),d(),h(t),c(),A.on("click",f),_.on("click",function(t){t.stopPropagation()}),a()||s()}function a(){console.log("\n///// Browser Compatibility /////");var t=navigator.userAgent.toLowerCase();if(console.log("userAgent: "+navigator.userAgent),t.indexOf("android")>=0||t.indexOf("iphone")>=0||t.indexOf("ipad")>=0||t.indexOf("ipod")>=0)return t.indexOf("android")>=0?console.log("Detected Android Device. Unsupported browser."):t.indexOf("iphone")>=0?console.log("Detected iPhone. Unsupported browser."):t.indexOf("ipad")>=0?console.log("Detected iPad. Unsupported browser."):t.indexOf("ipod")>=0&&console.log("Detected iPod. Unsupported browser."),!1;var e=o();console.log("Browser Version: "+e),e=e.toLowerCase();var n=0;if(e.indexOf("opera")>=0||t.indexOf("opr")>=0)return console.log("Detected Opera. Unsupported browser."),!1;if(e.indexOf("chrome")>=0)return n=e.substring(e.indexOf(" ")+1,e.indexOf(".")),console.log("Detected Chrome Version: "+n),n>=31;if(e.indexOf("safari")>=0){var i=e.substring(e.indexOf(" ",e.indexOf(" ")+1)+1);return n=i.substring(0,i.indexOf(".")),console.log("Detected Safari Version: "+n),n>=7}return e.indexOf("firefox")>=0?(n=e.substring(e.indexOf(" ")+1,e.indexOf(".")),console.log("Detected Firefox Version: "+n),n>=28):e.indexOf("msie")>=0||e.indexOf("ie")>=0?(n=e.substring(e.indexOf(" ")+1,e.indexOf(".")),console.log("Detected IE Version: "+n),n>=10):(console.log("Unsupported browser."),!1)}function o(){var t,e=navigator.userAgent,n=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];return/trident/i.test(n[1])?(t=/\brv[ :]+(\d+(\.\d+)?)/g.exec(e)||[],"IE "+(t[1]||"")):(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(t=e.match(/version\/([\.\d]+)/i))&&(n[2]=t[1]),n.join(" "))}function s(){var t=$("#tagRoot"),e=$(document.createElement("div"));e.attr("id","browserDialogOverlay"),e.addClass("dialogBoxOverlay"),t.prepend(e);var n=$(document.createElement("div"));n.attr("id","browserDialogContainer"),n.addClass("dialogBoxContainer"),e.append(n);var i=$(document.createElement("div"));i.attr("id","browserDialog"),i.addClass("dialogBox"),n.append(i);var r=$(document.createElement("p"));r.attr("id","dialogBoxPara"),r.text("Touch Art Gallery is not supported in your browser. Please download or update to a newer browser."),i.append(r);var a=$(document.createElement("div"));a.attr("id","browserIcons"),i.append(a);for(var o=$(document.createElement("a")).attr("href","http://windows.microsoft.com/ie"),s=$(document.createElement("a")).attr("href","https://www.google.com/chrome"),l=$(document.createElement("a")).attr("href","http://www.firefox.com"),c=$(document.createElement("a")).attr("href","http://www.apple.com/safari"),u=[o,s,l,c],d=0;u.length>d;d++){var h=u[d];h.attr("target","_blank"),h.addClass("browserIconLink")}a.append(o,s,l,c);var p=$(document.createElement("img")).attr("title","Internet Explorer").attr("src",tagPath+"images/icons/browserIcons/ie.png"),f=$(document.createElement("img")).attr("title","Google Chrome").attr("src",tagPath+"images/icons/browserIcons/chrome.png"),g=$(document.createElement("img")).attr("title","Firefox").attr("src",tagPath+"images/icons/browserIcons/firefox.png"),m=$(document.createElement("img")).attr("title","Safari").attr("src",tagPath+"images/icons/browserIcons/safari.png");o.append(p),s.append(f),l.append(g),c.append(m),$("#browserIcons a img").addClass("browserIcon")}function l(){var t,e,n,i;TAG.Util.elementInDocument(museumName)&&(i=parseInt(museumLoc.css("font-size"),10),t=museumName.height(),n=museumName.height(),museumNameSpan.css("height",e))}function c(){E.on("click",function(t){t.stopPropagation()}),k.on("click",function(){serverSaveButton=TAG.Util.UI.ChangeServerDialog()}),w.on("click",function(t){t.stopPropagation()}),x.on("click","a",function(t){$(this).attr("href"),t.stopPropagation()})}function u(t){var e,n,i,r,a;b.find("#expandImage").attr("src",tagPath+"images/icons/Left.png"),b.find("#handGif").attr("src",tagPath+"images/RippleNewSmall.gif"),e=b.find("#background"),e.css("background-image","url("+TAG.Worktop.Database.fixPath(t.Metadata.BackgroundImage)+")"),n=t.Metadata.OverlayColor,i=t.Metadata.OverlayTransparency,C=TAG.Util.UI.hexToRGB(n)+i+")",r="#"+t.Metadata.IconColor,E=b.find("#logoContainer"),E.css({"background-color":r}),a=b.find("#logo"),a.attr("src",TAG.Worktop.Database.fixPath(t.Metadata.Icon))}function d(){function t(t){t.stopPropagation(),o?(o=!1,i.css({transform:"scaleX(1)"}),n.animate({width:"15%","border-top-left-radius":"0px"},700),e.animate({width:"20%",height:"10%",right:"0%","border-top-left-radius":"0px"},700),l.remove(),c.remove(),a.animate({left:"20%",top:"60%","font-size":"90%"},700),r.animate({left:"20%",top:"10%","font-size":"200%"},700),s.animate({left:"75%",top:"75%","font-size":"0%"},500)):(o=!0,n.animate({width:"8%","border-top-left-radius":"20px"},700),e.animate({width:"60%",height:"25%",right:"0%","border-top-left-radius":"20px"},700),e.append(s),e.append(l),e.append(c),i.css({transform:"scaleX(-1)"}),s.css({right:"0%",bottom:"0%",position:"absolute","font-size":"0%"}),s.animate({left:"12%",top:"51%",position:"absolute","font-size":"61%"},700,"swing",function(){$(s).fitText(5)}),r.animate({left:"12%",top:"3%","font-size":"300%"},700),a.animate({left:"12%",top:"35%","font-size":"130%"},700))}var e,n,i,r,a,o,s,l,c;e=b.find("#brownInfoBox"),e.on("click",t),n=b.find("#expandInfoButton"),i=b.find("#expandImage"),r=b.find("#tagName"),a=b.find("#fullTag"),o=!1,s=$(document.createElement("div")),s.attr("id","brownPeople"),s.text("Brown University \nHello"),l=$(document.createElement("label")),l.attr("id","sponsoredText"),l.css("overflow","hidden"),l.css("white-space","pre"),l.text("Sponsored by"),c=$(document.createElement("img")),c.attr("id","microsoftLogo"),c.attr("src",tagPath+"images/icons/MicrosoftLogo.png")}function h(t){var e,n;e=b.find("#infoTextHolder"),n=b.find("#infoDiv"),n.css({"background-color":C}),S=b.find("#touchHint"),M=b.find("#handGif"),p(t)}function p(t){var e,n,i,r,a,o,s,c,u,d,h;d=t.Metadata.PrimaryFontColor,h=t.Metadata.SecondaryFontColor,e=b.find("#museumName"),n=b.find("#museumNameSpan"),i=t.Metadata.MuseumName,void 0===i&&(i=""),n.text(i),r=b.find("#museumLoc"),a=b.find("#museumLocSpan"),o=t.Metadata.MuseumLoc,void 0===o&&(o=""),a.text(o),I.fixText=l,s=b.find("#museumInfoDiv"),c=b.find("#museumInfoSpan"),u=t.Metadata.MuseumInfo,u||(u=""),"undefined"!=typeof Windows?c.html(u):c.html(Autolinker.link(u,{email:!1,twitter:!1})),$(T).css({color:"#"+d,"font-family":t.Metadata.FontFamily})}function f(){TAG.Auth.authenticate(g),"tagtestserver.cloudapp.net"===localStorage.ip&&$("#password").attr("value","Test1234")}function g(){x.on("click",function(){}),A.off("click");var t=new TAG.Authoring.SettingsView;TAG.Util.UI.slidePageLeft(t.that.getRoot())}function m(){return b}t=TAG.Util.setToDefaults(t,TAG.Layout.StartPage.default_options),t.tagContainer=$("#tagRoot");var v,y,b=TAG.Util.getHtmlAjax("StartPage.html"),x=b.find("#overlay"),T=b.find(".primaryFont"),w=b.find("#serverTagBuffer"),k=b.find("#serverSetUpContainer"),A=b.find("#authoringButtonContainer"),_=b.find("#authoringButtonBuffer");b.find("#loginDialog"),TAG.Telemetry.register(x,"click","start_to_collections"),localStorage.ip&&-1!==localStorage.ip.indexOf(":")&&(localStorage.ip=localStorage.ip.split(":")[0]),v="http://"+(localStorage.ip?localStorage.ip+":8080":"browntagserver.com:8080"),y=t.tagContainer||$("body"),n();var C,E,S,M,I={};return I.getRoot=m,I},TAG.Layout.StartPage.default_options={repository:"http://cs.brown.edu/research/lads/LADS2.0Data/repository.xml"},TAG.Util.makeNamespace("TAG.Layout.ArtworkViewer"),TAG.Layout.ArtworkViewer=function(t){"use strict";function e(){var t,e,r;idleTimer=TAG.Util.IdleTimer.TwoStageTimer(),idleTimer.start(),t=document.getElementsByTagName("head").item(0),e=document.createElement("script"),e.charset="UTF-8",e.type="text/javascript",e.src="http://ecn.dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=7.0",t.appendChild(e),r=document.createElement("meta"),r.httpEquiv="Content-Type",r.content="text/html; charset=utf-8",t.appendChild(r),l=TAG.Util.UI.getLocationList(A.Metadata),u=TAG.AnnotatedImage({root:p,doq:A,callback:function(){d=u.getAssociatedMedia(),d.guids.sort(function(t,e){return d[t].doq.Name.toLowerCase()<d[e].doq.Name.toLowerCase()?-1:1});try{u.openArtwork(A)}catch(t){console.log(t)}TAG.Util.Splitscreen.setViewers(p,u),i(),n()},noMedia:!1})}function n(){function t(t,e,n,i){var r=$(document.createElement("img"));return r.attr({src:e,id:t}),r.css({left:n+"px",top:i+"px"}),"leftControl"===t||"rightControl"===t?r.addClass("seadragonManipButtonLR"):"upControl"===t||"downControl"===t?r.addClass("seadragonManipButtonUD"):("zinControl"===t||"zoutControl"===t)&&r.addClass("seadragonManipButtoninout"),r}function e(t,e){t.preventDefault(),clearInterval(r),i(t,e)}function n(t,e){i(t,e),clearInterval(r),r=setInterval(function(){i(t,e)},100)}function i(t,e){h=u.getToManip();var n={x:u.getMediaDimensions().width/2,y:u.getMediaDimensions().height/2};"left"===e?h({pivot:n,translation:{x:-g,y:0},scale:1}):"up"===e?h({pivot:n,translation:{x:0,y:-g},scale:1}):"right"===e?h({pivot:n,translation:{x:g,y:0},scale:1}):"down"===e?h({pivot:n,translation:{x:0,y:g},scale:1}):"in"===e?h({pivot:n,translation:{x:0,y:0},scale:m}):"out"===e&&h({pivot:n,translation:{x:0,y:0},scale:1/m})}var r,a=p.find("#seadragonManipContainer"),o=p.find("#seadragonManipSlideButton"),s=$("#tagRoot"),l=(s.width()/2,s.height()/2,26),c=60,d=0,f=0,g=20,m=1.1,v=!0;a.css("left",$("#tagRoot").width()-160+"px"),o.on("click",function(){f=1-f,a.animate({top:d}),0===f?(d=0,o.html("Show Controls")):(d=-100,o.html("Hide Controls"))}),a.append(o),a.append(t("leftControl",tagPath+"images/icons/zoom_left.svg",c,l+14)),a.append(t("upControl",tagPath+"images/icons/zoom_up.svg",c+12,l+2)),a.append(t("rightControl",tagPath+"images/icons/zoom_right.svg",c+41,l+14)),a.append(t("downControl",tagPath+"images/icons/zoom_down.svg",c+12,l+43)),a.append(t("zinControl",tagPath+"images/icons/zoom_plus.svg",c-40,l-6)),a.append(t("zoutControl",tagPath+"images/icons/zoom_minus.svg",c-40,l+34));var y=$(document.createElement("input")).attr({id:"crossfadeSlider",type:"range",value:1,min:0,max:1,step:.05});y.on("change mousemove",function(){$(".mediaOuterContainer").css("opacity",y.val())}),$("#tagContainer").attr("tabindex",-1),$("[tabindex='-1']").focus(),$("[tabindex='-1']").css("outline","none"),$("[tabindex='-1']").on("click",function(){$("[tabindex='-1']").focus(),v=!0,u.dzManipPreprocessing()}),$("[tabindex='-1']").focus(function(){v=!0}),$("[tabindex='-1']").focusout(function(){v=!1}),$(document).on("keydown",function(t){if(v)switch(t.which){case 37:e(t,"left");break;case 38:e(t,"up");break;case 39:e(t,"right");break;case 40:e(t,"down");break;case 187:case 61:e(t,"in");break;case 189:case 173:e(t,"out")}}),$(document).keyup(function(){clearInterval(r)}),$("#seadragonManipContainer").on("click",function(t){t.stopPropagation(),t.preventDefault(),TAG.Util.IdleTimer.restartTimer()}),$("#leftControl").on("mousedown",function(t){n(t,"left")}),$("#upControl").on("mousedown",function(t){n(t,"up")}),$("#rightControl").on("mousedown",function(t){n(t,"right")}),$("#downControl").on("mousedown",function(t){n(t,"down")}),$("#zinControl").on("mousedown",function(t){n(t,"in")}),$("#zoutControl").on("mousedown",function(t){n(t,"out")}),$(".seadragonManipButtonLR").on("mouseup mouseleave",function(){clearInterval(r)}),$(".seadragonManipButtonUD").on("mouseup mouseleave",function(){clearInterval(r)}),$(".seadragonManipButtoninout").on("mouseup mouseleave",function(){clearInterval(r)})}function i(){function e(){var t;v.off("click"),idleTimer&&idleTimer.kill(),idleTimer=null,u&&u.unload(),t=new TAG.Layout.CollectionsPage({backScroll:_,backArtwork:A,backCollection:C}),TAG.Util.UI.slidePageRightSplit(p,t.getRoot(),function(){}),currentPage.name=TAG.Util.Constants.pages.COLLECTIONS_PAGE,currentPage.obj=t}function n(t,e){return function(){t.append(TAG.Util.Artwork.createThumbnailButton({title:TAG.Util.htmlEntityDecode(e.Name),handler:s(e),buttonClass:"tourButton",src:e.Metadata.Thumbnail?k(e.Metadata.Thumbnail):tagPath+"images/tour_icon.svg"}))
}}function i(t,e){return function(){var n="",i=e.doq.Metadata,r=i.Thumbnail;switch(i.ContentType){case"Audio":n=tagPath+"images/audio_icon.svg";break;case"Video":n=r&&!r.match(/.mp4/)?k(r):"images/video_icon.svg";break;case"Image":n=r?k(r):k(i.Source);break;default:n=tagPath+"images/text_icon.svg"}t.append(TAG.Util.Artwork.createThumbnailButton({title:TAG.Util.htmlEntityDecode(e.doq.Name),handler:o(e),buttonClass:"mediaButton",buttonID:"thumbnailButton-"+e.doq.Identifier,src:n}))}}function o(t){return function(e){e.stopPropagation(),E=!0,toggleLocationPanel(),t.create(),t.toggle(),TAG.Util.IdleTimer.restartTimer(),t.mediaManipPreprocessing(),t.pauseReset()}}function s(e){return function(){var n,i,r;idleTimer&&idleTimer.kill(),idleTimer=null,u.unload(),i={artworkPrev:"artmode",prevScroll:_},n=JSON.parse(unescape(e.Metadata.Content)),r=new TAG.Layout.TourPlayer(n,C,i,t),TAG.Util.UI.slidePageLeftSplit(p,r.getRoot(),r.startPlayback)}}function c(){if(!Z){Z=!0,Y=p.find("#minimap"),Y.attr("src",TAG.Worktop.Database.fixPath(A.URL)),Y.mousedown(function(){return!1}),TAG.Util.disableDrag(V),Q=K.naturalWidth/K.naturalHeight;var t=K.naturalHeight/$(V).height(),e=K.naturalWidth/$(V).width();t>e?(Y.removeAttr("height"),Y.removeAttr("width"),Y.css({height:"100%"})):(Y.removeAttr("height"),Y.removeAttr("width"),Y.css({width:"100%"})),TAG.Util.makeManipulatable(Y[0],{onManipulate:h,onScroll:y,onTapped:x},!0);var n=Y.height(),i=Y.width(),r=V.height()/2-Y.height()/2,a=V.width()/2-Y.width()/2;X.css({width:i-1+"px",height:n-1+"px",top:r+"px",left:a-1+"px"})}}function h(t){var e=Y.height(),n=Y.width(),i=Y.position().top,r=parseFloat(Y.css("marginLeft")),a=t.pivot.x,o=t.pivot.y,s=t.translation.x,l=t.translation.y,c=a+s,d=o+l;c=(c-r)/n,d=(d-i)/e,d/=Q,c=Math.max(0,Math.min(c,1)),d=Math.max(0,Math.min(d,1/Q));var h=1+(1-t.scale);h&&u.viewer.viewport.zoomBy(h,!1),u.viewer.viewport.panTo(new Seadragon.Point(c,d),!0),u.viewer.viewport.applyConstraints()}function y(t,e){h({scale:t,translation:{x:0,y:0},pivot:e})}function x(t){var e=Y.height(),n=Y.width(),i=Y.position().top,r=parseFloat(Y.css("marginLeft")),a=t.position.x,o=t.position.y,s=(a-r)/n,l=(o-i)/e;l/=Q,s=Math.max(0,Math.min(s,1)),l=Math.max(0,Math.min(l,1/Q));var c=1;c&&u.viewer.viewport.zoomBy(c,!1),u.viewer.viewport.panTo(new Seadragon.Point(s,l),!0),u.viewer.viewport.applyConstraints()}function T(t){var e=Y.height(),n=Y.width(),i=V.height()/2-Y.height()/2,r=V.width()/2-Y.width()/2,a=t.viewport,o=a.getBounds(!0),s=o.getTopLeft(),l=o.getBottomRight(),c=s.x,u=s.y,d=l.x,h=l.y;0>c&&(c=0),0>u&&(u=0),d>1&&(d=1),h>1/Q&&(h=1/Q),u*=Q,h*=Q,h-=u,d-=c,c=r+c*n,u=i+u*e,d*=n,h*=e,X.css({width:d-1+"px",height:h-1+"px",top:u+"px",left:c-1+"px"})}var w,S,M,D,P,N,G,O,L,F,B=(p.find("#backBttnContainer"),p.find("#sideBarSections")),R=p.find("#sideBarInfo"),H=p.find("#infoTitle"),U=p.find("#infoArtist"),z=p.find("#infoYear"),j=p.find("#assetContainer"),W=!0,q=0;v.attr("src",tagPath+"images/icons/Back.svg"),m.attr("src",tagPath+"images/icons/Close.svg"),H.text(A.Name),U.text(A.Metadata.Artist),z.text(A.Metadata.Year),g.on("click",function(){var t={};t.left=W?"-22%":"0%",W=!W,f.animate(t,1e3,function(){m.attr("src",tagPath+"images/icons/"+(W?"Close.svg":"Open.svg"))})}),TAG.Util.UI.setUpBackButton(v,e),TAG.Telemetry.register(v,"click","artwork_to_collections",function(t){t.work_name=A.Name,t.work_guid=A.Identifier});for(w in A.Metadata.InfoFields)A.Metadata.InfoFields.hasOwnProperty(w)&&(S=w,M=A.Metadata.InfoFields[w],D=$(document.createElement("div")),D.addClass("infoCustom"),D.text(S+": "+M),D.appendTo(b));if(TAG.Util.fitText(b,1.1),A.Metadata.Description&&(G=a("Description"),G.contents.html(Autolinker.link(A.Metadata.Description.replace(/\n/g,"<br />"),{email:!1,twitter:!1})),j.append(G),q=G.height()),l.length>0?(L=r(),j.append(L),q+=L.height()):$("#locationHistoryContainer").remove(),d.guids.length>0){for(F=a("Associated Media"),P=0;d.guids.length>P;P++)N=d[d.guids[P]],I.add(i(F.contents,N));j.append(F),q+=F.height()}TAG.Worktop.Database.getTours(function(t){var e,i;if(e=t.filter(function(t){var e;return t.Metadata&&t.Metadata.RelatedArtworks&&"true"!==t.Metadata.Private?(e=JSON.parse(t.Metadata.RelatedArtworks),e&&e.length?e.indexOf(A.Identifier)>=0:!1):!1}),e.length>0)for(O=a("Tours"),j.append(O),q+=O.height(),O.contents.text(""),P=0;e.length>P;P++)I.add(n(O.contents,e[P]));i=Math.max(1,j.height()-q),p.find(".drawerContents").css({"max-height":i+"px"})});var V=p.find("#minimapContainer");b.css({"overflow-y":"auto","max-height":f.height()/2-(b.offset().top-f.offset().top)+"px"}),V.css({bottom:"-10%"}),j.css({"max-height":R.height()-b.height()+(b.offset().top-f.offset().top)+"px"}),B.append(V);var Y,X=p.find("#minimaprect"),K=new Image,Z=!1,Q=1;K.onload=c,K.src=TAG.Worktop.Database.fixPath(A.URL),K.complete&&c(),u.addAnimateHandler(T)}function r(){function t(){function t(t){var e,n,i,r,a=$(this);TAG.Util.UI.drawPushpins(l,c),v.html(a.html()+"<br/>"+(t.data.info?t.data.info:"")),$("img.removeButton").attr("src",tagPath+"images/icons/minus.svg"),$("img.editButton").attr("src",tagPath+"images/icons/edit.png"),$("div.locations").css(u),a.find("img.removeButton").attr("src",tagPath+"images/icons/minusB.svg"),a.find("img.editButton").attr("src",tagPath+"images/icons/editB.png"),a.css(d),t.data.resource.latitude?i=t.data.resource:(e=t.data.resource.point.coordinates[0],n=t.data.resource.point.coordinates[1],i=new Microsoft.Maps.Location(e,n)),r={center:i,zoom:4},c.setView(r)}var e,i,r,a,o,s,u={"background-color":"transparent",color:"white"},d={"background-color":"white",color:"black"};for(a=0;l.length>a;a++)s={text:""+(a+1),icon:tagPath+"images/icons/locationPin.png",width:20,height:30},e=l[a].address,i="",l[a].date&&l[a].date.year?(r=l[a].date.year,0>r&&(r=Math.abs(r)+" BC"),i=r):i="<i>Date Unspecified</i>",o=$(document.createElement("div")),o.addClass("locations"),o.html(a+1+". "+e+" - "+i+"<br>"),m.append(o),o.click(l[a],t),o.fadeIn();TAG.Util.UI.drawPushpins(l,c),n()}function e(){0===l.length&&a.show(),c?n():s(t)}function n(){0!==l.length&&(M||S||(E?(T.text("Location History"),T.css("color","white"),S=!0,x.hide(),y.hide("slide",{direction:"left"},500,function(){g.show(),S=!1})):(T.text("Location History"),x.hide(),M=!0,y.show("slide",{direction:"left"},500,function(){x.show(),M=!1}),y.css("display","inline"),g.hide()),E=!E))}if(0===l.length)return w.remove(),void 0;var i=p.find("#locationHistoryPanel"),r=p.find("#locationHistoryToggleIcon"),a=$(TAG.Util.UI.blockInteractionOverlay()).addClass("mapOverlay"),o=$(document.createElement("label")),u=$(document.createElement("div")).addClass("lpContents"),d=$(document.createElement("div")),h=$(document.createElement("div")).addClass("lpMapDiv"),f=$(document.createElement("div")).addClass("lpTextInfoDiv"),m=$(document.createElement("div")).addClass("lpTextDiv"),v=$(document.createElement("div")).addClass("lpInfoDiv");return o.text("Map has no location history to display."),o.attr("id","mapOverlayLabel"),a.append(o),u.append(a),i.append(u),d.attr("id","lpTitle"),d.text("Location History"),u.append(d),h.attr("id","lpMapDiv"),u.append(h),u.append(f),f.append(m),f.append(v),x.css({left:"87.5%","border-bottom-right-radius":"10px","border-top-right-radius":"10px"}),r.attr("src",tagPath+"images/icons/Close.svg"),x.on("click",n),w.on("click",e),w.append(T),w}function a(t){var e,n=$(document.createElement("div")).addClass("drawer"),i=$(document.createElement("div")).addClass("drawerHeader"),r=$(document.createElement("div")).addClass("drawerLabel"),a=$(document.createElement("div")).addClass("drawerToggleContainer"),o=$(document.createElement("img")).addClass("drawerPlusToggle"),s=$(document.createElement("div")).addClass("drawerContents");return r.text(t),o.attr({src:tagPath+"images/icons/plus.svg",expanded:!1}),n.append(i),i.append(r),i.append(a),a.append(o),n.append(s),i.on("click",function(){if("true"!==o.attr("expanded"))$(".drawerPlusToggle").attr({src:tagPath+"images/icons/plus.svg",expanded:!1}),$(".drawerContents").slideUp(),o.attr({src:tagPath+"images/icons/minus.svg",expanded:!0});else for(o.attr({src:tagPath+"images/icons/plus.svg",expanded:!1}),e=0;d.guids.length>e;e++)d[d.guids[e]].isVisible()&&d[d.guids[e]].hide();s.slideToggle()}),n.contents=s,n}function o(){return p}function s(t){var e,n;e={credentials:"AkNHkEEn3eGC3msbfyjikl4yNwuy5Qt9oHKEnqh4BSqo5zGiMGOURNJALWUfhbmj",mapTypeID:Microsoft.Maps.MapTypeId.road,showScalebar:!0,enableClickableLogo:!1,enableSearchLogo:!1,showDashboard:!0,showMapTypeSelector:!1,zoom:2,center:new Microsoft.Maps.Location(20,0)},n={mapTypeId:Microsoft.Maps.MapTypeId.road},c=new Microsoft.Maps.Map(document.getElementById("lpMapDiv"),e),c.setView(n),t&&t()}t=t||{};var l,c,u,d,h,p=TAG.Util.getHtmlAjax("Artmode.html"),f=p.find("#sideBar"),g=p.find("#toggler"),m=p.find("#togglerImage"),v=p.find("#backButton"),y=p.find("#locationHistoryDiv"),b=p.find("#info"),x=p.find("#locationHistoryToggle"),T=p.find("#locationHistory"),w=p.find("#locationHistoryContainer"),k=TAG.Worktop.Database.fixPath,A=t.doq,_=(t.prevPage,t.prevScroll||0),C=t.prevCollection,E=!1,S=!1,M=!1,I=TAG.Util.createQueue();return A&&e(),{getRoot:o}},TAG.Layout.ArtworkViewer.default_options={catalogState:{},doq:null,split:"L"},TAG.Util.makeNamespace("TAG.Layout.CollectionsPage"),TAG.Layout.CollectionsPage=function(t){"use strict";function e(){var t,e;TAG.Telemetry.register(Y,"click","collections_to_start"),Y.attr("src",tagPath+"images/icons/Back.svg"),idleTimer=null,t={position:"absolute","z-index":"50",height:"auto",width:"5%",left:"47.5%",top:"42.5%"},e=TAG.Util.showProgressCircle(P,t,"0px","0px",!1),B.find(".rowButton").on("click",function(){T(re,$(this).attr("tagName"))}),TAG.Telemetry.register(B.find("#artistButton"),"click","",function(t){t.ttype="sort_by_artist"}),TAG.Telemetry.register(B.find("#titleButton"),"click","",function(t){t.ttype="sort_by_title"}),TAG.Telemetry.register(B.find("#yearButton"),"click","",function(t){t.ttype="sort_by_year"}),TAG.Telemetry.register(B.find("#typeButton"),"click","",function(t){t.ttype="sort_by_type"}),q.on("keyup",function(){h()}),TAG.Util.UI.setUpBackButton(Y,function(){Y.off("click"),idleTimer&&idleTimer.kill(),idleTimer=null,TAG.Layout.StartPage(null,TAG.Util.UI.slidePageRight,!0)}),TAG.Worktop.Database.getExhibitions(r,null,r),n()}function n(){$(X).css({"background-color":TAG.Util.UI.hexToRGBA(pe,fe)}),$(K).css({color:TAG.Worktop.Database.getPrimaryFontColor(),"font-family":ve}),$(Z).css({color:me,"font-family":ve})}function i(){return"Empty"===te.Type?"tour":"VideoArtwork"===te.Metadata.Type?"video":"artwork"}function r(t){var e,n,i;for(M=0,e=0;t.length>e;e++)i=t[e],n=i.Metadata.Private?/^true$/i.test(i.Metadata.Private):!1,!n&&TAG.Util.localVisibility(i.Identifier)&&(M&&j.css("background-image","url("+le(i.Metadata.BackgroundImage)+")"),E=E||i,o(i),M++);J?s(J,Q,te)():E&&c(),1===M&&a(),P.hide()}function a(){var t=B.find("#collection-info"),e=B.find("#collection-name-div"),n=B.find("#contentdiv"),i=B.find("#description-text"),r=B.find("#img-container");e.addClass("primaryFont"),e.css({color:"#"+ge}),U.css("display","none"),z.css("display","none"),R.css({left:"0",width:"100%"}),t.css("width","100%"),e.css("width","100%"),t.append(n),n.css({"padding-left":"4.5%",width:"90%",left:"0"}),r.css("width","30%"),i.css({left:"38%",width:"62%"})}function o(t){var e=TAG.Util.htmlEntityDecode(t.Name),n=$(document.createElement("div")),i=$(document.createElement("div")),r=t.Metadata.Description?TAG.Util.htmlEntityDecode(t.Metadata.Description):"";r=r.replace(/<br>/g,"").replace(/<br \/>/g,""),n.addClass("collectionClickable"),n.addClass("primaryFont"),n.attr({flagClicked:"false",id:"collection-"+t.Identifier}),n.on("mousedown",function(){$(this).css("background-color","white"),i.css("color","black")}),n.on("mouseleave",function(){var t=$(this);"false"===t.attr("flagClicked")?(t.css({"background-color":"transparent",color:ge}),i.css("color",ge)):i.css("color","black")}),n.on("click",s(t)),TAG.Telemetry.register(n,"click","collection_title",function(n){n.collection_name=e,n.collection_guid=t.Identifier}),i.attr("id","collection-title-"+t.Identifier),i.addClass("collection-title"),i.addClass("primaryFont"),i.html(e),n.append(i),U.append(n),ie.push(n)}function s(t,e,n){return function(i){var r;for(!idleTimer&&i&&(idleTimer=TAG.Util.IdleTimer.TwoStageTimer(),idleTimer.start()),r=0;ie.length>r;r++)ie[r].css({"background-color":"transparent",color:ge}),ie[r].data("selected",!1),ie[r].attr("flagClicked","false"),ie[r].children().css("color",ge);$("#collection-"+t.Identifier).attr("flagClicked","true"),$("#collection-title-"+t.Identifier).css("color","black"),J=t,te=n||null,l.call($("#collection-"+J.Identifier),J),Q=e||0,A(J)}}function l(t,e){var n,r,a,o,s,l,c,u,d,h,p;V.text(""),W&&W.empty(),t.Metadata.BackgroundImage&&j.css("background-image","url("+le(t.Metadata.BackgroundImage)+")"),!e&&this.data("selected",!0),H.empty(),s=$(document.createElement("div")),s.attr("id","collection-name-div"),s.addClass("primaryFont"),s.css({color:ge}),s.text(TAG.Util.htmlEntityDecode(t.Name)),r=.8*.75*$(window).width(),n=$(document.createElement("div")),n.attr("id","collection-info"),H.append(n),o=TAG.Util.getMaxFontSizeEM(TAG.Util.htmlEntityDecode(t.Name),1.5,r,.2*n.height(),.2),s.css({"font-size":o}),n.append(s),l=$(document.createElement("div")),l.attr("id","contentdiv"),n.append(l),I=$(document.createElement("div")),I.attr("id","img-container"),S=$(document.createElement("img")),S.attr("id","currentThumbnail"),S.attr("src",le(t.Metadata.DescriptionImage1)),S.attr("thumbnail",le(t.Metadata.DescriptionImage1)),S.on("click",k),TAG.Telemetry.register(S,"click","",function(t){return te&&ne?(t.work_name=te.Name,t.work_guid=te.Identifier,t.ttype="collection_to_"+i(te),void 0):!0}),c=$(document.createElement("div")),c.attr("id","explore-text"),c.css("font-size",20*se/30+"em"),c.text("Explore"),d=$(document.createElement("img")),d.attr("id","exploreIcon"),d.attr("src",tagPath+"images/icons/ExploreIcon.svg"),u=$(document.createElement("div")),u.attr("id","explore-tab"),u.on("click",k),u.append(d),u.append(c),I.append(S),I.append(u),l.append(I),N=$(document.createElement("div")),N.attr("id","info-text"),G=$(document.createElement("div")),G.attr("id","artistInfo"),G.css("font-size",11*se/30+"em"),O=$(document.createElement("div")),O.attr("id","yearInfo"),O.css("font-size",11*se/30+"em"),N.append(G),N.append(O),I.append(N),D=$(document.createElement("div")),D.attr("id","description-text"),a=t.Metadata.Description?t.Metadata.Description.replace(/\n\r?/g,"<br />"):"",D.css({height:"91.5%",width:"55%","font-size":.2*TAG.Util.getMaxFontSizeEM(a,1.5,.55*$(l).width(),.915*$(l).height(),.1)}),D.html(Autolinker.link(a,{email:!1,twitter:!1})),l.append(D),h={position:"absolute","float":"left",left:"12%","z-index":"50",height:"20%",width:"auto",top:"22%"},p=TAG.Util.showProgressCircle(D,h,"0px","0px",!1),S.on("load",function(){TAG.Util.removeProgressCircle(p)}),e||$(this).css({"background-color":"rgb(255,255,255)",color:"black"})}function c(){s(E)()}function u(t,e){function n(t){p(t),d(t),e&&e()}TAG.Worktop.Database.getArtworksIn(t.Identifier,n,null,n)}function d(t){var e,n,i;for(q[0].value="",ae=[],n=0;t.length>n;n++)i=t[n],i&&(e=i.Name+" "+i.Metadata.Artist+" "+i.Metadata.Year+" "+i.Metadata.Type,ae.push({id:n,keys:e.toLowerCase()}))}function h(){var t,e=q.val().toLowerCase(),n=[],i=[];if(!e)return V.text(""),f(re,F,0,!1),void 0;for(t=0;ae.length>t;t++)ae[t].keys.indexOf(e)>-1?n.push(re[t]):i.push(re[t]);V.text(n.length>0?"Results Found":"No Matching Results"),f(n,F,0,!0),f(i,F,n.length,!1)}function p(t){re=t,F=oe,x(F),f(re,F,0)}function f(t,e,n,i){function r(){var r,a,o,s,l,c,u,d;if(t&&0!==t.length)for(r=b(t,e),a=r.min(),o=a?a.artwork:null,l=n,c=.48*$(W).height(),u=1.4*c,s=r.getContents(),d=0;s.length>d;d++)ee.add(g(s[d].artwork,e,i,l+d,u,c)),ee.add(function(){Q>=W.width()&&W.animate({scrollLeft:Q},0)})}J&&(0===n?(ee.clear(),W.empty(),r()):r())}function g(t,e,n,r){return function(){var a,o,s=$(document.createElement("div")),l=$(document.createElement("div")),c=$(document.createElement("div")),u=$(document.createElement("img"));s.addClass("tile"),u.addClass("tileImage"),l.addClass("artTitle"),l.addClass("primaryFont"),c.addClass("artText"),c.addClass("primaryFont"),c.css({color:ge}),s.css({"margin-left":16.5*Math.floor(r/2)+1+"%","margin-top":12.25*(r%2)+"%"}),s.on("click",function(){idleTimer||(idleTimer=TAG.Util.IdleTimer.TwoStageTimer(),idleTimer.start()),S.attr("guid")===t.Identifier?k():(m(t)(),L=!0)}),TAG.Telemetry.register(s,"click","",function(e){e.ttype=S.attr("guid")!==t.Identifier||L?"artwork_tile":"collections_to_"+i(t),e.artwork_name=t.Name,e.artwork_guid=t.Identifier,L=!1}),t.Metadata.Thumbnail?u.attr("src",le(t.Metadata.Thumbnail)):u.attr("src",tagPath+"images/no_thumbnail.svg"),"Title"===e?c.text(TAG.Util.htmlEntityDecode(t.Name)):"Artist"===e?c.text("Empty"===t.Type?"(Interactive Tour)":t.Metadata.Artist):"Year"===e?c.text("Empty"===t.Type?"(Interactive Tour)":t.Metadata.Year):"Type"===e&&c.text(TAG.Util.htmlEntityDecode(t.Name)),l.append(c),n||""===q.val()?n&&(u.css({opacity:"1.0"}),s.css("border","1px solid rgba(255, 255, 255, 0.5)"),l.css("color",me),console.log(me)):(u.css({opacity:"0.3"}),s.css("border","1px solid black"),l.css("color",TAG.Util.UI.dimColor("#"+me))),s.append(u),s.append(l),"Empty"===t.Type?(a=$(document.createElement("img")),a.addClass("tourLabel"),a.attr("src",tagPath+"images/icons/catalog_tour_icon.svg"),s.append(a)):"Video"===t.Metadata.Medium&&(o=$(document.createElement("img")),o.addClass("videoLabel"),o.attr("src",tagPath+"images/icons/catalog_video_icon.svg"),s.append(o)),W.append(s)}}function m(t){return function(){var e,n;t&&(te=t,ne=!0,$("#explore-tab").css("display","inline-block"),"Empty"!==t.Type?(G.text("Artist: "+(t.Metadata.Artist||"Unknown")),O.text(t.Metadata.Year||" ")):(G.text("(Interactive Tour)"),O.text(" ")),S.css("border","1px solid rgba(0,0,0,0.5)").attr({src:t.Metadata.Thumbnail?le(t.Metadata.Thumbnail):tagPath+"images/no_thumbnail.svg",guid:t.Identifier}),setTimeout(function(){S.attr("guid","")},400),e=$(document.createElement("div")).text(TAG.Util.htmlEntityDecode(t.Name)).attr("id","titleSpan"),n=$(document.createElement("div")).attr("id","descSpan"),n.html(Autolinker.link(t.Metadata.Description?t.Metadata.Description.replace(/\n/g,"<br />"):"",{email:!1,twitter:!1})),D.empty(),D.append(e).append(n))}}function v(t,e){return function(n,i){var r,a;return n[t]<i[t]?-1:n[t]>i[t]?1:(r=e?n[e]:n.artwork.Identifier,a=e?i[e]:i.artwork.Identifier,a>r?-1:r>a?1:0)}}function y(t){return function(e,n){return n?n[t]>e?-1:e>n[t]?1:0:null}}function b(t,e){var n,i,r,a,o;if("Title"===e){for(n=v("nameKey"),i=y("nameKey"),r=new AVLTree(n,i),r.clear(),o=0;t.length>o;o++)a={artwork:t[o],nameKey:t[o].Name},r.add(a);return r}if("Artist"===e){for(n=v("artistKey"),i=y("artistKey"),r=new AVLTree(n,i),o=0;t.length>o;o++)a={artwork:t[o],artistKey:"Empty"===t[o].Type?"~~~~":t[o].Metadata.Artist},r.add(a);return r}if("Year"===e){for(n=v("yearKey"),i=y("yearKey"),r=new AVLTree(n,i),o=0;t.length>o;o++)a={artwork:t[o],yearKey:"Empty"===t[o].Type?"~~~~":t[o].Metadata.Year},r.add(a);return r}if("Type"===e){for(n=v("typeKey","nameKey"),i=y("nameKey"),r=new AVLTree(n,i),o=0;t.length>o;o++)a={artwork:t[o],nameKey:t[o].Name,typeKey:"Empty"===t[o].Type?1:"Artwork"===t[o].Metadata.Type?2:3},r.add(a);return r}return null}function x(t){var e=TAG.Util.UI.dimColor("#"+me);$(".rowButton").css("color",e),$('[tagName="'+t+'"]').css("color",me)}function T(t,e){var n,i=[],r=[],a=[],o=[],s=[];if(F=e,x(F),"Type"!==e)f(t,F,0,!1);else{for(n=0;t.length>n;n++)0>i.indexOf(t[n].Identifier)&&(i.push(t[n].Identifier),"Empty"===t[n].Type?r.push(t[n]):"Artwork"===t[n].Metadata.Type?a.push(t[n]):o.push(t[n]));s.concat(r).concat(a).concat(o),f(s,"Title",0,!1)}h()}function w(t){var e,n,i,r,a;return e=JSON.parse(unescape(t.Metadata.Content)),e&&e.data?(Q=W.scrollLeft(),r={backScroll:Q,backCollection:J,backArtwork:te},n=TAG.Layout.TourPlayer(e,J,r,null,t),TAG.Util.Splitscreen.on()&&(a=B.parent().attr("id"),TAG.Util.Splitscreen.exit(a[a.length-1])),TAG.Util.UI.slidePageLeftSplit(B,n.getRoot(),n.startPlayback),currentPage.name=TAG.Util.Constants.pages.TOUR_PLAYER,currentPage.obj=n,void 0):(i=$(TAG.Util.UI.popUpMessage(null,"Cannot play empty tour.",null)),i.css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+7),B.append(i),i.fadeIn(500),void 0)}function k(){var t,e,n,i,r,a="L",o=_();te&&ne&&(idleTimer&&idleTimer.kill(),idleTimer=null,t={catalogState:o,doq:te,split:a},"Empty"===te.Type?TAG.Util.Splitscreen.on()?(n=TAG.Util.UI.PopUpConfirmation(function(){w(te)},"By opening this tour, you will exit split screen mode. Would you like to continue?","Continue",!1,function(){$(n).remove()},B),$(n).css("z-index",10001),B.append($(n)),$(n).show()):w(te):"VideoArtwork"===te.Metadata.Type?(Q=W.scrollLeft(),i={artworkPrev:null,prevScroll:Q},r=TAG.Layout.VideoPlayer(te,J,i),TAG.Util.UI.slidePageLeftSplit(B,r.getRoot()),currentPage.name=TAG.Util.Constants.pages.VIDEO_PLAYER,currentPage.obj=r):(Q=W.scrollLeft(),e=TAG.Layout.ArtworkViewer({doq:te,prevScroll:Q,prevCollection:J,prevPage:"catalog"}),TAG.Util.UI.slidePageLeftSplit(B,e.getRoot()),currentPage.name=TAG.Util.Constants.pages.ARTWORK_VIEWER,currentPage.obj=e),B.css({"overflow-x":"hidden"}))}function A(t){u(t,m(te))}function _(){return{exhibition:J,currentTag:oe,currentImage:te}}function C(){return B}t=t||{};var E,S,M,I,D,P,N,G,O,L,F,B=TAG.Util.getHtmlAjax("NewCatalog.html"),R=(B.find("#leftbar"),B.find("#displayarea")),H=B.find("#displayareasub"),U=B.find("#collectionArea"),z=(B.find("#leftbar-header"),B.find("#collectionHeader")),j=B.find("#bgimage"),W=B.find("#catalogDiv"),q=(B.find("#typeButton"),B.find("#sortRow"),B.find("#searchInput")),V=B.find("#searchTxt"),P=B.find("#loadingArea"),Y=B.find("#catalogBackButton"),X=B.find(".background"),K=B.find(".primaryFont"),Z=B.find(".secondaryFont"),Q=t.backScroll||0,J=t.backCollection,te=t.backArtwork,ee=TAG.Util.createQueue(),ne=!1,ie=[],re=[],ae=[],oe="Title",se=TAG.Worktop.Database.getBaseFontSize(),le=TAG.Worktop.Database.fixPath,ce=TAG.Worktop.Database.getBackgroundColor(),ue=TAG.Worktop.Database.getBackgroundOpacity(),de=TAG.Worktop.Database.getPrimaryFontColor(),he=TAG.Worktop.Database.getSecondaryFontColor(),pe=ce,fe=parseInt(ue)/100,ge=de,me=he,ve=TAG.Worktop.Database.getFontFamily();return z.addClass("primaryFont"),e(),{getRoot:C,loadCollection:l,loadFirstCollection:c}},TAG.Layout.CollectionsPage.default_options={},TAG.Util.makeNamespace("TAG.Layout.InternetFailurePage"),TAG.Util.makeNamespace("TAG.Layout.InternetFailure"),TAG.Layout.InternetFailure.lastOverlay={},TAG.Layout.InternetFailurePage=function(t,e){"use strict";function n(){function n(t){return t==o?"The server is currently unavailable. Please contact the museum administrator for further information.":t==s?"No internet connection was detected. The TAG application requires internet connectivity. Please ensure that you are connected to the internet and try again.":t===l?"Internet connection lost. The TAG application requires internet connectivity. Please ensure that you are connected to the internet and try again.":t===a?'We have detected that you are on a limited data connection. TAG downloads large images, audio, and videos that can significantly increase your data usage.  By clicking "I Agree" you agree to allow TAG to download images, audio, and videos.  Clicking "I Disagree" will exit TAG.':""}i=TAG.Util.getHtmlAjax("InternetFailurePage.html"),i.css("width",$("#tagRoot").width()),i.css("height",$("#tagRoot").height()),r=i.find("#mainPanel"),r.css("width",$("#tagRoot").width()),r.css("height",$("#tagRoot").height());var c=i.find("#sadFace"),u=i.find("#noticeBox"),d=i.find("#noticeLabel"),h=n(t);d.text(h),u.append(d).append("<br>");var p=i.find("#reconnectButton"),f=i.find("#changeServerButton");if(f.text("Change Server"),f.on("click",TAG.Util.UI.ChangeServerDialog),t===a){p.text("I Agree");var g=$(document.createElement("button"));g.text("I Disagree"),g.css({"font-size":"150%",position:"relative",left:"45%",top:"5%"}),u.append(g),g.click(function(){window.close()}),p.click(function(){localStorage.acceptDataUsage="true",e?i.remove():TAG.Layout.StartPage(null,function(t){TAG.Util.Splitscreen.setOn(!1),TAG.Util.UI.slidePageRight(t)},!0)})}else t===o?p.text("Reconnect"):p.text("Reconnect");t!==a&&p.click(function(){d.text("Reconnecting..."),p.hide(),c.hide(),setTimeout(function(){$.ajax({url:"http://"+localStorage.ip+":8080",dataType:"text",async:!1,cache:!1,success:function(){e?i.remove():TAG.Layout.StartPage(null,function(t){TAG.Util.Splitscreen.setOn(!1),TAG.Util.UI.slidePageRight(t)},!0)},error:function(){$.ajax({url:"http://google.com",dataType:"text",async:!0,cache:!1,success:function(){d.text(n("Server Down")),p.show()},error:function(){d.text(n("Internet Lost"===t?"Internet Lost":"No Internet")),p.show()}})}})},100)});var m=$(document.createElement("button"));m.text("Exit"),m.click(function(){}),u.append(f),u.append(p),r.append(c),r.append(u),i.append(r),TAG.Layout.InternetFailure.lastOverlay.root=i,TAG.Layout.InternetFailure.lastOverlay.type=t}this.getRoot=function(){return i};var i,r,a="Data Limit",o="Server Down",s="No Internet",l="Internet Lost";n()},TAG.Util.makeNamespace("TAG.Layout.MetroSplitscreenMessage"),TAG.Layout.MetroSplitscreenMessage=function(){"use strict";this.getRoot=function(){return t};var t=$(document.createElement("div"));t.css({position:"fixed",left:"0px",top:"0px",width:"100%",height:"100%","background-color":"rgb(50,75,107)",color:"white","z-index":"1000000000"});var e=$(document.createElement("label"));e.css({"font-size":"380%",position:"relative",display:"block","text-align":"center",top:"25%"}),e.text("TAG");var n=$(document.createElement("label"));n.css({"font-size":"120%",position:"relative",top:"45%",display:"block","text-align":"center"}),n.text("TAG must be run in full screen mode"),t.append(e).append("<br>").append(n)},TAG.Util.makeNamespace("TAG.Layout.TourPlayer"),TAG.Layout.TourPlayer=function(t,e,n,i,r){"use strict";function a(){g.remove(),$(".rin_PlayPauseContainer").find("input").trigger("click")}function o(){console.log("player: "+u);var t,n;u&&(u.pause(),u.screenplayEnded.unsubscribe(),console.log("UNLOADING PLAYER"),u.unload()),u&&0!==h.children().length&&(f.off("click"),i?(t=new TAG.Layout.ArtworkViewer(i),TAG.Util.UI.slidePageRightSplit(d,t.getRoot()),currentPage.name=TAG.Util.Constants.pages.ARTWORK_VIEWER,currentPage.obj=t):(n=new TAG.Layout.CollectionsPage({backScroll:l,backArtwork:r,backCollection:e}),TAG.Util.UI.slidePageRightSplit(d,n.getRoot(),function(){s="catalog";var t=$("#collection-"+c.Identifier);t.attr("flagClicked","true"),t.css({"background-color":"white",color:"black"}),t[0].firstChild&&$(t[0].firstChild).css({color:"black"})}),currentPage.name=TAG.Util.Constants.pages.COLLECTIONS_PAGE,currentPage.obj=n))}var s,l=0,c=e;$("#tagRoot");var u,d=TAG.Util.getHtmlAjax("TourPlayer.html"),h=d.find("#rinPlayer"),p=d.find("#backButtonContainer"),f=d.find("#backButton"),g=(d.find("#overlayOnRoot"),d.find("#bigThumbnailContainer")),m=d.find("#bigThumbnail"),v=d.find("#bigPlayButton");return f.attr("src",tagPath+"images/icons/Back.svg"),f.on("mousedown",function(){TAG.Util.UI.cgBackColor("backButton",f,!1)}),f.on("mouseleave",function(){TAG.Util.UI.cgBackColor("backButton",f,!0)}),f.on("click",o),INPUT_TOUR_ID&&(p.remove(),r&&r.Metadata&&r.Metadata.Thumbnail&&(m.attr("src",TAG.Worktop.Database.fixPath(r.Metadata.Thumbnail)),v.attr("src",tagPath+"images/icons/Play.svg"),g.css("display","block"),v.on("click",a),m.on("click",a))),{getRoot:function(){return d},startPlayback:function(){rin.processAll(null,tagPath+"js/RIN/web").then(function(){var e="systemRootUrl="+tagPath+"js/RIN/web/&autoplay="+(INPUT_TOUR_ID?"false":"true")+"&loop=false";u=rin.createPlayerControl(h[0],e);for(var n in t.resources)t.resources.hasOwnProperty(n)&&"string"==typeof t.resources[n].uriReference&&(t.resources[n].uriReference=TAG.Worktop.Database.fixPath(t.resources[n].uriReference));u.loadData(t,function(){}),INPUT_TOUR_ID||u.screenplayEnded.subscribe(function(){setTimeout(o,1e3)})})}}},TAG.Util.makeNamespace("TAG.Layout.VideoPlayer"),TAG.Layout.VideoPlayer=function(t,e,n){"use strict";function i(){k.pause(),w.attr("src","");var n=TAG.Layout.CollectionsPage({backScroll:f,backArtwork:t,backCollection:e});TAG.Util.UI.slidePageRightSplit(T,n.getRoot(),function(){p="catalog";var t=$("#collection-"+g.Identifier);t.attr("flagClicked","true"),t.css({"background-color":"white",color:"black"}),$(t[0].firstChild).css({color:"black"})}),currentPage.name=TAG.Util.Constants.pages.COLLECTIONS_PAGE,currentPage.obj=n}function r(){}function a(){0!==k.currentTime&&(k.currentTime=0,k.pause()),_.attr("src",tagPath+"images/icons/PlayWhite.svg")}function o(){k.play(),_.attr("src",tagPath+"images/icons/PauseWhite.svg")}function s(){k.pause(),_.attr("src",tagPath+"images/icons/PlayWhite.svg")}function l(){k.paused?o():s()}function c(){w.on("loadedmetadata",u),_.attr("src",tagPath+"images/icons/PlayWhite.svg"),_.on("click",l),C.attr("src",tagPath+"images/icons/VolumeUpWhite.svg"),$(C).on("click",function(){k.muted=!k.muted,C.attr("src",tagPath+"images/icons/Volume"+(k.muted?"Down":"Up")+"White.svg")}),w.on("ended",function(){setTimeout(i,300)}),r.on("click",function(){}),w.on("timeupdate",function(){var t,e,n,i;t=$("#sliderContainer").width()/k.duration*k.currentTime,$("#sliderPoint").css("width",t),e=Math.floor(k.currentTime/60),n=Math.floor(k.currentTime%60),i=2>(e+"").length?"0"+e:e,D.text(i+":"+(10>n?"0":"")+n)})}function u(){E.on("mousedown",function(t){var e=k.duration*(t.offsetX/$("#sliderContainer").width());isNaN(e)||(k.currentTime=e)}),E.on("mousedown",function(t){t.stopPropagation();var e,n,i,r=t.pageX,a=k.currentTime,o=A/E.width();b=Math.max(0,Math.min(A,a)),e=b/o,n=Math.floor(b/60),i=Math.floor(b%60),2>(""+n).length&&(n="0"+n),$("body").on("mousemove.seek",function(t){var s=t.pageX,l=(s-r)*o;b=Math.max(0,Math.min(A,a+l)),e=b/o,n=Math.floor(b/60),i=Math.floor(b%60),2>(""+n).length&&(n="0"+n),isNaN(b)||($("#currentTimeDisplay").text(n+":"+(10>i?"0":"")+i),k.currentTime=b,$("#sliderPoint").css("width",e))}),$("body").on("mouseup.seek mouseleave.seek",function(){$("body").off("mousemove.seek"),$("body").off("mouseup.seek"),$("body").off("mouseleave.seek"),$("#currentTimeDisplay").text(n+":"+(10>i?"0":"")+i),k.currentTime=b,$("#sliderPoint").css("width",e)})})}function d(){w.attr({poster:S,controls:!1,preload:"metadata"}),m=I+".mp4",v=I+".webm",y=I+".ogg",k.innerHTML='<source src="'+m+'" type="video/mp4; codecs="avc1.42E01E, mp4a.40.2"">',k.innerHTML+='<source src="'+v+'" type="video/webm; codecs="vorbis, vp8"">',k.innerHTML+='<source src="'+y+'" type="video/ogg; codecs="theora, vorbis"">',D.text("00:00"),P.attr("src",tagPath+"images/icons/Back.svg"),P.on("mousedown",function(){TAG.Util.UI.cgBackColor("backButton",P,!1)}),P.on("mouseleave",function(){TAG.Util.UI.cgBackColor("backButton",P,!0)}),P.on("click",i)}function h(){return T}var p,f=0,g=e;n&&(p=n.artworkPrev,f=n.prevScroll||0);var m,v,y,b,x={},T=TAG.Util.getHtmlAjax("VideoPlayer.html"),w=T.find("#video"),k=w[0],A=parseFloat(t.Metadata.Duration),_=T.find("#playPauseButton"),C=T.find("#videoControlsButton"),r=T.find("#loopButton"),E=T.find("#sliderContainer"),S=t.Metadata.Thumbnail&&!t.Metadata.Thumbnail.match(/.mp4/)?TAG.Worktop.Database.fixPath(t.Metadata.Thumbnail):"",M=TAG.Worktop.Database.fixPath(t.Metadata.Source),I=M.substring(0,M.lastIndexOf(".")),D=T.find("#currentTimeDisplay"),P=T.find("#backButton");return d(),a(),c(),x.getRoot=h,x},TAG.Util.makeNamespace("TAG.Layout.ArtworkEditor"),TAG.Layout.ArtworkEditor=function(t){"use strict";function e(){xe.css("background-color","rgb(219,217,204)"),xe.css("color","black"),xe.css("width","100%"),xe.css("height","100%"),Ne=!1,be=0,me=8,w(me),we.css({width:"100%",height:100-me+"%"}),we.addClass("mainPanel"),t?(console.log("artwork: "+t),ve=new TAG.AnnotatedImage({root:xe,doq:t,split:!1,callback:function(){if(!ve.openArtwork(t)){var e=TAG.Util.UI.popUpMessage(function(){TAG.Authoring.NewSettingsView("Artworks",function(t){TAG.Util.UI.slidePageRight(t.getRoot())
},null,t.Identifier)},"There was an error loading the image.","Go Back",!0);xe.append(e),$(e).show()}y(),n(),c(),l(),k(),xe.append(Te),xe.append(we)},noMedia:!0})):(y(),n(),c(),l(),k(),xe.append(Te),xe.append(we))}function n(){var e=$(document.createElement("div")).addClass("rightbar").css({width:"20%",height:"100%",position:"absolute","background-color":"rgba(0,0,0,0.85)",top:$(".topbar").css("height"),right:"-20%","float":"right","z-index":100,color:"white"});$(document.createElement("div")).css({margin:"5% 8%",color:"white","font-size":"150%","float":"left",position:"relative"}).addClass("header").appendTo(e);var n=$(document.createElement("div")).css({position:"relative",margin:"15% 8%","margin-top":"20%",border:"2px solid white",width:"86%",height:"30%"});n.addClass("assocMediaContainer");var r=$(document.createElement("div")).addClass("assocmedia").addClass("contentwrapper").css({"background-color":"rgba(0,0,0,.9)",height:"100%",width:"100%",left:"0",position:"absolute"});e.append(n.append(r));var a=$(document.createElement("div")).addClass("toggleHotspotContainer").css({width:"60%",left:"20%",position:"relative"}).appendTo(e),o=$(document.createElement("button")).addClass("toggleHotspot").css({width:"100%",height:"auto",border:"2px solid white",position:"relative"}).attr("type","button").appendTo(a).click(function(){var t="Associate to Hotspot"===o.text()?"Hotspot":"Asset";Ke=!0,Qe=!0,$(n).is(":visible")?d(Fe,t):d(Fe,t,"",!0)});Me=$(document.createElement("div")),Ie=$(document.createElement("div")),Me.css({"border-style":"solid","border-color":"white",width:"86%",height:"10px",visibility:"hidden",margin:"3% 8%"}),Ie.css({"background-color":"white",width:"0%",height:"100%"});var s=$(document.createElement("div")).addClass("textareaContainer").css({width:"100%",padding:"5% 8%","margin-top":"5%"}).appendTo(e),l=$(document.createElement("input")).addClass("title").attr("placeholder","Title").attr("title","Title").css({width:"64%","font-size":"11pt"}).appendTo(s),c=$(document.createElement("div")).addClass("textareaContainer").css({width:"87%",height:"12%",position:"relative",padding:"5% 8%"}).appendTo(e),u=$(document.createElement("textarea")).addClass("description").attr("placeholder","Description").css({"background-color":"white",width:"92.5%","min-width":"92.5%",height:"90%"}).appendTo(c),h=$(document.createElement("div")).addClass("buttoncontainer").css({width:"87%",padding:"5% 8%",position:"relative"}).appendTo(e);$(document.createElement("button")).addClass("asscmediabutton deletebutton").text("Delete").css({"float":"left",border:"2px solid white",width:"45%"}).attr("type","button").appendTo(h).click(function(){if(je||We)return Oe=$(TAG.Util.UI.popUpMessage(null,"An upload is in progress. Please wait a few moments.","OK",!1)),xe.append(Oe),Oe.show(),void 0;$(".assetHolder").css("background-color",""),"Video"===f("contentType")&&$(".rightbar").find("video")[0].pause(),"Audio"===f("contentType")&&$(".rightbar").find("audio")[0].pause(),$e&&($e.cancelPromises(),je=!1,Me.css("visibility","hidden"),Ie.css("width","0%")),Je.css({width:"20%",height:"100%",position:"absolute","background-color":"rgba(0,0,0,.85)",top:$(".topbar").css("height"),right:"0%","z-index":100}),we.append(Je),TAG.Util.showLoading(Je,"20%");var e=(f("assetLinqID"),f("assetDoqID"));e?TAG.Worktop.Database.changeArtwork(t.Identifier,{RemoveIDs:e},function(){i(),v(),Je.fadeOut()},function(){console.log("error 1")},function(){console.log("error 2")},function(){console.log("error 3")}):(i(),v(),Je.fadeOut())}),$(document.createElement("button")).addClass("asscmediabutton addbutton").text("Save").attr("type","button").css({"float":"right",border:"2px solid white",width:"45%"}).appendTo(h).click(function(){$(".assetHolder").css("background-color",""),Qe=!1;var t;"Video"===f("ContentType")&&$(".rightbar").find("video")[0].pause(),"Audio"===f("ContentType")&&$(".rightbar").find("audio")[0].pause(),t=l.val(),""===l.val()&&(t="Untitled"),$(n).is(":visible")||p("contentType","Text");var e="Asset";"Associate to Hotspot"!==o.text()&&(e="Hotspot"),m({title:TAG.Util.encodeXML(t),desc:TAG.Util.encodeXML(u.val()),pos:Seadragon.Utils.getElementPosition(Ge.children().first().get(0)),contentType:Fe.Metadata.ContentType,contentUrl:TAG.Worktop.Database.fixPath(Fe.Metadata.Source),assetType:e,metadata:{assetDoqID:Fe.Identifier}})});var g=$(document.createElement("img")).attr("src","images/icons/x.svg");g.css({position:"absolute",top:.95*($(window).height()-$(window).height()*me/100)-15+"px",left:"8%",width:"11%",height:"auto"}).appendTo(e).on("click",function(){$e&&($e.cancelPromises(),je=!1,Me.css("visibility","hidden"),Ie.css("width","0%")),"Video"===f("contentType")&&$(".rightbar").find("video")[0].pause(),"Audio"===f("contentType")&&$(".rightbar").find("audio")[0].pause(),$(".assetHolder").css("background-color",""),v()});var y=$(we);y.append(e)}function i(e){function n(t){console.log("number of media: "+t.length),t.sort(function(t,e){return t.Name.toLowerCase()<e.Name.toLowerCase()?-1:1});for(var n=0;t.length>n;n++)Xe.add(r(e,t[n]))}e=e||$(".assetContainer"),e.empty(),ve.getAssociatedMedia(),TAG.Worktop.Database.getAssocMediaTo(t.Identifier,n,function(){console.log("error in createMediaList")},function(){console.log("error in createMediaList")})}function r(t,e){return function(){var n=$(document.createElement("div"));n.addClass("assetHolder"),n.css({"float":"left",margin:"2%",width:"44%",position:"relative","text-align":"center",border:"1px solid white"}),n.data("info",e),n.on("click",a(e,n)),n.on("mousedown",o(n)),t.append(n),n.css("height",1.2*n.width());var i=$(document.createElement("div"));i.addClass("mediaHolderDiv"),i.css({height:"80%",width:"96%",margin:"2%"}),n.append(i);var r=$(document.createElement("img"));switch(r.addClass("assetHolderImage"),e.Metadata.ContentType){case"Audio":r.attr("src","images/audio_icon.svg");break;case"Video":r.attr("src",e.Metadata.Thumbnail&&!e.Metadata.Thumbnail.match(/.mp4/)?TAG.Worktop.Database.fixPath(e.Metadata.Thumbnail):"images/video_icon.svg");break;case"Image":r.attr("src",e.Metadata.Thumbnail?TAG.Worktop.Database.fixPath(e.Metadata.Thumbnail):"images/image_icon.svg");break;default:r.attr("src","images/text_icon.svg")}r.css({"max-width":"100%","max-height":"100%"}),r.removeAttr("width"),r.removeAttr("height"),i.append(r);var s=$(document.createElement("div"));s.text(TAG.Util.htmlEntityDecode(e.Name)),s.css({top:"80%",height:"20%",color:"white",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap",margin:"0% 2% 0% 2%"}),n.append(s)}}function a(e,n){return function(){var i;Ne?(Oe=$(TAG.Util.UI.popUpMessage(null,"You are currently editing a Hotspot or Media","OK",!1)),xe.append(Oe),Oe.show()):($(".assetHolder").css("background-color",""),n.css("background-color","rgba(255,255,255,0.75)"),TAG.Worktop.Database.getLinq(e.Identifier,t.Identifier,function(t){x(),Fe=e,i="Hotspot"===t.Metadata.Type?"Hotspot":"Asset",d(e,i,s(e.Metadata.Source,e.Metadata.ContentType,e.Metadata.Thumbnail&&!e.Metadata.Thumbnail.match(/.mp4/)?TAG.Worktop.Database.fixPath(e.Metadata.Thumbnail):""))},function(){},function(){}))}}function o(t){return function(){t.css("background-color","rgba(255,255,255,0.75)")}}function s(t,e,n){var i,r,a,o,s,l,c=TAG.Worktop.Database.fixPath(t);return"Image"===e?$(document.createElement("img")).css({width:"100%",height:"100%","background-image":"url("+c+")","background-repeat":"no-repeat","background-position":"center center","background-size":"contain",border:"0"}):"Video"===e?(i=document.createElement("video"),i.onerror=function(t){var e="";switch(t.target.error.code){case t.target.error.MEDIA_ERR_ABORTED:e="Video playback aborted. Please see FAQs on the TAG website.";break;case t.target.error.MEDIA_ERR_NETWORK:e="Network error during video upload. Please see FAQs on the TAG website.";break;case t.target.error.MEDIA_ERR_DECODE:e="Error decoding video. Please see FAQs on the TAG website.";break;case t.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:e="Either the video format is not supported or a network or server error occurred. Please see FAQs on the TAG website.";break;default:e="Error: please see FAQs on the TAG website."}console.log("video error: "+e);var n=$(document.createElement("div"));n.css({width:"80%","margin-left":"10%","margin-top":"50%",color:"white","text-align":"center"}),n.text(e);var r=$(".rightbar").find("video").parent();$(".rightbar").find("video").hide(),r.append(n),i.onerror=function(){}},$(i).attr("preload","none"),$(i).attr("poster",n),console.log("video src = "+t+", fixedSrc = "+c),s=document.createElement("source"),s.src=c,s.type="video/mp4",a=document.createElement("source"),a.src=c,a.type="video/webm",o=document.createElement("source"),o.src=c,o.type="video/ogg",i.appendChild(s),i.appendChild(a),i.appendChild(o),i.style.color="white",i.innerHTML+="Your browser does not support this video.",i.controls="controls",i.style.position="relative",i.style.width="100%",i.style.height="100%",$(i)):"Audio"===e?(r=document.createElement("audio"),$(r).attr("preload","none"),l=document.createElement("source"),l.src=c,l.type="audio/mp3",o=document.createElement("source"),o.src=c,o.type="audio/ogg",r.appendChild(l),r.appendChild(o),r.controls="controls",r.style.position="absolute",r.style.width="100%",r.style.bottom="0%",$(r)):void 0}function l(){var t=$(document.createElement("div")).css({position:"absolute"}).addClass("hotspotedit"),e=$(document.createElement("div")).css({position:"absolute",display:"block",width:"40px",height:"40px",border:"solid rgba(255,255,255,1) 5px","border-radius":"50%",top:"-50px",left:"-50px"}).attr("on",null).appendTo(t),n=$(document.createElement("div")).css({display:"block",width:"30px",height:"30px",background:"rgba(0,0,0,0.01)",border:"solid rgba(0,0,0,1) 5px","border-radius":"50%"}).appendTo(e);$(document.createElement("div")).css({display:"block",width:"0px",height:"0px",background:"rgba(0,0,0,0)",border:"solid rgba(0,0,0,0.1) 15px","border-radius":"50%"}).appendTo(n),$(document.createElement("div")).text("Hotspot anchor (drag to update)").css({position:"relative",left:"-5px",top:"-5px",width:"auto",color:"white","font-weight":"bold","font-size":"large",padding:"8px","background-color":"rgba(0,0,0,.85)"}).appendTo(t),TAG.Util.disableDrag(xe),TAG.Util.makeManipulatableWin(e.get(0),{onManipulate:function(e){var n=t.css("top"),i=t.css("left");t.css("top",parseInt(n,10)+e.pivot.y-20+"px"),t.css("left",parseInt(i,10)+e.pivot.x-20+"px"),ve.updateOverlay(t.get(0),Seadragon.OverlayPlacement.TOP_LEFT)}}),Ge=t.appendTo(xe)}function c(){var t=$(document.createElement("img")).attr("src","images/icons/ImportW.png").css({width:"15%",height:"19%",display:"block",margin:"0 auto"});$(document.createElement("div")).css({"padding-top":"30%",height:"70%",position:"relative","font-size":"150%","text-align":"center",color:"white"}).append(t).append($(document.createElement("p")).text("Import Media")).addClass("uploadtemplate").hide().appendTo(xe).click(function(){var t=[];ze=0,je=!0,Ne=!0,$e=TAG.Authoring.FileUploader($(document),TAG.Authoring.FileUploadTypes.Standard,function(e,n){var i,r,a,o,l=e[0],c=n[0];return ze=e.length,e.length>0?(Me.css("visibility","visible"),"image"===l.contentType.split("/",1)[0]?(i=s(c,"Image"),i[0].type=l.contentType,console.log("image type = "+i[0].type),o="Image",h({contentType:o},i)):"video"===l.contentType.split("/",1)[0]?(r=s(c,"Video"),r[0].type=l.contentType,console.log("video type = "+r[0].type),o="Video",h({contentType:o},r)):"audio"===l.contentType.split("/",1)[0]&&(a=s(c,"Audio"),a[0].type=l.contentType,o="Audio",console.log("audio type = "+a[0].type),h({contentType:o},a)),t.push(c),p("localUrl",c),void 0):(je=!1,We=!1,void 0)},function(e){var n=e[0];t[0]&&t[0]===f("localUrl")&&p("contentUrl",n),je=!1,Me.css("visibility","hidden"),Ie.css("width","0%")},[".jpg",".png",".gif",".tif",".tiff",".mp4",".mp3"],!1,null,!1,Ie)})}function u(t){return $(".additionalField").length+4+(t?-1:0)>=6}function d(e,n,i,r){function a(t,a){Ye={},$(".assocMediaContainer").show(),(r||"Text"===e.Metadata.ContentType)&&$(".assocMediaContainer").hide();var s=e.Name,l=e.Metadata.Description,c=$(".rightbar");Ne=!1;var u;if(u=t&&a?new Seadragon.Point(t,a):ve.viewer.viewport.getCenter(),Ze?($(".toggleHotspot").hide(),Ze=!1):$(".toggleHotspot").show(),"Hotspot"===n){$(".toggleHotspot").text("Remove Hotspot");var d=ve.viewer.viewport.pixelFromPoint(u),h=new Seadragon.Point(d.x+50,d.y+50),f=ve.viewer.viewport.pointFromPixel(h),m=Ge.get(0);ve.addOverlay(m,f,Seadragon.OverlayPlacement.TOP_LEFT),ve.viewer.viewport.panTo(new Seadragon.Point(u.x,u.y),!1),Ge.fadeIn(100)}else $(".toggleHotspot").text("Associate to Hotspot"),Ge.fadeOut(100);if("string"==typeof n?c.find(".header").text("Edit "+n):void 0!==n?c.find(".header").text("Edit "+n):c.find(".header").text("Edit Associated Media"),!Ke){i||(i=g()),c.find(".assocmedia").html(i),c.find(".title").val(TAG.Util.htmlEntityDecode(s));var v=s;c.find(".title").keyup(function(){$(this).val()!==v&&(Ne=!0)});var y=l?TAG.Util.htmlEntityDecode(l).replace(/<br>/g,"\n"):"";c.find(".description").val(y),c.find(".description").keyup(function(){$(this).val()!==y&&(Ne=!0)})}Ke=!1,c.hasClass("active")||(c.animate({right:0},600),c.addClass("active"));for(var b in o)p(b,o[b]);p("assetDoqID",e.Identifier)}var o=e.Metadata;TAG.Worktop.Database.getLinq(t.Identifier,e.Identifier,function(t){a(parseFloat(t.Offset._x),parseFloat(t.Offset._y))},function(){console.log("error1")},function(){console.log("error2")}),p("assetDoqID",e.Identifier)}function h(t,e){var n=$(".rightbar"),i=document.createElement("meta");i.httpEquiv="X-UA-Compatible",i.content="IE=Edge",n.append($(i));var r,a=f();t.assetType&&n.find(".header").text(t.assetType),t.title&&n.find(".title").val(t.title),t.description&&n.find(".description").val(description),e&&n.find(".assocmedia").html(e);for(r in a)p(r,a[r]);for(r in t)p(r,t[r])}function p(t,e){var n=$(".rightbar").find(".assocmedia").children();n.length?n.data(t,e):Ye[t]=e}function f(t){var e=$(".rightbar").find(".assocmedia").children();return t?e.data(t)||Ye[t]:!1}function g(){return $(".uploadtemplate").clone(!0).removeClass("uploadtemplate").addClass("upload").show()}function m(e,n,r){function a(){n?(i(),je=!1,We=!1,Pe.css("visibility","hidden"),De.css("width","0%")):(i(),Qe||v(),c.fadeOut(),je=!1,We=!1),Qe=!1}function o(){}function s(t,e){e.force()}function l(){}var c,u=e.title,d=e.desc,h=e.pos,p=e.contentType,f=e.contentUrl,g=e.duration,m=e.assetType,y=e.metadata||{},b=h?ve.viewer.viewport.pointFromPixel(h):{x:0,y:0},x=(ve.viewer.viewport.pixelFromPoint(b),!1);n||(c=$(document.createElement("div")),c.css({width:"20%",height:"100%",position:"absolute","background-color":"rgba(0,0,0,.85)",top:$(".topbar").css("height"),right:"0%","z-index":100}),we.append(c),TAG.Util.showLoading(c,"20%"),c.attr("class","rightbarLoadingSave"));var T={Name:u,ContentType:p,Duration:g,Source:f,LinqTo:t.Identifier,X:b.x,Y:b.y,LinqType:m,Description:d};x?TAG.Worktop.Database.createHotspot(T,a,o,l):TAG.Worktop.Database.changeHotspot(y.assetDoqID,T,a,o,s,l)}function v(){Ge.fadeOut(100);var t=$(".rightbar");t.hasClass("active")&&(t.animate({right:"-20%"},600),t.removeClass("active"),Ne=!1)}function y(){function e(t){t.stopPropagation();var e=$("#mapDiv_infobox");t.target!==oe[0]&&t.target!==G[0]&&t.target!==e[0]&&0===e.find(t.target).length&&0===oe.find(t.target).length&&(n(),re.visible()&&re.hide())}function n(){U("close"),$(x).fadeOut(),Ce?(oe.hide("slide",{direction:"left"},500,function(){dn.show()}),$("body").off("mousedown",e),Ce=!1):(dn.hide(),oe.show("slide",{direction:"left"},500),oe.css({display:"inline"}),Ce=!0,$("body").on("mousedown",e))}function r(t){t.isSelected&&t.toggle()}function a(){r(m),r(G),r(L)}function o(){$("div.results").css({"background-color":"transparent",color:"white"});var t=parseInt(Re[0].value,10),e=parseInt(He[0][He[0].selectedIndex].value,10)-1,n=parseInt(Ue[0][Ue[0].selectedIndex].value,10);(0>e||isNaN(e))&&(e=void 0),(0===n||isNaN(n))&&(n=void 0),(""===t||isNaN(t))&&(e=void 0,n=void 0,t=void 0),pe={year:t,month:e,day:n}}function s(){TAG.Util.UI.createAssociationPicker(xe,"Choose the media you wish to associate with this artwork",{comp:t,type:"artwork"},"artwork",[{name:"all media",getObjs:TAG.Worktop.Database.getAssocMedia},{name:"currently associated",getObjs:TAG.Worktop.Database.getAssocMediaTo,args:[t.Identifier]},{name:"recently associated",getObjs:TAG.Util.UI.getRecentlyAssociated}],{getObjs:TAG.Worktop.Database.getAssocMediaTo,args:[t.Identifier]},function(){$(".assetContainer").empty(),i($(".assetContainer"))})}var l,c,h,p,f,g,m;c=$(document.createElement("div")),c.addClass("sidebar"),c.css({width:"20%",height:"100%",position:"relative",left:"0%","float":"left","background-color":"rgba(0,0,0,0.85)","z-index":100}),h=$(document.createElement("div")),h.attr("class","buttonContainer"),h.css({position:"relative","margin-top":"4%","text-align":"center"}),c.append(h);var y=$(document.createElement("div")).attr("id","metadataForm").css({background:"rgba(0, 0, 0, 0.85)","border-radius":"0px 10px 10px 0px",left:"20%",width:"38%",position:"absolute",display:"none",color:"white","padding-top":"1%","margin-top":"1%","z-index":1e5,"max-height":"70%","overflow-y":"scroll"}).appendTo(we),b=$(document.createElement("div"));b.text("Metadata Editor"),b.css({width:"100%","text-align":"center","font-size":"150%"}),y.append(b),ye=$(document.createElement("div")),ye.attr("id","textFieldContainer"),$(ye).css({position:"relative",height:"25%",overflow:"auto",padding:"0px 4% 0px 0px","margin-top":"30px"}),y.append(ye),Ve.text("Add Information Field"),Ve.attr("type","button"),Ve.css({left:"10%",width:"80%","margin-top":"2%","margin-bottom":"3%",position:"relative"}),y.append(Ve),T({field:"Title",entry:t.Name}),T({field:"Artist",entry:t.Metadata.Artist}),T({field:"Year",entry:t.Metadata.Year}),T({field:"Description",entry:t.Metadata.Description,isTextarea:!0});var x=$(document.createElement("div"));x.attr("class","addInfoDialog"),x.css({padding:"4% 4%",left:"105%","margin-bottom":"2.5%",top:"46%",position:"absolute","background-color":"rgba(0, 0, 0, 0.85)","border-radius":"10px","z-index":"100"});var w=$(document.createElement("div"));w.attr("class","addInfoDialogTriangle"),w.css({position:"absolute",top:"30%",left:"-40px",width:0,"border-style":"solid","border-width":"20px","border-color":"transparent rgba(0, 0, 0, 0.85) transparent transparent","z-index":"100"});var k=$(document.createElement("input"));k.attr("placeholder","Field"),k.css({border:"2px solid white","margin-bottom":"2%"});var C=$(document.createElement("input"));C.attr("placeholder","Entry"),C.css({border:"2px solid white","margin-bottom":"5%"});var S=$(document.createElement("button"));S.addClass("addButton"),S.text("Add"),S.css({color:"white",border:"2px solid white",right:"1%",position:"relative","float":"right"});var M=$(document.createElement("button"));M.addClass("cancelButton"),$(M).text("Cancel"),$(M).css({color:"white",border:"2px solid white",right:"2%",position:"relative","float":"right"});var D=document.createElement("div");$(D).attr("id","cover"),$(D).css({height:"100%",width:"100%",top:"1%","float":"left",position:"relative","background-color":"white",opacity:"0"}),$(D).bind("click",function(){return!1}),$(S).click(function(){var t=TAG.Util.encodeText(k.val()),e=TAG.Util.encodeText(C.val()),n=!0;("0">t||t.charAt(0)>"9"&&"A">t.charAt(0)||t.charAt(0)>"Z"&&"a">t.charAt(0)||t.charAt(0)>"z")&&(P.text("Please enter a valid field name"),n=!1),n&&(Se[t]=T({field:t,entry:e,animate:!0,isAdditionalField:!0}),x.fadeOut(100),P.text(""),be+=1,u()&&Ve.attr("disabled","disabled"))});var P=$(document.createElement("div"));P.css({color:"red","font-size":"90%"}),$(M)[0].onclick=function(){P.text(""),$(x).fadeOut(100)},$(x).append(w),$(x).append(k),$(x).append(C),$(x).append(P),$(x).append(S),$(x).append(M),$(c).append(x),$(x).hide(),Ve.on("click",function(){T({field:"new",entry:"metadata field",animate:!0,isAdditionalField:!0}),u()&&Ve.attr("disabled","disabled")}),f={"margin-top":"2%","margin-bottom":"3%",width:"81%",position:"relative"};var G,L;g={"margin-top":"2%","margin-bottom":"3%",width:"100%",height:.05*xe.height(),color:"white",position:"relative"};var R=TAG.Util.getMaxFontSizeEM("Edit Location History",1,.1*xe.width(),.65*g.height),H=TAG.Util.getMaxFontSizeEM("Artwork Information",1,.15*xe.width(),.8*g.height);p=$(document.createElement("div")),p.addClass("artworkInfoLabel"),p.text("Artwork Information"),p.css({color:"white","font-size":H,"margin-top":"2%"}),h.append(p);var z=$(document.createElement("img"));z.attr("src","/images/icons/Right.png"),z.css({position:"absolute",right:"5%",top:"30%",width:"auto",height:"40%"});var j=$(document.createElement("label"));j.text("Information"),j.css({width:"100%",height:"100%","line-height":"100%","text-align":"center"}),m=$(document.createElement("div")).css(g).on("click",function(){m.isSelected=!m.isSelected,y.toggle(),m.isSelected?($(this).css({"background-color":"white",color:"black"}),z.attr("src","/images/icons/RightB.png"),m.isSelected=!1,a(this),m.isSelected=!0):($(this).css({"background-color":"transparent",color:"white"}),z.attr("src","/images/icons/Right.png"))}),m.isSelected=!1,m.toggle=function(){y.toggle(),m.isSelected=!1,m.css({"background-color":"transparent",color:"white"}),z.attr("src","/images/icons/Right.png")},m.append(z),m.append(j),h.append(m),j.css({"line-height":m.height()+"px","font-size":R});var W=$(document.createElement("img"));W.attr("src","/images/icons/Right.png"),W.css({position:"absolute",right:"5%",top:"30%",width:"auto",height:"40%"});var V=$(document.createElement("label"));V.text("Edit Location History"),V.css({width:"100%",height:"100%","line-height":"100%","text-align":"center"}),G=$(document.createElement("div")),G.css(g),G.click(function(t){t.stopPropagation(),G.isSelected=!G.isSelected,v(),Je.fadeOut(),G.isSelected?($(this).css({"background-color":"white",color:"black"}),W.attr("src","/images/icons/RightB.png"),n(),G.isSelected=!1,a(),G.isSelected=!0):($(this).css({"background-color":"transparent",color:"white"}),W.attr("src","/images/icons/Right.png")),O()}),G.isSelected=!1,G.toggle=function(){G.isSelected=!1,G.css({"background-color":"transparent",color:"white"}),W.attr("src","/images/icons/Right.png")},h.append(G),G.append(W),G.append(V),V.css({"line-height":G.height()+"px","font-size":R});var Y=$(document.createElement("label"));Y.text("Edit Thumbnail"),Y.css({width:"100%",height:"100%","line-height":"100%","text-align":"center"});var ae=$(document.createElement("img"));ae.attr("src","/images/icons/Right.png"),ae.css({position:"absolute",right:"5%",top:"30%",width:"auto",height:"40%"}),L=$(document.createElement("div")),L.addClass("editThumbnailButton"),L.attr("type","button"),L.css(g),L.click(function(){v(),Je.fadeOut(),U(),L.isSelected=!L.isSelected,L.isSelected?($(this).css({"background-color":"white",color:"black"}),ae.attr("src","/images/icons/RightB.png"),L.isSelected=!1,a(),L.isSelected=!0):($(this).css({"background-color":"transparent",color:"white"}),ae.attr("src","/images/icons/Right.png"))}),L.isSelected=!1,L.toggle=function(){L.isSelected=!1,U("close"),L.css({"background-color":"transparent",color:"white"}),ae.attr("src","/images/icons/Right.png")},h.append(L),L.append(ae),L.append(Y),Y.css({"line-height":G.height()+"px","font-size":R});var oe=$(document.createElement("div"));oe.addClass("locationPanelDiv"),oe.css({position:"absolute",top:"10%",left:"20%",width:"100%",height:"85%",display:"none","z-index":"51"}),$(xe).append(oe);var se=$(document.createElement("div"));se.addClass("locationPanel"),se.css({width:"70%",height:"90%","z-indez":99,"background-color":"rgba(0,0,0,0.85);",padding:"2% 2%"}),oe.append(se);var ce=$(document.createElement("div"));ce.addClass("locationpanelToggle"),ce.css({position:"absolute",height:"11%",width:"2%",top:"48%",left:"74%","border-radius":"0px 10px 10px 0px","background-color":"rgba(0,0,0,0.85)"});var ue=$(document.createElement("img"));ue.addClass("lpToggleimg"),ue.attr("src","/images/icons/Left.png"),ue.css({position:"relative",top:"30%",width:"auto",height:"30%"}),ce.append(ue),J=$(document.createElement("div")),J.addClass("mapDiv"),J.attr("id","mapDiv"),J.css({position:"relative",width:"100%",height:"50%"}),se.append(J),$(J).one("load",A);var ge=setInterval(function(){$("#mapDiv").length>0&&($(J).trigger("load"),clearInterval(ge))},300),me=$(document.createElement("div"));me.addClass("bottomDiv"),me.css({position:"relative",height:"50%",width:"100%","margin-top":"1.5%"}),se.append(me);var ve=$(document.createElement("div"));ve.addClass("leftDiv"),ve.css({position:"relative",height:"100%",width:"69%","margin-right":"1%"}),me.append(ve);var Te=$(document.createElement("div"));Te.addClass("addLocationDiv"),Te.css({position:"relative",height:"100%",width:"100%",display:"none"}),ve.append(Te);var Ae=$(document.createElement("div"));Ae.addClass("rightDiv"),Ae.css({position:"absolute",height:"100%",width:"29%",top:0,right:0}),me.append(Ae);var Ee=$(document.createElement("div"));Ee.addClass("leftRow1"),Te.append(Ee),q=$(document.createElement("input")),q.attr("type","text"),q.attr("placeholder","Search..."),q.css({width:"70%",margin:"0px"}),Ee.append(q);var Me=$(document.createElement("button"));Me.text("Search"),Me.css({"max-width":"25%","float":"right"}),Me.click(function(){""===q[0].value?(TAG.Util.UI.drawPushpins(_e,te),I(),F("Please type in the search bar")):(te.entities.clear(),re.hide(),le.fadeOut("fast"),_())}),Ee.append(Me);var Ie=$(document.createElement("div"));Ie.addClass("leftRow2"),Ie.css({position:"relative",height:"60%","overflow-y":"hidden","overflow-x":"hidden",margin:"2% 0%"}),Te.append(Ie),le=$(document.createElement("div")),le.addClass("helpBox"),le.css({position:"absolute",top:0,left:0,height:"70%","text-align":"center","font-size":"100%",color:"white",width:"100%"}),le.text(ke),Ie.append(le),X=$(document.createElement("div")),X.addClass("resultsBox"),X.css({position:"absolute",top:0,left:0,width:"100%",height:"90%","overflow-y":"auto","overflow-x":"hidden"}),Ie.append(X);var De=$(document.createElement("div"));De.addClass("leftRow3"),De.css({position:"relative",bottom:"7.5%",width:"100%"}),Te.append(De);var Pe=$(document.createElement("div"));Pe.text("Date"),Pe.css({color:"white","font-size":"100%"}),De.append(Pe);var $e=$(document.createElement("div"));ie=$(document.createElement("div")),ie.css({width:"100%","float":"left"});var Ne=["January","Feburary","March","April","May","June","July","August","September","October","November","December"];Ue=$(document.createElement("select")),He=$(document.createElement("select")),Re=$(document.createElement("input")),Re.attr("maxlength",15);var Ge={width:"120px","margin-right":"0.5%","font-size":"95%"};Ue.css(Ge),Ue.css({width:"65px"}),He.css(Ge),Re.css({"font-size":"95%",width:"50px"});var Oe=$(document.createElement("option")).html("---").attr("value",-1);for(Ue.addClass("datePicker dateBox"),He.addClass("datePicker monthBox"),Re.addClass("datePicker yearBox"),Re.attr("id","yearBox"),ie.append(Ue).append(He).append(Re),$e.append(ie),De.append($e),Ue.append(Oe.clone().attr("value",0)),He.append(Oe.clone().attr("value",0)),l=0;31>l;l++){var Le=$(document.createElement("option"));Le.html(l+1),Le.attr("value",l+1),Ue.append(Le)}for(l=0;12>l;l++){var Fe=$(document.createElement("option"));Fe.html(Ne[l]),Fe.attr("value",l+1),He.append(Fe)}Ue.change(o),He.change(o),Re.change(o);var Be=$(document.createElement("button"));Be.css({"margin-left":"1.5%","margin-top":"1%","min-width":"0px","min-height":"0px",width:"22%","font-size":"100%"}),Be.text("Edit Description"),ie.append(Be);var ze=$(document.createElement("div"));se.append(ze),ze.css({"background-color":"rgba(0, 0, 0, 0.85)",width:"30%",height:"18%",position:"absolute",bottom:"16%",left:"25%"});var je={border:"2px solid Gray","margin-bottom":"3%",width:"100%","float":"left"},We=$(document.createElement("textarea"));ze.append(We),We.attr("id","descriptionText"),We.attr("placeholder","Description"),We.attr("rows","5"),We.css(je),We.css({padding:"0px 1px 0px 1px","margin-top":"0px","background-color":"white",position:"absolute",width:"89%",left:"5%",top:"20px"});var Ye=$(document.createElement("button"));Ye.addClass("cancelEditDescButton"),Ye.text("Cancel"),Ye.css({color:"white",border:"2px solid white",position:"absolute",width:"15%",bottom:"9.5%",left:"5%",height:"10%"}),Ye.click(function(){K&&""!==K&&We.val(K),qe=!1,ze.hide()}),ze.append(Ye);var Xe=$(document.createElement("button"));Xe.addClass("saveDescButton"),Xe.text("Save"),Xe.css({color:"white",border:"2px solid white",position:"absolute",width:"15%",bottom:"9.5%",right:"5%",height:"10%"}),Xe.click(function(){K=We.val(),qe=!1,ze.hide()}),ze.append(Xe),ze.hide(),Be.on("click",function(){if(qe=!qe){var t=TAG.Util.constrainAndPosition(se.width(),se.height(),{width:.5,height:.35,max_width:768,max_height:192});ze.css({width:t.width+"px",height:t.height+"px"});var e=TAG.Util.constrainAndPosition(ze.width(),ze.height(),{center_h:!0,width:.9,x_offset:.05,y_offset:.12,y_max_offset:25});We.css({top:e.y+"px",left:e.x-2+"px",width:e.width+"px"}),ze.show(),K?We.attr("value",fe):We.attr("value","")}else ze.hide()});var Ke=$(document.createElement("button"));Ke.css({position:"absolute",right:"16.5%","margin-top":"1%","min-width":"0px","min-height":"0px",width:"12%","font-size":"100%"}),Ke.text("Cancel"),Ke.click(function(){de=void 0,he=void 0,K=void 0,pe=void 0,Te.hide("blind"),ne.show(),TAG.Util.UI.drawPushpins(_e,te),Microsoft.Maps.Events.removeHandler(ee),B(ie)}),ie.append(Ke);var Ze=$(document.createElement("button"));Ze.css({position:"absolute",right:"0%","margin-top":"1%","min-width":"0px","min-height":"0px",width:"15%","font-size":"100%"}),Ze.text("Confirm"),Ze.click(function(){N()&&(ze.hide(),Te.hide("blind"),ne.show(),TAG.Util.UI.drawPushpins(_e,te),Microsoft.Maps.Events.removeHandler(ee),B(ie))}),ie.append(Ze),Q=$(document.createElement("div")),Q.attr("class","confirmBubble"),Q.css({padding:"4% 4%",left:"63%","margin-bottom":"4%",top:"-150%",position:"absolute","background-color":"rgba(255,255,255,.6)","border-radius":"10px","z-index":"2","font-weight":"bold","text-align":"center"}),Q.html("Please select a valid location");var Qe=$(document.createElement("div"));Qe.attr("class","confirmBubbleTriangle"),Qe.css({position:"absolute",top:"100%",left:"40%",width:0,"border-style":"solid","border-width":"20px","border-color":"rgba(255,255,255,.6) transparent transparent transparent"}),Q.append(Qe),De.append(Q),Q.hide(),ne=$(document.createElement("button")),ne.css({position:"absolute","float":"left","min-width":"0px","min-height":"0px"}),ne.text("Add Location"),ee=null,ne.click(function(){le.show(),q.val(""),I(),le.fadeIn(),TAG.Util.fitText(le,3.5),Te.show("blind"),ee=Microsoft.Maps.Events.addHandler(te,"rightclick",E),ne.hide()}),ve.append(ne);var tn=$(document.createElement("div"));tn.addClass("locationsTitle"),tn.text("Locations"),tn.css({color:"white","font-size":"185%",position:"relative",top:"-0.75%"}),Ae.append(tn),Z=$(document.createElement("div")),Z.addClass("listOfLocations"),Z.css({position:"relative",height:"80%","overflow-y":"auto","overflow-x":"hidden"}),Ae.append(Z);var en=$(document.createElement("button"));$(en).addClass("addHotspots"),$(en).text("New Hotspot"),$(en).css(f);var nn=$(document.createElement("button"));nn.addClass("addAssocMedia"),nn.text("New Associated Media"),nn.css(f);var rn=$(document.createElement("button"));rn.addClass("textAssocMedia"),rn.text("Add Text Asset"),rn.attr("type","button"),rn.css(f);var an=$(document.createElement("div"));an.addClass("assocMediaLabel"),an.text("Assets and Media"),an.css({color:"white","font-size":H,"margin-top":"2%","margin-bottom":"2%"}),h.append(an);var on=$(document.createElement("button"));on.addClass("addRemoveMedia"),on.text("Add/Remove Media"),on.attr("type","button"),on.css(f),h.append(on),on.on("click",s);
var sn=document.createElement("div"),ln=$(sn);ln.addClass("assocMediaEditor"),ln.css({width:"30%",height:"60%",color:"white","background-color":"rgba(0,0,0,.85)",position:"absolute",left:"40%",top:"30%"});var cn=$(document.createElement("div"));$(cn).css({color:"white","font-size":"175%",padding:"1%",margin:"1%",background:"none","background-color":"rgba(0,0,0,.85)",border:"none","white-space":"nowrap",overflow:"hidden",height:"0px"}),rn.on("click",function(){d({assetType:"Asset"},"",!0)});var un=$(document.createElement("div"));un.attr("class","buttonContainer"),un.css({position:"relative",top:"0%,","margin-top":"2%",padding:"0px 4% 0px 12%","overflow-y":"auto",height:"60%"}),un.addClass("assetContainer"),c.append(un),i(un);var dn=$(document.createElement("div"));$(dn).addClass("sidebarHideButtonContainer"),$(dn).css({top:"0%",right:"0%",position:"relative",width:"2%",height:"100%","float":"left"});var hn=$(document.createElement("div"));$(hn).css({top:"45%",right:"0%",position:"relative",width:"100%",height:"10%","background-color":"rgba(0,0,0,.85)","border-bottom-right-radius":"10px","border-top-right-radius":"10px"});var pn=document.createElement("img");$(pn).css({top:"39%",width:"40%",height:"auto",position:"relative",left:"20%"}),$(pn).attr("src","images/icons/Left.png"),$(hn).append(pn),$(dn).append(hn);var fn=!0;$(hn)[0].onclick=function(){fn?($(pn).attr("src","images/icons/Right.png"),fn=!1,$(c).animate({left:"-20%"},600),$(dn).animate({left:"-20%"},600)):($(pn).attr("src","images/icons/Left.png"),$(c).animate({left:"0%"},600),$(dn).animate({left:"0%"},600),fn=!0)},we.append(c),we.append(dn)}function b(t,e,n){function i(){$("div.results").css({"background-color":"transparent",color:"white"});var t=parseInt(Re[0].value,10),e=He[0][He[0].selectedIndex].value,n=Ue[0][Ue[0].selectedIndex].value;0===e||isNaN(e)?e=void 0:e-=1,(0===n||isNaN(n))&&(n=void 0),(""===t||isNaN(t))&&(e=void 0,n=void 0,t=void 0),pe={year:t,month:e,day:n}}var r=$(document.createElement("div"));r.addClass("basicDatePicker"),r.css({width:"100%","float":"left"});var a=$(document.createElement("option")).html("---").attr("value",-1),o=["January","Feburary","March","April","May","June","July","August","September","October","November","December"],s=$(document.createElement("select")),l=$(document.createElement("select")),c=$(document.createElement("input")),u={"min-width":"0px","min-height":"0px",width:"25%","margin-right":"1%","font-size":"95%"};s.css(u),s.css({width:"15%"}),l.css(u),c.css({"font-size":"95%",width:"12.5%","margin-right":"2.5px"}),r.append(s).append(l).append(c);var d=a.clone().attr("value",0),h=a.clone().attr("value",0);t&&0===t?s.append(d.attr("selected",1)):s.append(d),e&&0===e?l.append(h).attr("selected",1):l.append(h);var p;for(p=0;31>p;p++){var f=$(document.createElement("option"));f.html(p+1),f.attr("value",p+1),t&&e&&t===p+1&&f.attr("selected",1),s.append(f)}for(p=0;12>p;p++){var g=$(document.createElement("option"));g.html(o[p]),g.attr("value",p+1),e&&e===p&&g.attr("selected",1),l.append(g)}return n&&c.val(n),s.change(i),l.change(i),c.change(i),r}function x(){$(".addInfoDialog").fadeOut(),Ce&&($(".locationPanelDiv").hide("slide",{direction:"left"},500,function(){$(".sidebarHideButtonContainer").show()}),Ce=!1),$(".tnBorderWrapper").fadeOut()}function T(t){var e=t.field,n=t.entry,i=t.animate,r=t.isTextarea,a=t.isAdditionalField,o=$(document.createElement("div"));o.addClass("textareaContainer"),o.css({"margin-bottom":"7%",width:"100%","text-align":"left"});var s=$(document.createElement(a?"input":"div"));s.addClass("fieldTitle"),a&&s.addClass("additionalField"),s.css({display:"inline-block",color:a?"black":"white","margin-right":"14px",width:"15%","text-align":"right","vertical-align":a?"":"top","padding-top":a?"0px":"5px",overflow:"auto",border:"0px solid black"}),a?s.attr("value",e):s.text(e);var l=$(document.createElement(r?"textarea":"input"));r&&(l.attr("rows",3),l.css({overflow:"auto",padding:"0px",background:"white",border:"0px solid black"})),l.attr("placeholder",e),l.css({width:"70%","font-size":"11pt",display:"inline-block",border:"0px solid black"}),a&&(s.attr("entry",n),l.on("keyup",function(){s.attr("entry",l.attr("value")),console.log("entry = "+s.attr("entry"))})),Ee[e]=l,l.val(n),l.attr("title",e);var c=$(document.createElement("div")).css({"margin-left":"15px",display:"inline-block",width:"30px"});return"Title"!==e&&"Keywords"!==e&&"Artist"!==e&&"Year"!==e&&"Description"!==e&&(c=$(document.createElement("img")),c.attr("src","images/icons/minus.svg"),c.css({"float":"right","margin-right":"2%",width:"30px",height:"30px",display:"inline-block"}),c.bind("click",{Param1:e},function(t){be-=1,u(!0)||Ve.removeAttr("disabled"),delete Se[t.data.Param1],o.remove()})),i&&o.css("display","none"),o.append(s),o.append(l),o.append(c),ye.append(o),i&&o.slideDown(function(){$("#metadataForm").animate({scrollTop:$("#metadataForm")[0].scrollHeight},1e3)}),l}function w(e){function n(){$e&&$e.cancelPromises(),$(i).off("click");var e=new TAG.Authoring.NewSettingsView("Artworks",null,null,t.Identifier);TAG.Util.UI.slidePageRight(e.getRoot())}Te.addClass("topbar"),Te.css({"background-color":"rgb(63,55,53)",color:"rgb(175,200,178)",width:"100%",height:e+"%",position:"relative"});var i=document.createElement("img");$(i).attr("src","images/icons/Back.svg"),$(i).css({height:"63%","margin-left":"1.2%","float":"left",width:"auto",top:"18.5%",position:"relative"}),$(Te).append(i),i.onmousedown=function(){TAG.Util.UI.cgBackColor("backButton",i,!1)},i.onclick=function(){var t;We?(t=TAG.Util.UI.popUpMessage(null,"Adding media to artwork. Please wait a few moments.",null),$(t).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3),$("body").append(t),$(t).fadeIn(500,function(){TAG.Util.UI.cgBackColor("backButton",i,!0)})):je?(t=TAG.Util.UI.PopUpConfirmation(n,"Asset upload in progress. Stop remaining upload and exit?","Yes"),$(t).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3),$("body").append(t),$(t).fadeIn(500,function(){TAG.Util.UI.cgBackColor("backButton",i,!0)})):Ne?(Oe=$(TAG.Util.UI.popUpMessage(null,"You are currently editing a Hotspot or Media","OK",!1)),xe.append(Oe),Oe.show(),TAG.Util.UI.cgBackColor("backButton",i,!0)):n()};var r=$(document.createElement("div")),a=TAG.Util.constrainAndPosition($(window).width(),.08*$(window).height(),{width:.4,height:.9});r.css({"margin-right":"2%","margin-top":"0.36%",color:"white",position:"absolute","text-align":"right",right:"0px",top:"0px",height:a.height+"px",width:a.width+"px"}),Be=TAG.Util.getMaxFontSizeEM("Artwork Editor",.5,a.width,.8*a.height),r.css({"font-size":Be}),r.text("Artwork Editor"),Y=$(document.createElement("div")),V=TAG.Util.constrainAndPosition($(window).width(),.08*$(window).height(),{center_v:!0,width:.15,height:.5,x_offset:.05,x_max_offset:60}),Y.text(t.Name);var o=Be;Y.css({"margin-left":"3.25%",position:"absolute",color:"white","font-size":o,"margin-top":"0.36%",left:V.x+"px",width:V.width+"px",height:a.height+"px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}),Y.attr("id","titleArea"),$(Te).append(Y);var s=document.createElement("button");$(s).attr("type","button"),$(s).text("Save Changes");var l=TAG.Util.constrainAndPosition($(window).width(),.08*$(window).height(),{width:.1,max_width:150,height:.45,max_height:40,x_offset:.1,max_x_offset:275,center_v:!0}),c=TAG.Util.getMaxFontSizeEM("Save Changes",.5,.8*l.width,.8*l.height,.01);$(s).css({width:l.width+"px",height:l.height+"px",left:parseInt(Y.css("left"),10)+Y.width()+45+.022*$(window).width()+"px",top:l.y-2+"px",position:"absolute","font-size":c,padding:"1px"}),s.onclick=function(){var t;t=$(u),t.text("Saving..."),t.show(),R(function(){t.text("Changes Saved."),Y.text($(Ee.Title).val()),setTimeout(function(){t.hide()},3e3)},function(){t.hide();var e=TAG.Util.UI.popUpMessage(null,"Changes have not been saved.  You must log in to save changes.");$("body").append(e),$(e).show()},function(){t.hide();var e=TAG.Util.UI.popUpMessage(null,"Changes have not been saved.  There was an error contacting the server.");$("body").append(e),$(e).show()})},$(Te).append(s);var u=document.createElement("label");$(u).css({left:l.width+(parseInt(Y.css("left"),10)+Y.width()+45+.022*$(window).width())+.02*$(window).width()+"px",top:l.y+.17*l.height-2+"px",position:"absolute",color:"white","font-size":c}),$(Te).append(u),$(u).hide(),$(Te).append(r)}function k(){var e=t.Metadata.InfoFields;e=e||{},$.each(e,function(t,e){T({field:t,entry:e,animate:!0,isAdditionalField:!0})})}function A(){function e(){var e={credentials:Ae,mapTypeID:Microsoft.Maps.MapTypeId.road,showScalebar:!0,enableClickableLogo:!1,enableSearchLogo:!1,showDashboard:!1,showMapTypeSelector:!1,zoom:2,center:new Microsoft.Maps.Location(20,0)},n={mapTypeId:Microsoft.Maps.MapTypeId.road};te=new Microsoft.Maps.Map(document.getElementById("mapDiv"),e),re=new CustomInfobox(te,{color:"rgba(0,0,0,0.65)",arrowColor:"rgba(0,0,0,0.65)",closeButtonStyle:"position:absolute;right:5px;top:2px;cursor:pointer;font:40px Arial;line-height:24px;color:white;"}),te.setView(n),_e=TAG.Util.UI.getLocationList(t.Metadata),O()}Microsoft.Maps.loadModule("Microsoft.Maps.Map",{callback:e}),Microsoft.Maps.Pushpin.prototype.date=null,Microsoft.Maps.Pushpin.prototype.location=null,Microsoft.Maps.Pushpin.prototype.description=null,se=!0}function _(){I();var t="http://dev.virtualearth.net/REST/v1/Locations?query="+encodeURI(q.val())+"&output=json&key="+Ae;WinJS.xhr({url:t}).done(function(t){C(t)},function(){},function(t){console.log(t.readystate)})}function C(t){if(t=JSON.parse(t.responseText),t&&t.resourceSets&&t.resourceSets.length>0&&t.resourceSets[0].resources&&t.resourceSets[0].resources.length>0){var e=t.resourceSets[0].resources[0],n=e.bbox,i=Microsoft.Maps.LocationRect.fromLocations(new Microsoft.Maps.Location(n[0],n[1]),new Microsoft.Maps.Location(n[2],n[3]));te.setView({bounds:i});var r=new Microsoft.Maps.Location(e.point.coordinates[0],e.point.coordinates[1]),a={icon:"/images/icons/locationPin.png",width:20,height:30},o=new Microsoft.Maps.Pushpin(r,a);te.entities.push(o);for(var s=0;t.resourceSets[0].resources.length>s;s++)D(t.resourceSets[0].resources[s])}else F("No Results Found"),TAG.Util.UI.drawPushpins(_e,te)}function E(t){if("map"==t.targetType){le.hide();var e=new Microsoft.Maps.Point(t.getX(),t.getY()),n=t.target.tryPixelToLocation(e);te.entities.clear(),re.hide(),I();var i={draggable:!0,icon:"/images/icons/locationPin.png",width:20,height:30};te.getCenter();var r=new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(n.latitude,n.longitude),i);Microsoft.Maps.Events.addHandler(r,"dragend",function(){S(r.getLocation())}),Le=new Microsoft.Maps.Location(n.latitude,n.longitude),te.entities.push(r),S(r.getLocation())}}function S(t){I();var e=t.latitude,n=t.longitude,i="http://dev.virtualearth.net/REST/v1/Locations/"+e+","+n+"?"+"output=json&key="+Ae;WinJS.xhr({url:i}).then(M)}function M(t){t=JSON.parse(t.responseText);for(var e=0;t.resourceSets[0].resources.length>e;e++)D(t.resourceSets[0].resources[e]);0!==t.resourceSets[0].resources.length?P(t.resourceSets[0].resources[0]):P(Le)}function I(){$("div.results").detach(),he=void 0,de=void 0}function D(t){le.fadeOut("fast");var e=$(document.createElement("div")),n=t.address.formattedAddress,i={"background-color":"transparent",color:"white"},r={"background-color":"white",color:"black"};e.addClass("results");var a=TAG.Util.constrainAndPosition(X.width(),X.height(),{width:1,height:.14,max_height:40}),o=TAG.Util.getMaxFontSizeEM(n,.5,.95*a.width,.95*a.height,.01);e.css({color:"white",width:a.width+"px",height:a.height+"px",margin:"0 0 0.375% 0",padding:"1% 1.5%","font-size":o,position:"relative",overflow:"hidden"}),e.text(n),e.hover(function(){"white"===e[0].style.color&&e.css({"background-color":"rgba(50, 50, 50, 0.65)"})},function(){"white"===e[0].style.color&&e.css({"background-color":"transparent"})}),e.click(t,function(e){$("div.results").css(i),$(this).css(r);var n=e.data.bbox,a=Microsoft.Maps.LocationRect.fromLocations(new Microsoft.Maps.Location(n[0],n[1]),new Microsoft.Maps.Location(n[2],n[3]));te.setView({bounds:a}),te.entities.clear();var o=new Microsoft.Maps.Location(t.point.coordinates[0],t.point.coordinates[1]),s={icon:"/images/icons/locationPin.png",width:20,height:30},l=new Microsoft.Maps.Pushpin(o,s);te.entities.push(l),de=e.data,he=e.data.address.formattedAddress}),X.append(e)}function P(t){var e=$(document.createElement("div")),n=$(document.createElement("div")),i=$(document.createElement("button")),r=$(document.createElement("input"));n.text("Add Custom Address"),i.text("Save");var a={"background-color":"transparent",color:"white"},o={"background-color":"white",color:"black"};e.addClass("results");var s=TAG.Util.constrainAndPosition(X.width(),X.height(),{width:1,height:.14,max_height:40}),l=TAG.Util.getMaxFontSizeEM(n.text(),.5,.95*s.width,.95*s.height,.01);e.css({color:"white",width:s.width+"px",height:s.height+"px",margin:"0 0 0 0",padding:"1% 1.5%","font-size":l,position:"relative",overflow:"hidden"}),r.addClass("customInput"),r.css({display:"none",height:"100%",width:"50%","float":"left",border:"0px"}),i.css({display:"none","margin-left":"2%","float":"left","font-size":"85%","margin-top":"-0.5%"}),n.click(function(){$("div.results").css(a),n.hide(),r.fadeIn(),i.fadeIn(),de=t}),e.hover(function(){"white"===e[0].style.color&&e.css({"background-color":"rgba(50, 50, 50, 0.65)"})},function(){"white"===e[0].style.color&&e.css({"background-color":"transparent"})}),$("div.results").click(function(t){$(t.target)!==e&&(r.hide(),i.hide(),n.fadeIn())}),i.click(t,function(s){s.stopPropagation(),n.text(r.val()),r.fadeOut("fast"),i.fadeOut("fast",function(){e.append(n)}),de=s.data,he=r.val(),e.css(o),e.click(t,function(t){$("div.results").css(a),e.css(o),he=r.val(),de=t.data}),n.fadeIn(),n.unbind("click")}),e.append(n),e.append(r),e.append(i),X.append(e)}function N(){if(!de)return console.log("no location selected"),!1;var t=parseInt(Re[0].value,10),e=parseInt(He[0][He[0].selectedIndex].value,10)-1,n=parseInt(Ue[0][Ue[0].selectedIndex].value,10);(0>e||isNaN(e))&&(e=void 0),(0===n||isNaN(n))&&(n=void 0),(""===t||isNaN(t))&&(t=void 0,n=void 0,e=void 0),pe={year:t,month:e,day:n};var i=new H(de,he,pe,K);return TAG.Util.UI.addPushpinToLoc(i,_e.length),_e.push(i),O(),pe=void 0,de=void 0,he=void 0,K=void 0,!0}function G(t,e,n){n=n||1;var i,r;if(!t.date||!e.date)return 1;switch(n){case 1:i=t.date.year,r=e.date.year;break;case 2:i=t.date.month,r=e.date.month;break;case 3:i=t.date.day,r=e.date.day}return i?r?r===i?3===n?0:(n++,G(t,e,n)):i-r:1:r?1:-1}function O(){function t(t){return t.data.div.slideUp(function(){t.data.div.detach()}),t.data.locationList.remove(t.data.obj),TAG.Util.UI.drawPushpins(_e,te),O(),t.data.obj===ue&&re.hide(),!1}function e(t){ue=t.data.obj,setTimeout(function(){L(t.data.obj)},300)}function n(t){TAG.Util.UI.drawPushpins(_e,te),re.hide(),$("div.locations").css(s),$("img.removeButton").attr("src","images/icons/minus.svg"),$("img.editButton").attr("src","images/icons/edit.png"),$(this).find("img.removeButton").attr("src","images/icons/minusB.svg"),$(this).find("img.editButton").attr("src","images/icons/editB.png"),$(this).css(l);var e,n,i;t.data.resource.latitude?i=t.data.resource:(e=t.data.resource.point.coordinates[0],n=t.data.resource.point.coordinates[1],i=new Microsoft.Maps.Location(e,n));var r={center:i,zoom:4};te.setView(r)}function i(t){"white"===t.data[0].style.color&&t.data.css({"background-color":"rgba(50, 50, 50, 0.65)"})}function r(t){"white"===t.data[0].style.color&&t.data.css({"background-color":"transparent"})}for(var a=0;_e.length>a;a++)if("string"==typeof _e[a].date){var o=_e[a].date.split("-");o[2]=o[2].substring(0,2),_e[a].date={year:parseInt(o[0],10),month:parseInt(o[1],10),day:parseInt(o[2],10)}}_e.sort(G),$("div.locations").detach(),te&&te.entities.clear();var a;for(a=0;_e.length>a;a++){var s={"background-color":"transparent",color:"white"},l={"background-color":"white",color:"black"},c=_e[a].address,u="";if(_e[a].date&&!isNaN(_e[a].date.year)){var d=_e[a].date.year;0>d&&(d=Math.abs(d)+" BC"),u=" - "+d}else u=" - <i>Date Unspecified</i>";var h=$(document.createElement("div"));h.addClass("locations");var p=TAG.Util.constrainAndPosition(Z.width(),Z.height(),{width:1,height:.16625,max_height:45}),f=a+1+". "+c+u+"",g=f.length;g>30&&(g=30);var m=TAG.Util.getMaxFontSizeEM(f.substring(0,g),.5,1e3,.65*p.height,.01);h.css({color:"white",display:"none",width:p.width+"px",height:p.height+"px",margin:"0 0 0.375% 0",position:"relative",overflow:"hidden"});var v=$(document.createElement("div"));v.html(a+1+". "+c+u),v.css({width:"60%",height:"100%","white-space":"nowrap",overflow:"hidden","font-size":m,display:"inline-block",margin:"1.1% 0 0 3%","text-overflow":"ellipsis"}),h.append(v);var y=$(document.createElement("img"));y.on("click",null,{div:h,locationList:_e,obj:_e[a]},t),y.addClass("removeButton"),y.attr("src","images/icons/minus.svg"),y.css({height:"80%",width:"auto","margin-right":"5%","margin-top":"0.825%",display:"inline-block",position:"relative",right:"0px","float":"right"}),h.append(y);var b=$(document.createElement("img"));b.on("click",null,{obj:_e[a]},e),b.addClass("editButton"),b.attr("src","images/icons/edit.png"),b.css({height:"80%",width:"auto","margin-right":"2%","margin-top":"0.825%",display:"inline-block",position:"relative","float":"right"}),h.append(b),TAG.Util.UI.drawPushpins(_e,te),h.on("click",null,_e[a],n),h.on("mouseenter",null,h,i).on("mouseleave",null,h,r),Z.append(h),h.fadeIn(),_e[a]===ue&&h.click()}}function L(t){var e=t.pushpin,n=e._location;ce=$(document.createElement("div")),ce.attr("class","locationInfo"),ce.attr("id","locationInfo"),ce.css({padding:"0px","background-color":"rgba(255,255,255,0)","border-radius":"10px","min-width":"250px","max-width":"450px",position:"relative","float":"left"});var i,r={border:"2px solid Gray","margin-bottom":"3%",width:"100%","float":"left"};i=t.date&&t.date.year?b(t.date.day,t.date.month,t.date.year):b(),i.css({"margin-bottom":"3%"}),ae=$(document.createElement("input")),ae.attr("placeholder","Location"),ae.attr("id","locationTextArea"),ae.css(r),oe=$(document.createElement("textarea")),oe.attr("id","descriptionTextArea"),oe.attr("placeholder","Description"),oe.attr("rows","4"),oe.css(r),oe.css({padding:"0px 1px 0px 1px","margin-top":"0px","background-color":"white"});var a=$(document.createElement("button"));a.addClass("addButton"),a.text("Save"),a.css({color:"white",border:"2px solid white",padding:"1%",position:"relative","float":"right",left:"4px"}),a.click(function(){var e=parseInt(i[0].childNodes[2].value,10),n=parseInt(i[0].childNodes[1].value,10)-1,r=parseInt(i[0].childNodes[0].value,10);(""===e||isNaN(e))&&(e=void 0,n=0,r=0),(0>n||isNaN(n))&&(n=void 0),(0===r||isNaN(r))&&(r=void 0),t.date={year:e,month:n,day:r},ue.date={year:e,month:n,day:r},ue.address=ae.val(),ue.info=oe.val(),O()}),$(ce).append(i),$(ce).append(ae),$(ce).append(oe),$(ce).append(a),ae.attr("value",ue.address),oe.attr("value",ue.info),re.show(n,ce)}function F(t){le.stop(!0,!0).fadeOut(100,function(){le.text(t).fadeIn(500,function(){setTimeout(function(){le.fadeOut(100,function(){0===X[0].childNodes.length&&le.text(ke).fadeIn(500)})},1e3)})})}function B(t){t[0].childNodes[0].selectedIndex=0,t[0].childNodes[1].selectedIndex=0,t[0].childNodes[2].value=""}function R(e,n,i,r){var a,o={},s=$(".additionalField");for(a=0;s.length>a;a++)o[$(s[a]).attr("value")]=$(s[a]).attr("entry");TAG.Worktop.Database.changeArtwork(t.Identifier,{Name:$(Ee.Title).val(),Artist:$(Ee.Artist).val(),Year:$(Ee.Year).val(),Location:JSON.stringify(_e),Description:$(Ee.Description).val(),InfoFields:JSON.stringify(o)},e,n,W(t,"Change",r),i)}function H(t,e,n,i){this.resource=t,this.date=n,this.info=i,this.address=e,this.pushpin=null}function U(t){return"close"==t?($(ge).fadeOut(),void 0):(Ce&&($(".locationPanelDiv").hide("slide",{direction:"left"},500,function(){$(".sidebarHideButtonContainer").show()}),Ce=!1),$(".addInfoDialog").fadeOut(),void 0===$(ge)[0]?(z(),$(ge).fadeToggle(200)):$(ge).fadeToggle(200),void 0)}function z(){var t=$(".mainPanel").height(),e=$(".mainPanel").width(),n=1.564;ge=document.createElement("div"),$(ge).addClass("tnBorderWrapper"),$(ge).css({position:"relative",top:"0px",left:"0px",height:"100%",width:"100%",display:"none"});var i=document.createElement("div");$(i).addClass("tnBorderCenter"),$(i).css({position:"absolute",top:"15%",left:"25%",height:"50%",width:50*t*n/e+"%","background-color":"transparent",border:"2px solid white","z-index":60});var r=document.createElement("div");$(r).addClass("tbBorderLeft"),$(r).css({position:"absolute",top:"0%",left:0,height:"100%",width:"25%","background-color":"rgba(0,0,0,.6)","z-index":50});var a=document.createElement("div");$(a).addClass("tnBorderTop"),$(a).css({position:"absolute",top:"0%",left:"25%",height:"15%",width:$(i).width()+"%","background-color":"rgba(0,0,0,.6)","z-index":50});var o=document.createElement("div");$(o).addClass("tnBorderBottom"),$(o).css({position:"absolute",top:15+$(i).height()+"%",left:"25%",height:100-$(i).height()-$(a).height()+"%",width:$(i).width()+"%","background-color":"rgba(0,0,0,.6)","z-index":55});var s=document.createElement("div");$(s).addClass("tnBorderRight"),$(s).css({position:"absolute",top:"0%",left:25+$(i).width()+"%",height:"100%",width:75-$(i).width()+"%","background-color":"rgba(0,0,0,.6)","z-index":50});var l=document.createElement("div");$(l).addClass("artworkInfo"),$(l).css({position:"relative",width:"100%",height:"15%","background-color":"rgba(0,0,0,.6)",color:"white","font-size":"300%","text-align":"center"}),$(l).text("Artwork Info");var c=document.createElement("div");$(c).addClass("tnHelp"),$(c).css({position:"relative",top:"15%",left:"0%",width:"100%",height:"29%",border:"3px double white",padding:"1%","font-size":"120%",color:"white"}),$(c).text("Move and resize the artwork within the thumbnail window, and select “Save Thumbnail” when you’re happy with the composition.");var u=parseInt($(c).css("padding"),10)/100*($(o).innerWidth()/100)*xe.width(),d=parseInt($(c).css("border"),10),h=$(o).innerWidth()/100*xe.width();$(c).width(h-2*d-2*u);var p=document.createElement("button");$(p).text("Save Thumbnail"),$(p).css({position:"absolute",right:"0px",bottom:"15%"}),$(p).on("click",j),$(i).append(l),$(o).append(c),$(o).append(p),$(ge).append(a),$(ge).append(r),$(ge).append(i),$(ge).append(o),$(ge).append(s),we.append(ge)}function j(){function e(){$(".editThumbnailButton").click()}function n(){var t=TAG.Util.UI.popUpMessage(null,"Thumbnail not saved.  You must log in to save changes.");$("body").append(t),$(t).show()}function i(){var t=TAG.Util.UI.popUpMessage(null,"Thumbnail not saved.  There was an error contacting the server.");$("body").append(t),$(t).show()}var r=$("canvas"),a=r[0].getContext("2d"),o=$(".tnBorderCenter").offset().left,s=$(".tnBorderCenter").offset().top,l=$(".tnBorderCenter").outerWidth(),c=$(".tnBorderCenter").outerHeight(),u=a.getImageData(o,s,l,c),d=document.createElement("canvas");d.width=u.width,d.height=u.height;var h=d.getContext("2d");h.putImageData(u,0,0);var p=d.toDataURL();TAG.Worktop.Database.uploadImage(p,function(r){TAG.Worktop.Database.changeArtwork(t.Identifier,{Thumbnail:r},e,n,W(t,"Update",i))},n,i)}function W(t,e,n){return function(t,e){return e.force(),void 0}}this.getRoot=function(){return xe};var q,V,Y,X,K,Z,Q,J,te,ee,ne,ie,re,ae,oe,se,le,ce,ue,de,he,pe,fe,ge,me,ve,ye,be,xe=$(document.createElement("div")),Te=$(document.createElement("div")),we=$(document.createElement("div")),ke="To select a location, type into the search field or right-click/long-press on the map and drag the pushpin to the desired position, then click on the desired address and click 'Confirm'.",Ae="AkNHkEEn3eGC3msbfyjikl4yNwuy5Qt9oHKEnqh4BSqo5zGiMGOURNJALWUfhbmj",_e=[],Ce=!1,Ee={},Se={};TAG.Util.createQueue();var Me,Ie,De,Pe,$e,Ne,Ge,Oe,Le,Fe,Be,Re,He,Ue,ze=0,je=!1,We=!1,qe=!1,Ve=$(document.createElement("button")),Ye={},Xe=TAG.Util.createQueue(),Ke=!1,Ze=!1,Qe=!1;e();var Je=$(document.createElement("div"))},TAG.Util.makeNamespace("TAG.Layout.TourAuthoringNew"),TAG.Layout.TourAuthoringNew=function(t,e){"use strict";var n,i,r,a,o,s,l,c,u,d,h,p,f,g,m,v,y=$(document.createElement("div")),b=$(document.createElement("div")),x=.3*window.innerHeight,T=new DataHolder;y.css({"background-color":"rgb(219,218,199)",height:"100%",width:"100%"}),function(){b.css({"background-color":"rgb(219,218,199)",height:x+"px",width:"100%","box-shadow":"0px 30px 30px -25px #888"}),b.attr("id","resizableArea");var t=document.createDocumentFragment(),e=$(document.createElement("div"));t.appendChild(e[0]),e.addClass("resizeButtonArea"),e.css({height:"3%",width:"10%",position:"absolute",top:x+.09*window.innerHeight+"px",left:"45%","margin-left":"-1.5%","z-index":0,"float":"left"});var i=$(document.createElement("img"));i.addClass("resizeButton"),i.attr("src","images/icons/Ellipsis_brown.svg"),i.attr("id","resizeButton"),i.css({height:"auto",width:"30%",position:"absolute",top:"33%",left:"40%"});var o;e.draggable({axis:"y",containment:[0,window.innerHeight/5+.1*window.innerHeight,0,window.innerHeight/1.5+.1*window.innerHeight],scroll:!1,start:function(t,e){return a.getEditInkOn()===!0?!1:($("#bufferingDiv").css({background:"rgba(0,0,0,.9)"}),$($("#bufferingDiv").parent()).css({opacity:.9,display:"block"}),o=e.position.top,n.stop(),void 0)},stop:function(){a.onUpdate()},drag:function(t,e){if(a.getEditInkOn()===!0)return!1;if(e.position.top=Math.constrain(e.position.top,window.innerHeight/5+.1*window.innerHeight,window.innerHeight/1.5+.1*window.innerHeight),null===o)return o=e.position.top,void 0;var n=e.position.top-o;b.css({height:x+n+"px"}),l||(l=$(".mainScrollHider")),l.css({height:l.height()-n+"px"}),c||(c=$("#trackBody")),c.css({height:c.height()-n+"px"}),u||(u=$("#trackScrollVeil")),u.css({height:u.height()-n+"px"}),x+=n;var i=b.offset().top,s=b.height();d||(d=$("#inkTextControls")),h||(h=$("#inkDrawControls")),p||(p=$("#inkTransControls")),f||(f=$("#inkEditText")),g||(g=$("#inkEditDraw")),m||(m=$("#inkEditTransparency")),$("#inkTextControls").css("height",i+s-$("#inkTextControls").offset().top-10),$("#inkDrawControls").css("height",i+s-$("#inkDrawControls").offset().top-10),$("#inkTransControls").css("height",i+s-$("#inkTransControls").offset().top-10),$("#inkEditText").css("height",i+s-$("#inkEditText").offset().top-10),$("#inkEditDraw").css("height",i+s-$("#inkEditDraw").offset().top-10),$("#inkEditTransparency").css("height",i+s-$("#inkEditTransparency").offset().top-10),r.resize(),o=e.position.top},appendTo:"body"}),e.append(i),y.append(t)}(),function(){n=TAG.TourAuthoring.TimeManager(),i=TAG.TourAuthoring.UndoManager(),r=TAG.TourAuthoring.Viewer({timeManager:n}),a=TAG.TourAuthoring.Timeline({timeManager:n,undoManager:i,dataHolder:T,viewer:r,root:y}),r.setTimeline(a),s=TAG.TourAuthoring.PlaybackControl({timeManager:n,undoManager:i,viewer:r,timeline:a,root:y}),o=TAG.TourAuthoring.ComponentControls({root:y,undoManager:i,playbackControls:s,timeline:a,dataHolder:T,viewer:r,timeManager:n}),v=TAG.TourAuthoring.TopMenu({viewer:r,timeline:a,tourobj:t,componentControls:o,timeManager:n,undoManager:i,playbackControls:s,root:y});var l=document.createDocumentFragment();l.appendChild(b[0]),v.addToDOM(y),o.addToDOM(b),r.addToDOM(b),y.append(l),o.addCatalogToDOM(l),a.addToDOM(l),s.addToDOM(l),y.append(l);var c=JSON.parse(unescape(t.Metadata.Content));jQuery.isEmptyObject(c)&&(c=a.toRIN()),r.initializeTour(c),a.loadRIN(c,e),a.updateVerticalScroller()}(),this.getRoot=function(){return y}},TAG.Util.makeNamespace("TAG.TourAuthoring.TimeManager"),TAG.TourAuthoring.TimeManager=function(t){"use strict";function e(e){var n=[];e.start&&(Y=null,O=t.start,n.push("start")),e.end&&(L=t.end,n.push("end")),e.scale&&(Y=null,F=t.scale,n.push("scale")),(e.start||e.end||e.scale)&&_({start:O,end:L,scale:F,updated:n}),e.current&&(Y=null,B=e.current,k({current:B}))}function n(t){Y=null,O=t,_({start:O,end:L,scale:F,updated:["start"]})}function i(t){L=t,B>L&&(Y=null,B=L),_({start:O,end:L,scale:F,updated:["end"]})}function r(t){Y=null,F=t,_({start:O,end:L,scale:F,updated:["scale"]})}function a(t){0>t?t=0:t>L&&(t=L),Y=null,B=t;var e=(B-O)/(L-O);$({current:B,percent:e}),k({current:B,percent:e}),B>L&&console.log("On timeManager seek: asked to seek past end (normal seek)?!")}function o(t){Y=null,B+=t;var e=(B-O)/(L-O);$({current:B,percent:e}),k({current:B,percent:e}),B>L&&console.log("On timeManager seek: asked to seek past end (amount seek)?!")}function s(t){Y=null,B=(L-O)*t,$({current:B,percent:(B-O)/(L-O)}),k({current:B,percent:t})}function l(t){q=t}function c(){return q}function u(t){V=t}function d(){return F}function h(){var t=-10,e=!1,n=Date.now(),i=(B-O)/(L-O);$({current:B,percent:i}),E({current:B,percent:i}),G=window.requestAnimationFrame(function r(i){G=window.requestAnimationFrame(r),q&&(e?B+=(i-n)/1e3:(B=V(),B===t&&(e=!0,B+=(i-n)/1e3)),B>=L&&(B=L,p()),M({current:B,percent:(B-O)/(L-O)}),Y=null,t=B,n=i)})}function p(){G&&(window.cancelAnimationFrame(G),G=null,D())}function f(t){return(t-O)*F}function g(t){return t/F+O}function m(t){var e=parseInt(t/60,10),n=Math.floor(t%60);return 10>n&&(n="0"+n),e+":"+n}function v(t){var e,n;return t.split(":"),e=parseFloat(e),n=parseFloat(n),60*e+n}function y(){return B}function b(){return Y||(Y=f(B)),Y}function x(){return(B-O)/(L-O)}function T(){return{start:O,end:L,scale:F}}function w(t){R.push(t)}function k(t){var e;for(e=0;R.length>e;e++)R[e].call(N,t)}function A(t){H.push(t)}function _(t){var e;for(e=0;H.length>e;e++)H[e].call(N,t)}function C(t){U.push(t)}function E(t){var e;for(e=0;U.length>e;e++)U[e].call(N,t)}function S(t){z.push(t)}function M(t){var e;for(e=0;z.length>e;e++)z[e].call(N,t)}function I(t){j.push(t)}function D(t){var e;for(e=0;j.length>e;e++)j[e].call(N,t)}function P(t){W.push(t)}function $(t){var e;for(e=0;W.length>e;e++)W[e].call(N,t)}var N={};t=t||{};var G=null,O=t.start||0,L=t.end||180,F=t.scale||20,B=t.current||0,R=[],H=[],U=[],z=[],j=[],W=[],q=!1,V=null;N.setTime=e,N.setStart=n,N.setEnd=i,N.setScale=r,N.seek=a,N.seekByAmount=o,N.seekToPercent=s,N.setReady=l,N.getReady=c,N.registerTime=u,N.getScale=d,N.play=h,N.stop=p,w(p),N.timeToPx=f,N.pxToTime=g,N.formatTime=m,N.unformatTime=v;var Y=null;return N.getCurrentTime=y,N.getCurrentPx=b,N.getCurrentPercent=x,N.getDuration=T,N.onSeek=w,N.onSizing=A,N.onPlayStart=C,N.onPlay=S,N.onStop=I,N.onMove=P,N},TAG.Util.makeNamespace("TAG.TourAuthoring.UndoManager"),TAG.TourAuthoring.UndoManager=function(){"use strict";function t(t){if(f===!0&&(void 0===t.savedState&&(t.savedState=!1),p.length>0&&(p=[],$(".redoButton").css({opacity:"0.4"}),console.log("clear redoStack?")),h.push(t),$(".undoButton").css({opacity:"1.0"}),h.length>g)){var e=h.length-g;h.splice(0,e)}}function e(){return h.length>0?(console.log("SAVED STATE //TOP//FROM DSG// ==="+h[h.length-1].savedState),h[h.length-1].savedState):!0}function n(){return h.length}function i(){if(h.length>0){h[h.length-1].savedState=!0;for(var t=0;h.length-1>t;t++)h[t].savedState=!1}}function r(t){f=t}function a(){return f}function o(){if(h.length>0){var t=h.pop();t.unexecute(),p.push(t),$(".redoButton").css({opacity:"1.0"}),0===h.length&&$(".undoButton").css({opacity:"0.4"})}else $(".undoButton").css({opacity:"0.4"})}function s(){if(p.length>0){var t=p.pop();t.execute(),h.push(t),$(".undoButton").css({opacity:"1.0"}),0===p.length&&$(".redoButton").css({opacity:"0.4"})}else $(".redoButton").css({opacity:"0.4"})}function l(){h=[],p=[]}function c(){$(".undoButton").css({opacity:"1.0"}),$(".redoButton").css({opacity:"1.0"}),1>h.length&&$(".undoButton").css({opacity:"0.4"}),1>p.length&&$(".redoButton").css({opacity:"0.4"})}function u(e){var n,i;e=e||2,n={execute:function(){for(i=0;e>i;i++)s()},unexecute:function(){for(i=0;e>i;i++)o()}},t(n)}var d={},h=[],p=[],f=!1,g=75;return d.logCommand=t,d.dirtyStateGetter=e,d.undoStackSize=n,d.setPrevFalse=i,d.setInitialized=r,d.getInitialized=a,d.undo=o,d.redo=s,d.clear=l,d.greyOutBtn=c,d.combineLast=u,d
},TAG.Util.makeNamespace("TAG.TourAuthoring.ArtworkTrack"),TAG.TourAuthoring.ArtworkTrack=function(t,e){"use strict";t.type=TAG.TourAuthoring.TrackType.artwork,e=e||{};var n=TAG.TourAuthoring.Track(t,e);return e.track.addClass("artwork"),n},TAG.Util.makeNamespace("TAG.TourAuthoring.AudioTrack"),TAG.TourAuthoring.AudioTrack=function(t,e){"use strict";t.type=TAG.TourAuthoring.TrackType.audio,e=e||{};var n=TAG.TourAuthoring.Track(t,e);return e.track.addClass("audio"),n},TAG.Util.makeNamespace("TAG.TourAuthoring.Viewer"),TAG.TourAuthoring.Viewer=function(t){"use strict";function e(t){if(console.log(t.eventId),_)switch(t.eventId){case rin.contracts.esEventIds.interactionActivatedEventId:M.stop(),L=!0,F=t.sender._esData.experienceId,L&&!N&&!B&&M.getReady()&&n(t.sender);break;case rin.contracts.esEventIds.stateTransitionEventId:L&&!N&&!B&&M.getReady()&&n(t.sender)}}function n(t){var e,n="";if(t.captureKeyframe&&L){if(n=t.captureKeyframe(),""===n)return console.log("No keyframe captured!?"),void 0;e=t._esData.experienceId,_.receiveKeyframe(e,n,!0),_.allDeselected()}}function i(){L=!1,F=""}function r(){return B}function a(t){B=t}function o(t){P=!t,M.setReady(t),N=!1,t&&(G&&O&&(G=!1,g(M.getCurrentTime()),O=null),G=!1,setTimeout(function(){var t=document.createEvent("Event");t.initEvent("playerReady",!0,!0),$("body")[0].dispatchEvent(t)},500))}function s(){L=!1}function l(t){return A?A.captureKeyframe(t):void 0}function c(){return A.orchestrator.getCurrentLogicalTimeOffset()}function u(t){t.append(E)}function d(){return S}function h(){var t,e,n,i=E.height()-2*TAG.TourAuthoring.Constants.rinBorder,r=E.width()-2*TAG.TourAuthoring.Constants.rinBorder,a=16*i/9;r>=a?(e=(r-a)/2,S.css({width:a+"px",height:i+"px",top:"0px",left:e+"px"})):(t=9*r/16,n=(i-t)/2,S.css({width:r+"px",height:t+"px",top:n+"px",left:"0px"}))}function p(t){D||(A.play(t),D=!0)}function f(){D&&!P&&(A.pause(),D=!1)}function g(t){A.orchestrator._isNarrativeLoaded&&(G?O=M.timeToPx(t):A&&!D&&(f(),D=!1,A.pause(t)))}function m(t){A.volume(t)}function v(t){_=t}function y(t,e){A?A.load(t,e):setTimeout(function(){y(t,e)},50)}function b(t,e){e||(R=!0),console.log("####################################################: "+R);for(var n in t.resources)t.resources.hasOwnProperty(n)&&"string"==typeof t.resources[n].uriReference&&(t.resources[n].uriReference=TAG.Worktop.Database.fixPath(t.resources[n].uriReference));A?(N=!0,G=!0,A.orchestrator._isPlayerReady=!1,O=M.getCurrentTime(),A.unload(),A.loadData(t,function(){G||(g(M.getCurrentTime()),setTimeout(function(){var t=document.createEvent("Event");t.initEvent("playerReady",!0,!0),$("body")[0].dispatchEvent(t)},500)),e||(R=!1),console.log("##############################################: "+R)})):setTimeout(function(){b(t,!0)},50)}function x(){return R}function T(t){R=t}function w(t){var e;R=!0,console.log("isReloading: true, in initializeTour"),A?(e=M.getCurrentTime(),A.unload(),A.loadData(t,function(){setTimeout(function(){g(e),R=!1,console.log("isReloading: false, in initializeTour")},50)})):0===_.getTrackslength()?(e=M.getCurrentTime(),setTimeout(function(){R=!1,console.log("isReloading: false, in initializeTour")},50)):setTimeout(function(){b(t,!0)},50)}function k(){A.unload()}var A,_,C={},E=$(document.createElement("div")),S=$(document.createElement("div")),M=t.timeManager,I=t.url,D=!1,P=!1,N=!1,G=!1,O=null,L=!1,F="",B=!1,R=!1;return function(){E.attr("id","viewer"),E.css({"background-color":"rgb(0,0,0)",height:"100%",width:"80%",position:"relative",left:"20%"}),S.attr("id","rinContainer"),S.css({"border-style":"solid","border-width":TAG.TourAuthoring.Constants.rinBorder+"px","border-color":"white",height:"95%",width:"30%",top:"0%",left:"30%",position:"absolute","z-index":0}),E.append(S);var t=$(document.createElement("div"));t.attr("id","rinplayer"),t.css({"z-index":-100,overflow:"hidden",height:"100%",width:"100%",position:"absolute"}),S.append(t),rin.processAll(null,"js/rin/web/").then(function(){var n="systemRootUrl=js/rin/web/&hideAllControllers=true&playerMode=authorerEditor";A=rin.createPlayerControl(t[0],n),A.orchestrator.playerESEvent.subscribe(e,"id"),A.orchestrator.isPlayerReadyChangedEvent.subscribe(o),M.registerTime(c)}),I&&y(I,function(){console.log("Viewer: initial loading complete")})}(),C.capturingOff=i,C.isKeyframingDisabled=r,C.setKeyframingDisabled=a,$("body")[0].addEventListener("playerReady",function(){B=!1}),$("body")[0].addEventListener("playerReloading",function(){B=!0,setTimeout(function(){B=!1},150)}),M.onMove(s),M.onStop(s),C.captureKeyframe=l,C.getCurrentTime=c,C.addToDOM=u,C.getContainer=d,C.resize=h,C.play=p,M.onPlayStart(function(t){p(t.current)}),C.stop=f,M.onStop(f),C.seek=g,M.onSeek(function(t){g(t.current)}),C.volume=m,C.setTimeline=v,C.loadTour=y,C.reloadTour=b,C.getIsReloading=x,C.setIsReloading=T,C.initializeTour=w,C.unload=k,C},TAG.Util.makeNamespace("TAG.TourAuthoring.Command"),TAG.TourAuthoring.Command=function(t){"use strict";var e={};return e.execute=t.execute,e.unexecute=t.unexecute,e.savedState=!1,e},TAG.Util.makeNamespace("TAG.TourAuthoring.ComponentControls"),TAG.TourAuthoring.ComponentControls=function(t){"use strict";function e(t){var e=TAG.Util.UI.popUpMessage(null,t,null);$(e).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3),$("body").append(e),$(e).fadeIn(500),w.onUpdate(!0)}function n(t){t.append(g)}function i(t){t.appendChild(I),t.appendChild(D)}function r(){return M}var a,o,s,l,c,u,d,h,p,f=$(document.createElement("div")),g=document.createDocumentFragment(),m=$(document.createElement("div")),v=$(document.createElement("div")),y={},b=t.root,x=t.playbackControls,T=t.timeManager,w=t.timeline,k=t.viewer,A=(t.tourobj,t.undoManager),_=TAG.Util.createQueue(),C=TAG.Util.createQueue(),E="Search by Name, Artist, or Year...",S=["visible","exhibits","selected"],M=(k.getContainer(),!1);g.appendChild(f[0]),w.setCompControl(y);var I=TAG.Util.UI.blockInteractionOverlay();$(I).addClass("catalogPickerOverlay"),$(I).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex);var D=TAG.Util.UI.blockInteractionOverlay();return $(D).addClass("associatedMediaPickerOverlay"),$(D).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex),function(){function n(t){90===t.keyCode&&t.ctrlKey?re||(re=!0,b.on("keyup.z",function(t){re=!1,b.off("keyup.z"),w.getEditInkOn()?t.shiftKey?a.getInkUndoManager().redo():a.getInkUndoManager().undo():t.shiftKey?A.redo():A.undo()})):89===t.keyCode&&t.ctrlKey&&b.on("keyup.y",function(){b.off("keyup.y"),null!==a&&a.getInkUndoManager()?a.getInkUndoManager().redo():A.redo()})}function i(n,i){function r(){if(ye.isDatastringEmpty(ye.update_datastring())){var t=TAG.Util.UI.PopUpConfirmation(function(){n.setIsVisible(!0);var t=TAG.TourAuthoring.Command({execute:function(){w.removeTrack(n)},unexecute:function(){n.reloadTrack()}});A.logCommand(t),t.execute(),d.hide(),ne(),x.undoButton.off("click"),x.redoButton.off("click"),x.undoButton.on("click",function(){A.undo()}),x.redoButton.on("click",function(){A.redo()}),x.undoRedoInkOnly.css("display","none")},"You have created an empty ink. Would you like to delete ink track or go back to editing?","Delete Track",!0);return b.append(t),$(t).show(),void 0}if(c){var i=$("#inkCanv"),r=$("[data-proxy='"+escape(s)+"']"),o={x:r.data("x"),y:r.data("y"),w:r.data("w"),h:r.data("h")},l=k.captureKeyframe(s);if(!l)return e("The track this ink is attached to must be fully on screen in order to save this ink. Please seek to a location where the track is visible."),!1;var h,p,f,g,m=u.getType();if(m===TAG.TourAuthoring.TrackType.artwork)h=l.state.viewport.region.center.x,p=l.state.viewport.region.center.y,f=l.state.viewport.region.span.x,g=l.state.viewport.region.span.y;else if(m===TAG.TourAuthoring.TrackType.image){f=1/l.state.viewport.region.span.x;var v=l.state.viewport.region.span.x*i.width();g=l.state.viewport.region.span.y,h=-l.state.viewport.region.center.x*f,p=-(i.height()/v)*l.state.viewport.region.center.y}n.setInkInitKeyframe({x:h,y:p,w:f,h:g}),n.setInkRelativeArtPos(ye.getArtRelativePos(o,i.width(),i.height()))}var y=ye.update_datastring(),T=n.getInkPath(),_=TAG.TourAuthoring.Command({execute:function(){n.setInkPath(y),w.onUpdate(!0)},unexecute:function(){n.setInkPath(T),w.onUpdate(!0)}});ye.remove_all(),ne(),d.hide(),n.setIsVisible(!0),A.logCommand(_),_.execute(),x.undoButton.off("click"),x.redoButton.off("click"),x.undoButton.on("click",function(){A.undo()}),x.redoButton.on("click",function(){A.redo()}),x.undoRedoInkOnly.css("display","none"),a&&(a.getInkUndoManager().clear(),A.greyOutBtn())}x.undoRedoInkOnly.css({display:"inline-block"});var o,s,l,c=n.getInkEnabled(),u=n.getInkLink();if(c){s=u.getTitle();var h=$("[data-proxy='"+escape(s)+"']");l={x:h.data("x"),y:h.data("y"),w:h.data("w"),h:h.data("h")};var p=k.captureKeyframe(s);if(!p)return n.setIsVisible(!0),e("The track this ink is attached to must be fully on screen in order to edit this ink. Please seek to a location where the track is visible."),!1;var f,g,m,v,T=u.getType();if(T===TAG.TourAuthoring.TrackType.artwork)f=p.state.viewport.region.center.x,g=p.state.viewport.region.center.y,m=p.state.viewport.region.span.x,v=p.state.viewport.region.span.y;else if(T===TAG.TourAuthoring.TrackType.image){m=1/p.state.viewport.region.span.x;var _=p.state.viewport.region.span.x*$("#rinplayer").width();v=p.state.viewport.region.span.y,f=-p.state.viewport.region.center.x*m,g=-($("#rinplayer").height()/_)*p.state.viewport.region.center.y}}ee(),d.css({display:"block"});var C=$("#resizableArea").offset().top,E=$("#resizableArea").height();d.css("height",C+E-d.offset().top-10),oi.css({color:"black"}),si.css({color:"gray"}),ai="draw",ri.text("Draw"),li.text("Width: "),ci.text("7px"),li.append(ci),di.css("left","0px"),mi.text("Opacity: "),vi.text("100%"),mi.append(vi),bi.css("left",.87*yi.width()+"px"),ti.off("click"),ti.on("click",function(){n.setIsVisible(!0),w.setEditInkOn(!1),w.onUpdate(!0),w.setModifyingInk(!1),w.hideEditorOverlay(),di.attr("value",7),ye.updatePenWidth("brushEditSlider"),ye.remove_all(),ne(),d.hide(),x.undoButton.off("click"),x.redoButton.off("click"),x.undoButton.on("click",function(){A.undo()}),x.redoButton.on("click",function(){A.redo()}),x.undoRedoInkOnly.css("display","none")}),xi.off("click"),xi.on("click",function(){r(),w.hideEditorOverlay(),w.setEditInkOn(!1),w.setModifyingInk(!1)}),y.saveDraw=r,K(ei),ie();var S=new TAG.TourAuthoring.InkAuthoring("inkCanv",null,"componentControls",t);$("#inkCanv").css("background","rgba(0,0,0,0.01)"),a=S,S.set_editable(),S.set_mode(TAG.TourAuthoring.InkMode.draw),c&&(o=n.getInkInitKeyframe(),S.setInitKeyframeData(o),S.setArtName(s),S.retrieveOrigDims(),S.setEID(n.getTitle())),S.loadInk(i),c&&(S.update_datastring(),S.setOldOpac(1),S.adjustViewBoxDiv({x:l.x,y:l.y,width:l.w,height:l.h}),S.drawPaths(),S.drawBezierPath()),ye=S,w.onUpdate(!0),w.showEditorOverlay(),w.setEditInkOn(!0)}function r(){return a?a.getInkUndoManager():void 0}function g(n,i,r){function h(){var t;if(ye.isDatastringEmpty(ye.update_datastring())){var i=TAG.Util.UI.PopUpConfirmation(function(){n.setIsVisible(!0);var t=TAG.TourAuthoring.Command({execute:function(){w.removeTrack(n)},unexecute:function(){n.reloadTrack()}});A.logCommand(t),t.execute(),c.hide(),ne(),x.undoButton.off("click"),x.redoButton.off("click"),x.undoButton.on("click",function(){A.undo()}),x.redoButton.on("click",function(){A.redo()}),x.undoRedoInkOnly.css("display","none")},"You have created an empty ink. Would you like to delete ink track or go back to editing?","Delete Track",!0);return b.append(i),$(i).show(),void 0}if(S){var r=$("#inkCanv"),o=$("[data-proxy='"+escape(m)+"']"),s={x:o.data("x"),y:o.data("y"),w:o.data("w"),h:o.data("h")},l=k.captureKeyframe(m);if(!l)return e("The track this ink is attached to must be fully on screen in order to save this ink. Please seek to a location where the track is visible."),!1;var u,d,h,p,f=M.getType();if(f===TAG.TourAuthoring.TrackType.artwork)u=l.state.viewport.region.center.x,d=l.state.viewport.region.center.y,h=l.state.viewport.region.span.x,p=l.state.viewport.region.span.y;else if(f===TAG.TourAuthoring.TrackType.image){h=1/l.state.viewport.region.span.x;var g=l.state.viewport.region.span.x*r.width();p=l.state.viewport.region.span.y,u=-l.state.viewport.region.center.x*h,d=-(r.height()/g)*l.state.viewport.region.center.y}n.setInkInitKeyframe({x:u,y:d,w:h,h:p}),n.setInkRelativeArtPos(ye.getArtRelativePos(s,r.width(),r.height()))}ye.get_trans_shape_data(),t=ye.update_datastring(),t+=ye.getBoundingShapes();var v=n.getInkPath(),y=TAG.TourAuthoring.Command({execute:function(){n.setInkPath(t),w.onUpdate(!0)},unexecute:function(){n.setInkPath(v),w.onUpdate(!0)}});n.setIsVisible(!0),A.logCommand(y),y.execute(),ye.remove_all(),ne(),c.hide(),x.undoButton.off("click"),x.redoButton.off("click"),x.undoButton.on("click",function(){A.undo()}),x.redoButton.on("click",function(){A.redo()}),x.undoRedoInkOnly.css("display","none"),a&&(a.getInkUndoManager().clear(),A.greyOutBtn())}x.undoRedoInkOnly.css({display:"inline-block"});var p,f,g,m,v,T,_,C,E,S=n.getInkEnabled(),M=n.getInkLink();if(S){g=n.getInkInitKeyframe(),m=M.getTitle();var I=$("[data-proxy='"+escape(m)+"']");v={x:I.data("x"),y:I.data("y"),w:I.data("w"),h:I.data("h")};var D=k.captureKeyframe(m);if(!D)return n.setIsVisible(!0),e("The track this ink is attached to must be fully on screen in order to edit this ink. Please seek to a location where the track is visible."),!1;if(n.getInkLink().getType()===TAG.TourAuthoring.TrackType.artwork)T=D.state.viewport.region.center.x,_=D.state.viewport.region.center.y,C=D.state.viewport.region.span.x,E=D.state.viewport.region.span.y;else if(n.getInkLink().getType()===TAG.TourAuthoring.TrackType.image){C=1/D.state.viewport.region.span.x;var P=D.state.viewport.region.span.x*$("#rinplayer").width();E=D.state.viewport.region.span.y,T=-D.state.viewport.region.center.x*C,_=-($("#rinplayer").height()/P)*D.state.viewport.region.center.y}}o.css({display:"none"}),s.css({display:"none"}),l.css({display:"none"}),d.css("display","none"),u.css("display","none"),c.show();var N=$("#resizableArea").offset().top,G=$("#resizableArea").height();c.css({height:N+G-c.offset().top-10}),Yi.text("Opacity: "),Xi.text("80%"),Yi.append(Xi),Zi.css("left",.8*(Ki.offset().left+Ki.width())/1.28+"px"),Fi.off("click"),Fi.on("click",function(){n.setIsVisible(!0),w.onUpdate(!0),w.setModifyingInk(!1),w.setEditInkOn(!1),w.hideEditorOverlay(),ye.remove_all(),ne(),c.hide(),x.undoButton.off("click"),x.redoButton.off("click"),x.undoButton.on("click",function(){A.undo()}),x.redoButton.on("click",function(){A.redo()}),x.undoRedoInkOnly.css("display","none")}),Qi.off("click"),Qi.on("click",function(){h(),w.hideEditorOverlay(),w.setModifyingInk(!1),w.setEditInkOn(!1)}),y.saveTrans=h,K(Bi),ie();var O=new TAG.TourAuthoring.InkAuthoring("inkCanv",null,"componentControls",t);$("#inkCanv").css("background","rgba(0,0,0,0.01)"),a=O,O.set_mode(TAG.TourAuthoring.InkMode.shapes),O.set_editable(),O.setMarqueeFillOpacity(O.get_attr(i,"opac","f")),S&&(O.setInitKeyframeData(g),O.setArtName(m),p=$("#inkCanv").width(),f=$("#inkCanv").height(),O.retrieveOrigDims(),O.setEID(n.getTitle()));var L=i.split("mode")[1].split("[")[0].replace("]","");O.setTransMode(r),O.load_transparency_bounding_shapes(i),"isolate"===L&&(qi.css({color:"black"}),Vi.css({color:"gray"}),Wi="isolate",ji.text("Isolate"),O.setTransMode("isolate")),"block"===L&&(qi.css({color:"gray"}),Vi.css({color:"black"}),Wi="block",ji.text("Block"),O.setTransMode("block")),S&&(O.origPaperW/C,O.update_datastring(),O.setOldOpac(1),O.adjustViewBoxDiv({x:v.x,y:v.y,width:v.w,height:v.h})),ye=O;var F=ye.getMarqueeFillOpacity();Xi.text(Math.round(100*F)+"%"),Yi.append(Xi),Zi.css("left",F*(Ki.offset().left+Ki.width())/1.28+"px"),w.onUpdate(!0),w.showEditorOverlay()}function P(n,i,r){function o(){if(ye.isTextboxEmpty()){var t=TAG.Util.UI.PopUpConfirmation(function(){n.setIsVisible(!0);var t=TAG.TourAuthoring.Command({execute:function(){w.removeTrack(n)},unexecute:function(){n.reloadTrack()}});A.logCommand(t),t.execute(),u.hide(),ne(),x.undoButton.off("click"),x.redoButton.off("click"),x.undoButton.on("click",function(){A.undo()}),x.redoButton.on("click",function(){A.redo()}),x.undoRedoInkOnly.css("display","none")},"You have created an empty ink. Would you like to delete ink track or go back to editing?","Delete Track",!0);return b.append(t),$(t).show(),void 0}if(p){var i=$("#inkCanv"),r=$("[data-proxy='"+escape(d)+"']"),o={x:r.data("x"),y:r.data("y"),w:r.data("w"),h:r.data("h")},s=k.captureKeyframe(d);if(!s)return e("The track this ink is attached to must be fully on screen in order to save this ink. Please seek to a location where the track is visible."),!1;var l,c,h,g,m=f.getType();if(m===TAG.TourAuthoring.TrackType.artwork)l=s.state.viewport.region.center.x,c=s.state.viewport.region.center.y,h=s.state.viewport.region.span.x,g=s.state.viewport.region.span.y;else if(m===TAG.TourAuthoring.TrackType.image){h=1/s.state.viewport.region.span.x;var v=s.state.viewport.region.span.x*i.width();g=s.state.viewport.region.span.y,l=-s.state.viewport.region.center.x*h,c=-(i.height()/v)*s.state.viewport.region.center.y}n.setInkInitKeyframe({x:l,y:c,w:h,h:g}),n.setInkRelativeArtPos(ye.getArtRelativePos(o,i.width(),i.height()))}n.setInkPath(ye.update_datastring()),ne(),u.hide(),n.setIsVisible(!0),x.undoButton.off("click"),x.redoButton.off("click"),x.undoButton.on("click",function(){A.undo()}),x.redoButton.on("click",function(){A.redo()}),x.undoRedoInkOnly.css("display","none"),Qe.text("#FFFFFF"),$("#textColorToggle").attr("value","FFFFFF"),a&&(a.getInkUndoManager().clear(),A.greyOutBtn()),w.onUpdate()}x.undoRedoInkOnly.css({display:"inline-block"});var s,l,c,d,h,p=n.getInkEnabled(),f=n.getInkLink();if(p){c=n.getInkInitKeyframe(),d=f.getTitle();var g=$("[data-proxy='"+escape(d)+"']");h={x:g.data("x"),y:g.data("y"),w:g.data("w"),h:g.data("h")};var m=k.captureKeyframe(d);if(!m)return n.setIsVisible(!0),e("The track this ink is attached to must be fully on screen in order to edit this ink. Please seek to a location where the track is visible."),!1;var v,T,_,C,E=f.getType();if(E===TAG.TourAuthoring.TrackType.artwork)v=m.state.viewport.region.center.x,T=m.state.viewport.region.center.y,_=m.state.viewport.region.span.x,C=m.state.viewport.region.span.y;else if(E===TAG.TourAuthoring.TrackType.image){_=1/m.state.viewport.region.span.x;var S=m.state.viewport.region.span.x*$("#rinplayer").width();C=m.state.viewport.region.span.y,v=-m.state.viewport.region.center.x*_,T=-($("#rinplayer").height()/S)*m.state.viewport.region.center.y}}ee(),u.show();var M=$("#resizableArea").offset().top,I=$("#resizableArea").height();u.css({height:M+I-u.offset().top-10}),gn.text("Font: "),mn.text("Times New Roman"),gn.append(mn),Mn.css("left","0px"),Cn.text("Text Size: "),K(cn),ln.off("click"),ln.on("click",function(){n.setIsVisible(!0),w.onUpdate(!0),w.setModifyingInk(!1),w.setEditInkOn(!1),w.hideEditorOverlay(),ye.resetText(),ye.remove_all(),ne(),u.hide(),x.undoButton.off("click"),x.redoButton.off("click"),x.undoButton.on("click",function(){A.undo()}),x.redoButton.on("click",function(){A.redo()}),x.undoRedoInkOnly.css("display","none")}),In.off("click"),In.on("click",function(){o(),hn.val(""),dn.text(""),w.hideEditorOverlay(),w.setModifyingInk(!1),w.setEditInkOn(!1)}),y.saveText=o,ie();var D=new TAG.TourAuthoring.InkAuthoring("inkCanv",null,"componentControls",t);$("#inkCanv").css("background","rgba(0,0,0,0.01)"),a=D,s=$("#inkCanv").width(),l=$("#inkCanv").height(),D.set_mode(TAG.TourAuthoring.InkMode.text),D.set_editable();var P;P=D.get_attr(i,"fontsize","f")*l,D.setFontSize(P),oe=Math.max(48,P);var N=D.get_attr(i,"str","s");hn.val(N),dn.text(N);var G,O,L=r.fontsize/P;try{G=D.get_attr(i,"w","f"),G=p?G*L:G,O=D.get_attr(i,"h","f"),O=p?O*L:O}catch(F){G=null,O=null}p&&(D.setInitKeyframeData(c),D.setArtName(d),D.retrieveOrigDims(),D.setEID(n.getTitle()),D.loadInk(i),D.adjustViewBoxDiv({x:h.x,y:h.y,width:h.w,height:h.h}));var B=D.getPannedPos().x||D.get_attr(i,"x","f")*s,R=D.getPannedPos().y||D.get_attr(i,"y","f")*l;D.setFontFamily(D.get_attr(i,"font","s")),D.setFontColor(D.get_attr(i,"color","s")),D.add_text_box(B,R,G,O,N),D.getSVGText(),ae=P,En.text(Math.round(P)+"px"),Cn.append(En),Sn.attr("value",Math.round(P)+"px");var H=D.get_attr(i,"color","s");kn.text(H),le.fromString(H),ye=D,V(),X(cn,hn),w.onUpdate(!0),w.showEditorOverlay()}function N(){ne(),ee(),x.undoButton.off("click"),x.redoButton.off("click"),x.undoButton.on("click",function(){A.undo()}),x.redoButton.on("click",function(){A.redo()}),x.undoRedoInkOnly.css({display:"none"})}function G(){function t(t){t.properties.getMusicPropertiesAsync().done(function(t){l.push(t.duration/1e3)},function(t){console.log(t)})}function e(t){t.properties.getVideoPropertiesAsync().done(function(t){l.push(t.duration/1e3)},function(t){console.log(t)})}var n,i,r,a=[],o=$(this).text(),s=T.getCurrentPx(),l=[];M=!0,"Audio (MP3)"===o&&(r=TAG.Authoring.FileUploader(b,TAG.Authoring.FileUploadTypes.Standard,function(e){var r;for(i=0;e.length>i;i++)r=e[i],a.push(r.displayName),".mp3"===r.fileType&&(n=TAG.TourAuthoring.TrackType.audio,t(r))},function(t){var e,n,r;for(i=0;t.length>i;i++){e=t[i],n=a[i],r=l[i];var o=w.addAudioTrack(e,n,null,r),c=s,u=r;T.getDuration().end<u+T.pxToTime(c)&&T.setEnd(Math.min(TAG.TourAuthoring.Constants.maxTourLength,u+T.pxToTime(c)));var d=TAG.TourAuthoring.Constants.maxTourLength-T.pxToTime(c);TAG.TourAuthoring.Constants.displayEpsilon>d?o.addDisplay(T.timeToPx(TAG.TourAuthoring.Constants.maxTourLength-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):o.addDisplay(c,Math.min(d,u)),w.getTracks().length>0&&w.getTracks()[0].leftAndRight({translation:{x:0}},!1)}A.combineLast(2*t.length),M=!1,w.getDataHolder().mapTracks(function(t,e){t.track.updatePos(e)})},[".mp3"],!1,function(){b.append(TAG.Util.UI.popUpMessage(null,"There was an error uploading the file. Please try again later."))},!0),r.setMaxDuration(TAG.TourAuthoring.Constants.maxTourLength),r.setMinDuration(TAG.TourAuthoring.Constants.minMediaLength)),"Video (MP4)"===o&&(r=TAG.Authoring.FileUploader(b,TAG.Authoring.FileUploadTypes.Standard,function(t){var r;for(i=0;t.length>i;i++)r=t[i],a.push(r.displayName),(".mp4"===r.fileType||".ogg"===r.type)&&(n=TAG.TourAuthoring.TrackType.video,e(r))},function(t){var e,n,r;for(i=0;t.length>i;i++){e=t[i],n=a[i],r=l[i];var o=w.addVideoTrack(e,n,null,r),c=s,u=r;T.getDuration().end<u+T.pxToTime(c)&&T.setEnd(Math.min(TAG.TourAuthoring.Constants.maxTourLength,u+T.pxToTime(c)));var d=TAG.TourAuthoring.Constants.maxTourLength-T.pxToTime(c);TAG.TourAuthoring.Constants.displayEpsilon>d?o.addDisplay(T.timeToPx(TAG.TourAuthoring.Constants.maxTourLength-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):o.addDisplay(c,Math.min(d,u)),w.getTracks().length>0&&w.getTracks()[0].leftAndRight({translation:{x:0}},!1)}A.combineLast(2*t.length),M=!1,w.getDataHolder().mapTracks(function(t,e){t.track.updatePos(e)})},[".mp4"],!1,function(){b.append(TAG.Util.UI.popUpMessage(null,"There was an error uploading the file.  Please try again later."))},!0),r.setMaxDuration(TAG.TourAuthoring.Constants.maxTourLength),r.setMinDuration(TAG.TourAuthoring.Constants.minMediaLength)),"Image"===o&&TAG.Authoring.FileUploader(b,TAG.Authoring.FileUploadTypes.Standard,function(t){for(i=0;t.length>i;i++)a.push(t[i].displayName)},function(t){for(i=0;t.length>i;i++){var e=w.addImageTrack(t[i],a[i].replace(/\'/,"").replace(/\"/,"")),n=Math.min(5,T.getDuration().end-T.pxToTime(s)),r=TAG.TourAuthoring.Constants.displayEpsilon>n?e.addDisplay(T.timeToPx(T.getDuration().end-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):e.addDisplay(s,n);1.5>n&&n>=TAG.TourAuthoring.Constants.displayEpsilon&&(r.setIn(0),r.setOut(0),r.setMain(n)),w.getTracks().length>0&&w.getTracks()[0].leftAndRight({translation:{x:0}},!1)}A.combineLast(2*t.length),M=!1,w.getDataHolder().mapTracks(function(t,e){t.track.updatePos(e)})},[".jpg",".png",".gif"],!1,function(){b.append(TAG.Util.UI.popUpMessage(null,"There was an error uploading the file.  Please try again later."))},!0)}function O(e,n){var i=$(document.createElement("label"));return"From File"===e?i.addClass("clickable files"):i.addClass("clickable "+e),i.text(e),i.css({left:"0%",position:"relative","font-size":TAG.Util.getFontSize(190),color:"rgb(256, 256, 256)",display:"block",padding:"4% 0 5% 0","text-indent":"4%","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex+19}),i.on("mouseenter",function(){var t=$(this);switch(t.css({"background-color":"white",color:"black"}),t.text()){case"Artwork":case"Associated Media":ve.hide(),me.hide();break;case"From File":me.show(),ve.hide();break;case"Audio (MP3)":case"Video (MP4)":case"Image":we=!0;break;case"Annotate":xe?(ve.show(),me.hide()):t.css({"background-color":"transparent",color:"gray"});break;case"Write":case"Draw":case"Highlight":ke=!0}}),i.on("mouseleave",function(){var t=$(this);t.css({"background-color":"transparent",color:"white"}),"Annotate"!==t.text()||xe||t.css({"background-color":"transparent",color:"gray"}),Ae||_e||we||ke||(me.hide(),ve.hide())}),i.on("mousedown",function(t){t.stopImmediatePropagation()}),i.on("click",function(e){if(w.getEditInkOn()===!0){var n=TAG.Util.UI.popUpMessage(null,"An ink is already being edited.",null);return $(n).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+2e6),$("#resizableArea").parent().parent().append(n),F(),$(n).fadeIn(500),void 0}e.stopImmediatePropagation();for(var r=$(this),c=0;be.length>c;c++)r!==$(be[c])&&$(be[c]).css({"background-color":"transparent",color:"white"});switch(be[be.length]=this,r.text()){case"Artwork":N(),r.css({"background-color":"white",color:"black"}),ee(),ne(),F(),U();break;case"Associated Media":N(),r.css({"background-color":"white",color:"black"}),ge.data("selected",!1),ee(),ne(),F(),B();break;case"From File":r.css({"background-color":"white",color:"black"}),me.show(),ve.hide(),fe.data("selected",!1),Ae=!0;break;case"Audio (MP3)":case"Video (MP4)":case"Image":F(),N(),ee(),ne(),we=!0,G.call(i);break;case"Annotate":xe&&(r.css({"background-color":"white",color:"black"}),ve.show(),me.hide(),$(fe).data("selected",!1),_e=!0);break;case"Write":$(".undoButton").css({opacity:"0.4"}),$(".redoButton").css({opacity:"0.4"}),r.css({"background-color":"white",color:"black"}),ge.data("selected",!1),x.undoRedoInkOnly.css({display:"inline-block"}),F(),ee(),s.show();var u=$("#resizableArea").offset().top+$("#resizableArea").height()-s.offset().top-10;s.css({height:u}),Z(),ie();var d=new TAG.TourAuthoring.InkAuthoring("inkCanv",null,"componentControls",t);$("#inkCanv").css("background","rgba(0,0,0,0.01)"),a=d,d.resetText(),d.add_text_box(),d.setFontColor("FFFFFF"),d.setFontFamily("Times New Roman, serif"),d.setFontSize("12"),d.set_mode(TAG.TourAuthoring.InkMode.text),d.set_editable(),ye=d,Ue.val(""),He.text(""),Qe.text("#FFFFFF"),$("#textColorToggle").attr("value","FFFFFF"),h.fromString("FFFFFF"),$(".changeColor")[0].innerHTML="#"+$("#textColorToggle").attr("value"),X(Be,Ue),w.setEditInkOn(!0);break;case"Draw":$(".undoButton").css({opacity:"0.4"}),$(".redoButton").css({opacity:"0.4"}),r.css({"background-color":"white",color:"black"}),x.undoRedoInkOnly.css({display:"inline-block"}),ge.data("selected",!1),F(),ee(),l.css({display:"block"});var p=$("#resizableArea").offset().top,f=$("#resizableArea").height();l.css("height",p+f-l.offset().top-10),J(),Wn.text("#000000"),h.fromString("000000"),ie();var d=new TAG.TourAuthoring.InkAuthoring("inkCanv",null,"componentControls",t);$("#inkCanv").css("background","rgba(0,0,0,0.01)"),a=d,d.set_mode(TAG.TourAuthoring.InkMode.draw),d.set_editable(),d.updatePenWidth("brushSlider"),d.updatePenColor("brushColorToggle"),d.updatePenOpacity("opacitySlider"),ye=d,w.setEditInkOn(!0);break;case"Highlight":$(".undoButton").css({opacity:"0.4"}),$(".redoButton").css({opacity:"0.4"}),r.css({"background-color":"white",color:"black"}),x.undoRedoInkOnly.css({display:"inline-block"}),ge.data("selected",!1),F(),ee(),o.show();var u=$("#resizableArea").offset().top+$("#resizableArea").height()-o.offset().top-10;o.css({height:u}),Q(),ie();var d=new TAG.TourAuthoring.InkAuthoring("inkCanv",null,"componentControls",t);$("#inkCanv").css("background","rgba(0,0,0,0.01)"),a=d,d.set_mode(TAG.TourAuthoring.InkMode.shapes),d.set_editable(),ye=d,w.setEditInkOn(!0)}var g=r.data("selected");g&&r.css({"background-color":"transparent",color:"white"}),r.data("selected",!g),xe||ge.css({"background-color":"transparent",color:"gray"})}),n.append(i),i}function L(){xe=!1,ge.css({"background-color":"transparent",color:"gray"}),ve.hide(),o.css({display:"none"}),s.css({display:"none"}),l.css({display:"none"}),d.css({display:"none"}),c.css("display","none"),u.css("display","none"),w.setEditInkOn(!1),w.setModifyingInk(!1),ne()}function F(){Te=!0,de.click()}function B(){function t(t,e){if(e){var n;e.data("selected")?(e.data("selected",!1),e.css("background","#222"),n=De.indexOf(e.data("url")),Ie.splice(n,1),De.splice(n,1),Pe[e.data("url")]=!1,m.disabled=Ie.length?!1:!0):(e.data({selected:!0}),e.css("background","#999"),Ie.push({url:e.data("url"),name:e.data("name"),id:e.attr("id"),type:e.data("type"),duration:e.data("duration")}),De.push(e.data("url")),Pe[e.data("url")]=!0,m.disabled=!1)}}function e(t,e){if(e){var n,i,r,o,s,l,c;if(e.css("background","#999"),e.data("selected")!==!0&&(Ie.push({url:e.data("url"),name:e.data("name"),id:e.attr("id"),type:e.data("type"),duration:e.data("duration")}),e.data({selected:!0})),a(),$(D).fadeOut(),m.disabled=!0,Ee.attr("placeholder",E),Ie&&Ie.length){for(n=0;Ie.length>n;n++)if(i=Ie[n],"Video"===i.type)r=w.addVideoTrack(i.url,i.name,null,i.duration),o=T.getCurrentPx(),s=parseFloat(i.duration),T.getDuration().end<s+T.pxToTime(o)&&T.setEnd(Math.min(TAG.TourAuthoring.Constants.maxTourLength,s+T.pxToTime(o))),c=TAG.TourAuthoring.Constants.maxTourLength-T.pxToTime(o),l=TAG.TourAuthoring.Constants.displayEpsilon>c?r.addDisplay(T.timeToPx(TAG.TourAuthoring.Constants.maxTourLength-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):r.addDisplay(o,Math.min(c,s)),w.getTracks().length>0&&w.getTracks()[0].leftAndRight({translation:{x:0}},!1);else if("Image"===i.type){r=w.addImageTrack(i.url,i.name),o=T.getCurrentPx(),s=5;var u=Math.min(s,T.getDuration().end-T.pxToTime(o));l=TAG.TourAuthoring.Constants.displayEpsilon>u?r.addDisplay(T.timeToPx(T.getDuration().end-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):r.addDisplay(o,u),1.5>u&&u>=TAG.TourAuthoring.Constants.displayEpsilon&&(l.setIn(0),l.setOut(0),l.setMain(u)),w.getTracks().length>0&&w.getTracks()[0].leftAndRight({translation:{x:0}},!1)}else"Audio"===i.type?(r=w.addAudioTrack(i.url,i.name,null,i.duration),o=T.getCurrentPx(),s=parseFloat(i.duration),T.getDuration().end<s+T.pxToTime(o)&&T.setEnd(Math.min(TAG.TourAuthoring.Constants.maxTourLength,s+T.pxToTime(o))),c=TAG.TourAuthoring.Constants.maxTourLength-T.pxToTime(o),l=TAG.TourAuthoring.Constants.displayEpsilon>c?r.addDisplay(T.timeToPx(TAG.TourAuthoring.Constants.maxTourLength-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):r.addDisplay(o,Math.min(c,s)),w.getTracks().length>0&&w.getTracks()[0].leftAndRight({translation:{x:0}},!1)):console.log("Unrecognized file type imported!!!???");A.combineLast(2*Ie.length)}}Ee.attr("placeholder",E),Ee.val(""),M=!1,w.getDataHolder().mapTracks(function(t,e){t.track.updatePos(e)})}function n(n){n.click(function(e){var i=this;setTimeout(function(){var r=parseInt($(i).data("double"),10);r>0?$(i).data("double",r-1):t.call(i,e,n)},300)}).dblclick(function(t){$(this).data("double",2),e.call(this,t,n)})}function i(t){TAG.Worktop.Database.getAssocMediaTo(h[t],function(e){e.sort(function(t,e){return t.Name.toLowerCase()<e.Name.toLowerCase()?-1:1});var i=[];if(e)for(var a,o=0,s=0;e.length>s;s++){o++,a=e[s];
var l="Video"===a.Metadata.ContentType||"Audio"===a.Metadata.ContentType,c=a.Metadata.Duration<=TAG.TourAuthoring.Constants.maxTourLength&&a.Metadata.Duration>=TAG.TourAuthoring.Constants.minMediaLength,u=c||void 0===a.Metadata.Duration;if((l&&u||"Image"===a.Metadata.ContentType)&&i.push(a),o===e.length&&(d[h[t]]=i,i.length>0)){var p=document.createDocumentFragment();R(d[h[t]],n,p),TAG.Worktop.Database.getDoq(h[t],function(t){var e;if(t.Name.length>15){for(var n=!1,i=Math.min(t.Name.length,25),a=14;i>a;a++)" "!==t.Name[a]||n?"-"!==t.Name[a]||a===i-1||n||" "===t.Name[a+1]&&(e=t.Name.substr(0,a)+"...",n=!0):(e=t.Name.substr(0,a)+"...",n=!0);n||(e=t.Name.substr(0,25)+"...")}else e=t.Name;var o=document.createElement("div");$(o).addClass("artworkHolder"),$(o).attr("id",t.Identifier),$(o).css({width:"100%",height:"9%",margin:"1px 0px 1px 0px","font-size":"100%","padding-left":"3%","padding-top":"3%"}),$(o).text(e),$(Se).append(o),r($(o))})}}})}function r(t){t.off("click"),t.on("click",function(){C.clear(),$(".allAssociatedMediaHolder").css("background","black"),$(".artworkHolder").css("background","black"),t.css("background","#999");var e=t.attr("id");$(".mediaHolder").detach();var i=document.createDocumentFragment();R(d[e],n,i),m.disabled=Ie.length?!1:!0,TAG.Util.searchData(Ee.val(),".mediaHolder",S)})}function a(){$(".mediaHolder").detach(),$(".artworkHolder").detach(),$(".allAssociatedMediaHolder").detach(),$("#associatedLoadingLabel").detach()}Ie=[],De=[],Pe={},M=!0,$(D).fadeIn(),C.clear();var o=$(document.createElement("div"));o.css({display:"inline-block",position:"absolute",left:"3%",bottom:"2%"}),o.text("Loading..."),o.attr("id","associatedLoadingLabel");var s=$(document.createElement("img"));s.attr("src","images/icons/progress-circle.gif"),s.css({height:"12px",width:"auto","margin-left":"20px","float":"right"}),o.append(s),v.append(o);var l=w.getRelatedArtworks(),c=document.createElement("div");$(c).addClass("allAssociatedMediaHolder"),$(c).css({width:"100%",height:"9%",margin:"1px 0px 1px 0px",background:"#999","padding-left":"3%","padding-top":"3%"}),$(c).text("All Associated Media"),$(Se).append(c);for(var u,d={},h=[],p=0;l.length>p;p++){u=!0;for(var f=0;p>f;f++)if(l[f]===l[p]){u=!1;break}u&&h.push(l[p])}for(var g=0;h.length>g;g++)i(g);o.hide(),$(c).click(function(){$(".artworkHolder").css("background","black"),$(c).css("background","#999"),$(".mediaHolder").detach();for(var t=0;l.length>t;t++){var e=document.createDocumentFragment();R(d[h[t]],n,e)}m.disabled=Ie.length?!1:!0,TAG.Util.searchData(Ee.val(),".mediaHolder",S)});var m=document.createElement("button");m.disabled=!0,$(m).text("Import"),$(m).css({position:"absolute",bottom:"1%",right:"22%"}),$(m).click(function(){var t,e,n,i,r,o,s,l;if(a(),$(D).fadeOut(),m.disabled=!0,Ee.attr("placeholder",E),Ie&&Ie.length){for(e=0;Ie.length>e;e++)t=Ie[e],"Video"===t.type?(n=w.addVideoTrack(t.url,t.name,null,t.duration),i=T.getCurrentPx(),s=parseFloat(t.duration),T.getDuration().end<s+T.pxToTime(i)&&T.setEnd(Math.min(TAG.TourAuthoring.Constants.maxTourLength,s+T.pxToTime(i))),l=TAG.TourAuthoring.Constants.maxTourLength-T.pxToTime(i),r=TAG.TourAuthoring.Constants.displayEpsilon>l?n.addDisplay(T.timeToPx(TAG.TourAuthoring.Constants.maxTourLength-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):n.addDisplay(i,Math.min(l,s)),w.getTracks().length>0&&w.getTracks()[0].leftAndRight({translation:{x:0}},!1)):"Image"===t.type?(n=w.addImageTrack(t.url,t.name),i=T.getCurrentPx(),s=5,o=Math.min(s,T.getDuration().end-T.pxToTime(i)),r=TAG.TourAuthoring.Constants.displayEpsilon>o?n.addDisplay(T.timeToPx(T.getDuration().end-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):n.addDisplay(i,o),1.5>o&&o>=TAG.TourAuthoring.Constants.displayEpsilon&&(r.setIn(0),r.setOut(0),r.setMain(o)),w.getTracks().length>0&&w.getTracks()[0].leftAndRight({translation:{x:0}},!1)):"Audio"===t.type?(n=w.addAudioTrack(t.url,t.name,null,t.duration),i=T.getCurrentPx(),s=parseFloat(t.duration),T.getDuration().end<s+T.pxToTime(i)&&T.setEnd(Math.min(TAG.TourAuthoring.Constants.maxTourLength,s+T.pxToTime(i))),l=TAG.TourAuthoring.Constants.maxTourLength-T.pxToTime(i),r=TAG.TourAuthoring.Constants.displayEpsilon>l?n.addDisplay(T.timeToPx(TAG.TourAuthoring.Constants.maxTourLength-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):n.addDisplay(i,Math.min(l,s)),w.getTracks().length>0&&w.getTracks()[0].leftAndRight({translation:{x:0}},!1)):console.log("Unrecognized file type imported!!!???");A.combineLast(2*Ie.length)}Ee.attr("placeholder",E),Ee.val(""),M=!1,w.getDataHolder().mapTracks(function(t,e){t.track.updatePos(e)})}),v.append(m);var y=document.createElement("button");$(y).text("Cancel"),$(y).css({position:"absolute",bottom:"1%",right:"5%"}),$(y).click(function(){return a(),$(D).fadeOut(),m.disabled=!0,Ee.attr("placeholder",E),Ee.val(""),void 0}),v.append(y)}function R(t,e){if(t)for(var n=0;t.length>n;n++)C.add(H(t[n],e))}function H(t,e){return function(){var n=$(document.createElement("div"));n.addClass("mediaHolder"),n.attr("id",t.Identifier),n.data("type",t.Metadata.ContentType),n.data("url",t.Metadata.Source),n.data("name",t.Name),n.data("duration",t.Metadata.Duration);var i=Pe[t.Metadata.Source]?!0:!1;n.data("selected",i),n.css({"float":"left",background:i?"#999":"#222",width:"48%",height:"25%",padding:"2px",margin:"1px"}),$(Me).append(n);var r=$(document.createElement("div"));r.addClass("mediaHolderImageHolder"),r.css({"float":"left",width:"40%",margin:"3.5%",height:"80%",overflow:"hidden"}),n.append(r);var a=$(document.createElement("img"));a.addClass("mediaHolderImage"),"Audio"===t.Metadata.ContentType?a.attr("src","images/audio_icon.svg"):"Video"===t.Metadata.ContentType?a.attr("src",t.Metadata.Thumbnail&&!t.Metadata.Thumbnail.match(/.mp4/)?TAG.Worktop.Database.fixPath(t.Metadata.Thumbnail):"images/video_icon.svg"):"Image"===t.Metadata.ContentType?a.attr("src",t.Metadata.Thumbnail?TAG.Worktop.Database.fixPath(t.Metadata.Thumbnail):"images/image_icon.svg"):a.attr("src","images/text_icon.svg"),a.css({"float":"left",height:"100%","max-height":"100%","text-align":"center"}),a.removeAttr("width"),r.append(a);var o=$(document.createElement("div"));o.addClass("mediaHolderText");var s,s=t.Name;if(s.length>15){for(var l=!1,c=Math.min(s.length,24),u=14;c>u;u++)" "!==s[u]||l?"-"!==s[u]||u===c-1||l||" "===s[u+1]&&(s=s.substr(0,u)+"...",l=!0):(s=s.substr(0,u)+"...",l=!0);l||(s=s.substr(0,16)+"...")}o.text(s),o.css({floar:"left","padding-left":"3%","padding-right":"4.5%","font-size":"100%",margin:"5% 0 5% 2%",overflow:"hidden","word-wrap":"break-word"}),n.append(o),e(n)}}function U(){function t(t){var e;for(e=0;t.length>e;e++)"Empty"===t[e].Type&&(t.splice(e,1),e--);t.sort(function(t,e){return t.Name.toLowerCase()<e.Name.toLowerCase()?-1:1}),$.each(t,function(t,e){_.add(function(){var t=document.createElement("div"),n=[],a="";r&&$(t).hide().data("visible",!1);for(var o=0;e._Folders.FolderData.length>o;o++)n.push(e._Folders.FolderData[o]),r===e._Folders.FolderData[o].FolderId&&$(t).show().data("visible",!0),a+=e._Folders.FolderData[o].FolderId+" ";$(t).attr("class","artButton "+a),$(t).data({name:e.Name,artist:e.Metadata.Artist,year:e.Metadata.Year}),$(t).data("exhibits",n),$(t).addClass("artHolder"),$(t).attr("id",e.Identifier),$(t).data("name",e.Name),$(t).data("type",e.Metadata.Type),e.Metadata.Duration?($(t).data("duration",e.Metadata.Duration),$(t).data("url",e.Metadata.Source)):$(t).data("url",e.Metadata.DeepZoom),$(t).css({"float":"left",background:"#222",width:"48%",height:"25%",padding:"2px",margin:"1px"}),$(Oe).append(t),TAG.Util.searchData(Ne.val(),".artButton",S);var s=document.createElement("div");$(s).addClass("artHolderImageHolder"),$(s).css({"float":"left",width:"40%",margin:"3.5%",height:"80%",overflow:"hidden"}),$(t).append(s);var l=document.createElement("img");$(l).addClass("artHolderImage"),$(l).attr("src",TAG.Worktop.Database.fixPath(e.Metadata.Thumbnail)),$(l).css({width:"100%",height:"100%","max-height":"100%"}),$(s).append(l);var c=document.createElement("div");$(c).addClass("artHolderText");var u=e.Name;if(u.length>23){for(var d=!1,h=Math.min(u.length,35),p=20;h>p;p++)" "!==u[p]||d?"-"!==u[p]||p===h-1||d||" "===u[p+1]&&(u=u.substr(0,p)+"...",d=!0):(u=u.substr(0,p)+"...",d=!0);d||(u=u.substr(0,24)+"...")}$(c).text(u),$(c).css({floar:"left","padding-left":"3%","padding-right":"4.5%","font-size":"100%",margin:"5% 0 5% 2%",overflow:"hidden","word-wrap":"break-word"}),$(t).append(c),i($(t))})}),_.add(function(){o.hide()})}function e(t,e){var n;e.data("selected")?(e.css("background","#222"),e.data("selected",!1),n=De.indexOf(e.data("url")),Ie.splice(n,1),De.splice(n,1),Pe[e.data("url")]=!1,l.disabled=Ie.length?!1:!0):(e.css("background","#999"),e.data({selected:!0}),-1===De.indexOf(e.data("url"))&&(Ie.push({url:e.data("url"),name:e.data("name"),id:e.attr("id"),type:e.data("type"),duration:e.data("duration")}),De.push(e.data("url")),Pe[e.data("url")]=!0),l.disabled=!1)}function n(t,e){var n,i;for(l.disabled=!1,e.css("background","#999"),Pe[e.data("url")]||e.data("selected")===!0||(Ie.push({url:e.data("url"),name:e.data("name"),id:e.attr("id"),type:e.data("type"),duration:e.data("duration")}),Pe[e.data("url")]=!0,e.data({selected:!0})),$(I).fadeOut(),z(),Ne.attr("placeholder",E),Ne.val(""),n=0;Ie.length>n;n++){i=Ie[n];var r;if("VideoArtwork"===i.type){r=w.addVideoTrack(i.url,i.name,null,i.duration);var a=T.getCurrentPx(),o=parseFloat(i.duration);T.getDuration().end<o+T.pxToTime(a)&&T.setEnd(Math.min(TAG.TourAuthoring.Constants.maxTourLength,o+T.pxToTime(a)));var s=TAG.TourAuthoring.Constants.maxTourLength-T.pxToTime(a),c=TAG.TourAuthoring.Constants.displayEpsilon>s?r.addDisplay(T.timeToPx(TAG.TourAuthoring.Constants.maxTourLength-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):r.addDisplay(a,Math.min(s,o));w.getTracks().length>0&&w.getTracks()[0].leftAndRight({translation:{x:0}},!1)}else{r=w.addArtworkTrack(i.url,i.name,i.id,i.type);var a=T.getCurrentPx(),o=5,u=Math.min(o,T.getDuration().end-T.pxToTime(a)),c=TAG.TourAuthoring.Constants.displayEpsilon>u?r.addDisplay(T.timeToPx(T.getDuration().end-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):r.addDisplay(a,u);1.5>u&&u>=TAG.TourAuthoring.Constants.displayEpsilon&&(c.setIn(0),c.setOut(0),c.setMain(u)),w.getTracks().length>0&&w.getTracks()[0].leftAndRight({translation:{x:0}},!1)}}A.combineLast(2*Ie.length),M=!1,w.getDataHolder().mapTracks(function(t,e){t.track.updatePos(e)})}function i(t){t.click(function(n){var i=this;setTimeout(function(){var r=parseInt($(i).data("double"),10);r>0?$(i).data("double",r-1):e.call(i,n,t)},300)}).dblclick(function(e){$(this).data("double",2),n.call(this,e,t)})}Ie=[],Pe={},De=[],M=!0;var r;_.clear();var a=document.createElement("div");$(a).addClass("allArtworksHolder"),$(a).css({width:"100%",height:"9%",margin:"1px 0px 1px 0px",background:"#999","padding-left":"3%","padding-top":"3%"}),$(a).text("All Artworks"),$(Ge).append(a);var o=$(document.createElement("div"));o.css({display:"inline-block",position:"absolute",left:"3%",bottom:"2%"}),o.text("Loading..."),o.attr("id","loadingLabel");var s=$(document.createElement("img"));s.attr("src","images/icons/progress-circle.gif"),s.css({height:"12px",width:"auto","margin-left":"20px","float":"right"}),o.append(s),TAG.Worktop.Database.getExhibitions(function(e){function n(e){e.click(function(){$(".allArtworksHolder").css("background","black"),$(".exhibHolder").css("background","black"),e.css("background","#999");var n=e.attr("id");r=n,$(".catalogPickerArtworks").empty(),l.disabled=Ie.length?!1:!0,$(".artButton").hide().data("visible",!1),$("."+n).show().data("visible",!0),TAG.Util.searchData(Ne.val(),".artButton",S),TAG.Worktop.Database.getArtworksIn(e.attr("id"),t,function(){console.log("error")},function(){console.log("error2")})})}for(var i=0;e.length>i;i++){var a,o=e[i].Name;if(o.length>15){for(var s=!1,c=Math.min(o.length,25),u=14;c>u;u++)" "!==o[u]||s?"-"!==o[u]||u===c-1||s||" "===o[u+1]&&(a=o.substr(0,u)+"...",s=!0):(a=o.substr(0,u)+"...",s=!0);s||(a=o.substr(0,25)+"...")}else a=e[i].Name;var d=$(document.createElement("div"));d.addClass("exhibHolder"),d.attr("id",e[i].Identifier),d.css({width:"100%",height:"9%","text-overflow":"ellipsis",margin:"1px 0px 1px 0px","font-size":"100%","padding-left":"3%","padding-top":"3%"}),d.text(a),$(Ge).append(d),n(d)}TAG.Worktop.Database.getArtworks(t,function(){console.log("error")},function(){console.log("error2")})}),$(a).on("click",function(){$(".exhibHolder").css("background","black"),$(this).css("background","#999"),l.disabled=Ie.length?!1:!0,$(".catalogPickerArtworks").empty(),$(".artButton").show().data("visible",!0),TAG.Util.searchData(Ne.val(),".artButton",S),r=null,p?t(p):TAG.Worktop.Database.getArtworks(t,function(){console.log("error")},function(){console.log("error2")})}),$(I).fadeIn(),m.append(o);var l=document.createElement("button");l.disabled=!0,$(l).text("Import"),$(l).css({position:"absolute",bottom:"2%",right:"22%"}),$(l).click(function(){function t(t){var e,n,i=Ie[t],r=T.getCurrentPx();if("VideoArtwork"===i.type){e=w.addVideoTrack(i.url,i.name,null,i.duration),n=parseFloat(i.duration),T.getDuration().end<n+T.pxToTime(r)&&T.setEnd(Math.min(TAG.TourAuthoring.Constants.maxTourLength,n+T.pxToTime(r)));var a=TAG.TourAuthoring.Constants.maxTourLength-T.pxToTime(r),o=TAG.TourAuthoring.Constants.displayEpsilon>a?e.addDisplay(T.timeToPx(TAG.TourAuthoring.Constants.maxTourLength-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):e.addDisplay(r,Math.min(a,n));w.getTracks().length>0&&w.getTracks()[0].leftAndRight({translation:{x:0}},!1)}else{e=w.addArtworkTrack(i.url,i.name,i.id),n=5;var s=Math.min(n,T.getDuration().end-T.pxToTime(r)),o=TAG.TourAuthoring.Constants.displayEpsilon>s?e.addDisplay(T.timeToPx(T.getDuration().end-TAG.TourAuthoring.Constants.displayEpsilon),TAG.TourAuthoring.Constants.displayEpsilon):e.addDisplay(r,s);1.5>s&&s>=TAG.TourAuthoring.Constants.displayEpsilon&&(o.setIn(0),o.setOut(0),o.setMain(s)),w.getTracks().length>0&&w.getTracks()[0].leftAndRight({translation:{x:0}},!1)}}var e;if(l.disabled=!0,Ie&&Ie.length){for(_.clear(),o.text("Importing..."),o.show(),$(l).hide(),$(c).hide(),e=0;Ie.length>e;e++)t(e);A.combineLast(2*Ie.length),$(ge).css({"background-color":"transparent",color:"white"}),xe=!0,z(),$(I).fadeOut()}else z(),$(I).fadeOut();Ne.attr("placeholder",E),Ne.val(""),M=!1,w.getDataHolder().mapTracks(function(t,e){t.track.updatePos(e)})}),m.append(l);var c=document.createElement("button");$(c).text("Cancel"),$(c).css({position:"absolute",bottom:"2%",right:"5%"}),$(c).click(function(){return $(I).fadeOut(),z(),l.disabled=!0,Ne.attr("placeholder",E),Ne.val(""),void 0}),m.append(c)}function z(){$(".artHolder").detach(),$(".exhibHolder").detach(),$(".allArtworksHolder").detach(),$("#loadingLabel").detach(),_.clear()}function j(){var t=ye.getSVGText();He.text(Ue.val()),t.attr("text",Ue.val()),t.data("str",Ue.val())}function W(t){return function(){var e=Ue.val(),n=ze;if(e!==ze&&17!==t.which){var i=ye.getInkUndoManager(),r=TAG.TourAuthoring.Command({execute:function(){Ue.val(e),j()},unexecute:function(){Ue.val(n),j()}});i.logCommand(r),ze=Ue.val()}}}function q(){pn=ye.getSVGText(),dn.text(hn.val()),ye.remove_all(),ye.add_text_box(pn.attrs.x,pn.attrs.y,-1,-1,hn.val(),!0),pn=ye.getSVGText(),pn.data("str",hn.val())}function V(){switch(pn=ye.getSVGText(),dn.text(hn.val()),ye.remove_all(),fn=hn.val(),pn.attr("font-family")){case"'Courier New', Courier, monospace":Tn.prop("selected",!0),ye.setFontFamily("'Courier New', Courier, monospace"),mn.text("Courier");break;case"Verdana, Geneva, sans-serif":xn.prop("selected",!0),ye.setFontFamily("Verdana, Geneva, sans-serif"),mn.text("Verdana");break;case"Georgia, serif":bn.prop("selected",!0),ye.setFontFamily("Georgia, serif"),mn.text("Georgia");break;case"Times New Roman, serif":yn.prop("selected",!0),ye.setFontFamily("Times New Roman, serif"),mn.text("Times New Roman");break;default:}ye.add_text_box(pn.attrs.x,pn.attrs.y,-1,-1,hn.val(),!0),pn=ye.getSVGText(),pn.data("str",hn.val())}function Y(t){return function(){var e=hn.val(),n=fn;if(e!==fn&&17!==t.which){var i=ye.getInkUndoManager(),r=TAG.TourAuthoring.Command({execute:function(){hn.val(e),q()},unexecute:function(){hn.val(n),q()}});i.logCommand(r),fn=e}}}function X(t,e){t===Be||t===$n||t===ki||t===cn||t===ei||t===Bi?$.each(t,function(){this===e&&"block"===$(e).css("display")?($(".thicknessLabel").css({"font-weight":"normal"}),this.css("display","none")):this===e?this.css("display","block"):this.css("display","none")}):$.each(t,function(){this===e?this.css("display","block"):this.css("display","none")})}function K(t){$.each(t,function(){this.css("display","none")})}function Z(){je.text("Font: "),We.text("Times New Roman"),je.append(We),an.css("left","10%"),Ve.attr("selected","selected"),en.text("Text Size: "),nn.text("12px"),en.append(nn),K(Be)}function Q(){Pi.text("Opacity: "),$i.text("80%"),Pi.append($i),Gi.css("left",.8*(Ni.offset().left+Ni.width())/1.28+"px"),Ii.css({color:"black"}),Di.css({color:"gray"}),Mi="isolate",Si.text("Isolate"),K(ki)}function J(){Rn.text("Width: "),Hn.text("7px"),Rn.append(Hn),zn.css("left","0px"),Fn.css({color:"black"}),Bn.css({color:"gray"}),Ln="draw",On.text("Draw"),Yn.text("Opacity: "),Xn.text("100%"),Yn.append(Xn),Zn.css("left",.87*Kn.width()+"px"),K($n)}function te(t,e,n){var i=!1,r=!1;e&&0!==e&&(i=!0),n&&(r=!0);var o=$(document.createElement("div"));o.css("display","block"),o.css("margin-top","2%");var s=$(document.createElement("button"));s.css({color:"black",width:"35%","float":"left","margin-left":"8%","margin-top":"5%",clear:"left"}),s.get(0).innerHTML="Attach to Selected",s.on("click",function(){zn.attr("value",7),ye.updatePenWidth("brushSlider"),Wn.text("#000000"),h=new jscolor.color(Vn,{}),h.fromString("000000"),h.onImmediateChange=function(){ye.updatePenColor("brushColorToggle"),ye.set_mode(TAG.TourAuthoring.InkMode.draw),$(".changeColor1")[0].innerHTML="#"+$("#brushColorToggle").attr("value")};var e=!0;i=!1,e=i?ye.link_text():r?ye.link_trans():ye.link(),e&&(t.hide(),x.undoButton.off("click"),x.redoButton.off("click"),x.undoButton.on("click",function(){A.undo()}),x.redoButton.on("click",function(){A.redo()}),x.undoRedoInkOnly.css("display","none"),a&&(a.getInkUndoManager().clear(),A.greyOutBtn()),w.setModifyingInk(!1),w.setEditInkOn(!1))}),o.append(s);var l=$(document.createElement("button"));return l.css({color:"black",width:"35%","float":"left","margin-left":"8%","margin-top":"5%"}),l.get(0).innerHTML="Create as Unattached",l.on("click",function(){zn.attr("value",7),ye.updatePenWidth("brushSlider");var e=!0;e=i?ye.link_text_unattached():r?ye.link_trans_unattached():ye.linkUnattached(),e&&(t.hide(),x.undoButton.off("click"),x.redoButton.off("click"),x.undoButton.on("click",function(){A.undo()}),x.redoButton.on("click",function(){A.redo()}),x.undoRedoInkOnly.css("display","none"),a&&(a.getInkUndoManager().clear(),A.greyOutBtn()),w.setModifyingInk(!1),w.setEditInkOn(!1))}),o.append(l),o}function ee(){o.css({display:"none"}),s.css({display:"none"}),l.css({display:"none"}),d.css({display:"none"}),c.css("display","none"),u.css("display","none")}function ne(){$("#inkCanv").length&&$("#inkCanv").remove(),$("#rinplayer").css({})}function ie(){ne();var t=document.createElement("div");t.setAttribute("id","inkCanv"),t.setAttribute("class","inkCanv"),$("#rinplayer").css({position:"absolute"});var e=w.getTrackslength();return t.setAttribute("style","overflow:hidden; position:absolute; width:100%; height:100%; background:transparent; pointer-events: all; z-index:"+(20100+e)+";"),$("#rinContainer"),$("#rinplayer").before(t),t}var re=!1;b.on("keydown",n);var ae,oe=48,se=null;y.showEditDraw=i,y.getInkUndoManager=r,y.showEditTransparency=g;var le=null;y.showEditText=P,f.attr("id","component-controls"),f.css({"background-color":"rgb(219,218,199)",height:"48px",width:"20%",top:"15px",left:"0%",position:"relative","float":"left"});var ce=$(document.createElement("img"));ce.attr("id","addDropDownIconComponent"),ce.attr("src","images/icons/Down.png"),ce.css({width:"10%","margin-left":"35%",height:"10%"});var ue="13%",de=$(document.createElement("label"));de.text("Add Track"),de.attr("id","addComponentLabel"),de.css({left:ue,top:"5%",position:"relative","font-size":TAG.Util.getFontSize(200),color:"rgb(256, 256, 256)","background-color":"rgb(63, 55, 53)",padding:"3% 2% 4% 2%",width:"70%","float":"left"}),de.append(ce),f.append(de);var he=$(document.createElement("div"));he.css({width:"100%",height:"100%",position:"fixed",top:"0px",left:"0px","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex+18}),he.attr("class","fade"),f.append(he),he.hide(),he.on("mousedown",function(){he.hide(),Te=!1,ce.css({transform:"scaleY(1)","margin-bottom":"2%"}),ve.hide(),me.hide(),pe.hide()});var pe=$(document.createElement("div"));pe.css({left:ue,position:"relative",color:"rgb(256, 256, 256)",width:"74%","background-color":"rgba(0,0,0,0.95)","float":"left",clear:"left","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex+19}),f.append(pe),pe.hide(),O("Artwork",pe);var fe=O("Associated Media",pe);O("From File",pe);var ge=O("Annotate",pe),me=$(document.createElement("div"));me.css({left:"87%","margin-top":"-33%",position:"relative",color:"rgb(256, 256, 256)",width:"74%","background-color":"rgba(0,0,0,0.95)","float":"left","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex+19}),f.append(me),me.hide(),O("Audio (MP3)",me),O("Video (MP4)",me),O("Image",me);var ve=$(document.createElement("div"));ve.css({left:"87%","margin-top":"-16.5%",position:"relative",color:"rgb(256, 256, 256)",width:"74%","background-color":"rgba(0,0,0,0.95)","float":"left","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex+19}),f.append(ve),ve.hide(),O("Write",ve),O("Draw",ve),O("Highlight",ve);var ye,be=[],xe=!1,Te=!1;y.disableInk=L,de.on("mousedown",function(t){t.stopImmediatePropagation()}),de.click(function(t){if(w.getEditInkOn()!==!0){var e,n,i=w.getCloseMenu();if(i&&i!==F&&i(),t.stopImmediatePropagation(),Te=!Te,ve.hide(),me.hide(),Te){for(pe.show(),b.on("mousedown.componentMenu",F),w.setisMenuOpen(!0),w.setCloseMenu(F),T.stop(),ce.css({transform:"scaleY(-1)","margin-bottom":"2%"}),$(".thicknessLabel").css({"font-weight":"normal"}),e=0;be.length>e;e++)n=$(be[e]),n.css({"background-color":"transparent",color:"white"}),n.data("selected",!1);w.checkForArtworks(0)?(xe=!0,ge.css({"background-color":"transparent",color:"white"})):(xe=!1,ge.css({"background-color":"transparent",color:"gray"}))}else pe.hide(),b.off("mousedown.componentMenu"),w.setCloseMenu(null),w.setisMenuOpen(!1),ce.css({transform:"scaleY(1)","margin-bottom":"0%"})}});var we=!1,ke=!1,Ae=!0,_e=!0;v.addClass("associatedMediaPicker"),v.css({position:"absolute",width:"49%",height:"49%",padding:"1%","background-color":"black",border:"3px double white",top:"25%",left:"25%"}),$(D).append(v);var Ce=document.createElement("div");$(Ce).addClass("associatedMediaPickerInfo"),$(Ce).text("Select media to import"),$(Ce).css({"font-size":"200%"});var Ee=$(document.createElement("input"));Ee.attr("type","text"),$(Ee).css({"float":"right","margin-right":"3%","margin-top":"0.75%",width:"38%"}),$(Ee).on("keyup",function(t){t.stopPropagation()}),Ee.attr("placeholder",E),Ee.val(""),Ee.keyup(function(){TAG.Util.searchData(Ee.val(),".mediaHolder",S)}),Ee.change(function(){TAG.Util.searchData(Ee.val(),".mediaHolder",S)}),$(Ce).append(Ee),v.append(Ce);var Se=document.createElement("div");$(Se).addClass("associatedMediaPickerArtwork"),$(Se).css({position:"absolute","border-right":"1px solid white",top:"15%",padding:"1%",height:"72%",width:"28%",overflow:"auto"}),v.append(Se);var Me=document.createElement("div");$(Me).addClass("associatedMediaPickerMedia"),$(Me).css({position:"absolute",left:"33%",top:"15%",padding:"1%",height:"72%",width:"62%",overflow:"auto"}),v.append(Me);var Ie=[],De=[],Pe={};m.addClass("catalogPicker"),m.css({position:"absolute",width:"49%",height:"49%",padding:"1%","background-color":"black",border:"3px double white",top:"25%",left:"25%"}),$(I).append(m);var $e=document.createElement("div");$($e).addClass("catalogPickerInfo"),$($e).text("Select artwork to import"),$($e).css({"font-size":"200%","float":"left"}),m.append($e);var Ne=$(document.createElement("input"));Ne.attr("type","text"),$(Ne).css({"float":"right","margin-right":"3%","margin-top":"0.75%",width:"38%"}),$(Ne).on("keyup",function(t){t.stopPropagation()}),Ne.attr("placeholder",E),Ne.keyup(function(){TAG.Util.searchData(Ne.val(),".artButton",S)}),Ne.change(function(){TAG.Util.searchData(Ne.val(),".artButton",S)}),m.append(Ne);var Ge=document.createElement("div");$(Ge).addClass("catalogPickerExhibitions"),$(Ge).css({position:"absolute","border-right":"1px solid white",top:"13%",padding:"1%",height:"73%",width:"28%",overflow:"auto"}),m.append(Ge);var Oe=document.createElement("div");$(Oe).addClass("catalogPickerArtworks"),$(Oe).css({position:"absolute",left:"33%",top:"13%",padding:"1%",height:"73%",width:"62%",overflow:"auto"}),m.append(Oe);var Le=document.createDocumentFragment();s=$(document.createElement("div")),s.css({height:"425%",width:"100%",top:"130%",position:"absolute","z-index":0,"overflow-x":"none","overflow-y":"auto","margin-top":"8%"}),s.attr("id","inkTextControls"),Le.appendChild(s[0]),s.css({display:"none"});var Fe=$(document.createElement("button"));Fe.css({"font-size":"100%",color:"black","margin-left":"8%","margin-bottom":"10px","font-weight":"bold","float":"left",width:"80%"}),Fe.get(0).innerHTML="Cancel",Fe.click(function(){ne(),s.hide(),w.setModifyingInk(!1),w.setEditInkOn(!1),a.getInkUndoManager().clear(),A.greyOutBtn(),x.undoButton.off("click"),x.redoButton.off("click"),x.undoButton.on("click",function(){A.undo()}),x.redoButton.on("click",function(){A.redo()}),x.undoRedoInkOnly.css({display:"none"})}),s.append(Fe);var Be=[],Re=$(document.createElement("div"));Re.addClass("thicknessLabel");var He=$(document.createElement("div"));Re.text("Text:"),Re.append(He),s.append(Re),He.css({position:"relative",top:"2px",width:"65%",color:"green",display:"inline-block","margin-left":"2%","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap","margin-bottom":"0"}),Re.css({"font-size":"130%",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%",display:"inline-block","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var Ue=$(document.createElement("textarea"));Ue.css({width:"72%","min-width":"0px","margin-left":"8%","margin-top":"2%","overflow-x":"hidden",position:"relative"}),Be.push(Ue),Ue.autoSize(),s.append(Ue);var ze="";Ue.on("keyup",function(t){var e=t.keyCode;32===e&&t.stopPropagation();var n=$.debounce(500,!1,W(t));37===e||38===e||39===e||40===e||90===t.keyCode||t.ctrlKey||89===t.keyCode||n(),j()}),Re.click(function(){$(".thicknessLabel").css({"font-weight":"normal"}),Re.css({"font-weight":"bold"}),X(Be,Ue)});var je=$(document.createElement("div"));je.addClass("thicknessLabel");var We=$(document.createElement("div"));je.text("Font:"),We.text("Times New Roman"),je.append(We),s.append(je),We.css({color:"green",display:"inline","padding-left":"2%"}),je.css({"font-size":"130%",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var qe=$(document.createElement("select"));qe.addClass("fontSelector"),qe.css({color:"white","float":"left",clear:"both",display:"none",border:"solid 3px rgba(255,255,255,1)",width:"72%","margin-left":"8%","margin-top":"2%","background-color":"rgba(0,0,0,0.5)"}),Be.push(qe),s.append(qe);var Ve=$(document.createElement("option"));Ve.text("Times New Roman").css({color:"white","border-color":"rgba(0,0,0,0.5)",overflow:"hidden",background:"no-repeat scroll","background-color":"rgba(0,0,0,0.5)"}),Ve.on("click",function(){ye.setFontFamily("Times New Roman, serif"),We.text("Times New Roman")});var Ye=$(document.createElement("option"));Ye.text("Georgia").css({color:"white","border-color":"rgba(0,0,0,0.5)",overflow:"hidden",background:"no-repeat scroll","background-color":"rgba(0,0,0,0.5)"}),Ye.on("click",function(){ye.setFontFamily("Georgia, serif"),We.text("Georgia")});var Xe=$(document.createElement("option"));Xe.text("Verdana").css({color:"white","border-color":"rgba(0,0,0,0.5)",overflow:"hidden",background:"no-repeat scroll","background-color":"rgba(0,0,0,0.5)"}),Xe.on("click",function(){ye.setFontFamily("Verdana, Geneva, sans-serif"),We.text("Verdana")});var Ke=$(document.createElement("option"));Ke.text("Courier").css({color:"white","border-color":"rgba(0,0,0,0.5)",overflow:"hidden",background:"no-repeat scroll","background-color":"rgba(0,0,0,0.5)"}),Ke.on("click",function(){ye.setFontFamily("'Courier New', Courier, monospace"),We.text("Courier")}),qe.append(Ve),qe.append(Ye),qe.append(Xe),qe.append(Ke),je.click(function(){$(".thicknessLabel").css({"font-weight":"normal"}),je.css({"font-weight":"bold"}),X(Be,qe)});var Ze=$(document.createElement("div"));Ze.addClass("thicknessLabel");var Qe=$(document.createElement("div"));Qe.addClass("changeColor"),Ze.text("Color: "),Qe.text("#FFFFFF"),Ze.append(Qe),s.append(Ze),Ze.css({"font-size":"130%",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"}),Qe.css({color:"green",display:"inline","padding-left":"2%"});var Je=$(document.createElement("div"));Je.attr("id","colorTextDiv"),Je.css("display","none"),s.append(Je),Be.push(Je),Ze.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"}),Ze.css({"font-weight":"bold"}),X(Be,Je)});var tn=document.createElement("input");$(tn).attr("id","textColorToggle"),$(tn).attr("readonly","readonly"),$(tn).css({"margin-left":"8%","margin-top":"3%",clear:"left",width:"40%"}),$(tn).on("keyup",function(t){t.stopPropagation()}),tn.addEventListener&&tn.addEventListener("DOMNodeInserted",function(){h=new jscolor.color(tn,{}),h.fromString("FFFFFF"),h.onImmediateChange=function(){ye.setFontColor("#"+$("#textColorToggle").attr("value")),$(".changeColor")[0].innerHTML="#"+$("#textColorToggle").attr("value")}},!1),Je.append(tn);var en=$(document.createElement("div"));en.addClass("thicknessLabel");var nn=$(document.createElement("div"));en.text("Text Size: "),nn.text("12px"),en.append(nn),s.append(en),nn.css({color:"green",display:"inline","padding-left":"2%"}),en.css({"font-size":"130%",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var rn=$(document.createElement("div"));rn.css({clear:"both","background-color":"rgb(136, 134, 134)","border-radius":"25px","-ms-touch-action":"none",border:"1px solid gray",width:"70%",height:"21px","margin-top":"3%","margin-left":"8%",display:"none",position:"relative","float":"left"});var an=$(document.createElement("div"));an.css({"background-color":"white",height:"115%",width:"9.25%",position:"relative",border:"1px","border-style":"solid","border-color":"gray","border-radius":"50%",top:"-5%","margin-top":"-0.57%",left:"50px"}),rn.append(an),rn.attr("value","12px"),s.append(rn),an.draggable({axis:"x",containment:"parent",scroll:!1,drag:function(){an.value=1.28*(an.css("left").replace("px","")/(rn.offset().left+rn.width())),rn.attr("value",39*an.value+8+"px");var t=Math.round(39*an.value)+8;
nn.text(t+"px"),ye.setFontSize(rn.attr("value"))},appendTo:"body"}),Be.push(rn),en.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"}),en.css({"font-weight":"bold"}),X(Be,rn)});var on=te(s,"Write");s.append(on),f.append(Le);var sn=document.createDocumentFragment();u=$(document.createElement("div")),u.attr("id","inkEditText"),u.css({height:"425%",width:"100%",top:"130%",position:"absolute","z-index":0,"overflow-y":"auto","margin-top":"8%"}),sn.appendChild(u[0]),u.css({display:"none"});var ln=$(document.createElement("button"));ln.css({"font-size":"100%",color:"black","margin-left":"8%","margin-bottom":"10px","font-weight":"bold","float":"left",width:"80%"}),ln.get(0).innerHTML="Cancel",u.append(ln);var cn=[],un=$(document.createElement("div"));un.addClass("thicknessLabel");var dn=$(document.createElement("div"));un.text("Text:"),un.append(dn),u.append(un),dn.css({position:"relative",top:"2px",width:"65%",color:"green",display:"inline-block","margin-left":"2%","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap","margin-bottom":"0"}),un.css({"font-size":"130%",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%",display:"inline-block","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var hn=$(document.createElement("textarea"));hn.css({width:"72%","min-width":"0px","margin-left":"8%","margin-top":"2%","overflow-x":"hidden",position:"relative"}),cn.push(hn),hn.autoSize(),u.append(hn);var pn,fn;hn.on("keyup",function(t){var e=t.keyCode;32==e&&t.stopPropagation();var n=$.debounce(500,!1,Y(t));37===e||38===e||39===e||40===e||t.ctrlKey||n(),q()}),un.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"}),un.css({"font-weight":"bold"}),X(cn,hn)});var gn=$(document.createElement("div"));gn.addClass("thicknessLabel");var mn=$(document.createElement("div"));gn.text("Font:"),mn.text("Times New Roman"),gn.append(mn),u.append(gn),mn.css({color:"green",display:"inline","padding-left":"2%"}),gn.css({"font-size":"130%",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var vn=$(document.createElement("select"));vn.addClass("fontSelector"),vn.css({color:"white","float":"left",clear:"both",display:"none",border:"solid 3px rgba(255,255,255,1)",width:"72%","margin-left":"8%","margin-top":"2%","background-color":"rgba(0,0,0,0.5)"}),cn.push(vn),u.append(vn);var yn=$(document.createElement("option"));yn.text("Times New Roman").css({color:"white","border-color":"rgba(0,0,0,0.5)",overflow:"hidden",background:"no-repeat scroll","background-color":"rgba(0,0,0,0.5)"}),yn.click(function(){ye.setFontFamily("Times New Roman, serif"),mn.text("Times New Roman")});var bn=$(document.createElement("option"));bn.text("Georgia").css({color:"white","border-color":"rgba(0,0,0,0.5)",overflow:"hidden",background:"no-repeat scroll","background-color":"rgba(0,0,0,0.5)"}),bn.click(function(){ye.setFontFamily("Georgia, serif"),mn.text("Georgia")});var xn=$(document.createElement("option"));xn.text("Verdana").css({color:"white","border-color":"rgba(0,0,0,0.5)",overflow:"hidden",background:"no-repeat scroll","background-color":"rgba(0,0,0,0.5)"}),xn.click(function(){ye.setFontFamily("Verdana, Geneva, sans-serif"),mn.text("Verdana")});var Tn=$(document.createElement("option"));Tn.text("Courier").css({color:"white","border-color":"rgba(0,0,0,0.5)",overflow:"hidden",background:"no-repeat scroll","background-color":"rgba(0,0,0,0.5)"}),Tn.click(function(){ye.setFontFamily("'Courier New', Courier, monospace"),mn.text("Courier")}),vn.append(yn),vn.append(bn),vn.append(xn),vn.append(Tn),gn.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"}),gn.css({"font-weight":"bold"}),X(cn,vn)});var wn=$(document.createElement("div"));wn.addClass("thicknessLabel");var kn=$(document.createElement("div"));kn.addClass("changeColorEdit"),wn.text("Color: "),kn.text("#FFFFFF"),wn.append(kn),u.append(wn),wn.css({"font-size":"130%",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"}),kn.css({color:"green",display:"inline","padding-left":"2%"});var An=$(document.createElement("div"));An.css("display","none"),u.append(An),cn.push(An),wn.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"}),wn.css({"font-weight":"bold"}),X(cn,An)});var _n=document.createElement("input");$(_n).attr("id","textEditColorToggle"),$(_n).attr("readonly","readonly"),$(_n).css({"margin-left":"8%","margin-top":"3%",clear:"left",width:"40%"}),$(_n).on("keyup",function(t){t.stopPropagation()}),_n.addEventListener&&_n.addEventListener("DOMNodeInserted",function(){le=new jscolor.color(_n,{}),le.fromString("FFFFFF"),le.onImmediateChange=function(){ye.setFontColor("#"+$("#textEditColorToggle").attr("value")),$(".changeColorEdit")[0].innerHTML="#"+$("#textEditColorToggle").attr("value")}},!1),An.append(_n);var Cn=$(document.createElement("div"));Cn.addClass("thicknessLabel");var En=$(document.createElement("div"));Cn.text("Text Size: "),En.text("8px"),Cn.append(En),u.append(Cn),En.css({color:"green",display:"inline","padding-left":"2%"}),Cn.css({"font-size":"130%",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var Sn=$(document.createElement("div"));Sn.css({clear:"both","background-color":"rgb(136, 134, 134)","border-radius":"25px","-ms-touch-action":"none",border:"1px solid gray",width:"70%",height:"21px","margin-top":"3%","margin-left":"8%",display:"none",position:"relative"}),u.append(Sn);var Mn=$(document.createElement("div"));Mn.css({"background-color":"white",height:"115%",width:"9.25%",position:"relative",border:"1px","border-style":"solid","border-color":"gray","border-radius":"50%",top:"-5%","margin-top":"-0.57%"}),Sn.append(Mn),Sn.attr("value","8px"),Mn.draggable({axis:"x",containment:"parent",scroll:!1,drag:function(t,e){Mn.value=e.position.left/(Sn.width()-Mn.width()),Sn.attr("value",Mn.value*(oe-8)+8+"px");var n=Math.round(Mn.value*(oe-8))+8;ae=n,En.text(n+"px"),ye.setFontSize(Sn.attr("value"))},appendTo:"body"}),cn.push(Sn),Cn.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"}),Cn.css({"font-weight":"bold"}),X(cn,Sn);var t=(ae-8)/(oe-8),e=t*(Sn.width()-Mn.width());Mn.css("left",e+"px")});var In=$(document.createElement("button"));In.css({"font-size":"100%",color:"black","margin-top":"3%","margin-left":"8%","margin-bottom":"10px","font-weight":"bold","float":"left",width:"80%"}),In.get(0).innerHTML="Save",u.append(In),f.append(sn);var Dn=document.createDocumentFragment();l=$(document.createElement("div")),l.attr("id","inkDrawControls"),l.css({height:"425%",width:"100%",top:"130%",position:"absolute","z-index":0,"overflow-y":"auto","margin-top":"8%"}),Dn.appendChild(l[0]),l.css({display:"none"});var Pn=$(document.createElement("button"));Pn.css({"font-size":"100%",color:"black","margin-left":"8%","margin-bottom":"10px","font-weight":"bold","float":"left",width:"80%"}),Pn.get(0).innerHTML="Cancel",Pn.click(function(){zn.attr("value",7),ye.updatePenWidth("brushSlider"),ne(),l.hide(),w.setModifyingInk(!1),w.setEditInkOn(!1),a.getInkUndoManager().clear(),A.greyOutBtn(),x.undoButton.off("click"),x.redoButton.off("click"),x.undoButton.on("click",function(){A.undo()}),x.redoButton.on("click",function(){A.redo()}),x.undoRedoInkOnly.css({display:"none"})}),l.append(Pn);var $n=[],Nn=$(document.createElement("div"));Nn.css({height:"10%",width:"80%",clear:"both","margin-left":"8%","margin-top":"3%",display:"none"});var Gn=$(document.createElement("div"));Gn.addClass("thicknessLabel");var On=$(document.createElement("div"));Gn.text("Mode: "),On.text("Draw"),Gn.append(On),On.css({color:"green",display:"inline","padding-left":"2%"}),Gn.css({"font-size":"130%",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"}),l.append(Gn),l.append(Nn),$n.push(Nn),Gn.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"}),Gn.css({"font-weight":"bold"}),X($n,Nn)});var Ln="draw",Fn=$(document.createElement("label"));Fn.css({"font-size":"120%",color:"black","margin-left":"8%","font-weight":"bold","float":"left"}),Fn.text("Draw"),Nn.append(Fn),Fn.on("click",function(){"erase"===Ln&&(Fn.css({color:"black"}),Bn.css({color:"gray"}),Ln="draw",On.text("Draw"),ye.set_mode(1))});var Bn=$(document.createElement("label"));Bn.css({"font-size":"120%",color:"gray","margin-right":"9%","font-weight":"bold","float":"right"}),Bn.text("Erase"),Nn.append(Bn),Bn.on("click",function(){"draw"===Ln&&(Fn.css({color:"gray"}),Bn.css({color:"black"}),Ln="erase",On.text("Erase"),ye.set_mode(2))});var Rn=$(document.createElement("div"));Rn.addClass("thicknessLabel");var Hn=$(document.createElement("div"));Rn.text("Width: "),Hn.text("7px"),Rn.append(Hn),l.append(Rn),Hn.css({color:"green",display:"inline","padding-left":"2%"}),Rn.css({"font-size":"130%",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var Un=$(document.createElement("div"));Un.css({clear:"both","background-color":"rgb(136, 134, 134)","border-radius":"25px","-ms-touch-action":"none",border:"1px solid gray",width:"70%",height:"21px","margin-top":"3%","margin-left":"8%",display:"none",position:"relative"}),l.append(Un),$n.push(Un);var zn=$(document.createElement("div"));zn.attr("id","brushSlider"),zn.css({"background-color":"white",height:"115%",width:"9.25%",position:"relative",border:"1px","border-style":"solid","border-color":"gray","border-radius":"50%",top:"-5%"}),zn.attr("value",7),Un.append(zn),Rn.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"}),Rn.css({"font-weight":"bold"}),X($n,Un)}),zn.draggable({axis:"x",containment:"parent",scroll:!1,drag:function(){zn.attr("value",60*(zn.css("left").replace("px","")/(Un.offset().left+Un.width()))+1+6),7>zn.value&&zn.attr("value",7),ye.updatePenWidth("brushSlider"),ye.setEraserWidth(zn.attr("value")),Hn.text(Math.round(zn.attr("value"))+"px")},appendTo:"body"});var jn=$(document.createElement("div"));jn.addClass("thicknessLabel");var Wn=$(document.createElement("div"));Wn.addClass("changeColor1"),jn.text("Color: "),Wn.text("#000000"),jn.append(Wn),l.append(jn),jn.css({"font-size":"130%",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"}),Wn.css({color:"green",display:"inline","padding-left":"2%"});var qn=$(document.createElement("div"));qn.css("display","none"),l.append(qn),$n.push(qn),jn.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"}),jn.css({"font-weight":"bold"}),X($n,qn),ye.set_mode(TAG.TourAuthoring.InkMode.draw),Fn.css({color:"black"}),Bn.css({color:"gray"}),Ln="draw",On.text("Draw")});var Vn=document.createElement("input");$(Vn).attr("id","brushColorToggle"),$(Vn).attr("readonly","readonly"),$(Vn).css({"margin-left":"8%","float":"left","margin-top":"3%",clear:"left",width:"40%"}),Vn.onfocus=function(){ye.set_mode(TAG.TourAuthoring.InkMode.draw)},$(Vn).on("keyup",function(t){t.stopPropagation()}),Vn.addEventListener&&Vn.addEventListener("DOMNodeInserted",function(){h=new jscolor.color(Vn,{}),h.fromString("000000"),h.onImmediateChange=function(){ye.updatePenColor("brushColorToggle"),ye.set_mode(TAG.TourAuthoring.InkMode.draw),$(".changeColor1")[0].innerHTML="#"+$("#brushColorToggle").attr("value")}},!1),qn.append(Vn);var Yn=$(document.createElement("div"));Yn.addClass("thicknessLabel");var Xn=$(document.createElement("div"));Yn.text("Opacity: "),Xn.text("100%"),Yn.append(Xn),l.append(Yn),Xn.css({color:"green",display:"inline","padding-left":"2%"}),Yn.css({"font-size":"130%",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var Kn=$(document.createElement("div"));Kn.css({clear:"both","background-color":"rgb(136, 134, 134)","border-radius":"25px","-ms-touch-action":"none",border:"1px solid gray",width:"70%",height:"21px","margin-top":"3%","margin-left":"8%",display:"none",position:"relative"}),l.append(Kn),$n.push(Kn);var Zn=$(document.createElement("div"));Zn.attr("id","opacitySlider"),Zn.css({"background-color":"white",height:"115%",width:"9.25%",position:"relative",border:"1px","border-style":"solid","border-color":"gray","border-radius":"50%",top:"-5%","margin-top":"-0.57%"}),Zn.attr("value",1),Kn.append(Zn),Yn.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"}),Yn.css({"font-weight":"bold"}),X($n,Kn),ye.set_mode(TAG.TourAuthoring.InkMode.draw),Fn.css({color:"black"}),Bn.css({color:"gray"}),Ln="draw",On.text("Draw")}),Zn.draggable({axis:"x",containment:"parent",scroll:!1,drag:function(){Zn.attr("value",1.28*(parseFloat(Zn.css("left").replace("px",""))/(parseFloat(Kn.offset().left)+parseFloat(Kn.width())))),Zn[0].value>.99?Zn.attr("value",1):0>Zn[0].value&&Zn.attr("value",0),ye.updatePenOpacity("opacitySlider"),Xn.text(Math.round(100*Zn.attr("value"))+"%")},appendTo:"body"});var Qn=te(l);l.append(Qn),f.append(Dn);var Jn=document.createDocumentFragment();d=$(document.createElement("div")),d.attr("id","inkEditDraw"),d.css({height:"425%",width:"100%",top:"130%",position:"absolute","z-index":0,"overflow-y":"auto","margin-top":"8%"}),Jn.appendChild(d[0]),d.css("display","none");var ti=$(document.createElement("button"));ti.css({"font-size":"100%",color:"black","margin-left":"8%","margin-bottom":"10px","font-weight":"bold","float":"left",width:"80%"}),ti.get(0).innerHTML="Cancel",d.append(ti);var ei=[],ni=$(document.createElement("div"));ni.css({height:"10%",width:"80%",clear:"both","margin-left":"8%","margin-top":"3%",display:"none"});var ii=$(document.createElement("div"));ii.addClass("thicknessLabel");var ri=$(document.createElement("div"));ii.text("Mode: "),ri.text("Draw"),ii.append(ri),ri.css({color:"green",display:"inline","padding-left":"2%"}),ii.css({"font-size":"130%",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"}),d.append(ii),d.append(ni),ei.push(ni),ii.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"}),ii.css({"font-weight":"bold"}),X(ei,ni)});var ai="draw",oi=$(document.createElement("label"));oi.css({"font-size":"120%",color:"black","margin-left":"8%","font-weight":"bold","float":"left"}),oi.text("Draw"),ni.append(oi),oi.on("click",function(){"erase"===ai&&(oi.css({color:"black"}),si.css({color:"gray"}),ai="draw",ri.text("Draw"),ye.set_mode(1))});var si=$(document.createElement("label"));si.css({"font-size":"120%",color:"gray","margin-right":"9%","font-weight":"bold","float":"right"}),si.text("Erase"),ni.append(si),si.on("click",function(){"draw"===ai&&(oi.css({color:"gray"}),si.css({color:"black"}),ai="erase",ri.text("Erase"),ye.set_mode(2))});var li=$(document.createElement("div"));li.addClass("thicknessLabel");var ci=$(document.createElement("div"));li.text("Width: "),ci.text("7px"),li.append(ci),d.append(li),ci.css({color:"green",display:"inline","padding-left":"2%"}),li.css({"-ms-touch-action":"none","font-size":"130%",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var ui=$(document.createElement("div"));ui.addClass("brushEditSlider"),ui.css({clear:"both","background-color":"rgb(136, 134, 134)","border-radius":"25px","-ms-touch-action":"none",border:"1px solid gray",width:"70%",height:"21px","margin-top":"3%","margin-left":"8%",display:"none",position:"relative","float":"left"}),d.append(ui),ei.push(ui);var di=$(document.createElement("div"));di.attr("id","brushEditSlider"),di.css({"background-color":"white",height:"115%",width:"9.25%",position:"relative",border:"1px","border-style":"solid","border-color":"gray","border-radius":"50%",top:"-5%"}),di.attr("value",7),ui.append(di),li.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"}),li.css({"font-weight":"bold"}),X(ei,ui)}),di.draggable({axis:"x",containment:"parent",scroll:!1,drag:function(){di.attr("value",60*(di.css("left").replace("px","")/(ui.offset().left+ui.width()))+1+6),7>di.value&&di.attr("value",7),ye.updatePenWidth("brushEditSlider"),ci.text(Math.round(di.attr("value"))+"px")},appendTo:"body"});var hi=$(document.createElement("div"));hi.addClass("thicknessLabel");var pi=$(document.createElement("div"));pi.addClass("changeColor1Edit"),hi.text("Color: "),pi.text("#000000"),hi.append(pi),d.append(hi),hi.css({"font-size":"130%",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"}),pi.css({color:"green",display:"inline","padding-left":"2%"});var fi=$(document.createElement("div"));fi.css("display","none"),d.append(fi),ei.push(fi),hi.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"}),hi.css({"font-weight":"bold"}),X(ei,fi),ye.set_mode(TAG.TourAuthoring.InkMode.draw),oi.css({color:"black"}),si.css({color:"gray"}),ai="draw",ri.text("Draw")});var gi=document.createElement("input");$(gi).attr("id","brushEditColorToggle"),$(gi).attr("readonly","readonly"),$(gi).css({"margin-left":"8%","float":"left","margin-top":"3%",clear:"left",width:"40%"}),gi.onfocus=function(){ye.set_mode(TAG.TourAuthoring.InkMode.draw),oi.css({color:"black"}),si.css({color:"gray"}),ai="draw",ri.text("Draw")},$(gi).on("keyup",function(t){t.stopPropagation()}),gi.addEventListener&&gi.addEventListener("DOMNodeInserted",function(){se=new jscolor.color(gi,{}),se.fromString("000000"),se.onImmediateChange=function(){ye.updatePenColor("brushEditColorToggle"),ye.set_mode(TAG.TourAuthoring.InkMode.draw),oi.css({color:"black"}),si.css({color:"gray"}),ai="draw",ri.text("Draw"),$(".changeColor1Edit")[0].innerHTML=ye.getPenColor()}},!1),fi.append(gi);var mi=$(document.createElement("div"));mi.addClass("thicknessLabel");var vi=$(document.createElement("div"));mi.text("opacity: "),vi.text("100%"),mi.append(vi),d.append(mi),vi.css({color:"green",display:"inline","padding-left":"2%"}),mi.css({"font-size":"130%",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var yi=$(document.createElement("div"));yi.css({clear:"both","background-color":"rgb(136, 134, 134)","border-radius":"25px","-ms-touch-action":"none",border:"1px solid gray",width:"70%",height:"21px","margin-top":"3%","margin-left":"8%",display:"none",position:"relative"}),d.append(yi),ei.push(yi);var bi=$(document.createElement("div"));bi.attr("id","opacityEditSlider"),bi.css({"background-color":"white",height:"115%",width:"9.25%",position:"relative",border:"1px","border-style":"solid","border-color":"gray","border-radius":"50%",top:"-5%",left:"87%","margin-top":"-0.57%"}),bi.attr("value",1),yi.append(bi),mi.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"}),mi.css({"font-weight":"bold"}),X(ei,yi),ye.set_mode(1),oi.css({color:"black"}),si.css({color:"gray"}),ai="draw",ri.text("Draw")}),bi.draggable({axis:"x",containment:"parent",scroll:!1,drag:function(){bi.attr("value",1.28*(parseFloat(bi.css("left").replace("px",""))/(parseFloat(yi.offset().left)+parseFloat(yi.width())))),bi[0].value>.99?bi.attr("value",1):0>bi[0].value&&bi.attr("value",0),ye.updatePenOpacity("opacityEditSlider"),vi.text(Math.round(100*bi.attr("value"))+"%")},appendTo:"body"});var xi=$(document.createElement("button"));xi.css({"font-size":"100%",color:"black","margin-top":"3%","margin-left":"8%","margin-bottom":"10px","font-weight":"bold","float":"left",width:"80%"}),xi.get(0).innerHTML="Save",d.append(xi),f.append(Jn);var Ti=document.createDocumentFragment();o=$(document.createElement("div")),o.attr("id","inkTransControls"),o.css({height:"425%",width:"100%",top:"130%",position:"absolute","z-index":0,"overflow-y":"auto","margin-top":"8%"}),Ti.appendChild(o[0]),o.css({display:"none"});var wi=$(document.createElement("button"));wi.css({"font-size":"100%",color:"black","margin-left":"8%","margin-bottom":"10px","font-weight":"bold","float":"left",width:"80%"}),wi.get(0).innerHTML="Cancel",wi.on("click",function(){ne(),o.hide(),w.setModifyingInk(!1),w.setEditInkOn(!1),a.getInkUndoManager().clear(),A.greyOutBtn(),x.undoButton.off("click"),x.redoButton.off("click"),x.undoButton.on("click",function(){A.undo()}),x.redoButton.on("click",function(){A.redo()}),x.undoRedoInkOnly.css({display:"none"})}),o.append(wi);var ki=[],Ai=$(document.createElement("button"));Ai.css({color:"black",width:"35%","float":"left","margin-left":"8%","margin-top":"3%",clear:"left"}),Ai.get(0).innerHTML="Add Ellipse",Ai.on("click",function(){ye.add_ellipse()}),o.append(Ai);var _i=$(document.createElement("button"));_i.css({color:"black",width:"35%","float":"left","margin-left":"8%","margin-top":"3%"}),_i.get(0).innerHTML="Add Rectangle",_i.on("click",function(){ye.add_rectangle()}),o.append(_i);var Ci=$(document.createElement("div"));Ci.css({height:"10%",width:"80%",clear:"both","margin-left":"8%","margin-top":"3%",display:"none"});var Ei=$(document.createElement("div"));Ei.addClass("thicknessLabel");var Si=$(document.createElement("div"));Ei.text("Mode: "),Si.text("Isolate"),Ei.append(Si),Si.css({color:"green",display:"inline","padding-left":"2%"}),Ei.css({"font-size":"130%",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"}),o.append(Ei),o.append(Ci),ki.push(Ci),Ei.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"}),Ei.css({"font-weight":"bold"}),X(ki,Ci)});var Mi="isolate",Ii=$(document.createElement("label"));Ii.css({"font-size":"120%",color:"black","margin-left":"8%","font-weight":"bold","float":"left"}),Ii.text("Isolate"),Ci.append(Ii),Ii.on("click",function(){"block"===Mi&&(Ii.css({color:"black"}),Di.css({color:"gray"}),Mi="isolate",Si.text("Isolate"),ye.setTransMode("isolate"))});var Di=$(document.createElement("label"));Di.css({"font-size":"120%",color:"gray","margin-right":"9%","font-weight":"bold","float":"right"}),Di.text("Block"),Ci.append(Di),Di.on("click",function(){"isolate"===Mi&&(Ii.css({color:"gray"}),Di.css({color:"black"}),Mi="block",Si.text("Block"),ye.setTransMode("block"))});var Pi=$(document.createElement("div"));Pi.addClass("thicknessLabel");var $i=$(document.createElement("div"));Pi.text("Opacity: "),$i.text("80%"),Pi.append($i),o.append(Pi),$i.css({color:"green",display:"inline","padding-left":"2%"}),Pi.css({"font-size":"130%",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var Ni=$(document.createElement("div"));Ni.css({clear:"both","background-color":"rgb(136, 134, 134)","border-radius":"25px","-ms-touch-action":"none",border:"1px solid gray",width:"70%",height:"21px","margin-top":"3%","margin-left":"8%",display:"none",position:"relative"});var Gi=$(document.createElement("div"));Gi.attr("id","opacityTransparencySliderPoint"),Gi.css({"background-color":"white",height:"115%",width:"9.25%",position:"relative",border:"1px","border-style":"solid","border-color":"gray","border-radius":"50%",top:"-5%","margin-top":"-0.57%"}),Ni.append(Gi),o.append(Ni),Pi.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"}),Pi.css({"font-weight":"bold"}),X(ki,Ni)}),Gi.draggable({axis:"x",containment:"parent",scroll:!1,drag:function(){Gi.attr("value",1.28*(parseFloat(Gi.css("left").replace("px",""))/(parseFloat(Ni.offset().left)+parseFloat(Ni.width())))),Gi[0].value>.99?Gi.attr("value",1):0>Gi[0].value&&Gi.attr("value",0),ye.setMarqueeFillOpacity(parseFloat(Gi.attr("value"))),$i.text(Math.round(100*Gi.attr("value"))+"%")},appendTo:"body"}),ki.push(Ni);var Oi=te(o,0,"trans");o.append(Oi),f.append(Ti);var Li=document.createDocumentFragment();c=$(document.createElement("div")),c.attr("id","inkEditTransparency"),c.css({height:"425%",width:"100%",top:"130%",position:"absolute","z-index":0,"overflow-y":"auto","margin-top":"8%"}),Li.appendChild(c[0]),c.css({display:"none"});var Fi=$(document.createElement("button"));Fi.css({"font-size":"100%",color:"black","margin-left":"8%","margin-bottom":"10px","font-weight":"bold","float":"left",width:"80%"}),Fi.get(0).innerHTML="Cancel",c.append(Fi);var Bi=[],Ri=$(document.createElement("button"));Ri.css({color:"black",width:"35%","float":"left","margin-left":"8%","margin-top":"3%",clear:"left"}),Ri.get(0).innerHTML="Add Ellipse",Ri.on("click",function(){ye.add_ellipse()}),c.append(Ri);var Hi=$(document.createElement("button"));Hi.css({color:"black",width:"35%","float":"left","margin-left":"8%","margin-top":"3%"}),Hi.get(0).innerHTML="Add Rectangle",Hi.on("click",function(){ye.add_rectangle()}),c.append(Hi);var Ui=$(document.createElement("div"));Ui.css({height:"10%",width:"80%",clear:"both","margin-left":"8%","margin-top":"3%",display:"none"});var zi=$(document.createElement("div"));zi.addClass("thicknessLabel");var ji=$(document.createElement("div"));zi.text("Mode: "),ji.text("Isolate"),Ei.attr("id","transModeLabel"),zi.append(ji),ji.css({color:"green",display:"inline","padding-left":"2%"}),zi.css({"font-size":"130%",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"}),c.append(zi),c.append(Ui),Bi.push(Ui),zi.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"}),zi.css({"font-weight":"bold"}),X(Bi,Ui)});var Wi="isolate",qi=$(document.createElement("label"));qi.css({"font-size":"120%",color:"black","margin-left":"8%","font-weight":"bold","float":"left"}),qi.text("Isolate"),Ui.append(qi),qi.on("click",function(){"block"===Wi&&(qi.css({color:"black"}),Vi.css({color:"gray"}),Wi="isolate",ji.text("Isolate"),ye.setTransMode("isolate"))});var Vi=$(document.createElement("label"));Vi.css({"font-size":"120%",color:"gray","margin-right":"9%","font-weight":"bold","float":"right"}),Vi.text("Block"),Ui.append(Vi),Vi.on("click",function(){"isolate"===Wi&&(qi.css({color:"gray"}),Vi.css({color:"black"}),Wi="block",ji.text("Block"),ye.setTransMode("block"))});var Yi=$(document.createElement("div"));Yi.addClass("thicknessLabel");var Xi=$(document.createElement("div"));Yi.text("Opacity: "),Xi.text("80%"),Yi.append(Xi),c.append(Yi),Xi.css({color:"green",display:"inline","padding-left":"2%"}),Yi.css({"font-size":"130%",color:"black","margin-left":"8%","font-weight":"normal","margin-top":"3%","margin-right":"12%","margin-bottom":"1%","float":"left",clear:"both",display:"inline","border-bottom-width":" 2px","border-bottom-style":"solid","border-bottom-color":"white",width:"80%"});var Ki=$(document.createElement("div"));Ki.attr("id","opacityEditTransparencySlider"),Ki.css({clear:"both","background-color":"rgb(136, 134, 134)","border-radius":"25px","-ms-touch-action":"none",border:"1px solid gray",width:"70%",height:"21px","margin-top":"3%","margin-left":"8%",display:"none",position:"relative"});var Zi=$(document.createElement("div"));Zi.attr("id","opacityEditTransparencySliderPoint"),Zi.css({"background-color":"white",height:"115%",width:"9.25%",position:"relative",border:"1px","border-style":"solid","border-color":"gray","border-radius":"50%",top:"-5%","margin-top":"-0.57%"}),Ki.append(Zi),c.append(Ki),Yi.on("click",function(){$(".thicknessLabel").css({"font-weight":"normal"}),Yi.css({"font-weight":"bold"}),X(Bi,Ki)}),Zi.draggable({axis:"x",containment:"parent",scroll:!1,drag:function(){Zi.attr("value",1.28*(parseFloat(Zi.css("left").replace("px",""))/(parseFloat(Ki.offset().left)+parseFloat(Ki.width())))),Zi[0].value>.99?Zi.attr("value",1):0>Zi[0].value&&Zi.attr("value",0),ye.setMarqueeFillOpacity(parseFloat(Zi.attr("value"))),Xi.text(Math.round(100*Zi.attr("value"))+"%")},appendTo:"body"}),Bi.push(Ki);var Qi=$(document.createElement("button"));Qi.css({"font-size":"100%",color:"black","margin-top":"3%","margin-left":"8%","margin-bottom":"10px","font-weight":"bold","float":"left",width:"80%"}),Qi.get(0).innerHTML="Save",c.append(Qi),f.append(Li),y.hideInkControls=ee,y.removeInkCanv=ne}(),y.addToDOM=n,y.addCatalogToDOM=i,y.getIsUploading=r,y},TAG.Util.makeNamespace("TAG.TourAuthoring.Display"),TAG.Util.makeNamespace("TAG.TourAuthoring.DisplayParts"),TAG.TourAuthoring.DisplayParts={main:1,"fade-in":2,"fade-out":3},TAG.TourAuthoring.Display=function(t,e){"use strict";function n(t){He=t}function i(){return Je}function r(t){Je.push(t)}function a(t){Je.splice(Je.indexOf(t),1)}function o(){var t=TAG.Util.UI.createDisplay({x:hn(ze),fadeIn:hn(Ve),fadeOut:hn(Ye),mainLength:hn(Xe),mainColor:We?e.type===TAG.TourAuthoring.TrackType.audio?"rgba(129, 173, 98, 0.8)":TAG.TourAuthoring.Constants.displayColor:TAG.TourAuthoring.Constants.inkDisplayColor,fadeColor:null,height:null,container:e.track});an=t.mainRect,nn=t.inRect,on=t.outRect,rn=t.inHandle,sn=t.outHandle,nn.on("mousedown",function(t){var e=t.offsetX;l(e,TAG.TourAuthoring.DisplayParts["fade-in"])}),an.on("mousedown",function(t){var e=t.offsetX;l(e,TAG.TourAuthoring.DisplayParts.main)}),on.on("mousedown",function(t){var e=t.offsetX;l(e,TAG.TourAuthoring.DisplayParts["fade-out"])}),rn.on("mousedown",function(t){var e=t.offsetX;l(e,TAG.TourAuthoring.DisplayParts["fade-in"])}),sn.on("mousedown",function(t){var e=t.offsetX;l(e,TAG.TourAuthoring.DisplayParts["fade-out"])})}function s(){nn.off("mousedown"),on.off("mousedown"),an.off("mousedown"),rn.off("mousedown"),sn.off("mousedown"),nn.on("mousedown",function(t){var e=t.offsetX;l(e,TAG.TourAuthoring.DisplayParts["fade-in"])}),an.on("mousedown",function(t){var e=t.offsetX;l(e,TAG.TourAuthoring.DisplayParts.main)}),on.on("mousedown",function(t){var e=t.offsetX;l(e,TAG.TourAuthoring.DisplayParts["fade-out"])}),rn.on("mousedown",function(t){var e=t.offsetX;l(e,TAG.TourAuthoring.DisplayParts["fade-in"])}),sn.on("mousedown",function(t){var e=t.offsetX;l(e,TAG.TourAuthoring.DisplayParts["fade-out"])})}function l(t,n){var i=ze,r=Ke,a=Xe,o=Ze;
if(de(),e.timeManager.stop(),cn=t,ln=n,ln!==TAG.TourAuthoring.DisplayParts["fade-in"]&&ln!==TAG.TourAuthoring.DisplayParts["fade-out"]||!e.that.getMinimizedState()){e.that.getMinimizedState()&&(rn.hide(),sn.hide()),e.currentDisplay=Ue,e.timeline.newDataArray();for(var s=0;e.timeline.getMultiSelectionArray().length>s;s++)e.timeline.getMultiSelectionArray()[s].setLoc(ln);$("body").on("mouseup.display",function(){function t(t,n,i){var r={execute:function(){t.setTimes(i)},unexecute:function(){t.setTimes(n)}};e.undoManager.logCommand(r)}e.that.getMinimizedState()&&(rn.hide(),sn.hide());var n,s,l,c,u=Qe.findPreviousDisplay(e.that.getPos(),Ue),d=Qe.findNextDisplay(e.that.getPos(),Ue);s=0,l=0;var h=cn,p=ln;if(e.currentDisplay=null,cn=null,ln=null,$("body").off("mouseup.display"),0!==e.timeline.getMultiSelectionArray().length){var f=e.timeline.getMultiSelectionArray();c=[],f.map(function(t){c.push(t)})}if(i!==ze||r!==Ke||a!==Xe||o!==Ze){switch(e.timeline.updateOldData(),e.update(),p){case TAG.TourAuthoring.DisplayParts["fade-in"]:s=ze,l=i;break;case TAG.TourAuthoring.DisplayParts["fade-out"]:s=Ze,l=o;break;case TAG.TourAuthoring.DisplayParts.main:s=Ke,l=r}var g=0,m=1/0;u&&(g=u.display.getEnd()),d&&(m=d.display.getStart());var v=e.timeline.getOldData(),y=e.timeline.getDisplayData();n={execute:function(){var t={pivot:{x:e.timeManager.timeToPx(s)+h}};if(e.currentDisplay=Ue,ln=p,cn=h,v&&c)for(var n=0;c.length>n;n++){var i,r=c[n];switch(p){case TAG.TourAuthoring.DisplayParts["fade-in"]:i=v[n][0];break;case TAG.TourAuthoring.DisplayParts["fade-out"]:i=v[n][2];break;case TAG.TourAuthoring.DisplayParts.main:i=v[n][1]}var a={pivot:{x:e.timeManager.timeToPx(i)+h}};r.setLoc(p),r.setcurrentDisplay(r),r.setOffset(cn),g+r.getStart()-Ue.getStart(),m+r.getEnd()-Ue.getEnd(),r.move(a,v[n][3],v[n][4],-1,-1,!0),r.setcurrentDisplay(null)}else oe(t,g,m,-1,-1,!0);e.currentDisplay=null,ln=null,cn=null,e.update()},unexecute:function(){var t={pivot:{x:e.timeManager.timeToPx(l)+h}};if(e.currentDisplay=Ue,ln=p,cn=h,y&&c)for(var n=0;c.length>n;n++){var i,r=c[n];switch(p){case TAG.TourAuthoring.DisplayParts["fade-in"]:i=y[n][0];break;case TAG.TourAuthoring.DisplayParts["fade-out"]:i=y[n][2];break;case TAG.TourAuthoring.DisplayParts.main:i=y[n][1]}var a={pivot:{x:e.timeManager.timeToPx(i)+h}};r.setLoc(p),r.setcurrentDisplay(r),r.setOffset(cn),r.move(a,y[n][3],y[n][4],-1,-1,!0),r.setcurrentDisplay(null)}else oe(t,g,m,-1,-1,!0);e.currentDisplay=null,ln=null,cn=null,e.update()}},e.undoManager.logCommand(n);for(var b=e.timeline.clamped_displays.length,x=0;b>x;x++){var T=e.timeline.clamped_displays[x];t(T,T.clamped_init,T.clamped_new),T.has_been_clamped=!1}b>0&&(e.undoManager.combineLast(b+1),e.timeline.clamped_displays.length=0)}})}}function c(){un=!un,un?(rn.css("display","none"),sn.css("display","none"),rn.css("visibility","hidden"),sn.css("visibility","hidden")):(rn.css("display","block"),sn.css("display","block"),rn.css("visibility","visible"),sn.css("visibility","visible")),He.map(function(t){t.toggleCircle()})}function u(){var t=e.timeManager.getDuration(),n=t.start,i=t.end,r=Qe.findPreviousDisplay(e.that.getPos(),Ue),a=Qe.findNextDisplay(e.that.getPos(),Ue);return n=r?r.display.getEnd():n,i=a?a.display.getStart():i,e.mediaLength&&(n=Math.max(n,M()-parseFloat(e.mediaLength)),i=Math.min(i,parseFloat(e.mediaLength)+S())),{left:n,right:i}}function d(t){var n,r=u(),a=ze,o=0;if(e.type===TAG.TourAuthoring.TrackType.ink&&e.inkEnabled){var s=le();r.left=Math.max(r.left,s.getStart()+TAG.TourAuthoring.Constants.inkTrackOffset),r.right=Math.min(r.right,s.getEnd())}else(e.type===TAG.TourAuthoring.TrackType.artwork||e.type===TAG.TourAuthoring.TrackType.image)&&(n=i(),o=ce(n));if(ze=Math.constrain(t,r.left,r.right-Ve-Ye-Xe),q(ze),_e(ze-a),e.type===TAG.TourAuthoring.TrackType.artwork||e.type===TAG.TourAuthoring.TrackType.image)for(var l=0;n.length>l;l++)be(n[l])}function h(t){var n,r=u(),a=He.isEmpty()?-1/0:He.max().getTime()+TAG.TourAuthoring.Constants.epsilon-Ke,o=0;if(e.type===TAG.TourAuthoring.TrackType.ink&&e.inkEnabled){var s=le();r.left=Math.max(r.left,s.getStart()+TAG.TourAuthoring.Constants.inkTrackOffset),r.right=Math.min(r.right,s.getEnd())}else(e.type===TAG.TourAuthoring.TrackType.artwork||e.type===TAG.TourAuthoring.TrackType.image)&&(n=i(),o=ce(n));if(Xe=Math.constrain(Math.max(.1,t),a,r.right-ze-Ye-Ve),0===Ve&&0===Ye&&0===Xe&&(Xe=1),z(Xe+Ve+Ye>=o?Xe:o-Ve-Ye),e.type===TAG.TourAuthoring.TrackType.artwork||e.type===TAG.TourAuthoring.TrackType.image)for(var l=0;n.length>l;l++)be(n[l])}function p(t){var n,r,a=u(),o=0;if(e.type===TAG.TourAuthoring.TrackType.ink&&e.inkEnabled){var s=le();a.left=Math.max(a.left,s.getStart()+TAG.TourAuthoring.Constants.inkTrackOffset),a.right=Math.min(a.right,s.getEnd())}else(e.type===TAG.TourAuthoring.TrackType.artwork||e.type===TAG.TourAuthoring.TrackType.image)&&(r=i(),o=ce(r));Ve=Math.constrain(t,0,Ke-a.left);var l=Ke-Ve;!He.isEmpty()&&l>He.min().getTime()-e.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize)?(ze=He.min().getTime()-e.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize),Ve=Ke-ze):ze=l;var c;if(c=Xe+Ve+Ye>=o?Ve:o-Xe-Ye,j(c),e.type===TAG.TourAuthoring.TrackType.artwork||e.type===TAG.TourAuthoring.TrackType.image)for(n=0;r.length>n;n++)be(r[n])}function f(t){var n,r,a,o=u(),s=0;if(e.type===TAG.TourAuthoring.TrackType.ink&&e.inkEnabled){var l=le();o.left=Math.max(o.left,l.getStart()+TAG.TourAuthoring.Constants.inkTrackOffset),o.right=Math.min(o.right,l.getEnd())}else(e.type===TAG.TourAuthoring.TrackType.artwork||e.type===TAG.TourAuthoring.TrackType.image)&&(r=i(),s=ce(r));if(Ye=Math.constrain(t,0,o.right-Ze),a=Ze+Ye,!He.isEmpty()&&He.max().getTime()+e.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize)>a&&(Ye=He.max().getTime()+e.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize)-Ze),W(Xe+Ve+Ye>=s?Ye:s-Xe-Ve),e.type===TAG.TourAuthoring.TrackType.artwork||e.type===TAG.TourAuthoring.TrackType.image)for(n=0;r.length>n;n++)be(r[n])}function g(t){tn.open(t)}function m(){tn.close()}function v(t){ln=t}function y(){return cn}function b(t){cn=t}function x(t){e.currentDisplay=t}function T(){var t;Ue.getStorageContainer().displayTree.isSolo()&&e.attachedInks.length>0?(tn.forceClose(),e.timeline.confirmDeleteDisableInk(e.title,Ue,e)):(t=w(),k(!0),t>0&&e.undoManager.combineLast(t+1))}function w(){var t,e=i(),n=e.length;for(t=0;n>t;t++)e[t].removeDisplay(!0);return n}function k(t){tn.forceClose(!0);var n=He.clone(),i=TAG.TourAuthoring.Command({execute:function(){pn=!0,Qe.removeDisplay(e.that.getPos(),Ue),He.clear(function(t){t._value.removeHelper()}),an.remove(),on.remove(),nn.remove(),sn.remove(),rn.remove(),e.update()},unexecute:function(){pn=!1,o();var t=Qe.addDisplay(e.that.getPos(),Ue);Qe.replaceKeyframes(t.display,n);var i=Qe.getKeyframes(t);i._root&&i._root.traverse(A),e.update()}});i.execute(),t&&(e.undoManager.logCommand(i),console.log("logging"))}function A(t){t._value.reactivateKeyframe()}function _(){return pn}function C(){Qe.addDisplay(e.that.getPos(),Ue),B(),e.update()}function E(){fn++,e.that.getEventsPaused()||fn>1&&(fn=0,menuCloseable||(menuCloseable=!0,setTimeout(e.timeline.getCloseMenu(),0)))}function S(){return ze}function M(){return Ze+Ye}function I(){return Ke}function D(){return Xe}function P(){return Ze}function N(){return Ve}function G(){return Ye}function O(){return je}function L(t){H(t.inStart),U(t.outStart),R(t.inStart+t.fadeIn),z(t.main),j(t.fadeIn),W(t.fadeOut)}function F(t){Ke+=t,ze+=t,Ze+=t,B(),_e(t)}function B(){nn.css("left",hn(ze)+"px"),an.css("left",hn(Ke)+"px"),on.css("left",hn(Ze)+"px"),rn.css("left",hn(ze)-20+"px"),sn.css("left",hn(Ze+Ye)-20+"px"),e.track.append(an).append(nn).append(on).append(rn).append(sn),nn.show(),an.show(),on.show(),rn.show(),sn.show()}function R(t,e){Ke=t,ze=Ke-Ve,Ze=Ke+Xe,B(),_e(e)}function H(t){ze=t,Ke=ze+Ve,Xe=Ze-Ke,je=Ze+Ye-t,nn.css("left",hn(t)+"px"),rn.css("left",hn(t)-20+"px"),an.css({left:hn(Ke)+"px",width:hn(Xe)+"px"})}function U(t){Xe=t-Ke,Ze=t,je=t+Ye-ze,on.css("left",hn(t)+"px"),sn.css("left",hn(t+Ye)-20+"px"),an.css("width",hn(Xe)+"px")}function z(t){Xe=t,Ze=Ke+Xe,je=Ze+Ye-ze,on.css("left",hn(Ze)+"px"),sn.css("left",hn(Ze+Ye)-20+"px"),an.css("width",hn(Xe)+"px")}function j(t){qe?(Ve=t,Ke=ze+Ve,je=Ze+Ye-ze,nn.css("left",hn(ze)+"px"),nn.css("width",hn(Ve)+"px"),rn.css("left",hn(ze)-20+"px"),an.css({left:hn(Ke)+"px",width:hn(Xe)+"px"})):z(Xe+t)}function W(t){qe?(Ye=t,je=Ze+Ye-ze,on.css("width",hn(Ye)+"px"),sn.css("left",hn(Ze+Ye)-20+"px")):z(Xe+t)}function q(t){ze=t,Ke=ze+Ve,Ze=Xe+Ke,nn.css("left",hn(ze)+"px"),rn.css("left",hn(ze)-20+"px"),an.css("left",hn(Ke)+"px").css("width",hn(Xe)+"px"),on.css("left",hn(Ze)+"px"),sn.css("left",hn(Ze+Ye)-20+"px")}function V(){return Re}function Y(t){Re=t}function X(){return Fe}function K(t){Fe=t}function Z(){return e.that}function Q(){return parseFloat(e.mediaLength)}function J(){return mouseisup}function te(){return e.type}function ee(){return an}function ne(){return sn}function ie(){return rn}function re(){return ln}function ae(){e.that.getMinimizedState()&&(rn.hide(),sn.hide(),rn.css("visibility","hidden"),sn.css("visibility","hidden"))}function oe(t,n,r,a,o,s){var l,c,u,d,h,p=e.timeManager.getDuration(),f=0;if(n=n||p.start,r=r||p.end,a=a||-1,o=o||-1,ln&&(0===cn||cn)&&e.currentDisplay)if(ln===TAG.TourAuthoring.DisplayParts["fade-in"]){if(-1!==a)ze=a;else{if(!s&&e.type===TAG.TourAuthoring.TrackType.ink&&e.inkEnabled)d=le(),n=Math.max(n,d.getStart()+TAG.TourAuthoring.Constants.inkTrackOffset);else if(s||e.type!==TAG.TourAuthoring.TrackType.artwork&&e.type!==TAG.TourAuthoring.TrackType.image){if((e.type===TAG.TourAuthoring.TrackType.video||e.type===TAG.TourAuthoring.TrackType.audio)&&e.mediaLength){u=parseFloat(e.mediaLength);var g=Ze+Ye-u;n=Math.max(n,g)}}else l=i(),f=ce(l);if(h=e.timeManager.pxToTime(t.pivot.x-cn),M()-h>=f&&(ze=0===Ve&&0===Ye?Math.constrain(h,n,Math.min(e.timeManager.pxToTime(parseFloat(sn.css("left"))+20-2*TAG.TourAuthoring.Constants.fadeBtnSize),!He.isEmpty()&&He.min().getTime()-e.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize+TAG.TourAuthoring.Constants.keyframeStrokeW+TAG.TourAuthoring.Constants.fadeBtnSize)||1/0)):Math.constrain(e.timeManager.pxToTime(t.pivot.x-cn),n,Math.min(Ze-Ve-.1,!He.isEmpty()&&He.min().getTime()-e.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize+TAG.TourAuthoring.Constants.keyframeStrokeW+TAG.TourAuthoring.Constants.fadeBtnSize)||1/0)),!s&&(e.type===TAG.TourAuthoring.TrackType.artwork||e.type===TAG.TourAuthoring.TrackType.image)))for(c=0;l.length>c;c++)be(l[c])}H(ze)}else if(ln===TAG.TourAuthoring.DisplayParts["fade-out"]){if(-1!==o)Ze=o;else{if(!s&&e.type===TAG.TourAuthoring.TrackType.ink&&e.inkEnabled)d=le(),r=Math.min(r,d.getOutStart()+d.getFadeOut());else if(s||e.type!==TAG.TourAuthoring.TrackType.artwork&&e.type!==TAG.TourAuthoring.TrackType.image){if((e.type===TAG.TourAuthoring.TrackType.video||e.type===TAG.TourAuthoring.TrackType.audio)&&e.mediaLength){u=parseFloat(e.mediaLength);var m=ze+u;r=Math.min(r,m)}}else l=i(),f=ce(l);if(h=e.timeManager.pxToTime(t.pivot.x-cn),h+Ye-S()>=f&&(Ze=0===Ve&&0===Ye?Math.constrain(h,Math.max(e.timeManager.pxToTime(parseFloat(rn.css("left"))+20)+e.timeManager.pxToTime(2*TAG.TourAuthoring.Constants.fadeBtnSize),!He.isEmpty()&&He.max().getTime()-Ye+e.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize+TAG.TourAuthoring.Constants.keyframeStrokeW+TAG.TourAuthoring.Constants.fadeBtnSize)||-1/0),r-Ye):Math.constrain(h,Math.max(ze+Ve+.1,!He.isEmpty()&&He.max().getTime()-Ye+e.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize+TAG.TourAuthoring.Constants.keyframeStrokeW+TAG.TourAuthoring.Constants.fadeBtnSize)||-1/0),r-Ye),!s&&(e.type===TAG.TourAuthoring.TrackType.artwork||e.type===TAG.TourAuthoring.TrackType.image)))for(c=0;l.length>c;c++)be(l[c])}U(Ze)}else if(ln===TAG.TourAuthoring.DisplayParts.main){!s&&e.type===TAG.TourAuthoring.TrackType.ink&&e.inkEnabled?(d=le(),r=Math.min(r,d.getOutStart()+d.getFadeOut()),n=Math.max(n,d.getStart()+TAG.TourAuthoring.Constants.inkTrackOffset)):s||e.type!==TAG.TourAuthoring.TrackType.artwork&&e.type!==TAG.TourAuthoring.TrackType.image||(l=i());var v=Math.constrain(e.timeManager.pxToTime(t.pivot.x-cn),n+Ve,r-Ye-Xe),y=v-Ke;R(v,y);var b=null,x=null;e.type===TAG.TourAuthoring.TrackType.ink&&e.inkEnabled&&(b=le().getEnd(),x=le().getStart());var T=e.timeManager.pxToTime(t.pivot.x-cn),w=S();if(M(),T>w-.001?me(b):w+.001>T&&ve(x),!s&&(e.type===TAG.TourAuthoring.TrackType.artwork||e.type===TAG.TourAuthoring.TrackType.image))for(c=0;l.length>c;c++)be(l[c])}else console.log("currentDisplay.loc should be one of: 'fade-in', 'fade-out', or 'main'");else console.log("Move display called when no display is selected!");Ue.outStart=Ze,Ue.inStart=ze,e.that.drawLines()}function se(t){Be=t}function le(){return Be}function ce(t){for(var e={},n=0,i=0;t.length>i;i++){var r=t[i].getTrack().getTitle();e[r]=("number"==typeof e[r]?e[r]:0)+(t[i].getRemoved()?0:t[i].getEnd()-t[i].getStart()),e[r]>n&&(n=e[r])}return n+TAG.TourAuthoring.Constants.inkTrackOffset}function ue(){var t,n=[],i=[],r=Qe.getTracks();for(t=0;r.length>t;t++)r[t].track.getType()===TAG.TourAuthoring.TrackType.ink&&r[t].track.getInkEnabled()&&r[t].track.getInkLink().getTitle()===e.title&&i.push(r[t]);for(t=0;i.length>t;t++)for(var a=i[t],o=a.displays.getContents(),s=0;o.length>s;s++){var l=o[s].display;Ze+Ye>=l.getOutStart()&&l.getOutStart()>=ze&&n.push(l)}return n}function de(){var t=Ue.getStorageContainer().hostTrack.getPos(),n=null;e.type===TAG.TourAuthoring.TrackType.ink&&e.inkEnabled||(n=vn(t));var i=pe(t,n);dn=fe(i),gn=Qe.findNextDisplay(t,Ue),mn=Qe.findPreviousDisplay(t,Ue)}function he(t,e,n){if(n)for(var i=0;t.length>i;i++)n.lookup(t[i].display.getStart())||e.add({key:t[i].display.getStart()}),n.lookup(t[i].display.getEnd())||e.add({key:t[i].display.getEnd()});else for(var i=0;t.length>i;i++)e.add({key:t[i].display.getStart()}),e.add({key:t[i].display.getEnd()})}function pe(t,e){var n=t-1>=0?t-1:null,i=Qe.numTracks()>t+1?t+1:null,r=new AVLTree(yn,bn),a=Qe.getTracks();return null!=n&&he(a[n].displays.getContents(),r,e),null!=i&&he(a[i].displays.getContents(),r,e),r}function fe(t){for(var e=t.getContents(),n=new DoublyLinkedList,i=0;e.length>i;i++)n.append(e[i].key);return n}function ge(t){var n=e.timeManager.timeToPx(t);return.01*$(window).width()>n&&n>0?!0:!1}function me(t){var n=S(),i=M(),r=dn.findNext(n),a=dn.findNext(i),o=!1;if(t&&a&&a.data===t);else if(null!==a){var s=a.data-(ze+Ue.getTotalLength());!ge(s)||t&&i+s>t||(gn&&gn.display.getStart()-i>=s?(F(s),o=!0):gn||(F(s),o=!0))}if(!(t&&r&&r.data===t||null==r)){var l=r.data-n;!ge(l)||t&&i+l>t||i+l>e.timeManager.getDuration().end||o===!1&&(gn&&gn.display.getStart()-i>=l?F(l):gn||F(l))}}function ve(t){var e=S(),n=M(),i=dn.findPrev(e),r=dn.findPrev(n),a=!1;if(t&&i&&i.data===t);else if(null!=i){var o=e-i.data;!ge(o)||t&&t>e-o||(mn&&mn.display.getEnd()-e>=o?(F(-1*o),a=!0):mn||(F(-1*o),a=!0))}if(t&&r&&r.data===t);else if(null!=r){var s=ze+Ue.getTotalLength()-r.data;!ge(s)||t&&t>e-s||0>e-s||a===!1&&(mn&&mn.display.getEnd()-e>=s?F(-1*s):mn||F(-1*s))}}function ye(){var t=e.experienceId,n=t.getStorageContainer().displays,i=n.nearestNeighbors(S(),1);return i[0]}function be(t){var e=t.getStart(),n=t.getEnd(),i=(t.getMain(),t.getFadeIn(),t.getFadeOut(),t.getStorageContainer().displayTree),r=n;ze+TAG.TourAuthoring.Constants.inkTrackOffset>e&&xe(t,i,"right",ze+TAG.TourAuthoring.Constants.inkTrackOffset),r>Ze+Ye&&xe(t,i,"left",Ze+Ye)}function xe(t,n,i,r){var a,o,s,l,c=t.getStart(),u=t.getEnd(),d=t.getMain(),h=t.getFadeOut(),p=t.getFadeIn();if(t.has_been_clamped||(t.clamped_init={inStart:c,outStart:u-h,main:d,fadeIn:p,fadeOut:h},t.has_been_clamped=!0,e.timeline.clamped_displays.push(t)),"right"===i){l=r-c,a=r,o=u+l,s=d,t.setInStart(a),t.setOutStart(o-h),t.setMain(s),t.clamped_new={inStart:a,outStart:o-h,main:s,fadeIn:p,fadeOut:h};var f=n.findNext(t.getStorageContainer());f&&o>f.display.getStart()&&xe(f.display,n,"right",o)}else{l=u-r,o=r,a=c-l,s=d,t.setInStart(a),t.setOutStart(o-h),t.setMain(s),t.clamped_new={inStart:a,outStart:o-h,main:s,fadeIn:p,fadeOut:h};var g=n.findPrevious(t.getStorageContainer());g&&g.display.getEnd()>a&&xe(g.display,n,"left",a)}}function Te(t,n,i,r,a){var o;if(ln&&(0===cn||cn)&&e.currentDisplay){if(ln===TAG.TourAuthoring.DisplayParts["fade-in"]){var s=Math.constrain(e.timeManager.pxToTime(t.pivot.x-cn),n,ze+r);o=s-ze}else if(ln===TAG.TourAuthoring.DisplayParts["fade-out"]){var l=Math.constrain(e.timeManager.pxToTime(t.pivot.x-cn),M()-a-Ye,i-Ye);o=l-Ze}else if(ln===TAG.TourAuthoring.DisplayParts.main){var c=Math.constrain(e.timeManager.pxToTime(t.pivot.x-cn),n+Ve,i-Ye-Xe);o=c-Ke}}else console.log("Move display called when no display is selected!");return o}function we(t,n,i,r){i=i||-1,r=r||-1;var a,o,s,l,c=0;if(!ln||0!==cn&&!cn)console.log("Move display called when no display is selected!");else if(ln===TAG.TourAuthoring.DisplayParts["fade-in"]){for(o=0;t.length>o;o++)if(l=t[o],(l.getType()===TAG.TourAuthoring.TrackType.artwork||l.getType()===TAG.TourAuthoring.TrackType.image)&&(a=l.getChildDisplays(),c=l.getLongestSubgroup(a)),l.getEnd()-n>=c){var u=l.getStart();if(-1!==i?u=i:u+=n,l.setInStart(u),l.getType()===TAG.TourAuthoring.TrackType.artwork||l.getType()===TAG.TourAuthoring.TrackType.image)for(s=0;a.length>s;s++)-1===t.indexOf(a[s])&&l.clampDisplay(a[s])}}else if(ln===TAG.TourAuthoring.DisplayParts["fade-out"]){for(o=0;t.length>o;o++)if(l=t[o],(l.getType()===TAG.TourAuthoring.TrackType.artwork||l.getType()===TAG.TourAuthoring.TrackType.image)&&(a=l.getChildDisplays(),c=l.getLongestSubgroup(a)),l.getEnd()-n>=c){var d=l.getOutStart();if(-1!==r?Ze=r:d+=n,l.setOutStart(d),l.getType()===TAG.TourAuthoring.TrackType.artwork||l.getType()===TAG.TourAuthoring.TrackType.image)for(s=0;a.length>s;s++)-1===t.indexOf(a[s])&&l.clampDisplay(a[s])}}else if(ln===TAG.TourAuthoring.DisplayParts.main)for(o=0;t.length>o;o++){l=t[o],(l.getType()===TAG.TourAuthoring.TrackType.artwork||l.getType()===TAG.TourAuthoring.TrackType.image)&&(a=l.getChildDisplays(),c=l.getLongestSubgroup(a));var h=l.getMainStart(),p=n+h;if(l.setMainStart(p,n),l.getType()===TAG.TourAuthoring.TrackType.artwork||l.getType()===TAG.TourAuthoring.TrackType.image)for(s=0;a.length>s;s++)-1===t.indexOf(a[s])&&l.clampDisplay(a[s]);l.getTrackFromDisplay().drawLines()}else console.log("currentDisplay.loc should be one of: 'fade-in', 'fade-out', or 'main'");Ue.outStart=Ze,Ue.inStart=ze,e.that.drawLines()}function ke(){return e.that}function Ae(t,n,i,r,a){var o={pivot:{x:t}};e.currentDisplay=Ue,ln=r,cn=a,oe(o,n,i,-1,-1),e.currentDisplay=null,ln=null,cn=null}function _e(t){He.map(function(e){e.translate(t)})}function Ce(){1884>hn(ze)&&hn(ze)>1883&&console.log(""),Ze=ze+Ve+Xe,nn.css("left",hn(ze)+"px").css("width",hn(Ve)+"px"),an.css("left",hn(Ke)+"px").css("width",hn(Xe)+"px"),on.css("left",hn(Ze)+"px").css("width",hn(Ye)+"px"),rn.css("left",hn(ze)-20+"px"),sn.css("left",hn(Ze+Ye)-20+"px"),He.map(function(t){t.scale()})}function Ee(t,n){if(We){var i,r,a=e.timeline.captureKeyframe(e.title),o={loc:{x:Math.twoDecPlaces(e.timeManager.pxToTime(t)),y:e.type===TAG.TourAuthoring.TrackType.audio?n:48},gkey:en,display:Ue,data:a,displayDiv:an},s=He.nearestNeighbors(o.loc.x,1);if(s[0]&&.05>Math.abs(s[0].getTime()-o.loc.x)||s[1]&&.05>Math.abs(s[1].getTime()-o.loc.x))return null;i=TAG.TourAuthoring.Keyframe(o,e),r=TAG.TourAuthoring.Command({execute:function(){He.add(i),i.reactivateKeyframe(),i.restoreHandlers(),e.that.addKeyframeToLines(i),e.update()},unexecute:function(){i.remove(!1,!0),i.setDeselected(),e.update()}}),e.undoManager.logCommand(r),console.log("logging"),He.add(i),e.that.getMinimizedState()&&i.toggleCircle();var l=document.createEvent("Event");return l.initEvent("playerReloading",!0,!0),$("body")[0].dispatchEvent(l),i}return null}function Se(t){He.remove(t)}function Me(t){He.add(t)}function Ie(){var t;for(keyframes.sort($e),t=0;keyframes.length>t;t++)keyframes[t].updatePosition(t)}function De(){return He.max()}function Pe(){return He}function $e(t,e){return t.getTime()<e.getTime()?-1:t.getTime()===e.getTime?0:1}function Ne(t,n,i,r){var a=e.title+"-"+r;switch(t.experienceStreams[a]={duration:Xe,data:{zIndex:e.timeline.getNumTracks()-e.that.getPos(),layerProperties:{passthrough:n}}},qe&&(t.experienceStreams[a].data.transition={providerId:"FadeInOutTransitionService",inDuration:Ve,outDuration:Ye}),e.type){case TAG.TourAuthoring.TrackType.artwork:t.experienceStreams[a].data.ContentType="<SingleDeepZoomImage/>",t.experienceStreams[a].header={},t.experienceStreams[a].header.defaultKeyframeSequence=a,t.experienceStreams[a].keyframes=Ge(i);break;case TAG.TourAuthoring.TrackType.image:t.experienceStreams[a].header={},t.experienceStreams[a].header.defaultKeyframeSequence=a,t.experienceStreams[a].keyframes=Ge(i);break;case TAG.TourAuthoring.TrackType.audio:t.experienceStreams[a].header={},t.experienceStreams[a].header.defaultKeyframeSequence=a,t.experienceStreams[a].keyframes=Ge(i);break;case TAG.TourAuthoring.TrackType.video:t.experienceStreams[a].data.markers={beginAt:0,endAt:Xe};break;case TAG.TourAuthoring.TrackType.ink:break;default:console.log("RIN track type not yet implemented")}}function Ge(t){var n,i=[],r=Qe.getKeyframes(Ue.getStorageContainer()),a=r.getContents();return a.length>0?((e.type===TAG.TourAuthoring.TrackType.artwork||e.type===TAG.TourAuthoring.TrackType.audio||e.type===TAG.TourAuthoring.TrackType.image)&&(n=r.min().toRIN(),n.offset=0,n.init=!0,i.push(n)),r.map(function(t){i.push(t.toRIN())})):t?(n=t.toRIN(),n.offset=0,n.init=!0,i.push(n)):e.type===TAG.TourAuthoring.TrackType.audio?(n={offset:0,init:!0,holdDuration:0,state:{sound:{volume:TAG.TourAuthoring.Constants.defaultVolume}}},i.push(n)):0==a.length&&(console.log("capturing blank kf for reset"),n=e.timeline.captureKeyframe(e.title),n||(n={state:{viewport:{region:{center:{x:0,y:0},span:{x:1,y:1}}}}}),n.offset=0,n.init=!0,i.push(n)),i}function Oe(t){var n={},i=e.title+"-"+t;return n.experienceId=e.title,n.experienceStreamId=i,n.begin=ze,n.duration=Ve+Xe,n.layer="foreground",n.zIndex=Qe.numTracks()-e.that.getPos(),e.type===TAG.TourAuthoring.TrackType.audio?(n.dominantMedia="audio",n.volume=1):(n.dominantMedia="visual",n.volume=1),n}function Le(){}e.type===TAG.TourAuthoring.TrackType.audio&&console.log("audio");var Fe,Be,Re,He,Ue={},ze=t.start||0,je=t.length||5,We=t.canKeyframe,qe=t.canFade,Ve=qe&&je>=1.5?t.fadeIn||.5:0,Ye=qe&&je>=1.5?t.fadeOut||.5:0,Xe=je-(Ve+Ye),Ke=ze+Ve,Ze=Ke+Xe,Qe=t.dataHolder,Je=[],tn=TAG.TourAuthoring.EditorMenu({type:TAG.TourAuthoring.MenuType.display,parent:Ue},e);Ue.inStart=ze,Ue.fadeIn=Ve,Ue.fadeOut=Ye,Ue.oldStart=Ze,Ue.clamped_new={},Ue.clamped_init={},Ue.has_been_clamped=!1;var en,nn,rn,an,on,sn,ln,cn,un=!1,dn=new DoublyLinkedList,hn=e.timeManager.timeToPx;e.timeManager.pxToTime,Ue.setKeyframeTree=n,Ue.getChildDisplays=i,Ue.addChildDisplay=r,Ue.removeChildDisplay=a,Ue.initVisuals=o,o(),Ue.restoreHandlers=s,Ue.toggleCircles=c,function(){tn.addInput("Start",TAG.TourAuthoring.MenuInputFormats.minSec,S,d),tn.addInput("Main Length",TAG.TourAuthoring.MenuInputFormats.minSec,D,h),qe&&(tn.addInput("Fade-In",TAG.TourAuthoring.MenuInputFormats.sec,N,p),tn.addInput("Fade-Out",TAG.TourAuthoring.MenuInputFormats.sec,G,f)),tn.addButton("Delete","left",T),tn.addButton("Close","right",tn.forceClose)}(),Ue.setFadeInFromMenu=p,Ue.setFadeOutFromMenu=f,Ue.rightTapped=g,Ue.closeMenu=m,Ue.setLoc=v,Ue.getOffset=y,Ue.setOffset=b,Ue.setcurrentDisplay=x,Ue.removeHelper=T,Ue.removeAttachedInkDisplays=w;var pn=!1;Ue.removeDisplay=k,Ue.getRemoved=_,Ue.reloadDisplay=C;var fn=0;Ue.released=E,Ue.getStart=S,Ue.getEnd=M,Ue.getMainStart=I,Ue.getMain=D,Ue.getOutStart=P,Ue.getFadeIn=N,Ue.getFadeOut=G,Ue.getTotalLength=O,Ue.setTimes=L,Ue.updateDispTimes=F,Ue.resetVisuals=B,Ue.setMainStart=R,Ue.setInStart=H,Ue.setOutStart=U,Ue.setMain=z,Ue.setIn=j,Ue.setOut=W,Ue.translateTo=q,Ue.getID=V,Ue.setID=Y,Ue.getStorageContainer=X,Ue.setStorageContainer=K,Ue.getTrack=Z,Ue.getMediaLength=Q,Ue.getMouseup=J,Ue.getType=te,Ue.getMainD=ee,Ue.getFioHandle=ne,Ue.getFinHandle=ie,Ue.getLoc=re,Ue.suppressHandles=ae,Ue.move=oe,Ue.setParentDisplay=se,Ue.getParentDisplay=le,Ue.getLongestSubgroup=ce,Ue.getAllChildDisplays=ue;var gn,mn,vn=function(){for(var t=ue(),e=new HashTable,n=0;t.length>n;n++)e.insert(t[n].getStart(),1),e.insert(t[n].getEnd(),1);return 0===e.getLength()?null:e},yn=function(t,e){return t.key<e.key?-1:t.key>e.key?1:0},bn=function(t,e){return e?e.key>t?-1:t>e.key?1:0:null};return Ue.getParentArtDisplay=ye,Ue.clampDisplay=be,Ue.slideDisplay=xe,Ue.getTranslation=Te,Ue.msMove=we,Ue.getTrackFromDisplay=ke,Ue.internalMove=Ae,Ue.scale=Ce,Ue.addKeyframe=Ee,Ue.removeKeyframe=Se,Ue.insertKeyframe=Me,Ue.sortKeyframes=Ie,Ue.getLastKeyframe=De,Ue.getKeyframes=Pe,Ue.toES=Ne,Ue.toScreenPlayEntry=Oe,Ue.loadRIN=Le,Ue},TAG.Util.makeNamespace("TAG.TourAuthoring.MenuInputFormats"),TAG.Util.makeNamespace("TAG.TourAuthoring.EditorMenu"),TAG.TourAuthoring.MenuInputFormats={minSec:1,sec:2,percent:3},TAG.TourAuthoring.MenuType={display:1,keyframe:2,track:3},TAG.TourAuthoring.EditorMenu=function(t,e){"use strict";function n(t){var n=e.timeline.getCloseMenu();n&&n(),e.that.getEventsPaused()||(e.timeline.allDeselected(),e.timeline.setisMenuOpen(!0),e.timeline.setCloseMenu(r),e.that.updateTracksEventsPaused(!0),t&&u(t),c(),e.currentDisplay=null,e.currentKeyframe&&(e.currentKeyframe.setDeselected(),e.currentKeyframe=null),m.data("events")&&m.data("events").click||m.on("click",function(t){T.map(l),t.stopImmediatePropagation()}),m.data("events")&&m.data("events").MSPointerDown||m.on("MSPointerDown",function(t){T.map(l),t.stopImmediatePropagation()}),m.data("events")&&m.data("events").mousedown||m.on("mousedown",function(t){T.map(l),t.stopImmediatePropagation()}),e.root.on("mousedown.editorMenu",function(t){var e,n=!1;for(e=0;T.length>e;e++)if(-1===$(t.target).parents().index(T[e].input)){n=!0;break}g.close()}))}function i(t){r(t)}function r(t){var n;if(e.root.off("mousedown.editorMenu"),e.timeline.setisMenuOpen(!1),e.timeline.setCloseMenu(null),e.that.updateTracksEventsPaused(!1),m.hide(),v.hide(),!t)for(n=0;T.length>n;n++)l(T[n])}function a(t,e,n,i){var r={},a=$(document.createElement("div")),o=($(document.createElement("div")),$(document.createElement("input"))),s=$(document.createElement("text"));switch(o.attr("type","text"),o.val(p(n(),e)),o.css({width:"15%",position:"absolute",right:"40%"}),o.on("click",function(t){o.select(),t.stopImmediatePropagation()}),o.on("MSPointerDown",function(t){t.stopImmediatePropagation()}),o.keypress(function(t){13===t.keyCode&&(l(r),c())}),s.css({position:"absolute","float":"right","font-size":"80%",right:"15px"}),e){case TAG.TourAuthoring.MenuInputFormats.minSec:s.text("min:sec");break;case TAG.TourAuthoring.MenuInputFormats.sec:s.text("secs");break;case TAG.TourAuthoring.MenuInputFormats.percent:s.text("percent")}a.css({width:"95%","margin-left":"auto","margin-right":"auto","font-size":TAG.Util.getFontSize(200),"padding-top":"3%"}),a.append(t),a.append(o),a.append(s),m.append(a),r.input=o,r.accessCallback=n,r.updateCallback=i,r.format=e,T.push(r)}function o(t){var e=$(document.createElement("label"));e.text(t),e.css({left:"auto",top:"auto",position:"relative","font-size":TAG.Util.getFontSize(250),color:"rgb(256, 256, 256)",display:"block",padding:"4%","text-align":"center"}),m.append(e)}function s(t,e,n){var i=$(document.createElement("label"));switch(i.text(t),i.css({left:"0%",position:"relative",top:"5%","font-size":TAG.Util.getFontSize(200),color:"rgb(256, 256, 256)",display:"block",padding:"10px 0","text-align":"center","margin-left":"3%","margin-right":"3%","float":e}),y){case TAG.TourAuthoring.MenuType.track:i.css({width:"93%",height:"16%","border-style":"solid","border-width":"2px","margin-left":"3%","margin-right":"3%","margin-bottom":"3%",top:""})}m.append(i),TAG.Util.makeManipulatable(i[0],{onTapped:n})}function l(t){function n(t,n,i){var r={execute:function(){t.setTimes(i)},unexecute:function(){console.log("init: "+n.inStart+", new: "+i.inStart),t.setTimes(n)}};e.undoManager.logCommand(r),t.has_been_clamped=!1}var i,r=t.accessCallback(),a=t.input.val();if(d(a)&&(a=h(a,t.format),Math.abs(r-a)>TAG.TourAuthoring.Constants.epsilon)){e.timeline.clamped_displays.length=0,i={execute:function(){t.updateCallback(a),t.input.val(p(t.accessCallback(),t.format)),e.update()},unexecute:function(){t.updateCallback(r),t.input.val(p(t.accessCallback(),t.format)),e.update()}},i.execute(),e.undoManager.logCommand(i);for(var o=e.timeline.clamped_displays.length,s=0;o>s;s++){var l=e.timeline.clamped_displays[s];n(l,l.clamped_init,l.clamped_new)}e.undoManager.combineLast(o+1)}t.input.val(p(t.accessCallback(),t.format))}function c(){var t,e;for(t=0;T.length>t;t++)e=T[t],e.input.val(p(e.accessCallback(),e.format))}function u(t){var n,i,r,a;switch(m.show(),v.show(),y){case TAG.TourAuthoring.MenuType.display:case TAG.TourAuthoring.MenuType.keyframe:n=e.track.offset().left+t.position.x-m.width()/2,r=n+m.width()/2-v.width()/2,a=e.track.offset().top,i=a-m.height()-3,n=Math.min(n,$(document).width()-m.width());break;case TAG.TourAuthoring.MenuType.track:i=e.track.offset().top+e.track.height()/2-m.height()/2,a=i+m.height()/2-v.height()/2,i=Math.min(i,(b.offset().top+b.height())/2+$(document).height()/2-m.height()),n=m.offset().left,r=v.offset().left}m.css({left:n+"px",top:i+"px"}),v.css({left:r+"px",top:a+"px"})}function d(t){var e,n,i=0;if(!t)return!1;for(e=0;t.length>e;e){if(n=t.charAt(e),":"===n&&i++,i>1||isNaN(parseFloat(n))&&"."!=n&&":"!=n)return!1;e+=1}return!0}function h(t,e){var n,i;switch(e){case TAG.TourAuthoring.MenuInputFormats.minSec:return t=t.split(":"),1===t.length?parseFloat(t[0]):(n=t[0]?parseFloat(t[0]):0,i=parseFloat(t[1]),i+60*n);case TAG.TourAuthoring.MenuInputFormats.sec:case TAG.TourAuthoring.MenuInputFormats.percent:return parseFloat(t)}}function p(t,e){var n,i;switch(e){case TAG.TourAuthoring.MenuInputFormats.minSec:return n=Math.floor(t/60),10>n&&(n="0"+n),i=t%60,i=f(i),10>i&&(i="0"+i),n+":"+i;case TAG.TourAuthoring.MenuInputFormats.sec:case TAG.TourAuthoring.MenuInputFormats.percent:return f(t)+""}}function f(t){return Math.round(t*w)/w}var g={},m=$(document.createElement("div")),v=$(document.createElement("img")),y=t.type,b=(t.parent,e.timeline.getTrackBody()),x=.95,T=[];g.menuCloseable=!0,m.addClass("displayMenu"),function(){var t,n;switch(y){case TAG.TourAuthoring.MenuType.display:t="25%";break;case TAG.TourAuthoring.MenuType.keyframe:t="18%";break;case TAG.TourAuthoring.MenuType.track:t="20%"}switch(m.css({position:"fixed",color:"rgb(256, 256, 256)",width:t,"background-color":"rgba(0,0,0,"+x+")","padding-top":"3px","padding-left":"2px","padding-right":"2px","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex+7,"border-radius":"15px"}),y){case TAG.TourAuthoring.MenuType.display:break;case TAG.TourAuthoring.MenuType.keyframe:break;case TAG.TourAuthoring.MenuType.track:m.css({left:"18%",padding:".5%","margin-top":"1%","float":"left",clear:"left","border-radius":"5%"})}switch(e.track.append(m),m.hide(),e.timeline.isMenuOpen=!1,m.on("MSPointerDown",function(t){T.map(l),t.stopImmediatePropagation()}),m.on("mousedown",function(t){T.map(l),t.stopImmediatePropagation()}),m.on("click",function(t){T.map(l),t.stopImmediatePropagation()}),y){case TAG.TourAuthoring.MenuType.display:case TAG.TourAuthoring.MenuType.keyframe:n="images/icons/KeyframeInfo-Opaque.png";break;case TAG.TourAuthoring.MenuType.track:n="images/icons/LeftPoint-Opaque.png"}switch(v.attr("src",n),v.css({position:"fixed",height:"45px",width:"54px","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex+5,opacity:x}),y){case TAG.TourAuthoring.MenuType.track:v.css({left:"14%",height:"6%",width:"4%"});break;default:v.css({"margin-top":"-1px"})}e.track.append(v),v.hide()}(),g.open=n,g.close=i,g.forceClose=r,g.addInput=a,g.addTitle=o,g.addButton=s;var w=Math.pow(10,TAG.TourAuthoring.Constants.menuDecimals);return g},TAG.Util.makeNamespace("TAG.TourAuthoring.ImageTrack"),TAG.TourAuthoring.ImageTrack=function(t,e){"use strict";
t.type=TAG.TourAuthoring.TrackType.image,e=e||{};var n=TAG.TourAuthoring.Track(t,e);return e.track.addClass("image"),n},TAG.Util.makeNamespace("TAG.TourAuthoring.InkablePart"),TAG.TourAuthoring.InkablePart=function(t,e){"use strict";function n(t){assets.push(t)}function i(){}return e.assets=[],t.addAsset=n,t.removeAsset=i,t},TAG.Util.makeNamespace("TAG.TourAuthoring.InkAuthoring"),TAG.TourAuthoring.InkMode={shapes:0,draw:1,erase:2,text:5},TAG.TourAuthoring.InkCallers={inkes:1,componentcontrols:2},TAG.TourAuthoring.InkAuthoring=function(t,e,n,i){"use strict";function r(){Sn="#000000",Mn=1,In=7,Dn=5,Ln="#ffffff",Fn=.7,Bn=5,Rn="#000000",Hn=0,Un="#000000",zn=.8,jn="isolate",Xn="'Times New Roman', serif",Kn="#ffffff",Zn="12px",Qn=1}function a(t,e){return parseFloat(t)*parseFloat(e)}function o(t,e,n,i,r,a){var o,s,l,c,u,d={x:0,y:0,w:0,h:0},h={x:0,y:0,w:0,h:0},p={x:0,y:0,w:0,h:0},f={x:0,y:0,w:0,h:0};void 0===e&&(e=Rn),void 0===n&&(n=Hn),void 0===i&&(i=Ln),void 0===r&&(r=Fn),void 0===a&&(a=Bn),t.attr({"stroke-width":a,stroke:i,"stroke-opacity":r,fill:e,"fill-opacity":n,"stroke-dasharray":"-"});var g,m,v,y=TAG.TourAuthoring.Constants.inkDragHandleRadius;if("ellipse"==t.data("type")){var b=t.data("curr_rx"),x=t.data("curr_ry"),T=t.data("currx")+b,w=t.data("curry")+x,k=b/Math.sqrt(2),A=x*Math.sqrt(1-k*k/(b*b));g=Cn.ellipse(T-k-a/2,w+a/2-A,y-2,y-2).attr({"stroke-width":2,stroke:"#ffffff",fill:"#296B2F","fill-opacity":.9}).data("type","grabHandle"),m=Cn.ellipse(T+k+a/2,w+A+a/2,y-2,y-2).attr({"stroke-width":2,stroke:"#296B2F",fill:"#ffffff","fill-opacity":.9}).data("type","grabHandle"),v=Cn.ellipse(T+k+a/2,w+a/2-A,y-2,y-2).attr({"stroke-width":2,stroke:"#ffffff",fill:"#880000","fill-opacity":.9}).data("type","grabHandle")}else if("rect"==t.data("type")){var _=t.data("currx"),C=t.data("curry"),E=t.data("currw"),S=t.data("currh");g=Cn.ellipse(_,C,y-2,y-2).attr({"stroke-width":2,stroke:"#ffffff",fill:"#296B2F","fill-opacity":.9}).data("type","grabHandle"),m=Cn.ellipse(_+E,C+S,y-2,y-2).attr({"stroke-width":2,stroke:"#296B2F",fill:"#ffffff","fill-opacity":.9}).data("type","grabHandle"),v=Cn.ellipse(_+E,C,y-2,y-2).attr({"stroke-width":2,stroke:"#ffffff",fill:"#880000","fill-opacity":.9}).data("type","grabHandle")}g.data("curr_cx",g.attr("cx")),g.data("curr_cy",g.attr("cy")),m.data("curr_cx",m.attr("cx")),m.data("curr_cy",m.attr("cy")),v.data("curr_cx",v.attr("cx")),v.data("curr_cy",v.attr("cy"));var M=TAG.TourAuthoring.Command({execute:function(){t.show(),g.show(),m.show(),v.show(),t.data("visible","yes")},unexecute:function(){t.hide(),g.hide(),m.hide(),v.hide(),t.data("visible","no")}});M.execute(),di.logCommand(M),g.drag(function(e,n){u=!0,t.toFront(),g.toFront(),m.toFront(),v.toFront();var i=(d.w+a)/2,r=(d.h+a)/2,o=g.attr("rx");i>=p.x+a+o+e&&(e=i-p.x-o),r>=p.y+o+a+n&&(n=i-p.y-o),h.x+o+e+i>=Vi&&(e=Vi-i-h.x-o),h.y+o+n+r>=Yi&&(n=Yi-h.y-o-r);var s=parseInt(g.data("curr_cx"),10),l=parseInt(g.data("curr_cy"),10),c=s+e,f=l+n;g.attr({cx:c,cy:f});var y=parseInt(m.data("curr_cx"),10),b=parseInt(m.data("curr_cy"),10);c=y+e,f=b+n,m.attr({cx:c,cy:f});var x=parseInt(v.data("curr_cx"),10),T=parseInt(v.data("curr_cy"),10);c=x+e,f=T+n,v.attr({cx:c,cy:f});var w,k;"ellipse"===t.data("type")?(w=parseInt(t.data("currx"),10)+t.attr("rx"),k=parseInt(t.data("curry"),10)+t.attr("ry")):"rect"===t.data("type")&&(w=parseInt(t.data("currx"),10),k=parseInt(t.data("curry"),10)),c=w+e,f=k+n,t.attr({x:c,y:f,cx:c,cy:f})},function(){u=!1,o=t.getBBox(),d.x=o.x,d.y=o.y,d.w=o.width,d.h=o.height,s=g.getBBox(),h.x=s.x,h.y=s.y,h.w=s.width,h.h=s.height,l=m.getBBox(),p.x=l.x,p.y=l.y,p.w=l.width,p.h=l.height,c=v.getBBox(),f.x=c.x,f.y=c.y,f.w=c.width,f.h=c.height},function(){if(u){var e=g.getBBox().x,n=g.getBBox().y,i=g.getBBox().width,r=g.getBBox().height;this.data("curr_cx",e+i/2),this.data("curr_cy",n+r/2);var a=m.getBBox().x,o=m.getBBox().y,s=m.getBBox().width,l=m.getBBox().height;m.data("curr_cx",a+s/2),m.data("curr_cy",o+l/2);var c=v.getBBox().x,y=v.getBBox().y,b=v.getBBox().width,x=v.getBBox().height;v.data("curr_cx",c+b/2),v.data("curr_cy",y+x/2);var T=t.getBBox().x,w=t.getBBox().y,k=t.getBBox().width,A=t.getBBox().height;"ellipse"==t.data("type")?(t.data("currx",t.attr("cx")-t.attr("rx")),t.data("curry",t.attr("cy")-t.attr("ry")),t.data("curr_rx",t.attr("rx")),t.data("curr_ry",t.attr("ry"))):"rect"==t.data("type")&&(t.data("currx",t.attr("x")),t.data("curry",t.attr("y")));var _=d.x,C=d.y,E=d.w,S=d.h,M=h.x,I=h.y,D=h.w,P=h.h,$=p.x,N=p.y,G=p.w,O=p.h,L=f.x,F=f.y,B=f.w,R=f.h,H=TAG.TourAuthoring.Command({execute:function(){t.data("currx",T),t.data("curry",w),t.data("currw",k),t.data("currh",A),t.data("curr_rx",k/2),t.data("curr_ry",A/2),t.attr({cx:T+k/2,cy:w+A/2,rx:k/2,ry:A/2,x:T,y:w,width:k,height:A}),g.data("curr_cx",e+i/2),g.data("curr_cy",n+r/2),g.attr({cx:e+i/2,cy:n+r/2,rx:i/2,ry:r/2}),m.data("curr_cx",a+s/2),m.data("curr_cy",o+l/2),m.attr({cx:a+s/2,cy:o+l/2,rx:s/2,ry:l/2}),v.data("curr_cx",c+b/2),v.data("curr_cy",y+x/2),v.attr({cx:c+b/2,cy:y+x/2,rx:b/2,ry:x/2})},unexecute:function(){t.data("currx",_),t.data("curry",C),t.data("currw",E),t.data("currh",S),t.data("curr_rx",E/2),t.data("curr_ry",S/2),t.attr({cx:_+E/2,cy:C+S/2,rx:E/2,ry:S/2,x:_,y:C,width:E,height:S}),g.data("curr_cx",M+D/2),g.data("curr_cy",I+P/2),g.attr({cx:M+D/2,cy:I+P/2}),m.data("curr_cx",$+G/2),m.data("curr_cy",N+O/2),m.attr({cx:$+G/2,cy:N+O/2}),v.data("curr_cx",L+B/2),v.data("curr_cy",F+R/2),v.attr({cx:L+B/2,cy:F+R/2})}});H.execute(),di.logCommand(H)}}),m.drag(function(e,n){u=!0,t.toFront(),g.toFront(),m.toFront(),v.toFront();var i=parseInt(m.data("curr_cx"),10),r=parseInt(m.data("curr_cy"),10),a=i+e,o=r+n,s=g.attr("cx"),l=g.attr("cy"),c=TAG.TourAuthoring.Constants.inkDragHandleRadius;a-s>2*c&&(m.attr({cx:a}),v.attr({cx:a})),o-l>2*c&&m.attr({cy:o});var d=this.attr("cx"),h=this.attr("cy");t.attr("rx");var p=s+(d-s)/2,f=l+(h-l)/2,y=(d-s)/2*Math.sqrt(2);t.attr({cx:p,cy:f,rx:y,ry:y*Math.sqrt(-(h-f)*(h-f)/((d-p)*(d-p)-y*y)),width:d-s,height:h-l})},function(){u=!1;var e=t.getBBox();d.x=e.x,d.y=e.y,d.w=e.width,d.h=e.height,e=g.getBBox(),h.x=e.x,h.y=e.y,h.w=e.width,h.h=e.height,e=m.getBBox(),p.x=e.x,p.y=e.y,p.w=e.width,p.h=e.height,e=v.getBBox(),f.x=e.x,f.y=e.y,f.w=e.width,f.h=e.height},function(){if(u){var e=m.getBBox().x,n=m.getBBox().y,i=m.getBBox().width,r=m.getBBox().height;m.data("curr_cx",e+i/2),m.data("curr_cy",n+r/2),"ellipse"===t.data("type")?(t.data("currx",t.attr("cx")-t.attr("rx")),t.data("curry",t.attr("cy")-t.attr("ry")),t.data("curr_rx",t.attr("rx")),t.data("curr_ry",t.attr("ry"))):"rect"===t.data("type")&&(t.data("currx",t.attr("x")),t.data("curry",t.attr("y")),t.data("currw",t.attr("width")),t.data("currh",t.attr("height")));var a=t.getBBox().x,o=t.getBBox().y,s=t.getBBox().width,l=t.getBBox().height,c=g.getBBox().x,y=g.getBBox().y,b=g.getBBox().width,x=g.getBBox().height,T=v.getBBox().x,w=v.getBBox().y,k=v.getBBox().width,A=v.getBBox().height,_=d.x,C=d.y,E=d.w,S=d.h,M=h.x,I=h.y,D=h.w,P=h.h,$=p.x,N=p.y,G=p.w,O=p.h,L=f.x,F=f.y,B=f.w,R=f.h,H=TAG.TourAuthoring.Command({execute:function(){t.data("currx",a),t.data("curry",o),t.data("currw",s),t.data("currh",l),t.data("curr_rx",s/2),t.data("curr_ry",l/2),t.attr({cx:a+s/2,cy:o+l/2,rx:s/2,ry:l/2,x:a,y:o,width:s,height:l}),g.data("curr_cx",c+b/2),g.data("curr_cy",y+x/2),g.attr({cx:c+b/2,cy:y+x/2,rx:b/2,ry:x/2}),m.data("curr_cx",e+i/2),m.data("curr_cy",n+r/2),m.attr({cx:e+i/2,cy:n+r/2,rx:i/2,ry:r/2}),v.data("curr_cx",T+k/2),v.data("curr_cy",w+A/2),v.attr({cx:T+k/2,cy:w+A/2,rx:k/2,ry:A/2})},unexecute:function(){t.data("currx",_),t.data("curry",C),t.data("currw",E),t.data("currh",S),t.data("curr_rx",E/2),t.data("curr_ry",S/2),t.attr({cx:_+E/2,cy:C+S/2,rx:E/2,ry:S/2,x:_,y:C,width:E,height:S}),g.data("curr_cx",M+D/2),g.data("curr_cy",I+P/2),g.attr({cx:M+D/2,cy:I+P/2}),m.data("curr_cx",$+G/2),m.data("curr_cy",N+O/2),m.attr({cx:$+G/2,cy:N+O/2}),v.data("curr_cx",L+B/2),v.data("curr_cy",F+R/2),v.attr({cx:L+B/2,cy:F+R/2})}});H.execute(),di.logCommand(H)}}),t.drag(function(e,n){u=!0,this.toFront(),g.toFront(),m.toFront(),v.toFront();var i=(d.w+a)/2,r=(d.h+a)/2,o=g.attr("rx");i>=p.x+a+o+e&&(e=i-p.x-o),r>=p.y+o+a+n&&(n=i-p.y-o),h.x+o+e+i>=Vi&&(e=Vi-i-h.x-o),h.y+o+n+r>=Yi&&(n=Yi-h.y-o-r);var s=parseInt(g.data("curr_cx"),10),l=parseInt(g.data("curr_cy"),10),c=s+e,f=l+n;g.attr({cx:c,cy:f});var y=parseInt(m.data("curr_cx"),10),b=parseInt(m.data("curr_cy"),10);c=y+e,f=b+n,m.attr({cx:c,cy:f});var x=parseInt(v.data("curr_cx"),10),T=parseInt(v.data("curr_cy"),10);c=x+e,f=T+n,v.attr({cx:c,cy:f});var w,k;"ellipse"==t.data("type")?(w=parseInt(this.data("currx"),10)+this.attr("rx"),k=parseInt(this.data("curry"),10)+this.attr("ry")):"rect"==t.data("type")&&(w=parseInt(this.data("currx"),10),k=parseInt(this.data("curry"),10)),c=w+e,f=k+n,this.attr({x:c,y:f,cx:c,cy:f})},function(){u=!1;var e=t.getBBox();d.x=e.x,d.y=e.y,d.w=e.width,d.h=e.height,e=g.getBBox(),h.x=e.x,h.y=e.y,h.w=e.width,h.h=e.height,e=m.getBBox(),p.x=e.x,p.y=e.y,p.w=e.width,p.h=e.height,e=v.getBBox(),f.x=e.x,f.y=e.y,f.w=e.width,f.h=e.height},function(){if(u){var e=g.getBBox().x,n=g.getBBox().y,i=g.getBBox().width,r=g.getBBox().height;g.data("curr_cx",e+i/2),g.data("curr_cy",n+r/2);var a=m.getBBox().x,o=m.getBBox().y,s=m.getBBox().width,l=m.getBBox().height;m.data("curr_cx",a+s/2),m.data("curr_cy",o+l/2),"ellipse"==t.data("type")?(t.data("currx",t.attr("cx")-t.attr("rx")),t.data("curry",t.attr("cy")-t.attr("ry")),t.data("curr_rx",t.attr("rx")),t.data("curr_ry",t.attr("ry"))):"rect"==t.data("type")&&(t.data("currx",t.attr("x")),t.data("curry",t.attr("y")));var c=t.getBBox().x,y=t.getBBox().y,b=t.getBBox().width,x=t.getBBox().height,T=v.getBBox().x,w=v.getBBox().y,k=v.getBBox().width,A=v.getBBox().height,_=d.x,C=d.y,E=d.w,S=d.h,M=h.x,I=h.y,D=h.w,P=h.h,$=p.x,N=p.y,G=p.w,O=p.h,L=f.x,F=f.y,B=f.w,R=f.h,H=TAG.TourAuthoring.Command({execute:function(){t.data("currx",c),t.data("curry",y),t.data("currw",b),t.data("currh",x),t.data("curr_rx",b/2),t.data("curr_ry",x/2),t.attr({cx:c+b/2,cy:y+x/2,rx:b/2,ry:x/2,x:c,y:y,width:b,height:x}),g.data("curr_cx",e+i/2),g.data("curr_cy",n+r/2),g.attr({cx:e+i/2,cy:n+r/2,rx:i/2,ry:r/2}),m.data("curr_cx",a+s/2),m.data("curr_cy",o+l/2),m.attr({cx:a+s/2,cy:o+l/2,rx:s/2,ry:l/2}),v.data("curr_cx",T+k/2),v.data("curr_cy",w+A/2),v.attr({cx:T+k/2,cy:w+A/2,rx:k/2,ry:A/2})},unexecute:function(){t.data("currx",_),t.data("curry",C),t.data("currw",E),t.data("currh",S),t.data("curr_rx",E/2),t.data("curr_ry",S/2),t.attr({cx:_+E/2,cy:C+S/2,rx:E/2,ry:S/2,x:_,y:C,width:E,height:S}),g.data("curr_cx",M+D/2),g.data("curr_cy",I+P/2),g.attr({cx:M+D/2,cy:I+P/2}),m.data("curr_cx",$+G/2),m.data("curr_cy",N+O/2),m.attr({cx:$+G/2,cy:N+O/2}),v.data("curr_cx",L+B/2),v.data("curr_cy",F+R/2),v.attr({cx:L+B/2,cy:F+R/2})}});H.execute(),di.logCommand(H)}}),v.mousedown(function(){var e=TAG.TourAuthoring.Command({execute:function(){t.hide(),g.hide(),m.hide(),v.hide(),t.data("visible","no")},unexecute:function(){t.show(),g.show(),m.show(),v.show(),t.data("visible","yes")}});e.execute(),di.logCommand(e)})}function s(){return di}function l(t,e,n,i){var r;ce(TAG.TourAuthoring.InkMode.shapes),void 0===t&&(t=100+10*Math.random()),void 0===e&&(e=100+10*Math.random()),void 0===n&&(n=50),void 0===i&&(i=50),r=Cn.ellipse(t,e,n,i),r.data("currx",r.getBBox().x),r.data("curry",r.getBBox().y),r.data("curr_rx",n),r.data("curr_ry",i),r.data("type","ellipse"),o(r)}function c(t,e,n){var i,r,a,o=t.rc,s=0,l=0,c=An.width(),u=An.height();void 0===e&&(e=Un),void 0===n&&(n=zn),o.mouseover(function(){l||3!=ai||(i=o.glow({width:10,color:"#33ff00",opacity:.8}))}),o.mouseout(function(){3==ai&&i.remove()}),o.attr({"stroke-width":0,stroke:"#222222",fill:"#ffffff","fill-opacity":0}),o.data("surr-fill",e),o.data("surr-opac",n);var d=Cn.set();d.push(t.rn,t.re,t.rs,t.rw),d.attr({"stroke-width":0,stroke:"#222222",fill:e,"fill-opacity":n}),o.drag(function(e,n,i,o){if(3==ai){this.toFront();var l=this.getBBox();if(s)this.attr({width:l.width+i-r,height:l.height+o-a}),t.rs.attr({y:l.y+l.height+o-a,height:u-(l.y+l.height+o-a)}),t.re.attr({x:l.x+l.width+i-r,width:c-(l.x+l.width+i-r),height:l.height+o-a}),t.rw.attr({height:l.height+o-a});else{var d=parseInt(this.data("currx"),10),h=parseInt(this.data("curry"),10),p=d+e,f=h+n;this.attr({x:p,y:f}),t.rn.attr({height:f}),t.re.attr({x:p+l.width,y:f,width:c-(p+l.width),height:l.height}),t.rs.attr({y:f+l.height,height:u-(f+l.height)}),t.rw.attr({y:f,width:p,height:l.height})}r=i,a=o}},function(t,e){if(3==ai){r=t,a=e;var n=this.getBBox();parseFloat(An.css("left")),parseFloat(An.css("top")),arguments[2].offsetX>n.x+.5*n.width&&arguments[2].offsetY>n.y+.5*n.height&&(s=1),i.remove(),l=1,this.animate({opacity:.25},500,"<>")}},function(){3==ai&&(this.data("currx",this.getBBox().x),this.data("curry",this.getBBox().y),t.re.data("currx",this.getBBox().x+this.getBBox().width),t.rs.data("curry",this.getBBox().y+this.getBBox().height),s=0,this.animate({opacity:1},500,"<>"),l=0)})}function u(t,e){var n;ce(TAG.TourAuthoring.InkMode.shapes),void 0===t&&(t=200+10*Math.random()),void 0===e&&(e=200+10*Math.random()),n=Cn.rect(t,e,100,100),n.data("currx",t),n.data("curry",e),n.data("currw",100),n.data("currh",100),n.data("type","rect"),o(n)}function d(){return En}function h(t,e,n,i,r,a,o){if(t=t||75,e=e||75,r=r||"Your text here",En=Cn.text(t,e,r),En.data({type:"text",str:r}),En.attr({"alignment-baseline":"before-edge","text-anchor":"start"}),ce(TAG.TourAuthoring.InkMode.text),En.attr({"font-family":Xn,"font-size":Zn,fill:Kn}),En.attr("text",r),En.data({font:Xn,fontsize:Zn,color:Kn}),a){var s;s=o?o:Q(En.data("fontsize"),An.height())*An.height(),En.attr({"font-size":s}),En.data({fontsize:s})}pe(En)}function p(t){var e,n,i,r,a=t.x,o=t.y,s=t.width,l=t.height;if(e=bi/si.w,n=e*(l/s),i=-si.x*e,r=-si.y*e,W({x:a,y:o,w:s,h:l},{x:_i,y:Ci,w:Ei,h:Si})){var c=bi/e,u=xi/n,d=s*c,h=l*u,p=d/bi*(vi-i)+a,f=h/xi*(yi-r)+o,g=d/Di;if(ui=s/ki,Wn.length&&"block"!==jn){var m=An.width(),v=An.height();Ni=m,Gi=v,V(-Mi/bi,-Ii/xi,{cw:m,ch:v},0),ee(g,g),V(p/bi,f/xi,{cw:m,ch:v},1)}else{var y=bi/ui,b=xi/ui;Cn.setViewBox(-p/ui,-f/ui,y,b)}Mi=p,Ii=f,Di=d,Pi=h,_i=a,Ci=o,Ei=s,Si=l}}function f(t,e){var n,i,r,a,o=t.x,s=t.y,l=t.width,c=t.height;try{n=bi/si.w,i=n*(c/l),r=-si.x*n,a=-si.y*n}catch(u){console.log("ERROR in adjustViewBox: "+u),r=Ti,a=wi,n=ki,i=Ai}if(0===$i&&(self.origpx=o,self.origpy=s,self.origpw=l,self.origph=c),W({x:o,y:s,w:l,h:c},{x:_i,y:Ci,w:Ei,h:Si})){var d=$("[ES_ID='"+ci+"']"),h=bi/n,p=xi/i,f=l*h,g=c*p,m=f/bi*(vi-r)+o,v=g/xi*(yi-a)+s,y=f/Di,b=g/Pi,x=An.width(),T=An.height();V(-Mi/bi,-Ii/xi,{cw:x,ch:T},0),ee(y,b),V(m/bi,v/xi,{cw:x,ch:T},1),Mi=m,Ii=v,Di=f,Pi=g,_i=o,Ci=s,Ei=l,Si=c;var w;try{w=parseInt(e||d[0].style.opacity,10)}catch(u){console.log("error in adjustViewBox: "+u)}$i=w}}function g(t){for(var e,n="",i=Raphael.parsePathString(t),r=[],a=ei.width(),o=ei.height(),s=i.length-2;s>=0;s--)if("z"==i[s][0]){for(n+="M"+r[0]+","+r[1],e=2;r.length>e;e++)n+=2==e%6?"C"+r[e]:r[e],n+=1!=e%6?",":"";n+="z",r.length=0,r=[]}else"M"==i[s][0]?(r.push(i[s][1]),r.push(i[s][2])):(r.push(i[s][5]),r.push(i[s][6]),r.push(i[s][3]),r.push(i[s][4]),r.push(i[s][1]),r.push(i[s][2]));for(n+="M"+r[0]+","+r[1],e=2;r.length>e;e++)n+=2==e%6?"C"+r[e]:r[e],n+=1!=e%6?",":"";return n+="z",n+="M-5,-5L"+(a+5)+",-5L"+(a+5)+","+(o+5)+"L-5,"+(o+5)+"L-5,-5z"}function m(t,e){function n(t,e){return t.t1-e.t1}function i(t,e){return t.t2-e.t2}var r,a,o,s,l,c=[],u=0;if(""===e)return t;var d=Raphael.parsePathString(t);for(r=0;d.length>r;r++)"z"==d[r][0]&&(d.splice(r,1),r--);var h=Raphael.parsePathString(e),p=0;for(r=0;h.length>r;r++)"z"==h[r][0]&&(h.splice(r,1),r--,p++);var f=[];for(r=0;d.length-1>r;r++)o=d[r],s=d[(r+1)%d.length],l=o.length,f.push({x:o[l-2],y:o[l-1],ax1:s[1],ay1:s[2],ax2:s[3],ay2:s[4]});var g=[];for(r=0;h.length-1>r;r++){o=h[(r+1)%h.length];var m=0!==(r+2)%h.length?(r+2)%h.length:1;s=h[m],l=o.length,g.push({x:o[l-2],y:o[l-1],ax1:s[1],ay1:s[2],ax2:s[3],ay2:s[4]})}var v=0;for(r=0;f.length>r;r++)for(a=0;g.length>a;a++)if(ie(f[r],g[a])){f[r].x+=1,f[r].y+=1,f[r].ax1+=1,f[r].ay1+=1,f[r].ax2+=1,f[r].ay2+=1,v=1;break}if(v){t="M"+f[0].x+","+f[0].y;var y;for(r=1;f.length>r;r++){y=f[r];var b=f[r-1];t+="C"+b.ax1+","+b.ay1+","+b.ax2+","+b.ay2+","+y.x+","+y.y}for(t+="C"+y.ax1+","+y.ay1+","+y.ax2+","+y.ay2+","+f[0].x+","+f[0].y,t+="z",d=Raphael.parsePathString(t),r=0;d.length>r;r++)"z"==d[r][0]&&(d.splice(r,1),r--)}var x=Raphael.pathIntersection(t,e),T=[[],[],[],[]];for(r=0;x.length>r;r++)T[x[r].segment1-1].push(x[r]);for(r=0;T.length>r;r++)T[r].sort(n);var w=[];for(r=0;h.length-p>r;r++)w.push([]);for(r=0;x.length>r;r++)w[x[r].segment2-1].push(x[r]);for(r=0;w.length>r;r++)w[r].sort(i);var k="";if(0===x.length)return Z(t,g[0].x,g[0].y)?"isolate"===jn?e:t:Z(e,f[0].x,f[1].y)?"isolate"===jn?t:e:t+e;for(r=0;T.length>r;r++){Z(e,f[r].x,f[r].y)||J(f[r],c)||(0===r&&(u=1),c.push({point:f[r],type:"endpoint",path:0}));var A=T[r];for(a=0;A.length>a;a++){J(A[a],c)||c.push({point:A[a],type:"intpoint",path:c.length?c[c.length-1].type:0});for(var _=A[a].segment2-1,C=_,E=C;!Z(t,g[E].x,g[E].y)&&!J(g,c);){var S=g[E],M=1,I=1;if(E==_){for(var D=0;w[E].length>D;D++)if(w[E][D].t2>A[a].t2){M=0;break}}else w[E].length>0&&(I=0);if(!M||!I||J(S,c))break;c.push({point:g[E],type:"endpoint",path:1}),C++,E=C%w.length}}}Z(e,f[0].x,f[0].y)||c.push({point:f[0],type:"endpoint",path:0}),ie(c[c.length-1].point,c[0].point)||c.push(c[0]);var P,$=[];for(r=0;c.length-1>r;r++){P=c[r];var N=c[(r+1)%c.length],G=q(P,N),O=j(P,N);$.push({ax1:G.x,ay1:G.y,ax2:O.x,ay2:O.y,x:N.point.x,y:N.point.y})}for(k="M"+$[$.length-1].x+","+$[$.length-1].y,r=0;$.length>r;r++)P=$[r],k+="C"+P.ax1+","+P.ay1+","+P.ax2+","+P.ay2+","+P.x+","+P.y;return k+="z"}function v(){var t,e=ei.width(),n=ei.height(),i="",r="",a=Gn.length;for(t=0;a>t;t++)Gn[t].remove();for(Gn.length=0,t=0;Pn.length>t;t++)"M"===Pn[t]&&(i+="PATH::[pathstring]",r+="PATH::[pathstring]"),i+=Pn[t]+e*$n[t][0]+","+n*$n[t][1],r+=Pn[t]+$n[t][0]+","+$n[t][1],"L"!=Pn[t+1]&&(i+="[stroke]"+Nn[t].color+"[strokeo]"+Nn[t].opacity+"[strokew]"+n*Nn[t].width+"[]|",r+="[stroke]"+Nn[t].color+"[strokeo]"+Nn[t].opacity+"[strokew]"+Nn[t].width+"[]|");var o=[];for(i.length>0&&(o=i.split("PATH::")),t=1;o.length>t;t++){var s=x(o[t],"pathstring","s"),l=x(o[t],"stroke","s"),c=x(o[t],"strokeo","f"),u=x(o[t],"strokew","f"),d=Cn.path(s);d.data("type","path"),d.attr({"stroke-width":u,"stroke-opacity":c,stroke:l,"stroke-linejoin":"round","stroke-linecap":"round"}),Gn.push(d)}On=r}function y(){te();for(var t=An.width(),e=An.height(),n="",i=0,r=0;qn.length>r;r++)if("M"==qn[r]||"L"==qn[r])n+=qn[r]+Wn[i]*t+","+Wn[i+1]*e,i+=2;else if("C"==qn[r]){n+="C"+Wn[i]*t;for(var a=1;6>a;a++)n+=","+(a%2?Wn[i+a]*e:Wn[i+a]*t);i+=6}else"z"==qn[r]?n+="z":console.log("ELSE: "+qn[r]);var o=n;"isolate"==jn&&(o=g(n)),Cn.path(o).attr({fill:Un,"fill-opacity":zn,"stroke-width":0}).data("type","trans"),Vn="TRANS::[path]"+n+"[color]"+Un+"[opac]"+zn+"[mode]"+jn+"[]",ve()}function b(t){for(var e=An.width(),n=An.height(),i=Dn,r=0;$n.length>r;r++)t[0]-i<=e*$n[r][0]&&e*$n[r][0]<=t[0]+i&&t[1]-i<=n*$n[r][1]&&n*$n[r][1]<=t[1]+i&&("L"===Pn[r+1]&&(Pn[r+1]="M"),Pn.splice(r,1),$n.splice(r,1),Nn.splice(r,1));for(var a=!1,o=0;Pn.length>o;o++)if("L"===Pn[o]){a=!0;break}a||($n.length=0,Pn.length=0,Nn.length=0),v()}function x(t,e,n){return"f"===n?parseFloat(t.split("["+e+"]")[1].split("[")[0]):"s"===n?t.split("["+e+"]")[1].split("[")[0]:parseInt(t.split("["+e+"]")[1].split("[")[0],10)}function T(t,e){var n=ri.split("["+t+"]"),i=n[1].split("]");i.splice(0,1),i[0]="[color]"+i[0];var r=i.join("]");ri=n[0]+"[fontsize]"+e+r}function w(){return Yn}function k(){return ri}function A(t){for(var e=An.width(),n=An.height(),i="",r=0;t.length>r;r++)t[r]=me(t[r],e,n),t[r]="z"===t[r][t[r].length-1]?t[r]:t[r]+"z";for(;t.length;){var a=t[0];if(t.splice(0,1),t.length)for(var o=Raphael.parsePathString(a),s=0;t.length>s;s++){var l=Raphael.parsePathString(t[s]);(Raphael.pathIntersection(a,t[s]).length||Z(a,l[0][1],l[0][2])||Z(t[s],o[0][1],o[0][2]))&&(a=m(t[s],a),t.splice(s,1),s=-1)}i+=a}U(i)}function _(t,e,n){return{x:t.x/e,y:t.y/n,w:t.w/e,h:t.h/n}}function C(){return An.find("svg")[0]}function E(){var t=ve(),e=[],n=An.width(),i=An.height();if(""!==t){for(var r=t.split("|"),o=0;r.length>o;o++){var s=r[o],l=s.split("::")[0];switch(l=l.toLowerCase()){case"lrect":case"mrect":case"rect":var c=a(x(s,"x","f"),n),u=a(x(s,"y","f"),i),d=a(x(s,"w","f"),n),h=a(x(s,"h","f"),i),p={X:c,Y:u,w:d,h:h,type:"rect"};Yn+="BOUNDRECT::[x]"+c/n+"[y]"+u/i+"[w]"+d/n+"[h]"+h/i+"[fillc]#000000[fillo]0[strokec]"+x(s,"strokec","s")+"[strokeo]"+x(s,"strokeo","f")+"[strokew]"+x(s,"strokew","f")+"[]|",e.push(p);break;case"lellipse":case"mellipse":case"ellipse":var f=a(x(s,"cx","f"),n),g=a(x(s,"cy","f"),i),m=a(x(s,"rx","f"),n),v=a(x(s,"ry","f"),i),y={cx:f,cy:g,rx:m,ry:v,type:"ellipse"};Yn+="BOUNDELLIPSE::[cx]"+f/n+"[cy]"+g/i+"[rx]"+m/n+"[ry]"+v/i+"[fillc]#000000[fillo]0[strokec]"+x(s,"strokec","s")+"[strokeo]"+x(s,"strokeo","f")+"[strokew]"+x(s,"strokew","f")+"[]|",e.push(y)}}fe(e)}}function S(){return""===$("#"+Jn).attr("value")}function M(t){if(!zi&&""===t)return!0;var e=t.split("::")[0].toLowerCase(),n=!1;switch(e){case"trans":""===t.split("[path]")[1].split("[")[0]&&(n=!0);break;case"bezier":case"path":zi||""!==t.split("[pathstring]")[1].split("[")[0]||(n=!0);break;case"text":""===t.split("[str]")[1].split("[")[0]&&(n=!0);break;default:}return n}function I(t){fi.hideEditorOverlay();var e=TAG.Util.UI.popUpMessage(null,t,null);$(e).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3),$("body").append(e),$(e).fadeIn(500)}function D(t){var e=gi.getCurrentTime(),n=t.getStorageContainer().displays.nearestNeighbors(e,1)[0];return n?!0:!1}function P(){_n||(_n=fi.dataHolder);var t=_n.getSelectedTrack();if(!t||t.getType()!==TAG.TourAuthoring.TrackType.artwork&&t.getType()!==TAG.TourAuthoring.TrackType.image)return I("There is no artwork or image track selected. Please select a valid track or create an unlinked ink."),!1;if(S())return I("Unable to attach an empty ink. Please add to ink component before attaching."),!1;var e=D(t);if(!e)return I("Please move the playhead within the currently selected track's display."),!1;var n=mi.captureKeyframe(t.getTitle());return n?(re(),L()):(I("The track selected must be fully on screen in order to attach an ink. Please seek to a location where the track is visible."),!1)}function N(){return S()?(I("Unable to attach an empty ink. Please add to ink component before attaching."),!1):F()?!0:!1}function G(){_n||(_n=fi.dataHolder);var t=_n.getSelectedTrack();if(!t||t.getType()!==TAG.TourAuthoring.TrackType.artwork&&t.getType()!==TAG.TourAuthoring.TrackType.image)return I("There is no artwork or image track selected. Please select a valid track or create an unlinked ink."),!1;var e=D(t);if(!e)return I("Please move the playhead within the currently selected track's display."),!1;var n=mi.captureKeyframe(t.getTitle());return n?(E(),L()):(I("The track selected must be fully on screen in order to attach an ink. Please seek to a location where the track is visible."),!1)}function O(){return M(ve())?(I("Unable to attach an empty ink. Please add to ink component before attaching."),!1):(E(),F(),!0)}function L(){_n||(_n=fi.dataHolder);var t=_n.getSelectedTrack();if(!t||t.getType()!==TAG.TourAuthoring.TrackType.artwork&&t.getType()!==TAG.TourAuthoring.TrackType.image)return I("There is no artwork or image track selected. Please select a valid track or create an unlinked ink."),!1;if(M(ve()))return I("Unable to attach an empty ink. Please add to ink component before attaching."),!1;var e=D(t);if(!e)return I("Please move the playhead within the currently selected track's display."),!1;li=t.getTitle();var n=An.width(),i=An.height();Ni=n,Gi=i;var r=$("[data-proxy='"+escape(li)+"']"),a={x:r.data("x"),y:r.data("y"),w:r.data("w"),h:r.data("h")},o=ve(),s=mi.captureKeyframe(li);if(!s)return I("The track selected must be fully on screen in order to attach an ink. Please seek to a location where the track is visible."),!1;var l,c,u,d,h=t.getType();if(h===TAG.TourAuthoring.TrackType.artwork)l=s.state.viewport.region.center.x,c=s.state.viewport.region.center.y,u=s.state.viewport.region.span.x,d=s.state.viewport.region.span.y;else if(h===TAG.TourAuthoring.TrackType.image){u=1/s.state.viewport.region.span.x;var p=s.state.viewport.region.span.x*An.width();d=s.state.viewport.region.span.y,l=-s.state.viewport.region.center.x*u,c=-(An.height()/p)*s.state.viewport.region.center.y}var f=o.split("::")[0].toLowerCase();ti=fi.addInkTrack(t,"Ink "+decodeURI(t.getTitle()),f),ti.setInkLink(t),"trans"===f&&(o+=Yn),ti.setInkPath(o),ti.setInkProps({}),ti.setInkInitKeyframe({x:l,y:c,w:u,h:d}),ti.setInkEnabled(!0),ti.setInkType(f),ti.setInkRelativeArtPos(_(a,n,i)),ti.addInkTypeToTitle(f),oi=!0,An.remove();var g=gi.getCurrentTime(),m=t.getStorageContainer().displays.nearestNeighbors(g,1)[0].display,v=m.getEnd(),y=ti.addDisplay(gi.getCurrentPx(),Math.min(5,v-g));return m.addChildDisplay(y),y.setParentDisplay(m),t.addAttachedInkTrack(ti),ti.setInkLink(t),pi.combineLast(2),_n._trackArray.length>0&&_n._trackArray[0].track.leftAndRight({translation:{x:0}},!1),!0}function F(){function t(){e.fadeOut(200)}var e=$(TAG.Util.UI.blockInteractionOverlay()),n=$(document.createElement("div"));if(M(ve())){n.attr("id","inkEmptyDialog"),n.css({display:"none",position:"fixed",top:"40%",left:"30%",width:"auto","background-color":"black",border:"3px double white","z-index":TAG.TourAuthoring.aboveRinZIndex+5,"text-align":"center",padding:"1.5% 1.5% 2% 2%"}),e.append(n),$("body").append(e),e.fadeIn(100);var i=$(document.createElement("div"));i.text("Unable to attach an empty ink. Please add to ink component before attaching."),i.css("font-size","1.25em","text-align","left"),n.append(i);var r=$(document.createElement("div"));r.css("text-align","center");var a=$(document.createElement("button"));return a.text("OK"),a.css({width:"auto","background-color":"black",border:"1px solid white","margin-top":"25px"}),r.append(a),n.append(r),n.show(),TAG.Util.makeManipulatable(a[0],{onTapped:t},!1),!1}ti=fi.addInkTrack(null,"Unattached Ink",1),ti.setInkLink(null);var o=ve(),s=o.split("::")[0].toLowerCase();return"trans"==s&&(o+=Yn),ti.setInkPath(o),ti.setInkEnabled(!1),ti.setInkSize(Zn),ti.setInkInitKeyframe({}),ti.setInkRelativeArtPos({}),ti.addInkTypeToTitle(s),oi=!1,An.remove(),ti.addDisplay(Math.min(gi.timeToPx(gi.getDuration().end-.5),gi.getCurrentPx()),Math.min(5,Math.max(.5,gi.getDuration().end-gi.getCurrentTime()))),pi.combineLast(2),fi.getTracks().length>0&&fi.getTracks()[0].leftAndRight({translation:{x:0}},!1),!0}function B(){return kn}function R(){return Gi}function H(t){var e,n=t.split("|"),i=An.width(),r=An.height();Ni=i,Gi=r,zi="";var s=n.length;for(e=0;s>e;e++){var l,c,u,d,h,p,f,g,m,b=n[e];if(b&&""!==b){var T=b.split("::")[0];switch(T.toLowerCase()){case"text":var w=x(b,"fontsize","f")*r;Zn=w,l=x(b,"x","f")*i,c=x(b,"y","f")*r;try{u=x(b,"w","f"),d=x(b,"h","f")}catch(k){u=null,d=null}var A=x(b,"color","s"),_=x(b,"font","s"),C=x(b,"str","s"),E=Cn.text(l,c,C);E.attr({"font-family":_,"font-size":w+"px",fill:A,"text-anchor":"start"}),E.data({x:l,y:c,w:u,h:d,fontsize:w,color:A,font:_,type:"text",str:C}),kn=E;break;case"path":On||(On=""),On+=b+"|",ye(b+"|");break;case"bezier":zi+=x(b,"pathstring","s"),Nn.push({color:x(b,"stroke","s"),opacity:x(b,"strokeo","f"),width:x(b,"strokew","f")});break;case"trans":Vn||(Vn=""),Vn+=b+"|";var S=x(b,"path","s");Un=x(b,"color","s"),zn=x(b,"opac","f"),jn=x(b,"mode","s"),Wn=S.match(/[0-9.\-]+/g),qn=S.match(/[CMLz]/g),y();break;case"rect":l=a(x(b,"x","f"),i),c=a(x(b,"y","f"),r),u=a(x(b,"w","f"),i),d=a(x(b,"h","f"),r),h=x(b,"fillc","s"),p=x(b,"fillo","f"),f=x(b,"strokec","s"),g=x(b,"strokeo","f"),m=x(b,"strokew","f");var M=Cn.rect(l,c,u,d);M.data("currx",l),M.data("curry",c),M.data("currw",u),M.data("currh",d),M.data("type","rect"),M.data("visible","yes"),o(M,h,p,f,g,m);break;case"ellipse":var I=a(x(b,"cx","f"),i),D=a(x(b,"cy","f"),r),P=a(x(b,"rx","f"),i),$=a(x(b,"ry","f"),r);h=x(b,"fillc","s"),p=x(b,"fillo","f"),f=x(b,"strokec","s"),g=x(b,"strokeo","f"),m=x(b,"strokew","f");var N=Cn.ellipse(I,D,P,$);N.data("currx",N.getBBox().x),N.data("curry",N.getBBox().y),N.data("curr_rx",P),N.data("curr_ry",$),N.data("type","ellipse"),N.data("visible","yes"),o(N,h,p,f,g,m);break;case"marquee":var G=a(x(b,"x","f"),i),O=a(x(b,"y","f"),r);u=a(x(b,"w","f"),i),d=a(x(b,"h","f"),r),x(b,"surrfillc","s"),x(b,"surrfillo","f");var L=G+u,F=O+d,B=Cn.rect(0,0,i,O);B.data("currx",0),B.data("curry",0);var R=Cn.rect(L,O,i-L,F-O);R.data("currx",L),R.data("curry",O);var H=Cn.rect(0,F,i,r-F);H.data("currx",0),H.data("curry",F);var U=Cn.rect(0,O,G,F-O);U.data("currx",0),U.data("curry",O);var z=Cn.rect(G,O,L-G,F-O);z.data("currx",G),z.data("curry",O),z.data("type","marquee")}}}v(),zi&&yn(),oi&&Cn.setViewBox(0,0,i,r)}function U(t){var e=An.width(),n=An.height(),i=Cn.path(t).attr({"fill-opacity":zn,fill:Un,"stroke-opacity":0,stroke:"#888888","stroke-width":0});i.data("type","trans"),Vn="TRANS::[path]"+me(t,1/e,1/n)+"[color]"+Un+"[opac]"+zn+"[mode]"+jn+"[]|",ve()}function z(t){var e,n=t.split("|"),i=An.width(),r=An.height();for(e=0;n.length>e;e++){var s,l,c,u,d,h=n[e];if(h&&""!==h){var p=h.split("::")[0];switch(p=p.toLowerCase()){case"boundrect":var f=a(x(h,"x","f"),i),g=a(x(h,"y","f"),r),m=a(x(h,"w","f"),i),v=a(x(h,"h","f"),r);s=x(h,"fillc","s"),l=x(h,"fillo","f"),c=x(h,"strokec","s"),u=x(h,"strokeo","f"),d=x(h,"strokew","f");var y=Cn.rect(f,g,m,v);y.data("currx",f),y.data("curry",g),y.data("currw",m),y.data("currh",v),y.data("type","rect"),y.data("visible","yes"),o(y,s,l,c,u,d);break;case"boundellipse":var b=a(x(h,"cx","f"),i),T=a(x(h,"cy","f"),r),w=a(x(h,"rx","f"),i),k=a(x(h,"ry","f"),r);s=x(h,"fillc","s"),l=x(h,"fillo","f"),c=x(h,"strokec","s"),u=x(h,"strokeo","f"),d=x(h,"strokew","f");var A=Cn.ellipse(b,T,w,k);A.data("currx",A.getBBox().x),A.data("curry",A.getBBox().y),A.data("curr_rx",w),A.data("curr_ry",k),A.data("type","ellipse"),A.data("visible","yes"),o(A,s,l,c,u,d)}}}}function j(t,e){var n,i,r;return"endpoint"==t.type?"endpoint"==e.type?{x:t.point.ax2,y:t.point.ay2}:(n=0===t.path?e.point.bez1:e.point.bez2,i=0===t.path?e.point.t1:e.point.t2,r=Raphael.findDotsAtSegment(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],i),{x:r.m.x,y:r.m.y}):"endpoint"===e.type?(n=0===e.path?t.point.bez1:t.point.bez2,{x:n[4],y:n[5]}):(n=0===e.path?e.point.bez1:e.point.bez2,i=0===e.path?e.point.t1:e.point.t2,r=Raphael.findDotsAtSegment(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],i),{x:r.n.x,y:r.n.y})}function W(t,e){return Math.abs(t.x-e.x)>1e-8||Math.abs(t.y-e.y)>1e-8||Math.abs(t.w-e.w)>1e-8||Math.abs(t.h-e.h)>1e-8}function q(t,e){if("endpoint"===t.type)return{x:t.point.ax1,y:t.point.ay1};var n=0===e.path?t.point.bez1:t.point.bez2,i=0===e.path?t.point.t1:t.point.t2,r=Raphael.findDotsAtSegment(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],i);return{x:r.n.x,y:r.n.y}}function V(t,e,n,i){var r,a=n.cw,o=n.ch;Cn.forEach(function(n){var i=n.data("type");"path"!=i&&"bezier"!=i&&"text"!=i&&"trans"!=i?(n.attr({x:parseFloat(n.attr("x"))+t*a,y:parseFloat(n.attr("y"))+e*o,cx:parseFloat(n.attr("cx"))+t*a,cy:parseFloat(n.attr("cy"))+e*o}),"ellipse"==i?(n.data("currx",parseFloat(n.attr("cx"))-parseFloat(n.attr("rx"))),n.data("curry",parseFloat(n.attr("cy"))-parseFloat(n.attr("ry"))),n.data("curr_rx",n.attr("rx")),n.data("curr_ry",n.attr("ry"))):(n.data("currx",n.attr("x")),n.data("curry",n.attr("y")))):"text"==i&&(n.attr({x:parseFloat(n.attr("x"))+t*a,y:parseFloat(n.attr("y"))+e*o}),n.data("x",parseFloat(n.data("x"))+t*a),n.data("y",parseFloat(n.data("y"))+e*o),Oi=n.attr("x"),Li=n.attr("y"))});var s=$n.length;for(r=0;s>r;r++)$n[r][0]=$n[r][0]+t,$n[r][1]=$n[r][1]+e;var l,c;for(l=dn(zi),c=hn(zi),r=0;l.length>r;r+=2)l[r]+=t,l[r+1]+=e;zi=pn(c,l);var u=Wn.length;for(r=0;u>r;r++)Wn[r]+=r%2?e:t;if(s&&i&&v(),u&&i&&y(),zi&&i&&yn(),!s&&!u&&i){var d=ve();te(),ri=d,H(ri)}}function Y(){var t={x:Oi,y:Li};return t}function X(t,e,n){n?Cn.forEach(function(n){n.transform("t"+(t+n.data("bboxcenterx"))+","+(e+n.data("bboxcentery"))+"...")
}):Cn.forEach(function(t){t.transform("t-"+t.data("bboxcenterx")+",-"+t.data("bboxcentery")+"...")})}function K(t,e){Cn.forEach(function(n){var i=n.getBBox();n.transform("s"+t+"..."),n.transform("t"+-n.getBBox().x+","+-n.getBBox().y+"..."),n.transform("t"+i.x*t+","+i.y*e+"...")})}function Z(t,e,n){var i=Raphael.isPointInsidePath(t,e,n),r=Raphael.isPointInsidePath(t,e-1,n-1),a=Raphael.isPointInsidePath(t,e+1,n-1),o=Raphael.isPointInsidePath(t,e-1,n+1),s=Raphael.isPointInsidePath(t,e+1,n+1);return i||r+a+o+s>=2?1:0}function Q(t,e){return parseFloat(t)/parseFloat(e)}function J(t,e){for(var n=0;e.length-1>n;n++)if(ie(e[n].point,t))return 1;return 0}function te(){Cn.clear(),Pn.length=0,$n.length=0,Nn.length=0,Gn.length=0,ni.length=0,On="",ri=""}function ee(t,e,n){Cn.forEach(function(n){var i=n.data("type");"path"!==i&&"bezier"!==i&&"text"!==i&&"trans"!==i&&"grabHandle"!==i?(n.attr({x:parseFloat(n.attr("x"))*t,y:parseFloat(n.attr("y"))*e,cx:parseFloat(n.attr("cx"))*t,cy:parseFloat(n.attr("cy"))*e,rx:parseFloat(n.attr("rx"))*t,ry:parseFloat(n.attr("ry"))*e,width:parseFloat(n.attr("width"))*t,height:parseFloat(n.attr("height"))*e}),"ellipse"===i?(n.data("currx",parseFloat(n.attr("cx"))-parseFloat(n.attr("rx"))),n.data("curry",parseFloat(n.attr("cy"))-parseFloat(n.attr("ry"))),n.data("curr_rx",parseFloat(n.attr("rx"))),n.data("curr_ry",parseFloat(n.attr("ry")))):(n.data("currx",n.attr("x")),n.data("curry",n.attr("y")))):"text"===i&&(n.attr({"font-size":parseFloat(n.attr("font-size"))*e,x:n.attr("x")*t,y:n.attr("y")*e}),n.data({fontsize:n.data("fontsize")*e,x:n.data("x")*t,y:n.data("y")*e}))});var i,r=$n.length;for(i=0;r>i;i++)$n[i][0]=$n[i][0]*t,$n[i][1]=$n[i][1]*e,Nn[i].width=Nn[i].width*t;var a,o;for(a=dn(zi),o=hn(zi),i=0;a.length>i;i+=2)a[i]*=t,a[i+1]*=e;for(i=0;Nn.length>i;i++)Nn[i].width=Nn[i].width*t;zi=pn(o,a);var s=Wn.length;for(i=0;s>i;i++)Wn[i]*=i%2?e:t;if(r&&n&&v(),s&&n&&y(),zi&&n&&yn(),!r&&!s&&n){var l=ve();te(),ri=l,H(ri)}}function ne(){var t=$("[data-proxy='"+escape(li)+"']"),e=si.x,n=si.y,i=si.w,r=bi/i,a=r*(t.data("h")/t.data("w")),o=-e*r,s=-n*a;Ti=o,wi=s,ki=r,Ai=a,_i=Ti,Ci=wi,Ei=ki,Si=Ai}function ie(t,e,n){return void 0===n&&(n=1e-5),n>Math.abs(t.x-e.x)&&n>Math.abs(t.y-e.y)}function re(){var t=En.left,e=En.top,n=Cn.text(t,e,str);n.attr("text-anchor","start");var i=n.attr("x"),r=n.attr("y"),a=n.getBBox();n.data({x:i+parseFloat(textboxelmt.css("padding-left")),y:r+a.height+parseFloat(textboxelmt.css("padding-top")),font:Xn,fontsize:Zn,color:Kn,str:str,type:"text"}),ve()}function ae(t){li=t}function oe(){var t=C();t.style.background="rgba(0, 0, 0, 0)",t.style.pointerEvents="all"}function se(t){ci=t}function le(t){si=t}function ce(t){t=parseInt(t,10),ai=t}function ue(t){$i=t}function de(t){var e=si.x,n=si.y,i=si.w,r=bi/i,a=r*(t.h/t.w),o=-e*r,s=-n*a;Ti=o,wi=s,ki=r,Ai=a,_i=Ti,Ci=wi,Ei=ki,Si=Ai}function he(){ri=""}function pe(t){var e,n=TAG.TourAuthoring.Constants.inkDragHandleRadius,i=t.attrs.x,r=t.attrs.y,a={x:0,y:0},o={x:0,y:0};t.getBBox(),TAG.TourAuthoring.Constants.inkDragHandleRadius,e=Cn.ellipse(i,r,n-2,n-2).attr({"stroke-width":2,stroke:"#ffffff",fill:"#296B2F","fill-opacity":.8}).data("type","grabHandle"),e.toFront(),t.toFront(),e.data("curr_cx",e.attr("cx")),e.data("curr_cy",e.attr("cy")),t.data({x:i,y:r}),e.drag(function(n,i){var r=e.attr("rx");r+5>=a.x+n&&(n=r+5-a.x),r+5>=a.y+i&&(i=r+5-a.y),a.x+n>=Vi-(r+5)&&(n=Vi-(r+5)-a.x),a.y+i>=Yi-(r+5)&&(i=Yi-(r+5)-a.y);var o=parseInt(this.data("curr_cx"),10),s=parseInt(this.data("curr_cy"),10),l=o+n,c=s+i;this.attr({cx:l,cy:c}),t.attr("x",a.x+n),t.attr("y",a.y+i)},function(){a.x=parseFloat(t.attrs.x),a.y=parseFloat(t.attrs.y);var n=e.getBBox();o.x=n.x,o.y=n.y,o.w=n.width,o.h=n.height},function(){var n=this.getBBox().x,i=this.getBBox().y,r=this.getBBox().width,s=this.getBBox().height;this.data("curr_cx",n+r/2),this.data("curr_cy",i+s/2),t.data({x:t.attrs.x,y:t.attrs.y});var l=parseFloat(t.attrs.x),c=parseFloat(t.attrs.y);n=e.getBBox().x,i=e.getBBox().y,r=e.getBBox().width,s=e.getBBox().height;var u=a.x,d=a.y;a.w,a.h;var h=o.x,p=o.y,f=o.w,g=o.h,m=TAG.TourAuthoring.Command({execute:function(){En.attr({x:l}),En.attr({y:c}),t.attr({x:l,y:c}),t.data({x:l,y:c}),e.data("curr_cx",n+r/2),e.data("curr_cy",i+s/2),e.attr({cx:n+r/2,cy:i+s/2,rx:r/2,ry:s/2})},unexecute:function(){En.attr({x:u}),En.attr({y:d}),t.attr({x:u,y:d}),t.data({x:u,y:d}),e.data("curr_cx",h+f/2),e.data("curr_cy",p+g/2),e.attr({cx:h+f/2,cy:p+g/2})}});m.execute(),di.logCommand(m)})}function fe(t){var e=An.width(),n=An.height(),i=[];te();for(var r=0;t.length>r;r++){var a,o=t[r];if(o.type.toLowerCase(),"rect"==o.type){var s=parseFloat(o.X)/e,l=parseFloat(o.Y)/n,c=parseFloat(o.w)/e,u=parseFloat(o.h)/n,d=10/e,h=10/n;a="M"+s+","+l+"C"+(s+d)+","+l+","+(s+c-d)+","+l+","+(s+c)+","+l+"C"+(s+c)+","+(l+h)+","+(s+c)+","+(l+u-h)+","+(s+c)+","+(l+u)+"C"+(s+c-d)+","+(l+u)+","+(s+d)+","+(l+u)+","+s+","+(l+u)+"C"+s+","+(l+u-h)+","+s+","+(l+h)+","+s+","+l+"z"}else if("ellipse"==o.type){var p=parseFloat(o.cx)/e,f=parseFloat(o.cy)/n,g=parseFloat(o.rx)/e,m=parseFloat(o.ry)/n,v=4/3*(Math.sqrt(2)-1);a="M"+p+","+(f-m)+"C"+(p+g*v)+","+(f-m)+","+(p+g)+","+(f-m*v)+","+(p+g)+","+f+"C"+(p+g)+","+(f+m*v)+","+(p+g*v)+","+(f+m)+","+p+","+(f+m)+"C"+(p-g*v)+","+(f+m)+","+(p-g)+","+(f+m*v)+","+(p-g)+","+f+"C"+(p-g)+","+(f-m*v)+","+(p-g*v)+","+(f-m)+","+p+","+(f-m)+"z"}i.push(a)}return A(i),i}function ge(){try{console.log("showInkPath gives: "+ti.getInkPath())}catch(t){console.log("error in showInkPath: "+t.message)}}function me(t,e,n){for(var i=t.match(/[0-9.\-]+/g),r="",a=0,o=t.length,s=0;o>s;s++)"M"==t[s]||"L"==t[s]?(r+=t[s],r+=(parseFloat(i[a])*e).toFixed(6)+",",r+=(parseFloat(i[a+1])*n).toFixed(6),a+=2):"C"==t[s]?(r+=t[s],r+=(parseFloat(i[a])*e).toFixed(6)+",",r+=(parseFloat(i[a+1])*n).toFixed(6)+",",r+=(parseFloat(i[a+2])*e).toFixed(6)+",",r+=(parseFloat(i[a+3])*n).toFixed(6)+",",r+=(parseFloat(i[a+4])*e).toFixed(6)+",",r+=(parseFloat(i[a+5])*n).toFixed(6),a+=6):"z"==t[s]&&(r+="z");return r}function ve(){var t,e="",n=An.width(),i=An.height();return On&&(On.split("Mundefined").length>1&&(On=On.split("Mundefined").join("")),e+=On),Vn&&(e+=Vn),Wi&&(e+=Wi.replace(/undefined/g,"")),Cn.forEach(function(r){"rect"===r.data("type")&&"yes"===r.data("visible")?(t="RECT::[x]"+Q(r.attr("x"),n)+"[y]"+Q(r.attr("y"),i),t+="[w]"+Q(r.attr("width"),n)+"[h]"+Q(r.attr("height"),i),t+="[fillc]"+r.attr("fill")+"[fillo]"+r.attr("fill-opacity"),t+="[strokec]"+r.attr("stroke")+"[strokeo]"+r.attr("stroke-opacity")+"[strokew]"+r.attr("stroke-width")+"[]",e+=t+"|"):"ellipse"===r.data("type")&&"yes"===r.data("visible")?(t="ELLIPSE::[cx]"+Q(r.attr("cx"),n)+"[cy]"+Q(r.attr("cy"),i),t+="[rx]"+Q(r.attr("rx"),n)+"[ry]"+Q(r.attr("ry"),i),t+="[fillc]"+r.attr("fill")+"[fillo]"+r.attr("fill-opacity"),t+="[strokec]"+r.attr("stroke")+"[strokeo]"+r.attr("stroke-opacity")+"[strokew]"+r.attr("stroke-width")+"[]",e+=t+"|"):"marquee"===r.data("type")?(t="MARQUEE::[x]"+Q(r.attr("x"),n),t=t+"[y]"+Q(r.attr("y"),i),t+="[w]"+Q(r.attr("width"),n)+"[h]"+Q(r.attr("height"),i),t+="[surrfillc]"+r.data("surr-fill")+"[surrfillo]"+r.data("surr-opac")+"[]",e+=t+"|"):"text"===r.data("type")&&(t="TEXT::[str]"+r.data("str")+"[font]"+r.data("font")+"[fontsize]"+Q(r.data("fontsize"),i)+"[color]"+r.data("color")+"[x]"+Q(r.data("x"),n)+"[y]"+Q(r.data("y"),i)+"[w]"+r.data("w")+"[h]"+r.data("h")+"[]",e+=t+"|")}),ri=e,e}function ye(t){var e,n;for(e=0;t.length>e;e++)if("L"===t[e]||"M"===t[e]){var i=t.substring(e).split("|")[0],r=x(i,"stroke","s"),a=x(i,"strokeo","f"),o=x(i,"strokew","f");Pn.push(t[e]),Nn.push({color:r,opacity:a,width:o})}var s=t.split("L");for(e=0;s.length>e;e++)if(s[e].length>0){var l=s[e].split("M");for(n=0;l.length>n;n++)if(l[n].length>0&&"P"!=l[n].charAt(0)){var c=l[n].split(",");$n.push([parseFloat(c[0]),parseFloat(c[1])])}}ii=!1}function be(t){Sn="#"==t[0]?t:"#"+t}function xe(t){Mn=t}function Te(t){In=t}function we(t){Dn=t}function ke(t){Ln="#"==t[0]?t:"#"+t}function Ae(t){Fn=t}function _e(t){Bn=t}function Ce(t){Un="#"==t[0]?t:"#"+t}function Ee(t){zn=t}function Se(){oi=end}function Me(t){Xn=t,En&&(En.attr({"font-family":Xn}),En.data({font:Xn}))}function Ie(t){Zn=t,En&&(En.attr({"font-size":Zn}),En.data({fontsize:Zn}))}function De(t){Kn="#"==t[0]?t:"#"+t,En&&(En.attr({fill:Kn}),En.data({color:Kn}))}function Pe(t){Qn=t}function $e(t){jn=t}function Ne(){return Sn}function Ge(){return Mn}function Oe(){return In}function Le(){return Dn}function Fe(){return Ln}function Be(){return Fn}function Re(){return Bn}function He(){return Un}function Ue(){return zn}function ze(){return oi}function je(){return Xn}function We(){return Zn}function qe(){return Kn}function Ve(){return Qn}function Ye(){return jn}function Xe(t){var e=document.getElementById(t).value;void 0!==e&&(-1==e.indexOf("#")&&(e="#"+e),Sn=e)}function Ke(t){var e=document.getElementById(t).value;void 0!==e&&(Mn=e)}function Ze(t){var e=document.getElementById(t).value;void 0!==e&&(In=e)}function Qe(t){var e=document.getElementById(t).value;void 0!==e&&(Dn=e)}function Je(t){var e=document.getElementById(t).value;6===e.length&&(Ln="#"+e)}function tn(t){var e=document.getElementById(t).value;void 0!==e&&(Fn=e)}function en(t){var e=document.getElementById(t).value;6===e.length&&(Rn="#"+e)}function nn(t){var e=document.getElementById(t).value;void 0!==e&&(Hn=e)}function rn(t){var e=document.getElementById(t).value;6===e.length&&(Un=e)}function an(t){var e=document.getElementById(t).value;void 0!==e&&(zn=e)}function on(t){var e=document.getElementById(t).value;void 0!==e&&(Xn=e)}function sn(t){var e=document.getElementById(t).value;void 0!==e&&(Zn=parseFloat(e))}function ln(t){var e=document.getElementById(t).value;void 0!==e&&(-1==e.indexOf("#")&&(e="#"+e),Kn=e)}function cn(t){var e=document.getElementById(t).value;void 0!==e&&(Qn=e)}function un(t,e,n,i){var r=(t[0]-e[0])*(n||1),a=(t[1]-e[1])*(i||1);return Math.sqrt(r*r+a*a)}function dn(t){for(var e=t.match(/[0-9.\-]+/g)||[],n=[],i=0;e.length>i;i++)n.push(parseFloat(e[i]));return n}function hn(t){return t.match(/[MLR ]/g)||[]}function pn(t,e){var n,i="";for(n=0;t.length>n;n++)i+=t[n]+e[2*n]+","+e[2*n+1];return i}function fn(){ji=Nn.slice(0),qi=zi}function gn(t){t.stopImmediatePropagation(),t.stopPropagation(),(1===ai||2===ai)&&(Fi=ei.width(),Bi=ei.height(),ii=!0,Ri.length=0,Hi.length=0,fn(),1===ai?(Nn.push({color:Sn,opacity:Mn,width:In/Bi}),Ri.push([t.offsetX/Fi,t.offsetY/Bi]),bn()):2===ai&&(xn([t.offsetX,t.offsetY]),yn()),An.on("mousemove",mn),An.on("mouseup",vn),An.on("mouseleave",vn))}function mn(t){var e=Ri.length,n=[t.offsetX/Fi,t.offsetY/Bi],i=[t.offsetX,t.offsetY];1===ai?0===e||un(i,[Ri[e-1][0]*Fi,Ri[e-1][1]*Bi])>Ui?(Hi.length=0,Ri.push(n),bn()):(Hi.push(n),bn()):2===ai&&(xn([t.offsetX,t.offsetY]),yn())}function vn(){Ri.length>0&&bn(!0),ii=!1,Ri.length=0,Hi.length=0,An.off("mousemove"),An.off("mouseup"),An.off("mouseleave");var t={pathstring:zi,pa:Nn},e={pathstring:qi,pa:ji},n=TAG.TourAuthoring.Command({execute:function(){zi=t.pathstring,Nn=t.pa.slice(0),yn()},unexecute:function(){zi=e.pathstring,Nn=e.pa.slice(0),yn()}});n.execute(),di.logCommand(n)}function yn(t){var e,n=ei.width(),i=ei.height(),r=[],a="",o="";if(t=t||zi,Cn.clear(),t){var s=hn(t),l=dn(t),c=0;for(e=0;s.length>e;e++)"M"===s[e]&&(a+="BEZIER::[pathstring]"),o+=s[e]+n*l[2*e]+","+i*l[2*e+1],a+=s[e]+l[2*e]+","+l[2*e+1],("M"===s[e+1]||e===s.length-1)&&(r.push(o),o="",a+="[stroke]"+Nn[c].color+"[strokeo]"+Nn[c].opacity+"[strokew]"+Nn[c].width+"[]|",c++);for(e=0;r.length>e;e++){var u=Cn.path(r[e]);u.data("type","bezier"),u.attr({"stroke-width":Nn[e].width*i,"stroke-opacity":Nn[e].opacity,stroke:Nn[e].color,"stroke-linejoin":"round","stroke-linecap":"round"})}Wi=a}}function bn(t){var e,n,i,r,a="",o="",s=Ri.length,l=Hi.length,c=Ri[0][0],u=Ri[0][1];if(1===s)a="M"+c+","+u+"L"+c+","+u;else if(2===s)a="M"+c+","+u+"L"+Ri[1][0]+","+Ri[1][1];else if(s>2)for(a="M"+c+","+u+"R",e=1;s>e;e++)a+=(1===e?"":" ")+Ri[e][0]+","+Ri[e][1];if(l>0)if(n=Hi[0][0],i=Hi[0][1],s>0)for(e=0;l>e;e++)o+=" "+Hi[e][0]+","+Hi[e][1];else if(1===l)o="M"+n+","+i+"L"+n+","+i;else if(2===l)o="M"+n+","+i+"L"+Hi[1][0]+","+Hi[1][1];else for(o="M"+n+","+i+"R",e=1;l>e;e++)o+=(1===e?"":" ")+Hi[e][0]+","+Hi[e][1];t?(zi+=a,r=zi.match(/[MLR ]/g),r&&"L"!==r[r.length-1]&&(zi+=0===l?"":" "+Hi[l-1][0]+","+Hi[l-1][1]),yn()):yn(zi+a+o)}function xn(t){if(zi){for(var e=An.width(),n=An.height(),i=dn(zi),r=hn(zi),a=-1,o=0;r.length>o;o++)"M"===r[o]&&a++,Dn>un(t,[e*i[2*o],n*i[2*o+1]])&&("M"===r[o]?"R"===r[o+1]?"M"!==r[o+3]&&r[o+3]?(r.splice(o,3,"M","R"),i.splice(2*o,2)):(r.splice(o,3,"M","L"),i.splice(2*o,2)):"L"===r[o+1]&&(r.splice(o,2),i.splice(2*o,4),Nn.splice(a,1)):"L"===r[o]?(r.splice(o-1,2),i.splice(2*(o-1),4),Nn.splice(a,1)):"R"===r[o]?"M"!==r[o+2]&&r[o+2]?" "===r[o+3]?(r.splice(o-1,4,"M","R"),i.splice(2*(o-1),4)):(r.splice(o-1,4,"M","L"),i.splice(2*(o-1),4)):(r.splice(o-1,3),i.splice(2*(o-1),6),Nn.splice(a,1)):" "===r[o]&&("M"!==r[o+1]&&r[o+1]?" "===r[o+1]&&" "===r[o+2]&&" "===r[o+3]?(r.splice(o,3,"M","R"),i.splice(2*o,2),Nn.splice(a,0,Nn[a])):" "===r[o+1]&&" "===r[o+2]?(r.splice(o,3,"M","L"),i.splice(2*o,2),Nn.splice(a,0,Nn[a])):" "===r[o+1]?(r.splice(o,2),i.splice(2*o,4)):(r.splice(o,1),i.splice(2*o,2)):"R"===r[o-1]?(r.splice(o-2,3),i.splice(2*(o-2),6),Nn.splice(a,1)):(r.splice(o,1),i.splice(2*o,2))));a=-1;var s=0;for(o=0;r.length>o;o++)if("M"!==r[o]||(s=o,a++,"R"!==r[o+1]||" "===r[o+2])){if(isNaN(i[2*o])||isNaN(i[2*o+1]))for(var l=0;r.length-o>l;l++)"M"!==r[l+1]||r[l+1]||(r.splice(s,o+l-s),i.splice(2*s,2*(o+l-s)),Nn.splice(a,1),a--,o=s)}else r.splice(o,2),i.splice(2*o,4),o--,Nn.splice(a,1),a--,s--;zi=pn(r,i),(zi.match(/undefined/)||zi&&"M"!==zi[0])&&console.log("uh oh")}}var Tn={},wn=t;Tn.canvid=t,e=e?e:$("#"+wn)[0];var kn,An=$(e),_n=i.dataHolder,Cn=new Raphael(e,"100%","100%");$("#"+wn+" svg").css("position","absolute");var En,Sn="#000000",Mn=1,In=7,Dn=5,Pn=[],$n=[],Nn=[],Gn=[],On="",Ln="#ffffff",Fn=.7,Bn=5,Rn="#000000",Hn=0,Un="#000000",zn=.8,jn="isolate",Wn=[],qn=[],Vn="",Yn="",Xn="'Times New Roman', serif",Kn="#ffffff",Zn="12px",Qn=1,Jn="textbox",ti=null;n="inkes"===n?"inkes":"componentcontrols";var ei,ni=[],ii=!1,ri="",ai=TAG.TourAuthoring.InkMode.draw,oi=!0,si={},li="",ci="",ui=1;ei="inkes"===n?$("#rinplayer").length?$("#rinplayer"):$("#rinPlayer"):$("#rinContainer");var di,hi,pi,fi,gi,mi,_n,vi=0,yi=0,bi=ei.width(),xi=ei.height(),Ti=0,wi=0,ki=0,Ai=0,_i=0,Ci=0,Ei=0,Si=0,Mi=0,Ii=0,Di=bi,Pi=xi,$i=0;"inkes"!==n&&(hi=i.playbackControls,pi=i.undoManager,fi=i.timeline,gi=i.timeManager,mi=i.viewer,di=new TAG.TourAuthoring.UndoManager,di.setInitialized(!0),hi.undoButton.off("click"),hi.redoButton.off("click"),hi.undoButton.on("click",function(){di.undo()}),hi.redoButton.on("click",function(){di.redo()})),Tn.resetParams=r,Tn.abs_dims=a,Tn.add_attributes=o,Tn.getInkUndoManager=s,Tn.add_ellipse=l,Tn.add_marq_attributes=c,Tn.add_rectangle=u,Tn.getSVGText=d,Tn.add_text_box=h,Tn.adjustViewBox=p,Tn.adjustViewBoxDiv=f,Tn.block_to_isol=g,Tn.const_path_alg=m,Tn.drawPaths=v,Tn.drawTrans=y,Tn.erase=b,Tn.get_attr=x,Tn.set_attr=T,Tn.getBoundingShapes=w,Tn.getDatastring=k,Tn.get_outer_path=A,Tn.getArtRelativePos=_,Tn.getSVGElement=C,Tn.get_trans_shape_data=E,Tn.isTextboxEmpty=S,Tn.isDatastringEmpty=M,Tn.link_text=P,Tn.link_text_unattached=N,Tn.link_trans=G,Tn.link_trans_unattached=O,Tn.link=L,Tn.linkUnattached=F,Tn.getTextElt=B;var Ni=An.width(),Gi=An.height();Tn.getTextMagnification=R,Tn.loadInk=H,Tn.load_trans_from_path=U,Tn.load_transparency_bounding_shapes=z,Tn.next_in_bez=j,Tn.nontrivial=W,Tn.out_bez=q;var Oi,Li;Tn.panObjects=V,Tn.getPannedPos=Y,Tn.testPan=X,Tn.testScale=K,Tn.point_inside=Z,Tn.rel_dims=Q,Tn.repeat_pt=J,Tn.remove_all=te,Tn.resizeObjects=ee,Tn.retrieveOrigDims=ne,Tn.same_point=ie,Tn.save_text=re,Tn.setArtName=ae,Tn.set_editable=oe,Tn.setEID=se,Tn.setInitKeyframeData=le,Tn.set_mode=ce,Tn.setOldOpac=ue,Tn.setOrigDims=de,Tn.resetText=he,Tn.setTextAttributes=pe,Tn.shapes_to_paths=fe,Tn.showInkPath=ge,Tn.transform_pathstring_marq=me,Tn.update_datastring=ve,Tn.update_ml_xy_pa=ye,Tn.setPenColor=be,Tn.setPenOpacity=xe,Tn.setPenWidth=Te,Tn.setEraserWidth=we,Tn.setShapeStrokeColor=ke,Tn.setShapeStrokeOpacity=Ae,Tn.setShapeStrokeWidth=_e,Tn.setMarqueeFillColor=Ce,Tn.setMarqueeFillOpacity=Ee,Tn.setEnabled=Se,Tn.setFontFamily=Me,Tn.setFontSize=Ie,Tn.setFontColor=De,Tn.setFontOpacity=Pe,Tn.setTransMode=$e,Tn.getPenColor=Ne,Tn.getPenOpacity=Ge,Tn.getPenWidth=Oe,Tn.getEraserWidth=Le,Tn.getShapeStrokeColor=Fe,Tn.getShapeStrokeOpacity=Be,Tn.getShapeStrokeWidth=Re,Tn.getMarqueeFillColor=He,Tn.getMarqueeFillOpacity=Ue,Tn.getEnabled=ze,Tn.getFontFamily=je,Tn.getFontSize=We,Tn.getFontColor=qe,Tn.getFontOpacity=Ve,Tn.getTransMode=Ye,Tn.updatePenColor=Xe,Tn.updatePenOpacity=Ke,Tn.updatePenWidth=Ze,Tn.updateEraserWidth=Qe,Tn.updateShapeStrokeColor=Je,Tn.updateShapeStrokeOpacity=tn,Tn.updateShapeFillColor=en,Tn.updateShapeFillOpacity=nn,Tn.updateMarqueeColor=rn,Tn.updateMarqueeOpacity=an,Tn.updateFontFamily=on,Tn.updateFontSize=sn,Tn.updateFontColor=ln,Tn.updateFontOpacity=cn;var Cn,Fi,Bi,Ri=[],Hi=[],Ui=8,zi="",ji=[],Wi="",qi="";An.on("mousedown",gn),An.on("mouseenter",function(){An.css("cursor",1==ai||2==ai?"crosshair":"pointer")}),Tn.drawBezierPath=yn,Tn.erase=b;var Vi,Yi,ji=[];return Tn},TAG.Util.makeNamespace("TAG.TourAuthoring.InkController"),TAG.TourAuthoring.InkController=function(){"use strict";function t(t){this.canvid=t,this.cw=$("#"+this.canvid).css("width"),this.ch=$("#"+this.canvid).css("height"),this.paper=Raphael(this.canvid,"100%","100%"),this.penColor="#ffffff",this.penOpacity=1,this.penWidth=4,this.eraserWidth=5,this.shapeStrokeColor="#000000",this.shapeStrokeOpacity=1,this.shapeStrokeWidth=0,this.shapeFillColor="#000000",this.shapeFillOpacity=.5,this.marqueeFillColor="#000000",this.marqueeFillOpacity=.8,this.marquees=[],this.marquees_on=1,this.click=!1,this.ml=[],this.xy=[],this.paths=[],this.pathObjects=[],this.currpaths="",this.pathattrs="",this.datastring="",this.mode=1;var n=this;this.add_attributes=function(t,e,i,r,a,o){var s,l,c,u=0,d=0;void 0==e&&(e=n.shapeFillColor),void 0==i&&(i=n.shapeFillOpacity),void 0==r&&(r=n.shapeStrokeColor),void 0==a&&(a=n.shapeStrokeOpacity),void 0==o&&(o=n.shapeStrokeWidth),t.mouseover(function(){d||0!=mode||(s=t.glow({width:15,color:"#33ff00",opacity:.8}))}),t.mouseout(function(){0==mode&&s.remove()}),t.attr({"stroke-width":o,stroke:r,"stroke-opacity":a,fill:e,"fill-opacity":i}),t.drag(function(t,e,n,i){if(!mode){if(this.toFront(),u){var r=this.getBBox();this.attr({cx:r.x+.5*r.width+.5*(n-l),cy:r.y+.5*r.height+.5*(i-c),rx:r.width/2+.5*(n-l),ry:r.height/2+.5*(i-c),width:r.width+n-l,height:r.height+i-c})}else{var a=parseInt(this.data("currx")),o=parseInt(this.data("curry")),s=a+t,d=o+e;this.attr({cx:s+parseInt(this.data("curr_rx")),cy:d+parseInt(this.data("curr_ry")),x:s,y:d})}l=n,c=i}},function(t,e){if(!mode){l=t,c=e;var n=this.getBBox();console.log("bbox.height = "+n.height),u=0;var i=0,r=0;console.log("canvx="+i+", canvy="+r,", bbox.x="+n.x+", bbox.width="+n.width),t>n.x+.5*n.width+i&&e>n.y+.5*n.height+r&&(u=1),s.remove(),d=1,this.animate({opacity:.25},500,"<>")}console.log("at end of start")},function(){console.log("at beginning of stop"),mode||(this.data("currx",this.getBBox().x),this.data("curry",this.getBBox().y),this.data("curr_rx",this.getBBox().width/2),this.data("curr_ry",this.getBBox().height/2),d=0,u=0,this.animate({opacity:1},500,"<>"))})},this.add_marq_attributes=function(t,e,i){var r,a,o,s=t.rc,l=0,c=0,u=parseInt($("#"+n.canvid).css("width")),d=parseInt($("#"+n.canvid).css("height")),h=n.mode;void 0==e&&(e=n.marqueeFillColor),void 0==i&&(i=n.marqueeFillOpacity),s.mouseover(function(){c||3!=h||(r=s.glow({width:10,color:"#33ff00",opacity:.8}))}),s.mouseout(function(){3==h&&r.remove()}),s.attr({"stroke-width":0,stroke:"#222222",fill:"#ffffff","fill-opacity":0}),s.data("surr-fill",e),s.data("surr-opac",i);var p=n.paper.set();p.push(t.rn,t.re,t.rs,t.rw),p.attr({"stroke-width":0,stroke:"#222222",fill:e,"fill-opacity":i}),s.drag(function(e,n,i,r){if(3==h){this.toFront();var s=this.getBBox();if(l)this.attr({width:s.width+i-a,height:s.height+r-o}),t.rs.attr({y:s.y+s.height+r-o,height:d-(s.y+s.height+r-o)}),t.re.attr({x:s.x+s.width+i-a,width:u-(s.x+s.width+i-a),height:s.height+r-o}),t.rw.attr({height:s.height+r-o});else{var c=parseInt(this.data("currx")),p=parseInt(this.data("curry")),f=c+e,g=p+n;this.attr({x:f,y:g}),t.rn.attr({height:g}),t.re.attr({x:f+s.width,y:g,width:u-(f+s.width),height:s.height}),t.rs.attr({y:g+s.height,height:d-(g+s.height)}),t.rw.attr({y:g,width:f,height:s.height})}a=i,o=r}},function(t,e){if(3==h){a=t,o=e;var n=this.getBBox();t>n.x+.5*n.width&&e>n.y+.5*n.height&&(l=1),r.remove(),c=1,this.animate({opacity:.25},500,"<>")}},function(){3==h&&(this.data("currx",this.getBBox().x),this.data("curry",this.getBBox().y),t.re.data("currx",this.getBBox().x+this.getBBox().width),t.rs.data("curry",this.getBBox().y+this.getBBox().height),l=0,this.animate({opacity:1},500,"<>"),c=0)})},this.add_ellipse=function(){n.set_mode(0),console.log("setting cx and cy for the ellipse");var t=100,e=100,i=50,r=50,a=n.paper.ellipse(t,e,i,r);a.data("currx",a.getBBox().x),a.data("curry",a.getBBox().y),a.data("curr_rx",i),a.data("curr_ry",r),a.data("type","ellipse"),n.add_attributes(a)},this.add_rectangle=function(){n.set_mode(0);var t=Math.floor(300*Math.random()),e=Math.floor(300*Math.random()),i=n.paper.rect(t,e,50,50);i.data("currx",t),i.data("curry",e),i.data("type","rect"),n.add_attributes()},this.add_marquee=function(){n.set_mode(3),console.log("mode = "+mode);var i=200+Math.floor(10*Math.random()),r=300+Math.floor(10*Math.random()),a=200+Math.floor(10*Math.random()),o=300+Math.floor(10*Math.random()),s=parseInt($("#"+n.canvid).css("width")),l=parseInt($("#"+n.canvid).css("height")),c=n.paper.rect(0,0,s,a);c.data("currx",0),c.data("curry",0);var u=n.paper.rect(r,a,s-r,o-a);u.data("currx",r),u.data("curry",a);var d=n.paper.rect(0,o,s,l-o);d.data("currx",0),d.data("curry",o);var h=n.paper.rect(0,a,i,o-a);h.data("currx",0),h.data("curry",a);var p=n.paper.rect(i,a,r-i,o-a);p.data("currx",i),p.data("curry",a),p.data("type","marquee");var f=new e(c,u,d,h,p);n.add_marq_attributes(t,rpaper,f),marquees.push(f),n.show_marquees(),marquees_on=1},this.drawPaths=function(t,e,i,r){if(void 0==t){for(var a=pathObjects.length,o=0;pathObjects.length>o;o++)pathObjects[o].remove();for(var o=0;a>o;o++)pathObjects.shift();for(var o=0;ml.length>o;o++)"X"!==ml[o]&&(t+=ml[o]+xy[o][0]+","+xy[o][1])}if(void 0==e&&(e=n.penColor),void 0==i&&(i=n.penOpacity),void 0==r&&(r=n.penWidth),t.length>0)var s=t.split("M");for(var o=1;s.length>o;o++){var l=n.paper.path("M"+s[o]);l.data("type","path"),l.attr({"stroke-width":r,"stroke-opacity":i,stroke:e,"stroke-linejoin":"round","stroke-linecap":"round"}),l.toFront(),pathObjects.push(l)}currpaths=t,pathattrs="[stroke]"+e+"[strokeo]"+i+"[strokew]"+r},this.erase=function(t){for(var e=5,i=0;xy.length>i;i++)t[0]-e<=xy[i][0]&&xy[i][0]<=t[0]+e&&t[1]-e<=xy[i][1]&&xy[i][1]<=t[1]+e&&("L"===ml[i+1]&&(ml[i+1]="M"),ml.splice(i,1),xy.splice(i,1),n.drawPaths())},this.hide_marquees=function(){var t,e=marquees.length;for(t=0;e>t;t++)marquees[t].rn.hide(),marquees[t].re.hide(),marquees[t].rs.hide(),marquees[t].rw.hide(),marquees[t].rc.hide()},this.show_marquees=function(){var t,e=n.marquees.length;for(t=0;e>t;t++){var i=n.marquees[t];i.rn.show(),i.re.show(),i.rs.show(),i.rw.show(),i.rc.show()}},this.toggle_marquees=function(){n.marquees_on=1-n.marquees_on,n.marquees_on?n.show_marquees():n.hide_marquees()},this.get_attr=function(t,e,n){return void 0==n&&(n="f"),"s"==n?t.split("["+e+"]")[1].split("[")[0]:"i"==n?parseInt(t.split("["+e+"]")[1].split("[")[0]):parseFloat(t.split("["+e+"]")[1].split("[")[0])},this.rel_dims=function(t,e){return parseFloat(t)/e},this.abs_dims=function(t,e){return parseFloat(t)*e},this.discard=function(){remove_all(n.canvid,n.paper),n.paper=Raphael(0,0,0,0)},this.set_mode=function(t){t=parseInt(t),n.mode=1>t||t>3?0:t},this.transform_pathstring=function(t,e,i,r){r=void 0==r?0:1;var t=n.currpaths,a=t.match(/[0-9.]+/g),o="",s=0,l=0,c=t.length;for(l=0;c>l;l++)("M"==t[l]||"L"==t[l])&&(r?(o=o+t[l]+Math.round(parseFloat(a[s])*e)+",",o+=Math.round(parseFloat(a[s+1])*i)):(o=o+t[l]+(parseFloat(a[s])*e).toFixed(3)+",",o+=(parseFloat(a[s+1])*i).toFixed(3)),s+=2);return o},this.update_datastring=function(){datastring="";var t=n.currpaths,e=parseFloat($("#"+n.canvid).css("width")),e=parseFloat($("#"+n.canvid).css("height"));if(""!=t){var i=t;t.split("undefined").length>1&&(i=t.split("undefined")[1]);var r=transform_pathstring(i,1/e,1/canv_width),a="PATH::[pathstring]"+r+pathattrs+"[]";datastring+=a+"|"}return paper.forEach(function(t){if("rect"==t.data("type")){var i="RECT::[x]"+n.rel_dims(t.attr("x"),canv_width)+"[y]"+n.rel_dims(t.attr("y"),e);i+="[w]"+n.rel_dims(t.attr("width"),canv_width)+"[h]"+n.rel_dims(t.attr("height"),e),i+="[fillc]"+t.attr("fill")+"[fillo]"+t.attr("fill-opacity"),i+="[strokec]"+t.attr("stroke")+"[strokeo]"+t.attr("stroke-opacity")+"[strokew]"+t.attr("stroke-width")+"[]",datastring+=i+"|"}else if("ellipse"==t.data("type")){var i="ELLIPSE::[cx]"+n.rel_dims(t.attr("cx"),canv_width)+"[cy]"+n.rel_dims(t.attr("cy"),e);i+="[rx]"+n.rel_dims(t.attr("rx"),canv_width)+"[ry]"+n.rel_dims(t.attr("ry"),e),i+="[fillc]"+t.attr("fill")+"[fillo]"+t.attr("fill-opacity"),i+="[strokec]"+t.attr("stroke")+"[strokeo]"+t.attr("stroke-opacity")+"[strokew]"+t.attr("stroke-width")+"[]",datastring+=i+"|"}else if("marquee"==t.data("type")){var i="MARQUEE::[x]"+n.rel_dims(t.attr("x"),canv_width)+"[y]"+n.rel_dims(t.attr("y"),e);i+="[w]"+n.rel_dims(t.attr("width"),canv_width)+"[h]"+n.rel_dims(t.attr("height"),e),i+="[surrfillc]"+t.data("surr-fill")+"[surrfillo]"+t.data("surr-opac")+"[]",datastring+=i+"|"}}),datastring},this.clearAndLoadInk=function(e){remove_all(t,PAPER),this.loadInk(e)},this.resizePaper=function(t,e){PAPER.setSize(t,e)},this.remove_all=function(){n.paper.clear(),ml.length=0,xy.length=0,paths.length=0,pathObjects.length=0,marquees.length=0,currpaths="",n.update_datastring()},this.update_ml_xy=function(t){var e,i;for(e=0;t.length>e;e++)("L"==t[e]||"M"==t[e])&&n.ml.push(t[e]);var r=t.split("L");for(e=0;r.length>e;e++)if(r[e].length>0){var a=r[e].split("M");for(i=0;a.length>i;i++)if(a[i].length>0){var o=a[i].split(",");n.xy.push([o[0],o[1]])}}n.click=!1},this.manipCanvas=function(){setDraggable(!0)},this.setDraggable=function(t){t===!0?(n.set_mode(4),$("#"+n.canvid).draggable({disabled:!1}),$("#"+n.canvid).resizable({disabled:!1})):($("#"+n.canvid).draggable({disabled:!0}),$("#"+n.canvid).resizable({disabled:!0}),$("#"+n.canvid).css({opacity:1}))},this.resizeObjects=function(t,e){n.paper.forEach(function(n){if("path"!=n.data("type")){n.attr({x:n.attr("x")*t,y:n.attr("y")*e,cx:n.attr("cx")*t,cy:n.attr("cy")*e,rx:n.attr("rx")*t,ry:n.attr("ry")*e,width:n.attr("width")*t,height:n.attr("height")*e}),"ellipse"==n.data("type")?(n.data("currx",n.attr("cx")-n.attr("rx")),n.data("curry",n.attr("cy")-n.attr("ry")),n.data("curr_rx",n.attr("rx")),n.data("curr_ry",n.attr("ry"))):(n.data("currx",n.attr("x")),n.data("curry",n.attr("y")));var i=n.glow({width:15,color:"#33ff00",opacity:.8});i.remove()}});for(var i=0;n.xy.length>i;i++)n.xy[i][0]=n.xy[i][0]*t,n.xy[i][1]=n.xy[i][1]*e;for(var i=0;pathObjects.length>i;i++)n.pathObjects[i].scale(t,e,0,0)},this.loadInk=function(t){var i,r=t.split("|"),a=n.cw,o=n.ch;for(i=0;r.length>i;i++){var s=r[i],l=s.split("::")[0];switch(l=l.toLowerCase()){case"rect":var c=abs_dims(get_attr(s,"x"),a),u=abs_dims(get_attr(s,"y"),o),d=abs_dims(get_attr(s,"w"),a),h=abs_dims(get_attr(s,"h"),o),p=get_attr(s,"fillc","s"),f=get_attr(s,"fillo","f"),g=get_attr(s,"strokec","s"),m=get_attr(s,"strokeo","f"),v=get_attr(s,"strokew"),y=n.paper.rect(c,u,d,h);y.data("currx",c),y.data("curry",u),y.data("type","rect"),add_attributes(y,p,f,g,m,v);break;case"ellipse":var b=abs_dims(get_attr(s,"cx"),a),x=abs_dims(get_attr(s,"cy"),o),T=abs_dims(get_attr(s,"rx"),a),w=abs_dims(get_attr(s,"ry"),o),p=get_attr(s,"fillc","s"),f=get_attr(s,"fillo","f"),g=get_attr(s,"strokec","s"),m=get_attr(s,"strokeo","f"),v=get_attr(s,"strokew"),k=n.paper.ellipse(b,x,T,w);k.data("currx",k.getBBox().x),k.data("curry",k.getBBox().y),k.data("curr_rx",T),k.data("curr_ry",w),k.data("type","ellipse"),add_attributes(k,p,f,g,m,v);break;case"marquee":var A=abs_dims(get_attr(s,"x"),a),_=abs_dims(get_attr(s,"y"),o),d=abs_dims(get_attr(s,"w"),a),h=abs_dims(get_attr(s,"h"),o),C=get_attr(s,"surrfillc","s"),E=get_attr(s,"surrfillo","f"),S=A+d,M=_+h,I=n.paper.rect(0,0,a,_);I.data("currx",0),I.data("curry",0);var D=n.paper.rect(S,_,a-S,M-_);D.data("currx",S),D.data("curry",_);var P=n.paper.rect(0,M,a,o-M);P.data("currx",0),P.data("curry",M);var $=n.paper.rect(0,_,A,M-_);$.data("currx",0),$.data("curry",_);var N=n.paper.rect(A,_,S-A,M-_);N.data("currx",A),N.data("curry",_),N.data("type","marquee");var G=new e(I,D,P,$,N);n.add_marq_attributes(G,C,E),n.marquees.push(G),n.show_marquees(),n.marquees_on=1;break;case"path":var O=get_attr(s,"pathstring","s"),g=get_attr(s,"stroke","s"),m=get_attr(s,"strokeo","f"),v=get_attr(s,"strokew");n.currpaths=n.transform_pathstring(O,a,o,"round"),n.update_ml_xy(n.currpaths),n.drawPaths(n.currpaths,g,m,v)}}};var n=this;$("#"+n.canvid).mousedown(function(t){switch(n.click=!0,mode){case 1:console.log("mousedown case 1"),n.ml.push("M"),n.xy.push([t.offsetX,t.offsetY]),n.ml.push("L"),n.xy.push([t.offsetX,t.offsetY]),n.drawPaths();break;case 2:n.erase([t.offsetX,t.offsetY])}}).mouseup(function(){n.click=!1}).mouseleave(function(){n.click===!0&&(n.click=!1)}).mousemove(function(t){if(1==n.mode||2==n.mode?$("#"+n.canvid).css("cursor","crosshair"):$("#"+n.canvid).css("cursor","pointer"),n.click!==!1)switch(n.mode){case 1:n.ml.push("L"),n.xy.push([t.offsetX,t.offsetY]),n.drawPaths();break;case 2:n.erase([t.offsetX,t.offsetY])}}).hover(function(){1==n.mode&&$("#"+n.canvid).css("cursor","pointer")}),this.setPenColor=function(t){console.log("setting pen color to "+t),this.penColor=t},this.setPenOpacity=function(t){console.log("setting pen opacity to "+t),this.penOpacity=t},this.setPenWidth=function(t){console.log("setting pen width to "+t),this.penWidth=t},this.setEraserWidth=function(t){this.eraserWidth=t},this.setShapeStrokeColor=function(t){this.shapeStrokeColor=t},this.setShapeStrokeOpacity=function(t){this.shapeStrokeOpacity=t},this.setShapeStrokeWidth=function(t){this.shapeStrokeWidth=t},this.setMarqueeFillColor=function(t){this.marqueeFillColor=t},this.setMarqueeFillOpacity=function(t){this.marqueeFillOpacity=t},this.getPenColor=function(){return this.penColor},this.getPenOpacity=function(){return this.penOpacity},this.getPenWidth=function(){return this.penWidth},this.getEraserWidth=function(){return this.eraserWidth},this.getShapeStrokeColor=function(){return this.shapeStrokeColor},this.getShapeStrokeOpacity=function(){return this.shapeStrokeOpacity},this.getShapeStrokeWidth=function(){return this.shapeStrokeWidth},this.getMarqueeFillColor=function(){return this.marqueeFillColor},this.getMarqueeFillOpacity=function(){return this.marqueeFillOpacity},this.updatePenColor=function(t){var e=document.getElementById(t).value;6==e.length&&(this.penColor="#"+e)},this.updatePenOpacity=function(t){var e=document.getElementById(t).value;void 0!=e&&(this.penOpacity=e)},this.updatePenWidth=function(t){var e=document.getElementById(t).value;void 0!=e&&(this.penWidth=e)},this.updateShapeStrokeColor=function(t){var e=document.getElementById(t).value;6==e.length&&(this.shapeStrokeColor="#"+e)},this.updateShapeStrokeOpacity=function(t){var e=document.getElementById(t).value;void 0!=e&&(this.shapeStrokeOpacity=e)},this.updateShapeStrokeWidth=function(t){var e=document.getElementById(t).value;void 0!=e&&(this.shapeStrokeWidth=e)},this.updateShapeFillColor=function(t){var e=document.getElementById(t).value;6==e.length&&(this.shapeFillColor="#"+e)},this.updateShapeFillOpacity=function(t){var e=document.getElementById(t).value;void 0!=e&&(this.shapeFillOpacity=e)
},this.updateMarqueeColor=function(t){var e=document.getElementById(t).value;6==e.length&&(this.marqueeFillColor=e)},this.updateMarqueeColor=function(t){var e=document.getElementById(t).value;void 0!=e&&(this.marqueeFillOpacity=e)}}function e(t,e,n,i,r){this.rn=t,this.re=e,this.rs=n,this.rw=i,this.rc=r}var n={};return n.inkController=t,n.marquee=e,n}(),TAG.Util.makeNamespace("TAG.TourAuthoring.InkTrack"),TAG.Util.makeNamespace("TAG.TourAuthoring.InkType"),TAG.Util.makeNamespace("TAG.TourAuthoring.InkShape"),TAG.TourAuthoring.InkType={text:1,isolate:2,draw:3,block:4,highlight:5},TAG.TourAuthoring.InkShape={rectangle:1,ellipse:2},TAG.TourAuthoring.InkTrack=function(t,e){"use strict";t.type=TAG.TourAuthoring.TrackType.ink,t.fadeIn=-1e-6,t.fadeOut=-1e-6,e=e||{},e.inkSpec=t.inkSpec,e.inkType=t.media;var n=TAG.TourAuthoring.Track(t,e);return e.track.addClass("ink"),n},TAG.Util.makeNamespace("TAG.TourAuthoring.Keyframe"),TAG.TourAuthoring.Keyframe=function(t,e){"use strict";function n(){function t(){Y=!Y,Y?(G.css("display","none"),L.css("display","none")):(G.css("display","block"),L.css("display","block"))}var n=e.timeManager.timeToPx(j.x),i=e.type!==TAG.TourAuthoring.TrackType.audio?48:j.y,a=TAG.Util.UI.createKeyframe({container:e.track,x:n,y:i});O=a.line,G=a.circ,L=a.innerCirc,G.on("mousedown",function(t){var e=t.offsetX,n=t.offsetY;r(e,n)}),L.on("mousedown",function(t){var e=t.offsetX,n=t.offsetY;r(e,n)}),U.toggleCircle=t}function i(){G.off("mousedown"),L.off("mousedown"),G.on("mousedown",function(t){var e=t.offsetX,n=t.offsetY;r(e,n)}),L.on("mousedown",function(t){var e=t.offsetX,n=t.offsetY;r(e,n)})}function r(t,n){var i=j.x,r=j.y;e.timeManager.stop(),F=t,B=n,e.currentKeyframe=U,$("body").on("mouseup.keyframe",function(){var t,n,a;e.currentKeyframe=null,F=null,B=null,$("body").off("mouseup.keyframe"),(j.x!==i||j.y!==r)&&(e.update(),n=j.x,a=j.y,t=TAG.TourAuthoring.Command({execute:function(){j.x=n,j.y=a,M(),e.update()},unexecute:function(){j.x=i,j.y=r,M(),e.update()}}),e.undoManager.logCommand(t))})}function a(){var t=X(j.x);G.css({left:t-21-5+"px",top:(e.type!==TAG.TourAuthoring.TrackType.audio?48:j.y)-21-5+"px"}),L.css({left:t-17+"px",top:(e.type!==TAG.TourAuthoring.TrackType.audio?48:j.y)-17+"px"}),O.css("left",t-1.5+"px")}function o(){s(!0)}function s(t,n){h(n);var i,r=TAG.TourAuthoring.Command({execute:function(){i=W.removeKeyframe(U),G.remove(),O.remove(),L.remove(),U.removed=!0,W.getTrack().drawLines(),M(),e.update()},unexecute:function(){l(),W.insertKeyframe(U,i),W.getTrack().drawLines(),M(),e.update()}});r.execute(),t&&e.undoManager.logCommand(r)}function l(){U.removed=!1,n()}function c(t){q=t}function u(){return q}function d(){return N}function h(t){V.close(t)}function p(t){V.open(t)}function f(){e.timeManager.seek(j.x),g()}function g(t){t?(e.selectedKeyframe=U,G.css({"background-color":"white"}),L.css({display:"inherit","background-color":"#296b2f"})):K()}function m(){R=null,e.selectedKeyframe=null,L.css("background-color","white")}function v(){return j.x}function y(t){var n,i=W.getKeyframes(),r=q>0?Math.max(i[q-1].getTime(),W.getStart()):W.getStart(),a=i.length>q+1?Math.min(i[q+1].getTime(),W.getEnd()):W.getEnd();j.x=Math.constrain(t,r+TAG.TourAuthoring.Constants.epsilon,a+TAG.TourAuthoring.Constants.epsilon),n=e.timeManager.timeToPx(j.x),G.css("left",n-21-5+"px"),O.css("left",n-1.5+"px"),L.css("left",n-17+"px"),e.type===TAG.TourAuthoring.TrackType.audio&&W.getTrack().drawLines(),m()}function b(){return j.y}function x(){return w(j.y)}function T(t){j.y=k(Math.constrain(t,0,100)),G.css("top",j.y-21-5+"px"),L.css("top",j.y-17+"px"),e.that.drawLines()}function w(t){return Math.round(100*(100*(TAG.TourAuthoring.Constants.trackHeight-t)/TAG.TourAuthoring.Constants.trackHeight))/100}function k(t){return TAG.TourAuthoring.Constants.trackHeight-t*TAG.TourAuthoring.Constants.trackHeight/100}function A(){return W}function _(){return U.removed}function C(t,n,i){var r;n=n||0,i=i||1/0,!F&&0!==F||!B&&0!==B||!e.currentKeyframe?console.log("Move keyframe called when no keyframe is selected!"):(j.x=Math.constrain(e.timeManager.pxToTime(t.pivot.x-F),Math.max(n,W.getStart())+e.timeManager.pxToTime(TAG.TourAuthoring.Constants.fadeBtnSize+TAG.TourAuthoring.Constants.keyframeStrokeW+TAG.TourAuthoring.Constants.keyframeSize),Math.min(i,W.getEnd())-e.timeManager.pxToTime(TAG.TourAuthoring.Constants.fadeBtnSize+TAG.TourAuthoring.Constants.keyframeStrokeW+TAG.TourAuthoring.Constants.keyframeSize)),(j.x<W.getStart()||j.x>W.getEnd())&&(j.x=(W.getStart()+W.getEnd())/2),n>j.x&&(j.x=n),j.x>i&&(j.x=i),r=e.timeManager.timeToPx(j.x),G.css("left",r-21-5+"px"),O.css("left",r-1.5+"px"),L.css("left",r-17+"px"),e.type===TAG.TourAuthoring.TrackType.audio?(j.y=Math.constrain(t.pivot.y-B,0,TAG.TourAuthoring.Constants.trackHeight),G.css("top",j.y-21-5+"px"),L.css("top",j.y-17+"px"),W.getTrack().drawLines()):j.y=48,m())}function E(t,n,i,r){var a={pivot:{x:t,y:n}};F=0,B=0,e.currentKeyframe=U,C(a,i,r),W.sortKeyframes(),e.update(),F=null,B=null,e.currentKeyframe=null}function S(t){var n;j.x=Math.constrain(j.x+t,W.getStart(),W.getEnd()),n=e.timeManager.timeToPx(j.x),G.css("left",n-21-5+"px"),O.css("left",n-1.5+"px"),L.css("left",n-17+"px"),m()}function M(){var t=e.timeManager.timeToPx(j.x);G.css({left:t-21-5+"px",top:j.y-21-5+"px"}),O.css("left",t-1.5+"px"),L.css({left:t-17+"px",top:j.y-17+"px"}),e.type===TAG.TourAuthoring.TrackType.audio&&W.getTrack().drawLines()}function I(){return Math.constrain((TAG.TourAuthoring.Constants.trackHeight-j.y)/TAG.TourAuthoring.Constants.trackHeight,0,1)}function D(){var t;switch(e.type){case TAG.TourAuthoring.TrackType.artwork:t={offset:j.x-W.getStart(),init:!1,holdDuration:0,state:z};break;case TAG.TourAuthoring.TrackType.image:t={offset:j.x-W.getStart(),init:!1,holdDuration:0,state:z};break;case TAG.TourAuthoring.TrackType.audio:t={offset:j.x-W.getStart(),init:!1,holdDuration:0,state:{sound:{volume:I()}}};break;default:console.log("RIN track type not yet implemented")}return t}function P(t){if(N=t,t.state)z=t.state;else if(t.data){var n=t.data.default,i={x:Number(/Viewport_X='([^']+)'/.exec(n)[1]),y:Number(/Viewport_Y='([^']+)'/.exec(n)[1])},r={x:Number(/Viewport_Width='([^']+)'/.exec(n)[1]),y:Number(/Viewport_Height='([^']+)'/.exec(n)[1])};z={viewport:{region:{center:i,span:r}}}}R&&(function(n){n.execute=function(){z=t,e.update(),R=n,H=!1}}(R),H&&(e.undoManager.logCommand(R),H=!1))}var N,G,O,L,F,B,R,H,U={},z=t.data||{viewport:{region:{center:{x:0,y:0},span:{x:1,y:1}}}},j=t.loc,W=(t.gkey,t.display),q=(t.displayDiv,0),V=TAG.TourAuthoring.EditorMenu({type:TAG.TourAuthoring.MenuType.keyframe,parent:U},e),Y=!1,X=(TAG.TourAuthoring.Constants.keyframeColor,TAG.TourAuthoring.Constants.keyframeLineW,TAG.TourAuthoring.Constants.keyframeStrokeW,TAG.TourAuthoring.Constants.keyframeSize,e.timeManager.timeToPx);e.timeManager.pxToTime,U.position=0,U.removed=!1,n(),U.restoreHandlers=i,U.resetVisuals=a,function(){V.addInput("Time",TAG.TourAuthoring.MenuInputFormats.minSec,v,y),e.type===TAG.TourAuthoring.TrackType.audio&&V.addInput("Volume",TAG.TourAuthoring.MenuInputFormats.percent,x,T),V.addButton("Delete","left",o),V.addButton("Close","right",V.forceClose)}(),U.removeHelper=o,U.remove=s,U.reactivateKeyframe=l,U.updatePosition=c,U.getPosition=u,U.getCaptureData=d,U.closeMenu=h,U.rightTapped=p,U.tapped=f;var K=$.debounce(250,function(){function t(){return TAG.TourAuthoring.Command({execute:function(){},unexecute:function(){z=n,e.update(),e.selectedKeyframe===U&&(R=t(),H=!0)}})}if(e.type!==TAG.TourAuthoring.TrackType.audio){e.selectedKeyframe=U,$(".keyframeInnerCirc").css("background-color","#ffffff"),G.css({"background-color":"white"}),L.css("background-color","#296b2f");var n=z,i=t();R=i}});return U.setSelected=g,U.setDeselected=m,U.getTime=v,U.setTime=y,U.getVolumePx=b,U.getVolume=x,U.setVolume=T,U.isRemoved=_,U.getContainingDisplay=A,U.move=C,U.internalMove=E,U.translate=S,U.scale=M,U.toRIN=D,U.loadRIN=P,U},TAG.Util.makeNamespace("TAG.TourAuthoring.PlaybackControl"),TAG.TourAuthoring.PlaybackControl=function(t){"use strict";function e(t){t.appendChild(r[0])}var n,i={},r=$(document.createElement("div")),a=!1,o=t.undoManager,s=t.timeManager,l=(t.viewer,t.timeline),c=t.root,u=s.getDuration().scale;return function(){function t(){l.getEditInkOn()||(a?s.stop():s.play())}function e(){s.onSeek(k),s.onPlay(k),s.onSizing(k),y.append(w)}function d(t){var e=l.getTrackBody(),n=(l.getTimeRuler(),s.getDuration()),i=n.scale,r=n.end,a=e.width()/r,o=a+t*(TAG.TourAuthoring.Constants.maxZoom-a);if(o=Math.min(Math.max(o,a),TAG.TourAuthoring.Constants.maxZoom),u=i,o!==i){var c,d=e.width(),h=.5*d,p=.45*d,f=s.timeToPx(r),g=o*n.end,m=s.timeToPx(s.getCurrentTime()),v=e.scrollLeft();if(m>=v&&v+d>=m){i>o&&e.scrollLeft(0),o>=a?g>=e.width()&&s.setScale(o):TAG.TourAuthoring.Constants.maxZoom>=o&&s.setScale(o);var y=m-v,b=s.getCurrentPx(),x=b-y;e.scrollLeft(x)}else if(i>o){e.scrollLeft(0),o>=a?g>=e.width()&&s.setScale(o):TAG.TourAuthoring.Constants.maxZoom>=o&&s.setScale(o);var T=(v+h)/f,w=T*g;c=w-h,c+d>g?e.scrollLeft(g-d):0>c?e.scrollLeft(0):e.scrollLeft(c)}else{o>=a?g>=e.width()&&s.setScale(o):TAG.TourAuthoring.Constants.maxZoom>=o&&s.setScale(o);var k=(v+p)/f,A=k*g;c=A-h,c+d>g?e.scrollLeft(g-d):0>c?e.scrollLeft(0):e.scrollLeft(c)}G=t}}function h(t){var e=l.getTimeRuler(),n=l.getTrackBody();t=t||s.getDuration();var i=x.width();if(e.position()){var r=n.width()/s.timeToPx(t.end)*y.width(),a=n.scrollLeft()/s.timeToPx(t.end)*y.width()-2;r&&i!==Math.ceil(r)&&(r+a>y.position().left+y.width()&&(r>y.width()&&(r=y.width()),a=y.position().left+y.width()-r),x.css("width",r+"px")),x.css("left",a+"px")}}function p(){var t=$(document.createElement("div")),e=d3.select(t[0]).append("svg").style("position","absolute").style("left","0px").style("top","-110%").attr("width","0%").attr("height","100%");return n=e.append("g"),n.append("circle").attr("cx","0").attr("cy","80%").attr("r","40%").attr("fill","black").attr("stroke","black").attr("stroke-width","10%").attr("fill-opacity","0"),n.append("line").attr("x1","0").attr("y1","110%").attr("x2","0").attr("y2","210%").attr("pointer-events","none").attr("stroke","black").attr("stroke-width","10%"),t}r.css({"background-color":"rgb(219,218,199)",height:"9.25%",width:"96.95%",bottom:"0%","margin-left":"1.25%",position:"absolute","box-shadow":"0px -16px 14px -14px #888","z-index":"102"}),r.attr("id","playback-controls");var f=$(document.createElement("img"));f.css({"margin-top":"1%","margin-left":"2%",width:"4%",height:"60%",position:"relative",display:"inline-block"}),f.attr("src","images/icons/Play.svg"),f.attr("id","playButton"),f.click(function(){t()}),r.append(f),c.on("keyup",function(e){32===e.keyCode&&t()}),s.onPlayStart(function(){f.attr("src","images/icons/Pause.svg"),a=!0}),s.onStop(function(){f.attr("src","images/icons/Play.svg"),a=!1});var g=$(document.createElement("div"));g.attr("id","playhead-location"),g.css({"margin-left":"12%",height:"100%","margin-top":"1%",width:"37.5%",position:"relative",display:"inline-block","vertical-align":"middle",color:"black"}),r.append(g);var m=$(document.createElement("label"));m.attr("id","playLabel"),m.text("Timeline Overview"),m.css({"font-weight":"600","font-size":TAG.Util.getFontSize(150)}),g.append(m);var v=$(document.createElement("div"));v.attr("id","sliderContainer"),v.css({position:"absolute",width:"40%",height:"100%","margin-top":"-2%",display:"inline-block"}),g.append(v);var y=$(document.createElement("div"));y.attr("id","timelineSlider"),y.css({position:"relative","margin-left":"4%",display:"inline-block",width:"100%",height:"20%",border:"1px","border-style":"solid","border-color":"gray","background-color":"white","margin-top":"8.5%"}),v.append(y);var b=125,x=$(document.createElement("div"));x.attr("id","timelineSliderBox"),x.css({position:"absolute",width:b+"px",height:"130%",border:"2px none black","margin-top":"-2%"}),x.draggable({axis:"x",drag:function(t,e){if(l.getEditInkOn())return!1;var n=y.width()-x.width();e.position.left=Math.constrain(e.position.left,0,n);var i=e.position.left/(n+Math.ceil(x.width()))*l.getTimeRuler().width();l.registerUpdateSlider(null),l.getTrackBody().scrollLeft(i),l.cancelAccel(),l.registerUpdateSlider(h)}}),y.append(x),x.mousedown(function(t){t.stopPropagation()});var T=$(document.createElement("div"));T.css({"background-color":"DarkGreen",top:"10%",height:"80%",position:"absolute",width:"100%",border:"2px solid black"}),x.append(T);var w=p();w.css({height:"155%",width:"0%","margin-top":"-4%",position:"absolute",left:"0%"}),w.attr("id","fader"),w.draggable({axis:"x",drag:function(t,e){if(l.getEditInkOn())return!1;var n=y.width();e.position.left=Math.constrain(e.position.left,0,n);var i=Math.constrain(e.position.left/(n-w.width()),0,1);s.seekToPercent(i)},stop:function(){w.offset().left>y.offset().left+y.width()&&w.css("left",y.width()+"px")}});var k=function(t){w.css("left",(w.offsetParent().width()-w.width())*t.percent+"px")};i.faderUpdate=k,i.updateFader=e,e();var A=$(document.createElement("label"));A.attr("id","playhead-position"),A.css({position:"relative",left:"45%",color:"black",display:"inline-block","font-weight":"600","font-size":TAG.Util.getFontSize(150)}),A.text("0:00/1:00");var _=function(){var t,e,n=s.getCurrentTime(),i=s.getDuration().end;isNaN(n)||isNaN(i)?(t="0:00",e="0:00"):(t=s.formatTime(n),e=s.formatTime(i)),A.text(t+"/"+e)};s.onSeek(_),s.onPlay(_),s.onSizing(_),g.append(A);var C=$(document.createElement("div"));C.css({position:"relative",display:"inline-block",width:"20%",height:"60%","vertical-align":"middle","margin-top":"-1%","margin-right":"2%"}),r.append(C);var E=$(document.createElement("div"));E.attr("id","imgContainer"),E.css({position:"absolute",display:"inline-block",height:"50%"}),C.append(E);var S=$(document.createElement("img"));S.css({"margin-top":"8%","margin-left":"0%",height:"85%",width:"auto",position:"relative",display:"inline-block"}),S.attr("src","images/icons/Lens.svg"),S.attr("id","lensSmall"),S.click(function(){var t=I.position().left-.1*M.width();t>=0?I.css("left",t+"px"):I.css("left","0px");var e=I.position().left/(I.offsetParent().width()-I.width());d(e)}),E.append(S);var M=$(document.createElement("div"));M.attr("id","zoomslider"),M.css({position:"absolute",display:"inline-block",width:"68%",height:"35%","margin-top":"2%","margin-left":"10%","background-color":"rgb(136, 134, 134)","border-radius":"25px"}),M.mousedown(function(t){if(1==t.which){I.css("left",Math.constrain(t.pageX-M.offset().left-I.width()/2,0,M.width()-I.width()));var e=I.position().left/(I.offsetParent().width()-I.width());d(e),I.trigger(t)}}),C.append(M);var I=$(document.createElement("div"));I.attr("id","zoomPoint");var D=s.getDuration().scale,P=1581/s.getDuration().end,N=100*((D-P)/(TAG.TourAuthoring.Constants.maxZoom-P));I.css({"background-color":"white",height:"110%",width:"10%",position:"absolute",top:"-10%",left:N+"%",border:"1px","border-style":"solid","border-color":"gray","border-radius":"50%"}),M.append(I),I.mousedown(function(t){t.stopPropagation()}),I.draggable({axis:"x",containment:"parent",drag:function(){var t=I.position().left/(I.offsetParent().width()-I.width());d(t),l.cancelAccel()}}),$("#timeRuler").livequery(function(){var t=I.position().left/(I.offsetParent().width()-I.width());d(t),$("#timeRuler").expire()});var G=0,O=$(document.createElement("div"));O.attr("id","imgContainer"),O.css({position:"absolute",display:"inline-block",height:"40%","margin-left":"80%"}),C.append(O);var L=$(document.createElement("img"));L.height=1,L.width=1,L.css({"margin-top":"-7%",height:"170%",width:"auto",position:"relative",display:"inline-block"}),L.attr("src","images/icons/Lens.svg"),L.attr("id","lensBig"),L.click(function(){var t=I.position().left+.1*M.width();I.offsetParent().width()-I.width()>=t?I.css("left",t+"px"):I.css("left",I.offsetParent().width()-I.width()+"px");var e=I.position().left/(I.offsetParent().width()-I.width());d(e)}),O.append(L);var F=$(document.createElement("div"));F.css({position:"relative",display:"inline-block",width:"5%",height:"60%","vertical-align":"middle","margin-top":"-1%","margin-right":"2%"}),r.append(F),$("#editor").livequery(function(){h(s.getDuration()),$("#editor").expire()}),s.onSizing(h),l.registerUpdateSlider(h);var B=$(document.createElement("div")),R=$(document.createElement("div"));i.undoRedoInkOnly=R,R.text("Affects Ink Only"),R.css({color:"green","margin-top":"-1%",position:"relative",display:"none","margin-left":"15%","font-weight":"600","font-size":TAG.Util.getFontSize(150)}),B.css({"margin-top":"-2%",position:"relative","z-index":0,height:"60%",width:"15%","vertical-align":"middle",display:"inline-block"}),B.attr("id","undoRedoButtonArea");var H={height:"70%",width:"auto","margin-left":"15%",opacity:"0.4"},U=$(document.createElement("img"));$(U).addClass("undoButton"),U.attr("src","images/icons/Undo.svg"),U.css(H),U.click(function(){o.undo()}),B.append(U),i.undoButton=U;var z=$(document.createElement("img"));$(z).addClass("redoButton"),z.attr("src","images/icons/Redo.svg"),z.css(H),z.click(function(){o.redo()}),B.append(z),i.redoButton=z,B.append(R),r.append(B)}(),i.addToDOM=e,i},TAG.Util.makeNamespace("TAG.TourAuthoring.Tests"),TAG.TourAuthoring.Tests=function(){"use strict";function t(t,e){var n,i,r,a,o,s,l;for(t.addAudioTrack(u[0]),a=t.addArtworkTrack(c[0]),t.addArtworkTrack(c[1]),t.addArtworkTrack(c[2]),o=a.addDisplay(e.timeToPx(0),5),s=a.addDisplay(e.timeToPx(10),5),a.addDisplay(e.timeToPx(30),19),o.internalMove(e.timeToPx(1),0,10,"fade-in",0),o.internalMove(e.timeToPx(4),0,10,"fade-out",0),o.internalMove(e.timeToPx(4),0,10,"main",0),o.internalMove(e.timeToPx(9.8),0,10,"fade-out",0),o.internalMove(e.timeToPx(-1),0,10,"fade-in",0),o.internalMove(e.timeToPx(.25),0,10,"fade-out",0),o.internalMove(e.timeToPx(9.5),0,10,"main",0),o.internalMove(e.timeToPx(100),0,10,"fade-in",0),i=a.getDisplays(),n=0;i.length>n;n++)console.log(n+": "+i[n].getStart());l=i[1].addKeyframe(e.timeToPx(12)),l.internalMove(e.timeToPx(14.5)),s.internalMove(e.timeToPx(15),10,30,"main",0),l.internalMove(e.timeToPx(15.5)),r=t.toRIN(),t.onUpdate()}function e(t,e){var n=t.addArtworkTrack(c[0],"Monet");t.addAudioTrack(u[0],"AudioTest"),n.addDisplay(e.timeToPx(0),5),n.addDisplay(e.timeToPx(10),7),n.addDisplay(e.timeToPx(25),10),t.onUpdate()}function n(t,e){var n,i,r,a=t.addArtworkTrack(c[0],"Haystacks"),o=t.addArtworkTrack(c[1],"Garibaldi Panorama"),s=t.addAudioTrack(u[1],"Audio");a.addDisplay(e.timeToPx(0),4),n=o.addDisplay(e.timeToPx(4),10),a.addDisplay(e.timeToPx(14),5),s.addDisplay(e.timeToPx(0),180),i=n.addKeyframe(e.timeToPx(5)),i.loadRIN("<ZoomableMediaKeyframe Media_Type='SingleDeepZoomImage' Viewport_X='0' Viewport_Y='-0.09984642817137874' Viewport_Width='1' Viewport_Height='0.2109375'/>"),r=n.addKeyframe(e.timeToPx(9)),r.loadRIN("<ZoomableMediaKeyframe Media_Type='SingleDeepZoomImage' Viewport_X='0.021664630037101146' Viewport_Y='0.00045129340904827893' Viewport_Width='0.049606282874006216' Viewport_Height='0.010463825293735686'/>"),n.addKeyframe(e.timeToPx(13)).loadRIN("<ZoomableMediaKeyframe Media_Type='SingleDeepZoomImage' Viewport_X='0.040299281871932956' Viewport_Y='0.00041899765196884864' Viewport_Width='0.049606282874006216' Viewport_Height='0.010463825293735686'/>"),t.onUpdate()}function i(t,e){var n,i,r,a=t.addArtworkTrack(c[0],"Haystacks"),o=t.addArtworkTrack(c[1],"Garibaldi Panorama"),s=t.addAudioTrack(u[1],"Audio");a.addDisplay(e.timeToPx(0),4),n=o.addDisplay(e.timeToPx(4),10),a.addDisplay(e.timeToPx(10),7),s.addDisplay(e.timeToPx(0),180),i=n.addKeyframe(e.timeToPx(5)),i.loadRIN("<ZoomableMediaKeyframe Media_Type='SingleDeepZoomImage' Viewport_X='0' Viewport_Y='-0.09984642817137874' Viewport_Width='1' Viewport_Height='0.2109375'/>"),r=n.addKeyframe(e.timeToPx(9)),r.loadRIN("<ZoomableMediaKeyframe Media_Type='SingleDeepZoomImage' Viewport_X='0.021664630037101146' Viewport_Y='0.00045129340904827893' Viewport_Width='0.049606282874006216' Viewport_Height='0.010463825293735686'/>"),n.addKeyframe(e.timeToPx(13)).loadRIN("<ZoomableMediaKeyframe Media_Type='SingleDeepZoomImage' Viewport_X='0.040299281871932956' Viewport_Y='0.00041899765196884864' Viewport_Width='0.049606282874006216' Viewport_Height='0.010463825293735686'/>"),t.onUpdate()}function r(t){t.loadTour("js/RIN/web/narratives/TAGTest/narrative.js",function(){console.log("TAG RIN data loaded !!! ???")})}function a(){var t="http://cs.brown.edu/research/lads/LADS2.0Data/repository.xml";TAG.Worktop.Database.load(t),o();var e=TAG.Worktop.Database.getAllTours();s(e[0].Identifier),e=TAG.Worktop.Database.getAllTours(),s(o().Identifier),e=TAG.Worktop.Database.getAllTours()}function o(){return tourdoq=TAG.Worktop.Database.createTour()}function s(t){var e=TAG.Worktop.Database.getDoqXML(t),n=new DOMParser,i=$(n.parseFromString(e,"text/xml"));i.find("Name").text("new name"),i.find("d3p1\\:Key:contains('Content') + d3p1\\:Value").text("[]"),i.find("d3p1\\:Key:contains('Thumbnail') + d3p1\\:Value").text("http://www.cs.brown.edu/research/lads/images/waterfallzoom.jpg"),TAG.Worktop.Database.pushXML(i[0],t,"Tour")}function l(t){t.addAudioTrack(u[2],"Audio")}var c=["http://cs.brown.edu/research/lads/LADS2.0Data/Documents/monethay/monet%20haystacks/monet%20haystacks.xml","http://cs.brown.edu/research/lads/LADS2.0Data/Documents/gari/garidz/dz.xml","http://cs.brown.edu/research/lads/LADS2.0Data/Documents/rembrandtself/rembrandt%20self/rembrandt%20self.xml","http://cs.brown.edu/research/lads/LADS2.0Data/Documents/marcdream/marc%20dream/marc%20dream.xml","http://cs.brown.edu/research/lads/LADS2.0Data/Documents/dirck/dirck/dirck.xml","http://10.116.71.58:8086/Images/20121105221815/dz.xml"],u=["http://archive.bsrlive.brown.edu/archives/bsrbonusbeats/kurtboone.mp3","http://archive.bsrlive.brown.edu/archives/bsrbonusbeats/GaribaldiScene43Tour_mastered.mp3","http://archive.bsrlive.brown.edu/archives/bsrbonusbeats/GariEdit.mp3","http://10.116.71.58:8086/Images/20121104223746.mp3"];return{trackEditTest:t,testRINreload:r,testDemo:n,testTrackReload:e,testServer:a,makeDemo:l,testOverlap:i}}(),TAG.Util.makeNamespace("TAG.TourAuthoring.Timeline"),TAG.TourAuthoring.Timeline=function(t){"use strict";function e(){$("#resizeButton").attr("src","images/icons/Ellipsis_gray.svg"),u(!0),$("#multiSelButton").css({color:"gray","border-color":"gray"}),Ee.attr("fill","gray"),Ee.attr("stroke","gray");var t=TAG.Util.constrainAndPosition(Ye.width(),Ye.height(),{center_h:!0,center_v:!0,width:.3,height:.2,max_width:400,max_height:100}),e=TAG.Util.getMaxFontSizeEM("Ink is being edited...",0,t.width-10,t.height,.01);Xe.css({top:t.y+"px",left:t.x+"px",width:t.width+"px",height:t.height+"px","font-size":e,overflow:"hidden"}),Ye.show()}function n(){$("#resizeButton").attr("src","images/icons/Ellipsis_brown.svg"),u(!1),$("#multiSelButton").css({color:"black","border-color":"black"}),Ee.attr("fill","black"),Ee.attr("stroke","black"),Ye.hide()}function i(){var t=[],e=$(document.createElement("div"));e.css({position:"relative","background-color":"rgb(255,255,255)",width:"70%",left:"15%",height:"100%",overflow:"hidden",border:"1px solid gray"}),De=$(document.createElement("div")),De.attr("id","verticalSlider"),De.css({position:"absolute",height:"100px",width:"100%",border:"2px none black",left:"-1px"}),De.draggable({axis:"y",drag:function(t,e){t.stopPropagation(),e.position.top=Math.constrain(e.position.top,0,Pe.height()-De.height()-2);var n=e.position.top/(Pe.height()-De.height()-4),i=n*(s()-Ae.height()+8);Ae.scrollTop(i),Te.scrollTop(i),ye()}}),t.push(e),t.push(De),De.mousedown(function(t){t.stopPropagation()});var n=$(document.createElement("div"));return n.css({"background-color":"DarkGreen",top:"0%",left:"15%",height:"100%",position:"absolute",width:"70%",border:"2px solid black"}),De.append(n),t}function r(t){var e=s(),n=t/e*Pe.height();0>n?n=0:n>Pe.height()-De.height()-2&&(n=Pe.height()-De.height()-2),De.css({top:n+"px"})}function a(){var t=De.height(),e=s(),n=Ae.scrollTop()/e*Pe.height()-4;return 0>n&&(n=0),Pe.height(Te.height()-10),De.scrollTop()!==n?0===e?(Pe.height(Ae.height()-10),De.css({height:Pe.height()+"px",top:"0px"}),o(),void 0):(t!==(Te.height()-4)*Pe.height()/e&&(Te.height()>e?De.css({height:"100%"}):De.css({height:(Te.height()-4)*Pe.height()/e+"px"}),De.css({top:n+"px"})),void 0):void 0}function o(){s()<Te.height()-10?(De.draggable("disable"),De.css({height:"100%"})):(De.draggable("enable"),De.css({height:(Te.height()-4)*Pe.height()/s()+"px"}))}function s(){var t,e=0;for(t=0;je._trackArray.length>t;t++){var n=je._trackArray[t].track;e+=n.getMinimizedState()?TAG.TourAuthoring.Constants.minimizedTrackHeight:TAG.TourAuthoring.Constants.trackHeight}return e+2*je._trackArray.length}function l(t){function e(t){on.add(function(){var e;for(e=t;t+f>=e;e+=a)sn.appendChild(n(e)[0])})}function n(e){var n=(Math.min(e,t.end),Be.formatTime(e)),i=TAG.Util.getFontSize(140),r=Be.timeToPx(e),a=$(document.createElement("div")).addClass("time-label").text(n).css({"border-width":"0px 0px 0px 1px","border-color":"black","border-style":"solid",position:"absolute",left:r+"px","padding-left":"5px","font-size":i,color:"black",height:"100%"});return a}var i,r=t.scale,a=r,o=we.children("div"),s=Date.now();for(on.clear(),sn=document.createDocumentFragment(),o.text(""),Ze=!0,Ae.scrollLeft(Ae.scrollLeft());80>a*r;)a=2*a;for(;a*r>100;)a/=2;a=Math.ceil(a);var l,c=Be.pxToTime(Ae.scrollLeft()),u=c-c%a,d=c+Be.pxToTime(Ae.width()),h=document.createDocumentFragment();for(o.remove(),l=u;d>=l;l+=a)h.appendChild(n(l)[0]);we.append(h);var p=20,f=p*a;for(i=t.start;t.end>=i&&(e(i),i!==t.end);i=Math.min(i+f,t.end));on.add(function(){o.remove(),we.append(sn),console.log("time ruler update elapsed: "+(Date.now()-s))})}function c(){return We}function u(t){We=t}function d(t){t.appendChild(Ie)}function h(t){Me=t}function p(t,e){Me.showEditDraw(t,e),qe=!0}function f(t,e,n){Me.showEditText(t,e,n),qe=!0}function g(t,e,n){Me.showEditTransparency(t,e,n),qe=!0}function m(t){qe=t}function v(){Me.removeInkCanv(),Me.hideInkControls()}function y(t){var e=!1;t&&0===t.getFadeOut()&&(e=!0),je.reInitHeaps();for(var n=0;tn.length>n;n++)tn[n].getTrack().boundHelper(tn[n],e)}function b(){Je=!1,$("#multiSelButton").css({color:"black","background-color":"transparent","border-color":"black"})}function x(){var t=E(),e=t.length;if(0!==t.length){cn=Array(e),y();var n=je._leftExternal.peek(),i=je._rightExternal.peek();n&&(n=n.bound),i&&(i=i.bound);for(var r=0;e>r;r++){cn[r]=Array(5);var a=t[r].getStart()-n,o=t[r].getEnd()+i;cn[r][0]=t[r].getStart(),cn[r][1]=t[r].getMainStart(),cn[r][2]=t[r].getOutStart(),cn[r][3]=a,cn[r][4]=o}}}function T(){ln=[]}function w(){return cn}function k(t,e){b(),y(e);var n,i,r,a,o=je._leftExternal.peek().bound,s=je._rightExternal.peek().bound,l=je._leftInternal.peek().bound,c=je._rightInternal.peek().bound,u=e.getLoc(),d=E(),h=e.getStart()-o,p=e.getEnd()+s,f=e.getTranslation(t,h,p,l,c),g=e.getOffset();if(null===ln[0]||void 0===ln[0]){ln=Array(E().length);for(var m=0;d.length>m;m++)n=d[m].getStart()-o,i=d[m].getEnd()+s,r=d[m].getStart()+l,a=d[m].getEnd()-c,(null===ln[m]||void 0===ln[m])&&(ln[m]=Array(10),ln[m][0]=d[m].getStart(),ln[m][1]=d[m].getMainStart(),ln[m][2]=d[m].getOutStart(),ln[m][3]=n,ln[m][4]=i,ln[m][5]=f,ln[m][6]=u,ln[m][7]=g,ln[m][8]=r,ln[m][9]=a)}e.msMove(d,f)}function A(){return ln}function _(){b();var t=E(),e=E().length;if(t.length>0)for(var n=0;e>n;n++)t[0].getTrack().setDisplayDeselected(t[0],!1);cn=[],ln=[],tn=[]}function C(){return Je}function E(){return tn}function S(){return Le.length}function M(){return Le}function I(){return Ae[0]}function D(){return we}function P(){return $e}function N(t){$e=t}function G(t){un=t}function O(){return un}function L(t){dn=t}function F(t){dn&&setTimeout(dn(t),0)}function B(t){return je.findTrackByTitle(t)}function R(){var t,e=0,n=je.getTracks();for(t=0;n.length>t;t++){var i=je.maxDisplay(n[t].track.getPos()),r=i.display.getFadeOut()+i.display.getOutStart();r>e&&(e=r)}return e}function H(t,e){var n,i,r,a,o,s,l=[],c=-1;e=e||-1;var u=RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？]"),d="";for(n=0;t.length>n;n++)d+=t.substr(n,1).replace(u,"");if(s=RegExp(d+"(?:-([0-9]+))?"),je.mapTracks(function(t){for(i=t.track.getTitle(),o="",a=0;i.length>a;a++)o+=i.substr(a,1).replace(u,"");r=s.exec(o),r&&r[0]===o&&e!==t.track.getID()&&(r[1]?l.push(parseInt(r[1],10)):l.push(-1))}),l.length>0){for(l.sort(function(t,e){return t-e}),n=0;l.length>n;n++){if(l[n]+1!==n){c=n-1;break}c++}return-1!==c?t+"-"+c:t}return t}function U(t,e,n,i){n=n||(je.getSelectedTrack()?je.getSelectedTrack().getPos():0);var r,a={dataHolder:je,media:t,mediaLength:i,root:Re,id:n,title:H(e),timeManager:Be,undoManager:Ue,update:me,timeline:Ne,trackarray:Le,selectedTrack:Ve},o=TAG.TourAuthoring.AudioTrack(a),s=TAG.TourAuthoring.Command({execute:function(){V(o),je.insertTrack(o,r),o.setTitle(o.getTitle())},unexecute:function(){r=o.getPos(),Y(o)}});return V(o),je.insertTrack(o,n),r=o.getPos(),e&&o.setTitle(e),Ue.logCommand(s),o}function z(t,e,n,i){n=n||(je.getSelectedTrack()?je.getSelectedTrack().getPos():0);var r,a={dataHolder:je,media:t,mediaLength:i,root:Re,id:n,title:H(e),timeManager:Be,undoManager:Ue,update:me,timeline:Ne,trackarray:Le,selectedTrack:Ve},o=TAG.TourAuthoring.VideoTrack(a),s=TAG.TourAuthoring.Command({execute:function(){V(o),je.insertTrack(o,r),o.setTitle(o.getTitle())},unexecute:function(){r=o.getPos(),Y(o)}});return V(o),je.insertTrack(o,n),r=o.getPos(),e&&o.setTitle(e),Ue.logCommand(s),o}function j(t,e,n,i){i=i||(je.getSelectedTrack()?je.getSelectedTrack().getPos():0);var r,a={dataHolder:je,media:t,root:Re,id:i,guid:n,title:H(e),timeManager:Be,undoManager:Ue,update:me,timeline:Ne,trackarray:Le,selectedTrack:Ve},o=TAG.TourAuthoring.ArtworkTrack(a),s=TAG.TourAuthoring.Command({execute:function(){V(o),je.insertTrack(o,r)},unexecute:function(){r=o.getPos(),Y(o)}});return V(o),je.insertTrack(o,i),r=o.getPos(),Ue.logCommand(s),o}function W(t,e,n){n=n||(je.getSelectedTrack()?je.getSelectedTrack().getPos():0);var i,r={dataHolder:je,media:t,root:Re,id:n,title:H(e),timeManager:Be,undoManager:Ue,update:me,timeline:Ne,trackarray:Le,selectedTrack:Ve},a=TAG.TourAuthoring.ImageTrack(r),o=TAG.TourAuthoring.Command({execute:function(){V(a),je.insertTrack(a,i),a.setTitle(a.getTitle())},unexecute:function(){i=a.getPos(),Y(a)}});return V(a),je.insertTrack(a,n),i=a.getPos(),e&&a.setTitle(e),Ue.logCommand(o),a}function q(t,e,n,i,r){var a=je.getSelectedTrack();r||(r=a?a.getPos():t?t.getPos():0);var o,s={dataHolder:je,media:n,root:Re,inkSpec:i,id:r,title:H(e),timeManager:Be,undoManager:Ue,update:me,timeline:Ne,trackarray:Le,selectedTrack:Ve},l=TAG.TourAuthoring.InkTrack(s),c=TAG.TourAuthoring.Command({execute:function(){V(l),je.insertTrack(l,o),l.setTitle(l.getTitle())},unexecute:function(){o=l.getPos(),Y(l)}});return V(l),je.insertTrack(l,r),o=l.getPos(),e&&l.setTitle(e),Ue.logCommand(c),l}function V(t){t.addTitleToDOM(Te),t.addEditorToDOM(Ae)}function Y(t){je.removeTrack(t),t.updatePos(t.getPos()),t.getType()===TAG.TourAuthoring.TrackType.ink&&t.getInkEnabled()&&t.getInkLink().removeAttachedInkTrack(t),t.detach(),je.mapTracks(function(t,e){t.track.updatePos(e)}),me()}function X(t,e){Te.prepend(e),Ae.prepend(t)}function K(){return je.numTracks()}function Z(){var t,e=[];return je.mapTracks(function(n){t=n,t.track.getType()===TAG.TourAuthoring.TrackType.artwork&&e.push(t.track.getGUID())}),e}function Q(){return Ae}function J(){return _e}function te(){for(var t=0;je._trackArray.length>t;t++){var e=je._trackArray[t].track;if(e.getType()===TAG.TourAuthoring.TrackType.artwork||e.getType()===TAG.TourAuthoring.TrackType.image)return!0}return!1}function ee(){Me.disableInk()}function ne(t){hn=t}function ie(){return hn}function re(){Oe=!0,Ue.setInitialized(!0)}function ae(t,e,n){for(var i=0;je._trackArray.length>i;i++){var r=je._trackArray[i].track;if(r.getTitle()===t){r.receiveKeyframe(e,n);break}}}function oe(){je.mapTracks(function(t){t.track.deselectKeyframe()})}function se(t){return ze.captureKeyframe(t)
}function le(){return ze}function ce(){return je}function ue(){var t={},e="TAGAuthoringPreview";return t.version="1.0",t.defaultScreenplayId="SCP1",t.screenplayProviderId="screenplayProvider",t.data={narrativeData:{guid:"e3ced195-0c8b-48f6-b42c-f989e52b4f03",timestamp:(new Date).toISOString(),title:e,author:"TAG Authoring Tool",aspectRatio:"WideScreen",estimatedDuration:Be.getDuration().end,description:"TAG Tour",branding:"TAG"}},t.providers={ZMES:{name:"MicrosoftResearch.Rin.ZoomableMediaExperienceStream",version:"1.0"},AES:{name:"MicrosoftResearch.Rin.AudioExperienceStream",version:"1.0"},screenplayProvider:{name:"MicrosoftResearch.Rin.DefaultScreenplayProvider",version:"1.0"},FadeInOutTransitionService:{name:"MicrosoftResearch.Rin.FadeInOutTransitionService",version:"1.0"},InkES:{name:"MicrosoftResearch.Rin.InkExperienceStream",version:"0.0"},VideoES:{name:"MicrosoftResearch.Rin.VideoExperienceStream",version:0},ImageES:{name:"MicrosoftResearch.Rin.ImageExperienceStream",version:"1.0"}},t.resources=de(),t.experiences=he(),t.screenplays={SCP1:{data:{experienceStreamReferences:pe()}}},t}function de(){var t={};return je.mapTracks(function(e){e.track.addResource(t)}),t}function he(){var t={};return je.mapTracks(function(e){e.track.addES(t)}),t}function pe(){var t=[];return je.mapTracks(function(e){e.track.addScreenPlayEntries(t)}),t.sort(function(t,e){return t.begin-e.begin}),t}function fe(t){Ge=t}function ge(){Fe+=1,Be.stop();var t;Oe&&(ze.setIsReloading(!0),Be.stop(),ze.capturingOff(),oe(),t=ue(),ze.reloadTour(t)),a(),o()}function me(t){t?ge():pn()}function ve(t,e){function n(t,e){var n,i,r,a=t.exp.data.zIndex,o=e.exp.data.zIndex,s=t.exp.experienceStreams,l=e.exp.experienceStreams;if(!a)for(r in s)if(s.hasOwnProperty(r)){n=s[r],n&&(a=n.data.zIndex);break}if(!o)for(r in l)if(l.hasOwnProperty(r)){i=l[r],i&&(o=i.data.zIndex);break}return a?o?o-a:-1:o?1:0}function i(t,e){G.add(function(){a(t,e)})}function r(t,e){Re.append(Ke),Ke.attr("id","deleteConfirmationOverlay"),Ke.css({display:"none",position:"absolute",top:0,left:0,width:"100%",height:"100%","background-color":"rgba(0,0,0,0.6)","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex});var n=$(document.createElement("div"));n.attr("id","deleteConfirmation"),n.css({position:"absolute",left:"32.5%",width:"35%",top:"30%",border:"3px double white","background-color":"black",padding:"2.5% 2.5%"}),Ke.append(n);var i=$(document.createElement("div"));i.attr("id","dialogTitle"),i.css({color:"white","font-size":"1.25em","margin-bottom":"10px","word-wrap":"normal"}),n.append(i),n.append(document.createElement("br"));var r=$(document.createElement("div"));r.css({"margin-top":"10px","text-align":"center"}),n.append(r);var a=$(document.createElement("button"));a.css({width:"auto",border:"1px solid white",padding:"1%","margin-right":"3%"}),a.text("Continue"),$(a).click(function(){var t=e.removeAttachedInkDisplays();e.removeDisplay(!0),t>0&&Ue.combineLast(t+1),Ke.fadeOut(500)}),r.append(a);var o=$(document.createElement("button"));o.css({width:"auto",border:"1px solid white",padding:"1%"}),o.text("Cancel"),o.click(function(){Ke.fadeOut(500)}),r.append(o),Ke.fadeIn(500),i.text('Deleting the last display in track "'+t+'" will disable all attached ink tracks. Any existing ink displays will not function until a new artwork display has been created at an overlapping time.')}function a(t,e){if(p=t.name,f=t.exp,_=f.providerId,E=f.data.zIndex,0!==f.resourceReferences.length&&(o=f.resourceReferences[0].resourceId),k=null,"ZMES"===_?k=j(F[o].uriReference,p,f.data.guid,e):"ImageES"===_?k=W(F[o].uriReference,p,e):"VideoES"===_?(b=f.data.mediaLength,k=z(F[o].uriReference,p,e,b)):"AES"===_?(b=f.data.mediaLength,k=U(F[o].uriReference,p,e,b)):"InkES"===_?(k=q(null,p,1,null,e),k.setInkPath(f.data.linkToExperience.embedding.element.datastring.str),k.setInkEnabled(f.data.linkToExperience.embedding.enabled),k.setInkInitKeyframe(f.data.linkToExperience.embedding.initKeyframe),k.setInkRelativeArtPos(f.data.linkToExperience.embedding.initproxy),k.link=f.data.linkToExperience.embedding.experienceId,k.addInkTypeToTitle(f.data.linkToExperience.embedding.element.datastring.str.split("::")[0].toLowerCase()),O.push({track:k,link:f.data.linkToExperience.embedding.experienceId})):console.log("Experience not yet implemented"),k.getPos()!==d.length-E&&console.log("zIndex and track array position are not the same for: "+p),k){S=f.experienceStreams;for(var n in S)if(S.hasOwnProperty(n))for(m=n+"",g=S[n],C=g.duration,l=0;H.length>l;l++)if(v=H[l],v.experienceStreamId===m){if(x=v.begin,g.data.transition&&g.data.transition.providerId?(T=g.data.transition.inDuration,w=g.data.transition.outDuration):(T=0,w=0),A=k.addDisplay(Be.timeToPx(x)),A.setMain(C),A.setIn(T),A.setOut(w),"InkES"!==f.providerId&&"VideoES"!==f.providerId)for(y=g.header.defaultKeyframeSequence,M=g.keyframes,c=0;M.length>c;c++)I=M[c],I.init||(P=Be.timeToPx(I.offset+A.getStart()),"ZMES"===_||"ImageES"===_?(D=A.addKeyframe(P,TAG.TourAuthoring.Constants.trackHeight/2),D&&D.loadRIN(I)):"AES"===_?(u=I.state.sound.volume,u=Math.constrain(TAG.TourAuthoring.Constants.trackHeight-TAG.TourAuthoring.Constants.trackHeight*u,0,TAG.TourAuthoring.Constants.trackHeight),D=A.addKeyframe(P,u),D&&k.addKeyframeToLines(D)):"VideoES"===_||console.log("Experience not yet implemented"));break}}}var o,s,l,c,u,d,h,p,f,g,m,v,y,b,x,T,w,k,A,_,C,E,S,M,I,D,P,N,G=TAG.Util.createQueue(),O=[],L=t.data.narrativeData,F=t.resources,R=t.experiences,H=t.screenplays.SCP1.data.experienceStreamReferences;Be.setEnd(L.estimatedDuration),h=t.screenplays.SCP1.data.experienceStreamReferences,d=[];for(s in R)R.hasOwnProperty(s)&&d.push({name:s+"",exp:R[s]});for(d.sort(n),s=0;d.length>s;s++)i(d[s],s);G.add(function(){var t,e;for(l=0;O.length>l;l++)N=B(O[l].link),O[l].track.setInkLink(N),O[l].track.getInkEnabled()&&je.mapDisplays(O[l].track.getStorageContainer(),function(n){e=N.getStorageContainer().displays.nearestNeighbors(n.display.getStart(),1),t=e[0].display,n.display.setParentDisplay(t),t.addChildDisplay(n.display)}),N&&N.addAttachedInkTrack(O[l].track)}),je.mapTracks(function(t,e){t.track.updatePos(e)}),G.add(function(){re()}),G.add(function(){setTimeout(ze.resize,1),"function"==typeof e&&e()}),Ne.confirmDeleteDisableInk=r}function ye(){He.ruler.cancelAccel(),He.track.cancelAccel()}var be,xe,Te,we,ke,Ae,_e,Ce,Ee,Se,Me,Ie,De,Pe,$e,Ne={},Ge=!1,Oe=!1,Le=[],Fe=0,Be=(t.playbackControls,t.timeManager),Re=t.root,He={},Ue=t.undoManager,ze=t.viewer,je=t.dataHolder,We=(Be.getDuration().scale,!1),qe=!1,Ve={current:null};Ne.isMenuOpen=!1;var Ye=$(TAG.Util.UI.blockInteractionOverlay());Ye.addClass("editInkOverlay");var Xe=$(document.createElement("div"));Xe.text("Ink is being edited...");var Ke=$(document.createElement("div"));Ne.editInkOn=!1,Ne.clamped_displays=[],ze.setTimeline(Ne);var Ze=!0,Qe=!0,Je=!1,tn=[],en=.995*$(window).width(),nn=.4825*$(window).height(),rn=.127*$(window).width(),an=nn-5-TAG.TourAuthoring.Constants.timeRulerSize;(function(){function t(){Be.seek(Be.pxToTime(Be.getCurrentPx()+Ae.scrollLeft()))}function e(t){h=t}be=$(document.createElement("div")),be.attr("class","mainScrollHider"),be.css({"background-color":"rgb(219,218,199)",overflow:"hidden",height:nn+"px",width:en+"px","margin-top":"3%",position:"relative"}),xe=$(document.createElement("div")),xe.attr("id","editor"),xe.css({height:"100%",width:"100%",overflow:"hidden"});var n=$(document.createElement("div"));n.attr("id","trackScrollVeil"),n.css({width:rn+20+"px",height:an+"px","margin-left":.02*$(window).width()-20+"px","overflow-x":"hidden","overflow-y":"hidden","float":"left",clear:"left",top:"0px",position:"relative"}),Te=$(document.createElement("div")),Te.attr("id","trackTitleWrapper"),Te.css({width:rn+20+"px",height:"100%","margin-left":"1.5%",position:"relative","overflow-x":"hidden","overflow-y":"hidden","z-index":"102","background-color":"rgb(219, 218, 199)"}),Ae=$(document.createElement("div")),Ae.attr("id","trackBody"),Ae.css({height:an+"px","margin-left":"15%","overflow-x":"hidden","overflow-y":"hidden",position:"relative"}),we=$(document.createElement("div")),we.css({position:"relative",height:TAG.TourAuthoring.Constants.timeRulerSize+17+"px","overflow-x":"hidden","overflow-y":"hidden"}),we.attr("id","timeRuler"),ke=$(document.createElement("div")),ke.attr("id","timeline"),ke.css({height:"200%",width:"97%",overflow:"hidden",position:"relative"});var o=$(document.createElement("div"));o.attr("id","horizBlock"),o.css({height:TAG.TourAuthoring.Constants.timeRulerSize+"px",width:"15.5%","background-color":"rgb(219,218,199)",position:"absolute","z-index":"102"});var l=$(document.createElement("div"));l.attr("id","vertBlock"),l.css({height:"100%",width:"1.5%","background-color":"rgb(219,218,199)",position:"absolute","z-index":"102"});var u=$(document.createElement("div"));u.attr("id","rulerScrollVeil"),u.css({height:TAG.TourAuthoring.Constants.timeRulerSize+"px",width:"85%","margin-left":"15.4%","overflow-x":"hidden","overflow-y":"hidden"});var d=$(document.createElement("div"));d.attr("id","rulerWrapper"),d.css({width:"85%",height:TAG.TourAuthoring.Constants.timeRulerSize+"px","overflow-x":"hidden","overflow-y":"hidden",position:"absolute","z-index":"100","box-shadow":"-7px 5px 10px #888"}),Ne.faderUpdate=t,He.ruler=TAG.Util.makeManipulatable(d[0],{onManipulate:function(t){d.scrollLeft(d.scrollLeft()-t.translation.x),He.track.cancelAccel()},onScroll:function(t){var e=O();e&&e(),1.1===t?d.scrollLeft(d.scrollLeft()-30):d.scrollLeft(d.scrollLeft()+30),He.track.cancelAccel()},onTapped:function(t){return qe?!1:(Be.seek(Be.pxToTime(t.position.x+Ae.scrollLeft())),void 0)}}),He.track=TAG.Util.makeManipulatable(Ae[0],{onManipulate:function(t){if(He.ruler.cancelAccel(),0!==t.translation.x&&(console.log("trans = "+t.translation.x),console.log("pivot = "+t.pivot.x),Ae.scrollLeft(Ae.scrollLeft()-t.translation.x)),0!==t.translation.y&&s()>Ae.height()){var e=Ae.scrollTop()-t.translation.y;Ae.scrollTop(e),r(e)}}}),d.scroll(function(){Ze?(Ze=!1,Ae.scrollLeft(d.scrollLeft())):Ze=!0}),Te.scroll(function(){Qe?(Qe=!1,Ae.scrollTop(Te.scrollTop()),r(Te.scrollTop())):Qe=!0}),Ae.scroll(function(){if(Ze?(Ze=!1,d.scrollLeft(Ae.scrollLeft())):Ze=!0,h&&h(),x(),Qe){if(Qe=!1,s()<Ae.height())return;Te.scrollTop(Ae.scrollTop()),a(),r(Te.scrollTop())}else Qe=!0});var h=null;Ne.registerUpdateSlider=e;var p=function(t){we.css("width",Be.timeToPx(t.end)+"px")};p(Be.getDuration()),Be.onSizing(p);var f=$(document.createElement("div"));f.addClass("multiSelButtonPanel"),f.css({top:"12.5%",left:"25%",position:"relative",width:"60%",height:"75%","float":"left","z-index":"5"});var g=$(document.createElement("button"));g.attr("type","button"),g.attr("id","multiSelButton"),g.text("Multi-Select"),g.attr("type","button"),g.css({color:"black","border-color":"black",left:"5%",top:"3%",position:"absolute","font-size":"120%","float":"left",width:"100%"}),$(g).click(function(){return c()===!0?!1:(Je===!0?(Je=!1,g.css({color:"black","background-color":"transparent","border-color":"black"})):(Je=!0,g.css({color:"white","background-color":"darkgreen","border-color":"white"})),void 0)}),Ye.css({top:TAG.Util.Constants.timeRulerSize,width:"100%",height:"100%","margin-left":"2%",position:"absolute","z-index":"10000","background-color":"rgba(0, 0, 0, 0.5)"}),Xe.css({position:"relative",left:"33.5%",top:"35%","font-size":"22pt"}),Ye.hide(),Pe=$(document.createElement("div")),Pe.attr("id","verticalSliderPane"),Pe.css({position:"absolute",left:"97.35%",top:"54px",display:"inline-block",width:"1%",height:an-8+"px"});var m=i(Pe);Pe.append(m[0]),Pe.append(m[1]),Ie=document.createDocumentFragment(),Ie.appendChild(be[0]),be.append(xe),xe.append(ke),f.append(g),o.append(f),ke.append(o),ke.append(l),ke.append(u),u.append(d),d.append(we),xe.append(Pe),xe.append(Ye),Ye.append(Xe),ke.append(n),n.append(Te),ke.append(Ae);var v=nn-5,y=en-17;be.css({height:v+"px",width:y+"px"}),g.fitText(.8),_e=d3.select(ke[0]).append("svg").style("position","absolute").style("left","0px").style("top","0px").attr("id","playhead").attr("width","0%").style("z-index","101").attr("height","100%"),_e[0][0],Ce=_e.append("g").attr("transform","translate(5,0)"),Ce[0][0],Ee=Ce.append("circle").attr("cx","0").attr("cy","27px").attr("r","18px").attr("fill","black").attr("stroke","black").attr("stroke-width","7px").attr("fill-opacity","0"),Se=Ce.append("line").attr("x1","0").attr("y1","45px").attr("x2","0").attr("y2","100%").attr("pointer-events","none").attr("stroke","black").attr("stroke-width","1px");var b=$("body");Ce.on("mousedown",function(){var t,e,n;t=d3.mouse(b[0])[0],e=Be.getCurrentPx(),b.on("mousemove.playhead",function(i){return We===!0?!1:(n=e+(i.pageX-t),n>$("#timeRuler").width()?n=$("#timeRuler").width():0>n?n=0:t=i.pageX,Be.seek(Be.pxToTime(n)),e=n,void 0)}),b.on("mouseup.playhead",function(){b.off("mousemove.playhead"),b.off("mouseup.playhead")})});var x=function(){var t=Be.getCurrentPx();Ce.attr("transform","translate("+(t+.15*xe.width()-Ae.scrollLeft())+")")};Be.onSeek(x),Be.onSizing(x),Be.onPlay(x)})(),Ne.showEditorOverlay=e,Ne.hideEditorOverlay=n,Ne.updateVerticalScroller=a,Ne.enableDisableDrag=o;var on=TAG.Util.createQueue(),sn=$();l(Be.getDuration()),Be.onSizing(function(t){we.children("div").text(""),setTimeout(function(){l(t)},2)}),Ne.getEditInkOn=c,Ne.setEditInkOn=u,Ne.addToDOM=d,Ne.selectedTrack=Ve,Ne.setCompControl=h,Ne.showEditDraw=p,Ne.showEditText=f,Ne.showEditTransparency=g,Ne.setModifyingInk=m,Ne.removeInkSession=v,Ne.getMSBounds=y,Ne.turnOffMS=b;var ln=[],cn=[];Ne.updateOldData=x,Ne.newDataArray=T,Ne.getOldData=w,Ne.moveSelect=k,Ne.getDisplayData=A,Ne.allDeselected=_,Ne.getMultiSelection=C,Ne.getMultiSelectionArray=E,Ne.getTrackslength=S,Ne.getTracks=M,Ne.getTimelineArea=I,Ne.getTimeRuler=D,Ne.getisMenuOpen=P,Ne.setisMenuOpen=N;var un;Ne.setCloseMenu=G,Ne.getCloseMenu=O;var dn;Ne.setCloseableFunction=L,Ne.getCloseableFunction=F,Ne.getLastDisplayTime=R,Ne.fixTrackTitle=H,Ne.addAudioTrack=U,Ne.addVideoTrack=z,Ne.addArtworkTrack=j,Ne.addImageTrack=W,Ne.addInkTrack=q,Ne.removeTrack=Y,Ne.prependAddToDom=X,Ne.getNumTracks=K,Ne.getRelatedArtworks=Z,Ne.getTrackBody=Q,Ne.getPlayhead=J,Ne.checkForArtworks=te,Ne.disableInk=ee;var hn=!0;Ne.setFadeHidden=ne,Ne.isFadeHidden=ie,Ne.setLoaded=re,Ne.receiveKeyframe=ae,Ne.capturingOff=oe,Ne.captureKeyframe=se,Ne.getViewer=le,Ne.getDataHolder=ce,Ne.toRIN=ue,Ne.setTourExited=fe;var pn=$.debounce(200,ge);return Ne.onUpdate=me,Ne.loadRIN=ve,Ne.cancelAccel=ye,Ne},TAG.Util.makeNamespace("TAG.TourAuthoring.TopMenu"),TAG.TourAuthoring.TopMenu=function(t){"use strict";function e(t){t.append(d).append(h).append(p)}var n={},i=t.viewer,r=t.undoManager,a=t.timeline,o=t.timeManager,s=t.tourobj,l=t.playbackControls,c=t.root,u=t.componentControls,d=$(document.createElement("div")),h=$(TAG.Util.UI.blockInteractionOverlay()),p=$(TAG.Util.UI.blockInteractionOverlay());return function(){function t(t){console.log("isUploading === "+u.getIsUploading()),m=!0,v=!1,"none"!==$("#inkEditText").css("display")?u.saveText():"none"!==$("#inkEditDraw").css("display")?u.saveDraw():"none"!==$("#inkEditTransparency").css("display")&&u.saveTrans(),a.hideEditorOverlay(),r.setPrevFalse();var n=_.val(),i=JSON.stringify(a.toRIN(!0)),o=JSON.stringify(a.getRelatedArtworks()),l={Name:n,Content:i,RelatedArtworks:o};TAG.Worktop.Database.changeTour(s,l,function(){h.fadeOut(500),!t&&e()},function(){h.hide();var t=TAG.Util.UI.popUpMessage(null,"Tour not saved.  You must log in to save changes.");$("body").append(t),$(t).show()},function(t,e){e.force()},function(){h.hide();var t=TAG.Util.UI.popUpMessage(null,"Tour not saved.  There was an error contacting the server.");$("body").append(t),$(t).show()})}function e(){var t;if(i.getIsReloading())return t=TAG.Util.UI.popUpMessage(null,"Tour reload in progress. Please wait a few moments.",null),$(t).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3),$("body").append(t),$(t).fadeIn(500),void 0;g.off("click"),$(".rightClickMenu").hide();var e=new TAG.Authoring.NewSettingsView("Tours",null,null,s.Identifier);i.stop(),i.unload(),TAG.Util.UI.slidePageRight(e.getRoot())}d.css({"background-color":"rgb(63,55,53)",height:"8%",width:"100%"}),d.attr("id","topbar");var n=.0504*$(window).height(),f=$(document.createElement("div"));f.css({top:"18.5%","margin-left":"1.2%",height:"63%",width:n+"px",position:"relative","float":"left"});var g=$(document.createElement("img"));g.attr("src","images/icons/Back.svg"),g.css({width:"100%",height:"100%"}),g.mousedown(function(){TAG.Util.UI.cgBackColor("backButton",g,!1)}),g.mouseleave(function(){TAG.Util.UI.cgBackColor("backButton",g,!0)});var m=!1,v=!1;p.attr("id","backDialogOverlay"),p.css({display:"none",position:"absolute",top:0,left:0,width:"100%",height:"100%","background-color":"rgba(0,0,0,0.6)","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex});var y=$(document.createElement("div"));y.attr("id","backDialog");var b=TAG.Util.constrainAndPosition($(window).width(),$(window).height(),{center_h:!0,center_v:!0,width:.5,height:.35,max_width:560,max_height:200});y.css({position:"absolute",left:b.x+"px",top:b.y+"px",width:b.width+"px",height:b.height+"px",border:"3px double white","background-color":"black"}),p.append(y);var x=$(document.createElement("div"));x.attr("id","backDialogTitle"),x.css({color:"white",width:"80%",height:"15%",left:"10%",top:"12.5%","font-size":"1.25em",position:"relative","text-align":"center","word-wrap":"break-word"}),y.append(x),y.append(document.createElement("br"));var T=$(document.createElement("div"));T.css({position:"relative",display:"block",width:"80%",left:"10%",top:"40%"});var w=$(document.createElement("button"));w.css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","margin-top":"1%"}),w.text("Save"),$(w).click(function(){t()}),T.append(w);var k=$(document.createElement("button"));k.css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","margin-top":"1%",left:"20%"}),k.text("Don't Save"),$(k).click(function(){e()}),T.append(k);var A=$(document.createElement("button"));A.css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","margin-top":"1%","float":"right"}),A.text("Cancel"),A.click(function(){p.fadeOut(500)}),T.append(A),y.append(T),g.click(function(){var t;return $(".rightClickMenu").hide(),i.getIsReloading()?(t=TAG.Util.UI.popUpMessage(null,"Tour reload in progress. Please wait a few moments.",null),$(t).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3),$("body").append(t),$(t).fadeIn(500),void 0):(v||r.dirtyStateGetter()===!1||u.getInkUndoManager()&&u.getInkUndoManager().dirtyStateGetter()===!1?(p.fadeIn(500),0===_.val().length&&_.val("Untitled Tour 1"),x.text("Save changes to "+$(_).val()+" before leaving?")):e(),void 0)}),f.append(g),d.append(f);var _=$(document.createElement("input"));_.type="text";var C=TAG.Util.constrainAndPosition($(window).width(),.08*$(window).height(),{center_v:!0,width:.2,height:.5,x_offset:.05,x_max_offset:60});_.css({"margin-left":"3%",position:"absolute",border:"3px solid","border-color":"#666666",top:C.y-7+"px",left:C.x+"px",width:C.width+"px",height:C.height+"px"}),_.attr({display:"block",type:"text",id:"textArea",name:"textArea",value:s.Name}),_.on("keydown",function(t){t.stopImmediatePropagation()}),_.on("keypress",function(t){t.stopImmediatePropagation()}),_.on("keyup",function(t){v=!0,t.stopImmediatePropagation()}),d.append(_);var E=$(document.createElement("button"));E.text("Save Changes"),E.attr("type","button");var S=TAG.Util.constrainAndPosition(.8*$(window).width(),.08*$(window).height(),{center_v:!0,width:.1,height:.5}),M=TAG.Util.getMaxFontSizeEM("Save Changes",.2,.75*S.width,.75*S.height,.01);E.css({color:"white","border-color":"white",position:"absolute",width:S.width+"px",height:S.height+"px",top:S.y+"px","font-size":M,left:parseInt(_.css("left"),10)+_.width()+45+.022*$(window).width()+"px"}),d.append(E),h.attr("id","dialogOverlay"),h.css({display:"none",position:"absolute",top:0,left:0,width:"100%",height:"100%","background-color":"rgba(0,0,0,0.6)","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex});var I=$(document.createElement("div"));I.attr("id","saveDialog");var D=TAG.Util.constrainAndPosition($(window).width(),$(window).height(),{center_h:!0,center_v:!0,width:.5,height:.35,max_width:560,max_height:200});I.css({position:"absolute",left:D.x+"px",top:D.y+"px",width:D.width+"px",height:D.height+"px",border:"3px double white","background-color":"black"}),h.append(I);var P=$(document.createElement("div"));P.attr("id","dialogTitle"),P.css({color:"white",width:"80%",height:"15%",left:"10%",top:"12.5%","font-size":"1.25em",position:"relative","text-align":"center","word-wrap":"break-word"}),I.append(P),I.append(document.createElement("br"));var N=$(document.createElement("div"));N.css({position:"relative",display:"block",width:"80%",left:"10%",top:"40%"}),I.append(N);var G=$(document.createElement("button"));G.css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","margin-top":"1%"}),G.text("Save"),G.click(function(){t(!0)}),N.append(G);var O=$(document.createElement("button"));O.css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","margin-top":"1%","float":"right"}),O.text("Cancel"),O.click(function(){h.fadeOut(500)}),N.append(O),E.click(function(){$(".rightClickMenu").hide(),h.fadeIn(500),0===_.val().length&&_.val("Untitled Tour 1"),P.text("Save changes to "+_.val()+"?")});var L=TAG.TourAuthoring.TourOptions({timeManager:o,timeline:a,root:c,undoManager:r,playbackControls:l,tour:s});L.addToDOM(d);var F=TAG.Util.constrainAndPosition($(window).width(),.08*$(window).height(),{center_v:!0,width:.13,height:.8}),B=TAG.Util.getMaxFontSizeEM("Options",.5,.8*F.width,.7*F.height,.01),R=TAG.Util.constrainAndPosition(F.width,F.height,{center_v:!0,width:.8,height:.8});L.applyCSS({height:F.height+"px",width:F.width+"px",left:"60%",top:F.y+"px",position:"absolute"}),L.applyLabelCSS({height:R.height+"px",width:R.width+"px",left:"0px",top:R.y+"px",position:"absolute","font-size":B});var H=$(document.createElement("div")),U=TAG.Util.constrainAndPosition($(window).width(),.08*$(window).height(),{width:.4,height:.9});H.css({"margin-right":"2%","margin-top":"0.32%",color:"white",position:"absolute","text-align":"right",right:"0px",top:"0px",height:U.height+"px",width:U.width+"px"});var z=TAG.Util.getMaxFontSizeEM("Tour Authoring",.5,U.width,.85*U.height);H.css({"font-size":z}),H.text("Tour Authoring"),d.append(H)}(),n.addToDOM=e,n},TAG.Util.makeNamespace("TAG.TourAuthoring.TourOptions"),TAG.TourAuthoring.TourOptions=function(t){"use strict";function e(t){l.css(t)}function n(t){a.css(t)}function i(t){t.append(l).append(g),t.append(l).append(m)}function r(){var t=v;return v={},t}var a,o,s,l=$(document.createElement("div")),c={},u=t.tour,d=(t.playbackControls,t.timeManager),h=t.timeline,p=t.root,f=t.undoManager,g=$(TAG.Util.UI.blockInteractionOverlay()),m=$(document.createElement("div")),v={};return function(){function t(t,e,n){var i=$(document.createElement("label"));return i.addClass("optionItem"),i.attr("id",n),i.text(t),i.css({left:"0%",position:"relative","font-size":TAG.Util.getFontSize(170),color:"rgb(256, 256, 256)",display:"block",padding:"4% 0 5% 0","text-indent":"4%","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex+5}),i.on("mousedown",function(t){t.stopImmediatePropagation()}),e.append(i),i}function e(){g.hide();var t=TAG.Util.UI.popUpMessage(null,"Thumbnail not saved.  You must log in to save changes.");$("body").append(t),$(t).show(),setTimeout(function(){m.fadeOut()},1e3)}function n(t,e){e.force()}function i(){g.hide();var t=TAG.Util.UI.popUpMessage(null,"Thumbnail not saved.  There was an error contacting the server.");$("body").append(t),$(t).show(),setTimeout(function(){m.fadeOut()},1e3)}function r(){var t=Date.now(),e=h.toRIN(!0),n=JSON.stringify(e),i="http://553d4a03eb844efaaf7915517c979ef4.cloudapp.net/rinjsTag/",r="<!doctype html><html><head>";r+='<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />',r+='<meta http-equiv="X-UA-Compatible" content="IE=10" />',r+='<meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1, user-scalable=no">',r+="<title>Rich Interactive Narratives</title>",r+='<style type="text/css">html, body, #rinPlayer{position:absolute;top:0;right:0;bottom:0;left:0;margin:0;padding:0;overflow:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-ms-touch-action:none;-webkit-touch-callout:none;-ms-content-zooming:none;}</style>',r+='<script src="'+i+'lib/rin-core-1.0.js" type="text/javascript"></script>',r+='<script src="'+i+'lib/tagInk.js" type="text/javascript"></script>',r+='<script src="'+i+'lib/raphael.js" type="text/javascript"></script>',r+='<script src="'+i+'lib/seadragon-0.8.9-rin.js" type="text/javascript"></script>',r+='<script>function parseDeepState(){var playerElement=document.getElementById("rinPlayer");var playerControl=rin.getPlayerControl(playerElement);var deepstateUrl=playerControl.resolveDeepstateUrlFromAbsoluteUrl(window.location.href);if(deepstateUrl){playerControl.load(deepstateUrl);}}</script>',r+="</head>",r+="<body onload=\"rin.processAll(null, '"+i+"'"+').then(parseDeepState);">',r+='<div id="rinPlayer" class="rinPlayer" style="width: 100%;height: 100%;margin: 0;padding: 0;overflow: hidden;" data-src="./TourData'+t+'.txt" data-options="autoplay=false&loop=true&systemRootUrl='+i+'"></div>',r+="</body></html>";var a;c(),Windows.Storage.KnownFolders.picturesLibrary.createFileAsync("TourData"+t+".txt").then(function(t){Windows.Storage.FileIO.writeTextAsync(t,n).done(function(){a=TAG.Util.UI.popUpMessage(null,"Tour data file created in your Pictures Library.",null),$(a).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3),$("body").append(a),$(a).fadeIn(500)})})}function c(){$(".tourOptionDropDownIcon").css({transform:"scaleY(1)","margin-bottom":"0%"}),T=!1,o.hide()}l.attr("id","tour-options"),l.css({height:"48px",width:"13%",left:"25%",top:"27%",position:"relative","float":"left"});var v=$(document.createElement("img"));v.addClass("tourOptionDropDownIcon"),v.attr("src","images/icons/Down.png"),v.css({top:"-5%",width:"7.5%",height:"auto","margin-left":"5%","margin-bottom":"3%"}),s=v,a=$(document.createElement("label")),a.attr("id","addTourOptionsLabel"),a.text("Options"),a.css({"font-size":TAG.Util.getFontSize(190),color:"rgb(256, 256, 256)"}),a.append(v),l.append(a),o=$(document.createElement("div")),o.css({position:"absolute",color:"rgb(256, 256, 256)","background-color":"rgba(0,0,0,0.85)",left:"0",width:"100%","z-index":TAG.TourAuthoring.Constants.aboveRinZIndex}),l.append(o),o.hide();var y=t("Capture Thumbnail",o,"thumbnailButton"),b=t("Change Tour Length",o,"tourLengthButton"),x=t("Export Tour Data",o,"exportButton"),T=!1;a.click(function(t){var e=h.getCloseMenu();e&&e!==c&&e(),t.stopImmediatePropagation(),T=!T,T?(h.setisMenuOpen(!0),h.setCloseMenu(c),p.on("mousedown.topMenu",function(){c()}),$(s).css({transform:"scaleY(-1)","margin-bottom":"3%"})):(h.setisMenuOpen(!1),h.setCloseMenu(c),p.off("mousedown.topMenu"),$(s).css({transform:"scaleY(1)","margin-bottom":"3%"})),o.css("top",parseInt(a.css("top"),10)+a.height()),o.toggle()}),a.on("mousedown",function(t){t.stopImmediatePropagation()});var w=$(document.createElement("label"));$(w).text("Capturing Thumbnail..."),w.css({"text-align":"center",width:"100%","font-size":"1.5em",color:"white"}),m.append(w),m.addClass("thumbnailcaptured"),m.css({"background-color":"black",position:"absolute",left:"52%","z-index":"1000",display:"none",opacity:"0.8",border:"2.8px double white"}),y.on("click",function(){var t=$("#resizableArea").height()+$("#topbar").height();m.css({top:.53*t+"px"}),c(),m.fadeIn("fast");var r=$("#rinplayer");html2canvas([r[0]],{onrendered:function(t){var r=t.toDataURL();TAG.Worktop.Database.uploadImage(r,function(t){TAG.Worktop.Database.changeTour(u.Identifier,{Thumbnail:t},function(){setTimeout(function(){m.fadeOut()},1e3)},e,n,i)},e,i)},allowTaint:!0})}),b.on("click",function(){c(),g.fadeIn(500),E.val(d.formatTime(d.getDuration().end)),E.select(),S.text("")});var k=$(document.createElement("div"));k.attr("id","lengthDialog"),g.css("z-index","100000");var A=TAG.Util.constrainAndPosition($(window).width(),$(window).height(),{center_h:!0,center_v:!0,width:.5,height:.35,max_width:560,max_height:200});k.css({position:"absolute",left:A.x+"px",top:A.y+"px",width:A.width+"px",height:A.height+"px",border:"3px double white","background-color":"black"}),g.append(k);var _=$(document.createElement("form"));_.attr("id","dialogForm"),_.css({"margin-top":"4.5%"}),k.append(_),_.on("submit",function(){var t,e,n=E.val().split(":"),i=parseInt(n[0],10),r=parseInt(n[1],10);if(1==n.length&&(i||0===i)&&i>=0)i>TAG.TourAuthoring.Constants.maxTourLength?(S.text("Tour length is too long. Maximum length of tour must be 15 minutes."),S.css({color:"white",width:"80%",left:"10%","font-size":"1.25em",position:"absolute","text-align":"center","margin-top":"3%"}),E.select()):(h.getLastDisplayTime()>i&&(i=h.getLastDisplayTime()),t=d.getDuration().end,e=TAG.TourAuthoring.Command({execute:function(){d.setEnd(i)},unexecute:function(){d.setEnd(t)}}),e.execute(),f.logCommand(e),g.fadeOut(500));else if(2===n.length&&(i||0===i)&&(r||0===r)&&i>=0&&"number"==typeof r&&r>=0&&59>=r){var a=60*i+r;a>TAG.TourAuthoring.Constants.maxTourLength?(S.text("Tour length is too long. Maximum length of tour is 15 minutes."),E.select()):(h.getLastDisplayTime()>a&&(a=h.getLastDisplayTime()),t=d.getDuration().end,e=TAG.TourAuthoring.Command({execute:function(){d.setEnd(a)},unexecute:function(){d.setEnd(t)}}),e.execute(),f.logCommand(e),g.fadeOut(500))}else S.text("Please enter a valid length (MM:SS or seconds)."),E.select();return h.faderUpdate(),!1});var C=$(document.createElement("div"));C.attr("id","dialogTitle"),C.css({color:"white",width:"80%",height:"15%",left:"10%","font-size":"1.25em",position:"relative","text-align":"center","word-wrap":"break-word"}),C.text("Enter New Length (MM:SS): "),_.append(C);var E=$(document.createElement("input"));E.attr("id","timeInput"),E.css({position:"relative"}),C.append(E),_.append(document.createElement("br")),E.on("keydown",function(t){t.stopImmediatePropagation()}),E.on("keypress",function(t){t.stopImmediatePropagation()}),E.on("keyup",function(t){t.stopImmediatePropagation()});var S=$(document.createElement("div"));S.css({color:"white",width:"80%",left:"10%","font-size":"1.25em",position:"absolute","text-align":"center","margin-top":"3%"}),_.append(S);var M=$(document.createElement("div"));M.css({position:"relative",display:"block",width:"80%",left:"10%",top:"50%"}),_.append(M);var I=$(document.createElement("div"));I.css("text-align","right");var D=$(document.createElement("div"));D.css("clear","both");var P=$(document.createElement("button"));P.text("Apply"),P.css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","float":"right","margin-right":"-3%","margin-top":"15%"});var N=$(document.createElement("button"));N.attr("type","button"),N.text("Cancel"),N.css({padding:"1%",border:"1px solid white",width:"auto",position:"absolute","margin-left":"-3%","float":"left","margin-top":"15%",bottom:"1%"}),M.append(N),M.append(P),M.append(D),_.append(M),N.click(function(){g.fadeOut(500)}),M.append(N),x.on("click",r)}(),c.applyCSS=e,c.applyLabelCSS=n,c.addToDOM=i,c.getBufferedData=r,c},TAG.Util.makeNamespace("TAG.TourAuthoring.Track"),TAG.Util.makeNamespace("TAG.TourAuthoring.TrackType"),TAG.TourAuthoring.TrackType={audio:1,video:2,artwork:3,ink:4,image:5},TAG.TourAuthoring.Track=function(t,e){"use strict";function n(){e.track=$(document.createElement("div")),e.track.attr("id",dn),e.track.addClass("track"),e.track.css({height:TAG.TourAuthoring.Constants.trackHeight+"px",position:"relative",top:"0%",left:"0%","background-color":"rgb(255, 255, 255)",border:"1px solid #888","box-shadow":"5px 0px 10px -2px #888 inset",overflow:"hidden"}),e.svg=d3.select(e.track[0]).append("svg").attr("width","100%").attr("height","100%").attr("overflow","hidden").attr("style","position: absolute"),e.svgLines=e.svg.append("svg:g").classed("connectionLines",!0),e.type==TAG.TourAuthoring.TrackType.audio&&(sn=e.svgLines.append("svg:g").attr("id","keyframeLines"),sn.append("svg:line").attr("x1",0).attr("y1",100-100*TAG.TourAuthoring.Constants.defaultVolume+"%").attr("x2","100%").attr("y2",100-100*TAG.TourAuthoring.Constants.defaultVolume+"%").style("pointer-events","none").style("stroke","green").style("stroke-width",4));
var t=function(t){var n,i,r,a=un.getDisplays(hn)&&un.getDisplays(hn).getContents()||[];for(e.track.css("width",e.timeManager.timeToPx(t.end)+"px"),n=0;a.length>n;n++)for(a[n].display.resetVisuals(),r=un.getKeyframes(a[n]).getContents(),i=0;r.length>i;i++)r[i].resetVisuals()};t(e.timeManager.getDuration()),e.timeManager.onSizing(t)}function i(){An.forceClose()}function r(t){i();var e=TAG.Util.UI.popUpMessage(null,t,null);$(e).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3),$("body").append(e),$(e).fadeIn(500);var n=un.getSelectedTrack();n&&n.setDeselected()}function a(){var t,n=ln.getStorageContainer().displays.getContents();if("block"==$("#inkDrawControls").css("display")||"block"==$("#inkTransparencyControls").css("display")||"block"==$("#inkTextControls").css("display")||"block"==$("#inkEditDraw").css("display")||"block"==$("#inkEditTransparency").css("display")||"block"==$("#inkEditText").css("display"))return r("An ink is already being edited."),void 0;if(!n.length)return r("The ink must be visible in the preview window in order to edit it."),void 0;var a=!0,o=e.timeManager.getCurrentTime();if(De()){var s=Me(),l=s.getDisplays();for(t=0;l.length>t;t++){if(o>=l[t].getStart()&&l[t].getOutStart()+l[t].getFadeOut()>=o){a=!0;break}a=!1}}var c=!1;for(t=0;n.length>t;t++)if(o>=n[t].display.getStart()&&n[t].display.getOutStart()+n[t].display.getFadeOut()>=o){c=!0;break}if(!c||!a)return r("The ink must be visible in the preview window in order to edit it."),void 0;e.timeManager.stop();var u=ln.getInkPath(),d=u.split("::")[0].toLowerCase();if(i(),!u||!d)return r("This ink track has become corrupted, please remove and create a new ink."),void 0;var h=$("[ES_ID='"+e.title+"']");if(!h[0])return r("The ink must be visible in the preview window in order to edit it."),void 0;if(e.isVisible=!1,"path"===d||"bezier"==d)e.timeline.showEditDraw(ln,u);else if("trans"===d){var p=u.split("[mode]")[1].split("[")[0];e.timeline.showEditTransparency(ln,u,p)}else{if("text"!==d)return e.isVisible=!0,r("This ink track is in a deprecated format, please remove and create a new ink."),void 0;var f=h.find("text"),g=f[0]?h.find("svg")[0].getAttribute("viewBox"):null;if(!f[0]||De()&&!g)return e.isVisible=!0,r("The ink must be loaded and on screen in order to edit it."),void 0;var m=$("#rinplayer"),v={x:f.offset().left-m.offset().left,y:f.offset().top-m.offset().top,w:f[0].getBBox().width,h:f[0].getBBox().height,fontsize:De()?parseFloat(f.attr("font-size"))*(m.height()/parseFloat(g.split(" ")[3])):null};e.timeline.showEditText(ln,u,v)}var y=un.getSelectedTrack();y&&y.setDeselected(),e.isVisible!==!0&&e.timeline.showEditorOverlay()}function o(){function t(){$(mn).fadeOut(500),ln.getTitle(),ln.setTitle(s.val().replace(/\'/g,"").replace(/\"/g,"")),$(mn).remove(),(e.type==TAG.TourAuthoring.TrackType.artwork||e.type==TAG.TourAuthoring.TrackType.image)&&un.mapTracks(function(t){t.track.getType()==TAG.TourAuthoring.TrackType.ink&&t.track.getInkEnabled()&&t.track.getInkLink().getTitle()==ln.getTitle()&&t.setInkLink(ln)})}An.close();var n=$(document.createElement("div"));n.attr("id","renameDialog");var r=TAG.Util.constrainAndPosition($(window).width(),$(window).height(),{center_h:!0,center_v:!0,width:.5,height:.35,max_width:560,max_height:200});n.css({position:"absolute",left:r.x+"px",top:r.y+"px",width:r.width+"px",height:r.height+"px",border:"3px double white","background-color":"black"}),mn.append(n);var a=$(document.createElement("div"));a.attr("id","renameDialogTitle"),a.css({color:"white",width:"80%",height:"15%",left:"10%",top:"12.5%","font-size":"1.25em",position:"relative","text-align":"center","word-wrap":"break-word"}),$("body").append(mn),e.timeManager.stop(),mn.fadeIn(500);var o=$(document.createElement("form")),s=$(document.createElement("input"));o.css("text-align","left"),s.attr("type","text"),s.css("margin","4% 4%"),s.css("width","100%"),s.attr("id","newNameInput"),s.val(e.title);var l=$(document.createElement("div"));l.text("Rename track to: "),l.css({color:"white",width:"80%",left:"10%","font-size":"1.25em",position:"absolute","text-align":"center","margin-top":"3%"}),o.append(l),o.append(s),n.append(o),s.css({width:"80%","margin-left":"10%","margin-right":"10%","margin-top":"10%","box-sizing":"border-box",position:"relative"});var c=$(document.createElement("div"));c.css("text-align","right");var u=$(document.createElement("div"));u.css("clear","both");var d=$(document.createElement("div"));d.css({position:"relative",display:"block",width:"80%",left:"10%"}),c.append(d);var h=$(document.createElement("button"));h.text("Apply"),h.css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","float":"right","margin-right":"7%","margin-top":"5%"}),d.append(h);var p=$(document.createElement("button"));p.attr("type","button"),p.text("Cancel"),p.css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","margin-left":"7%","float":"left","margin-top":"5%"}),c.append(u),d.append(p),n.append(d),n.show(),i(),h.click(t),p.click(function(){mn.fadeOut(500),$(mn).remove()}),$(document).keypress(function(e){13==e.which&&t(e)});var f=un.getSelectedTrack();f&&f.setDeselected()}function s(){function t(t){function r(i){var r,o,s=a[i].display;n.getType()!==TAG.TourAuthoring.TrackType.audio?(r=s.getMain()+2*TAG.TourAuthoring.Constants.defaultFade,o=s.getMainStart()-TAG.TourAuthoring.Constants.defaultFade):(r=s.getMain(),o=s.getMainStart());var l=a[i],c=t.addDisplay(e.timeManager.timeToPx(o),r),u=l.display.getParentDisplay();u&&(u.addChildDisplay(c),c.setParentDisplay(u)),c.setFadeInFromMenu(s.getFadeIn()),c.setFadeOutFromMenu(s.getFadeOut());for(var d=s.getStorageContainer().keyframes.getContents(),h=0;d.length>h;h++){var p=d[h];if(n.getType()===TAG.TourAuthoring.TrackType.audio){var f=c.addKeyframe(e.timeManager.timeToPx(p.getTime()),p.getVolumePx());t.addKeyframeToLines(f),f.restoreHandlers()}else{var f=c.addKeyframe(e.timeManager.timeToPx(p.getTime()));f.loadRIN(p.getCaptureData()),e.dirtyKeyframe=!0,f.restoreHandlers()}}}t.getPos();for(var a=ln.getStorageContainer().displays.getContents(),o=0;a.length>o;o++)r(o);console.log("combining "+(e.undoManager.undoStackSize()-i)),e.undoManager.combineLast(e.undoManager.undoStackSize()-i)}An.close();var n=ln,i=e.undoManager.undoStackSize(),r=n.getMedia();n.getPos();var a,o=n.getTitle();switch(n.getType()){case TAG.TourAuthoring.TrackType.audio:a=e.timeline.addAudioTrack(r,o,null,e.mediaLength),t(a),n.insert(a);break;case TAG.TourAuthoring.TrackType.video:a=e.timeline.addVideoTrack(r,o,null,e.mediaLength),t(a),n.insert(a);break;case TAG.TourAuthoring.TrackType.image:a=e.timeline.addImageTrack(r,o,null),t(a),n.insert(a);break;case TAG.TourAuthoring.TrackType.ink:var s=n.getInkLink();a=e.timeline.addInkTrack(s,o,n.getMedia(),n.getInkSpec(),null),s&&(s.addAttachedInkTrack(a),a.setInkLink(s)),t(a),n.insert(a),a.setInkEnabled(n.getInkEnabled()),a.setInkPath(n.getInkPath()),a.setInkProps({}),a.setInkInitKeyframe(n.getInkInitKeyframe()),a.setInkRelativeArtPos(n.getInkRelativeArtPos()),a.addInkTypeToTitle(n.getInkPath().split("::")[0].toLowerCase());break;case TAG.TourAuthoring.TrackType.artwork:a=e.timeline.addArtworkTrack(r,o,n.getGUID(),null),t(a),n.insert(a)}}function l(){function t(){function t(t){var n=e.attachedInks[t],i=n.getStorageContainer().displays;a++;var r=TAG.TourAuthoring.Command({execute:function(){Xe(n),n.remove()},unexecute:function(){var t=un.insertTrack(n,n.getPos());t.displays=i,n.reloadTrack()}});e.undoManager.logCommand(r),r.execute()}i();var n=ln.getStorageContainer().displays,r=TAG.TourAuthoring.Command({execute:function(){if(ge(),e.timeline.checkForArtworks(0)||e.timeline.disableInk(),un.numTracks()>0){var t=$("#Track-"+(un.numTracks()-1)+"-title"),n=$(document.getElementById("playback-controls")).offset().top,i=$(t).offset().top+TAG.TourAuthoring.Constants.trackHeight,r=un._trackArray[0].track.getTitleDiv(),a=r.offset().top,o=$(timeline).offset().top;o>a&&n>i+TAG.TourAuthoring.Constants.trackHeight}e.update()},unexecute:function(){var t=un.insertTrack(ln,ln.getPos());t.displays=n,L()}});e.undoManager.logCommand(r),r.execute(),e.timeline.removeInkSession();for(var a=1,o=e.attachedInks.length-1;o>=0;o--)t(o);a>1&&e.undoManager.combineLast(a),M(),e.update()}An.close();var n=$(document.createElement("div"));n.attr("id","deleteDialog");var r=TAG.Util.constrainAndPosition($(window).width(),$(window).height(),{center_h:!0,center_v:!0,width:.5,height:.35,max_width:560,max_height:200});n.css({position:"absolute",left:r.x+"px",top:r.y+"px",width:r.width+"px",height:r.height+"px",border:"3px double white","background-color":"black"});var a=$(document.createElement("div"));a.attr("id","deleteDialogTitle"),a.css({color:"white",width:"80%",height:"15%",left:"10%",top:"12.5%","font-size":"1.25em",position:"relative","text-align":"center","word-wrap":"break-word"}),$("body").append(vn),vn.append(n),e.timeManager.stop(),vn.fadeIn(500),i();var o=$(document.createElement("div"));o.attr("id","mssge");var s="Are you sure you want to delete "+e.title;o.text(s),o.css({color:"white",width:"80%",height:"15%",left:"10%",top:"12.5%","font-size":"1.25em",position:"relative","text-align":"center","word-wrap":"break-word"}),n.append(o);var l=!1;un.getTracks(),un.mapTracks(function(t){return t.track.getType()===TAG.TourAuthoring.TrackType.ink&&t.track.getInkEnabled()&&t.track.getInkLink().getTitle()===ln.getTitle()?(l=!0,void 0):void 0}),s+=!l||e.type!==TAG.TourAuthoring.TrackType.artwork&&e.type!==TAG.TourAuthoring.TrackType.image?"?":" and any attached ink tracks?",o.text(s);var c=$(document.createElement("div"));c.css({position:"relative",display:"block",width:"80%",left:"10%",top:"50%"}),n.append(c);var u=$(document.createElement("button"));u.css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","margin-top":"1%"}),u.text("Delete"),$(u).click(function(){t(),vn.fadeOut(500),$(vn).remove()}),c.append(u);var d=$(document.createElement("button"));d.css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","margin-top":"1%","float":"right"}),d.text("Cancel"),d.click(function(){vn.fadeOut(500)}),c.append(d)}function c(){var t=un.getSelectedTrack();t&&t.setDeselected(),i()}function u(t){un.mapTracks(function(e){e.track.setEventsPaused(t)})}function d(){un.selectTrack(ln),rn.css({"background-color":"#000"})}function h(){un.selectTrack(null),rn.css({"background-color":"rgb(105,89,89)"})}function p(){return e.type}function f(){return cn}function g(){return hn}function m(){return e.title}function v(t){t=e.timeline.fixTrackTitle(t,S()),e.title=t,Tn.text(e.title)}function y(){return e}function b(){return kn}function x(t){kn=t}function T(){return e.currentDisplay}function w(t){e.currentDisplay=t}function k(t){e.isVisible=t}function A(){return e.currentKeyframe}function _(){return pn}function C(t){nn=t}function E(){return nn}function S(){return dn.split("-")[1]}function M(){un.mapTracks(function(t,e){t.track.updatePos(e)})}function I(t){hn=t,dn="Track-"+t,rn.attr("id",dn+"-title"),e.track.attr("id",dn),e.resource="R-"+hn}function D(t){var e=rn.offset().top;0==ln.getPos()&&yn&&(e-=TAG.TourAuthoring.Constants.trackHeight);var n=parseInt(rn.css("height"),10);return t>=e&&e+n>=t?!0:!1}function P(){return rn}function N(t){if(t!=ln){var n=!1;n=t.getPos()>hn?t.insertHelper(hn):t.insertHelper(hn),M(),e.update()}}function G(t){var n=$("#trackTitleWrapper").scrollTop();return ln.detach(),ln.getStorageContainer(),un._trackArray.splice(ln.getPos(),1),un._trackArray.splice(t,0,ln.getStorageContainer()),M(),e.track.detach(),L(),rn.css("top","0px"),e.track.css("display",""),$("#trackTitleWrapper").scrollTop(n),In=0,!1}function O(){return e.track}function L(){if(0===hn)e.timeline.prependAddToDom(e.track,rn);else{var t=un._trackArray[hn-1].track;t.getTitleDiv().after(rn),t.getTrackDomElement().after(e.track)}e.update(),F(),e.that.getType()===TAG.TourAuthoring.TrackType.ink&&e.that.getInkEnabled(e.that)&&e.that.getInkLink(e.that).addAttachedInkTrack(e.that)}function F(){var t=un.getDisplays(hn);t&&t._root&&t._root.traverse(function(t){t._value.display.restoreHandlers();var e=un.getKeyframes(t._value);e&&e._root&&e._root.traverse(function(t){t._value.restoreHandlers()})})}function B(t){e.inRightTap=!0,An.open(t)}function R(){if(!kn&&!e.inRightTap){var t=un.getSelectedTrack();t===ln?h():(t&&t.setDeselected(),d())}}function H(t){var n=e.timeline.getCloseMenu();n&&n(),1.1===t?$("#trackTitleWrapper").scrollTop($("#trackTitleWrapper").scrollTop()-30):$("#trackTitleWrapper").scrollTop($("#trackTitleWrapper").scrollTop()+30)}function U(){return e.inRightTap=!1,V?(V=!1,void 0):(V=!0,q(),void 0)}function z(t,n){if(n.stopPropagation(),!kn&&!e.inRightTap){V=!1;var i=un.getSelectedTrack();i&&i.setDeselected(),d(),fn?j(t):(Cn&&(Cn=!1),30>Mn&&Math.abs(t.translation.y)<2*Math.abs(t.translation.x)?W(t.translation.x):W(200),Math.abs(t.translation.y)>Math.abs(t.translation.x)&&(Mn+=Math.abs(t.translation.y)),-20>parseInt(rn.css("left"),10)&&(fn=!0,In=0,xn=$(document.createElement("div")),xn.css({width:.127*$(window).width()+"px","margin-left":"20px",height:rn.height()+"px","float":"left",border:"1px solid black","box-shadow":"inset 4px -4px 8px #888",position:"absolute","z-index":0,background:"rgb(219, 218, 199)",top:rn.position().top+$("#trackTitleWrapper").scrollTop()+"px"}),rn.before(xn),_n=rn.css("z-index"),rn.css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex),rn.css("left","-20px"),En=rn.offset().top,Sn=En+TAG.TourAuthoring.Constants.trackHeight),re(t))}}function j(t){function e(){var t=hn+In-1;if(t>=hn&&t++,console.log("i = "+t),t>=0){var e=un._trackArray[t].track,n=e.getTitleDiv();console.log("next: "+n.position().top+", current: "+rn.position().top),n.position().top>rn.position().top&&(n.css("top",parseFloat(n.css("top"))+2+rn.height()+"px"),xn.css("top",parseFloat(xn.css("top"))-2-n.height()+"px"),In--)}}function n(){var t=hn+In+1;if(hn>=t&&t--,un._trackArray.length>t){var e=un._trackArray[t].track,n=e.getTitleDiv();n.position().top<rn.position().top&&(xn.css("top",parseFloat(xn.css("top"))+2+n.height()+"px"),n.css("top",parseFloat(n.css("top"))-2-xn.height()+"px"),In++)}}var i=parseFloat(rn.css("top")),r=t.translation.y;if(console.log("t  "+i+" topp  "+r+"trans-y: "+t.translation.y),r>i)e();else if(i>r)n();else{var a;if(15>rn.position().top&&(a=$("#trackTitleWrapper").scrollTop(),$("#trackTitleWrapper").scrollTop(a-10),r-=Math.min(10,a),e()),rn.position().top+2+rn.height()>$("#trackScrollVeil").height()-15){a=$("#trackTitleWrapper").scrollTop();var o,s=a+10,l=0;for(o=0;un._trackArray.length>o;o++)l=l+un._trackArray[o].track.getTitleDiv().height()+2;s>l-$("#trackTitleWrapper").height()&&(s=l-$("#trackTitleWrapper").height()),$("#trackTitleWrapper").scrollTop(s),r=r+s-a,n()}}rn.css("top",r+i)}function W(t){var e=parseInt(rn.css("left"),10),n=Math.min(e+t,0);rn.css("left",n)}function q(){Mn=0,Dn=0,$(".titlediv").css("top","0px"),$(".titlediv").css("left","0px"),xn&&xn.detach();var t=un._trackArray[hn+In].track;if(0!==In&&fn&&t){var n;n=ln.getPos()>t.getPos()?un._trackArray[ln.getPos()-1].track:ln.getPos()<t.getPos()?un._trackArray[ln.getPos()+1].track:un._trackArray[ln.getPos()].track;var i=TAG.TourAuthoring.Command({execute:function(){t.insert(ln)},unexecute:function(){n.insert(ln)}});i.execute(),e.undoManager.logCommand(i)}rn.css("z-index",_n),Ln=!0,fn=!1,Cn=!0}function V(t){kn||bn||(e.inRightTap=!1,null!==ln.getCurrentKeyframe()?ln.getCurrentKeyframe().released(t):null!==ln.getCurrentDisplay()?ln.getCurrentDisplay().released(t):console.log("skipping release"))}function Y(t){kn||bn||(e.inRightTap=!0,ln.getCurrentKeyframe()?ln.getCurrentKeyframe().rightTapped(t):ln.getCurrentDisplay()&&ln.getCurrentDisplay().rightTapped(t))}function X(t){if(!bn){if(e.currentDisplay){var n=e.currentDisplay.getLoc();if(n===TAG.TourAuthoring.DisplayParts["fade-out"]||n===TAG.TourAuthoring.DisplayParts["fade-in"])return}oe(t)}}function K(t){if(2!==t.button&&2!==t.gesture.srcEvent.buttons)if(Pn=!1,$n=!1,Nn=0,Gn=0,On=0,Fn=e.timeline.getMultiSelection()){if(ln.getCurrentDisplay())0>e.timeline.getMultiSelectionArray().indexOf(ln.getCurrentDisplay())?Z(ln.getCurrentDisplay()):Q(ln.getCurrentDisplay(),!1);else if(e.currentKeyframe){if(bn)return;0>e.timeline.getMultiSelectionArray().indexOf(e.currentKeyframe.getContainingDisplay())?Z(e.currentKeyframe.getContainingDisplay()):Q(e.currentKeyframe.getContainingDisplay(),!1)}}else{var n=e.timeline.getMultiSelectionArray().length;if(!ln.getCurrentDisplay()&&n>0)for(var i=0;n>i;i++)e.timeline.allDeselected();else if(ln.getCurrentKeyframe()){if(bn)return;ln.getCurrentKeyframe().tapped(t)}}}function Z(t){e.timeline.getMultiSelectionArray().push(t),4===t.getType()||2===t.getType()?t.getMainD().css("background-color",TAG.TourAuthoring.Constants.selectedInkDisplayColor):t.getMainD().css("background-color",TAG.TourAuthoring.Constants.selectedDisplayColor)}function Q(t,n){n||e.timeline.getMultiSelectionArray().splice(e.timeline.getMultiSelectionArray().indexOf(t),1);var i=function(t){return t.source};un._leftExternal.remove(un._leftExternal.findValue(t,i)),un._leftInternal.remove(un._leftInternal.findValue(t,i)),un._rightExternal.remove(un._rightExternal.findValue(t,i)),un._rightInternal.remove(un._rightInternal.findValue(t,i)),4===t.getType()||2===t.getType()?t.getMainD().css("background-color",TAG.TourAuthoring.Constants.inkDisplayColor):1===t.getType()?t.getMainD().css("background-color","rgba(129, 173, 98, 0.8)"):t.getMainD().css("background-color",TAG.TourAuthoring.Constants.displayColor)}function J(t,n){var i,r,a,o;if(kn||e.inRightTap)return n.stopImmediatePropagation(),void 0;if(e.currentDisplay){if(e.currentDisplay.suppressHandles(),n&&n.stopPropagation(),Pn||!$n&&On>3&&Math.abs(Gn)>Math.abs(Nn))return Pn=!0,re(t),void 0;if(!(On>3))return Nn+=t.translation.x,Gn+=t.translation.y,On++,void 0;if($n=!0,0===e.timeline.getMultiSelectionArray().length){r=e.timeManager.getDuration().start,a=e.timeManager.getDuration().end;var s=ln.getStorageContainer().displays.getContents();for(i=0;s.length>i;i++)s[i].display===e.currentDisplay&&(i-1>=0&&(r=s[i-1].display.getEnd()+TAG.TourAuthoring.Constants.esOffset),s.length>i+1&&(a=s[i+1].display.getStart()-TAG.TourAuthoring.Constants.esOffset));e.currentDisplay.move(t,r,a)}else e.timeline.getMultiSelectionArray().indexOf(e.currentDisplay)>=0&&e.timeline.moveSelect(t,e.currentDisplay)}else if(e.currentKeyframe){if(bn)return;n&&n.stopPropagation(),o=e.currentKeyframe.getContainingDisplay(),r=o.getStart(),a=o.getEnd();var l=un.findPrevKeyframe(o,e.currentKeyframe),c=un.findNextKeyframe(o,e.currentKeyframe);l&&(r=l.getTime()+TAG.TourAuthoring.Constants.esOffset),c&&(a=c.getTime()-TAG.TourAuthoring.Constants.esOffset),e.timeline.getMultiSelection()||e.currentKeyframe.move(t,r,a)}}function te(t,n){var i=e.timeManager.getDuration().start,r=e.timeManager.getDuration().end,a=t.getStorageContainer().keyframes,o=Math.min(t.getOutStart()-t.getFadeIn(),!a.isEmpty()&&a.min().getTime()-e.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize+TAG.TourAuthoring.Constants.keyframeStrokeW+TAG.TourAuthoring.Constants.fadeBtnSize)||1/0),s=Math.max(t.getStart()+t.getFadeIn(),!a.isEmpty()&&a.max().getTime()-t.getFadeOut()+e.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize+TAG.TourAuthoring.Constants.keyframeStrokeW+TAG.TourAuthoring.Constants.fadeBtnSize)||-1/0),l=t.getStart(),c=t.getLoc(),u=t.getEnd();n&&(u=t.getOutStart()),(0===t.getFadeIn()||0===t.getFadeOut())&&(o=Math.min(e.timeManager.pxToTime(t.getFioHandle().attr("cx")-2*TAG.TourAuthoring.Constants.fadeBtnSize),!a.isEmpty()&&a.min().getTime()-e.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize+TAG.TourAuthoring.Constants.keyframeStrokeW+TAG.TourAuthoring.Constants.fadeBtnSize)||1/0),s=Math.max(e.timeManager.pxToTime(t.getFinHandle().attr("cx"))+e.timeManager.pxToTime(2*TAG.TourAuthoring.Constants.fadeBtnSize),!a.isEmpty()&&a.max().getTime()-t.getFadeOut()+e.timeManager.pxToTime(TAG.TourAuthoring.Constants.keyframeSize+TAG.TourAuthoring.Constants.keyframeStrokeW+TAG.TourAuthoring.Constants.fadeBtnSize)||-1/0)),t.getStart()>o&&(o=t.getStart()),s>t.getOutStart()&&(s=t.getOutStart());var d,h=un.findPreviousDisplay(hn,t),p=un.findNextDisplay(hn,t);if(c===TAG.TourAuthoring.DisplayParts.main)h&&0>e.timeline.getMultiSelectionArray().indexOf(h.display)&&(i=h.display.getEnd()+TAG.TourAuthoring.Constants.esOffset),p&&0>e.timeline.getMultiSelectionArray().indexOf(p.display)&&(r=p.display.getStart()-TAG.TourAuthoring.Constants.esOffset),e.type===TAG.TourAuthoring.TrackType.ink&&e.inkEnabled&&(d=t.getParentDisplay(),-1===e.timeline.getMultiSelectionArray().indexOf(d)&&(i=Math.max(i,d.getStart()),r=Math.min(r,d.getEnd())));else if(c===TAG.TourAuthoring.DisplayParts["fade-out"]||c===TAG.TourAuthoring.DisplayParts["fade-in"]){if(h&&(i=h.display.getEnd()+TAG.TourAuthoring.Constants.esOffset),p&&(r=p.display.getStart()-TAG.TourAuthoring.Constants.esOffset),e.type===TAG.TourAuthoring.TrackType.ink&&e.inkEnabled)d=ee(t),-1===e.timeline.getMultiSelectionArray().indexOf(d)&&(i=Math.max(i,d.getStart()),r=Math.min(r,d.getEnd()));else if(e.type===TAG.TourAuthoring.TrackType.artwork||e.type===TAG.TourAuthoring.TrackType.image||!e.inkEnabled){var f=t.getChildDisplays(),g=t.getLongestSubgroup(f);s=Math.max(s,t.getStart()+g),o=Math.min(o,t.getEnd()-g)}if((e.type===TAG.TourAuthoring.TrackType.video||e.type===TAG.TourAuthoring.TrackType.audio)&&t.getMediaLength()){var m=parseFloat(t.getMediaLength());i=Math.max(i,t.getEnd()-m),r=Math.min(r,t.getStart()+m)}}var v={bound:l-i,source:t},y={bound:o-l,source:t},b={bound:r-u,source:t},x={bound:u-t.getFadeOut()-s,source:t};un._leftExternal.push(v),un._leftInternal.push(y),un._rightExternal.push(b),un._rightInternal.push(x)}function ee(t){return t.getParentDisplay()}function ne(){var t,e=ln.getStorageContainer().displays.getContents();for(t=0;e.length>t;t++)e[t].display.scale()}function ie(t){an||(an=e.timeline.getTrackBody()),an.scrollLeft(an.scrollLeft()-t.translation.x)}function re(t){an||(an=$("#trackBody")),an.scrollTop(an.scrollTop()-t.translation.y)}function ae(t){var n=e.timeline.getCloseMenu();n&&n(),an||(an=e.timeline.getTrackBody());var i,r=an.scrollTop();i=1.1===t?r-30:r+30,an.scrollTop(i)}function oe(t){var n,i,r,a,o,s,l=t.position.x,c=e.timeManager.pxToTime(l),u=t.position.y,d=!0,h=5;if(e.type===TAG.TourAuthoring.TrackType.ink&&e.inkEnabled){var p=Me().getStorageContainer().displays.getContents(),f=!1,p=Me().getStorageContainer().displays.nearestNeighbors(c);for(n=0;p.length>n;n++)if(p[n]&&p[n].display.getEnd()>=c&&c>=p[n].display.getStart()){f=!0,o=p[n].display;break}}if(f!==!1)if(e.currentDisplay){if(e.type===TAG.TourAuthoring.TrackType.artwork||e.type===TAG.TourAuthoring.TrackType.audio||e.type===TAG.TourAuthoring.TrackType.image){if(e.timeline.getViewer().isKeyframingDisabled())return;c>=e.currentDisplay.getStart()&&e.currentDisplay.getEnd()>=c&&(e.type!==TAG.TourAuthoring.TrackType.audio&&e.timeManager.seek(c),i=e.currentDisplay.addKeyframe(l,u,!0),i&&(e.timeline.allDeselected(),e.type==TAG.TourAuthoring.TrackType.audio?(e.allKeyframes.push(i),ln.drawLines()):(i.loadRIN(e.timeline.captureKeyframe(e.title)),i.setSelected(!0),e.dirtyKeyframe=!0),e.update()))}}else{var g=1/0,m=ln.getStorageContainer().displays.getContents();for(n=0;m.length>n;n++)if(a=m[n].display,a.getEnd()>=c){if(c>=a.getStart()){d=!1;break}c+h>=a.getStart()&&(h=a.getStart()-c-TAG.TourAuthoring.Constants.esOffset),g=Math.min(g,a.getStart()-c)}var s=e.timeManager.getDuration().end-c;if(d)if(e.timeline.allDeselected(),e.type===TAG.TourAuthoring.TrackType.ink&&e.inkEnabled){if(r=ve(l,Math.min(h,o.getEnd()-c)),r.setParentDisplay(o),o.addChildDisplay(r),1.5>o.getEnd()-c||1.5>g){var v=Math.min(g,o.getEnd()-c);r.setIn(0),r.setOut(0),r.setMain(v)}}else{var v=Math.min(h,s);r=ve(l,v),1.5>s&&(r.setIn(0),r.setOut(0),r.setMain(v))}}}function se(){e.selectedKeyframe&&e.selectedKeyframe.setDeselected(),e.dirtyKeyframe=!1}function le(t){e.allKeyframes.push(t),ln.drawLines()}function ce(){if(!bn&&e.type===TAG.TourAuthoring.TrackType.audio){var t=e.allKeyframes,n=t.length-1;for(t.sort(function(t,e){return t.isRemoved()?1:e.isRemoved()?-1:t.getTime()-e.getTime()});n>0&&t[n].isRemoved();)n--;var i=e.svgLines.selectAll("#keyframeLines");i.remove(),sn=e.svgLines.append("svg:g").attr("id","keyframeLines");var r,a="green";if(t.length>0){r=sn.append("svg:line").attr("x1",0).attr("y1",t[0].getVolumePx()).attr("x2",e.timeManager.timeToPx(t[0].getTime())).attr("y2",t[0].getVolumePx()).style("pointer-events","none").style("stroke",a).style("stroke-width",4);for(var o=0;n>o;o++)r=sn.append("svg:line").attr("x1",e.timeManager.timeToPx(t[o].getTime())).attr("y1",t[o].getVolumePx()).attr("x2",e.timeManager.timeToPx(t[o+1].getTime())).attr("y2",t[o+1].getVolumePx()).style("pointer-events","none").style("stroke",a).style("stroke-width",4);r=sn.append("svg:line").attr("x1",e.timeManager.timeToPx(t[n].getTime())).attr("y1",t[n].getVolumePx()).attr("x2","100%").attr("y2",t[n].getVolumePx()).style("pointer-events","none").style("stroke",a).style("stroke-width",4)}else r=sn.append("svg:line").attr("x1",0).attr("y1",100-100*TAG.TourAuthoring.Constants.defaultVolume+"%").attr("x2","100%").attr("y2",100-100*TAG.TourAuthoring.Constants.defaultVolume+"%").style("pointer-events","none").style("stroke",a).style("stroke-width",4)}}function ue(t){t.title.append(rn),t.track.append(e.track)}function de(t){t.title.prepend(rn),t.track.prepend(e.track)}function he(t){var e=$(document.createElement("div"));if(e.attr("id","inkType"),e.css({top:"48px",position:"absolute",left:"5px","font-size":"1em",color:"white",width:"80%",height:"20px"}),"trans"===t){var n=ln.getInkPath().split("[mode]")[1].split("[")[0];"block"===n?e.text("Block"):e.text("Isolate")}else"text"==t?e.text("Text"):("path"==t||"bezier"==t)&&e.text("Draw");rn.append(e)}function pe(t){hn>0?t.children().eq(hn-1).after(rn):t.prepend(rn),gn=rn.prev(".titlediv")}function fe(t){hn>0?t.children().eq(hn-1).after(e.track):t.prepend(e.track)}function ge(){un.removeTrack(ln),rn.remove(),e.track.remove()}function me(){rn.detach(),e.track.detach()}function ve(t,n){var i=TAG.TourAuthoring.Display({start:e.timeManager.pxToTime(t),length:n,dataHolder:un,canKeyframe:e.type!==TAG.TourAuthoring.TrackType.ink&&e.type!==TAG.TourAuthoring.TrackType.video,canFade:e.type!==TAG.TourAuthoring.TrackType.audio},e),r=TAG.TourAuthoring.Command({execute:function(){i.reloadDisplay(),i.restoreHandlers(),e.update()},unexecute:function(){i.removeDisplay(!1),e.update()}});return un.addDisplay(hn,i),e.update(),e.undoManager.logCommand(r),i}function ye(t,e){return t.getStart()>e.getStart()}function be(){return e.displays}function xe(t,n){var i,r,a=e.timeManager.getCurrentTime();if(e.selectedKeyframe||(r=ln.getStorageContainer().displays.nearestNeighbors(a,1)[0])){var o;o=e.selectedKeyframe?e.selectedKeyframe:r.keyframes.nearestNeighbors(a,1)[0],o&&Math.twoDecPlaces(o.getTime())<=Math.twoDecPlaces(a+.05)&&Math.twoDecPlaces(o.getTime())>=Math.twoDecPlaces(a-.05)&&!o.removed?(o.loadRIN(t),e.dirtyKeyframe=!0,n&&e.selectedKeyframe!==o&&o.setSelected()):(r||(r=ln.getStorageContainer().displays.nearestNeighbors(a,1)[0]),r&&a>=r.display.getStart()&&r.display.getEnd()>=a&&(i=r.display.addKeyframe(e.timeManager.timeToPx(a)),i&&(i.loadRIN(t),e.dirtyKeyframe=!0,i.setSelected(!1,!0))))}}function Te(){e.selectedKeyframe&&e.selectedKeyframe.setDeselected(),e.currentKeyframe=null,e.dirtyKeyframe=!1}function we(){return e.inkSpec}function ke(){return e.inkSpec.penColor}function Ae(){return e.inkSpec.font}function _e(){return e.inkSpec.opacity}function Ce(){return e.inkSpec.size}function Ee(){return e.inkSpec.mode}function Se(){return e.inkPath}function Me(){return e.experienceId}function Ie(){return e.inkProps}function De(){return e.inkEnabled}function Pe(){return e.inkInitKeyframe}function $e(){return e.inkRelativeArtPos}function Ne(){return e.inkType}function Ge(){return e.inkType}function Oe(t){e.inkSpec=t}function Le(t){e.inkSpec.color=t}function Fe(t){e.inkSpec.font=t}function Be(t){e.inkSpec.opacity=t}function Re(t){e.inkSpec.size=t}function He(t){e.inkSpec.mode=t}function Ue(t){e.inkPath=t}function ze(t){e.experienceId=t}function je(t){e.inkProps=t}function We(t){e.inkEnabled=t}function qe(t){e.inkInitKeyframe=t}function Ve(t){e.inkRelativeArtPos=t}function Ye(t){0>e.attachedInks.indexOf(t)?e.attachedInks.push(t):console.log("duplicate added")}function Xe(t){e.attachedInks.splice(e.attachedInks.indexOf(t),1)}function Ke(t){t[e.resource]={uriReference:cn}}function Ze(t){var n,i=null,r=e.title,a={},o=null;switch(a.data={zIndex:un.numTracks()-ln.getPos()},e.type){case TAG.TourAuthoring.TrackType.artwork:a.providerId="ZMES",a.data.guid=pn;break;case TAG.TourAuthoring.TrackType.image:a.providerId="ImageES";break;case TAG.TourAuthoring.TrackType.audio:a.providerId="AES",a.data.mediaLength=e.mediaLength;break;case TAG.TourAuthoring.TrackType.video:a.providerId="VideoES",a.data.mediaLength=e.mediaLength;break;case TAG.TourAuthoring.TrackType.ink:a.providerId="InkES",a.data.linkToExperience={},i=e.experienceId?e.experienceId.getTitle():"",a.data.linkToExperience.embedding={element:{datastring:{type:"datastring",str:e.inkPath},props:e.inkProps},enabled:e.inkEnabled,initKeyframe:e.inkInitKeyframe,experienceId:i,initproxy:e.inkRelativeArtPos},a.data.markers={beginAt:0,endAt:5},a.data.transition={inDuration:1e-6,outDuration:1e-6,providerId:"FadeInOutTransitionService"},a.experienceStreams={defaultStream:{duration:16.892}},a.resourceReferences=[];break;default:console.log("Track type not yet implemented in RIN")}n=un.getSelectedTrack()&&un.getSelectedTrack()!==ln?!0:!1,a.resourceReferences=e.type!==TAG.TourAuthoring.TrackType.ink?[{resourceId:e.resource,required:"true"}]:[],a.experienceStreams={};for(var s=ln.getStorageContainer().displays.getContents(),l=0;s.length>l;l++)s[l].display.toES(a,n,o,l),o=un.lastKeyframe(s[l].display);for(;t.hasOwnProperty(r);)r+="-0";t[r]=a}function Qe(t,n){if(n||e.isVisible)for(var i=un.getDisplays(ln.getPos()).getContents(),r=0;i.length>r;r++){var a=i[r];t.push(a.display.toScreenPlayEntry(r))}}function Je(t){bn=t}function tn(){return bn}function en(){bn=!bn,Math.ceil(rn.height())===TAG.TourAuthoring.Constants.trackHeight?(rn.height(TAG.TourAuthoring.Constants.minimizedTrackHeight),e.track.height(TAG.TourAuthoring.Constants.minimizedTrackHeight),sn&&sn.style("display","none")):(rn.height(TAG.TourAuthoring.Constants.trackHeight),e.track.height(TAG.TourAuthoring.Constants.trackHeight),sn&&sn.style("display",null)),un.mapDisplays(ln.getStorageContainer(),function(t){t.display.toggleCircles()}),ce(),e.timeline.updateVerticalScroller(),e.timeline.enableDisableDrag()}var nn,rn,an,on,sn,ln={},cn=t.media,un=t.dataHolder,dn="Track-"+t.id,hn=t.id,pn=t.guid,fn=(t.playbackControls,!1),gn={},mn=$(TAG.Util.UI.blockInteractionOverlay()),vn=$(TAG.Util.UI.blockInteractionOverlay()),yn=($(TAG.Util.UI.blockInteractionOverlay()),!1),bn=!1,V=!0;e=e||{},e.title=decodeURI(t.title),e.resource="R-"+hn,e.root=t.root,e.type=t.type||TAG.TourAuthoring.TrackType.artwork,e.timeManager=t.timeManager,e.undoManager=t.undoManager,e.update=t.update,e.timeline=t.timeline,e.dirtyKeyframe=!1,e.that=ln,e.selectedTrack=t.selectedTrack,e.mediaLength=t.mediaLength,e.isVisible=!0,e.attachedInks=[],on=e.timeManager.getDuration().scale,e.displays=[],e.allKeyframes=[];var xn,Tn,wn=!1,kn=!1;ln.compOpsOpen=wn,function(){rn=$(document.createElement("div")),rn.attr("id",dn+"-title"),rn.addClass("titlediv"),rn.css({height:TAG.TourAuthoring.Constants.trackHeight+"px",width:.127*$(window).width()+"px","margin-left":"20px",left:"0%",position:"relative","background-color":"rgb(105,89,89)","border-bottom-style":"solid",border:"1px solid #888",top:"0px",overflow:"hidden","z-index":0}),Tn=$(document.createElement("div")),Tn.addClass("track-title"),Tn.text(e.title),Tn.css({"font-size":"1.25em",color:"white",top:"11%",left:"3%",position:"relative",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap",display:"block",width:.115*$(window).width()+"px"}),rn.append(Tn)
}(),n();var An=TAG.TourAuthoring.EditorMenu({type:TAG.TourAuthoring.MenuType.track,parent:ln},e);(function(){An.addTitle("Track Options"),An.addButton("Rename","left",o),e.type===TAG.TourAuthoring.TrackType.ink&&An.addButton("Edit Ink","left",a),An.addButton("Duplicate","left",s),An.addButton("Delete","left",l),An.addButton("Cancel","left",c)})(),ln.updateTracksEventsPaused=u,ln.setSelected=d,ln.setDeselected=h,ln.getType=p,ln.getMedia=f,ln.getPos=g,ln.getTitle=m,ln.setTitle=v,ln.getSharedMy=y,ln.getEventsPaused=b,ln.setEventsPaused=x,ln.getCurrentDisplay=T,ln.setCurrentDisplay=w,ln.setIsVisible=k,ln.getCurrentKeyframe=A,ln.getGUID=_,ln.setStorageContainer=C,ln.getStorageContainer=E,ln.getID=S,ln.updatePos=I,ln.checkWithinTitleDiv=D,ln.getTitleDiv=P,ln.insert=N,ln.insertHelper=G,ln.getTrackDomElement=O,ln.reloadTrack=L,ln.restoreHandlers=F,TAG.Util.makeManipulatable(rn[0],{onManipulate:z,onTapped:R,onTappedRight:B,onRelease:U,onScroll:H,onDoubleTapped:en},!1,!0),e.inRightTap=!1,this.tapRightTitle=B,ln.tappedTitle=R;var _n=0,Cn=!0,En=0,Sn=0,Mn=0,In=0,Dn=0,Pn=!1,$n=!1,Nn=0,Gn=0,On=0,Ln=!0;TAG.Util.makeManipulatable(e.track[0],{onManipulate:J,onTappedRight:Y,onScroll:ae,onTapped:K,onDoubleTapped:X,onRelease:function(){e.inRightTap=!1,Pn=!1,$n=!1,Nn=0,Gn=0,On=0}}),ln.tapRight=Y;var Fn;return ln.setDisplaySelected=Z,ln.setDisplayDeselected=Q,ln.onManipTrack=J,ln.boundHelper=te,ln.scale=ne,e.timeManager.onSizing(ne),ln.leftAndRight=ie,ln.upAndDown=re,ln.deselectKeyframe=se,ln.addKeyframeToLines=le,ln.drawLines=ce,ln.addAllToDOM=ue,ln.prependAllToDOM=de,ln.addInkTypeToTitle=he,ln.addTitleToDOM=pe,ln.addEditorToDOM=fe,ln.remove=ge,ln.detach=me,e.currentDisplay=null,e.currentKeyframe=null,ln.addDisplay=ve,ln.displayComp=ye,ln.getDisplays=be,ln.receiveKeyframe=xe,e.timeManager.onMove(function(){e.dirtyKeyframe&&e.update(!0),Te()}),e.inkSpec={},e.inkPath="",e.currentInkPath="",e.inkProps={},e.inkEnabled=null,e.inkInitKeyframe={},e.inkRelativeArtPos={},ln.getInkType=Ne,ln.getInkSpec=we,ln.getInkColor=ke,ln.getInkFont=Ae,ln.getInkOpacity=_e,ln.getInkSize=Ce,ln.getInkMode=Ee,ln.getInkPath=Se,ln.getInkLink=Me,ln.getInkProps=Ie,ln.getInkEnabled=De,ln.getInkInitKeyframe=Pe,ln.getInkRelativeArtPos=$e,ln.setInkSpec=Oe,ln.setInkType=Ge,ln.setInkColor=Le,ln.setInkFont=Fe,ln.setInkOpacity=Be,ln.setInkSize=Re,ln.setInkMode=He,ln.setInkPath=Ue,ln.setInkLink=ze,ln.setInkProps=je,ln.setInkEnabled=We,ln.setInkInitKeyframe=qe,ln.setInkRelativeArtPos=Ve,ln.addAttachedInkTrack=Ye,ln.removeAttachedInkTrack=Xe,ln.addResource=Ke,ln.addES=Ze,ln.addScreenPlayEntries=Qe,ln.setMinimizedState=Je,ln.getMinimizedState=tn,ln},TAG.Util.makeNamespace("TAG.TourAuthoring.VideoTrack"),TAG.TourAuthoring.VideoTrack=function(t,e){"use strict";t.type=TAG.TourAuthoring.TrackType.video,e=e||{};var n=TAG.TourAuthoring.Track(t,e);return e.track.addClass("video"),n},TAG.Util.makeNamespace("TAG.Authoring.SettingsView"),TAG.Authoring.SettingsView=function(t,e,n,i){"use strict";function r(){$("input, textarea").is(":focus")||(gn&&w(Le[fn]),mn&&X(Le[fn]),vn&&B(Le[fn]),yn&&I(Le[fn]),bn&&ne(Le[fn]))}function a(){$("input, textarea").is(":focus")||Ge(Oe)}function o(){$("input, textarea").is(":focus")||De&&De===Fe&&Fe.prev()&&fn>0&&(le(".middleLabel"),ce(Fe.prev()),Fe=Fe.prev(),De=Fe,fn--,gn&&k(Le[fn]),mn&&z(Le[fn]),vn&&O(Le[fn]),yn&&S(Le[fn]),bn&&J(Le[fn]))}function s(){$("input, textarea").is(":focus")||De&&De===Fe&&Fe.next()&&Le.length-1>fn&&(le(".middleLabel"),ce(Fe.next()),Fe=Fe.next(),De=Fe,fn++,gn&&k(Le[fn]),mn&&z(Le[fn]),vn&&O(Le[fn]),yn&&S(Le[fn]),bn&&J(Le[fn]))}function l(){var e=Be.find("#setViewBackButton");e.attr("src","images/icons/Back.svg"),e.mousedown(function(){TAG.Util.UI.cgBackColor("backButton",e,!1)}),e.mouseleave(function(){TAG.Util.UI.cgBackColor("backButton",e,!0)}),e.click(function(){if(TAG.Auth.clearToken(),un.clear(),cn.clear(),e.off("click"),n){var t=n();TAG.Util.UI.slidePageRight(t)}else TAG.Layout.StartPage(null,function(t){TAG.Util.UI.slidePageRight(t)});TAG.Util.UI.getStack()[0]=null});var r=Be.find("#setViewTopBarLabel"),a=TAG.Util.constrainAndPosition($(window).width(),.08*$(window).height(),{width:.4,height:.9});r.css({height:a.height+"px",width:a.width+"px"});var o=TAG.Util.getMaxFontSizeEM("Tour Authoring",.5,a.width,.8*a.height,.1);r.css({"font-size":o}),r.text("Authoring Mode"),ze.append(dn[on.general.text]=d(on.general,h)),ze.append(dn[on.exhib.text]=d(on.exhib,T)),ze.append(dn[on.art.text]=d(on.art,U)),ze.append(dn[on.media.text]=d(on.media,G)),ze.append(dn[on.tour.text]=d(on.tour,E)),ze.append(dn[on.feedback.text]=d(on.feedback,Q)),je.keyup(function(){ke(je.val(),".middleLabel","div")}),je.change(function(){ke(je.val(),".middleLabel","div")}),je.mouseup(function(){setTimeout(function(){ke(je.val(),".middleLabel","div")},1)}),je.attr("placeholder","Search..."),We.text("New"),qe.text("Video"),Qe.text("Loading..."),Je.attr("src","images/icons/progress-circle.gif"),Xe.css({height:1*($(window).width()*en/100)/tn+"px"}),Ke.css({top:1*($(window).width()*en/100)/tn+"px"}),Ze.css({height:ue()+"px"}),c(t,i)}function c(t,e){switch(le(".navContainer"),t){case"Exhibitions":ce(dn[on.exhib.text]),Ie=dn[on.exhib.text],T(e);break;case"Artworks":ce(dn[on.art.text]),Ie=dn[on.art.text],U(e);break;case"Associated Media":ce(dn[on.media.text]),Ie=dn[on.media.text],G(e);break;case"Tours":ce(dn[on.tour.text]),Ie=dn[on.tour.text],E(e);break;case"Feedback":ce(dn[on.feedback.text]),Ie=dn[on.feedback.text],Q(e);break;case"General Settings":default:ce(dn[on.general.text]),Ie=dn[on.general.text],h()}}function u(){return Be}function d(t,e){var n=$(document.createElement("div"));n.attr("class","navContainer"),n.attr("id","nav-"+t.text),n.mousedown(function(){n.css({background:rn})}),n.mouseup(function(){n.css({background:"transparent"})}),n.mouseleave(function(){n.css({background:"transparent"})}),n.click(function(){Ie!==n&&(le(".navContainer"),ce(n),e&&e(),Ie=n)});var i=$(document.createElement("label"));i.attr("class","navtext"),i.text(t.text);var r=$(document.createElement("label"));return r.attr("class","navsubtext"),r.text(t.subtext),n.append(i),n.append(r),n}function h(){re(!1),cn.add(function(){var t;Re.before(t=ce(ie("Splash Screen",null,p),!0)),De=t,p(),Re.before(ie("Password Settings",null,g).attr("id","password")),Re.hide()}),Pe=null}function p(){oe(!0),ae();var t=y(),e=TAG.Worktop.Database.getMuseumOverlayTransparency(),n=TAG.Worktop.Database.getMuseumOverlayColor(),i=TAG.Worktop.Database.getMuseumName(),r=TAG.Worktop.Database.getMuseumLoc(),a=TAG.Worktop.Database.getMuseumInfo();void 0===i&&(i=""),void 0===r&&(r=""),void 0===a&&(a="");var o=TAG.Worktop.Database.getLogoBackgroundColor(),s=TAG.Worktop.Database.getBackgroundColor(),l=TAG.Worktop.Database.getBackgroundOpacity(),c=TAG.Worktop.Database.getPrimaryFontColor(),u=TAG.Worktop.Database.getSecondaryFontColor();TAG.Worktop.Database.getFontFamily();var d=fe(Math.floor(100*e),!0),h=he("Change Image",function(){Ee(TAG.Authoring.FileUploadTypes.Standard,function(t){var e=t[0];h.val(e),$("#background").css({"background-image":'url("'+TAG.Worktop.Database.fixPath(e)+'")',"background-size":"cover"})})}),p=he("Change Logo",function(){Ee(TAG.Authoring.FileUploadTypes.Standard,function(t){var e=t[0];p.val(e),$("#logo")[0].src=TAG.Worktop.Database.fixPath(e)})}),g=ve(n,".infoDiv",null,function(){return d.val()}),m=fe(TAG.Util.htmlEntityDecode(i),!0,40),v=fe(TAG.Util.htmlEntityDecode(r),!0,45),T=ge(TAG.Util.htmlEntityDecode(a),!0),w=ve(o,".logoContainer",null,function(){return 100}),k=ve(s,".background",null,function(){return A.val()}),A=fe(l,!0),_=ve(c,null,".primaryFont",function(){return 100}),C=ve(u,null,".secondaryFont",function(){return 100}),E=me(["Arial","Calibri","Comic Sans MS","Courier New","Franklin Gothic","Lobster","Pacifico","Raavi","Segoe Print","Segoe UI Light","Source Sans Pro","Times New Roman","Trebuchet MS","Verdana"]);_e(d,0,100,function(t){ye(".infoDiv",g.val(),t)}),Ae(m,"#museumName",40),m.keyup(function(){t.fixText()}),m.keydown(function(){t.fixText()}),m.change(function(){t.fixText()}),Ae(v,"#subheading",33),Ae(T,"#museumInfo",300),_e(A,0,100,function(t){ye(".background",k.val(),t)});var S=de("Background Image",h),M=de("Overlay Transparency (0-100)",d),I=de("Overlay Color",g),D=de("Museum Name",m),P=de("Museum Location",v),N=de("Museum Info",T),G=de("Museum Logo",p),O=de("Museum Logo Background Color",w),L=de("Background Color",k),F=de("Background Opacity (0-100)",A),B=de("Primary Font Color",_),R=de("Secondary Font Color",C),H=de("Font Family",E);He.append(S),He.append(I),He.append(M),He.append(D),He.append(P),He.append(N),He.append(G),He.append(O),He.append(L),He.append(F),He.append(B),He.append(R),He.append(H);var U=he("Save Changes",function(){void 0===v&&(v=""),void 0===T&&(T=""),f({alphaInput:d,overlayColorInput:g,nameInput:m,locInput:v,infoInput:T,logoColorInput:w,bgImgInput:h,logoInput:p,backgroundColorInput:k,backgroundOpacityInput:A,primaryFontColorInput:_,secondaryFontColorInput:C,fontFamilyInput:E})},{"margin-right":"3%","margin-top":"1%","margin-bottom":"1%","margin-left":".5%","float":"right"}),z=he("Splash Screen",y,{"margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"}),j=he("Collections Page",b,{"margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"}),W=he("Artwork Viewer",x,{"margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"});Ke.append(U),Ke.append(z),Ke.append(j),Ke.append(W)}function f(t){re(!1,null,null,"Saving..."),ae(),oe(!0);var e=t.alphaInput.val()/100,n=t.overlayColorInput.val(),i=t.nameInput.val(),r=t.locInput.val(),a=t.infoInput.val().replace("/\n\r?/g","<br />"),o=t.logoColorInput.val(),s=t.bgImgInput.val(),l=t.logoInput.val(),c=t.backgroundColorInput.val(),u=t.backgroundOpacityInput.val(),d=t.primaryFontColorInput.val(),p=t.secondaryFontColorInput.val(),f=t.fontFamilyInput.val(),g={Name:i,OverlayColor:n,OverlayTrans:e,Location:r,Info:a,IconColor:o,BackgroundColor:c,BackgroundOpacity:u,PrimaryFontColor:d,SecondaryFontColor:p,FontFamily:f};s&&(g.Background=s),l&&(g.Icon=l),TAG.Worktop.Database.changeMain(g,function(){TAG.Worktop.Database.getMain(h,V(h),null)},Me,q({Name:"Main"},"Update",h),V(h))}function g(){oe(!1,null,!1),ae();var t=pe("Loading..."),e=de("",t);He.append(e),TAG.Worktop.Database.checkSetting("AllowChangePassword",function(t){if(e.remove(),"true"===t.toLowerCase()){var n=fe("",!1),i=fe("",!1),r=fe("",!1),a=pe("");n.attr("type","password"),i.attr("type","password"),r.attr("type","password");var o=de("Current Password",n),s=de("New Password",i),l=de("Confirm New Password",r),c=de("",a);He.append(o),He.append(s),He.append(l),Ke.css("display","none");var u=he("Update Password",function(){v({old:n,new1:i,new2:r,msg:a})});u.removeAttr("type");var d=de("",u);He.append(d),He.append(c)}else m()})}function m(){var t=pe(""),e=de("Changing the password has been disabled by the server.  Contact the server administrator for more information",t);He.append(e)}function v(t){t.msg.text("Processing..."),t.new1.val()!==t.new2.val()?t.msg.text("New passwords do not match."):TAG.Auth.changePassword(t.old.val(),t.new1.val(),function(){t.msg.text("Password Saved."),t.old.val(""),t.new1.val(""),t.new2.val("")},function(e){e?t.msg.html(e):t.msg.text("Incorrect Password.")},function(){t.msg.text("There was an error contacting the server.")})}function y(){TAG.Layout.StartPage(null,function(t){Ie&&Ie!=dn[on.general.text]||(Xe.empty(),Xe.append(t),xe(Xe))})}function b(){var t=TAG.Layout.CollectionsPage(null,null,Xe),e=t.getRoot();$(e).css({"z-index":"1"}),Ie&&Ie!=dn[on.general.text]||(Xe.empty(),Xe.append(e),xe(Xe))}function x(){var t=TAG.Layout.ArtworkViewer({catalogState:{},doq:Ne[0]||null,split:"L"},Xe),e=t.getRoot();$(e).css("z-index","-1"),Ie&&Ie!==dn[on.general.text]||(Xe.empty(),Xe.append(e),xe(Xe))}function T(t){var e=!1;re(!0,"New",A),ae(),oe(!0),gn=!0,mn=!1,vn=!1,yn=!1,bn=!1,TAG.Worktop.Database.getExhibitions(function(n){e||(Te(n),Le=n,fn=0,$.each(n,function(n,i){e||cn.add(function(){if(!(e||Ie&&Ie!==dn[on.exhib.text])){var r;!De&&(t&&i.Identifier===t||!t&&0===n)?(Re.before(ce(r=ie(i.Name,null,function(){k(i),fn=n},i.Identifier),!0)),0===Ve.scrollTop()&&r.offset().top-Ve.height()>0&&Ve.animate({scrollTop:r.offset().top-Ve.height()},1e3),De=r,Fe=De,k(i)):Re.before(r=ie(i.Name,null,function(){k(i),fn=n},i.Identifier)),TAG.Util.searchString(i.Name,je.val())||r.hide()}})}),cn.add(function(){Re.hide()}))}),Pe=function(){e=!0}}function w(t){TAG.Util.UI.createAssociationPicker(Be,"Add and Remove Artworks in this Collection",{comp:t,type:"exhib"},"exhib",[{name:"All Artworks",getObjs:TAG.Worktop.Database.getArtworksAndTours},{name:"Artworks in this Collection",getObjs:TAG.Worktop.Database.getArtworksIn,args:[t.Identifier]}],{getObjs:TAG.Worktop.Database.getArtworksIn,args:[t.Identifier]},function(){re(!0,"New",A),ae(),oe(!0),T(t.Identifier)})}function k(t){function e(t){un.add(function(){var e={backCollection:t},n=new TAG.Layout.CollectionsPage(e),i=n.getRoot();$(i).css("z-index","-1"),Xe.append(i),xe(Xe)})}oe(!0),ae(),Ge=C,Oe=t,e(t);var n;n=t.Metadata.Private?/^true$/i.test(t.Metadata.Private):!1;var i=he("Unpublish",function(){n=!0,i.css("background-color","white"),r.css("background-color","")},{"min-height":"0px","margin-right":"4%",width:"48%"});i.attr("class","settingButton");var r=he("Publish",function(){n=!1,r.css("background-color","white"),i.css("background-color","")},{"min-height":"0px",width:"48%"});r.attr("class","settingButton"),n?i.css("background-color","white"):r.css("background-color","white");var a=$(document.createElement("div"));a.append(i).append(r);var o=fe(TAG.Util.htmlEntityDecode(t.Name),"Collection name",40),s=ge(TAG.Util.htmlEntityDecode(t.Metadata.Description),!1),l=he("Change Background Image",function(){Ee(TAG.Authoring.FileUploadTypes.Standard,function(t){var e=t[0];l.val(e),$("#bgimage").css({"background-image":'url("'+TAG.Worktop.Database.fixPath(e)+'")',"background-size":"cover"})})}),c=he("Change Image",function(){Ee(TAG.Authoring.FileUploadTypes.Standard,function(t){var e=t[0];c.val(e),$("#img1")[0].src=TAG.Worktop.Database.fixPath(e)})});o.focus(function(){"Collection"===o.val()&&o.select()}),s.focus(function(){"Description"===s.val()&&s.select()}),Ae(o,"#exhibition-title",40),Ae(s,"#description-text",1790);var u=de("Change Publish Setting",a),d=de("Collection Name",o),h=de("Collection Description",s),p=de("Collection Background Image",l),f=de("Collection Preview Image",c);He.append(u),He.append(d),He.append(h),He.append(p),He.append(f);var g=he("Save Changes",function(){(void 0===o.val()||""===o.val())&&o.val("Untitled Collection"),_(t,{privateInput:n,nameInput:o,descInput:s,bgInput:l,previewInput:c})},{"margin-right":"3%","margin-top":"1%","margin-bottom":"1%","margin-left":".5%","float":"right"}),m=he("Delete Collection",function(){C(t)},{"margin-left":"2%","margin-top":"1%","margin-right":"0","margin-bottom":"3%"}),v=he("Manage Collection",function(){TAG.Util.UI.createAssociationPicker(Be,"Add and Remove Artworks in this Collection",{comp:t,type:"exhib"},"exhib",[{name:"All Artworks",getObjs:TAG.Worktop.Database.getArtworksAndTours},{name:"Artworks in this Collection",getObjs:TAG.Worktop.Database.getArtworksIn,args:[t.Identifier]}],{getObjs:TAG.Worktop.Database.getArtworksIn,args:[t.Identifier]},function(){re(!0,"New",A),ae(),oe(!0),T(t.Identifier)})},{"margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"});Ke.append(v).append(m).append(g)}function A(){re(!1),ae(),oe(!0),TAG.Worktop.Database.createExhibition(null,function(t){return Ie&&Ie!==dn[on.exhib.text]?void 0:t?(T(t.Identifier),void 0):(T(),void 0)},Me,V(T),!0)}function _(t,e){re(!1,null,null,"Saving..."),ae(),oe(!0);var n=e.nameInput.val(),i=e.descInput.val(),r=e.bgInput.val(),a=e.previewInput.val(),o=e.privateInput,s={Name:n,Private:o,Description:i};r&&(s.Background=r),a&&(s.Img1=a),TAG.Worktop.Database.changeExhibition(t.Identifier,s,function(){Ie&&Ie!==dn[on.exhib.text]||T(t.Identifier)},Me,q(t,"Update",T),V(T))}function C(t){var e=TAG.Util.UI.PopUpConfirmation(function(){re(!1),ae(),oe(!0),TAG.Worktop.Database.deleteDoq(t.Identifier,function(){Ie&&Ie!==dn[on.exhib.text]||T()},Me,q(t,"Delete",T),V(T))},"Are you sure you want to delete "+t.Name+"?","Delete",!0,function(){$(e).hide()});Be.append(e),$(e).show()}function E(t){re(!0,"New",M),ae(),oe(!0);var e=!1;gn=!1,mn=!1,vn=!1,yn=!0,bn=!1,TAG.Worktop.Database.getTours(function(n){e||(Te(n),Le=n,fn=0,$.each(n,function(n,i){return e?!1:(cn.add(function(){if(!(e||Ie&&Ie!==dn[on.tour.text])){var r;!De&&(t&&i.Identifier===t||!t&&0===n)?(Re.before(ce(r=ie(i.Name,null,function(){S(i),fn=n},i.Identifier,!1,function(){I(i)}),!0)),0===Ve.scrollTop()&&r.offset().top-Ve.height()>0&&Ve.animate({scrollTop:r.offset().top-Ve.height()},1e3),De=r,Fe=De,S(i)):Re.before(r=ie(i.Name,null,function(){S(i),fn=n},i.Identifier,!1,function(){I(i)})),TAG.Util.searchString(i.Name,je.val())||r.hide()}}),void 0)}),cn.add(function(){Re.hide()}))}),Pe=function(){e=!0}}function S(t){oe(!0),ae(),Ge=D,Oe=t;var e=$(document.createElement("img"));e.attr("src",TAG.Worktop.Database.fixPath(t.Metadata.Thumbnail));var n={position:"absolute",left:"30%",top:"22%","z-index":"50",height:Xe.height()/2+"px",width:"auto"},i=TAG.Util.showProgressCircle(Xe,n,"0px","0px",!1);e.load(function(){return De&&De.text()!==t.Name?(TAG.Util.removeProgressCircle(i),void 0):(TAG.Util.removeProgressCircle(i),Xe.css("background","black url("+TAG.Worktop.Database.fixPath(t.Metadata.Thumbnail)+") no-repeat center / contain"),void 0)});var r;r=t.Metadata.Private?/^true$/i.test(t.Metadata.Private):!1;var a=he("Unpublish",function(){r=!0,a.css("background-color","white"),o.css("background-color","")},{"min-height":"0px","margin-right":"4%",width:"48%"});a.attr("class","settingButton");var o=he("Publish",function(){r=!1,o.css("background-color","white"),a.css("background-color","")},{"min-height":"0px",width:"48%"});o.attr("class","settingButton"),r?a.css("background-color","white"):o.css("background-color","white");var s=$(document.createElement("div"));s.append(a).append(o);var l=fe(TAG.Util.htmlEntityDecode(t.Name),!0,120),c=ge(TAG.Util.htmlEntityDecode(t.Metadata.Description).replace(/\n/g,"<br />")||"",!1);l.focus(function(){"Untitled Tour"===l.val()&&l.select()}),c.focus(function(){"Tour Description"===c.val()&&c.select()}),Ae(c,null,1500);var u=de("Change Publish Setting",s),d=de("Tour Name",l),h=de("Tour Description",c);He.append(u),He.append(d),He.append(h);var p=he("Edit Tour",function(){I(t)},{"margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"}),f=he("Delete Tour",function(){D(t)},{"margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"}),g=he("Duplicate Tour",function(){P(t,{privateInput:r,nameInput:l,descInput:c})},{"margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"}),m=he("Save Changes",function(){(void 0===l.val()||""===l.val())&&l.val("Untitled Tour"),N(t,{privateInput:r,nameInput:l,descInput:c})},{"margin-right":"3%","margin-top":"1%","margin-bottom":"1%","margin-left":".5%","float":"right"});Ke.append(p).append(g).append(f).append(m)}function M(){re(!1),ae(),oe(!0),TAG.Worktop.Database.createTour(null,function(t){return Ie&&Ie!==dn[on.tour.text]?void 0:t?(E(t.Identifier),void 0):(E(),void 0)},Me,V(E),!0)}function I(t){Se("Loading Tour..."),cn.clear(),un.clear(),setTimeout(function(){var e=new TAG.Layout.TourAuthoringNew(t,function(){TAG.Util.UI.slidePageLeft(e.getRoot())})},1)}function D(t){var e=TAG.Util.UI.PopUpConfirmation(function(){re(!1),ae(),oe(!0),TAG.Worktop.Database.deleteDoq(t.Identifier,function(){Ie&&Ie!==dn[on.tour.text]||E()},Me,q(t,"Delete",E),V(E))},"Are you sure you want to delete "+t.Name+"?","Delete",!0,function(){$(e).hide()});Be.append(e),$(e).show()}function P(t){re(!1),ae(),oe(!0);var e={Name:"Copy: "+t.Name,Description:t.Metadata.Description,Content:t.Metadata.Content,Thumbnail:t.Metadata.Thumbnail,Private:"true"};TAG.Worktop.Database.createTour(e,function(t){console.log("success"),Ie&&Ie!==dn[on.tour.text]||E(t.Identifier)},function(){console.log("error")},function(){console.log("cacheError")})}function N(t,e){var n=e.nameInput.val(),i=e.descInput.val();if(0===n.indexOf(" ")){var r=TAG.Util.UI.popUpMessage(null,"Tour Name cannot start with a space.",null,!0);return $(Be).append(r),$(r).show(),void 0}re(!1,null,null,"Saving..."),ae(),oe(!0),TAG.Worktop.Database.changeTour(t.Identifier,{Name:n,Description:i,Private:e.privateInput},function(){Ie&&Ie!==dn[on.tour.text]||E(t.Identifier)},Me,q(t,"Update",E),V(E))}function G(t){re(!0,"Import",H),oe(!0),ae();var e=!1;gn=!1,mn=!1,vn=!0,yn=!1,bn=!1,TAG.Worktop.Database.getAssocMedia(function(n){e||(Te(n),Le=n,fn=0,console.log("media in hand"),n[0]&&n[0].Metadata?($.each(n,function(n,i){e||cn.add(function(){if(!(e||Ie&&Ie!==dn[on.media.text])){var r,a;switch(i.Metadata.ContentType.toLowerCase()){case"video":a=i.Metadata.Thumbnail&&!i.Metadata.Thumbnail.match(/.mp4/)?TAG.Worktop.Database.fixPath(i.Metadata.Thumbnail):"images/video_icon.svg";break;case"audio":a="images/audio_icon.svg";break;case"image":a=i.Metadata.Thumbnail?TAG.Worktop.Database.fixPath(i.Metadata.Thumbnail):"images/image_icon.svg";break;default:a=null}!De&&(t&&i.Identifier===t||!t&&0===n)?(Re.before(ce(r=ie(i.Name,a,function(){O(i),fn=n},i.Identifier,!1),!0)),0===Ve.scrollTop()&&r.offset().top-Ve.height()>0&&Ve.animate({scrollTop:r.offset().top-Ve.height()},1e3),De=r,Fe=De,O(i)):Re.before(r=ie(i.Name,a,function(){O(i),fn=n},i.Identifier,!1)),TAG.Util.searchString(i.Name,je.val())||r.hide()}})}),cn.add(function(){Re.hide()})):Re.hide())}),Pe=function(){e=!0}}function O(t){oe(!0),ae(),Ge=F,Oe=t;var e,n=t.Metadata.ContentType.toLowerCase(),i=TAG.Worktop.Database.fixPath(t.Metadata.Source);switch(n){case"image":e=$(document.createElement("img"));break;case"video":e=$(document.createElement("video")),e.attr("id","videoInPreview"),e.attr("poster",t.Metadata.Thumbnail&&!t.Metadata.Thumbnail.match(/.mp4/)?TAG.Worktop.Database.fixPath(t.Metadata.Thumbnail):""),e.attr("identifier",t.Identifier),e.attr("preload","none"),e.attr("controls",""),e.css({width:"100%","max-width":"100%","max-height":"100%"}),e[0].onerror=TAG.Util.videoErrorHandler(e,Xe);break;case"audio":e=$(document.createElement("audio")),e.attr("preload","none"),e.attr("controls",""),e.css({width:"80%"});break;case"text":default:e=$(document.createElement("div")),e.css({"font-size":"24px",top:"20%",width:"80%","text-align":"center",color:"white"}),e.html(t.Name+"<br /><br />"+t.Metadata.Description),e.crossOrigin=""}i&&"text"!==n&&e.attr("src",i);var r={position:"absolute",left:"40%",top:"40%","z-index":"50",height:"auto",width:"20%"},a=TAG.Util.showProgressCircle(Xe,r,"0px","0px",!1);switch(n){case"image":e.load(function(){return De&&De.text()!==t.Name?(TAG.Util.removeProgressCircle(a),void 0):(TAG.Util.removeProgressCircle(a),Xe.css("background","black url("+i+") no-repeat center / contain"),void 0)});break;case"video":TAG.Util.removeProgressCircle(a),Xe.css("background","black"),Xe.append(e);break;case"audio":TAG.Util.removeProgressCircle(a),Xe.css("background","black"),Xe.append(e);var o=Xe.width()/2-e.width()/2+"px",s=Xe.height()/2-e.height()/2+"px";e.css({position:"absolute",left:o,top:s});break;case"text":TAG.Util.removeProgressCircle(a),Xe.css({background:"black"}),Xe.append(e);var o=Xe.width()/2-e.width()/2+"px",s=Xe.height()/2-e.height()/2+"px";e.css({position:"absolute",left:o,top:s});break;default:TAG.Util.removeProgressCircle(a),Xe.css("background","black")}var l=fe(TAG.Util.htmlEntityDecode(t.Name)||"",!0,55),c=ge(TAG.Util.htmlEntityDecode(t.Metadata.Description).replace(/\n/g,"<br />")||"",!0);l.focus(function(){"Title"===l.val()&&l.select()}),c.focus(function(){"Description"===c.val()&&c.select()});var u=de("Title",l),d=de("Description",c);He.append(u),He.append(d);var h=he("Associate to Artworks",function(){B(t)},{"float":"left","margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"}),p=he("Delete",function(){var e=TAG.Util.UI.PopUpConfirmation(function(){re(!1),ae(),oe(!0),TAG.Worktop.Database.changeHotspot(t.Identifier,{Name:t.Name},function(){TAG.Worktop.Database.deleteDoq(t.Identifier,function(){console.log("deleted"),G()},function(){console.log("noauth error")},function(){console.log("conflict error")},function(){console.log("general error")})},function(){},function(){},function(){})},"Are you sure you want to delete "+t.Name+"?","Delete",!0,function(){$(e).hide()});Be.append(e),$(e).show()},{"margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%","float":"left"}),f=he("Generate Thumbnail",function(){R(t)},{"margin-right":"0%","margin-top":"1%","margin-bottom":"1%","margin-left":"2%","float":"left"}),g=he("Save Changes",function(){(void 0===l.val()||""===l.val())&&l.val("Untitled Asset"),L(t,{titleInput:l,descInput:c})},{"margin-right":"3%","margin-top":"1%","margin-bottom":"1%","margin-left":".5%","float":"right"}),m=he("Capture Thumbnail",function(){j(t,!1)},{"margin-right":"0%","margin-top":"1%","margin-bottom":"3%","margin-left":"2%","float":"left"});Ke.append(h),"video"===t.Metadata.ContentType.toLowerCase()?Ke.append(m):"image"!==t.Metadata.ContentType.toLowerCase()||t.Metadata.Thumbnail||"/"!==t.Metadata.Source[0]||i.match(/.mp3/)||Ke.append(f),Ke.append(p).append(g)}function L(t,e){var n=e.titleInput.val(),i=e.descInput.val();re(!1,null,null,"Saving..."),ae(),oe(!0),TAG.Worktop.Database.changeHotspot(t,{Name:n,Description:i},function(){Ie&&Ie!==dn[on.media.text]||G(t.Identifier)},Me,q(t,"Update",G),V(G))}function F(t){var e=TAG.Util.UI.PopUpConfirmation(function(){re(!1),ae(),oe(!0),TAG.Worktop.Database.changeHotspot(t.Identifier,{Name:t.Name},function(){TAG.Worktop.Database.deleteDoq(t.Identifier,function(){console.log("deleted"),G()},function(){console.log("noauth error")},function(){console.log("conflict error")},function(){console.log("general error")})},function(){},function(){},function(){})},"Are you sure you want to delete "+t.Name+"?","Delete",!0,function(){$(e).hide()});Be.append(e),$(e).show()}function B(t){pn=[[]],hn=1,TAG.Util.UI.createAssociationPicker(Be,"Choose artworks",{comp:t,type:"media"},"artwork",[{name:"All Artworks",getObjs:TAG.Worktop.Database.getArtworks}],{getObjs:TAG.Worktop.Database.getArtworksAssocTo,args:[t.Identifier]},function(){})}function R(t){re(!1,null,null,"Saving..."),ae(),oe(!0),TAG.Worktop.Database.changeHotspot(t.Identifier,{Thumbnail:"generate"},function(){console.log("success?"),G(t.Identifier)},W,q,V)}function H(){Ee(TAG.Authoring.FileUploadTypes.AssociatedMedia,function(t,e,n,i){function r(t){"Video"===n[t]?i[t].properties.getVideoPropertiesAsync().done(function(e){c.push(e.duration/1e3),o(t)},function(t){console.log(t)}):"Audio"===n[t]?i[t].properties.getMusicPropertiesAsync().done(function(e){c.push(e.duration/1e3),o(t)},function(t){console.log(t)}):(c.push(null),o(t))}function a(){s++,s>=l?G():r(s)}function o(n){var i;try{i=new Worktop.Doq(t[n]);var r={Name:e[n]};c[n]&&(r.Duration=c[n]),TAG.Worktop.Database.changeHotspot(i.Identifier,r,a,TAG.Util.multiFnHandler(Me,a),TAG.Util.multiFnHandler(q(i,"Update",a)),o(a))}catch(o){return s++,console.log("error in uploading: "+o.message),void 0}}var s=0,l=t.length,c=[];re(!1),ae(),oe(!0),i.length>0&&r(0)},!0,[".jpg",".png",".gif",".tif",".tiff",".mp4",".mp3"])}function U(t){re(!0,"Import",Y),oe(!0),ae();var e=!1;gn=!1,mn=!0,vn=!1,yn=!1,bn=!1,TAG.Worktop.Database.getArtworks(function(n){e||(Te(n),Le=n,fn=0,Ne=n,n[0]&&n[0].Metadata?($.each(n,function(n,i){e||(i.Name=TAG.Util.htmlEntityDecode(i.Name),cn.add(function(){if(!(e||Ie&&Ie!==dn[on.art.text])){var r,a;switch(i.Metadata.Type){case"Artwork":a=TAG.Worktop.Database.fixPath(i.Metadata.Thumbnail);break;case"VideoArtwork":a=i.Metadata.Thumbnail?TAG.Worktop.Database.fixPath(i.Metadata.Thumbnail):"images/video_icon.svg";break;default:a=null}!De&&(t&&i.Identifier===t||!t&&0===n)?(Re.before(ce(r=ie(i.Name,a,function(){fn=n,z(i)},i.Identifier,!1,function(){X(i)},!0,i.Extension),!0)),0===Ve.scrollTop()&&r.offset().top-Ve.height()>0&&Ve.animate({scrollTop:r.offset().top-Ve.height()},1e3),De=r,Fe=De,z(i)):Re.before(r=ie(i.Name,a,function(){z(i),fn=n},i.Identifier,!1,function(){X(i)},!0,i.Extension)),TAG.Util.searchString(i.Name,je.val())||r.hide()}}))}),cn.add(function(){Re.hide()})):Re.hide())}),Pe=function(){e=!0}}function z(t){oe(!0),ae(),Ge=K,Oe=t;var e;"VideoArtwork"!==t.Metadata.Type?(e=$(document.createElement("img")),e.attr("src",TAG.Worktop.Database.fixPath(t.URL))):(e=$(document.createElement("video")),e.attr("id","videoInPreview"),e.attr("poster",t.Metadata.Thumbnail&&!t.Metadata.Thumbnail.match(/.mp4/)?TAG.Worktop.Database.fixPath(t.Metadata.Thumbnail):""),e.attr("identifier",t.Identifier),e.attr("preload","none"),e.attr("controls",""),e.css({width:"100%","max-width":"100%","max-height":"100%"}),e.attr("src",TAG.Worktop.Database.fixPath(t.Metadata.Source)),e[0].onerror=TAG.Util.videoErrorHandler(e,Xe)),e.crossOrigin="";var n,i={position:"absolute",left:"40%",top:"40%","z-index":"50",height:"auto",width:"20%"};"VideoArtwork"!==t.Metadata.Type&&(n=TAG.Util.showProgressCircle(Xe,i,"0px","0px",!1)),"VideoArtwork"!==t.Metadata.Type?e.load(function(){return De&&De.text()!==t.Name?(TAG.Util.removeProgressCircle(n),void 0):(TAG.Util.removeProgressCircle(n),Xe.css("background","black url("+TAG.Worktop.Database.fixPath(t.URL)+") no-repeat center / contain"),void 0)}):Xe.append(e);var r=fe(TAG.Util.htmlEntityDecode(t.Name),!0,55),a=fe(TAG.Util.htmlEntityDecode(t.Metadata.Artist),!0,55),o=fe(TAG.Util.htmlEntityDecode(t.Metadata.Year),!0,20),s=ge(TAG.Util.htmlEntityDecode(t.Metadata.Description).replace(/\n/g,"<br />")||"","",!1),l={},c={};t.Metadata.InfoFields&&$.each(t.Metadata.InfoFields,function(t,e){l[t]=fe(TAG.Util.htmlEntityDecode(e),!0),c[t]=de(t,l[t])}),r.focus(function(){"Title"===r.val()&&r.select()}),a.focus(function(){"Artist"===a.val()&&a.select()}),o.focus(function(){"Year"===o.val()&&o.select()}),s.focus(function(){"Description"===s.val()&&s.select()});var u=de("Title",r),d=de("Artist",a),h=de("Year",o),p=de("Description",s);He.append(u),He.append(d),He.append(h),He.append(p),$.each(c,function(t,e){He.append(e)}),$e=he("Enter Artwork Editor",function(){X(t)},{"margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"}),$e.attr("id","artworkEditorButton");var f=he("Delete Artwork",function(){K(t)},{"margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"}),g=he("Save Changes",function(){(void 0===r.val()||""===r.val())&&r.val("Untitled Artwork"),Z(t,{artistInput:a,nameInput:r,yearInput:o,descInput:s,customInputs:l})},{"margin-right":"3%","margin-top":"1%","margin-bottom":"1%","margin-left":".5%","float":"right"}),m=he("Capture Thumbnail",function(){j(t,!0)},{"margin-right":"0%","margin-top":"1%","margin-bottom":"1%","margin-left":"2%","float":"left"});"VideoArtwork"!==t.Metadata.Type?Ke.append($e).append(f).append(g):Ke.append(m).append(f).append(g)}function j(t,e){var n=$("#videoInPreview").attr("identifier"),i=Popcorn("#videoInPreview");$("#videoInPreview")[0].currentTime;var r=i.capture({type:"jpg"});re(!1,null,null,"Saving..."),ae(),oe(!0),TAG.Worktop.Database.uploadImage(r,function(i){e?TAG.Worktop.Database.changeArtwork(n,{Thumbnail:i},function(){console.log("success?"),U(t.Identifier)},W,q,V):TAG.Worktop.Database.changeHotspot(n,{Thumbnail:i},function(){console.log("success?"),G(t.Identifier)},W,q,V)},W,V)}function W(){dialogOverlay.hide();var t=TAG.Util.UI.popUpMessage(null,"Thumbnail not saved.  You must log in to save changes.");$("body").append(t),$(t).show()}function q(t,e){e.force()}function V(){dialogOverlay.hide();var t=TAG.Util.UI.popUpMessage(null,"Thumbnail not saved.  There was an error contacting the server.");$("body").append(t),$(t).show()}function Y(){Ee(TAG.Authoring.FileUploadTypes.DeepZoom,function(t,e,n,i){function r(){s++,s>=l?U():a(s)
}function a(t){"Video"===n[t]?i[t].properties.getVideoPropertiesAsync().done(function(e){c.push(e.duration/1e3),o(t)},function(t){console.log(t)}):(c.push(null),o(t))}function o(n){var i;try{i=new Worktop.Doq(t[n])}catch(a){return s++,console.log("error in uploading: "+a.message),void 0}var o={Name:e[n]};c[n]&&(o.Duration=c[n]),TAG.Worktop.Database.changeArtwork(i.Identifier,o,r,TAG.Util.multiFnHandler(Me,r),TAG.Util.multiFnHandler(q(i,"Update",r)),a(r))}var s=0,l=t.length,c=[];re(!1),ae(),oe(!0),i.length>0&&a(0)},!0,[".jpg",".png",".gif",".tif",".tiff",".mp4"])}function X(t){Se("Loading Artwork..."),cn.clear(),un.clear(),setTimeout(function(){TAG.Util.UI.slidePageLeft(TAG.Layout.ArtworkEditor(t).getRoot())},1)}function K(t){var e=TAG.Util.UI.PopUpConfirmation(function(){re(!1),ae(),oe(!0),TAG.Worktop.Database.deleteDoq(t.Identifier,function(){Ie&&Ie!==dn[on.art.text]||U()},Me,Me)},"Are you sure you want to delete "+t.Name+"?","Delete",!0,function(){$(e).hide()});Be.append(e),$(e).show()}function Z(t,e){var n=e.nameInput.val(),i=e.artistInput.val(),r=e.yearInput.val(),a=e.descInput.val(),o={};$.each(e.customInputs,function(t,e){o[t]=e.val()}),re(!1,null,null,"Saving..."),ae(),oe(!0),TAG.Worktop.Database.changeArtwork(t,{Name:n,Artist:i,Year:r,Description:a,InfoFields:JSON.stringify(o)},function(){Ie&&Ie!==dn[on.art.text]||U(t.Identifier)},Me,q(t,"Update",U),V(U))}function Q(t){re(!0,""),oe(!1),ae();var e=!1;gn=!1,mn=!1,vn=!1,yn=!1,bn=!0,TAG.Worktop.Database.getFeedback(function(n){e||(we(n),Le=n,fn=0,$.each(n,function(n,i){return e?!1:(cn.add(function(){if(!(e||Ie&&Ie!==dn[on.feedback.text])){var r,a=$.datepicker.formatDate("(m/dd/yy) ",new Date(1e3*i.Metadata.Date))+i.Metadata.Feedback;!De&&(t&&i.Identifier===t||!t&&0===n)?(Re.before(ce(r=ie(a,null,function(){J(i),fn=n},i.Identifier,!0))),0===Ve.scrollTop()&&r.offset().top-Ve.height()>0&&Ve.animate({scrollTop:r.offset().top-Ve.height()},1e3),De=r,Fe=De,J(i)):Re.before(r=ie(a,null,function(){J(i),fn=n},i.Identifier,!0)),TAG.Util.searchString(a,je.val())||r.hide()}}),void 0)}),cn.add(function(){Re.hide()}))}),Pe=function(){e=!0}}function J(t){ae(),oe(!0,t.Metadata.Feedback),Ge=ne,Oe=t;var e=pe("Loading..."),n=pe($.datepicker.formatDate("DD, MM d, yy ",new Date(1e3*t.Metadata.Date))),i=de("Submitted From",e),r=de("Date",n);He.append(i);var a="Exhibition"===t.Metadata.SourceType?"Collection":t.Metadata.SourceType;t.Metadata.SourceID?te(t,function(n){e.text(n+" ("+a+")");var o=he(n+" ("+a+")",function(){ee(t)}),s=de("Submitted From",o);i.remove(),r.prepend(s)},function(t){e.text(t+" ("+a+", Deleted)")},function(){e.text("Deleted")}):e.text(a+" Page (No "+a+" Selected)"),He.append(r);var o=he("Delete Feedback",function(){ne(t)},{"margin-left":"2%","margin-top":"1%","margin-right":"0%","margin-bottom":"3%"});Ke.append(o)}function te(t,e,n,i){TAG.Worktop.Database.getDoq(t.Metadata.SourceID,function(t){t.Metadata.Deleted?n(t.Name):e(t.Name)},function(){i()})}function ee(t){switch(t.Metadata.SourceType){case"Exhibition":case"Exhibitions":c("Exhibitions",t.Metadata.SourceID);break;case"Tour":case"Tours":c("Tours",t.Metadata.SourceID);break;case"Art":case"Artwork":case"Artworks":c("Artworks",t.Metadata.SourceID)}}function ne(t){re(!1),ae(),TAG.Worktop.Database.deleteDoq(t.Identifier,function(){Ie&&Ie!==dn[on.feedback.text]||Q()},Me,q(t),V(Q))}function ie(t,e,n,i,r,a,o,s){var l=$(document.createElement("div"));t=TAG.Util.htmlEntityDecode(t),l.attr("class","middleLabel"),i&&l.attr("id",i),o&&(s.match(/mp4/)?l.data("isVideoArtwork",!0):l.data("isStaticArtwork",!0)),l.mousedown(function(){l.css({background:rn})}),l.mouseup(function(){l.css({background:"transparent"})}),l.mouseleave(function(){l.css({background:"transparent"})}),l.click(function(){De!=l&&(le(".middleLabel"),ce(l,!r),n&&n(),De=l,Fe=l)}),a&&l.dblclick(a);var c;if(e){var u=$(document.createElement("img"));u.attr("src",e),u.css({height:"auto",width:"20%","margin-right":"5%"}),l.append(u);var d={position:"absolute",left:"5%","z-index":"50",height:"auto",width:"10%",top:"20%"},h=TAG.Util.showProgressCircle(l,d,"0px","0px",!1);u.load(function(){TAG.Util.removeProgressCircle(h)}),c="75%"}else c="95%";var p=$(document.createElement("div"));return p.attr("class","labelText"),p.css({width:c}),e||p.css({"padding-top":"0.4%","padding-left":"1.3%"}),p.text(t),l.append(p),l}function re(t,e,n,i){cn.clear(),Ye.empty(),Ye.append(Re),Re.show(),qe.css("display","none"),We.text(e),We.unbind("click").click(n),e?We.show():We.hide(),De=null,Pe&&Pe(),i?Re.children("label").text(i):Re.children("label").text("Loading..."),t?(Ue.show(),Ue.css("display","inline-block"),je.val("")):Ue.hide()}function ae(){He.empty(),Ke.empty(),un.clear()}function oe(t,e,n){if(Xe.empty(),Xe.css("background","black"),t)if(Xe.show(),Ke.show(),Ke.css({top:1*($(window).width()*en/100)/tn+"px","margin-top":"0.35%"}),Ze.css({height:ue()+"px"}),e){var i=$(document.createElement("textarea"));"string"==typeof e&&(e=e.replace(/<br \/>/g,"\n").replace(/<br>/g,"\n").replace(/<br\/>/g,"\n")),i.val(e),i.css({padding:".5%",width:"100%",height:"100%","box-sizing":"border-box",margin:"0px"}),i.attr("readonly","true"),Xe.append(i),Xe.css("background","transparent")}else Xe.css("background","black");else Xe.hide(),Ze.css({height:$(window).height()*nn/100-1*an+"px"});n===!1&&Ke.hide()}function se(t,e,n,i){n=n||100,i=i||0,i>n||($.contains(document.documentElement,$(t)[0])?e($(t)):un.add(function(){se(t,e,n,i+1)}))}function le(t){$(t).css("background","transparent"),$.each($(t),function(t,e){"disabled"!==$(e).attr("disabled")&&($(e).mousedown(function(){$(e).css({background:rn})}),$(e).mouseup(function(){$(e).css({background:"transparent"})}),$(e).mouseleave(function(){$(e).css({background:"transparent"})}))})}function ce(t,e){return t.css("background",rn),t.unbind("mousedown").unbind("mouseleave").unbind("mouseup"),e&&(t.css("height",""),t.children("div").css("white-space",""),De&&De.children("div").css("white-space","nowrap")),t}function ue(){var t=$(window).height()*nn/100-(1*($(window).width()*en/100)/tn+1*an+.0285*($(window).width()*en/100));return t}function de(t,e,n){var i=$(document.createElement("div"));i.attr("class","settingLine");var r=$(document.createElement("div"));r.css({width:n?45-(n-50)+"%":"45%"}),r.text(t),r.attr("class","labelText"),n?n+="%":n="50%",e.attr("class","settingInput"),e.css({width:n});var a=$(document.createElement("div"));return a.css("clear","both"),i.append(r),i.append(e),i.append(a),i}function he(t,e,n){var i=$(document.createElement("button")).text(t);return i.attr("type","button"),i.attr("class","button"),n&&i.css(n),i.click(e),i}function pe(t){var e=$(document.createElement("label")).text(t||"");return e}function fe(t,e,n){var i=$(document.createElement("input")).val(t);return i.attr({type:"text",maxlength:n}),i}function ge(t){"string"==typeof t&&(t=t.replace(/<br \/>/g,"\n").replace(/<br>/g,"\n").replace(/<br\/>/g,"\n"));var e=$(document.createElement("textarea")).val(t);return e.autoSize(),se(e,function(){var t=e[0].scrollHeight;$(e).css("height",t+"px")}),e}function me(t){var e,n,i=$(document.createElement("select"));for(i.css({overflow:"scroll"}),n=0;t.length>n;n++)e=$(document.createElement("option")),e.text(t[n]),e.attr("value",t[n]),i.append(e),t[n].selected=!0;return i.attr("value",TAG.Worktop.Database.getFontFamily),i}function ve(t,e,n,i){-1!==t.indexOf("#")&&(t=t.substring(1,t.length));var r=$(document.createElement("input"));r.attr("type","text");var a=new jscolor.color(r[0],{});return TAG.Util.UI.colorToHex(t),r.val(t),a.fromString(t),a.onImmediateChange=function(){n&&be(n,r.val()),e&&ye(e,r.val(),i())},r}function ye(t,e,n){$(t).css("background-color",TAG.Util.UI.hexToRGB(e)+n/100+")")}function be(t,e){$(t).css({color:"#"+e})}function xe(t){var e=document.createElement("div");$(e).css({height:"100%",width:"100%","float":"left",position:"absolute","background-color":"white",opacity:"0",top:"0px",right:"0px","z-index":"499"}),$(e).bind("click",function(){return!1}),$(t).append(e)}function Te(t){t.sort&&t.sort(function(t,e){var n=t.Name.toLowerCase(),i=e.Name.toLowerCase();return i>n?-1:1})}function we(t){t.sort&&t.sort(function(t,e){var n=parseInt(t.Metadata.Date,10),i=parseInt(e.Metadata.Date,10);return i>n?1:n>i?-1:0})}function ke(t,e,n){$.each($(e),function(e,i){"middleLoading"!==$(i).attr("id")&&(TAG.Util.searchString($(i).children(n).text(),t)?$(i).show():$(i).hide())})}function Ae(t,e,n){return t.keyup(function(){t.val().length>n&&t.val(t.val().substring(0,n)),$(e).html(t.val().replace(/\n\r?/g,"<br />"))}),t.keydown(function(){t.val().length>n&&t.val(t.val().substring(0,n)),$(e).html(t.val().replace(/\n\r?/g,"<br />"))}),t.change(function(){t.val().length>n&&t.val(t.val().substring(0,n)),$(e).html(t.val().replace(/\n\r?/g,"<br />"))}),t}function _e(t,e,n,i){t.keyup(function(){var r=t.val().replace(/[^0-9]/g,"");r=Math.constrain(parseInt(r,10),e,n),isNaN(r)&&(r=0),t.val()!==r+""&&t.val(r),i&&i(r)}),t.keydown(function(){var r=t.val().replace(/[^0-9]/g,"");r=Math.constrain(parseInt(r,10),e,n),isNaN(r)&&(r=0),t.val()!==r+""&&t.val(r),i&&i(r)}),t.change(function(){var r=t.val().replace(/[^0-9]/g,"");r=Math.constrain(parseInt(r,10),e,n),isNaN(r)&&(r=0),t.val()!==r+""&&t.val(r),i&&i(r)})}function Ce(t){return"[object Array]"===Object.prototype.toString.apply(t)}function Ee(t,e,n,i){var r,a,o=[],s=[];TAG.Authoring.FileUploader(Be,t,function(t){for(r=t,a=0;t.length>a;a++)o.push(t[a].displayName),t[a].contentType.match(/image/)?s.push("Image"):t[a].contentType.match(/video/)?s.push("Video"):t[a].contentType.match(/audio/)&&s.push("Audio")},function(t){for(Ce(t)||(t=[t],o=[o]),a=0;t.length>a;a++)console.log("urls["+a+"] = "+t[a]+", names["+a+"] = "+o[a]);e(t,o,s,r)},i||[".jpg",".png",".gif",".tif",".tiff"],!1,function(){Be.append(TAG.Util.UI.popUpMessage(null,"There was an error uploading the file.  Please try again later."))},!!n)}function Se(t){t=t||"Loading...";var e=$(document.createElement("div"));e.css({position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%","background-color":"rgba(0,0,0,0.5)","z-index":"1000"}),Be.append(e);var n=$(document.createElement("img"));n.attr("src","images/icons/progress-circle.gif"),n.css({height:"auto",width:"10%",position:"absolute",left:"45%",top:($(window).height()-.1*$(window).width())/2+"px"}),e.append(n);var i=$(document.createElement("div"));i.css({position:"absolute",visibility:"hidden",height:"auto",width:"auto","font-size":"200%"}),i.text(t),Be.append(i);var r=$(document.createElement("label"));r.css({position:"absolute",left:($(window).width()-i.width())/2+"px",top:($(window).height()-.1*$(window).width())/2+.1*$(window).width()+"px","font-size":"200%",color:"white"}),i.remove(),r.text(t),e.append(r)}function Me(){var t=TAG.Util.UI.popUpMessage(function(){TAG.Auth.clearToken(),un.clear(),cn.clear(),TAG.Layout.StartPage(null,function(t){TAG.Util.UI.slidePageRight(t)})},"Could not authenticate, returning to the splash page.",null,!0);Be.append(t),$(t).show()}function V(t){return function(){var e=TAG.Util.UI.popUpMessage(null,"An unknown error occured.",null,!0);Be.append(e),$(e).show(),t&&t()}}function q(t,e,n){return function(i,r){var a=TAG.Util.UI.PopUpConfirmation(function(){r.force()},"Your version of "+t.Name+" is not up to date.  Are you sure you want to change "+t.Name+"?",e,!0,n);Be.append(a),$(a).show()}}var Ie,De,Pe,$e,Ne,Ge,Oe,Le,Fe,Be=TAG.Util.getHtmlAjax("SettingsView.html"),Re=Be.find("#setViewLoadingCircle"),He=Be.find("#setViewSettingsContainer"),Ue=Be.find("#setViewSearchContainer"),ze=Be.find("#setViewNavBar"),je=Be.find("#setViewSearchBar"),We=Be.find("#setViewNewButton"),qe=Be.find("#setViewSecondaryButton"),Ve=Be.find("#setViewMiddleBar"),Ye=Be.find("#setViewMiddleLabelContainer"),Xe=(Be.find("#setViewRightBar"),Be.find("#setViewViewer")),Ke=Be.find("#setViewButtonContainer"),Ze=Be.find("#setViewSettingsBar"),Qe=Be.find("#setViewLoadingLabel"),Je=Be.find("#setViewLoadingCircle"),tn=(Be.find("#setViewRoot"),$(window).width()/$(window).height()),en="54",nn="92",rn="white",an="40",on={general:{text:"General Settings",subtext:"Customize TAG experience"},exhib:{text:"Collections",subtext:"Create and edit collections"},art:{text:"Artworks",subtext:"Import and manage artworks"},media:{text:"Associated Media",subtext:"Manage associated media"},tour:{text:"Tours",subtext:"Build interactive tours"},feedback:{text:"Feedback",subtext:"View comments and reports"}},sn={getRoot:u},ln={13:r,46:a,40:s,38:o},cn=TAG.Util.createQueue(),un=TAG.Util.createQueue(),dn=[],hn=0,pn=[],Ne=[],fn=0,gn=!1,mn=!1,vn=!1,yn=!1,bn=!1;return TAG.Util.UI.initKeyHandler(),TAG.Util.UI.getStack()[0]=ln,l(),e&&e(sn),{that:sn}},TAG.Util.makeNamespace("TAG.Authoring.ButtonBar"),TAG.Authoring.ButtonGroup=function(t,e){function n(t,e){function n(t){r.selected&&r.selected.removeClass(e.handleSelectedClass),r.selected=$(t.target).hasClass("ButtonItem")?$(t.target):$(t.target).parent(),r.selected.addClass(e.handleSelectedClass)}var r=$(document.createElement("div"));r.css("height","100%"),r.css("width","100%");var a=Math.round(100/t.length)-1;r.selected=null;for(var o=0;t.length>o;o++){var s=new i(t[o],e.isVertical);e.isVertical?(s.css("width","100%"),s.css("padding","3% 2%"),s.css("margin-bottom","2%")):(s.css("height","100%"),s.css("width",a+"%")),t[o].onClickFunction&&s.click(n),r.append(s),t[o].selected&&s.click()}return r}function i(t,e){var n=$(document.createElement("div"));if(n.addClass("ButtonItem"),t.isImage){var i=$("<img src='"+t.content+"' </img>");i.css("max-width","100%"),i.css("max-height","100%"),n.html(i)}else{var r=$("<div>"+t.content+"</div>");r.css("width","100%"),r.addClass(t.contentClass),n.append(r)}return n.click({dataArray:t.onClickData},t.onClickFunction),e||n.css("float","left"),n.addClass(t.itemClass),n.css("text-align","center"),n}return new n(t,e)},TAG.Util.makeNamespace("TAG.Authoring.FileUploader"),TAG.Authoring.FileUploadTypes={Standard:0,DeepZoom:1,AssociatedMedia:2,VideoArtwork:3},TAG.Authoring.FileUploader=function(t,e,n,i,r,a,o,s,l){"use strict";function c(t,e,n,i){".mp3"===t.fileType?t.properties.getMusicPropertiesAsync().done(function(t){t.duration/1e3>U?n():z>t.duration/1e3?i():e()},n):".mp4"===t.fileType?t.properties.getVideoPropertiesAsync().done(function(t){t.duration/1e3>U?n():z>t.duration/1e3?i():e()},n):e()}function u(t,e){function n(e){c(t[e],function(){a++,a===t.length?i():n(e++)},function(){r.push(e),W.push(t[e]),a++,a===t.length?i():n(e++)},function(){r.push(e),q.push(t[e]),a++,a===t.length?i():n(e++)})}function i(){r.sort(function(t,e){return e-t});for(var n=0;r.length>n;n++)t.splice(r[n],1);e()}var r=[],a=0;return 0===t.length?(e(),void 0):(n(0),void 0)}function d(t,e){return function(){e.start(t)}}function h(t,e,i){return function(){n(t,e,i)}}function p(t){0===$("#uploadingOverlay").length&&t.append(C)}function f(){C.remove()}function g(){var e=null,n=null;this.start=function(i){var r,a,o=O[i],s=L[i];try{p(t),C.show(),r=new Windows.Foundation.Uri(o),a=new Windows.Networking.BackgroundTransfer.BackgroundUploader,a.setRequestHeader("Filename",s.name),a.setRequestHeader("Content-Type","multipart/form-data; boundary=----WebKitFormBoundaryqj1e7E6nvkEBR9N5"),e=a.createUpload(r,s);var l=e.guid;R[l]=0,s.getBasicPropertiesAsync().then(function(t){N=t.size,n=e.startAsync().then(m(i),b,x),H.push(n)})}catch(c){f(),console.log(c.message)}},this.load=function(t){try{e=t,n=e.attachAsync().then(v,b,x(e))}catch(i){f(),o&&o()}}}function m(t){return function(e){v(e,t)}}function v(t,e){var n=(t.getResponseInformation(),t.getResultStreamAt(0)),i=new Windows.Storage.Streams.DataReader(n),r=i.loadAsync(1e7);r.operation.completed=function(){var t=i.readString(i.unconsumedBufferLength);I.push($.trim(t)),y()},M-1>e&&d(e+1,F)()}function y(){if(S+=1,S===M){f(),i(I);var t,e,n,r,a="",o=!1;if(""!==j&&(a="The following file(s) exceeded the 50MB file limit:"+j),W.length){for(o=!0,e=Math.floor(U/60),n=U%60,0===n?n="00":9>=n&&(n="0"+n),t="The following file(s) exceeded the "+e+":"+n+" duration limit:<br />",r=0;W.length>r;r++)t=t+W[r].name+"<br />";a+=t}if(q.length){for(o&&(a+="<br />"),e=Math.floor(z/60),n=z%60,0===n?n="00":9>=n&&(n="0"+n),t="The following file(s) are shorter than the "+e+":"+n+" lower duration limit:<br />",r=0;q.length>r;r++)t=t+q[r].name+"<br />";a+=t}if(a){var s=A(null,a,null,!1,!0);$(s).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3),$("body").append(s),$(s).fadeIn(500)}}}function b(t){var e,n=!1;"Unauthorized"===t.message.split(" ")[0]?(f(),console.log("unauthorized"),TAG.Auth.authenticate(function(){P(D)},function(){n=!0,e=TAG.Util.UI.popUpMessage(null,"File(s) not uploaded. You must login to upload files."),$("body").append(e),$(e).show()})):(f(),console.log("internal server error: possibly not enough RAM on the server VM to handle this upload"),e=TAG.Util.UI.popUpMessage(null,"A server error occurred. It is possible that an image you are trying to upload is too large for the server's memory."),$("body").append(e),$(e).show()),n&&(console.log("file upload error: "+t.message),console.log(t.message),f(),o&&o())}function x(t){var e=l||E;B[t.guid]=t.progress.totalBytesToSend;var n=t.progress.bytesSent;R[t.guid]=n;var i=0;for(var r in R)B[r]&&(i+=R[r]/(B[r]*M));e.width(90*i+"%")}function T(){var t;for(t=0;H.length>t;t++)H[t].cancel()}function w(t){U=t}function k(t){z=t}function A(t,e,n,i,r){function a(){i?($(o).hide(),$(o).remove()):$(o).fadeOut(500,function(){$(o).remove()})}var o=TAG.Util.UI.blockInteractionOverlay(),s=document.createElement("div"),l=TAG.Util.constrainAndPosition($(window).width(),$(window).height(),{center_h:!0,center_v:!0,width:.5,height:.35,max_width:560,max_height:200});$(s).css({position:"absolute",left:l.x+"px",top:l.y+"px",width:l.width+"px",height:l.height+"px",border:"3px double white","background-color":"black"});var c=document.createElement("div");$(c).css({color:"white",width:"90%",height:"57.5%",left:"5%",top:"12.5%","font-size":"1.25em",position:"relative","text-align":"center","word-wrap":"break-word","overflow-y":"auto"}),r?$(c).html(e):$(c).text(e);var u=document.createElement("div");$(u).addClass("optionButtonDiv"),$(u).css({height:"30%",width:"98%",position:"absolute",bottom:"0%",right:"2%"});var d=document.createElement("button");return $(d).css({padding:"1%",border:"1px solid white",width:"auto",position:"relative","float":"right","margin-right":"3%","margin-top":"0%"}),n=n&&""!==n?n:"OK",$(d).text(n),d.onclick=function(){t&&t(),a()},$(u).append(d),$(s).append(c),$(s).append(u),$(o).append(s),o}var _={};r=r||["*"],s=s||!1;var C=$(document.createElement("div")),E=$(document.createElement("div")),S=0,M=1e5,I=[];TAG.Util.createQueue();var D,P,N,G,O=[],L=[],F=null,B={},R={},H=[],U=1/0,z=-1,j="",W=[],q=[],V=52428800,Y=262144e3;return function(){var e=$(document.createElement("label")),n=$(document.createElement("img")),i=$(document.createElement("div"));C.attr("id","uploadingOverlay"),C.css({position:"absolute",left:"0%",top:"0%","background-color":"rgba(0, 0, 0, .5)",width:"100%",height:"100%","z-index":100000100}),e.css({color:"white",width:"10%",height:"5%",top:"38%",left:"40%",position:"relative","font-size":"250%"}),e.text("Uploading file(s). Please wait."),n.css({position:"relative",top:"50%",left:"14%"}),n.attr("src","images/icons/progress-circle.gif"),i.css({position:"relative",top:"42%",left:"45%","border-style":"solid","border-color":"white",width:"10%",height:"2%"}),E.css({"background-color":"white",width:"0%",height:"100%"}),i.append(E),C.append(e),C.append(i),C.hide(),t.append(C)}(),function(){Windows.UI.ViewManagement.ApplicationView.value;var t=new Windows.Storage.Pickers.FileOpenPicker;t.viewMode=a?Windows.Storage.Pickers.PickerViewMode.thumbnail:Windows.Storage.Pickers.PickerViewMode.list,t.fileTypeFilter.replaceAll(r),t.suggestedStartLocation=Windows.Storage.Pickers.PickerLocationId.desktop;try{s?t.pickMultipleFilesAsync().then(P=function(t){function n(s,l){s.getBasicPropertiesAsync().then(function(c){N=c.size,M=o.length;var p;switch(e){case TAG.Authoring.FileUploadTypes.VideoArtwork:case TAG.Authoring.FileUploadTypes.AssociatedMedia:case TAG.Authoring.FileUploadTypes.Standard:p=V;break;case TAG.Authoring.FileUploadTypes.DeepZoom:p=Y}if(p>N)switch(o.push(s),a.push(window.URL.createObjectURL(s,{oneTimeOnly:!0})),e){case TAG.Authoring.FileUploadTypes.VideoArtwork:i.push(TAG.Worktop.Database.getSecureURL()+"/?Type=FileUploadVideoArtwork&Client=Windows&ReturnDoq=true&token="+TAG.Auth.getToken()+"&Extension="+s.fileType.substr(1));break;case TAG.Authoring.FileUploadTypes.AssociatedMedia:i.push(TAG.Worktop.Database.getSecureURL()+"/?Type=FileUploadAssociatedMedia&Client=Windows&ReturnDoq=true&token="+TAG.Auth.getToken()+"&Extension="+s.fileType.substr(1));break;case TAG.Authoring.FileUploadTypes.Standard:i.push(TAG.Worktop.Database.getSecureURL()+"/?Type=FileUpload&Client=Windows&token="+TAG.Auth.getToken()+"&Extension="+s.fileType.substr(1));break;case TAG.Authoring.FileUploadTypes.DeepZoom:s.contentType.match(/video/)?i.push(TAG.Worktop.Database.getSecureURL()+"/?Type=FileUploadVideoArtwork&Client=Windows&ReturnDoq=true&token="+TAG.Auth.getToken()+"&Extension="+s.fileType.substr(1)):i.push(TAG.Worktop.Database.getSecureURL()+"/?Type=FileUploadDeepzoom&Client=Windows&ReturnDoq=true&token="+TAG.Auth.getToken()+"&Extension="+s.fileType.substr(1))}else j+="<br />"+s.name;t.length-1>l?n(t[l+1],l+1):l===t.length-1&&u(o,function(){var t,e;return f(),h([],[])(),0===o.length&&""!==j?(G=A(null,"The selected file(s) could not be uploaded because they exceed the 50MB file limit.",null),$(G).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3),$("body").append(G),$(G).fadeIn(500),void 0):0===o.length&&W.length>0?(t=Math.floor(U/60),e=U%60,0===e?e="00":9>=e&&(e="0"+e),G=A(null,"The selected file(s) could not uploaded because they exceed "+t+":"+e+" in length.",null),$(G).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3),$("body").append(G),$(G).fadeIn(500),void 0):0===o.length&&q.length>0?(t=Math.floor(z/60),e=z%60,0===e?e="00":9>=e&&(e="0"+e),G=A(null,"The selected file(s) could not uploaded because they are shorter than "+t+":"+e+" in length.",null),$(G).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3),$("body").append(G),$(G).fadeIn(500),void 0):0===o.length?(t=Math.floor(U/60),e=U%60,0===e?e="00":9>=e&&(e="0"+e),G=A(null,"The selected file(s) could not be uploaded because they exceed the 50MB file limit or exceed the "+t+":"+e+" duration limit.",null),$(G).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3),$("body").append(G),$(G).fadeIn(500),void 0):(L=o,M=o.length,O=i,F=r,d(0,r)(),h(o,a)(),void 0)})})}var i=[],r=new g,a=[],o=[];D=t,B={},R={},j="",W=[],q=[];var s=l||E;return s.width("0%"),0===t.length?(f(),h([],[])(),void 0):(n(t[0],0),void 0)}):t.pickSingleFileAsync().then(function(t){t?t.getBasicPropertiesAsync().then(function(i){N=i.size;var r;switch(e){case TAG.Authoring.FileUploadTypes.VideoArtwork:case TAG.Authoring.FileUploadTypes.AssociatedMedia:case TAG.Authoring.FileUploadTypes.Standard:r=V;break;case TAG.Authoring.FileUploadTypes.DeepZoom:r=Y}r>N?c(t,function(){var i,r,a=new g;switch(L=[t],M=1,r=window.URL.createObjectURL(t,{oneTimeOnly:!0}),e){case TAG.Authoring.FileUploadTypes.VideoArtwork:i=TAG.Worktop.Database.getSecureURL()+"/?Type=FileUploadVideoArtwork&Client=Windows&ReturnDoq=true&Token="+TAG.Auth.getToken()+"&Extension="+t.fileType.substr(1);break;case TAG.Authoring.FileUploadTypes.AssociatedMedia:i=TAG.Worktop.Database.getSecureURL()+"/?Type=FileUploadAssociatedMedia&Client=Windows&ReturnDoq=true&Token="+TAG.Auth.getToken()+"&Extension="+t.fileType.substr(1);break;case TAG.Authoring.FileUploadTypes.Standard:i=TAG.Worktop.Database.getSecureURL()+"/?Type=FileUpload&Client=Windows&Token="+TAG.Auth.getToken()+"&Extension="+t.fileType.substr(1);break;case TAG.Authoring.FileUploadTypes.DeepZoom:i=TAG.Worktop.Database.getSecureURL()+"/?Type=FileUploadDeepzoom&Client=Windows&ReturnDoq=true&token="+TAG.Auth.getToken()+"&Extension="+t.fileType.substr(1)}O=[i],F=a;var o;"string"==typeof(o=n([t],[r],[i]))?(G=A(null,o,null),$(G).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3),$("body").append(G),$(G).fadeIn(500)):a.start(0)},function(){var t=Math.floor(U/60),e=U%60;0===e?e="00":9>=e&&(e="0"+e),G=A(null,"The selected file exceeded the "+t+":"+e+" duration limit and could not be uploaded.",null),$(G).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3),$("body").append(G),$(G).fadeIn(500)},function(){var t=Math.floor(z/60),e=z%60;0===e?e="00":9>=e&&(e="0"+e),G=A(null,"The selected file is shorter than the "+t+":"+e+" lower duration limit and could not be uploaded.",null),$(G).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3),$("body").append(G),$(G).fadeIn(500)}):(G=A(null,"The selected file exceeded the 50MB file limit and could not be uploaded.",null),$(G).css("z-index",TAG.TourAuthoring.Constants.aboveRinZIndex+1e3),$("body").append(G),$(G).fadeIn(500))}):(f(),h([],[],[])())})}catch(i){console.log("file access failed: "+i.message),o&&o()}}(),_.cancelPromises=T,_.setMaxDuration=w,_.setMinDuration=k,_};var jscolor={dir:"",bindClass:"color",binding:!0,preloading:!0,install:function(){},init:function(){jscolor.binding&&jscolor.bind(),jscolor.preloading&&jscolor.preload()},getDir:function(){if(!jscolor.dir){var t=jscolor.detectDir();jscolor.dir=t!==!1?t:"jscolor/"}return jscolor.dir},detectDir:function(){for(var t=location.href,e=document.getElementsByTagName("base"),n=0;e.length>n;n+=1)e[n].href&&(t=e[n].href);for(var e=document.getElementsByTagName("script"),n=0;e.length>n;n+=1)if(e[n].src&&/(^|\/)jscolor\.js([?#].*)?$/i.test(e[n].src)){var i=new jscolor.URI(e[n].src),r=i.toAbsolute(t);return r.path=r.path.replace(/[^\/]+$/,""),r.query=null,r.fragment=null,""+r}return!1},bind:function(){for(var matchClass=RegExp("(^|\\s)("+jscolor.bindClass+")\\s*(\\{[^}]*\\})?","i"),e=document.getElementsByTagName("input"),i=0;e.length>i;i+=1){var m;if(!e[i].color&&e[i].className&&(m=e[i].className.match(matchClass))){var prop={};if(m[3])try{eval("prop="+m[3])}catch(eInvalidProp){}e[i].color=new jscolor.color(e[i],prop)}}},preload:function(){for(var t in jscolor.imgRequire)jscolor.imgRequire.hasOwnProperty(t)&&jscolor.loadImage(t)},images:{pad:[181,101],sld:[16,101],cross:[15,15],arrow:[7,11]},imgRequire:{},imgLoaded:{},requireImage:function(t){jscolor.imgRequire[t]=!0},loadImage:function(t){jscolor.imgLoaded[t]||(jscolor.imgLoaded[t]=new Image,jscolor.imgLoaded[t].src=jscolor.getDir()+t)},fetchElement:function(t){return"string"==typeof t?document.getElementById(t):t},addEvent:function(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent&&t.attachEvent("on"+e,n)},fireEvent:function(t,e){if(t)if(document.createEvent){var n=document.createEvent("HTMLEvents");n.initEvent(e,!0,!0),t.dispatchEvent(n)}else if(document.createEventObject){var n=document.createEventObject();t.fireEvent("on"+e,n)}else t["on"+e]&&t["on"+e]()},getElementPos:function(t){var e=t,n=t,i=0,r=0;if(e.offsetParent)do i+=e.offsetLeft,r+=e.offsetTop;while(e=e.offsetParent);for(;(n=n.parentNode)&&"BODY"!==n.nodeName.toUpperCase();)i-=n.scrollLeft,r-=n.scrollTop;return[i,r]},getElementSize:function(t){return[t.offsetWidth,t.offsetHeight]},getRelMousePos:function(t){var e=0,n=0;return t||(t=window.event),"number"==typeof t.offsetX?(e=t.offsetX,n=t.offsetY):"number"==typeof t.layerX&&(e=t.layerX,n=t.layerY),{x:e,y:n}},getViewPos:function(){return"number"==typeof window.pageYOffset?[window.pageXOffset,window.pageYOffset]:document.body&&(document.body.scrollLeft||document.body.scrollTop)?[document.body.scrollLeft,document.body.scrollTop]:document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)?[document.documentElement.scrollLeft,document.documentElement.scrollTop]:[0,0]},getViewSize:function(){return"number"==typeof window.innerWidth?[window.innerWidth,window.innerHeight]:document.body&&(document.body.clientWidth||document.body.clientHeight)?[document.body.clientWidth,document.body.clientHeight]:document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?[document.documentElement.clientWidth,document.documentElement.clientHeight]:[0,0]},URI:function(t){function e(t){for(var e="";t;)if("../"===t.substr(0,3)||"./"===t.substr(0,2))t=t.replace(/^\.+/,"").substr(1);else if("/./"===t.substr(0,3)||"/."===t)t="/"+t.substr(3);else if("/../"===t.substr(0,4)||"/.."===t)t="/"+t.substr(4),e=e.replace(/\/?[^\/]*$/,"");else if("."===t||".."===t)t="";else{var n=t.match(/^\/?[^\/]*/)[0];t=t.substr(n.length),e+=n}return e}this.scheme=null,this.authority=null,this.path="",this.query=null,this.fragment=null,this.parse=function(t){var e=t.match(/^(([A-Za-z][0-9A-Za-z+.-]*)(:))?((\/\/)([^\/?#]*))?([^?#]*)((\?)([^#]*))?((#)(.*))?/);return this.scheme=e[3]?e[2]:null,this.authority=e[5]?e[6]:null,this.path=e[7],this.query=e[9]?e[10]:null,this.fragment=e[12]?e[13]:null,this},this.toString=function(){var t="";return null!==this.scheme&&(t=t+this.scheme+":"),null!==this.authority&&(t=t+"//"+this.authority),null!==this.path&&(t+=this.path),null!==this.query&&(t=t+"?"+this.query),null!==this.fragment&&(t=t+"#"+this.fragment),t},this.toAbsolute=function(t){var t=new jscolor.URI(t),n=this,i=new jscolor.URI;return null===t.scheme?!1:(null!==n.scheme&&n.scheme.toLowerCase()===t.scheme.toLowerCase()&&(n.scheme=null),null!==n.scheme?(i.scheme=n.scheme,i.authority=n.authority,i.path=e(n.path),i.query=n.query):(null!==n.authority?(i.authority=n.authority,i.path=e(n.path),i.query=n.query):(""===n.path?(i.path=t.path,i.query=null!==n.query?n.query:t.query):("/"===n.path.substr(0,1)?i.path=e(n.path):(i.path=null!==t.authority&&""===t.path?"/"+n.path:t.path.replace(/[^\/]+$/,"")+n.path,i.path=e(i.path)),i.query=n.query),i.authority=t.authority),i.scheme=t.scheme),i.fragment=n.fragment,i)},t&&this.parse(t)},color:function(target,prop){function RGB_HSV(t,e,n){var i=Math.min(Math.min(t,e),n),r=Math.max(Math.max(t,e),n),a=r-i;if(0===a)return[null,0,r];var o=t===i?3+(n-e)/a:e===i?5+(t-n)/a:1+(e-t)/a;return[6===o?0:o,a/r,r]}function HSV_RGB(t,e,n){if(null===t)return[n,n,n];var i=Math.floor(t),r=i%2?t-i:1-(t-i),a=n*(1-e),o=n*(1-e*r);switch(i){case 6:case 0:return[n,o,a];case 1:return[o,n,a];case 2:return[a,n,o];case 3:return[a,o,n];case 4:return[o,a,n];case 5:return[n,a,o]}}function removePicker(){delete jscolor.picker.owner,document.getElementsByTagName("body")[0].removeChild(jscolor.picker.boxB)}function drawPicker(t,e){function n(){var t=THIS.pickerInsetColor.split(/\s+/),e=2>t.length?t[0]:t[1]+" "+t[0]+" "+t[0]+" "+t[1];o.btn.style.borderColor=e}if(!jscolor.picker){jscolor.picker={box:document.createElement("div"),boxB:document.createElement("div"),pad:document.createElement("div"),padB:document.createElement("div"),padM:document.createElement("div"),sld:document.createElement("div"),sldB:document.createElement("div"),sldM:document.createElement("div"),btn:document.createElement("div"),btnS:document.createElement("span"),btnT:document.createTextNode(THIS.pickerCloseText)};for(var i=0,r=4;jscolor.images.sld[1]>i;i+=r){var a=document.createElement("div");a.style.height=r+"px",a.style.fontSize="1px",a.style.lineHeight="0",jscolor.picker.sld.appendChild(a)}jscolor.picker.sldB.appendChild(jscolor.picker.sld),jscolor.picker.box.appendChild(jscolor.picker.sldB),jscolor.picker.box.appendChild(jscolor.picker.sldM),jscolor.picker.padB.appendChild(jscolor.picker.pad),jscolor.picker.box.appendChild(jscolor.picker.padB),jscolor.picker.box.appendChild(jscolor.picker.padM),jscolor.picker.btnS.appendChild(jscolor.picker.btnT),jscolor.picker.btn.appendChild(jscolor.picker.btnS),jscolor.picker.box.appendChild(jscolor.picker.btn),jscolor.picker.boxB.appendChild(jscolor.picker.box)}var o=jscolor.picker;o.box.onmouseup=o.box.onmouseout=function(){target.focus()},o.box.onmousedown=function(){abortBlur=!0},o.box.onmousemove=function(t){(holdPad||holdSld)&&(holdPad&&setPad(t),holdSld&&setSld(t),document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),dispatchImmediateChange())
},o.padM.onmouseup=o.padM.onmouseout=function(){holdPad&&(holdPad=!1,jscolor.fireEvent(valueElement,"change"))},o.padM.onmousedown=function(t){switch(modeID){case 0:0===THIS.hsv[2]&&THIS.fromHSV(null,null,1);break;case 1:0===THIS.hsv[1]&&THIS.fromHSV(null,1,null)}holdPad=!0,setPad(t),dispatchImmediateChange()},o.sldM.onmouseup=o.sldM.onmouseout=function(){holdSld&&(holdSld=!1,jscolor.fireEvent(valueElement,"change"))},o.sldM.onmousedown=function(t){holdSld=!0,setSld(t),dispatchImmediateChange()};var s=getPickerDims(THIS);o.box.style.width=s[0]+"px",o.box.style.height=s[1]+"px",o.boxB.style.position="absolute",o.boxB.style.clear="both",o.boxB.style.left=t+"px",o.boxB.style.top=e+"px",o.boxB.style.zIndex=THIS.pickerZIndex,o.boxB.style.border=THIS.pickerBorder+"px solid",o.boxB.style.borderColor=THIS.pickerBorderColor,o.boxB.style.background=THIS.pickerFaceColor,o.pad.style.width=jscolor.images.pad[0]+"px",o.pad.style.height=jscolor.images.pad[1]+"px",o.padB.style.position="absolute",o.padB.style.left=THIS.pickerFace+"px",o.padB.style.top=THIS.pickerFace+"px",o.padB.style.border=THIS.pickerInset+"px solid",o.padB.style.borderColor=THIS.pickerInsetColor,o.padM.style.position="absolute",o.padM.style.left="0",o.padM.style.top="0",o.padM.style.width=THIS.pickerFace+2*THIS.pickerInset+jscolor.images.pad[0]+jscolor.images.arrow[0]+"px",o.padM.style.height=o.box.style.height,o.padM.style.cursor="crosshair",o.sld.style.overflow="hidden",o.sld.style.width=jscolor.images.sld[0]+"px",o.sld.style.height=jscolor.images.sld[1]+"px",o.sldB.style.display=THIS.slider?"block":"none",o.sldB.style.position="absolute",o.sldB.style.right=THIS.pickerFace+"px",o.sldB.style.top=THIS.pickerFace+"px",o.sldB.style.border=THIS.pickerInset+"px solid",o.sldB.style.borderColor=THIS.pickerInsetColor,o.sldM.style.display=THIS.slider?"block":"none",o.sldM.style.position="absolute",o.sldM.style.right="0",o.sldM.style.top="0",o.sldM.style.width=jscolor.images.sld[0]+jscolor.images.arrow[0]+THIS.pickerFace+2*THIS.pickerInset+"px",o.sldM.style.height=o.box.style.height;try{o.sldM.style.cursor="pointer"}catch(l){o.sldM.style.cursor="hand"}o.btn.style.display=THIS.pickerClosable?"block":"none",o.btn.style.position="absolute",o.btn.style.left=THIS.pickerFace+"px",o.btn.style.bottom=THIS.pickerFace+"px",o.btn.style.padding="0 15px",o.btn.style.height="18px",o.btn.style.border=THIS.pickerInset+"px solid",n(),o.btn.style.color=THIS.pickerButtonColor,o.btn.style.font="12px sans-serif",o.btn.style.textAlign="center";try{o.btn.style.cursor="pointer"}catch(l){o.btn.style.cursor="hand"}switch(o.btn.onmousedown=function(){THIS.hidePicker()},o.btnS.style.lineHeight=o.btn.style.height,modeID){case 0:var c="hs.png";break;case 1:var c="hv.png"}o.padM.style.backgroundImage="url('"+jscolor.getDir()+"cross.gif')",o.padM.style.backgroundRepeat="no-repeat",o.sldM.style.backgroundImage="url('"+jscolor.getDir()+"arrow.gif')",o.sldM.style.backgroundRepeat="no-repeat",o.pad.style.backgroundImage="url('"+jscolor.getDir()+c+"')",o.pad.style.backgroundRepeat="no-repeat",o.pad.style.backgroundPosition="0 0",redrawPad(),redrawSld(),jscolor.picker.owner=THIS,document.getElementsByTagName("body")[0].appendChild(o.boxB)}function getPickerDims(t){var e=[2*t.pickerInset+2*t.pickerFace+jscolor.images.pad[0]+(t.slider?2*t.pickerInset+2*jscolor.images.arrow[0]+jscolor.images.sld[0]:0),t.pickerClosable?4*t.pickerInset+3*t.pickerFace+jscolor.images.pad[1]+t.pickerButtonHeight:2*t.pickerInset+2*t.pickerFace+jscolor.images.pad[1]];return e}function redrawPad(){switch(modeID){case 0:var t=1;break;case 1:var t=2}var e=Math.round(THIS.hsv[0]/6*(jscolor.images.pad[0]-1)),n=Math.round((1-THIS.hsv[t])*(jscolor.images.pad[1]-1));jscolor.picker.padM.style.backgroundPosition=THIS.pickerFace+THIS.pickerInset+e-Math.floor(jscolor.images.cross[0]/2)+"px "+(THIS.pickerFace+THIS.pickerInset+n-Math.floor(jscolor.images.cross[1]/2))+"px";var i=jscolor.picker.sld.childNodes;switch(modeID){case 0:for(var r=HSV_RGB(THIS.hsv[0],THIS.hsv[1],1),a=0;i.length>a;a+=1)i[a].style.backgroundColor="rgb("+100*r[0]*(1-a/i.length)+"%,"+100*r[1]*(1-a/i.length)+"%,"+100*r[2]*(1-a/i.length)+"%)";break;case 1:var r,o,s=[THIS.hsv[2],0,0],a=Math.floor(THIS.hsv[0]),l=a%2?THIS.hsv[0]-a:1-(THIS.hsv[0]-a);switch(a){case 6:case 0:r=[0,1,2];break;case 1:r=[1,0,2];break;case 2:r=[2,0,1];break;case 3:r=[2,1,0];break;case 4:r=[1,2,0];break;case 5:r=[0,2,1]}for(var a=0;i.length>a;a+=1)o=1-1/(i.length-1)*a,s[1]=s[0]*(1-o*l),s[2]=s[0]*(1-o),i[a].style.backgroundColor="rgb("+100*s[r[0]]+"%,"+100*s[r[1]]+"%,"+100*s[r[2]]+"%)"}}function redrawSld(){switch(modeID){case 0:var t=2;break;case 1:var t=1}var e=Math.round((1-THIS.hsv[t])*(jscolor.images.sld[1]-1));jscolor.picker.sldM.style.backgroundPosition="0 "+(THIS.pickerFace+THIS.pickerInset+e-Math.floor(jscolor.images.arrow[1]/2))+"px"}function isPickerOwner(){return jscolor.picker&&jscolor.picker.owner===THIS}function blurTarget(){valueElement===target&&THIS.importColor(),THIS.pickerOnfocus&&THIS.hidePicker()}function blurValue(){valueElement!==target&&THIS.importColor()}function setPad(t){var e=jscolor.getRelMousePos(t),n=e.x-THIS.pickerFace-THIS.pickerInset,i=e.y-THIS.pickerFace-THIS.pickerInset;switch(modeID){case 0:THIS.fromHSV(n*(6/(jscolor.images.pad[0]-1)),1-i/(jscolor.images.pad[1]-1),null,leaveSld);break;case 1:THIS.fromHSV(n*(6/(jscolor.images.pad[0]-1)),null,1-i/(jscolor.images.pad[1]-1),leaveSld)}}function setSld(t){var e=jscolor.getRelMousePos(t),n=e.y-THIS.pickerFace-THIS.pickerInset;switch(modeID){case 0:THIS.fromHSV(null,null,1-n/(jscolor.images.sld[1]-1),leavePad);break;case 1:THIS.fromHSV(null,1-n/(jscolor.images.sld[1]-1),null,leavePad)}}function dispatchImmediateChange(){THIS.onImmediateChange&&("string"==typeof THIS.onImmediateChange?eval(THIS.onImmediateChange):THIS.onImmediateChange(THIS))}this.required=!0,this.adjust=!0,this.hash=!1,this.caps=!0,this.slider=!0,this.valueElement=target,this.styleElement=target,this.onImmediateChange=null,this.hsv=[0,0,1],this.rgb=[1,1,1],this.pickerOnfocus=!0,this.pickerMode="HSV",this.pickerPosition="bottom",this.pickerSmartPosition=!0,this.pickerButtonHeight=20,this.pickerClosable=!1,this.pickerCloseText="Close",this.pickerButtonColor="ButtonText",this.pickerFace=10,this.pickerFaceColor="ThreeDFace",this.pickerBorder=1,this.pickerBorderColor="ThreeDHighlight ThreeDShadow ThreeDShadow ThreeDHighlight",this.pickerInset=1,this.pickerInsetColor="ThreeDShadow ThreeDHighlight ThreeDHighlight ThreeDShadow",this.pickerZIndex=1e4;for(var p in prop)prop.hasOwnProperty(p)&&(this[p]=prop[p]);this.hidePicker=function(){isPickerOwner()&&removePicker()},this.showPicker=function(){if(!isPickerOwner()){var t,e,n,i=jscolor.getElementPos(target),r=jscolor.getElementSize(target),a=jscolor.getViewPos(),o=jscolor.getViewSize(),s=getPickerDims(this);switch(this.pickerPosition.toLowerCase()){case"left":t=1,e=0,n=-1;break;case"right":t=1,e=0,n=1;break;case"top":t=0,e=1,n=-1;break;default:t=0,e=1,n=1}var l=(r[e]+s[e])/2;if(this.pickerSmartPosition)var c=[-a[t]+i[t]+s[t]>o[t]?-a[t]+i[t]+r[t]/2>o[t]/2&&i[t]+r[t]-s[t]>=0?i[t]+r[t]-s[t]:i[t]:i[t],-a[e]+i[e]+r[e]+s[e]-l+l*n>o[e]?-a[e]+i[e]+r[e]/2>o[e]/2&&i[e]+r[e]-l-l*n>=0?i[e]+r[e]-l-l*n:i[e]+r[e]-l+l*n:i[e]+r[e]-l+l*n>=0?i[e]+r[e]-l+l*n:i[e]+r[e]-l-l*n];else var c=[i[t],i[e]+r[e]-l+l*n];drawPicker(c[t],c[e])}},this.importColor=function(){valueElement?this.adjust?!this.required&&/^\s*$/.test(valueElement.value)?(valueElement.value="",styleElement.style.backgroundImage=styleElement.jscStyle.backgroundImage,styleElement.style.backgroundColor=styleElement.jscStyle.backgroundColor,styleElement.style.color=styleElement.jscStyle.color,this.exportColor(leaveValue|leaveStyle)):this.fromString(valueElement.value)||this.exportColor():this.fromString(valueElement.value,leaveValue)||(styleElement.style.backgroundImage=styleElement.jscStyle.backgroundImage,styleElement.style.backgroundColor=styleElement.jscStyle.backgroundColor,styleElement.style.color=styleElement.jscStyle.color,this.exportColor(leaveValue|leaveStyle)):this.exportColor()},this.exportColor=function(t){if(!(t&leaveValue)&&valueElement){var e=""+this;this.caps&&(e=e.toUpperCase()),this.hash&&(e="#"+e),valueElement.value=e}t&leaveStyle||!styleElement||(styleElement.style.backgroundImage="none",styleElement.style.backgroundColor="#"+(""+this),styleElement.style.color=.5>.213*this.rgb[0]+.715*this.rgb[1]+.072*this.rgb[2]?"#FFF":"#000"),t&leavePad||!isPickerOwner()||redrawPad(),t&leaveSld||!isPickerOwner()||redrawSld()},this.fromHSV=function(t,e,n,i){0>t&&(t=0)||t>6&&(t=6),0>e&&(e=0)||e>1&&(e=1),0>n&&(n=0)||n>1&&(n=1),this.rgb=HSV_RGB(null===t?this.hsv[0]:this.hsv[0]=t,null===e?this.hsv[1]:this.hsv[1]=e,null===n?this.hsv[2]:this.hsv[2]=n),this.exportColor(i)},this.fromRGB=function(t,e,n,i){0>t&&(t=0)||t>1&&(t=1),0>e&&(e=0)||e>1&&(e=1),0>n&&(n=0)||n>1&&(n=1);var r=RGB_HSV(null===t?this.rgb[0]:this.rgb[0]=t,null===e?this.rgb[1]:this.rgb[1]=e,null===n?this.rgb[2]:this.rgb[2]=n);null!==r[0]&&(this.hsv[0]=r[0]),0!==r[2]&&(this.hsv[1]=r[1]),this.hsv[2]=r[2],this.exportColor(i)},this.fromString=function(t,e){var n=t.match(/^\W*([0-9A-F]{3}([0-9A-F]{3})?)\W*$/i);return n?(6===n[1].length?this.fromRGB(parseInt(n[1].substr(0,2),16)/255,parseInt(n[1].substr(2,2),16)/255,parseInt(n[1].substr(4,2),16)/255,e):this.fromRGB(parseInt(n[1].charAt(0)+n[1].charAt(0),16)/255,parseInt(n[1].charAt(1)+n[1].charAt(1),16)/255,parseInt(n[1].charAt(2)+n[1].charAt(2),16)/255,e),!0):!1},this.toString=function(){return(256|Math.round(255*this.rgb[0])).toString(16).substr(1)+(256|Math.round(255*this.rgb[1])).toString(16).substr(1)+(256|Math.round(255*this.rgb[2])).toString(16).substr(1)};var THIS=this,modeID="hvs"===this.pickerMode.toLowerCase()?1:0,abortBlur=!1,valueElement=jscolor.fetchElement(this.valueElement),styleElement=jscolor.fetchElement(this.styleElement),holdPad=!1,holdSld=!1,leaveValue=1,leaveStyle=2,leavePad=4,leaveSld=8;if(jscolor.addEvent(target,"focus",function(){THIS.pickerOnfocus&&THIS.showPicker()}),jscolor.addEvent(target,"blur",function(){abortBlur?abortBlur=!1:window.setTimeout(function(){abortBlur||blurTarget(),abortBlur=!1},0)}),valueElement){var updateField=function(){THIS.fromString(valueElement.value,leaveValue),dispatchImmediateChange()};jscolor.addEvent(valueElement,"keyup",updateField),jscolor.addEvent(valueElement,"input",updateField),jscolor.addEvent(valueElement,"blur",blurValue),valueElement.setAttribute("autocomplete","off")}switch(styleElement&&(styleElement.jscStyle={backgroundImage:styleElement.style.backgroundImage,backgroundColor:styleElement.style.backgroundColor,color:styleElement.style.color}),modeID){case 0:jscolor.requireImage("hs.png");break;case 1:jscolor.requireImage("hv.png")}jscolor.requireImage("cross.gif"),jscolor.requireImage("arrow.gif"),this.importColor()}};jscolor.install(),function(t,e){function n(t,e){return function(){if(m.plugin.debug)return t.apply(this,arguments);try{return t.apply(this,arguments)}catch(n){m.plugin.errors.push({plugin:e,thrown:n,source:""+t}),this.emit("pluginerror",m.plugin.errors)}}}if(e.addEventListener){var i=Array.prototype,r=Object.prototype,a=i.forEach,o=i.slice,s=r.hasOwnProperty,l=r.toString,c=t.Popcorn,u=[],d=!1,h=!1,p={events:{hash:{},apis:{}}},f=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e){t.setTimeout(e,16)}}(),g=function(t){return Object.keys?Object.keys(t):function(t){var e,n=[];for(e in t)s.call(t,e)&&n.push(e);return n}(t)},m=function(t,e){return new m.p.init(t,e||null)};m.version="1.3",m.isSupported=!0,m.instances=[],m.p=m.prototype={init:function(t,n){var i,r,a=this;{if("function"!=typeof t){if("string"==typeof t)try{i=e.querySelector(t)}catch(o){throw Error("Popcorn.js Error: Invalid media element selector: "+t)}if(this.media=i||t,r=this.media.nodeName&&this.media.nodeName.toLowerCase()||"video",this[r]=this.media,this.options=n||{},this.id=this.options.id||m.guid(r),m.byId(this.id))throw Error("Popcorn.js Error: Cannot use duplicate ID ("+this.id+")");this.isDestroyed=!1,this.data={running:{cue:[]},timeUpdate:m.nop,disabled:{},events:{},hooks:{},history:[],state:{volume:this.media.volume},trackRefs:{},trackEvents:{byStart:[{start:-1,end:-1}],byEnd:[{start:-1,end:-1}],animating:[],startIndex:0,endIndex:0,previousUpdateTime:-1}},m.instances.push(this);var s=function(){0>a.media.currentTime&&(a.media.currentTime=0),a.media.removeEventListener("loadeddata",s,!1);var t,e,n,i,r,o;t=a.media.duration,e=t!=t?Number.MAX_VALUE:t+1,m.addTrackEvent(a,{start:e,end:e}),a.options.frameAnimation?(a.data.timeUpdate=function(){m.timeUpdate(a,{}),m.forEach(m.manifest,function(t,e){if(n=a.data.running[e]){r=n.length;for(var s=0;r>s;s++)i=n[s],o=i._natives,o&&o.frame&&o.frame.call(a,{},i,a.currentTime())}}),a.emit("timeupdate"),!a.isDestroyed&&f(a.data.timeUpdate)},!a.isDestroyed&&f(a.data.timeUpdate)):(a.data.timeUpdate=function(t){m.timeUpdate(a,t)},a.isDestroyed||a.media.addEventListener("timeupdate",a.data.timeUpdate,!1))};return Object.defineProperty(this,"error",{get:function(){return a.media.error}}),a.media.readyState>=2?s():a.media.addEventListener("loadeddata",s,!1),this}if("complete"===e.readyState)return t(e,m),void 0;if(u.push(t),!d){d=!0;var l=function(){h=!0,e.removeEventListener("DOMContentLoaded",l,!1);for(var t=0,n=u.length;n>t;t++)u[t].call(e,m);u=null};e.addEventListener("DOMContentLoaded",l,!1)}}}},m.p.init.prototype=m.p,m.byId=function(t){for(var e=m.instances,n=e.length,i=0;n>i;i++)if(e[i].id===t)return e[i];return null},m.forEach=function(t,e,n){if(!t||!e)return{};n=n||this;var i,r;if(a&&t.forEach===a)return t.forEach(e,n);if("[object NodeList]"===l.call(t)){for(i=0,r=t.length;r>i;i++)e.call(n,t[i],i,t);return t}for(i in t)s.call(t,i)&&e.call(n,t[i],i,t);return t},m.extend=function(t){var e=t,n=o.call(arguments,1);return m.forEach(n,function(t){for(var n in t)e[n]=t[n]}),e},m.extend(m,{noConflict:function(e){return e&&(t.Popcorn=c),m},error:function(t){throw Error(t)},guid:function(t){return m.guid.counter++,(t?t:"")+(+new Date+m.guid.counter)},sizeOf:function(t){var e=0;for(var n in t)e++;return e},isArray:Array.isArray||function(t){return"[object Array]"===l.call(t)},nop:function(){},position:function(n){var i,r,a,o,s,l,c=n.getBoundingClientRect(),u={},d=(n.ownerDocument,e.documentElement),h=e.body;i=d.clientTop||h.clientTop||0,r=d.clientLeft||h.clientLeft||0,a=t.pageYOffset&&d.scrollTop||h.scrollTop,o=t.pageXOffset&&d.scrollLeft||h.scrollLeft,s=Math.ceil(c.top+a-i),l=Math.ceil(c.left+o-r);for(var p in c)u[p]=Math.round(c[p]);return m.extend({},u,{top:s,left:l})},disable:function(t,e){if(!t.data.disabled[e]){t.data.disabled[e]=!0;for(var n,i=t.data.running[e].length-1;i>=0;i--)n=t.data.running[e][i],n._natives.end.call(t,null,n)}return t},enable:function(t,e){if(t.data.disabled[e]){t.data.disabled[e]=!1;for(var n,i=t.data.running[e].length-1;i>=0;i--)n=t.data.running[e][i],n._natives.start.call(t,null,n)}return t},destroy:function(t){var e,n,i,r,a=t.data.events,o=t.data.trackEvents;for(n in a){e=a[n];for(i in e)delete e[i];a[n]=null}for(r in m.registryByName)m.removePlugin(t,r);o.byStart.length=0,o.byEnd.length=0,t.isDestroyed||(t.data.timeUpdate&&t.media.removeEventListener("timeupdate",t.data.timeUpdate,!1),t.isDestroyed=!0)}}),m.guid.counter=1,m.extend(m.p,function(){var t="load play pause currentTime playbackRate volume duration preload playbackRate autoplay loop controls muted buffered readyState seeking paused played seekable ended",e={};return m.forEach(t.split(/\s+/g),function(t){e[t]=function(e){var n;return"function"==typeof this.media[t]?(null!=e&&/play|pause/.test(t)&&(this.media.currentTime=m.util.toSeconds(e)),this.media[t](),this):null!=e?(n=this.media[t],this.media[t]=e,n!==e&&this.emit("attrchange",{attribute:t,previousValue:n,currentValue:e}),this):this.media[t]}}),e}()),m.forEach("enable disable".split(" "),function(t){m.p[t]=function(e){return m[t](this,e)}}),m.extend(m.p,{roundTime:function(){return Math.round(this.media.currentTime)},exec:function(t,e,n){var i,r,a=arguments.length;try{r=m.util.toSeconds(t)}catch(o){}if("number"==typeof r&&(t=r),"number"==typeof t&&2===a)n=e,e=t,t=m.guid("cue");else if(1===a)e=-1;else if(i=this.getTrackEvent(t))"string"==typeof t&&2===a&&("number"==typeof e&&(n=i._natives.start),"function"==typeof e&&(n=e,e=i.start));else if(a>=2){if("string"==typeof e){try{r=m.util.toSeconds(e)}catch(o){}e=r}"number"==typeof e&&(n=m.nop()),"function"==typeof e&&(n=e,e=-1)}return m.addTrackEvent(this,{id:t,start:e,end:e+1,_running:!1,_natives:{start:n||m.nop,end:m.nop,type:"cue"}}),this},mute:function(t){var e=null==t||t===!0?"muted":"unmuted";return"unmuted"===e&&(this.media.muted=!1,this.media.volume=this.data.state.volume),"muted"===e&&(this.data.state.volume=this.media.volume,this.media.muted=!0),this.emit(e),this},unmute:function(t){return this.mute(null==t?!1:!t)},position:function(){return m.position(this.media)},toggle:function(t){return m[this.data.disabled[t]?"enable":"disable"](this,t)},defaults:function(t,e){return m.isArray(t)?(m.forEach(t,function(t){for(var e in t)this.defaults(e,t[e])},this),this):(this.options.defaults||(this.options.defaults={}),this.options.defaults[t]||(this.options.defaults[t]={}),m.extend(this.options.defaults[t],e),this)}}),m.Events={UIEvents:"blur focus focusin focusout load resize scroll unload",MouseEvents:"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave click dblclick",Events:"loadstart progress suspend emptied stalled play pause error loadedmetadata loadeddata waiting playing canplay canplaythrough seeking seeked timeupdate ended ratechange durationchange volumechange"},m.Events.Natives=m.Events.UIEvents+" "+m.Events.MouseEvents+" "+m.Events.Events,p.events.apiTypes=["UIEvents","MouseEvents","Events"],function(t,e){for(var n=p.events.apiTypes,i=t.Natives.split(/\s+/g),r=0,a=i.length;a>r;r++)e.hash[i[r]]=!0;n.forEach(function(n){e.apis[n]={};for(var i=t[n].split(/\s+/g),r=i.length,a=0;r>a;a++)e.apis[n][i[a]]=!0})}(m.Events,p.events),m.events={isNative:function(t){return!!p.events.hash[t]},getInterface:function(t){if(!m.events.isNative(t))return!1;for(var e,n,i=p.events,r=i.apiTypes,a=i.apis,o=0,s=r.length;s>o;o++)if(n=r[o],a[n][t]){e=n;break}return e},all:m.Events.Natives.split(/\s+/g),fn:{trigger:function(n,i){var r,a;if(this.data.events[n]&&m.sizeOf(this.data.events[n])){if(r=m.events.getInterface(n))return a=e.createEvent(r),a.initEvent(n,!0,!0,t,1),this.media.dispatchEvent(a),this;m.forEach(this.data.events[n],function(t){t.call(this,i)},this)}return this},listen:function(t,e){var n,i=this,r=!0,a=m.events.hooks[t];return this.data.events[t]||(this.data.events[t]={},r=!1),a&&(a.add&&a.add.call(this,{},e),a.bind&&(t=a.bind),a.handler&&(n=e,e=function(t){a.handler.call(i,t,n)}),r=!0,this.data.events[t]||(this.data.events[t]={},r=!1)),this.data.events[t][e.name||""+e+m.guid()]=e,!r&&m.events.all.indexOf(t)>-1&&this.media.addEventListener(t,function(e){m.forEach(i.data.events[t],function(t){"function"==typeof t&&t.call(i,e)})},!1),this},unlisten:function(t,e){return this.data.events[t]&&this.data.events[t][e]?(delete this.data.events[t][e],this):(this.data.events[t]=null,this)}},hooks:{canplayall:{bind:"canplaythrough",add:function(t,e){var n=!1;this.media.readyState&&(e.call(this,t),n=!0),this.data.hooks.canplayall={fired:n}},handler:function(t,e){this.data.hooks.canplayall.fired||(e.call(this,t),this.data.hooks.canplayall.fired=!0)}}}},m.forEach([["trigger","emit"],["listen","on"],["unlisten","off"]],function(t){m.p[t[0]]=m.p[t[1]]=m.events.fn[t[0]]}),m.addTrackEvent=function(t,e){var n,i,r;e.id&&(n=t.getTrackEvent(e.id)),n&&(i=!0,e=m.extend({},n,e),t.removeTrackEvent(e.id)),e&&e._natives&&e._natives.type&&t.options.defaults&&t.options.defaults[e._natives.type]&&(e=m.extend({},t.options.defaults[e._natives.type],e)),e._natives&&(e._id=e.id||e._id||m.guid(e._natives.type),t.data.history.push(e._id)),e.start=m.util.toSeconds(e.start,t.options.framerate),e.end=m.util.toSeconds(e.end,t.options.framerate);var a,o,s=t.data.trackEvents.byStart,l=t.data.trackEvents.byEnd;for(a=s.length-1;a>=0;a--)if(e.start>=s[a].start){s.splice(a+1,0,e);break}for(o=l.length-1;o>=0;o--)if(e.end>l[o].end){l.splice(o+1,0,e);break}e.end>t.media.currentTime&&e.start<=t.media.currentTime&&(e._running=!0,t.data.running[e._natives.type].push(e),t.data.disabled[e._natives.type]||e._natives.start.call(t,null,e)),t.data.trackEvents.startIndex>=a&&e.start<=t.data.trackEvents.previousUpdateTime&&t.data.trackEvents.startIndex++,t.data.trackEvents.endIndex>=o&&e.end<t.data.trackEvents.previousUpdateTime&&t.data.trackEvents.endIndex++,this.timeUpdate(t,null,!0),e._id&&m.addTrackEvent.ref(t,e),i&&(r="cue"===e._natives.type?"cuechange":"trackchange",t.emit(r,{id:e.id,previousValue:{time:n.start,fn:n._natives.start},currentValue:{time:e.start,fn:e._natives.start}}))},m.addTrackEvent.ref=function(t,e){return t.data.trackRefs[e._id]=e,t},m.removeTrackEvent=function(t,e){for(var n,i,r,a=t.data.history.length,o=t.data.trackEvents.byStart.length,s=0,l=0,c=[],u=[],d=[],h=[];--o>-1;)n=t.data.trackEvents.byStart[s],i=t.data.trackEvents.byEnd[s],n._id||(c.push(n),u.push(i)),n._id&&(n._id!==e&&c.push(n),i._id!==e&&u.push(i),n._id===e&&(l=s,n._natives._teardown&&n._natives._teardown.call(t,n))),s++;if(o=t.data.trackEvents.animating.length,s=0,o)for(;--o>-1;)r=t.data.trackEvents.animating[s],r._id||d.push(r),r._id&&r._id!==e&&d.push(r),s++;t.data.trackEvents.startIndex>=l&&t.data.trackEvents.startIndex--,t.data.trackEvents.endIndex>=l&&t.data.trackEvents.endIndex--,t.data.trackEvents.byStart=c,t.data.trackEvents.byEnd=u,t.data.trackEvents.animating=d;for(var p=0;a>p;p++)t.data.history[p]!==e&&h.push(t.data.history[p]);t.data.history=h,m.removeTrackEvent.ref(t,e)},m.removeTrackEvent.ref=function(t,e){return delete t.data.trackRefs[e],t},m.getTrackEvents=function(t){for(var e,n=[],i=t.data.trackEvents.byStart,r=i.length,a=0;r>a;a++)e=i[a],e._id&&n.push(e);return n},m.getTrackEvents.ref=function(t){return t.data.trackRefs},m.getTrackEvent=function(t,e){return t.data.trackRefs[e]},m.getTrackEvent.ref=function(t,e){return t.data.trackRefs[e]},m.getLastTrackEventId=function(t){return t.data.history[t.data.history.length-1]},m.timeUpdate=function(t,e){var n,i,r,a,o,s=t.media.currentTime,l=t.data.trackEvents.previousUpdateTime,c=t.data.trackEvents,u=c.endIndex,d=c.startIndex,h=c.byStart.length,p=c.byEnd.length,f=m.registryByName,g="trackstart",v="trackend";if(s>=l){for(;c.byEnd[u]&&s>=c.byEnd[u].end;){if(n=c.byEnd[u],r=n._natives,a=r&&r.type,r&&!f[a]&&!t[a])return m.removeTrackEvent(t,n._id),void 0;n._running===!0&&(n._running=!1,o=t.data.running[a],o.splice(o.indexOf(n),1),t.data.disabled[a]||(r.end.call(t,e,n),t.emit(v,m.extend({},n,{plugin:a,type:v})))),u++}for(;c.byStart[d]&&s>=c.byStart[d].start;){if(i=c.byStart[d],r=i._natives,a=r&&r.type,r&&!f[a]&&!t[a])return m.removeTrackEvent(t,i._id),void 0;i.end>s&&i._running===!1&&(i._running=!0,t.data.running[a].push(i),t.data.disabled[a]||(r.start.call(t,e,i),t.emit(g,m.extend({},i,{plugin:a,type:g})))),d++}}else if(l>s){for(;c.byStart[d]&&c.byStart[d].start>s;){if(i=c.byStart[d],r=i._natives,a=r&&r.type,r&&!f[a]&&!t[a])return m.removeTrackEvent(t,i._id),void 0;i._running===!0&&(i._running=!1,o=t.data.running[a],o.splice(o.indexOf(i),1),t.data.disabled[a]||(r.end.call(t,e,i),t.emit(v,m.extend({},i,{plugin:a,type:v})))),d--}for(;c.byEnd[u]&&c.byEnd[u].end>s;){if(n=c.byEnd[u],r=n._natives,a=r&&r.type,r&&!f[a]&&!t[a])return m.removeTrackEvent(t,n._id),void 0;s>=n.start&&n._running===!1&&(n._running=!0,t.data.running[a].push(n),t.data.disabled[a]||(r.start.call(t,e,n),t.emit(g,m.extend({},n,{plugin:a,type:g})))),u--}}c.endIndex=u,c.startIndex=d,c.previousUpdateTime=s,h>c.byStart.length&&c.startIndex--,p>c.byEnd.length&&c.endIndex--},m.extend(m.p,{getTrackEvents:function(){return m.getTrackEvents.call(null,this)},getTrackEvent:function(t){return m.getTrackEvent.call(null,this,t)},getLastTrackEventId:function(){return m.getLastTrackEventId.call(null,this)},removeTrackEvent:function(t){return m.removeTrackEvent.call(null,this,t),this},removePlugin:function(t){return m.removePlugin.call(null,this,t),this},timeUpdate:function(t){return m.timeUpdate.call(null,this,t),this},destroy:function(){return m.destroy.call(null,this),this}}),m.manifest={},m.registry=[],m.registryByName={},m.plugin=function(t,e,i){if(m.protect.natives.indexOf(t.toLowerCase())>=0)return m.error("'"+t+"' is a protected function name"),void 0;var r=["start","end"],a={},l="function"==typeof e,c=["_setup","_teardown","start","end","frame"],u=function(t,e){return t=t||m.nop,e=e||m.nop,function(){t.apply(this,arguments),e.apply(this,arguments)}};m.manifest[t]=i=i||e.manifest||{},c.forEach(function(i){e[i]=n(e[i]||m.nop,t)});var d=function(e,n){if(!n)return this;if(n.ranges&&m.isArray(n.ranges))return m.forEach(n.ranges,function(e){var i=m.extend({},n,e);delete i.ranges,this[t](i)},this),this;var a,l=n._natives={},d="";return m.extend(l,e),n._natives.type=t,n._running=!1,l.start=l.start||l["in"],l.end=l.end||l.out,n.once&&(l.end=u(l.end,function(){this.removeTrackEvent(n._id)})),l._teardown=u(function(){var t=o.call(arguments),e=this.data.running[l.type];t.unshift(null),t[1]._running&&e.splice(e.indexOf(n),1)&&l.end.apply(this,t)},l._teardown),n.compose=n.compose&&n.compose.split(" ")||[],n.effect=n.effect&&n.effect.split(" ")||[],n.compose=n.compose.concat(n.effect),n.compose.forEach(function(t){d=m.compositions[t]||{},c.forEach(function(t){l[t]=u(l[t],d[t])})}),n._natives.manifest=i,"start"in n||(n.start=n["in"]||0),n.end||0===n.end||(n.end=n.out||Number.MAX_VALUE),s.call(n,"toString")||(n.toString=function(){var e=["start: "+n.start,"end: "+n.end,"id: "+(n.id||n._id)];return null!=n.target&&e.push("target: "+n.target),t+" ( "+e.join(", ")+" )"}),n.target||(a="options"in i&&i.options,n.target=a&&"target"in a&&a.target),n._natives&&(n._id=m.guid(n._natives.type)),n._natives._setup&&n._natives._setup.call(this,n),m.addTrackEvent(this,n),m.forEach(e,function(t,e){"type"!==e&&-1===r.indexOf(e)&&this.on(e,t)},this),this};m.p[t]=a[t]=function(n,i){var r,a,o;if(arguments.length,n&&!i)i=n,n=null;else{if(r=this.getTrackEvent(n))return i=m.extend({},r,i),m.addTrackEvent(this,i),this;i.id=n}return this.data.running[t]=this.data.running[t]||[],a=this.options.defaults&&this.options.defaults[t]||{},o=m.extend({},a,i),d.call(this,l?e.call(this,o):e,o)},i&&m.extend(e,{manifest:i});var h={fn:a[t],definition:e,base:e,parents:[],name:t};return m.registry.push(m.extend(a,h,{type:t})),m.registryByName[t]=h,a},m.plugin.errors=[],m.plugin.debug="@VERSION"===m.version,m.removePlugin=function(t,e){if(!e){if(e=t,t=m.p,m.protect.natives.indexOf(e.toLowerCase())>=0)return m.error("'"+e+"' is a protected function name"),void 0;var n,i=m.registry.length;for(n=0;i>n;n++)if(m.registry[n].name===e)return m.registry.splice(n,1),delete m.registryByName[e],delete m.manifest[e],delete t[e],void 0}var r,a,o=t.data.trackEvents.byStart,s=t.data.trackEvents.byEnd,l=t.data.trackEvents.animating;for(r=0,a=o.length;a>r;r++)o[r]&&o[r]._natives&&o[r]._natives.type===e&&(o[r]._natives._teardown&&o[r]._natives._teardown.call(t,o[r]),o.splice(r,1),r--,a--,r>=t.data.trackEvents.startIndex&&(t.data.trackEvents.startIndex--,t.data.trackEvents.endIndex--)),s[r]&&s[r]._natives&&s[r]._natives.type===e&&s.splice(r,1);for(r=0,a=l.length;a>r;r++)l[r]&&l[r]._natives&&l[r]._natives.type===e&&(l.splice(r,1),r--,a--)},m.compositions={},m.compose=function(t,e,n){m.manifest[t]=n=n||e.manifest||{},m.compositions[t]=e},m.plugin.effect=m.effect=m.compose;var v=/^(?:\.|#|\[)/;m.dom={debug:!1,find:function(t,n){var i=null;if(t=t.trim(),n=n||e,t){if(!v.test(t)&&(i=e.getElementById(t),null!==i))return i;try{i=n.querySelector(t)}catch(r){if(m.dom.debug)throw Error(r)}}return i}};var y=/\?/,b={url:"",data:"",dataType:"",success:m.nop,type:"GET",async:!0,xhr:function(){return new t.XMLHttpRequest}};m.xhr=function(t){if(t.dataType=t.dataType&&t.dataType.toLowerCase()||null,t.dataType&&("jsonp"===t.dataType||"script"===t.dataType))return m.xhr.getJSONP(t.url,t.success,"script"===t.dataType),void 0;var e=m.extend({},b,t);return e.ajax=e.xhr(),e.ajax?("GET"===e.type&&e.data&&(e.url+=(y.test(e.url)?"&":"?")+e.data,e.data=null),e.ajax.open(e.type,e.url,e.async),e.ajax.send(e.data||null),m.xhr.httpData(e)):void 0},m.xhr.httpData=function(t){var e,n,i=null,r=null;return t.ajax.onreadystatechange=function(){if(4===t.ajax.readyState){try{i=JSON.parse(t.ajax.responseText)}catch(a){}if(e={xml:t.ajax.responseXML,text:t.ajax.responseText,json:i},!e.xml||!e.xml.documentElement){e.xml=null;try{n=new DOMParser,r=n.parseFromString(t.ajax.responseText,"text/xml"),r.getElementsByTagName("parsererror").length||(e.xml=r)}catch(a){}}t.dataType&&(e=e[t.dataType]),t.success.call(t.ajax,e)}},e},m.xhr.getJSONP=function(t,n,i){var r,a,o,s=e.head||e.getElementsByTagName("head")[0]||e.documentElement,l=e.createElement("script"),c=!1,u=[],d=/(=)\?(?=&|$)|\?\?/;i||(o=t.match(/(callback=[^&]*)/),null!==o&&o.length?(r=o[1].split("=")[1],"?"===r&&(r="jsonp"),a=m.guid(r),t=t.replace(/(callback=[^&]*)/,"callback="+a)):(a=m.guid("jsonp"),d.test(t)&&(t=t.replace(d,"$1"+a)),u=t.split(/\?(.+)?/),t=u[0]+"?",u[1]&&(t+=u[1]+"&"),t+="callback="+a),window[a]=function(t){n&&n(t),c=!0}),l.addEventListener("load",function(){i&&n&&n(),c&&delete window[a],s.removeChild(l)},!1),l.src=t,s.insertBefore(l,s.firstChild)},m.getJSONP=m.xhr.getJSONP,m.getScript=m.xhr.getScript=function(t,e){return m.xhr.getJSONP(t,e,!0)},m.util={toSeconds:function(t,e){var n,i,r,a,o,s,l=/^([0-9]+:){0,2}[0-9]+([.;][0-9]+)?$/,c="Invalid time format";return"number"==typeof t?t:("string"!=typeof t||l.test(t)||m.error(c),n=t.split(":"),i=n.length-1,r=n[i],r.indexOf(";")>-1&&(o=r.split(";"),s=0,e&&"number"==typeof e&&(s=parseFloat(o[1],10)/e),n[i]=parseInt(o[0],10)+s),a=n[0],{1:parseFloat(a,10),2:60*parseInt(a,10)+parseFloat(n[1],10),3:3600*parseInt(a,10)+60*parseInt(n[1],10)+parseFloat(n[2],10)}[n.length||1])}},m.p.cue=m.p.exec,m.protect={natives:g(m.p).map(function(t){return t.toLowerCase()})},m.forEach({listen:"on",unlisten:"off",trigger:"emit",exec:"cue"},function(t,e){var n=m.p[e];m.p[e]=function(){return"undefined"!=typeof console&&console.warn&&(console.warn("Deprecated method '"+e+"', "+(null==t?"do not use.":"use '"+t+"' instead.")),m.p[e]=n),m.p[t].apply(this,[].slice.call(arguments))}}),t.Popcorn=m}else{t.Popcorn={isSupported:!1};for(var x="byId forEach extend effects error guid sizeOf isArray nop position disable enable destroyaddTrackEvent removeTrackEvent getTrackEvents getTrackEvent getLastTrackEventId timeUpdate plugin removePlugin compose effect xhr getJSONP getScript".split(/\s+/);x.length;)t.Popcorn[x.shift()]=function(){}}}(window,window.document),function(t,e,n){var i=n,r={type:"png",set:!0,at:null,target:null,reload:!0};e.prototype.capture=function(t){var n,a,o,s,l,c=e.extend({},r,t),u=this.position(),d="popcorn-canvas-"+this.media.id,h=i.getElementById(d);if(c.at&&(c.at=e.util.toSeconds(c.at),l=this.currentTime(),this.currentTime(c.at)),h||(h=i.createElement("canvas"),h.id=d,h.width=u.width,h.height=u.height,h.style.display="none",this.media.parentNode.appendChild(h)),n=h.getContext("2d"),o=function(){return n.drawImage(this.media,0,0,u.width,u.height),a=h.toDataURL("image/"+c.type),c.target&&(s=i.querySelectorAll(c.target),s.length&&e.forEach(s,function(t){"IMG"===t.nodeName&&(t.src=a)})),c.set&&this.media.setAttribute("poster",a),c.at&&this.listen("loaded",function(){this.currentTime(l)}),c.reload&&this.media.load(),this.unlisten("seeked",o),this.trigger("captured"),a},this.listen("seeked",o),!c.at){var p=o.call(this);return p}return this}}(this,this.Popcorn,this.document),TAG.Telemetry=function(){function t(){var t,e=navigator.userAgent,n=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];return/trident/i.test(n[1])?(t=/\brv[ :]+(\d+(\.\d+)?)/g.exec(e)||[],"IE "+(t[1]||"")):(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(t=e.match(/version\/([\.\d]+)/i))&&(n[2]=t[1]),n.join(" "))
}function e(t,e,s,l){$(t).on(e+".tag_telemetry",function(t){var e=new Date,c={ttype:s,tagserver:localStorage.ip||"",browser:a,platform:o,time_stamp:e.getTime(),time_human:""+e};l&&l(c,t)||(i.push(c),i.length%r===r-1&&n())})}function n(){var t=JSON.stringify(i);i.length=0,$.ajax({type:"POST",url:"http://127.0.0.1:9999/",data:t,async:!0,success:function(){console.log("POST request to server worked")},error:function(){console.log("telemetry error! look at node output...")}})}var i=[],r=1,a=t(),o=navigator.platform;return{register:e}}(),TAG.Util.makeNamespace("TAG.TESTS"),TAG.TESTS=function(){function t(){p(g([d,a,o,{tests:2,intervals:2}]))}function n(){p(g([h,s,{tests:1,intervals:10}]))}function i(){p(g([h,s,s,l,{tests:1,intervals:10}]))}function r(){p(g([u,c,{tests:4,intervals:2}]))}function a(){return{tests:[function(){m($("#overlay"))}],intervals:[2e3]}}function o(){return{tests:[function(){m($("#catalogBackButton"))}],intervals:[2e3]}}function s(){return{tests:[function(){var t=$(".collectionClickable"),e=w(t);e&&m($(e))}],intervals:[2e3]}}function l(){return{tests:[function(){var t,e=$(".tile"),n=w(e);if(!n)return console.log("RETURNING: no artwork tiles yet"),void 0;for(t=$(".already_selected_in_test");e.length>1&&$(n).hasClass("already_selected_in_test");)n=w(e);t.removeClass("already_selected_in_test"),$(n).addClass("already_selected_in_test"),m($(n))}],intervals:[1e3]}}function c(){var t=$("#tagRoot").width(),e=$("#tagRoot").height();return{tests:[function(){v($(".artworkCanvasTesting")[0],{startX:t/2,endX:2*t/3,startY:e/2,endY:4*e/5})},function(){v($(".artworkCanvasTesting")[0],{startX:t/2,endX:t-10,startY:e/2,endY:e-10})},function(){v($(".artworkCanvasTesting")[0],{startX:t/2,endX:10,startY:e/2,endY:e/2})},function(){v($(".artworkCanvasTesting")[0],{startX:t/2,endX:t/2,startY:e/2,endY:10})}],intervals:[1500,1500,1500,1500]}}function u(){return{tests:[function(){var t="48880741-040a-4657-a3ef-0a2f9bbe27cd";TAG.Worktop.Database.getDoq(t,function(t){var e={prevPage:"catalog",prevScroll:0},n={catalogState:{},doq:t,split:"L"},i=new TAG.Layout.ArtworkViewer(e,n,null);TAG.Util.UI.slidePageLeft(i.getRoot())},k("navigate_to_garibaldi"),k("navigate_to_garibaldi"))}],intervals:[1e3]}}function d(){return{tests:[function(){TAG.Layout.StartPage(null,function(t){TAG.Util.UI.slidePageRight(t)},!0)}],intervals:[1e3]}}function h(){return{tests:[function(){var t=new TAG.Layout.CollectionsPage;$("#overlay").on("click",function(){}),TAG.Util.UI.slidePageLeft(t.getRoot())}],intervals:[1e3]}}function p(t){var e=t.tests,n=t.intervals;try{A(),f(0,e,n)}catch(i){return console.log("error in runTests: "+i.message),-1}}function f(t,e,n,i){i=i||1;var r;e.length>t&&(r=typeof e[t],C=setTimeout(function(){"function"===r?(console.log("RUNNING TEST #"+i),e[t](),f(t+1,e,n,i+1)):"number"===r&&n[t]>0&&(n[t]--,f(Math.max(0,t-e[t]),e,n,i+1))},"function"===r?n[t]:0))}function g(t){if(0===t.length)return{tests:[],intervals:[]};var e,n,i=[],r=[];for(e=0;t.length>e;e++)n="function"==typeof t[e]?t[e]():t[e],i=i.concat(n.tests),r=r.concat(n.intervals);return{tests:i,intervals:r}}function m(t){var e=$(t);x(e),e.trigger("click")}function v(t,e){var n,i=$(t),r=e.startX+$("#tagRoot").offset().left,a=e.startY+$("#tagRoot").offset().top,o=r,s=a,l=r+(e.endX-e.startX),c=a+(e.endY-e.startY),u=l-r,d=c-a,h=Math.sqrt(u*u+d*d),p=20,f=h/p;n=document.createEvent("MouseEvent"),n.initMouseEvent("mousedown",!0,!0,window,1,o,s,r,a,!1,!1,!1,!1,0,null),x(i,e.startX,e.startY,!0),i[0].dispatchEvent(n),y(0,f,{target:i,startClientX:r,startClientY:a,startScreenX:o,startScreenY:s,endClientX:l,endClientY:c,endScreenX:l,endScreenY:c},function(){n=document.createEvent("MouseEvent"),n.initMouseEvent("mouseup",!0,!0,window,1,l,c,l,c,!1,!1,!1,!1,0,null),i[0].dispatchEvent(n)})}function y(t,e,n,i){var r,a=(t+1)/e,o=n.startClientX,s=n.startClientY,l=n.endClientX,c=n.endClientY,u=n.target,d=b(o,l,a),h=b(s,c,a);e>t?(r=document.createEvent("MouseEvent"),r.initMouseEvent("mousemove",!0,!0,window,1,d,h,d,h,!1,!1,!1,!1,0,null),x(u,d-$("#tagRoot").offset().left,h-$("#tagRoot").offset().top,!0),$(u)[0].dispatchEvent(r),setTimeout(function(){y(t+1,e,n,i)},0)):i&&i()}function b(t,e,n){return(1-n)*t+n*e}function x(t,e,n,i,r){var a,o=$(t),s=o.prop("tagName").toLowerCase(),l=$(document.createElement("div")),r=r||30,c="absolute"===o.css("position")||"relative"===o.css("position"),u=e?o.width()-e:o.width()/2,d=n?o.height()-n:o.height()/2,h=e?e:o.width()/2,p=n?n:o.height()/2;"img"===s||"video"===s?(a=o.css("background-color"),o.css("background-color","rgba(255,100,0,0.8)"),setTimeout(function(){o.css("background-color",a)},1e3)):(l.css({"border-radius":"100px","background-color":w(E),position:"absolute","margin-top":c?"":"-"+(d+r/2)+"px","margin-left":c?"":u-r/2+"px",top:c?p-r/2+"px":"",left:c?h-r/2+"px":"",opacity:0,width:r+"px",height:r+"px"}),o.append(l),l.animate({opacity:1},20,function(){var t={opacity:0};i&&(t.width=r/2,t.height=r/2,c?(t.left=h-r/2+r/4,t.top=p-r/2+r/4):(t.marginLeft=u-r/2+r/4,t.marginTop=-(d+r/2-r/4))),l.animate(t,1200,function(){l.remove()})}))}function T(t){return 0===t.length?-1:Math.floor(Math.random()*t.length)}function w(t){var e;return console.log("arr.length = "+t.length),0===t.length?null:(e=T(t),console.log("index = "+e),t[e])}function k(t){var n=t?"error in "+t:"error";return function(){console.log(n+": "+e.message)}}function A(){var t=$("#tagContainer"),e=$(document.createElement("div")),n=$(document.createElement("div"));e.css({"background-color":"rgba(0,0,0,0.9)",height:"100%",opacity:0,position:"absolute",width:"100%","z-index":1e17}),n.css({color:"#ffdd00",position:"absolute","font-family":"sourceSans","font-size":"60px","text-align":"center",top:"40%",width:"100%"}),n.text("starting test..."),e.append(n),t.append(e),e.animate({opacity:1},100,function(){setTimeout(function(){e.animate({opacity:0},100,function(){e.remove()})},1e3)})}function _(){clearTimeout(C)}var C,E=["rgba(255,100,0,0.9)","rgba(255,0,100,0.9)","rgba(100,255,0,0.9)","rgba(100,0,255,0.9)","rgba(0,255,100,0.9)","rgba(0,100,255,0.9)"];return{testEnterCollections:t,testSelectCollections:n,testSelectArtworks:i,testDragArtwork:r,cancelTest:_,runTests:p}}(),function(){"use strict";function t(){function t(){$("#widthSlider").on("change",function(){n.empty();var t=$(this).attr("value");$("#tagWidth").text(t),n.css("width",t+"px")}),$("#heightSlider").on("change",function(){n.empty();var t=$(this).attr("value");$("#tagHeight").text(t),n.css({height:t+"px"})}),$("#TAG_tb1").on("click",TAG.TESTS.testEnterCollections),$("#TAG_tb2").on("click",TAG.TESTS.testSelectCollections),$("#TAG_tb3").on("click",TAG.TESTS.testSelectArtworks),$("#TAG_tb4").on("click",TAG.TESTS.testDragArtwork),$("#TAG_cancelTest").on("click",TAG.TESTS.cancelTest),$("#refreshTAGButton").on("click",function(){n.empty(),$("#refreshTAGButton").off("click"),$("#heightSlider").off("change"),$("#widthSlider").off("change"),$("[src="+tagPath+'"js/raphael.js"]').remove(),$("[src="+tagPath+'"js/tagInk.js"]').remove(),$("[src="+tagPath+'"js/RIN/web/lib/rin-core-1.0.js"]').remove(),$('[href="css/TAG.css"]').remove(),$('[src$="rin-experiences-1.0.js"]').remove(),$('[src$="jquery.pxtouch.min.js"]').remove(),$('[href$="themeResources/rin.css"]').remove(),TAG_GLOBAL({path:tagPath,containerId:containerId,serverIp:ip,allowServerChange:!0})})}var n,i,r,a,o,s,l,c;return containerId&&$("#"+containerId).length>0?(n=$("#"+containerId),localStorage.ip=ip||localStorage.ip||"browntagserver.com",i=n.css("position"),"relative"!==i&&"absolute"!==i&&n.css("position","relative"),r=$(document.createElement("div")).attr("id","tagRootContainer"),n.append(r),a=$(document.createElement("div")).attr("id","tagRootInnerContainer"),r.append(a),o=$(document.createElement("div")).attr("id","tagRoot"),a.append(o),s=n.width(),l=n.height(),c=0,s/l>16/9?(c=(s-16/9*l)/2,s=16/9*l):l=9/16*s,o.css({"font-size":s/9.6+"%",height:l+"px",left:c+"px","max-width":s+"px","max-height":l+"px",width:s+"px"}),t(),e(),void 0):(console.log("no containerId specified, or the containerId does not match an element"),void 0)}function e(){var t,e,n,i,r,a=["js/raphael.js","js/tagInk.js","js/RIN/web/lib/rin-core-1.0.js","js/Autolinker.js-master/dist/Autolinker.js"],o=o||"";for(o.length>0&&"/"!==o[o.length-1]&&(o+="/"),e=document.getElementsByTagName("head").item(0),t=0;a.length>t;t++)n=document.createElement("script"),n.type="text/javascript",n.src=o+a[t],e.appendChild(n);i=document.createElement("link"),i.rel="stylesheet",i.href=o+"css/TAG.css",e.appendChild(i),r=$("#tagRoot"),$("body").css("-ms-touch-action","none"),$("body").on("click.idleTimer",function(){TAG.Util.IdleTimer.restartTimer()}),INPUT_TOUR_ID?(currentPage.name=TAG.Util.Constants.pages.START_PAGE,currentPage.obj=null,TAG.Layout.StartPage(null,function(){TAG.Worktop.Database.getDoq(INPUT_TOUR_ID,function(t){var e=JSON.parse(unescape(t.Metadata.Content)),n=TAG.Layout.TourPlayer(e,null,{},null,t);r.css("overflow","hidden"),r.append(n.getRoot()),n.startPlayback(),currentPage.name=TAG.Util.Constants.pages.TOUR_PLAYER,currentPage.obj=n},function(){},function(){})})):(currentPage.name=TAG.Util.Constants.pages.START_PAGE,currentPage.obj=null,TAG.Layout.StartPage(null,function(t){r.append(t)}))}t()}()};