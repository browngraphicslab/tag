/// <reference path="js/rin/web/narratives/TAGTest/layeringOrderBug.js" />
(function () {
    "use strict";

    function init() {

        //window.location = 'js/RIN/web/reload-test.html';
        //window.location = 'js/RIN/web/test.html';
        //window.location = 'js/RIN/web/index.html';

        //checkInternetConnectivity();
        //checkServerConnectivity();    

        /*
        * Tour Debug Mode
        * for RIN testing only, should be zero when you push changes
        */

        //var testTour =  "dz ink testing" ;// if you want to use TAG normally.
        var testTour = 0;

        LADS.Worktop.Database.load();
        if (testTour) {
            var tourobj = LADS.Worktop.Database.getDoqByName(testTour);
            if (!tourobj) {
                tourobj = LADS.Worktop.Database.createTour();
            }
            $('body').append((new LADS.Layout.TourAuthoringNew(tourobj)).getRoot());
        }
        else {
            $("body").append((new LADS.Layout.StartPage()).getRoot());
        }
        
        //$("body").append((new LADS.Layout.ArtworkEditor()).getRoot());
        //LADS.Worktop.Database.load();
        //$("body").append((new LADS.Authoring.SettingsView()).getRoot());


        // closure for booting / testing TourPlayer
        //(function () {
        //    $.ajax('js/RIN/web/narratives/TAGTest/layeringOrderBug.js', {
        //        dataType: 'json',
        //        success: function (data) {
        //            $('body').append((new LADS.Layout.TourPlayer(data)).getRoot());
        //        },
        //        error: function (xhr, status, error) {
        //            console.log(status);
        //        }
        //    });
        //})();

    }
    
    /*
     * The checkInternetConnectivity() method makes an ajax call to google.com. If it receives a response,
     * it does nothing since the computer is definitely connected to the internet. Otherwise, it appends the
     * InternetFailurePage.
     */
    function checkInternetConnectivity() {

        var request = $.ajax({
            url: "http://google.com",
            dataType: "text",
            async: false
        });

        if (request.status == 0)
            $("body").append((new LADS.Layout.InternetFailurePage("No Internet")).getRoot());
    }

    /*
     * The checkServerConnectivity() method makes an ajax call to the server. If it receives a response,
     * it does nothing since the computer is definitely connected to the internet. Otherwise, it appends the
     * InternetFailurePage.
     * 
     * TODO: currently, the server URL is hardcoded since it cannot be fetched from the database since that
     * hasn't been instantiated. This must be changed.
     */
    function checkServerConnectivity() {

        console.log("check server");

        var request = $.ajax({
            url: "http://ec2-23-21-147-138.compute-1.amazonaws.com:8080",
            dataType: "text",
            async: false
        });

        if (request.status == 0) 
            $("body").append((new LADS.Layout.InternetFailurePage("Server Down")).getRoot());
    }

    function testThing() {
        LADS.TESTS.timeline();
    }

    $(document).ready(function (e) {
        //Debug.enableFirstChanceException(true);
        WinJS.UI.processAll()
            .then(function () { init(); });
    });
})();